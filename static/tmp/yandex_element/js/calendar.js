function SuperCalendar(e) {
    var t, i, n = "super-calendar",
        o = this,
        s = "",
        r = "";
    o._namespace = n + "__", o._namespaceEvent = "." + n, o._namespaceClassname = "." + n + "__", e && (o._initPrefs(e), o.prefs.buttons.maximize && (s += '<span class="{n}max-min" title="' + o.getString("expand") + '"></span>'), o.prefs.buttons.close && (s += '<span class="{n}close" title="' + o.getString("close") + '"></span>'), i = {
        cls: "{n}submit-dates",
        content: [{
            block: "input",
            mods: {
                size: "s",
                theme: "normal",
                clear: "no"
            },
            cls: "{n}from-block",
            content: {
                elem: "control",
                cls: "{n}from",
                attrs: {
                    maxlength: 10
                }
            }
        }, {
            tag: "span",
            content: "—"
        }, {
            block: "input",
            mods: {
                size: "s",
                theme: "normal",
                clear: "no"
            },
            cls: "{n}to-block",
            content: {
                elem: "control",
                cls: "{n}to",
                attrs: {
                    maxlength: 10
                }
            }
        }, {
            block: "button",
            mods: {
                size: "s",
                theme: "action"
            },
            cls: "{n}show",
            content: o.getString("submit")[o.prefs.submitButton]
        }]
    }, o.prefs.title !== !1 && (r = '<span class="{n}title">' + o.getString(o.prefs.title || "title") + "</span>"), t = '<div class="' + n + '">' + (o.prefs.resize ? '<div class="{n}resizer"></div>' : "") + '<div class="{n}head">' + r + s + '</div><div class="{n}years"><div class="{n}years-inner">' + o._selectorYears() + '</div></div><div class="{n}days"><table></table></div><div class="{n}submit-shadow"></div>' + BEMHTML.apply(i) + NaN, o.jElement = $(o._beforePaste(t)).appendTo("body"), e.shadow ? o.jShadow = $(o._beforePaste('<div class="{n}shadow"></div>')).appendTo("body") : o.jShadow = null, o._cacheMonths = {
        current: null
    }, o._cacheElements(), o._initPeriod(e), o.updateDate(), o._bufferEvents = [], o._initResizer(), o._initDragger(), o._events(), o.jElement.hide(), $.browser.msie && o.jElement.addClass("super-calendar_browser_msie").addClass(o._namespace + "msie"), o.jElement.addClass(o.prefs.touch ? o._namespace + "touch" : o._namespace + "untouch"), o.jElement.addClass(o.prefs.single ? o._namespace + "single" : o._namespace + "range"))
}
var BEMHTML = function() {
    function e(e) {
        return e._mode = i, e.block = n, e.elem = o, e.elemMods = s, e.mods = r, e
    }

    function t(e, t) {
        var a = i;
        i = t._mode;
        var l = n;
        n = t.block;
        var c = o;
        o = t.elem;
        var d = s;
        s = t.elemMods;
        var u = r;
        r = t.mods;
        var h = e(t);
        return i = a, n = l, o = c, s = d, r = u, h
    }
    var i, n, o, s, r, a, l = {},
        c = function(l) {
            function c(e) {
                var t = i;
                return "js" === t ? d(e) : "format-value" === t ? "notice" === n && "value" === o ? yt(e) : Vt(e) : "service-url" === t ? "i-services" === n ? vt(e) : Vt(e) : "" === t ? Bt(e) : "tag" === t ? gt(e) : "icon" === t ? "user" === n && "icon" === o && !e._uid == !1 ? It(e) : Vt(e) : "host" === t ? "user" === n && "icon" === o && !e._uid == !1 ? St(e) : Vt(e) : "pre-content" === t ? "user" === n && "name" === o ? Dt(e) : Vt(e) : "value" === t ? "input" === n ? Ct(e) : Vt(e) : "getLive" === t ? "input" === n && !!o == !1 ? Pt(e) : Vt(e) : "content" === t ? et(e) : "live" === t ? "input" === n && !!o == !1 ? At(e) : Vt(e) : "attrs" === t ? Pe(e) : "auto-content" === t ? "auth" === n ? Lt(e) : Vt(e) : "mix" === t ? Se(e) : "action" === t ? "auth" === n && !!o == !1 ? jt(e) : Vt(e) : "default" === t ? p(e) : "bem" === t ? Ft(e) : "iconSize" === t && "user" === n && "icon" === o ? Nt(e) : Vt(e)
            }

            function d(e) {
                var t = n;
                return "tooltip" === t ? u(e) : "radiobox" === t ? !!o == !1 ? !0 : Vt(e) : "b-autocomplete-item" === t ? !(r && "lingvo" === r.type) == !1 && !e.ctx.data == !1 && !e.ctx.data[1] == !1 && !e.ctx.data[1].value == !1 && !!o == !1 ? {
                    val: e.ctx.data[1].value
                } : h(e) : "b-menu-horiz" === t ? !r == !1 && !!o == !1 ? !0 : Vt(e) : "check-button" === t ? !!o == !1 ? !0 : Vt(e) : "notice" === t ? !("undefined" != typeof e.ctx.count) == !1 && !!o == !1 ? {
                    count: e.ctx.count
                } : Vt(e) : "user" === t ? "name" === o ? {
                    maxLength: e._maxLength,
                    maxLengthRelative: e._maxLengthRelative,
                    isUglyUserName: e._isUglyUserName
                } : !!o == !1 ? !0 : Vt(e) : "checkbox" === t ? !!o == !1 ? e.extend({
                    live: !1
                }, e.ctx.js) : Vt(e) : "input" === t ? !!o == !1 ? {
                    live: e._live
                } : Vt(e) : "dropdown" === t || "select" === t || "auth" === t || "radio-button" === t ? !!o == !1 ? !0 : Vt(e) : "domik" === t ? !(r && "hidden" === r.type) == !1 && !!o == !1 ? !1 : Vt(e) : "tabs" === t || "button" === t ? !!o == !1 ? !0 : Vt(e) : "tabs-panes" === t ? !!o == !1 ? {
                    id: e._tabsPanesId
                } : Vt(e) : "link" === t ? !e.ctx.tabindex == !1 && !!o == !1 ? {
                    origTabindex: e.ctx.tabindex
                } : Vt(e) : "dropdown-menu" === t && !!o == !1 ? !0 : Vt(e)
            }

            function u(e) {
                if (!(e.__$anflg53 !== !0) == !1) {
                    if (!(r && "s" === r.size) == !1) {
                        if (!!o == !1) {
                            var t, i;
                            return e.extend((t = e.__$anflg53, e.__$anflg53 = !0, i = u(e), e.__$anflg53 = t, i), {
                                tailWidth: 14,
                                tailHeight: 7
                            })
                        }
                        return Vt(e)
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function h(e) {
                return !(r && "nav" === r.type) == !1 && !!o == !1 ? {
                    val: e._url
                } : m(e)
            }

            function m(e) {
                return !!o == !1 ? !0 : !e.ctx.search_cgi == !1 && !e._.isArray(e.ctx.search_cgi) == !1 ? {
                    cgi: e.ctx.search_cgi
                } : Vt(e)
            }

            function p(e) {
                var t = n;
                if ("popup" === t) return f(e);
                if ("select" === t) return O(e);
                if ("button" === t) return R(e);
                if ("check-button" === t) return z(e);
                if ("radiobox" === t) return q(e);
                if ("radio-button" === t) return S(e);
                if ("b-menu-horiz" === t) return "item" === o && !(e.__$anflg29 !== !0) == !1 && !r == !1 ? K(e) : Vt(e);
                if ("b-menu-vert" === t) return "item" === o && !(e.__$anflg28 !== !0) == !1 ? Z(e) : Vt(e);
                if ("dropdown-menu" === t) {
                    var t = o;
                    return "switcher" === t ? !(e.__$anflg27 !== !0) == !1 ? ee(e) : oe(e) : "popup" === t ? !(e.__$anflg26 !== !0) == !1 ? te(e) : !(e.__$anflg25 !== !0) == !1 ? ie(e) : oe(e) : "menu" === t && !(e.__$anflg24 !== !0) == !1 ? ne(e) : oe(e)
                }
                if ("i-services" === t) {
                    var t = o;
                    return "url" === t ? void e._buf.push(e["i-services"].serviceUrl(e.ctx.id, e.ctx.region)) : "name" === t ? void e._buf.push(e["i-services"].serviceName(e.ctx.id)) : !o == !1 ? "" : Vt(e)
                }
                return "user" === t ? re(e) : "tabs" === t ? I(e) : "checkbox" === t ? pe(e) : "tabs-menu" === t ? w(e) : "input" === t ? ge(e) : "link" === t ? B(e) : "dropdown" === t ? "popup" === o && !(e.__$anflg12 !== !0) == !1 ? ve(e) : Vt(e) : "tabs-panes" === t ? !e.ctx.id == !1 ? k(e) : Vt(e) : "auth" === t ? Me(e) : "slider" === t ? y(e) : "domik" === t ? xe(e) : "tooltip" === t ? !!e._isInTooltip == !1 && !!o == !1 ? b(e) : Vt(e) : "i-bem" === t ? "i18n" === o ? Ie(e) : Vt(e) : "b-autocomplete-item" === t ? Q(e) : Vt(e)
            }

            function f(e) {
                if (!(e.__$anflg52 !== !0) == !1) {
                    if (!e._isInTooltip == !1) {
                        if (!!o == !1) {
                            delete e._isInTooltip;
                            var t = e.__$anflg52;
                            return e.__$anflg52 = !0, f(e), void(e.__$anflg52 = t)
                        }
                        return g(e)
                    }
                    return g(e)
                }
                return g(e)
            }

            function g(e) {
                return !!e._popupDefaults == !1 && !!o == !1 ? _(e) : Vt(e)
            }

            function _(e) {
                var t = e.ctx;
                if (t.mods = r = e.extend({
                        theme: "ffffff",
                        autoclosable: "yes",
                        adaptive: "yes",
                        animate: "yes"
                    }, r), t.zIndex) {
                    var i = t.attrs || (t.attrs = {});
                    i.style = (i.style || "") + ";z-index:" + t.zIndex + ";"
                }
                var n = e._popupDefaults;
                e._popupDefaults = !0, f(e), e._popupDefaults = n
            }

            function b(e) {
                var t, o, s = e.ctx,
                    a = r,
                    l = a.theme,
                    c = {
                        adaptive: "yes",
                        autoclosable: a.autoclosable || "no",
                        theme: l
                    },
                    d = (t = i, i = "js", o = u(e), i = t, o);
                d = (d ? e.extend(d, "true" === s.js ? {} : s.js) : s.js) || {};
                var h = d.to && "string" == typeof d.to ? [d.to] : d.to,
                    m = (d.offset ? -d.offset : 0) - (d.tailHeight ? d.tailHeight : 0),
                    p = {
                        directions: (h || ["right", "bottom", "top", "left"]).map(function(e) {
                            return {
                                to: e,
                                offset: m
                            }
                        })
                    },
                    f = i;
                i = "";
                var g = e._isInTooltip;
                e._isInTooltip = !0;
                var _ = e.ctx;
                e.ctx = {
                    block: "popup",
                    mods: c,
                    js: p,
                    mix: {
                        block: n,
                        mods: a,
                        js: d
                    },
                    content: [{
                        block: n,
                        elem: "tail"
                    }, {
                        elem: "content",
                        content: s.content
                    }]
                }, Bt(e), i = f, e._isInTooltip = g, e.ctx = _
            }

            function y(e) {
                return "runner" === o ? v(e) : M(e)
            }

            function v(e) {
                if (!!e._done == !1) {
                    var t, i, n;
                    return t = e._value, e._value = e.ctx.value, i = e._done, e._done = !0, n = v(e), e._value = t, e._done = i, n
                }
                return M(e)
            }

            function M(e) {
                if (!(e.__$anflg50 !== !0) == !1) {
                    if (!!o == !1) {
                        var t = e.generateId(),
                            i = e.__$anflg50;
                        e.__$anflg50 = !0;
                        var n = e._inSlider;
                        e._inSlider = !0;
                        var s = e._titleId;
                        return e._titleId = "title" + t, y(e), e._inSlider = n, e._titleId = s, void(e.__$anflg50 = i)
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function k(e) {
                if (!(e.ctx.id !== e._tabsPanesId) == !1) {
                    if (!!o == !1) {
                        var t, i;
                        return t = e._tabsPanesId, e._tabsPanesId = e.ctx.id, i = k(e), e._tabsPanesId = t, i
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function B(e) {
                if (!(e.__$anflg47 !== !0) == !1) {
                    if (!e._tabsMenuTabDisabled == !1) {
                        if (!!o == !1) {
                            delete e._tabsMenuTabDisabled, r.disabled = "yes", e.ctx.mods = e.extend(e.ctx.mods, {
                                disabled: "yes"
                            });
                            var t = e.__$anflg47;
                            return e.__$anflg47 = !0, B(e), void(e.__$anflg47 = t)
                        }
                        return Vt(e)
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function w(e) {
                return "tab" === o ? x(e) : N(e)
            }

            function x(e) {
                if (!(e.__$anflg45 !== !0) == !1) {
                    if (!(s && "yes" === s.disabled) == !1) {
                        e._tabsMenuTabDisabled = !0;
                        var t = e.__$anflg45;
                        return e.__$anflg45 = !0, x(e), void(e.__$anflg45 = t)
                    }
                    return E(e)
                }
                return E(e)
            }

            function E(e) {
                if (!(e.__$anflg44 !== !0) == !1) {
                    if (!e.isFirst() == !1) {
                        e.ctx.elemMods = e.extend({
                            first: "yes"
                        }, e.ctx.elemMods);
                        var t = e.__$anflg44;
                        return e.__$anflg44 = !0, x(e), void(e.__$anflg44 = t)
                    }
                    return N(e)
                }
                return N(e)
            }

            function N(e) {
                if (!(e.__$anflg43 !== !0) == !1) {
                    if (!!o == !1) {
                        var t, i, n, s;
                        return t = e.__$anflg43, e.__$anflg43 = !0, n = e._tabsMenuJs, e._tabsMenuJs = e.ctx.js, s = w(e), e._tabsMenuJs = n, i = s, e.__$anflg43 = t, i
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function I(e) {
                if (!(e.__$anflg42 !== !0) == !1) {
                    if (!!o == !1) {
                        var t, i, n, s;
                        return t = e.__$anflg42, e.__$anflg42 = !0, n = e._panesId, e._panesId = e.ctx.panes, s = I(e), e._panesId = n, i = s, e.__$anflg42 = t, i
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function S(e) {
                return !(e.__$anflg41 !== !0) == !1 && !!o == !1 ? D(e) : C(e)
            }

            function D(e) {
                var t = e.ctx;
                t.mods || (t.mods = {}), t.mods.theme || (t.mods.theme = "normal");
                var i = e.__$anflg41;
                e.__$anflg41 = !0;
                var n = e._radioButton;
                e._radioButton = {
                    name: t.name,
                    value: t.value,
                    disabled: Boolean(t.mods.disabled)
                }, S(e), e._radioButton = n, e.__$anflg41 = i
            }

            function C(e) {
                return "radio" === o && !(e.__$anflg40 !== !0) == !1 ? T(e) : Vt(e)
            }

            function T(e) {
                e.ctx.elemMods || (e.ctx.elemMods = {});
                var t = e.ctx.elemMods,
                    i = e._radioButton,
                    n = i.disabled,
                    o = e.extend({}, e.ctx.controlAttrs),
                    s = void 0 !== o.value && o.value === i.value;
                s && (t.checked = "yes", t.pressed = "yes"), t.checked && (t.pressed = "yes"), n && (t.disabled = "yes");
                var r = Object(e.ctx.mods).side;
                t.side || (r ? t.side = r : t.side = ["", "right", "left", "both"][2 * e.isFirst() + e.isLast()]), e._nextForPressed && (t["next-for-pressed"] = "yes", e._nextForPressed = !1), e._nextForPressed = t.checked, o.checked = Boolean(t.checked), o.disabled = Boolean(t.disabled), o.id || (o.id = e.generateId());
                var a = e.__$anflg40;
                e.__$anflg40 = !0;
                var l = e._controlAttrs;
                e._controlAttrs = o, S(e), e._controlAttrs = l, e.__$anflg40 = a
            }

            function O(e) {
                return "group" === o ? P(e) : A(e)
            }

            function P(e) {
                if (!(e.__$anflg39 !== !0) == !1) {
                    var t = e.__$anflg39;
                    e.__$anflg39 = !0;
                    var i = e._labelId;
                    return e._labelId = e.generateId(), P(e), e._labelId = i, void(e.__$anflg39 = t)
                }
                return A(e)
            }

            function A(e) {
                return !(e.__$anflg36 !== !0) == !1 && !!o == !1 ? L(e) : Vt(e)
            }

            function L(e) {
                var t = e.ctx,
                    i = t.id || e.generateId(),
                    o = e.__$anflg36;
                e.__$anflg36 = !0;
                var s = e._controlAttrs;
                e._controlAttrs = {
                    id: i,
                    name: t.name || i,
                    tabindex: t.tabindex
                };
                var a = e._formSelect;
                e._formSelect = {
                    block: n,
                    mods: r,
                    tabindex: t.tabindex
                }, O(e), e._controlAttrs = s, e._formSelect = a, e.__$anflg36 = o
            }

            function R(e) {
                return !(e.__$anflg38 !== !0) == !1 && !e._formSelect == !1 && !!o == !1 ? j(e) : F(e)
            }

            function j(e) {
                var t = e.ctx,
                    i = e._formSelect.mods,
                    n = e._formSelect.tabindex,
                    o = t.mods || {};
                o.arrow = "down", i.theme && (o.theme = i.theme), i.size && (o.size = i.size), "yes" === i.disabled && (o.disabled = "yes"), t.mods = o, n && (t.tabindex = n);
                var s = e.__$anflg38;
                e.__$anflg38 = !0;
                var r = e.ctx,
                    a = r._theme;
                r._theme = !0, R(e), r._theme = a, e.__$anflg38 = s
            }

            function F(e) {
                if (!(e.__$anflg7 !== !0) == !1) {
                    if (!(r && "yes" === r.pseudo) == !1) {
                        if (!!o == !1) {
                            e.ctx.mods = e.extend({
                                theme: "pseudo"
                            }, e.ctx.mods);
                            var t = e.__$anflg7;
                            return e.__$anflg7 = !0, R(e), void(e.__$anflg7 = t)
                        }
                        return V(e)
                    }
                    return V(e)
                }
                return V(e)
            }

            function V(e) {
                if (!(e.__$anflg3 !== !0) == !1) {
                    if (!!o == !1) {
                        e.ctx.mods = e.extend({
                            theme: "normal"
                        }, e.ctx.mods);
                        var t = e.__$anflg3;
                        return e.__$anflg3 = !0, R(e), void(e.__$anflg3 = t)
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function z(e) {
                return !(r && "yes" === r.pseudo) == !1 && !!o == !1 ? H(e) : U(e)
            }

            function H(e) {
                if (!!(e.ctx.mods || {}).theme == !1) {
                    var t = e.ctx,
                        i = t.mods;
                    return t.mods = e._.extend(e.ctx.mods || {}, {
                        theme: "pseudo"
                    }), H(e), void(t.mods = i)
                }
                return U(e)
            }

            function U(e) {
                return !(e.__$anflg34 !== !0) == !1 && !!o == !1 ? G(e) : Vt(e)
            }

            function G(e) {
                var t = e.ctx,
                    i = (t.controlAttrs || {}).id || e.generateId(),
                    n = t.mods || {};
                n.theme = n.theme || "normal";
                var o = e.__$anflg34;
                e.__$anflg34 = !0;
                var s = e._control;
                e._control = {
                    elem: "control",
                    attrs: t.controlAttrs,
                    id: i,
                    labelledby: "text" + i,
                    name: t.name,
                    tabindex: t.tabindex,
                    checked: r.checked,
                    disabled: r.disabled,
                    value: t.value || t.content
                };
                var a = e.ctx,
                    l = a.mods;
                a.mods = n, z(e), e._control = s, a.mods = l, e.__$anflg34 = o
            }

            function q(e) {
                return "radio" === o ? W(e) : Y(e)
            }

            function W(e) {
                return !(e.__$anflg32 !== !0) == !1 ? J(e) : Y(e)
            }

            function J(e) {
                var t, i, n, o, s = e.ctx,
                    r = e.extend({
                        id: e.generateId(),
                        type: "radio",
                        name: e._name
                    }, s.controlAttrs),
                    a = void 0 !== r.value && r.value === e._value;
                return s.elemMods = e.extend({
                    disabled: e._disabled,
                    checked: a ? "yes" : ""
                }, s.elemMods), "yes" === s.elemMods.disabled && (r.disabled = "disabled", r.tabindex = -1), "yes" === s.elemMods.checked && (r.checked = "checked"), t = e.__$anflg32, e.__$anflg32 = !0, n = e._controlAttrs, e._controlAttrs = r, o = W(e), e._controlAttrs = n, i = o, e.__$anflg32 = t, i
            }

            function Y(e) {
                return !(e.__$anflg31 !== !0) == !1 && !!o == !1 ? $(e) : Vt(e)
            }

            function $(e) {
                var t = e.ctx,
                    i = e.extend({
                        theme: "normal"
                    }, t.mods),
                    n = e.__$anflg31;
                e.__$anflg31 = !0;
                var o = e.ctx,
                    s = o.mods;
                o.mods = i;
                var r = e._disabled;
                e._disabled = i.disabled;
                var a = e._name;
                e._name = e.ctx.name;
                var l = e._value;
                e._value = e.ctx.value, q(e), o.mods = s, e._disabled = r, e._name = a, e._value = l, e.__$anflg31 = n
            }

            function Q(e) {
                return !(e.__$anflg30 !== !0) == !1 && !(r && "nav" === r.type) == !1 && !!o == !1 ? X(e) : Vt(e)
            }

            function X(e) {
                var t, i, n, o, s, r, a = e.ctx.data,
                    l = a[4],
                    c = (l.match(/^\w[\w-]*:\/\//g) ? "" : "http://") + l,
                    d = BEM.blocks["i-common__string"].escapeHTML(a[3]),
                    u = "&nbsp;&mdash;&nbsp;" + BEM.blocks["i-common__string"].highlight(a[2], e.ctx.hl);
                return t = e.__$anflg30, e.__$anflg30 = !0, n = e._linkUrlContent, e._linkUrlContent = d, o = e._linkInfoConten, e._linkInfoConten = u, s = e._url, e._url = c, r = Q(e), e._linkUrlContent = n, e._linkInfoConten = o, e._url = s, i = r, e.__$anflg30 = t, i
            }

            function K(e) {
                var t = e.__$anflg29;
                e.__$anflg29 = !0;
                var n = i;
                i = "";
                var o = e.position;
                e.position = e.position - 1;
                var s = e.ctx;
                e.ctx = {
                    elem: "layout-unit",
                    content: e.ctx
                }, Bt(e), i = n, e.position = o, e.ctx = s, e.__$anflg29 = t
            }

            function Z(e) {
                var t = e.__$anflg28;
                e.__$anflg28 = !0;
                var n = i;
                i = "";
                var o = e.position;
                e.position = e.position - 1;
                var s = e.ctx;
                e.ctx = {
                    elem: "layout-unit",
                    content: [e.ctx, e.ctx["item-content"]]
                }, Bt(e), i = n, e.position = o, e.ctx = s, e.__$anflg28 = t
            }

            function ee(e) {
                var t = e.ctx.content;
                t.mix = (t.mix || []).concat([{
                    block: "dropdown-menu",
                    elem: "switcher"
                }]);
                var n = e.__$anflg27;
                e.__$anflg27 = !0;
                var o = e.ctx;
                e.ctx = t;
                var s = i;
                i = "", Bt(e), e.ctx = o, i = s, e.__$anflg27 = n
            }

            function te(e) {
                var t = e.ctx,
                    n = e.__$anflg26;
                e.__$anflg26 = !0;
                var o = e.ctx;
                e.ctx = {
                    block: "dropdown",
                    elem: "popup",
                    js: e.ctx.js,
                    mix: (t.mix || []).concat({
                        block: "dropdown-menu",
                        elem: "popup",
                        mods: t.mods
                    }),
                    attrs: t.attrs,
                    mods: t.mods,
                    content: {
                        block: "dropdown-menu",
                        elem: "menu",
                        type: t.type,
                        mods: t.menuMods,
                        mix: t.menuMix,
                        content: t.content
                    }
                };
                var s = i;
                i = "", Bt(e), e.ctx = o, i = s, e.__$anflg26 = n
            }

            function ie(e) {
                var t = e.ctx,
                    n = e.__$anflg25;
                e.__$anflg25 = !0;
                var o = e.ctx;
                e.ctx = {
                    block: "dropdown",
                    elem: "popup",
                    js: e.ctx.js,
                    mix: (t.mix || []).concat({
                        block: "dropdown-menu",
                        elem: "popup",
                        mods: e._.extend({
                            size: e.dropdownMenuSize
                        }, t.mods)
                    }),
                    attrs: t.attrs,
                    content: {
                        block: "dropdown-menu",
                        elem: "menu",
                        title: t.menuTitle,
                        type: t.type,
                        mods: t.menuMods,
                        mix: t.menuMix,
                        content: t.content
                    }
                };
                var s = i;
                i = "", Bt(e), e.ctx = o, i = s, e.__$anflg25 = n
            }

            function ne(e) {
                var t = e.ctx,
                    n = t.type || "vert",
                    o = t.mods || {};
                o.theme || (o.theme = "ffffff");
                var s = e.__$anflg24;
                e.__$anflg24 = !0;
                var r = e.ctx;
                e.ctx = {
                    block: "b-menu-" + n,
                    mix: (t.mix || []).concat({
                        block: "dropdown-menu",
                        elem: "menu",
                        mods: o
                    }),
                    title: t.title,
                    content: t.content
                };
                var a = i;
                i = "", Bt(e), e.ctx = r, i = a, e.__$anflg24 = s
            }

            function oe(e) {
                return !(e.__$anflg23 !== !0) == !1 && !!o == !1 ? se(e) : Vt(e)
            }

            function se(e) {
                var t = e.ctx,
                    n = t.mods || (t.mods = {});
                n.theme || (n.theme = "ffffff"), e.dropdownMenuSize = n.size;
                var o = e.__$anflg23;
                e.__$anflg23 = !0;
                var s = e.ctx;
                e.ctx = t;
                var r = i;
                i = "", Bt(e), e.ctx = s, i = r, e.__$anflg23 = o
            }

            function re(e) {
                var t = o;
                return "icon" === t ? ae(e) : "name" === t ? le(e) : de(e)
            }

            function ae(e) {
                if (!(e.__$anflg22 !== !0) == !1) {
                    if (!e._uid == !1) {
                        var t, n, o = (t = i, i = "icon", n = It(e), i = t, n),
                            s = e.__$anflg22;
                        e.__$anflg22 = !0;
                        var r = e.ctx,
                            a = r._icon;
                        return r._icon = o, ae(e), r._icon = a, void(e.__$anflg22 = s)
                    }
                    return de(e)
                }
                return de(e)
            }

            function le(e) {
                return !(e.__$anflg21 !== !0) == !1 ? ce(e) : de(e)
            }

            function ce(e) {
                var t = e.ctx,
                    i = e["i-global"],
                    n = t.content || t.login || (i.displayName || {}).name,
                    o = !1;
                n || (/^uid-/.test(i.login) ? (n = "", o = !0) : n = i.login);
                var s = e.__$anflg21;
                e.__$anflg21 = !0;
                var r = e._maxLength;
                e._maxLength = t.hasOwnProperty("maxLength") ? t.maxLength : 16;
                var a = e._maxLengthRelative;
                e._maxLengthRelative = t.hasOwnProperty("maxLengthRelative") ? t.maxLengthRelative : 3;
                var l = e._userName;
                e._userName = n;
                var c = e._isUglyUserName;
                e._isUglyUserName = o, le(e), e._maxLength = r, e._maxLengthRelative = a, e._userName = l, e._isUglyUserName = c, e.__$anflg21 = s
            }

            function de(e) {
                return !(e.__$anflg20 !== !0) == !1 && !!o == !1 ? ue(e) : he(e)
            }

            function ue(e) {
                var t = e.ctx.js || {};
                t.uid = t.uid || e["i-global"].uid;
                var i = e.__$anflg20;
                e.__$anflg20 = !0;
                var n = e._uid;
                e._uid = t.uid;
                var o = e.ctx,
                    s = o.js;
                o.js = t, re(e), e._uid = n, o.js = s, e.__$anflg20 = i
            }

            function he(e) {
                return "enter" === o && !(e.__$anflg19 !== !0) == !1 ? me(e) : Vt(e)
            }

            function me(e) {
                var t = BEM.I18N("user", "enter"),
                    n = e.__$anflg19;
                e.__$anflg19 = !0;
                var o = e.ctx;
                e.ctx = [{
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        size: "m"
                    },
                    mix: [{
                        block: "user",
                        elem: "enter"
                    }],
                    attrs: {
                        tabindex: "-1",
                        title: t,
                        "aria-label": t
                    },
                    content: [{
                        block: "image",
                        mix: [{
                            block: "button",
                            elem: "icon",
                            mods: {
                                16: "enter"
                            }
                        }],
                        alt: ""
                    }, {
                        block: "user",
                        elem: "enter-label"
                    }]
                }, {
                    block: "domik",
                    mods: {
                        type: "hidden"
                    }
                }];
                var s = i;
                i = "", Bt(e), e.ctx = o, i = s, e.__$anflg19 = n
            }

            function pe(e) {
                return !(e.__$anflg17 !== !0) == !1 && !!o == !1 ? fe(e) : Vt(e)
            }

            function fe(e) {
                var t = e.ctx,
                    i = t.checkboxAttrs || {},
                    n = i.id || e.generateId(),
                    o = t.mods || {};
                o.theme = o.theme || "normal";
                var s = e.__$anflg17;
                e.__$anflg17 = !0;
                var r = e._checkboxAttrs;
                e._checkboxAttrs = i.id ? i : {
                    id: "id" + n
                };
                var a = e._labelId;
                e._labelId = "label" + n;
                var l = e.ctx,
                    c = l.mods;
                l.mods = o, pe(e), e._checkboxAttrs = r, e._labelId = a, l.mods = c, e.__$anflg17 = s
            }

            function ge(e) {
                var t = o;
                if ("hint" === t) return !(e.__$anflg16 !== !0) == !1 && !!e._value == !1 && !(0 !== e._value) == !1 ? _e(e) : be(e);
                if ("control" === t) {
                    if (!(e.__$anflg15 !== !0) == !1) {
                        var n = e.__$anflg15;
                        e.__$anflg15 = !0;
                        var s = e.ctx;
                        e.ctx = {
                            elem: "box",
                            content: e.ctx
                        };
                        var r = i;
                        return i = "", Bt(e), e.ctx = s, i = r, void(e.__$anflg15 = n)
                    }
                    return be(e)
                }
                return be(e)
            }

            function _e(e) {
                var t, n, o, s, r, a = e.ctx,
                    l = a.elemMods || (a.elemMods = {});
                return l.visibility = "visible", t = e.__$anflg16, e.__$anflg16 = !0, o = e.ctx, e.ctx = a, s = i, i = "", r = Bt(e), e.ctx = o, i = s, n = r, e.__$anflg16 = t, n
            }

            function be(e) {
                return !(e.__$anflg13 !== !0) == !1 && !!o == !1 ? ye(e) : Vt(e)
            }

            function ye(e) {
                var t, n, o, s, a, l = (t = i, i = "value", n = e.ctx, e.ctx = e.ctx.value, o = Ct(e), i = t, e.ctx = n, o),
                    c = e.ctx.id || e.generateId(),
                    d = e.ctx.mods || {},
                    u = (s = i, i = "getLive", a = Pt(e), i = s, a);
                d.theme = d.theme || "normal";
                var h = e.__$anflg13;
                e.__$anflg13 = !0;
                var m = e._inputId;
                e._inputId = c;
                var p = e._labelId;
                e._labelId = "label" + c;
                var f = e._hintId;
                e._hintId = "hint" + c;
                var g = e._name;
                e._name = e.ctx.name || "";
                var _ = e._value;
                e._value = l;
                var b = e._inputLink;
                e._inputLink = !0;
                var y = e._disabled;
                e._disabled = r.disabled;
                var v = e._live;
                e._live = u;
                var M = e.ctx,
                    k = M.mods;
                M.mods = d, ge(e), e._inputId = m, e._labelId = p, e._hintId = f, e._name = g, e._value = _, e._inputLink = b, e._disabled = y, e._live = v, M.mods = k, e.__$anflg13 = h
            }

            function ve(e) {
                var t = e.ctx,
                    n = [{
                        block: "dropdown",
                        elem: "popup"
                    }];
                t.mix && (n = n.concat(t.mix));
                var o = e.__$anflg12;
                e.__$anflg12 = !0;
                var s = e.ctx;
                e.ctx = {
                    block: "popup",
                    mix: n,
                    mods: t.mods,
                    attrs: t.attrs,
                    js: t.js,
                    content: [{
                        elem: "tail"
                    }, {
                        elem: "content",
                        content: t.content
                    }]
                };
                var r = i;
                i = "", Bt(e), e.ctx = s, i = r, e.__$anflg12 = o
            }

            function Me(e) {
                return "retpath" === o ? ke(e) : Be(e)
            }

            function ke(e) {
                if (!(e.__$anflg11 !== !0) == !1) {
                    var t = e.__$anflg11;
                    e.__$anflg11 = !0;
                    var i = e._retpath;
                    return e._retpath = BEM && BEM.blocks ? BEM.blocks["i-global"].param("retpath") : e["i-global"].retpath, ke(e), e._retpath = i, void(e.__$anflg11 = t)
                }
                return Be(e)
            }

            function Be(e) {
                return !(e.__$anflg10 !== !0) == !1 && !!o == !1 ? we(e) : Vt(e)
            }

            function we(e) {
                var t, i, n, o;
                BEM && BEM.blocks ? (o = BEM.blocks["i-global"], t = o.param("passport-host"), i = o.param("retpath"), n = o.param("passport-msg")) : (o = e["i-global"], t = o["passport-host"], i = o.retpath, n = o["passport-msg"]);
                var s = e.__$anflg10;
                e.__$anflg10 = !0;
                var r = e._passportHost;
                e._passportHost = t;
                var a = e._paramRetpath;
                e._paramRetpath = i ? "&retpath=" + encodeURIComponent(i) : "";
                var l = e._paramFrom;
                e._paramFrom = n ? "&from=" + encodeURIComponent(n) : "", Me(e), e._passportHost = r, e._paramRetpath = a, e._paramFrom = l, e.__$anflg10 = s
            }

            function xe(e) {
                return !(e.__$anflg9 !== !0) == !1 && !(r && "hidden" === r.type) == !1 && !!o == !1 ? Ee(e) : Ne(e)
            }

            function Ee(e) {
                var t, n, o, s, r;
                return t = e.__$anflg9, e.__$anflg9 = !0, o = e.ctx, e.ctx = {
                    block: "auth",
                    mix: [{
                        block: "domik",
                        mods: {
                            type: "hidden"
                        }
                    }],
                    js: !1,
                    attrs: {
                        style: "display:none"
                    },
                    content: [{
                        tag: "input",
                        attrs: {
                            name: "login"
                        }
                    }, {
                        tag: "input",
                        attrs: {
                            name: "passwd",
                            type: "password"
                        }
                    }]
                }, s = i, i = "", r = Bt(e), e.ctx = o, i = s, n = r, e.__$anflg9 = t, n
            }

            function Ne(e) {
                if (!!o == !1) {
                    if (!!(e.ctx.mods || {}).logo == !1) {
                        var t, i;
                        BEM.blocks ? (i = BEM.blocks["i-global"], t = i.param("lang")) : (i = e["i-global"], t = i.lang);
                        var n = e.ctx,
                            s = n.mods;
                        return n.mods = e.extend(e.ctx.mods || {}, {
                            logo: ~["en", "tr"].indexOf(t) ? "en" : "ru"
                        }), xe(e), void(n.mods = s)
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function Ie(e) {
                var t, n, o, s;
                if (!e.ctx) return "";
                var r = e.ctx,
                    a = r.keyset,
                    l = r.key,
                    c = r.params || {};
                if (!a && !l) return "";
                if (r.content) {
                    var d;
                    c.content = (d = [], t = e._buf, e._buf = d, n = i, i = "", o = e.ctx, e.ctx = r.content, s = Bt(e), e._buf = t, i = n, e.ctx = o, d.join(""))
                }
                e._buf.push(BEM.I18N(a, l, c))
            }

            function Se(e) {
                var t = n;
                if ("slider" === t) return "body" === o ? De(e) : Vt(e);
                if ("input" === t) return !e._inSlider == !1 && !!o == !1 ? [{
                    block: "slider",
                    elem: "input"
                }] : Te(e);
                if ("tabs" === t) return !!o == !1 ? {
                    block: "tabs-panes",
                    js: {
                        id: e._panesId
                    }
                } : Vt(e);
                if ("select" === t) {
                    if ("group" === o) {
                        var i = e.isFirst() ? e.isLast() ? "both" : "first" : e.isLast() ? "last" : "middle";
                        return {
                            mods: {
                                position: i
                            }
                        }
                    }
                    return Vt(e)
                }
                if ("button" === t) return !e._formSelect == !1 && !!o == !1 ? [{
                    block: e._formSelect.block,
                    elem: "button"
                }] : Vt(e);
                if ("b-autocomplete-item" === t) return !(r && "foot" === r.type) == !1 && !!o == !1 ? [{
                    mods: {
                        enterable: "no"
                    }
                }] : Oe(e);
                if ("b-menu-horiz" === t) {
                    if ("layout-unit" === o) {
                        if (!r == !1) {
                            var s = [];
                            return e.isFirst() && s.push({
                                elemMods: {
                                    position: "first"
                                }
                            }), e.isLast() && s.push({
                                elemMods: {
                                    position: "last"
                                }
                            }), s
                        }
                        return Vt(e)
                    }
                    return Vt(e)
                }
                if ("b-menu-vert" === t) {
                    if ("layout-unit" === o) {
                        var a = [];
                        return e.isFirst() && a.push({
                            elemMods: {
                                position: "first"
                            }
                        }), e.isLast() && a.push({
                            elemMods: {
                                position: "last"
                            }
                        }), a
                    }
                    return Vt(e)
                }
                if ("notice" === t) {
                    var t = o;
                    return "text" === t ? [{
                        block: "a11y-hidden"
                    }] : "count" === t && !!e.ctx.url == !1 ? [{
                        elem: "plain"
                    }] : Vt(e)
                }
                return "dropdown" === t && !!o == !1 ? [{
                    mods: {
                        action: "closed"
                    }
                }] : Vt(e)
            }

            function De(e) {
                return !(e.__$anflg51 !== !0) == !1 && !r.orientation == !1 && !!e.ctx._wOrigin == !1 ? Ce(e) : Vt(e)
            }

            function Ce(e) {
                var t, i, n, o, s, a = (t = e.__$anflg51, e.__$anflg51 = !0, n = e.ctx, o = n._wOrigin, n._wOrigin = !0, s = De(e), n._wOrigin = o, i = s, e.__$anflg51 = t, i || []);
                return a.push({
                    elemMods: {
                        origin: "vert" === r.orientation ? "y" : "x"
                    }
                }), a
            }

            function Te(e) {
                return "ahead" === o ? [{
                    block: "input",
                    elem: "input"
                }] : Vt(e)
            }

            function Oe(e) {
                return !!o == !1 ? [{
                    mods: {
                        pers: e.ctx.pers ? "yes" : ""
                    }
                }] : Vt(e)
            }

            function Pe(e) {
                var t = n;
                if ("slider" === t) {
                    var t = o;
                    return "mark" === t ? {
                        "aria-hidden": !0
                    } : "runner" === t ? {
                        hideFocus: "true",
                        id: e.ctx.id,
                        role: "slider",
                        "aria-valuenow": e._value,
                        "aria-valuemin": e.ctx.min,
                        "aria-valuemax": e.ctx.max,
                        "aria-disabled": "yes" === (e.ctx.mods || {}).disabled,
                        "aria-labelledby": e.ctx.labelledby,
                        "aria-controls": e.ctx.inputId
                    } : Ue(e)
                }
                if ("tabs-panes" === t) return "pane" === o ? {
                    role: "tabpanel",
                    "aria-labelledby": e._tabsPanesId + "-tab-" + (e.position - 1),
                    "aria-expanded": "yes" === s.active
                } : Ue(e);
                if ("tabs-menu" === t) {
                    if ("tab" === o) return Ae(e);
                    if (!!o == !1) {
                        var i = e.ctx.attrs || {};
                        return !i.hasOwnProperty("role") && e._tabsMenuJs && (i.role = "menu"), i
                    }
                    return Ue(e)
                }
                if ("link" === t) return je(e);
                if ("radio-button" === t) {
                    var t = o;
                    if ("control" === t) {
                        var a = e._controlAttrs;
                        return a.disabled ? (a.disabled = "disabled", a.tabindex = "-1") : delete a.disabled, a.checked ? a.checked = "checked" : delete a.checked, a.type = "radio", a.name = e._radioButton.name, a
                    }
                    return "radio" === t ? {
                        "for": e._controlAttrs.id
                    } : Ue(e)
                }
                if ("select" === t) {
                    var t = o;
                    if ("group" === t) return {
                        role: "group",
                        "aria-labelledby": e._labelId
                    };
                    if ("control" === t) {
                        for (var l, c = ["id", "name", "tabindex"], d = {}; l = c.pop();) e._controlAttrs[l] && (d[l] = e._controlAttrs[l]);
                        return "yes" === r.disabled && (d.disabled = "disabled"), d.tabindex = -1, d["aria-hidden"] = !0, e.ctx.controlAttrs || d
                    }
                    return "item" === t ? Fe(e) : Ue(e)
                }
                if ("button" === t) return Ve(e);
                if ("check-button" === t) {
                    var t = o;
                    return "control" === t ? ze(e) : "text" === t ? {
                        id: e._control.labelledby
                    } : !!o == !1 ? {
                        "for": e._control.id
                    } : Ue(e)
                }
                if ("radiobox" === t) {
                    var t = o;
                    return "control" === t ? e._controlAttrs : "radio" === t ? {
                        "for": e._controlAttrs.id
                    } : Ue(e)
                }
                return Ue(e)
            }

            function Ae(e) {
                if (!(e.__$anflg49 !== !0) == !1) {
                    if (!(s && "yes" === s.active) == !1) {
                        if (!e._tabsMenuJs == !1) {
                            if (!!e._tabsMenuTabDisabled == !1) {
                                var t, i;
                                return e.extend((t = e.__$anflg49, e.__$anflg49 = !0, i = Ae(e), e.__$anflg49 = t, i), {
                                    tabindex: 0
                                })
                            }
                            return Le(e)
                        }
                        return Le(e)
                    }
                    return Le(e)
                }
                return Le(e)
            }

            function Le(e) {
                if (!(e.__$anflg46 !== !0) == !1) {
                    if (!(s && "yes" === s.disabled) == !1) {
                        var t, i;
                        return e.extend((t = e.__$anflg46, e.__$anflg46 = !0, i = Ae(e), e.__$anflg46 = t, i), {
                            "aria-disabled": !0
                        })
                    }
                    return Re(e)
                }
                return Re(e)
            }

            function Re(e) {
                var t = e.ctx.attrs || {};
                return !t.hasOwnProperty("role") && e._tabsMenuJs && (t.role = "menuitem"), t
            }

            function je(e) {
                if (!(e.__$anflg48 !== !0) == !1) {
                    if (!e._tabsMenuJs == !1) {
                        if (!!o == !1) {
                            var t, i, n = (t = e.__$anflg48, e.__$anflg48 = !0, i = je(e), e.__$anflg48 = t, i);
                            return delete n.tabindex, delete n.role, n
                        }
                        return Ue(e)
                    }
                    return Ue(e)
                }
                return Ue(e)
            }

            function Fe(e) {
                if (!(e.__$anflg37 !== !0) == !1) {
                    var t, i, n = (t = e.__$anflg37, e.__$anflg37 = !0, i = Fe(e), e.__$anflg37 = t, i || {});
                    return "yes" === (e.ctx.elemMods || {}).label && (n.id = e._labelId, n["aria-hidden"] = !0), n
                }
                return {
                    id: e.generateId()
                }
            }

            function Ve(e) {
                return !e._formSelect == !1 && !!o == !1 ? {
                    role: "listbox",
                    type: "button",
                    "aria-haspopup": !0,
                    "aria-expanded": !1
                } : Ue(e)
            }

            function ze(e) {
                if (!(e.__$anflg35 !== !0) == !1) {
                    if (!(r && "yes" === r.pseudo) == !1) {
                        var t, i, n = (t = e.__$anflg35, e.__$anflg35 = !0, i = ze(e), e.__$anflg35 = t, i);
                        return n.value = "", n
                    }
                    return He(e)
                }
                return He(e)
            }

            function He(e) {
                for (var t, i = e.ctx, n = {
                        type: "checkbox"
                    }, o = ["tabindex", "name", "value", "id"]; t = o.pop();) i[t] && (n[t] = i[t]);
                return i.checked && (n.checked = "checked"), i.disabled && (n.disabled = "disabled"), n["aria-labelledby"] = i.labelledby, n
            }

            function Ue(e) {
                return "item" === o && !("b-menu-vert" === n || "b-menu-horiz" === n) == !1 && !e._inDropdownMenu == !1 ? {
                    role: "menuitem"
                } : Ge(e)
            }

            function Ge(e) {
                return !("b-menu-vert" === n || "b-menu-horiz" === n) == !1 && !e._inDropdownMenu == !1 && !!o == !1 ? {
                    role: "menu"
                } : qe(e)
            }

            function qe(e) {
                var t = n;
                if ("notice" === t) return "count" === o && !e.ctx.url == !1 ? {
                    href: e.ctx.url
                } : We(e);
                if ("user" === t) return "icon" === o && !e.ctx._icon == !1 && !e._uid == !1 ? {
                    style: "background-image: url(" + e.ctx._icon + ");"
                } : Je(e);
                if ("image" === t) {
                    if (!!o == !1) {
                        var s, a = e.ctx,
                            l = {
                                src: "//yastatic.net/lego/_/La6qi18Z8LwgnZdsAr1qy1GwCwo.gif",
                                alt: ""
                            },
                            c = ["alt", "width", "height"];
                        for (a.url && (l.src = a.url); s = c.shift();) a[s] && (l[s] = a[s]);
                        return l
                    }
                    return Vt(e)
                }
                if ("input" === t) {
                    var t = o;
                    if ("control" === t) {
                        if (!(r && "textarea" === r.type) == !1) {
                            if (!!e._baseAttrsApplyed == !1) {
                                var d, u, h, m = (d = e._value, e._value = null, u = e._baseAttrsApplyed, e._baseAttrsApplyed = !0, h = Ge(e), e._value = d, e._baseAttrsApplyed = u, h);
                                return e._.extend(m, {
                                    rows: 10,
                                    cols: 10
                                })
                            }
                            return Ye(e)
                        }
                        return Ye(e)
                    }
                    return "hint" === t ? {
                        id: e._hintId,
                        "for": e._inputId,
                        "aria-hidden": !0
                    } : "clear" === t ? {
                        unselectable: "on"
                    } : Vt(e)
                }
                if ("checkbox" === t) {
                    var t = o;
                    if ("label" === t) {
                        var p = e.ctx.attrs || {};
                        return p["for"] = e._checkboxAttrs.id, p.id = e._labelId, p["aria-hidden"] = !0, p
                    }
                    if ("control" === t) {
                        var f = e.ctx.attrs || {};
                        return f.id = e._checkboxAttrs.id, f.type = "checkbox", f.autocomplete = "off", r.disabled && (f.disabled = "disabled"), "yes" == r.checked && (f.checked = "checked"), f["aria-labelledby"] = e._labelId, f
                    }
                    return Vt(e)
                }
                if ("auth" === t) {
                    var t = o;
                    if ("social-link" === t) return {
                        role: "button",
                        tabindex: 0,
                        title: e.ctx.title,
                        "aria-label": e.ctx.title
                    };
                    if ("social" === t) return {
                        role: "group",
                        "aria-label": BEM.I18N("auth", "social-log-in")
                    };
                    if ("retpath" === t) return {
                        type: "hidden",
                        name: "retpath",
                        value: e._retpath || ""
                    };
                    if (!!o == !1) {
                        var d, u;
                        return {
                            method: "POST",
                            action: e.ctx.url || (d = i, i = "action", u = jt(e), i = d, u),
                            role: "form",
                            "aria-label": BEM.I18N("auth", "auth")
                        }
                    }
                    return Vt(e)
                }
                if ("domik" === t) {
                    if (!(e.__$anflg8 !== !0) == !1) {
                        if (!(r && "popup" === r.type) == !1) {
                            if (!!o == !1) {
                                var d, u, g = (d = e.__$anflg8, e.__$anflg8 = !0, u = Ue(e), e.__$anflg8 = d, u || {});
                                return g.role = "dialog", g
                            }
                            return Vt(e)
                        }
                        return Vt(e)
                    }
                    return Vt(e)
                }
                if ("button" === t) {
                    if (!(e.__$anflg6 !== !0) == !1) {
                        if (!(r && "yes" === r.disabled) == !1) {
                            if (!!o == !1) {
                                var d, u, _ = e.ctx,
                                    b = {};
                                return _.url ? b["aria-disabled"] = !0 : b.disabled = "disabled", e.extend((d = e.__$anflg6, e.__$anflg6 = !0, u = Ve(e), e.__$anflg6 = d, u), b)
                            }
                            return $e(e)
                        }
                        return $e(e)
                    }
                    return $e(e)
                }
                if ("link" === t) {
                    if (!(e.__$anflg2 !== !0) == !1) {
                        if (!(r && "yes" === r.disabled) == !1) {
                            if (!!o == !1) {
                                var d, u;
                                return e.extend((d = e.__$anflg2, e.__$anflg2 = !0, u = je(e), e.__$anflg2 = d, u), {
                                    tabindex: -1,
                                    "aria-disabled": !0
                                })
                            }
                            return Ke(e)
                        }
                        return Ke(e)
                    }
                    return Ke(e)
                }
                return Vt(e)
            }

            function We(e) {
                return !!o == !1 ? {
                    role: "alert",
                    "aria-live": "assertive",
                    "aria-atomic": !0
                } : Vt(e)
            }

            function Je(e) {
                if (!!o == !1) {
                    var t = e["i-global"],
                        i = t.login && 0 === t.login.lastIndexOf("uid-", 0),
                        n = {
                            href: i ? t["social-host"] : t["passport-host"] + "/passport?mode=passport"
                        },
                        s = e.ctx.counter || (e.ctx.counters || {}).user;
                    return s && (n.onmousedown = s), n
                }
                return "enter-label" === o ? {
                    "aria-hidden": !0
                } : Vt(e)
            }

            function Ye(e) {
                var t = e._.extend({
                    id: e._inputId,
                    name: e._name
                }, e.ctx.controlAttrs);
                return (e._value || 0 === e._value) && (t.value = e._value), r.disabled && (t.disabled = "disabled"), e._live && (t.autocomplete = "off"), t["aria-labelledby"] = e._labelId + " " + e._hintId, t
            }

            function $e(e) {
                if (!(e.__$anflg5 !== !0) == !1) {
                    if (!!o == !1) {
                        if (!!e.ctx.url == !1) {
                            var t, i, n = e.ctx,
                                s = (t = e.__$anflg5, e.__$anflg5 = !0, i = Ve(e), e.__$anflg5 = t, i),
                                r = {
                                    type: n.type || "button",
                                    name: n.name,
                                    value: n.value
                                };
                            return e.extend(s, r)
                        }
                        return Qe(e)
                    }
                    return Qe(e)
                }
                return Qe(e)
            }

            function Qe(e) {
                if (!(e.__$anflg4 !== !0) == !1) {
                    if (!e.ctx.url == !1) {
                        if (!!o == !1) {
                            var t, i, n = e.ctx,
                                s = (t = e.__$anflg4, e.__$anflg4 = !0, i = Ve(e), e.__$anflg4 = t, i),
                                r = {
                                    href: n.url,
                                    target: n.target
                                };
                            return e.extend(s, r)
                        }
                        return Xe(e)
                    }
                    return Xe(e)
                }
                return Xe(e)
            }

            function Xe(e) {
                if (!!o == !1) {
                    var t = e.ctx,
                        i = {
                            role: "button"
                        };
                    return i.tabindex = t.tabindex, i
                }
                return Vt(e)
            }

            function Ke(e) {
                return !!o == !1 ? Ze(e) : Vt(e)
            }

            function Ze(e) {
                var t = e.ctx,
                    n = t.url,
                    o = {};
                if (["title", "target", "id", "tabindex"].forEach(function(e) {
                        t[e] && (o[e] = t[e])
                    }), n)
                    if (e.isSimple(n)) o.href = n;
                    else {
                        var s = [],
                            r = i;
                        i = "";
                        var a = e._buf;
                        e._buf = s;
                        var l = e.ctx;
                        e.ctx = n, Bt(e), i = r, e._buf = a, e.ctx = l, o.href = s.join("")
                    } else o.role = "button", o.tabindex || (o.tabindex = 0);
                return o
            }

            function et(e) {
                var t = n;
                if ("slider" === t) {
                    var t = o;
                    return "text" === t ? e._value : "runner" === t ? {
                        elem: "text"
                    } : !!o == !1 ? [e.ctx.content, {
                        elem: "body",
                        content: {
                            elem: "click"
                        }
                    }] : Vt(e)
                }
                if ("radiobox" === t) return "radio" === o ? st(e) : Vt(e);
                if ("b-autocomplete-item" === t) {
                    if (!(r && "lingvo" === r.type) == !1) {
                        if (!!o == !1) {
                            var a = e.ctx.data[1];
                            return [{
                                tag: "span",
                                elem: "text",
                                content: a.text
                            }, {
                                tag: "span",
                                elem: "translation",
                                content: [a.sampled ? "~" : "", a.translation]
                            }]
                        }
                        return rt(e)
                    }
                    return rt(e)
                }
                if ("b-menu-vert" === t) return !!o == !1 ? [e.ctx.title, {
                    elem: "layout",
                    content: e.ctx.content
                }] : Vt(e);
                if ("notice" === t) {
                    var t = o;
                    if ("value" === t) {
                        var l, c;
                        return l = i, i = "format-value", c = yt(e), i = l, c
                    }
                    return "text" === t ? BEM.I18N("notice", "notifications") : "count" === t ? [{
                        elem: "text"
                    }, {
                        elem: "value",
                        count: e.ctx.content
                    }] : !("undefined" != typeof e.ctx.count) == !1 && !!o == !1 ? {
                        elem: "count",
                        url: e.ctx.url,
                        content: e.ctx.count
                    } : Vt(e)
                }
                if ("check-button" === t) return !(r && "yes" === r["only-icon"]) == !1 && !!o == !1 ? [e._control, "&#160;", e.ctx.content] : ot(e);
                if ("input" === t) {
                    var t = o;
                    return "control" === t ? !(r && "textarea" === r.type) == !1 ? e.xmlEscape(e._value || e.ctx.content || "") : Vt(e) : "clear" === t ? !!e.ctx.content == !1 ? "" : Vt(e) : "box" === t ? ct(e) : "ahead" === t ? [{
                        elem: "ahead-filler"
                    }, {
                        elem: "ahead-hint"
                    }] : Vt(e)
                }
                if ("popup" === t) return dt(e);
                if ("checkbox" === t) return !!o == !1 ? [{
                    elem: "box",
                    tag: "span",
                    elemMods: "yes" === r.checked ? {
                        checked: "yes"
                    } : "",
                    content: [{
                        elem: "control",
                        attrs: e.ctx.checkboxAttrs || {}
                    }, {
                        elem: "tick",
                        tag: "i"
                    }]
                }, e.ctx.content] : Vt(e);
                if ("auth" === t) {
                    var t = o;
                    return "register" === t ? !!e.ctx.content == !1 ? {
                        block: "button",
                        mods: {
                            theme: "pseudo",
                            size: "s"
                        },
                        url: e.ctx.url || [e._passportHost, "/passport?mode=register", e._paramFrom, e._paramRetpath].join(""),
                        content: BEM.I18N("auth", "register")
                    } : ht(e) : "remember" === t ? !!e.ctx.content == !1 ? {
                        block: "button",
                        mods: {
                            theme: "pseudo",
                            size: "s"
                        },
                        url: e.ctx.url || [e._passportHost, "/passport?mode=restore", e._paramFrom, e._paramRetpath].join(""),
                        content: BEM.I18N("auth", "remember")
                    } : ht(e) : "button" === t ? !!e.ctx.content == !1 ? {
                        block: "button",
                        type: "submit",
                        mods: {
                            theme: "action",
                            size: "m"
                        },
                        content: BEM.I18N("auth", "logon")
                    } : ht(e) : "haunter" === t ? !!e.ctx.content == !1 ? {
                        block: "checkbox",
                        mods: {
                            theme: "normal",
                            size: "m"
                        },
                        checkboxAttrs: {
                            id: "auth-haunter",
                            autocomplete: "off",
                            name: "twoweeks",
                            value: "no"
                        },
                        content: {
                            elem: "label",
                            content: BEM.I18N("auth", "temporary")
                        }
                    } : ht(e) : "password" === t ? !!e.ctx.content == !1 ? {
                        block: "input",
                        mods: {
                            theme: "normal",
                            size: "m"
                        },
                        name: "passwd",
                        content: [{
                            elem: "hint",
                            content: BEM.I18N("auth", "password")
                        }, {
                            elem: "control",
                            attrs: {
                                type: "password",
                                maxlength: 256,
                                "aria-required": !0
                            }
                        }]
                    } : ht(e) : "username" === t && !!e.ctx.content == !1 ? {
                        block: "input",
                        mods: {
                            theme: "normal",
                            size: "m"
                        },
                        name: "login",
                        content: [{
                            elem: "hint",
                            content: BEM.I18N("auth", "login")
                        }, {
                            elem: "control",
                            attrs: {
                                "aria-required": !0
                            }
                        }]
                    } : ht(e)
                }
                if ("domik" === t) return !!o == !1 ? [{
                    elem: "roof",
                    content: [{
                        elem: "roof-border"
                    }, {
                        elem: "roof-body"
                    }, {
                        elem: "logo"
                    }]
                }, {
                    elem: "content",
                    content: e.ctx.content
                }] : Vt(e);
                if ("radio-button" === t) return "radio" === o ? !(s && "yes" === s["only-icon"]) == !1 ? [{
                    elem: "control"
                }, "&#160;", e.ctx.content] : [{
                    elem: "control"
                }, {
                    elem: "text",
                    tag: "span",
                    content: e.ctx.content
                }] : Vt(e);
                if ("button" === t) return "text" === o && !(r && "yes" === r["only-icon"]) == !1 ? ["&#160;", e.ctx.content] : mt(e);
                if ("tabs" === t) return !(r && "buttons" === r.control) == !1 && !!o == !1 ? tt(e) : it(e);
                if ("i-ua" === t) return pt(e);
                if ("user" === t) {
                    if ("name" === o) {
                        var l, c, d;
                        return l = i, i = "pre-content", c = e.ctx, e.ctx = e.xmlEscape(e.cleverSubstring(e._userName, e._maxLength, e._maxLengthRelative)), d = Dt(e), i = l, e.ctx = c, d
                    }
                    if (!!o == !1) {
                        var u = e["i-global"].login || (e["i-global"].displayName || {}).name;
                        return u ? [e.ctx.content] : {
                            elem: "enter"
                        }
                    }
                    return "enter-label" === o ? BEM.I18N("user", "enter") : Vt(e)
                }
                return Vt(e)
            }

            function tt(t) {
                var i, o = t.ctx,
                    s = t.extend({}, o.mods),
                    r = o.content.map(function(e, t) {
                        if ("tab" === e.elem) {
                            var n = "yes" === (e.elemMods || {}).active,
                                s = this.extend(e, {
                                    block: "radio-button",
                                    elem: "radio",
                                    attrs: this.extend({
                                        role: "tab",
                                        id: this._panesId + "-tab-" + t,
                                        "aria-selected": n
                                    }, e.attrs),
                                    mix: {
                                        block: o.block,
                                        elem: e.elem
                                    },
                                    controlAttrs: this.extend({
                                        value: t
                                    }, e.controlAttrs)
                                });
                            return n && (s.elemMods = this.extend({}, s.elemMods), delete s.elemMods.active, i = s.controlAttrs.value), s
                        }
                        return e
                    }, e(t));
                return t._tabsButtonIndex || (t._tabsButtonIndex = 0), delete s.control, {
                    block: "radio-button",
                    mix: {
                        block: n,
                        elem: "control"
                    },
                    mods: s,
                    value: i,
                    name: o.name || "tabs-menu-buttons-" + ++t._tabsButtonIndex,
                    attrs: {
                        role: "tablist"
                    },
                    content: r
                }
            }

            function it(e) {
                return !(r && "menu" === r.control) == !1 && !!o == !1 ? nt(e) : Vt(e)
            }

            function nt(t) {
                var i = t.ctx,
                    o = t.extend({}, i.mods),
                    s = i.content.map(function(e, t) {
                        return "tab" === e.elem ? this.extend(e, {
                            attrs: this.extend({
                                role: "tab",
                                id: this._panesId + "-tab-" + t,
                                "aria-selected": "yes" === (e.elemMods || {}).active
                            }, e.attrs),
                            mix: {
                                block: i.block,
                                elem: e.elem
                            },
                            content: {
                                block: "link",
                                content: e.content
                            }
                        }) : e
                    }, e(t));
                return delete o.control, {
                    block: "tabs-menu",
                    js: !0,
                    mix: {
                        block: n,
                        elem: "control"
                    },
                    attrs: {
                        role: "tablist"
                    },
                    mods: o,
                    content: s
                }
            }

            function ot(e) {
                return !!o == !1 ? [e._control, {
                    elem: "text",
                    tag: "span",
                    content: e.ctx.content
                }] : Vt(e)
            }

            function st(e) {
                if (!(e.__$anflg33 !== !0) == !1) {
                    var t, i;
                    return [{
                        elem: "box",
                        tag: "span",
                        content: {
                            elem: "control"
                        }
                    }, (t = e.__$anflg33, e.__$anflg33 = !0, i = st(e), e.__$anflg33 = t, i)]
                }
                return Vt(e)
            }

            function rt(t) {
                return !(r && "foot" === r.type) == !1 && !!o == !1 ? t.ctx.data.slice(1).map(function(e) {
                    return this._.isArray(e) ? {
                        tag: "span",
                        elem: "foot",
                        content: e[0]
                    } : e
                }, e(t)) : at(t)
            }

            function at(e) {
                return !(r && "nav" === r.type) == !1 && !!o == !1 ? {
                    elem: "link",
                    tag: "a",
                    attrs: {
                        href: e._url,
                        target: "_blank"
                    },
                    content: [{
                        elem: "link-url",
                        tag: "span",
                        content: e._linkUrlContent
                    }, {
                        elem: "link-info",
                        tag: "span",
                        content: e._linkInfoConten
                    }]
                } : lt(e)
            }

            function lt(e) {
                if (!!o == !1) {
                    var t = e.ctx.data,
                        i = BEM.blocks["i-common__string"],
                        n = i.escapeHTML(e._.isArray(t) ? t[1] : t);
                    return i.highlight(n, e.ctx.hl)
                }
                return Vt(e)
            }

            function ct(e) {
                if (!(e.__$anflg14 !== !0) == !1) {
                    if (!!r.clear == !1) {
                        var t, i;
                        return [(t = e.__$anflg14, e.__$anflg14 = !0, i = ct(e), e.__$anflg14 = t, i), {
                            elem: "clear",
                            elemMods: e._value || 0 === e._value ? {
                                visibility: "visible"
                            } : void 0
                        }]
                    }
                    return Vt(e)
                }
                return Vt(e)
            }

            function dt(e) {
                if (!(e.__$anflg18 !== !0) == !1) {
                    if (!(r && "yes" === r["has-close"]) == !1) {
                        if (!!o == !1) {
                            var t, i;
                            return [(t = e.__$anflg18, e.__$anflg18 = !0, i = dt(e), e.__$anflg18 = t, i), {
                                elem: "close"
                            }]
                        }
                        return ut(e)
                    }
                    return ut(e)
                }
                return ut(e)
            }

            function ut(e) {
                return !!o == !1 ? [{
                    elem: "under",
                    mods: e.ctx.underMods
                }, e.ctx.content] : Vt(e)
            }

            function ht(e) {
                if (!!o == !1) {
                    var t, n;
                    return [e.ctx.content || (t = i, i = "auto-content", n = Lt(e), i = t, n), {
                        elem: "retpath"
                    }]
                }
                return Vt(e)
            }

            function mt(e) {
                return !!o == !1 ? {
                    elem: "text",
                    tag: "span",
                    content: e.ctx.content
                } : Vt(e)
            }

            function pt(e) {
                if (!(e.__$anflg1 !== !0) == !1) {
                    if (!!o == !1) {
                        var t, i, n = (t = e.__$anflg1, e.__$anflg1 = !0, i = pt(e), e.__$anflg1 = t, i);
                        return n += [";(function(d,e,c,n,w,v,f){", "e=d.documentElement;", 'c="className";', 'n="createElementNS";', 'f="firstChild";', 'w="http://www.w3.org/2000/svg";', 'e[c]+=" i-ua_svg_"+(!!d[n]&&!!d[n](w,"svg").createSVGRect?"yes":"no");', 'v=d.createElement("div");', 'v.innerHTML="<svg/>";', 'e[c]+=" i-ua_inlinesvg_"+((v[f]&&v[f].namespaceURI)==w?"yes":"no");', "})(document);"].join("")
                    }
                    return ft(e)
                }
                return ft(e)
            }

            function ft(e) {
                return !!o == !1 ? [";(function(d,e,c,r){", "e=d.documentElement;", 'c="className";', 'r="replace";', 'e[c]=e[c][r]("i-ua_js_no","i-ua_js_yes");', 'if(d.compatMode!="CSS1Compat")', 'e[c]=e[c][r]("i-ua_css_standart","i-ua_css_quirks")', "})(document);"].join("") : Vt(e)
            }

            function gt(e) {
                var t = n;
                if ("slider" === t) {
                    var t = o;
                    return "text" === t ? "span" : "runner" === t ? "a" : Vt(e)
                }
                if ("b-autocomplete-item" === t) return !!o == !1 ? "li" : Vt(e);
                if ("b-menu-horiz" === t) return "item-selector" === o && !r == !1 ? "span" : Vt(e);
                if ("b-menu-vert" === t) {
                    var t = o;
                    return "title" === t ? "h3" : "submenu" === t ? "ul" : "item-selector" === t ? "span" : "layout-unit" === t ? "li" : "layout" === t ? "ul" : Vt(e)
                }
                if ("notice" === t) {
                    var t = o;
                    return "value" === t || "text" === t ? "span" : "count" === t ? !e.ctx.url == !1 ? "a" : "span" : !!o == !1 ? "span" : Vt(e)
                }
                if ("radiobox" === t) {
                    var t = o;
                    return "control" === t ? "input" : "radio" === t ? "label" : !!o == !1 ? "span" : Vt(e)
                }
                if ("image" === t) return !!o == !1 ? "img" : Vt(e);
                if ("input" === t) {
                    var t = o;
                    return "control" === t ? !(r && "textarea" === r.type) == !1 ? "textarea" : "input" : "hint" === t ? "label" : "clear" === t || "box" === t || "ahead-hint" === t || "ahead-filler" === t ? "span" : !!o == !1 ? "span" : Vt(e)
                }
                if ("popup" === t) {
                    var t = o;
                    return "close" === t || "tail" === t ? "i" : Vt(e)
                }
                if ("checkbox" === t) {
                    var t = o;
                    return "label" === t ? "label" : "control" === t ? "input" : !!o == !1 ? "span" : Vt(e)
                }
                if ("auth" === t) {
                    var t = o;
                    return "social-link" === t ? "a" : "social-icon" === t ? "i" : "retpath" === t ? "input" : !!o == !1 ? "form" : Vt(e)
                }
                if ("check-button" === t) return "control" === o ? "input" : !!o == !1 ? "label" : Vt(e);
                if ("domik" === t) {
                    var t = o;
                    return "logo" === t || "roof-body" === t || "roof-border" === t ? "i" : Vt(e)
                }
                if ("select" === t) {
                    var t = o;
                    return "control" === t ? "select" : "text" === t ? "span" : "option-group" === t ? "optgroup" : "option" === t ? "option" : !!o == !1 ? "span" : Vt(e)
                }
                if ("button" === t) return !e.ctx.url == !1 && !!o == !1 ? "a" : bt(e);
                if ("radio-button" === t) {
                    if (!!o == !1) return "span";
                    var t = o;
                    return "control" === t ? "input" : "radio" === t ? "label" : Vt(e)
                }
                if ("link" === t) return "inner" === o ? "span" : !!o == !1 ? e.ctx.url ? "a" : "span" : Vt(e);
                if ("tabs-menu" === t) return "tab" === o ? "li" : !!o == !1 ? "ul" : Vt(e);
                if ("i-ua" === t) return !!o == !1 ? "script" : Vt(e);
                if ("user" === t) {
                    var t = o;
                    return "icon" === t ? !e._uid == !1 ? "span" : _t(e) : "name" === t ? "span" : _t(e)
                }
                return Vt(e)
            }

            function _t(e) {
                return !!o == !1 ? "a" : "enter-label" === o ? "span" : Vt(e)
            }

            function bt(e) {
                return !!o == !1 ? "button" : Vt(e)
            }

            function yt(e) {
                var t, i, n = e.ctx;
                return t = parseInt(n.count, 10), i = n.maxCount ? n.maxCount : 99, t > i ? i + "+" : t
            }

            function vt(e) {
                if (!!e["i-services"]._data == !1) {
                    if (!!o == !1) {
                        var t, i = e["i-services"];
                        return i._data = {}, t = ii(e), t.kassa = function(e) {
                            return "http://kassa.yandex.ru/?source=metrika&_openstat=promo;metrika;tabs"
                        }, t
                    }
                    return Mt(e)
                }
                return Mt(e)
            }

            function Mt(e) {
                return !!o == !1 ? kt(e) : Vt(e)
            }

            function kt(e) {
                return {
                    serp: function(e) {
                        return "ru" === e ? "http://yandex.ru" : "ua" === e ? "http://yandex.ua" : "by" === e ? "http://yandex.by" : "kz" === e ? "http://yandex.kz" : "com" === e ? "http://www.yandex.com" : "tr" === e ? "http://www.yandex.com.tr" : "http://yandex.ru"
                    },
                    mail: function(e) {
                        return "ru" === e ? "https://mail.yandex.ru" : "ua" === e ? "https://mail.yandex.ua" : "by" === e ? "https://mail.yandex.by" : "kz" === e ? "https://mail.yandex.kz" : "com" === e ? "https://mail.yandex.com" : "tr" === e ? "https://mail.yandex.com.tr" : "https://mail.yandex.ru"
                    },
                    pdd: function(e) {
                        return "http://pdd.yandex.ru"
                    },
                    zakladki: function(e) {
                        return "http://zakladki.yandex.ru"
                    },
                    fotki: function(e) {
                        return "http://fotki.yandex.ru"
                    },
                    moikrug: function(e) {
                        return "http://moikrug.ru"
                    },
                    direct: function(e) {
                        return "ru" === e ? "http://direct.yandex.ru" : "ua" === e ? "http://direct.yandex.ua" : "by" === e ? "http://direct.yandex.by" : "kz" === e ? "http://direct.yandex.kz" : "com" === e ? "http://direct.yandex.com" : "http://direct.yandex.ru"
                    },
                    money: function(e) {
                        return "https://money.yandex.ru"
                    },
                    lenta: function(e) {
                        return "http://lenta.yandex.ru"
                    },
                    market: function(e) {
                        return "ru" === e ? "//market.yandex.ru" : "ua" === e ? "//market.yandex.ua" : "by" === e ? "//market.yandex.by" : "kz" === e ? "//market.yandex.kz" : "tr" === e ? "//market.yandex.com.tr" : "//market.yandex.ru"
                    },
                    "market.advertising": function(e) {
                        return "http://welcome.advertising.yandex.ru/market/"
                    },
                    wow: function(e) {
                        return "http://my.ya.ru"
                    },
                    tv: function(e) {
                        return "ru" === e ? "http://tv.yandex.ru" : "ua" === e ? "http://tv.yandex.ua" : "by" === e ? "http://tv.yandex.by" : "kz" === e ? "http://tv.yandex.kz" : "http://tv.yandex.ru"
                    },
                    afisha: function(e) {
                        return "ru" === e ? "http://afisha.yandex.ru" : "ua" === e ? "http://afisha.yandex.ua" : "by" === e ? "http://afisha.yandex.by" : "kz" === e ? "http://afisha.yandex.kz" : "tr" === e ? "http://afis.yandex.com.tr" : "http://afisha.yandex.ru"
                    },
                    calendar: function(e) {
                        return "http://calendar.yandex.ru"
                    },
                    nahodki: function(e) {
                        return "ru" === e ? "http://nahodki.yandex.ru" : "ua" === e ? "http://nahodki.yandex.ua" : "kz" === e ? "http://nahodki.yandex.kz" : "http://nahodki.yandex.ru"
                    },
                    weather: function(e) {
                        return "ru" === e ? "http://pogoda.yandex.ru" : "ua" === e ? "http://pogoda.yandex.ua" : "by" === e ? "http://pogoda.yandex.by" : "kz" === e ? "http://pogoda.yandex.kz" : "tr" === e ? "http://hava.yandex.com.tr" : "http://pogoda.yandex.ru"
                    },
                    kuda: function(e) {
                        return "http://kuda.yandex.ru"
                    },
                    video: function(e) {
                        return "ru" === e ? "http://www.yandex.ru/video/" : "ua" === e ? "http://www.yandex.ua/video/" : "by" === e ? "http://www.yandex.by/video/" : "kz" === e ? "http://www.yandex.kz/video/" : "com" === e ? "http://www.yandex.com/video/" : "tr" === e ? "http://www.yandex.com.tr/video/" : "http://yandex.ru/video/"
                    },
                    "video-com": function(e) {
                        return "http://video.yandex.com"
                    },
                    music: function(e) {
                        return "ru" === e ? "//music.yandex.ru" : "ua" === e ? "//music.yandex.ua" : "by" === e ? "//music.yandex.by" : "kz" === e ? "//music.yandex.kz" : "//music.yandex.ru"
                    },
                    "music-partner": function(e) {
                        return "http://music-partner.yandex.ru"
                    },
                    www: function(e) {
                        return "ru" === e ? "http://www.yandex.ru" : "ua" === e ? "http://www.yandex.ua" : "com" === e ? "http://www.yandex.com" : "by" === e ? "http://www.yandex.by" : "kz" === e ? "http://www.yandex.kz" : "tr" === e ? "http://www.yandex.com.tr" : "http://www.yandex.ru"
                    },
                    search: function(e) {
                        return "ru" === e ? "http://yandex.ru" : "ua" === e ? "http://yandex.ua" : "com" === e ? "http://yandex.com" : "by" === e ? "http://yandex.by" : "kz" === e ? "http://yandex.kz" : "tr" === e ? "http://yandex.com.tr" : "http://yandex.ru"
                    },
                    review: function(e) {
                        return "ru" === e ? "http://yandex.ru" : "ua" === e ? "http://yandex.ua" : "by" === e ? "http://yandex.by" : "kz" === e ? "http://yandex.kz" : "com" === e ? "http://www.yandex.com" : "tr" === e ? "http://www.yandex.com.tr" : "http://yandex.ru"
                    },
                    fresh: function(e) {
                        return "ru" === e ? "http://yandex.ru" : "ua" === e ? "http://yandex.ua" : "by" === e ? "http://yandex.by" : "kz" === e ? "http://yandex.kz" : "com" === e ? "http://www.yandex.com" : "tr" === e ? "http://www.yandex.com.tr" : "http://yandex.ru"
                    },
                    news: function(e) {
                        return "ru" === e ? "http://news.yandex.ru" : "ua" === e ? "http://news.yandex.ua" : "by" === e ? "http://news.yandex.by" : "kz" === e ? "http://news.yandex.kz" : "tr" === e ? "http://haber.yandex.com.tr" : "http://news.yandex.ru"
                    },
                    "news-com": function(e) {
                        return "http://news.yandex.com"
                    },
                    maps: function(e) {
                        return "ru" === e ? "//maps.yandex.ru" : "ua" === e ? "//maps.yandex.ua" : "tr" === e ? "//harita.yandex.com.tr" : "//maps.yandex.ru"
                    },
                    "maps-com": function(e) {
                        return "http://maps.yandex.com"
                    },
                    probki: function(e) {
                        return "ru" === e ? "http://probki.yandex.ru" : "ua" === e ? "http://probki.yandex.ua" : "http://probki.yandex.ru"
                    },
                    slovari: function(e) {
                        return "ru" === e ? "//slovari.yandex.ru" : "ua" === e ? "//slovari.yandex.ua" : "by" === e ? "//slovari.yandex.by" : "kz" === e ? "//slovari.yandex.kz" : "//slovari.yandex.ru"
                    },
                    images: function(e) {
                        return "ru" === e ? "http://www.yandex.ru/images/" : "ua" === e ? "http://www.yandex.ua/images/" : "by" === e ? "http://www.yandex.by/images/" : "kz" === e ? "http://www.yandex.kz/images/" : "com" === e ? "http://www.yandex.com/images/" : "tr" === e ? "http://www.yandex.com.tr/gorsel/" : "http://yandex.ru/images/"
                    },
                    "images-com": function() {
                        return "http://www.yandex.com/images/"
                    },
                    blogs: function(e) {
                        return "ru" === e ? "http://blogs.yandex.ru" : "ua" === e ? "http://blogs.yandex.ua" : "by" === e ? "http://blogs.yandex.by" : "kz" === e ? "http://blogs.yandex.kz" : "http://blogs.yandex.ru"
                    },
                    auto: function(e) {
                        return "ru" === e ? "http://auto.yandex.ru" : "ua" === e ? "http://auto.yandex.ua" : "http://auto.yandex.ru"
                    },
                    adresa: function(e) {
                        return "http://adresa.yandex.ru"
                    },
                    games: function(e) {
                        return "http://games.yandex.ru"
                    },
                    yaca: function(e) {
                        return "ru" === e ? "http://yaca.yandex.ru" : "ua" === e ? "http://yaca.yandex.ua" : "by" === e ? "http://yaca.yandex.by" : "http://yaca.yandex.ru"
                    },
                    rasp: function(e) {
                        return "ru" === e ? "http://rasp.yandex.ru" : "ua" === e ? "http://rasp.yandex.ua" : "by" === e ? "http://rasp.yandex.by" : "kz" === e ? "http://rasp.yandex.kz" : "tr" === e ? "http://seferler.yandex.com.tr" : "http://rasp.yandex.ru"
                    },
                    avia: function(e) {
                        return "ru" === e ? "https://avia.yandex.ru" : "ua" === e ? "https://avia.yandex.ua" : "https://avia.yandex.ru"
                    },
                    ticket: function(e) {
                        return "http://ticket.yandex.ru"
                    },
                    pvo: function(e) {
                        return "http://ask.yandex.ru"
                    },
                    online: function(e) {
                        return "http://online.yandex.ru"
                    },
                    books: function(e) {
                        return "http://books.yandex.ru"
                    },
                    site: function(e) {
                        return "ru" === e ? "http://site.yandex.ru" : "ua" === e ? "http://site.yandex.ua" : "tr" === e ? "http://ozel.yandex.com.tr" : "http://site.yandex.ru"
                    },
                    bar: function(e) {
                        return "ru" === e ? "http://bar.yandex.ru" : "ua" === e ? "http://bar.yandex.ua" : "by" === e ? "http://bar.yandex.by" : "kz" === e ? "http://bar.yandex.kz" : "tr" === e ? "http://bar.yandex.com.tr" : "http://bar.yandex.ru"
                    },
                    widgets: function(e) {
                        return "ru" === e ? "http://widgets.yandex.ru" : "ua" === e ? "http://widgets.yandex.ua" : "by" === e ? "http://widgets.yandex.by" : "kz" === e ? "http://widgets.yandex.kz" : "tr" === e ? "http://widgets.yandex.com.tr" : "http://widgets.yandex.ru"
                    },
                    wdgt: function(e) {
                        return "ru" === e ? "http://wdgt.yandex.ru" : "ua" === e ? "http://wdgt.yandex.ua" : "by" === e ? "http://wdgt.yandex.by" : "kz" === e ? "http://wdgt.yandex.kz" : "tr" === e ? "http://wdgt.yandex.com.tr" : "http://wdgt.yandex.ru"
                    },
                    interests: function(e) {
                        return "http://interests.yandex.ru"
                    },
                    kraski: function(e) {
                        return "http://kraski.yandex.ru"
                    },
                    local: function(e) {
                        return "http://local.yandex.ru"
                    },
                    museums: function(e) {
                        return "http://18.yandex.ru"
                    },
                    collection: function(e) {
                        return "http://collection.yandex.ru"
                    },
                    company: function(e) {
                        return "ru" === e ? "http://company.yandex.ru" : "com" === e ? "http://company.yandex.com" : "tr" === e ? "http://company.yandex.com.tr" : "http://company.yandex.ru"
                    },
                    tests: function(e) {
                        return "http://tests.yandex.ru"
                    },
                    referats: function(e) {
                        return "http://referats.yandex.ru"
                    },
                    terms: function(e) {
                        return "http://terms.yandex.ru"
                    },
                    tune: function(e) {
                        return "ru" === e ? "http://tune.yandex.ru" : "ua" === e ? "http://tune.yandex.ua" : "com" === e ? "http://tune.yandex.com" : "by" === e ? "http://tune.yandex.by" : "kz" === e ? "http://tune.yandex.kz" : "tr" === e ? "http://tune.yandex.com.tr" : "http://tune.yandex.ru"
                    },
                    api: function(e) {
                        return "ru" === e ? "http://api.yandex.ru" : "com" === e ? "http://api.yandex.com" : "http://api.yandex.ru"
                    },
                    punto: function(e) {
                        return "http://punto.yandex.ru"
                    },
                    opinion: function(e) {
                        return "http://opinion.yandex.ru"
                    },
                    perevod: function(e) {
                        return "http://perevod.yandex.ru"
                    },
                    rabota: function(e) {
                        return "ru" === e ? "http://rabota.yandex.ru" : "ua" === e ? "http://rabota.yandex.ua" : "by" === e ? "http://rabota.yandex.by" : "kz" === e ? "http://rabota.yandex.kz" : "http://rabota.yandex.ru"
                    },
                    sprav: function(e) {
                        return "ru" === e ? "http://sprav.yandex.ru" : "ua" === e ? "http://sprav.yandex.ua" : "by" === e ? "http://sprav.yandex.by" : "kz" === e ? "http://sprav.yandex.kz" : "tr" === e ? "http://rehber.yandex.com.tr" : "http://sprav.yandex.ru"
                    },
                    realty: function(e) {
                        return "ru" === e ? "http://realty.yandex.ru" : "ua" === e ? "http://realty.yandex.ua" : "by" === e ? "http://realty.yandex.by" : "kz" === e ? "http://realty.yandex.kz" : "http://realty.yandex.ru"
                    },
                    advertising: function(e) {
                        return "ru" === e ? "http://advertising.yandex.ru" : "ua" === e ? "http://advertising.yandex.ua" : "com" === e ? "http://advertising.yandex.com" : "by" === e ? "http://advertising.yandex.by" : "kz" === e ? "http://advertising.yandex.kz" : "http://advertising.yandex.ru"
                    },
                    expert: function(e) {
                        return "http://expert.yandex.ru"
                    },
                    "direct.market": function(e) {
                        return "http://partner.market.yandex.ru/yandex.market/"
                    },
                    ba: function(e) {
                        return "ru" === e ? "http://ba.yandex.ru" : "ua" === e ? "http://ba.yandex.ua" : "com" === e ? "http://ba.yandex.com" : "by" === e ? "http://ba.yandex.by" : "kz" === e ? "http://ba.yandex.kz" : "http://ba.yandex.ru"
                    },
                    bayan: function(e) {
                        return "http://bayan.yandex.ru"
                    },
                    partners: function(e) {
                        return "ru" === e ? "http://partner.yandex.ru" : "ua" === e ? "http://partner.yandex.ua" : "com" === e ? "http://partner.yandex.com" : "by" === e ? "http://partner.yandex.by" : "kz" === e ? "http://partner.yandex.kz" : "http://partner.yandex.ru"
                    },
                    metrika: function(e) {
                        return "ru" === e ? "https://metrika.yandex.ru" : "ua" === e ? "https://metrika.yandex.ua" : "com" === e ? "https://metrica.yandex.com" : "by" === e ? "https://metrika.yandex.by" : "kz" === e ? "https://metrika.yandex.kz" : "tr" === e ? "https://metrica.yandex.com.tr" : "https://metrika.yandex.ru"
                    },
                    balance: function(e) {
                        return "http://balance.yandex.ru"
                    },
                    wordstat: function(e) {
                        return "http://wordstat.yandex.ru"
                    },
                    webmaster: function(e) {
                        return "ru" === e ? "http://webmaster.yandex.ru" : "ua" === e ? "http://webmaster.yandex.ua" : "com" === e ? "http://webmaster.yandex.com" : "tr" === e ? "http://webmaster.yandex.com.tr" : "http://webmaster.yandex.ru"
                    },
                    server: function(e) {
                        return "http://company.yandex.ru/technology/server/"
                    },
                    stat: function(e) {
                        return "ru" === e ? "http://stat.yandex.ru" : "ua" === e ? "http://stat.yandex.ua" : "by" === e ? "http://stat.yandex.by" : "http://stat.yandex.ru"
                    },
                    mobile: function(e) {
                        return "ru" === e ? "http://mobile.yandex.ru" : "ua" === e ? "http://mobile.yandex.ua" : "tr" === e ? "http://mobil.yandex.com.tr" : "http://mobile.yandex.ru"
                    },
                    help: function(e) {
                        return "ru" === e ? "http://help.yandex.ru" : "ua" === e ? "http://help.yandex.ua" : "com" === e ? "http://help.yandex.com" : "tr" === e ? "http://yardim.yandex.com.tr" : "http://help.yandex.ru"
                    },
                    feedback: function(e) {
                        return "ru" === e ? "http://feedback.yandex.ru" : "ua" === e ? "http://feedback.yandex.ua" : "com" === e ? "http://feedback.yandex.com" : "by" === e ? "http://feedback.yandex.by" : "kz" === e ? "http://feedback.yandex.kz" : "tr" === e ? "http://contact.yandex.com.tr" : "http://feedback.yandex.ru"
                    },
                    feedback2: function(e) {
                        return "ru" === e ? "http://feedback2.yandex.ru" : "ua" === e ? "http://feedback2.yandex.ua" : "com" === e ? "http://feedback2.yandex.com" : "by" === e ? "http://feedback2.yandex.by" : "kz" === e ? "http://feedback2.yandex.kz" : "tr" === e ? "http://contact2.yandex.com.tr" : "http://feedback2.yandex.ru"
                    },
                    start: function(e) {
                        return "ru" === e ? "http://help.yandex.ru/start/" : "ua" === e ? "http://help.yandex.ua/start/" : "com" === e ? "http://help.yandex.com/start/" : "tr" === e ? "http://yardim.yandex.com.tr/start" : "http://help.yandex.ru/start/"
                    },
                    cityday: function(e) {
                        return "http://cityday.yandex.ru"
                    },
                    openid: function(e) {
                        return "http://openid.yandex.ru"
                    },
                    oauth: function(e) {
                        return "ru" === e ? "https://oauth.yandex.ru" : "com" === e ? "https://oauth.yandex.com" : "https://oauth.yandex.ru"
                    },
                    nano: function(e) {
                        return "http://nano.yandex.ru"
                    },
                    partnersearch: function(e) {
                        return "http://yandex.ru"
                    },
                    city: function(e) {
                        return "http://city.yandex.ru"
                    },
                    goroda: function(e) {
                        return "http://goroda.yandex.ru"
                    },
                    toster: function(e) {
                        return "http://toster.yandex.ru"
                    },
                    love: function(e) {
                        return "http://love.yandex.ru"
                    },
                    rk: function(e) {
                        return "http://rk.yandex.ru"
                    },
                    lost: function(e) {
                        return "http://lost.yandex.ru"
                    },
                    soft: function(e) {
                        return "ru" === e ? "http://soft.yandex.ru" : "ua" === e ? "http://soft.yandex.ua" : "tr" === e ? "http://soft.yandex.com.tr" : "http://soft.yandex.ru"
                    },
                    passport: function(e) {
                        return "ru" === e ? "https://passport.yandex.ru" : "com" === e ? "https://passport.yandex.com" : "tr" === e ? "https://passport.yandex.com.tr" : "https://passport.yandex.ru"
                    },
                    "maps-wiki": function(e) {
                        return "http://nk.yandex.ru"
                    },
                    404: function(e) {
                        return "ru" === e ? "http://404.yandex.ru" : "ua" === e ? "http://404.yandex.ua" : "com" === e ? "http://404.yandex.com" : "by" === e ? "http://404.yandex.by" : "kz" === e ? "http://404.yandex.kz" : "tr" === e ? "http://404.yandex.com.tr" : "http://404.yandex.ru"
                    },
                    i: function(e) {
                        return "http://i.yandex.ru"
                    },
                    desktop: function(e) {
                        return "http://desktop.yandex.ru"
                    },
                    ff: function(e) {
                        return "http://ff.yandex.ru"
                    },
                    fx: function(e) {
                        return "ru" === e ? "http://fx.yandex.ru" : "ua" === e ? "http://fx.yandex.ua" : "tr" === e ? "http://fx.yandex.com.tr" : "http://fx.yandex.ru"
                    },
                    ie: function(e) {
                        return "ru" === e ? "http://ie.yandex.ru" : "ua" === e ? "http://ie.yandex.ua" : "tr" === e ? "http://ie.yandex.com.tr" : "http://ie.yandex.ru"
                    },
                    "bar-ie": function(e) {
                        return "ru" === e ? "http://bar.yandex.ru/ie" : "ua" === e ? "http://bar.yandex.ua/ie" : "com" === e ? "http://bar.yandex.com/ie" : "by" === e ? "http://bar.yandex.by/ie" : "kz" === e ? "http://bar.yandex.kz/ie" : "tr" === e ? "http://bar.yandex.com.tr/ie" : "http://bar.yandex.ru/ie"
                    },
                    "bar-ie9": function(e) {
                        return "ru" === e ? "http://bar.yandex.ru/ie" : "ua" === e ? "http://bar.yandex.ua/ie" : "com" === e ? "http://bar.yandex.com/ie" : "by" === e ? "http://bar.yandex.by/ie" : "kz" === e ? "http://bar.yandex.kz/ie" : "tr" === e ? "http://bar.yandex.com.tr/ie" : "http://bar.yandex.ru/ie"
                    },
                    internet: function(e) {
                        return "ru" === e ? "http://internet.yandex.ru" : "com" === e ? "http://internet.yandex.com" : "tr" === e ? "http://internet.yandex.com.tr" : "http://internet.yandex.ru"
                    },
                    keyboard: function(e) {
                        return "http://www.yandex.ru/index_engl_qwerty.html"
                    },
                    metro: function(e) {
                        return "http://metro.yandex.ru"
                    },
                    pulse: function(e) {
                        return "ru" === e ? "http://blogs.yandex.ru/pulse" : "ua" === e ? "http://blogs.yandex.ua/pulse" : "by" === e ? "http://blogs.yandex.by/pulse" : "kz" === e ? "http://blogs.yandex.kz/pulse" : "http://blogs.yandex.ru/pulse"
                    },
                    school: function(e) {
                        return "http://school.yandex.ru"
                    },
                    so: function(e) {
                        return "http://so.yandex.ru"
                    },
                    time: function(e) {
                        return "ru" === e ? "http://time.yandex.ru" : "ua" === e ? "http://time.yandex.ua" : "com" === e ? "http://time.yandex.com" : "by" === e ? "http://time.yandex.by" : "kz" === e ? "http://time.yandex.kz" : "tr" === e ? "http://saat.yandex.com.tr" : "http://time.yandex.ru"
                    },
                    xmlsearch: function(e) {
                        return "ru" === e ? "http://xml.yandex.ru" : "ua" === e ? "http://xml.yandex.ua" : "com" === e ? "http://xml.yandex.com" : "by" === e ? "http://xml.yandex.by" : "kz" === e ? "http://xml.yandex.kz" : "tr" === e ? "http://xml.yandex.com.tr" : "http://xml.yandex.ru"
                    },
                    catalogwdgt: function(e) {
                        return "http://www.yandex.ru/catalog"
                    },
                    opera: function(e) {
                        return "ru" === e ? "http://opera.yandex.ru" : "tr" === e ? "http://opera.yandex.com.tr" : "http://opera.yandex.ru"
                    },
                    uslugi: function(e) {
                        return "http://uslugi.yandex.ru"
                    },
                    backapv: function(e) {
                        return "http://backapv.yandex.ru"
                    },
                    chrome: function(e) {
                        return "http://chrome.yandex.ru"
                    },
                    browser: function(e) {
                        return "ru" === e ? "//browser.yandex.ru" : "ua" === e ? "//browser.yandex.ua" : "com" === e ? "//browser.yandex.com" : "by" === e ? "//browser.yandex.by" : "kz" === e ? "//browser.yandex.kz" : "tr" === e ? "//browser.yandex.com.tr" : "//browser.yandex.ru"
                    },
                    aziada: function(e) {
                        return "http://aziada2011.yandex.kz"
                    },
                    translate: function(e) {
                        return "ru" === e ? "//translate.yandex.ru" : "ua" === e ? "//translate.yandex.ua" : "com" === e ? "//translate.yandex.com" : "by" === e ? "//translate.yandex.by" : "kz" === e ? "//translate.yandex.kz" : "tr" === e ? "//ceviri.yandex.com.tr" : "//translate.yandex.ru"
                    },
                    subs: function(e) {
                        return "http://subs.yandex.ru"
                    },
                    all: function(e) {
                        return "ru" === e ? "http://www.yandex.ru/all" : "ua" === e ? "http://www.yandex.ua/all" : "com" === e ? "http://www.yandex.com/all" : "by" === e ? "http://www.yandex.by/all" : "kz" === e ? "http://www.yandex.kz/all" : "tr" === e ? "http://www.yandex.com.tr/all" : "http://www.yandex.ru/all"
                    },
                    large: function(e) {
                        return "http://large.yandex.ru"
                    },
                    geocontext: function(e) {
                        return "http://geocontext.yandex.ru"
                    },
                    root: function(e) {
                        return "http://root.yandex.ru"
                    },
                    yamb: function(e) {
                        return "https://yamb.yandex.ru"
                    },
                    legal: function(e) {
                        return "ru" === e ? "http://legal.yandex.ru" : "ua" === e ? "http://legal.yandex.ua" : "com" === e ? "http://legal.yandex.com" : "tr" === e ? "http://legal.yandex.com.tr" : "http://legal.yandex.ru"
                    },
                    taxi: function(e) {
                        return "https://taxi.yandex.ru"
                    },
                    social: function(e) {
                        return "ru" === e ? "https://social.yandex.ru" : "ua" === e ? "https://social.yandex.ua" : "com" === e ? "https://social.yandex.ru" : "by" === e ? "https://social.yandex.by" : "kz" === e ? "https://social.yandex.kz" : "tr" === e ? "https://social.yandex.com.tr" : "https://social.yandex.ru"
                    },
                    contest: function(e) {
                        return "ru" === e ? "http://contest.yandex.ru" : "com" === e ? "http://contest.yandex.com" : "http://contest.yandex.ru"
                    },
                    peoplesearch: function(e) {
                        return "ru" === e ? "http://people.yandex.ru" : "ua" === e ? "http://people.yandex.ua" : "http://people.yandex.ru"
                    },
                    disk: function(e) {
                        return "ru" === e ? "https://disk.yandex.ru" : "com" === e ? "https://disk.yandex.com" : "ua" === e ? "https://disk.yandex.ua" : "kz" === e ? "https://disk.yandex.kz" : "by" === e ? "https://disk.yandex.by" : "tr" === e ? "https://disk.yandex.com.tr" : "https://disk.yandex.ru"
                    },
                    sport: function(e) {
                        return "ru" === e ? "http://sport.yandex.ru" : "by" === e ? "http://sport.yandex.by" : "ua" === e ? "http://sport.yandex.ua" : "kz" === e ? "http://sport.yandex.kz" : "tr" === e ? "http://spor.yandex.com.tr" : "http://sport.yandex.ru"
                    },
                    literacy: function(e) {
                        return "http://literacy.yandex.ru"
                    },
                    appsearch: function(e) {
                        return "//appsearch.yandex.ru"
                    },
                    ege: function(e) {
                        return "//ege.yandex.ru"
                    },
                    vno: function(e) {
                        return "//zno.yandex.ua"
                    },
                    notifications: function(e) {
                        return "ru" === e ? "https://notifications.yandex.ru" : "ua" === e ? "https://notifications.yandex.ua" : "by" === e ? "https://notifications.yandex.by" : "kz" === e ? "https://notifications.yandex.kz" : "com" === e ? "https://notifications.yandex.com" : "tr" === e ? "https://notifications.yandex.com.tr" : "https://notifications.yandex.ru"
                    },
                    kassa: function(e) {
                        return "ru" === e ? "https://money.yandex.ru/start" : "https://money.yandex.ru/start/"
                    },
                    shtrafi: function(e) {
                        return "ru" === e ? "https://money.yandex.net/debts" : "http://money.yandex.net/debts"
                    }
                }
            }

            function Bt(e) {
                return !e["i-global"] == !1 && !!e["i-services"] == !1 ? wt(e) : xt(e)
            }

            function wt(e) {
                var t, o, s, r = e["i-services"] = {},
                    a = e["i-global"];
                r._data = (t = n, n = "i-services", o = i, i = "service-url", s = vt(e), n = t, i = o, s), r.serviceName = function(e) {
                    return BEM.I18N("i-services", e || a.id)
                }, r.serviceUrl = function(e, t) {
                    return e || (e = a.id), r._data[e](t || a["content-region"])
                }, ii(e)
            }

            function xt(e) {
                return !e._ == !1 && !!e._.cleverSubstring == !1 ? (e._.cleverSubstring = function(e, t, i) {
                    return e.length > t + i ? e.substring(0, t - 1) + "…" : e
                }, void ii(e)) : Et(e)
            }

            function Et(e) {
                return "popup" === n && !e._popupDefaults == !1 && !!o == !1 ? (delete e._popupDefaults, void ii(e)) : Vt(e)
            }

            function Nt(e) {
                return "middle"
            }

            function It(e) {
                var t, n, o, s;
                return [(t = i, i = "host", n = St(e), i = t, n), "/get-yapic/", e._uid, "/islands-", (o = i, i = "iconSize", s = Nt(e), i = o, s), "?rnd=", +new Date].join("")
            }

            function St(e) {
                return "//avatars.yandex.net"
            }

            function Dt(e) {
                return e.ctx
            }

            function Ct(e) {
                return !e.isSimple(e.ctx) == !1 && !!o == !1 ? e.ctx : Tt(e)
            }

            function Tt(e) {
                if (!e.ctx == !1) {
                    if (!!o == !1) {
                        var t = [],
                            n = e._buf;
                        e._buf = t;
                        var s = i;
                        return i = "", Bt(e), e._buf = n, i = s, t.join("")
                    }
                    return Ot(e)
                }
                return Ot(e)
            }

            function Ot(e) {
                return !!o == !1 ? "" : Vt(e)
            }

            function Pt(e) {
                var t, n, o = (t = i, i = "live", n = At(e), i = t, n),
                    s = e.ctx.js,
                    r = e.ctx.mods,
                    a = {
                        autofocus: "yes",
                        width: "content",
                        "tap-ahead": "yes"
                    };
                if (s) {
                    if (s.autoFocus && s.live) throw new Error('input block can\'t have both "live" and "autoFocus" enabled');
                    s.hasOwnProperty("live") && (o = s.live);
                    var l = Object.keys(a).some(function(e) {
                        return r[e] === a[e]
                    });
                    (l || s.autoFocus) && (o = !1)
                }
                return o
            }

            function At(e) {
                return !1
            }

            function Lt(e) {
                return !!e.ctx.content == !1 && !!o == !1 ? [{
                    elem: "username"
                }, {
                    elem: "password"
                }, {
                    elem: "row",
                    mods: {
                        button: "yes"
                    },
                    content: [{
                        elem: "haunter"
                    }, {
                        elem: "button"
                    }]
                }, {
                    elem: "social"
                }, {
                    elem: "row",
                    content: [{
                        elem: "remember"
                    }, {
                        elem: "register"
                    }]
                }] : Rt(e)
            }

            function Rt(e) {
                return !!o == !1 ? [] : Vt(e)
            }

            function jt(e) {
                var t, i;
                return BEM && BEM.blocks ? (t = BEM.blocks["i-global"], i = t.param("passport-msg")) : (t = e["i-global"], i = t["passport-msg"]), [e._passportHost, "/auth?twoweeks=yes", i ? "&from=" + encodeURIComponent(i) : ""].join("")
            }

            function Ft(e) {
                return "i-ua" === n && !!o == !1 ? !1 : Vt(e)
            }

            function Vt(e) {
                return "i-global" === n ? zt(e) : Ht(e)
            }

            function zt(e) {
                return "lang" === o ? BEM.blocks["i-locale"].getLang() : Ht(e)
            }

            function Ht(e) {
                var t = i;
                if ("public-params" === t) return "i-global" === n ? "jsParams" === o ? !0 : !o == !1 ? {
                    id: 1,
                    lang: 1,
                    tld: 1,
                    "content-region": 1,
                    "user-region": 1,
                    login: 1,
                    displayName: 1,
                    index: 1,
                    yandexuid: 1,
                    "passport-host": 1,
                    "pass-host": 1,
                    "passport-msg": 1,
                    "static-host": 1,
                    "lego-static-host": 1,
                    "social-host": 1,
                    clck: 1,
                    "click-host": 1,
                    "export-host": 1,
                    "i-host": 1,
                    "social-retpath": 1,
                    "lego-path": 1,
                    sid: 1,
                    retpath: 1,
                    uid: 1
                }[o] || !1 : Wt(e) : Wt(e);
                if ("env" === t) return "i-global" === n && !!o == !1 ? {} : Wt(e);
                if ("" === t) return !!e["i-global"] == !1 ? qt(e) : Wt(e);
                if ("content" === t) return e.ctx.content;
                if ("default" === t) {
                    if ("i-global" === n) {
                        var t = o;
                        return "lego-static-host" === t ? "//yastatic.net/lego/2.10-142" : "export-host" === t ? "https://export.yandex.ru" : "social-host" === t ? "https://social.yandex.ru" : "pass-host" === t ? "https://pass.yandex.ru" : "passport-host" === t ? "https://passport.yandex.ru" : "click-host" === t ? "//clck.yandex.ru" : "content-region" === t || "tld" === t || "lang" === t ? "ru" : !o == !1 ? "" : !!o == !1 ? Gt(e) : Wt(e)
                    }
                    return Wt(e)
                }
                return "bem" === t || "jsAttr" === t || "js" === t || "cls" === t || "attrs" === t ? void 0 : "js-params" === t ? "b-page" === n && !!o == !1 ? Ut(e) : Wt(e) : "tag" === t || "mix" === t ? void 0 : Wt(e)
            }

            function Ut(e) {
                var t, s, r, a, l, c = e["i-global"],
                    d = {},
                    u = {
                        block: "i-global",
                        js: d
                    };
                for (l in c) c.hasOwnProperty(l) && (t = i, i = "public-params", s = n, n = "i-global", r = o, o = l, a = zt(e), i = t, n = s, o = r, a) && (d[l] = c[l]);
                return u
            }

            function Gt(e) {
                var t, i, n, o = e.ctx.params || {},
                    s = e["i-global"],
                    r = o.tld && o.tld !== s.tld;
                r && (t = o.tld, i = "tr" === t ? "yandex.com.tr" : "yandex." + t, n = -1 != ["ua", "by", "kz"].indexOf(t) ? "yandex.ru" : i, s["content-region"] = t, s["click-host"] = "//clck." + n, s["passport-host"] = "https://passport." + n, s["pass-host"] = "https://pass." + i, s["social-host"] = "https://social." + i, s["export-host"] = "https://export." + i);
                for (var a in o) s[a] = o[a]
            }

            function qt(e) {
                for (var t, s, r, a, l, c, d, u, h = {}, m = ["lang", "tld", "content-region", "click-host", "passport-host", "pass-host", "social-host", "export-host", "login", "lego-static-host"]; u = m.shift();) h[u] = (t = i, i = "default", s = n, n = "i-global", r = o, o = u, a = zt(e), i = t, n = s, o = r, a);
                e["i-global"] = e._.extend(h, (l = i, i = "env", c = n, n = "i-global", d = zt(e), i = l, n = c, d)), ii(e)
            }

            function Wt(e) {
                return !e.ctx == !1 && !e.ctx.link == !1 && !!e._.isSimple(e.ctx) == !1 ? Jt(e) : Yt(e)
            }

            function Jt(i) {
                function n() {
                    if ("no-follow" !== this.ctx.link) {
                        var e = this._links[this.ctx.link];
                        return __r0 = this.ctx, this.ctx = e, __r1 = t(ii, this), this.ctx = __r0, __r1
                    }
                }
                if (!a || !i._cacheLog) return n.call(e(i));
                var o = i._buf.slice(i._cachePos).join("");
                i._cachePos = i._buf.length, i._cacheLog.push(o, {
                    log: i._localLog.slice(),
                    link: i.ctx.link
                });
                var s = n.call(e(i));
                return i._cachePos = i._buf.length, s
            }

            function Yt(e) {
                return !a == !1 && !e.ctx == !1 && !e.ctx.cache == !1 ? $t(e) : Qt(e)
            }

            function $t(t) {
                function i(e, t, i) {
                    if (0 !== t.length) {
                        if (Array.isArray(i)) {
                            for (var n = e, o = 0; o < i.length - 1; o++) n = n[i[o]];
                            i = n[i[o]]
                        }
                        for (var s, r = e, o = 0; o < t.length - 1; o++) r = r[t[o]];
                        return s = r[t[o]], r[t[o]] = i, s
                    }
                }
                var n;
                if (n = a.get(t.ctx.cache)) {
                    var o = t._links;
                    t.ctx.links && (t._links = t.ctx.links);
                    for (var s = 0; s < n.log.length; s++)
                        if ("string" != typeof n.log[s]) {
                            var r, l = n.log[s];
                            r = l.log.map(function(e) {
                                return {
                                    key: e[0],
                                    value: i(this, e[0], e[1])
                                }
                            }, e(t)).reverse();
                            var d = t.ctx,
                                u = d.cache;
                            d.cache = null;
                            var h = t._cacheLog;
                            t._cacheLog = null;
                            var m = t.ctx,
                                p = m.link;
                            m.link = l.link, c(t), d.cache = u, t._cacheLog = h, m.link = p, r.forEach(function(e) {
                                i(this, e.key, e.value)
                            }, e(t))
                        } else t._buf.push(n.log[s]);
                    return t._links = o, n.res
                }
                var f, g = [],
                    _ = t.ctx,
                    b = _.cache;
                _.cache = null;
                var y = t._cachePos;
                t._cachePos = t._buf.length;
                var v = t._cacheLog;
                t._cacheLog = g;
                var M = t._localLog;
                t._localLog = [], f = c(t);
                var k = t._buf.slice(t._cachePos).join("");
                return k && g.push(k), _.cache = b, t._cachePos = y, t._cacheLog = v, t._localLog = M, a.set(t.ctx.cache, {
                    log: g,
                    res: f
                }), f
            }

            function Qt(e) {
                var t = i;
                if ("default" === t) return Xt(e);
                if ("" === t) {
                    if (!e._.isSimple(e.ctx) == !1) {
                        e._listLength--;
                        var n = e.ctx;
                        return void((n && n !== !0 || 0 === n) && e._buf.push(n))
                    }
                    return !!e.ctx == !1 ? void e._listLength-- : !e._.isArray(e.ctx) == !1 ? Kt(e) : Zt(e)
                }
                return ei(e)
            }

            function Xt(e) {
                function t(e, t) {
                    return (e || "") + "__" + (t || "")
                }
                var a, l, c, u, h, m, p, f, g, _, b, y, v, M, k, B, w, x, E, N, I, S, D, C = e.BEM,
                    T = e.ctx,
                    O = e._buf;
                if (l = i, i = "tag", y = gt(e), i = l, D = y, "undefined" != typeof D || (D = T.tag), "undefined" != typeof D || (D = "div"), D) {
                    var P, A;
                    n && T.js !== !1 && (c = i, i = "js", u = d(e), i = c, A = u, A = A ? e._.extend(T.js, A === !0 ? {} : A) : T.js === !0 ? {} : T.js, A && ((P = {})[C.INTERNAL.buildClass(n, T.elem)] = A)), O.push("<", D);
                    var L = (h = i, i = "bem", m = Ft(e), i = h, m);
                    "undefined" != typeof L || (L = "undefined" != typeof T.bem ? T.bem : T.block || T.elem);
                    var R = (p = i, i = "cls", f = Vt(e), i = p, f);
                    R || (R = T.cls);
                    var j = T.block && P && !T.elem;
                    if (L || R) {
                        if (O.push(' class="'), L) {
                            C.INTERNAL.buildClasses(n, T.elem, T.elemMods || T.mods, O);
                            var F = (g = i, i = "mix", _ = Se(e), i = g, _);
                            if (T.mix && (F = F ? [].concat(F, T.mix) : T.mix), F) {
                                var V = {};
                                V[t(n, o)] = !0, e._.isArray(F) || (F = [F]);
                                for (var z = 0; z < F.length; z++) {
                                    var H = F[z];
                                    if (H) {
                                        var U = H.block || H.elem,
                                            G = H.block || H._block || n,
                                            q = H.elem || H._elem || o,
                                            W = H.mods || r,
                                            J = H.elemMods || {};
                                        if (U && O.push(" "), C.INTERNAL[U ? "buildClasses" : "buildModsClasses"](G, H.elem || H._elem || (H.block ? void 0 : o), H.elemMods || H.mods, O), H.js && ((P || (P = {}))[C.INTERNAL.buildClass(G, H.elem)] = H.js === !0 ? {} : H.js,
                                                j || (j = G && !H.elem)), U && !V[t(G, q)]) {
                                            V[t(G, q)] = !0;
                                            var Y = (b = n, n = G, a = o, o = q, v = r, r = W, M = s, s = J, k = i, i = "mix", B = Se(e), n = b, o = a, r = v, s = M, i = k, B);
                                            if (Y)
                                                for (var $ = 0; $ < Y.length; $++) {
                                                    var Q = Y[$];
                                                    (Q.block || Q.elem) && V[t(Q.block, Q.elem)] || (Q._block = G, Q._elem = q, F.splice(z + 1, 0, Q))
                                                }
                                        }
                                    }
                                }
                            }
                        }
                        R && O.push(L ? " " : "", R), j && O.push(" i-bem"), O.push('"')
                    }
                    if (P) {
                        var X = (w = i, i = "jsAttr", x = Vt(e), i = w, x);
                        O.push(" ", X || "data-bem", '="', e._.attrEscape(JSON.stringify(P)), '"')
                    }
                    var K = (E = i, i = "attrs", N = Pe(e), i = E, N);
                    if (K = e._.extend(K, T.attrs)) {
                        var Z;
                        for (Z in K) void 0 !== K[Z] && O.push(" ", Z, '="', e._.attrEscape(K[Z]), '"')
                    }
                }
                if (e._.isShortTag(D)) O.push("/>");
                else {
                    D && O.push(">");
                    var ee = (I = i, i = "content", S = et(e), i = I, S);
                    if (ee || 0 === ee) {
                        var L = n || o,
                            te = e._notNewList;
                        e._notNewList = !1;
                        var ie = e.position;
                        e.position = L ? 1 : e.position;
                        var ne = e._listLength;
                        e._listLength = L ? 1 : e._listLength;
                        var oe = e.ctx;
                        e.ctx = ee;
                        var se = i;
                        i = "", Bt(e), e._notNewList = te, e.position = ie, e._listLength = ne, e.ctx = oe, i = se
                    }
                    D && O.push("</", D, ">")
                }
            }

            function Kt(e) {
                var t = e.ctx,
                    i = t.length,
                    n = 0,
                    o = e.position,
                    s = e._notNewList;
                for (s ? e._listLength += i - 1 : (e.position = 0, e._listLength = i), e._notNewList = !0; i > n;) {
                    var r = t[n++],
                        a = e.ctx;
                    e.ctx = null == r ? "" : r, Bt(e), e.ctx = a
                }
                s || (e.position = o)
            }

            function Zt(e) {
                var t = e.ctx.block,
                    a = e.ctx.elem,
                    l = e._currBlock || n;
                e.ctx || (e.ctx = {});
                var c = i;
                i = "default";
                var d = e._links;
                e._links = e.ctx.links || e._links;
                var u = n;
                n = t || (a ? l : void 0);
                var h = e._currBlock;
                e._currBlock = t || a ? void 0 : l;
                var m = o;
                o = e.ctx.elem;
                var f = r;
                r = t ? e.ctx.mods || (e.ctx.mods = {}) : r;
                var g = s;
                s = e.ctx.elemMods || {}, n || o ? e.position = (e.position || 0) + 1 : e._listLength--, p(e), i = c, e._links = d, n = u, e._currBlock = h, o = m, r = f, s = g
            }

            function ei(e) {
                throw new Error(this)
            }

            function ti(e) {
                return ii(e || this)
            }

            function ii(e) {
                return c(e)
            }
            return ! function() {
                ! function(e, t) {
                    if (!t.I18N) {
                        e.BEM = t;
                        var i = t.I18N = function(e, t) {
                            return t
                        };
                        i.keyset = function() {
                            return i
                        }, i.key = function(e) {
                            return e
                        }, i.lang = function() {}
                    }
                }(this, "undefined" == typeof BEM ? {} : BEM)
            }(), ! function() {
                function e(e, t) {
                    this.ctx = null === typeof e ? "" : e, this.apply = t, this._buf = [], this._ = this, this._start = !0, this._listLength = 0, this._notNewList = !1, this.position = 0
                }
                var t = {},
                    i = Object.prototype.toString,
                    n = {
                        area: 1,
                        base: 1,
                        br: 1,
                        col: 1,
                        command: 1,
                        embed: 1,
                        hr: 1,
                        img: 1,
                        input: 1,
                        keygen: 1,
                        link: 1,
                        meta: 1,
                        param: 1,
                        source: 1,
                        wbr: 1
                    };
                ! function(e, t) {
                    function i(e, t, i) {
                        i.push(s, e, s, t)
                    }

                    function n(e, t, n, o) {
                        o.push(e), n && i(t, n, o)
                    }

                    function o(e, o, s, a, l) {
                        n(e, t, t, l), l.push(r, o), a && i(s, a, l)
                    }
                    var s = "_",
                        r = "__",
                        a = "[a-zA-Z0-9-]+";
                    e.INTERNAL = {
                        NAME_PATTERN: a,
                        MOD_DELIM: s,
                        ELEM_DELIM: r,
                        buildModPostfix: function(e, t, n) {
                            var o = n || [];
                            return i(e, t, o), n ? o : o.join("")
                        },
                        buildClass: function(e, i, s, r, a) {
                            var l = typeof s;
                            if ("string" == l ? "string" != typeof r && (a = r, r = s, s = i, i = t) : "undefined" != l ? (a = s, s = t) : i && "string" != typeof i && (a = i, i = t), !(i || s || a)) return e;
                            var c = a || [];
                            return i ? o(e, i, s, r, c) : n(e, s, r, c), a ? c : c.join("")
                        },
                        buildModsClasses: function(e, t, i, s) {
                            var r = s || [];
                            if (i) {
                                var a;
                                for (a in i)
                                    if (i.hasOwnProperty(a)) {
                                        var l = i[a];
                                        null != l && (l = i[a] + "", l && (r.push(" "), t ? o(e, t, a, l, r) : n(e, a, l, r)))
                                    }
                            }
                            return s ? r : r.join("")
                        },
                        buildClasses: function(e, i, s, r) {
                            var a = r || [];
                            return i ? o(e, i, t, t, a) : n(e, t, t, a), this.buildModsClasses(e, i, s, r), r ? a : a.join("")
                        }
                    }
                }(t);
                var o = function() {
                    var e = {
                            '"': "&quot;",
                            "&": "&amp;",
                            "<": "&lt;",
                            ">": "&gt;"
                        },
                        t = function(t) {
                            return e[t] || t
                        };
                    return function(e) {
                        return e = new RegExp(e, "g"),
                            function(i) {
                                return ("" + i).replace(e, t)
                            }
                    }
                }();
                e.prototype.isArray = function(e) {
                    return "[object Array]" === i.call(e)
                }, e.prototype.isSimple = function(e) {
                    var t = typeof e;
                    return "string" === t || "number" === t || "boolean" === t
                }, e.prototype.isShortTag = function(e) {
                    return n.hasOwnProperty(e)
                }, e.prototype.extend = function(e, t) {
                    if (!e || !t) return e || t;
                    var i, n = {};
                    for (i in e) e.hasOwnProperty(i) && (n[i] = e[i]);
                    for (i in t) t.hasOwnProperty(i) && (n[i] = t[i]);
                    return n
                }, e.prototype.identify = function() {
                    var e = 0,
                        i = t.__id = +new Date,
                        n = "__" + i,
                        o = function() {
                            return "uniq" + i + ++e
                        };
                    return function(e, t) {
                        return e ? t || e[n] ? e[n] : e[n] = o() : o()
                    }
                }(), e.prototype.xmlEscape = o("[&<>]"), e.prototype.attrEscape = o('["&<>]'), e.prototype.BEM = t, e.prototype.isFirst = function() {
                    return 1 === this.position
                }, e.prototype.isLast = function() {
                    return this.position === this._listLength
                }, e.prototype.generateId = function() {
                    return this.identify(this.ctx)
                }, l.apply = e.apply = function() {
                    var t = new e(this, ti);
                    return t.apply(), t._buf.join("")
                }
            }(), l
        }("undefined" == typeof l ? {} : l);
    return function(e) {
        var t = this;
        return e || (e = {}), a = e.cache,
            function() {
                return t === this ? (t = void 0, i = "", n = "", o = "", s = "", r = "") : (i = "", n = "", o = "", s = "", r = ""), c.apply.call([t])
            }.call(null)
    }
}();
"undefined" == typeof exports || (exports.BEMHTML = BEMHTML), $.fn.disabled = function(e) {
        return "undefined" == typeof e ? this.length ? this[0].disabled : null : (this.each(function() {
            if (this.disabled = e, this.id) {
                var t = $("label[for=" + this.id + "]");
                e ? t.addClass("b-label_disabled_true") : t.removeClass("b-label_disabled_true")
            }
        }), this)
    }, $.fn.numeratorText = function(e) {
        var t = "undefined" == typeof e ? 1 : e;
        return this.each(function() {
            $("span.numerator", this).each(function() {
                $(this).text(t)
            }), t++
        }), this
    },
    function(e, t) {
        if (!e.jQuery) {
            var i = function(e, t) {
                    return new i.fn.init(e, t)
                },
                n = Object.prototype.toString,
                o = Object.prototype.hasOwnProperty;
            Array.prototype.push, Array.prototype.slice, Array.prototype.indexOf;
            i.fn = i.prototype = {
                init: function() {
                    return this
                }
            }, i.fn.init.prototype = i.fn, i.Event = function(e, t) {
                return this instanceof i.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.returnValue === !1 || e.getPreventDefault && e.getPreventDefault() ? returnTrue : returnFalse) : this.type = e, t && i.extend(this, t), this.timeStamp = e && e.timeStamp || i.now(), void(this[i.expando] = !0)) : new i.Event(e, t)
            }, i.extend = i.fn.extend = function() {
                var e, n, o, s, r = arguments[0] || {},
                    a = 1,
                    l = arguments.length,
                    c = !1;
                for ("boolean" == typeof r && (c = r, r = arguments[1] || {}, a = 2), "object" == typeof r || i.isFunction(r) || (r = {}), l === a && (r = this, --a); l > a; a++)
                    if (null != (e = arguments[a]))
                        for (n in e)
                            if (o = r[n], s = e[n], r !== s)
                                if (c && s && (i.isPlainObject(s) || i.isArray(s))) {
                                    var d = o && (i.isPlainObject(o) || i.isArray(o)) ? o : i.isArray(s) ? [] : {};
                                    r[n] = i.extend(c, d, s)
                                } else s !== t && (r[n] = s);
                return r
            }, i.extend({
                isFunction: function(e) {
                    return "[object Function]" === n.call(e)
                },
                isArray: function(e) {
                    return "[object Array]" === n.call(e)
                },
                isPlainObject: function(e) {
                    if (!e || "[object Object]" !== n.call(e) || e.nodeType || e.setInterval) return !1;
                    if (e.constructor && !o.call(e, "constructor") && !o.call(e.constructor.prototype, "isPrototypeOf")) return !1;
                    var i;
                    for (i in e);
                    return i === t || o.call(e, i)
                },
                isEmptyObject: function(e) {
                    for (var t in e) return !1;
                    return !0
                },
                each: function(e, n, o) {
                    var s, r = 0,
                        a = e.length,
                        l = a === t || i.isFunction(e);
                    if (o)
                        if (l) {
                            for (s in e)
                                if (n.apply(e[s], o) === !1) break
                        } else
                            for (; a > r && n.apply(e[r++], o) !== !1;);
                    else if (l) {
                        for (s in e)
                            if (n.call(e[s], s, e[s]) === !1) break
                    } else
                        for (var c = e[0]; a > r && n.call(c, r, c) !== !1; c = e[++r]);
                    return e
                },
                inArray: function(e, t) {
                    if (t.indexOf) return t.indexOf(e);
                    for (var i = 0, n = t.length; n > i; i++)
                        if (t[i] === e) return i;
                    return -1
                },
                merge: function(e, i) {
                    var n = e.length,
                        o = 0;
                    if ("number" == typeof i.length)
                        for (var s = i.length; s > o; o++) e[n++] = i[o];
                    else
                        for (; i[o] !== t;) e[n++] = i[o++];
                    return e.length = n, e
                },
                grep: function(e, t, i) {
                    for (var n = [], o = 0, s = e.length; s > o; o++) !i != !t(e[o], o) && n.push(e[o]);
                    return n
                },
                now: function() {
                    return (new Date).getTime()
                },
                map: function(e, t, i) {
                    for (var n, o = [], s = 0, r = e.length; r > s; s++) n = t(e[s], s, i), null != n && (o[o.length] = n);
                    return o.concat.apply([], o)
                },
                browser: {},
                event: {
                    special: {}
                }
            }), e.jQuery = e.$ = i
        }
    }(function() {
        return this
    }()),
    function(e) {
        function t(t, n, o) {
            var r = !1;
            if (s) {
                var a = [];
                e.each(l, function() {
                    o.hasOwnProperty(this) && (r = !0) && a.push({
                        name: this,
                        val: o[this]
                    })
                }), r && (e.each(o, function(e) {
                    a.push({
                        name: e,
                        val: this
                    })
                }), o = a)
            }
            e.each(o, function(o, s) {
                if (r && (o = s.name, s = s.val), e.isFunction(s) && (!i || s.toString().indexOf(".__base") > -1)) {
                    var a = t[o] || function() {};
                    n[o] = function() {
                        var e = this.__base;
                        this.__base = a;
                        var t = s.apply(this, arguments);
                        return this.__base = e, t
                    }
                } else n[o] = s
            })
        }
        var i = function() {
                "_"
            }.toString().indexOf("_") > -1,
            n = function() {},
            o = Object.create || function(e) {
                var t = function() {};
                return t.prototype = e, new t
            },
            s = !0,
            r = {
                toString: ""
            };
        for (var a in r) r.hasOwnProperty(a) && (s = !1);
        var l = s ? ["toString", "valueOf"] : null;
        e.inherit = function() {
            var i = arguments,
                s = e.isFunction(i[0]),
                r = s ? i[0] : n,
                a = i[s ? 1 : 0] || {},
                l = i[s ? 2 : 1],
                c = a.__constructor || s && r.prototype.__constructor ? function() {
                    return this.__constructor.apply(this, arguments)
                } : function() {};
            if (!s) return c.prototype = a, c.prototype.__self = c.prototype.constructor = c, e.extend(c, l);
            e.extend(c, r);
            var d = r.prototype,
                u = c.prototype = o(d);
            return u.__self = u.constructor = c, t(d, u, a), l && t(r, c, l), c
        }, e.inheritSelf = function(e, i, n) {
            var o = e.prototype;
            return t(o, o, i), n && t(e, e, n), e
        }
    }(jQuery),
    function(e) {
        var t = 0,
            i = "__" + +new Date,
            n = function() {
                return "uniq" + ++t
            };
        e.identify = function(e, t) {
            if (!e) return n();
            var o = "uniqueID" in e ? "uniqueID" : i;
            return t || o in e ? e[o] : e[o] = n()
        }
    }(jQuery),
    function(e) {
        e.isEmptyObject || (e.isEmptyObject = function(e) {
            for (var t in e) return !1;
            return !0
        })
    }(jQuery),
    function(e) {
        e.extend({
            debounce: function(e, t, i, n) {
                3 == arguments.length && "boolean" != typeof i && (n = i, i = !1);
                var o;
                return function() {
                    var s = arguments;
                    n = n || this, i && !o && e.apply(n, s), clearTimeout(o), o = setTimeout(function() {
                        i || e.apply(n, s), o = null
                    }, t)
                }
            },
            throttle: function(e, t, i) {
                var n, o, s;
                return function() {
                    o = arguments, s = !0, i = i || this, n || function() {
                        s ? (e.apply(i, o), s = !1, n = setTimeout(arguments.callee, t)) : n = null
                    }()
                }
            }
        })
    }(jQuery),
    function(e) {
        var t = "__" + +new Date + "storage",
            i = function(t, i) {
                return e.identify(t) + (i ? e.identify(i) : "")
            },
            n = {
                buildEventName: function(e) {
                    return e
                },
                on: function(n, o, s, r, a) {
                    if ("string" == typeof n) {
                        e.isFunction(o) && (r = s, s = o, o = void 0);
                        for (var l, c = i(s, r), d = this[t] || (this[t] = {}), u = n.split(" "), h = 0; n = u[h++];)
                            if (n = this.buildEventName(n), l = d[n] || (d[n] = {
                                    ids: {},
                                    list: {}
                                }), !(c in l.ids)) {
                                var m = l.list,
                                    p = {
                                        fn: s,
                                        data: o,
                                        ctx: r,
                                        special: a
                                    };
                                m.last ? (m.last.next = p, p.prev = m.last) : m.first = p, l.ids[c] = m.last = p
                            }
                    } else {
                        var f = this;
                        e.each(n, function(e, t) {
                            f.on(e, t, o, a)
                        })
                    }
                    return this
                },
                onFirst: function(e, t, i, n) {
                    return this.on(e, t, i, n, {
                        one: !0
                    })
                },
                un: function(n, o, s) {
                    if ("string" == typeof n || "undefined" == typeof n) {
                        var r = this[t];
                        if (r)
                            if (n) {
                                for (var a, l = n.split(" "), c = 0; n = l[c++];)
                                    if (n = this.buildEventName(n), a = r[n])
                                        if (o) {
                                            var d = i(o, s),
                                                u = a.ids;
                                            if (d in u) {
                                                var h = a.list,
                                                    m = u[d],
                                                    p = m.prev,
                                                    f = m.next;
                                                p ? p.next = f : m === h.first && (h.first = f), f ? f.prev = p : m === h.last && (h.last = p), delete u[d]
                                            }
                                        } else delete this[t][n]
                            } else delete this[t]
                    } else {
                        var g = this;
                        e.each(n, function(e, t) {
                            g.un(e, t, s)
                        })
                    }
                    return this
                },
                trigger: function(i, n) {
                    var o, s = this,
                        r = s[t];
                    if ("string" == typeof i ? i = e.Event(s.buildEventName(o = i)) : i.type = s.buildEventName(o = i.type), i.target || (i.target = s), r && (r = r[i.type]))
                        for (var a, l = r.list.first; l;) i.data = l.data, a = l.fn.call(l.ctx || s, i, n), "undefined" != typeof a && (i.result = a, a === !1 && (i.preventDefault(), i.stopPropagation())), l.special && l.special.one && s.un(o, l.fn, l.ctx), l = l.next;
                    return this
                }
            };
        e.observable = e.inherit(n, n)
    }(jQuery), setTimeout(function() {
        BEM.decl("i-bem", {}, {
            toModVal: function(e) {
                return String(e).toLowerCase().replace(/[^a-z\-\d]/g, "-")
            }
        })
    }),
    function(e, t) {
        function i(e, t, i) {
            return (e ? "__elem_" + e : "") + "__mod" + (t ? "_" + t : "") + (i ? "_" + i : "")
        }

        function n(t, n, o) {
            e.isFunction(t) ? n[i(o, "*", "*")] = t : e.each(t, function(t, s) {
                e.isFunction(s) ? n[i(o, t, "*")] = s : e.each(s, function(e, s) {
                    n[i(o, t, e)] = s
                })
            })
        }

        function o(e, t) {
            return t ? Array.isArray(t) ? function(i) {
                for (var n = 0, o = t.length; o > n;)
                    if (i.hasMod(e, t[n++])) return !0;
                return !1
            } : function(i) {
                return i.hasMod(e, t)
            } : function(t) {
                return t.hasMod(e)
            }
        }
        var s = [],
            r = {},
            a = {};
        this.BEM = e.inherit(e.observable, {
            __constructor: function(e, t, i) {
                var n = this;
                n._modCache = e || {}, n._processingMods = {}, n._params = t, n.params = null, i !== !1 ? n._init() : n.afterCurrentEvent(function() {
                    n._init()
                })
            },
            _init: function() {
                return this._initing || this.hasMod("js", "inited") || (this._initing = !0, this.params || (this.params = e.extend(this.getDefaultParams(), this._params), delete this._params), this.setMod("js", "inited"), delete this._initing, this.hasMod("js", "inited") && this.trigger("init")), this
            },
            changeThis: function(e, t) {
                return e.bind(t || this)
            },
            afterCurrentEvent: function(e, t) {
                this.__self.afterCurrentEvent(this.changeThis(e, t))
            },
            trigger: function(e, t) {
                return this.__base(e = this.buildEvent(e), t).__self.trigger(e, t), this
            },
            buildEvent: function(t) {
                return "string" == typeof t && (t = e.Event(t)), t.block = this, t
            },
            hasMod: function(e, i, n) {
                var o = arguments.length,
                    s = !1;
                1 == o ? (n = "", i = e, e = t, s = !0) : 2 == o && ("string" == typeof e ? (n = i, i = e, e = t) : (n = "", s = !0));
                var r = this.getMod(e, i) === n;
                return s ? !r : r
            },
            getMod: function(e, t) {
                var i = typeof e;
                if ("string" === i || "undefined" === i) {
                    t = e || t;
                    var n = this._modCache;
                    return t in n ? n[t] : n[t] = this._extractModVal(t)
                }
                return this._getElemMod(t, e)
            },
            _getElemMod: function(e, t, i) {
                return this._extractModVal(e, t, i)
            },
            getMods: function(e) {
                var i = e && "string" != typeof e,
                    n = this,
                    o = [].slice.call(arguments, i ? 1 : 0),
                    s = n._extractMods(o, i ? e : t);
                return i || (o.length ? o.forEach(function(e) {
                    n._modCache[e] = s[e]
                }) : n._modCache = s), s
            },
            setMod: function(i, n, o) {
                "undefined" == typeof o && (o = n, n = i, i = t);
                var s = this;
                if (!i || i[0]) {
                    var r = (i && i[0] ? e.identify(i[0]) : "") + "_" + n;
                    if (this._processingMods[r]) return s;
                    var a, l = i ? s._getElemMod(n, i, a = s.__self._extractElemNameFrom(i)) : s.getMod(n);
                    if (l === o) return s;
                    this._processingMods[r] = !0;
                    var c = !0,
                        d = [n, o, l];
                    i && d.unshift(i), [
                        ["*", "*"],
                        [n, "*"],
                        [n, o]
                    ].forEach(function(e) {
                        c = s._callModFn(a, e[0], e[1], d) !== !1 && c
                    }), !i && c && (s._modCache[n] = o), c && s._afterSetMod(n, o, l, i, a), delete this._processingMods[r]
                }
                return s
            },
            _afterSetMod: function(e, t, i, n, o) {},
            toggleMod: function(e, i, n, o, s) {
                "string" == typeof e && (s = o, o = n, n = i, i = e, e = t), "undefined" == typeof o ? o = "" : "boolean" == typeof o && (s = o, o = "");
                var r = this.getMod(e, i);
                return (r == n || r == o) && this.setMod(e, i, "boolean" == typeof s ? s ? n : o : this.hasMod(e, i, n) ? o : n), this
            },
            delMod: function(e, i) {
                return i || (i = e, e = t), this.setMod(e, i, "")
            },
            _callModFn: function(e, n, o, s) {
                var r = i(e, n, o);
                return this[r] ? this[r].apply(this, s) : t
            },
            _extractModVal: function(e, t) {
                return ""
            },
            _extractMods: function(e, t) {
                return {}
            },
            channel: function(e, t) {
                return this.__self.channel(e, t)
            },
            getDefaultParams: function() {
                return {}
            },
            del: function(e) {
                var t = [].slice.call(arguments);
                return "string" == typeof e && t.unshift(this), this.__self.del.apply(this.__self, t), this
            },
            destruct: function() {}
        }, {
            _name: "i-bem",
            blocks: r,
            decl: function(i, s, a) {
                if ("string" == typeof i ? i = {
                        block: i
                    } : i.name && (i.block = i.name), i.baseBlock && !r[i.baseBlock]) throw 'baseBlock "' + i.baseBlock + '" for "' + i.block + '" is undefined';
                s || (s = {}), s.onSetMod && (n(s.onSetMod, s), delete s.onSetMod), s.onElemSetMod && (e.each(s.onElemSetMod, function(e, t) {
                    n(t, s, e)
                }), delete s.onElemSetMod);
                var l = r[i.baseBlock || i.block] || this;
                if (i.modName) {
                    var c = o(i.modName, i.modVal);
                    e.each(s, function(i, n) {
                        e.isFunction(n) && (s[i] = function() {
                            var e;
                            if (c(this)) e = n;
                            else {
                                var o = l.prototype[i];
                                o && o !== s[i] && (e = this.__base)
                            }
                            return e ? e.apply(this, arguments) : t
                        })
                    })
                }
                if (a && "boolean" == typeof a.live) {
                    var d = a.live;
                    a.live = function() {
                        return d
                    }
                }
                var u;
                return i.block == l._name ? (u = e.inheritSelf(l, s, a))._processLive(!0) : ((u = r[i.block] = e.inherit(l, s, a))._name = i.block, delete u._liveInitable), u
            },
            _processLive: function(e) {
                return !1
            },
            create: function(e, t) {
                return "string" == typeof e && (e = {
                    block: e
                }), new r[e.block](e.mods, t)
            },
            getName: function() {
                return this._name
            },
            _extractElemNameFrom: function(e) {},
            afterCurrentEvent: function(e, t) {
                1 == s.push({
                    fn: e,
                    ctx: t
                }) && setTimeout(this._runAfterCurrentEventFns, 0)
            },
            _runAfterCurrentEventFns: function() {
                var e = s.length;
                if (e)
                    for (var t, i = s.splice(0, e); t = i.shift();) t.fn.call(t.ctx || this)
            },
            changeThis: function(e, t) {
                return e.bind(t || this)
            },
            del: function(e) {
                var t = "string" == typeof e,
                    i = t ? 0 : 1,
                    n = arguments.length;
                for (t && (e = this); n > i;) delete e[arguments[i++]];
                return this
            },
            channel: function(i, n) {
                return "boolean" == typeof i && (n = i, i = t), i || (i = "default"), n ? void(a[i] && (a[i].un(), delete a[i])) : a[i] || (a[i] = new e.observable)
            }
        })
    }(jQuery),
    function() {
        Object.keys || (Object.keys = function(e) {
            var t = [];
            for (var i in e) e.hasOwnProperty(i) && t.push(i);
            return t
        })
    }(), "function" != typeof Object.create && (Object.create = function(e, t) {
        function i() {}
        var n;
        if (i.prototype = e, "object" == typeof t)
            for (n in t) t.hasOwnProperty(n) && (i[n] = t[n]);
        return new i
    }),
    function() {
        var e = Array.prototype,
            t = Object.prototype.toString,
            i = {
                indexOf: function(e, t) {
                    t = +(t || 0);
                    var i = this,
                        n = i.length;
                    if (n > 0 && n > t)
                        for (t = 0 > t ? Math.ceil(t) : Math.floor(t), -n > t && (t = 0), 0 > t && (t += n); n > t;) {
                            if (t in i && i[t] === e) return t;
                            ++t
                        }
                    return -1
                },
                forEach: function(e, t) {
                    for (var i = -1, n = this, o = n.length; ++i < o;) i in n && (t ? e.call(t, n[i], i, n) : e(n[i], i, n))
                },
                map: function(e, t) {
                    for (var i = -1, n = this, o = n.length, s = new Array(o); ++i < o;) i in n && (s[i] = t ? e.call(t, n[i], i, n) : e(n[i], i, n));
                    return s
                },
                filter: function(e, t) {
                    for (var i = -1, n = this, o = n.length, s = []; ++i < o;) i in n && (t ? e.call(t, n[i], i, n) : e(n[i], i, n)) && s.push(n[i]);
                    return s
                },
                reduce: function(e, t) {
                    var i, n = -1,
                        o = this,
                        s = o.length;
                    if (arguments.length < 2) {
                        for (; ++n < s;)
                            if (n in o) {
                                i = o[n];
                                break
                            }
                    } else i = t;
                    for (; ++n < s;) n in o && (i = e(i, o[n], n, o));
                    return i
                },
                some: function(e, t) {
                    for (var i = -1, n = this, o = n.length; ++i < o;)
                        if (i in n && (t ? e.call(t, n[i], i, n) : e(n[i], i, n))) return !0;
                    return !1
                },
                every: function(e, t) {
                    for (var i = -1, n = this, o = n.length; ++i < o;)
                        if (i in n && !(t ? e.call(t, n[i], i, n) : e(n[i], i, n))) return !1;
                    return !0
                }
            };
        for (var n in i) e[n] || (e[n] = i[n]);
        Array.isArray || (Array.isArray = function(e) {
            return "[object Array]" === t.call(e)
        })
    }(),
    function() {
        var e = Array.prototype.slice;
        Function.prototype.bind || (Function.prototype.bind = function(t) {
            var i = this,
                n = e.call(arguments, 1);
            return function() {
                return i.apply(t, n.concat(e.call(arguments)))
            }
        })
    }(),
    function(e, t, i) {
        function n(e, t, i) {
            i.push(r, e, r, t)
        }

        function o(e, t, i, o) {
            o.push(e), i && n(t, i, o)
        }

        function s(e, t, s, r, l) {
            o(e, i, i, l), l.push(a, t), r && n(s, r, l)
        }
        var r = "_",
            a = "__",
            l = "[a-zA-Z0-9-]+";
        e.INTERNAL = {
            NAME_PATTERN: l,
            MOD_DELIM: r,
            ELEM_DELIM: a,
            buildModPostfix: function(e, t, i) {
                var o = i || [];
                return n(e, t, o), i ? o : o.join("")
            },
            buildClass: function(e, t, n, r, a) {
                var l = typeof n;
                if ("string" == l ? "string" != typeof r && "number" != typeof r && (a = r, r = n, n = t, t = i) : "undefined" != l ? (a = n, n = i) : t && "string" != typeof t && (a = t, t = i), !(t || n || a)) return e;
                var c = a || [];
                return t ? s(e, t, n, r, c) : o(e, n, r, c), a ? c : c.join("")
            },
            buildClasses: function(e, n, r, a) {
                n && "string" != typeof n && (a = r, r = n, n = i);
                var l = a || [];
                return n ? s(e, n, i, i, l) : o(e, i, i, l), r && t.each(r, function(t, i) {
                    i && (l.push(" "), n ? s(e, n, t, i, l) : o(e, t, i, l))
                }), a ? l : l.join("")
            }
        }
    }(BEM, jQuery), jQuery.cookie = function(e, t, i) {
        if ("undefined" == typeof t) {
            var n = null;
            if (document.cookie && "" != document.cookie)
                for (var o = document.cookie.split(";"), s = 0; s < o.length; s++) {
                    var r = jQuery.trim(o[s]);
                    if (r.substring(0, e.length + 1) == e + "=") {
                        n = decodeURIComponent(r.substring(e.length + 1));
                        break
                    }
                }
            return n
        }
        i = i || {}, null === t && (t = "", i.expires = -1);
        var a = "";
        if (i.expires && ("number" == typeof i.expires || i.expires.toUTCString)) {
            var l;
            "number" == typeof i.expires ? (l = new Date, l.setTime(l.getTime() + 24 * i.expires * 60 * 60 * 1e3)) : l = i.expires, a = "; expires=" + l.toUTCString()
        }
        var c = i.path ? "; path=" + i.path : "",
            d = i.domain ? "; domain=" + i.domain : "",
            u = i.secure ? "; secure" : "";
        document.cookie = [e, "=", encodeURIComponent(t), a, c, d, u].join("")
    },
    function(e) {
        function t(e) {
            return e.replace(/%.{2}/g, function(e) {
                return n[e] || e
            })
        }

        function i(e, i) {
            var n = "";
            try {
                n = e(i)
            } catch (o) {
                try {
                    n = e(t(i))
                } catch (o) {
                    n = i
                }
            }
            return n
        }
        var n = {
            "%D0": "%D0%A0",
            "%C0": "%D0%90",
            "%C1": "%D0%91",
            "%C2": "%D0%92",
            "%C3": "%D0%93",
            "%C4": "%D0%94",
            "%C5": "%D0%95",
            "%A8": "%D0%81",
            "%C6": "%D0%96",
            "%C7": "%D0%97",
            "%C8": "%D0%98",
            "%C9": "%D0%99",
            "%CA": "%D0%9A",
            "%CB": "%D0%9B",
            "%CC": "%D0%9C",
            "%CD": "%D0%9D",
            "%CE": "%D0%9E",
            "%CF": "%D0%9F",
            "%D1": "%D0%A1",
            "%D2": "%D0%A2",
            "%D3": "%D0%A3",
            "%D4": "%D0%A4",
            "%D5": "%D0%A5",
            "%D6": "%D0%A6",
            "%D7": "%D0%A7",
            "%D8": "%D0%A8",
            "%D9": "%D0%A9",
            "%DA": "%D0%AA",
            "%DB": "%D0%AB",
            "%DC": "%D0%AC",
            "%DD": "%D0%AD",
            "%DE": "%D0%AE",
            "%DF": "%D0%AF",
            "%E0": "%D0%B0",
            "%E1": "%D0%B1",
            "%E2": "%D0%B2",
            "%E3": "%D0%B3",
            "%E4": "%D0%B4",
            "%E5": "%D0%B5",
            "%B8": "%D1%91",
            "%E6": "%D0%B6",
            "%E7": "%D0%B7",
            "%E8": "%D0%B8",
            "%E9": "%D0%B9",
            "%EA": "%D0%BA",
            "%EB": "%D0%BB",
            "%EC": "%D0%BC",
            "%ED": "%D0%BD",
            "%EE": "%D0%BE",
            "%EF": "%D0%BF",
            "%F0": "%D1%80",
            "%F1": "%D1%81",
            "%F2": "%D1%82",
            "%F3": "%D1%83",
            "%F4": "%D1%84",
            "%F5": "%D1%85",
            "%F6": "%D1%86",
            "%F7": "%D1%87",
            "%F8": "%D1%88",
            "%F9": "%D1%89",
            "%FA": "%D1%8A",
            "%FB": "%D1%8B",
            "%FC": "%D1%8C",
            "%FD": "%D1%8D",
            "%FE": "%D1%8E",
            "%FF": "%D1%8F"
        };
        e.extend({
            decodeURI: function(e) {
                return i(decodeURI, e)
            },
            decodeURIComponent: function(e) {
                return i(decodeURIComponent, e)
            }
        })
    }(jQuery), setTimeout(function() {
        var e = this;
        BEM.JSON._ctx.prototype.blockParam = function(e) {
            return this._currBlock[e]
        }, BEM.JSON._ctx.prototype.blockParams = function() {
            return this._currBlock
        }, BEM.JSON._ctx.prototype.blockMods = function() {
            var e = this._currBlock;
            return (e.elem ? e.blockMods : e.block && e.mods) || {}
        }, BEM.JSON._ctx.prototype._declErrorHandler = function(t) {
            if (t && t.message)
                if (e.document) setTimeout(function() {
                    throw t
                });
                else {
                    try {
                        console.log(["Error in", this._params.block, this._params.elem].join(" "))
                    } catch (i) {}
                    console.error(t)
                }
        }
    }), "undefined" == typeof BEM && (BEM = {}),
    function(e, t) {
        var i, n = {},
            o = function(e, t, i) {
                e[t] || (e[t] = []), e[t].unshift(i)
            },
            s = function(e, t, i) {
                return t.modName ? function(n) {
                    n._currBlock.mods && n._currBlock.mods[t.modName] === t.modVal && e.call(i, n)
                } : e.bind(i)
            },
            r = {},
            a = function(e) {
                return null === e || "undefined" == typeof e ? String(e) : r[Object.prototype.toString.call(e)] || "object"
            },
            l = function(e) {
                return "function" == typeof e
            },
            c = Array.isArray || function(e) {
                return "array" === a(e)
            },
            d = function(e) {
                return Boolean(e && (e.block || e.elem || e.tag))
            },
            u = function(e) {
                for (var t, i, n, o, s = "object" == typeof e ? e : {}, r = 1, a = arguments.length; a > r; r++)
                    if (t = arguments[r], null !== t)
                        for (i in t) t.hasOwnProperty(i) && (n = s[i], o = t[i], s !== o && (s[i] = o));
                return s
            },
            h = function() {
                var e = 0;
                return (h = t && t.identify ? function() {
                    return t.identify()
                } : function() {
                    return "uniq" + ++e
                })()
            },
            m = Array.prototype.concat.bind([]),
            p = e && e.INTERNAL && e.INTERNAL.ELEM_DELIM || "__";
        ["Boolean", "Number", "String", "Function", "Array", "Date", "RegExp", "Object"].forEach(function(e) {
            r["[object " + e + "]"] = e.toLowerCase()
        }), i = function(e, t, i, n, o) {
            this._params = e, this._currBlock = n, this._tParams = o, this._pos = t || 1, this._siblingsCount = i || 1, this._isStopped = !1, this._isRemoved = !1, !e.block || e.elem && n && n.block === e.block || (this._currBlock = e)
        }, i.prototype = {
            _buildWithNewCtx: function(e, t, n, o, s) {
                return new i(e, t, n, o, s).build()
            },
            _buildInner: function(e, t, i, n) {
                var o, s = a(e);
                return n && d(e) && (e._parent = n), "object" === s || "array" === s ? ((!e.block || this._currBlock && e.block === this._currBlock.block && e.elem) && (o = this._currBlock), this._buildWithNewCtx(e, t, i, o, this._tParams && u({}, this._tParams), s)) : e
            },
            pos: function() {
                return this._pos
            },
            isFirst: function() {
                return 1 === this._pos
            },
            isLast: function() {
                return this._pos === this._siblingsCount
            },
            params: function(e) {
                return "undefined" == typeof e ? this._params : (this._params = e, this)
            },
            param: function(e, t, i, n) {
                var o = this._params;
                return "undefined" == typeof t ? o[e] : (i || !o.hasOwnProperty(e) ? o[e] = t : n && (o[e] = u(t, o[e])), this)
            },
            content: function(e, t) {
                return this.param("content", e, t)
            },
            mods: function(e, t) {
                return this.param("mods", e, t, !0)
            },
            _property: function(e, t) {
                var i = this._params[e] = this._params[e] || {},
                    n = t[0],
                    o = t[1],
                    s = t[2];
                return "undefined" == typeof o ? i[n] : ((s || !i.hasOwnProperty(n)) && (i[n] = o), this)
            },
            mod: function() {
                return this._property("mods", arguments)
            },
            attr: function() {
                return this._property("attrs", arguments)
            },
            attrs: function(e, t) {
                return this.param("attrs", e, t, !0)
            },
            tag: function(e, t) {
                return this.param("tag", e, t)
            },
            cls: function(e, t) {
                return this.param("cls", e, t)
            },
            mix: function(e, t) {
                var i = this._params;
                return "undefined" == typeof e ? i.mix : (t || !i.hasOwnProperty("mix") ? i.mix = [].concat(e) : i.mix = (i.mix || []).concat(e), this)
            },
            js: function(e) {
                return this.param("js", e)
            },
            wrapContent: function(e) {
                var t = this._params;
                return e.content = t.content, t.content = e, this
            },
            beforeContent: function(e) {
                var t = this._params;
                return t.content = m(e, t.content), this
            },
            afterContent: function(e) {
                var t = this._params;
                return t.content = m(t.content, e), this
            },
            wrap: function(e) {
                return d(e) && (e.content = this._params._wrapper || this._params), this._params._wrapper = e, this
            },
            tParam: function(e, t) {
                var i = this._tParams = this._tParams || {};
                return "undefined" == typeof t ? i[e] : (i[e] = t, this)
            },
            generateId: function() {
                return h()
            },
            stop: function() {
                this._isStopped = !0
            },
            remove: function() {
                this._isRemoved = !0, this.stop()
            },
            _buildBem: function() {
                var e = this._params,
                    t = e._parent;
                return delete e._parent, this._isRemoved ? (t && (c(t) ? t[this._pos - 1] = null : t.content && (t.content = null)), void(this._params = null)) : (e.content = this._buildInner(e.content, 1, 1, e), void(e._wrapper && (this._params = this._buildInner(e._wrapper, 1, 1, t), t && (c(t) ? t[this._pos - 1] = this._params : t.content && (t.content = this._params)))))
            },
            build: function() {
                var e, t = this._params,
                    i = this;
                return t._wrapper ? (delete t._wrapper, t) : (t.block || t.elem ? (e = this._currBlock && n[this._currBlock.block], e && (this._fns = [], t.elem ? (this._fns.push.apply(this._fns, e["_elem" + p + t.elem] || []), this._fns.push.apply(this._fns, e._elem || [])) : this._fns.push.apply(this._fns, e._block || []), this._runDecls()), this._buildBem(), t = this._params) : c(t) ? t.forEach(function(e, n) {
                    t[n] = i._buildInner(e, n + 1, t.length, t)
                }) : t.content && (t.content = this._buildInner(t.content, 1, 1, t)), t)
            },
            _runDecls: function() {
                var e;
                if (this._fns.length) try {
                    for (e = 0; e < this._fns.length && (this._fns[e](this), !this._isStopped); e++);
                } catch (t) {
                    this.remove(), this._declErrorHandler(t)
                }
            },
            _declErrorHandler: function(e) {
                if (e && e.message) {
                    try {
                        console.log(["Error in", this._params.block, this._params.elem].join(" "))
                    } catch (t) {}
                    console.error(e)
                }
            }
        }, e.JSON = {
            _decls: n,
            _ctx: i,
            _type: a,
            decl: function(e, t) {
                var i = "string" == typeof e ? {
                        name: e
                    } : e,
                    r = n[i.name] = n[i.name] || {};
                t.onBlock && o(r, "_block", s(t.onBlock, e, t)), t.onElem && (l(t.onElem) ? o(r, "_elem", s(t.onElem, e, t)) : Object.keys(t.onElem).forEach(function(i) {
                    o(r, "_elem" + ("*" === i ? "" : p + i), s(t.onElem[i], e, t))
                }))
            },
            build: function(e) {
                return new i(e).build()
            }
        }
    }(BEM, "undefined" != typeof jQuery ? jQuery : null),
    function(e, t, i) {
        function n(e, t, i) {
            (e[t] || (e[t] = [])).unshift(i)
        }

        function o(e, t) {
            return t.modName ? function(i) {
                (i._curBlock.mods || {})[t.modName] === t.modVal && e(i)
            } : e
        }

        function s(e, i) {
            var n, o = t.isArray(i);
            return t.isArray(e) ? o ? n = e.concat(i) : (n = e).push(i) : o ? (n = i).unshift(e) : n = [e, i], n
        }

        function r(e) {
            return e.replace(p, function(e) {
                return m[e]
            })
        }
        var a = e.INTERNAL,
            l = a.ELEM_DELIM,
            c = {
                area: 1,
                base: 1,
                br: 1,
                col: 1,
                command: 1,
                embed: 1,
                hr: 1,
                img: 1,
                input: 1,
                keygen: 1,
                link: 1,
                meta: 1,
                param: 1,
                source: 1,
                wbr: 1
            },
            d = a.buildClass,
            u = a.buildClasses,
            h = {},
            m = {
                '"': "&quot;",
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;"
            },
            p = /["&<>]/g;
        e.HTML = {
            decl: function(e, i) {
                "string" == typeof e && (e = {
                    block: e
                }), e.name && (e.block = e.name);
                var s = h[e.block] || (h[e.block] = {});
                i.onBlock && n(s, "_block", o(i.onBlock, e)), i.onElem && (t.isFunction(i.onElem) ? n(s, "_elem", o(i.onElem, e)) : t.each(i.onElem, function(t, i) {
                    n(s, "_elem" + ("*" === t ? "" : l + t), o(i, e))
                }))
            },
            build: function(e) {
                var t = new this.Ctx(e);
                return t._buildAll(), t._flush()
            },
            Ctx: t.inherit({
                __constructor: function(e) {
                    this._buffer = [], this._params = e, this._tParams = null, this._tParamsChanges = null, this._curBlock = i
                },
                pos: function() {
                    return this._params._pos
                },
                isFirst: function() {
                    return 1 === this._params._pos
                },
                isLast: function() {
                    var e = this._params;
                    return e._pos === e._siblingsCount
                },
                params: function(e) {
                    var t = this;
                    return "undefined" == typeof e ? t._params : (t._params = e, t)
                },
                param: function(e, i, n, o) {
                    var s = this,
                        r = s._params;
                    return "undefined" == typeof i ? r[e] : (!n && e in r ? o && (r[e] = t.extend(i, r[e])) : r[e] = i, s)
                },
                attrs: function(e, t) {
                    return this.param("attrs", e, t, !0)
                },
                attr: function(e, t, i) {
                    var n = this;
                    if ("undefined" == typeof t) return (n._params.attrs || {})[e];
                    var o = n._params.attrs;
                    return o ? (i || !(e in o)) && (o[e] = t) : (n._params.attrs = {})[e] = t, n
                },
                tag: function(e, t) {
                    return this.param("tag", e, t)
                },
                cls: function(e, t) {
                    return this.param("cls", e, t)
                },
                mods: function(e, t) {
                    return this.param("mods", e, t, !0)
                },
                mod: function(e, t, i) {
                    var n = this;
                    if ("undefined" == typeof t) return (n._params.mods || {})[e];
                    var o = n._params.mods;
                    return o ? (i || !(e in o)) && (o[e] = t) : (n._params.mods = {})[e] = t, n
                },
                mix: function(e, t) {
                    var i = this,
                        n = i._params;
                    return "undefined" == typeof e ? n.mix : (!t && "mix" in n ? n.mix = n.mix.concat(e) : n.mix = e, i)
                },
                js: function(e) {
                    return this.param("js", e)
                },
                content: function(e, t) {
                    return this.param("content", e, t)
                },
                wrapContent: function(e) {
                    var t = this,
                        i = t._params;
                    return e.content = i.content, i.content = e, t
                },
                beforeContent: function(e) {
                    var t = this,
                        i = t._params;
                    return i.content = s(e, i.content), t
                },
                afterContent: function(e) {
                    var t = this,
                        i = t._params;
                    return i.content = s(i.content, e), t
                },
                wrap: function(e) {
                    var t = this,
                        i = t._params;
                    return e.block || (e._curBlock = t._curBlock), e.content = i._wrapper ? i._wrapper : i, i._wrapper = e, t
                },
                tParam: function(e, t) {
                    var i = this,
                        n = i._tParams || (i._tParams = {});
                    if ("undefined" == typeof t) return n[e];
                    var o = i._tParamsChanges || (i._tParamsChanges = {});
                    return e in o || (o[e] = n[e]), n[e] = t, i
                },
                generateId: function() {
                    return t.identify()
                },
                stop: function() {
                    this._params._isStopped = !0
                },
                _buildAll: function() {
                    var e = this,
                        i = e._buffer,
                        n = e._params,
                        o = typeof n;
                    if ("string" == o || "number" == o) i.push(n);
                    else if (t.isArray(n))
                        for (var s, r, a = 0, l = n.length; l > a;) e._params = s = n[a++], r = typeof s, "string" == r || "number" == r ? i.push(s) : s && (s._pos = a, s._siblingsCount = l, e._buildByDecl());
                    else n && (e._params._pos = e._params._siblingsCount = 1, e._buildByDecl())
                },
                _build: function() {
                    var e, i = this,
                        n = i._buffer,
                        o = i._params,
                        s = o.tag || "div",
                        a = o.block || o.elem,
                        l = a && (o.block || i._curBlock.block),
                        h = !1;
                    o.js && ((e = {})[d(l, o.elem)] = o.js === !0 ? {} : o.js, h = !o.elem), n.push("<", s), (a || o.cls) && (n.push(' class="'), a && (u(l, o.elem, o.mods, n), o.mix && t.each(o.mix, function(t, i) {
                        i && (n.push(" "), u(i.block, i.elem, i.mods, n), i.js && ((e || (e = {}))[d(i.block, i.elem)] = i.js === !0 ? {} : i.js, h || (h = !i.elem)))
                    })), o.cls && n.push(a ? " " : "", o.cls), h && n.push(" i-bem"), n.push('"')), e && n.push(' onclick="return ', r(JSON.stringify(e)), '"'), o.attrs && t.each(o.attrs, function(e, t) {
                        "undefined" != typeof t && null !== t && t !== !1 && n.push(" ", e, '="', t.toString().replace(/"/g, "&quot;"), '"')
                    }), c[s] ? n.push("/>") : (n.push(">"), "undefined" != typeof o.content && (i._params = o.content, i._buildAll()), n.push("</", s, ">"))
                },
                _flush: function() {
                    var e = this._buffer.join("");
                    return delete this._buffer, e
                },
                _buildByDecl: function() {
                    var e = this,
                        i = e._curBlock,
                        n = e._params;
                    if (n._curBlock && (e._curBlock = n._curBlock), n.block && (e._curBlock = n), !n._wrapper) {
                        if (n.block || n.elem) {
                            var o = h[e._curBlock.block];
                            if (o) {
                                var s;
                                if (n.elem ? (s = o["_elem" + l + n.elem], o._elem && (s = s ? s.concat(o._elem) : o._elem)) : s = o._block, s)
                                    for (var r, a = 0;
                                        (r = s[a++]) && (r(e), !n._isStopped););
                            }
                        }
                        if (n._wrapper) return n._curBlock = e._curBlock, e._params = n._wrapper, e._buildAll()
                    }
                    var c = e._tParamsChanges;
                    if (e._tParamsChanges = null, e._build(), e._curBlock = i, c) {
                        var d = e._tParams;
                        t.each(c, function(e, t) {
                            "undefined" == typeof t ? delete d[e] : d[e] = t
                        })
                    }
                }
            })
        }
    }(BEM, jQuery), "undefined" == typeof BEM && (BEM = {}),
    function(e) {
        var t = e.INTERNAL,
            i = (t.ELEM_DELIM, {
                area: 1,
                base: 1,
                br: 1,
                col: 1,
                command: 1,
                embed: 1,
                hr: 1,
                img: 1,
                input: 1,
                keygen: 1,
                link: 1,
                meta: 1,
                param: 1,
                source: 1,
                wbr: 1
            }),
            n = t.buildClass,
            o = t.buildClasses,
            s = {
                '"': "'",
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;"
            },
            r = /['"&<>]/g;
        e.HTML = {
            _escapeAttr: function(e) {
                return e ? String(e).replace(r, function(e) {
                    return s[e]
                }) : ""
            },
            decl: e.JSON.decl.bind(e.JSON),
            _addAttrs: function(e, t) {
                var i, n = t || [];
                for (i in e) e.hasOwnProperty(i) && n.push(" ", i, '="', this._escapeAttr(e[i]), '"')
            },
            _buildBem: function(e, t) {
                var s, r = [],
                    a = [],
                    l = !1;
                return e.tag = e.tag || "div", e.js && (s = {}, s[n(e.block || t, e.elem)] = e.js === !0 ? {} : e.js, l = !Boolean(e.elem)), r.push("<", e.tag), (e.block || e.elem) && (r.push(' class="', o(e.block || t, e.elem, e.mods)), e.mix && a.concat(e.mix).forEach(function(i) {
                    r.push(" "), o(i.block || t, i.elem, i.mods, r), i.js && (s = s || {}, s[n(i.block || t, i.elem)] = i.js === !0 ? {} : i.js, l = l || !Boolean(e.elem))
                }), l && r.push(" i-bem"), e.cls && r.push(" " + String(e.cls)), r.push('"')), s && r.push(' onclick="return ', this._escapeAttr(JSON.stringify(s)), '"'), e.attrs && this._addAttrs(e.attrs, r), i[e.tag] ? r.push("/>") : (r.push(">"), e.content && r.push(this._build(e.content, e.block || t)), r.push("</", e.tag, ">")), r.join("")
            },
            _build: function(e, t) {
                return e ? Array.isArray(e) ? e.map(function(e) {
                    return this._build(e, t)
                }.bind(this)).join("") : e.block || e.elem || e.tag || e.content ? this._buildBem(e, t) : String(e) : ""
            },
            build: function(t) {
                return this._build(e.JSON.build(t))
            }
        }
    }(BEM),
    function(e) {
        if (!window.JSON) {
            var t, i = Object.prototype.toString,
                n = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                o = {
                    "\b": "\\b",
                    "	": "\\t",
                    "\n": "\\n",
                    "\f": "\\f",
                    "\r": "\\r",
                    '"': '\\"',
                    "\\": "\\\\"
                };
            window.JSON = {
                stringify: t = function(s) {
                    if (null === s) return "null";
                    if ("undefined" == typeof s) return e;
                    switch (i.call(s)) {
                        case "[object String]":
                            return n.lastIndex = 0, '"' + (n.test(s) ? s.replace(n, function(e) {
                                var t = o[e];
                                return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
                            }) : s) + '"';
                        case "[object Number]":
                        case "[object Boolean]":
                            return "" + s;
                        case "[object Array]":
                            for (var r, a = "[", l = 0, c = s.length; c > l;) r = t(s[l]), a += (l++ ? "," : "") + ("undefined" == typeof r ? "null" : r);
                            return a + "]";
                        case "[object Object]":
                            if ("[object Function]" === i.call(s.toJSON)) return t(s.toJSON());
                            var r, a = "{",
                                l = 0;
                            for (var d in s) s.hasOwnProperty(d) && (r = t(s[d]), "undefined" != typeof r && (a += (l++ ? "," : "") + '"' + d + '":' + r));
                            return a + "}";
                        default:
                            return e
                    }
                },
                parse: function(e) {
                    return Function("return " + e)()
                }
            }
        }
    }(), "undefined" == typeof JSON && (window.JSON = {}), JSON.parse = JSON.parse || function(json) {
        return eval("(" + json + ")")
    },
    function(e, t, i) {
        function n(e, i) {
            var n = e[0];
            t.each(a(n), function(r, a) {
                s(a, n, r, i);
                var l = p[a.uniqId];
                l ? l.domElem.index(n) < 0 && (l.domElem = l.domElem.add(e), t.extend(l._params, a)) : o(r, e, a)
            })
        }

        function o(e, n, o, r, l) {
            "boolean" == typeof o && (l = r, r = o, o = i);
            var c = n[0];
            o = s(o || a(c)[e], c, e);
            var d = o.uniqId;
            if (p[d]) return p[d]._init();
            m[d] = m[d] ? m[d].add(n) : n;
            var u = c.parentNode;
            u && 11 !== u.nodeType || t.unique(m[d]);
            var h = b[e] || N.decl(e, {}, {
                live: !0
            });
            if (!(h._liveInitable = !!h._processLive()) || r || o.live === !1) {
                r && n.addClass("i-bem");
                var f = new h(m[d], o, !!r);
                return delete m[d], l && l.apply(f, x.call(arguments, 4)), f
            }
        }

        function s(e, i, n, o) {
            (e || (e = {})).uniqId || (e.uniqId = (e.id ? n + "-id-" + e.id : t.identify()) + (o || t.identify()));
            var s = t.identify(i),
                r = f[s] || (f[s] = {});
            return r[n] || (r[n] = e), e
        }

        function r(e, t, i) {
            var n = e.find(t);
            return i ? n : n.add(e.filter(t))
        }

        function a(e) {
            var i = t.identify(e);
            return f[i] || (f[i] = l(e))
        }

        function l(e) {
            var i, n, o = e.getAttribute("data-bem");
            return o ? JSON.parse(o) : (i = e.onclick || e.ondblclick, i || "body" != e.tagName.toLowerCase() || (n = t(e), o = n.attr("onclick") || n.attr("ondblclick"), o && (i = Function(o))), i ? i() : {})
        }

        function c(e) {
            delete f[t.identify(e)]
        }

        function d(e, t) {
            1 === e.domElem.length ? e.destruct(!0) : e.domElem = e.domElem.not(t)
        }
        var u = t(window),
            h = t(document),
            m = {},
            p = {},
            f = {},
            g = {},
            _ = {},
            b = e.blocks,
            y = e.INTERNAL,
            v = y.NAME_PATTERN,
            M = y.MOD_DELIM,
            k = y.ELEM_DELIM,
            B = y.buildModPostfix,
            w = y.buildClass,
            x = Array.prototype.slice,
            E = Array.prototype.reverse;
        t.fn.bem = function(e, t) {
            return o(e, this, t, !0)
        };
        var N = e.DOM = e.decl("i-bem__dom", {
            __constructor: function(e, i, n) {
                var o = this;
                o.domElem = e, o._eventNameCache = {}, o._elemCache = {}, p[o._uniqId = i.uniqId || t.identify(o)] = o, o._needSpecialUnbind = !1, o.__base(null, i, n)
            },
            findBlocksInside: function(e, t) {
                return this._findBlocks("find", e, t)
            },
            findBlockInside: function(e, t) {
                return this._findBlocks("find", e, t, !0)
            },
            findBlocksOutside: function(e, t) {
                return this._findBlocks("parents", e, t)
            },
            findBlockOutside: function(e, t) {
                return this._findBlocks("closest", e, t)[0] || null
            },
            findBlocksOn: function(e, t) {
                return this._findBlocks("", e, t)
            },
            findBlockOn: function(e, t) {
                return this._findBlocks("", e, t, !0)
            },
            _findBlocks: function(e, n, s, r) {
                if (!this.domElem) return [];
                s || (s = n, n = i);
                var a = n ? "string" == typeof n ? this.findElem(n) : n : this.domElem,
                    l = "string" == typeof s,
                    c = l ? s : s.block || s.blockName,
                    d = "." + (l ? w(c) : w(c, s.modName, s.modVal)) + (r ? ":first" : ""),
                    u = a.filter(d);
                if (e && (u = u.add(a[e](d))), r) return u[0] ? o(c, u.eq(0), !0) : null;
                var h = [],
                    m = {};
                return t.each(u, function(e, i) {
                    var n = o(c, t(i), !0);
                    m[n._uniqId] || (m[n._uniqId] = !0, h.push(n))
                }), h
            },
            bindToDomElem: function(e, i, n) {
                var o = this;
                return n ? e.bind(o._buildEventName(i), function(e) {
                    return (e.data || (e.data = {})).domElem = t(this), n.apply(o, arguments)
                }) : t.each(i, function(t, i) {
                    o.bindToDomElem(e, t, i)
                }), o
            },
            bindToDoc: function(e, t) {
                return this._needSpecialUnbind = !0, this.bindToDomElem(h, e, t)
            },
            bindToWin: function(e, t) {
                var i, n, o = t;
                return "resize" === e && (t = function() {
                    var e = u.height(),
                        t = u.width();
                    (i !== e || n !== t) && (i = e, n = t, o.apply(this, arguments))
                }), this._needSpecialUnbind = !0, this.bindToDomElem(u, e, t)
            },
            bindTo: function(e, i, n) {
                return !i || t.isFunction(i) ? (n = i, i = e, e = this.domElem) : "string" == typeof e && (e = this.elem(e)), this.bindToDomElem(e, i, n)
            },
            unbindFromDomElem: function(e, t) {
                return e.unbind(this._buildEventName(t)), this
            },
            unbindFromDoc: function(e) {
                return this.unbindFromDomElem(h, e)
            },
            unbindFromWin: function(e) {
                return this.unbindFromDomElem(u, e)
            },
            unbindFrom: function(e, t) {
                return t ? "string" == typeof e && (e = this.elem(e)) : (t = e, e = this.domElem), this.unbindFromDomElem(e, t)
            },
            _buildEventName: function(e) {
                var t = this;
                return e.indexOf(" ") > 1 ? e.split(" ").map(function(e) {
                    return t._buildOneEventName(e)
                }).join(" ") : t._buildOneEventName(e)
            },
            _buildOneEventName: function(e) {
                var t = this,
                    i = t._eventNameCache;
                if (e in i) return i[e];
                var n = "." + t._uniqId;
                if (e.indexOf(".") < 0) return i[e] = e + n;
                var o = ".bem_" + t.__self._name;
                return i[e] = e.split(".").map(function(e, t) {
                    return 0 == t ? e + o : o + "_" + e
                }).join("") + n
            },
            trigger: function(e, t) {
                return this.__base(e = this.buildEvent(e), t).domElem && this._ctxTrigger(e, t), this
            },
            _ctxTrigger: function(e, i) {
                var n = this,
                    o = g[n.__self._buildCtxEventName(e.type)],
                    s = {};
                o && n.domElem.each(function() {
                    for (var r = this, a = o.counter; r && a;) {
                        var l = t.identify(r, !0);
                        if (l) {
                            if (s[l]) break;
                            var c = o.ctxs[l];
                            c && (t.each(c, function(t, o) {
                                o.fn.call(o.ctx || n, e, i)
                            }), a--), s[l] = !0
                        }
                        r = r.parentNode
                    }
                })
            },
            setMod: function(e, i, n) {
                if (e && "undefined" != typeof n && e.length > 1) {
                    var o = this;
                    return e.each(function() {
                        var s = t(this);
                        s.__bemElemName = e.__bemElemName, o.setMod(s, i, n)
                    }), o
                }
                return this.__base(e, i, n)
            },
            _extractModVal: function(e, t, i) {
                var n, o = (t || this.domElem)[0];
                return o && (n = o.className.match(this.__self._buildModValRE(e, i || t))), n ? n[2] : ""
            },
            _extractMods: function(e, t) {
                var i = {},
                    n = !e.length,
                    o = 0;
                return ((t || this.domElem)[0].className.match(this.__self._buildModValRE("(" + (n ? v : e.join("|")) + ")", t, "g")) || []).forEach(function(e) {
                    var t = (e = e.trim()).lastIndexOf(M),
                        n = e.substr(0, t - 1).lastIndexOf(M);
                    i[e.substr(n + 1, t - n - 1)] = e.substr(t + 1), ++o
                }), o < e.length && e.forEach(function(e) {
                    e in i || (i[e] = "")
                }), i
            },
            _afterSetMod: function(e, i, n, o, s) {
                var r = this.__self,
                    a = r._buildModClassPrefix(e, s),
                    l = r._buildModValRE(e, s),
                    c = "" === i;
                (o || this.domElem).each(function() {
                    var e = this.className;
                    e.indexOf(a) > -1 ? this.className = e.replace(l, c ? "" : "$1" + a + i) : c || t(this).addClass(a + i)
                }), s && this.dropElemCache(s, e, n).dropElemCache(s, e, i)
            },
            findElem: function(e, t, i, n) {
                arguments.length % 2 ? (n = i, i = t, t = e, e = this.domElem) : "string" == typeof e && (e = this.findElem(e));
                var o = this.__self,
                    s = "." + t.split(" ").map(function(e) {
                        return w(o._name, e, i, n)
                    }).join(",.");
                return r(e, s)
            },
            _elem: function(e, t, i) {
                var n, o = e + B(t, i);
                return (n = this._elemCache[o]) || (n = this._elemCache[o] = this.findElem(e, t, i), n.__bemElemName = e), n
            },
            elem: function(e, i, n) {
                if (i && "string" != typeof i) return i.__bemElemName = e, i;
                if (e.indexOf(" ") < 0) return this._elem(e, i, n);
                var o = t([]),
                    s = this;
                return e.split(" ").forEach(function(e) {
                    o = o.add(s._elem(e, i, n))
                }), o
            },
            dropElemCache: function(e, t, i) {
                if (e) {
                    var n = this,
                        o = B(t, i);
                    e.indexOf(" ") < 0 ? delete n._elemCache[e + o] : e.split(" ").forEach(function(e) {
                        delete n._elemCache[e + o]
                    })
                } else this._elemCache = {};
                return this
            },
            elemParams: function(e) {
                var t;
                return "string" == typeof e ? (t = e, e = this.elem(e)) : t = this.__self._extractElemNameFrom(e), l(e[0])[w(this.__self.getName(), t)] || {}
            },
            elemify: function(e, i) {
                return (e = t(e)).__bemElemName = i, e
            },
            containsDomElem: function(e) {
                var t = !1;
                return this.domElem.each(function() {
                    return !(t = e.parents().andSelf().index(this) > -1)
                }), t
            },
            buildSelector: function(e, t, i) {
                return this.__self.buildSelector(e, t, i)
            },
            destruct: function(e) {
                var i = this,
                    n = i.__self;
                i._isDestructing || (i._isDestructing = !0, i._needSpecialUnbind && n.doc.add(n.win).unbind("." + i._uniqId), i.dropElemCache().domElem.each(function(e, i) {
                    var n = a(i);
                    t.each(n, function(e, t) {
                        var n = p[t.uniqId];
                        n ? n._isDestructing || d(n, i) : delete m[t.uniqId]
                    }), c(i)
                }), e || i.domElem.remove(), delete p[i.un()._uniqId], delete i.domElem, delete i._elemCache, i.__base())
            }
        }, {
            scope: null,
            doc: h,
            win: u,
            _processLive: function(e) {
                var t = this,
                    i = t._liveInitable;
                if ("live" in t) {
                    var n = "undefined" == typeof i;
                    if (n ^ e) {
                        i = t.live() !== !1;
                        var o = t.getName(),
                            s = t.live;
                        t.live = function() {
                            return this.getName() === o ? i : s.apply(this, arguments)
                        }
                    }
                }
                return i
            },
            init: function(e, i, o) {
                (!e || t.isFunction(e)) && (o = i, i = e, e = h);
                var s = t.identify();
                return r(e, ".i-bem").each(function() {
                    n(t(this), s)
                }), i && this.afterCurrentEvent(function() {
                    i.call(o || this, e)
                }), this._runAfterCurrentEventFns(), e
            },
            destruct: function(e, n, o) {
                "boolean" != typeof e && (o = n, n = e, e = i), E.call(r(n, ".i-bem", o)).each(function(e, i) {
                    var n = a(this);
                    t.each(n, function(e, t) {
                        if (t.uniqId) {
                            var n = p[t.uniqId];
                            n ? d(n, i) : delete m[t.uniqId]
                        }
                    }), c(this)
                }), e || (o ? n.empty() : n.remove())
            },
            update: function(e, t, i, n) {
                return this.destruct(e, !0), this.init(e.html(t), i, n)
            },
            replace: function(e, i) {
                return this.destruct(!0, e), this.init(t(i).replaceAll(e))
            },
            append: function(e, i) {
                return this.init(t(i).appendTo(e))
            },
            prepend: function(e, i) {
                return this.init(t(i).prependTo(e))
            },
            before: function(e, i) {
                return this.init(t(i).insertBefore(e))
            },
            after: function(e, i) {
                return this.init(t(i).insertAfter(e))
            },
            _buildCtxEventName: function(e) {
                return this._name + ":" + e
            },
            _liveClassBind: function(e, i, n, o) {
                var s = this;
                if (i.indexOf(" ") > -1) i.split(" ").forEach(function(t) {
                    s._liveClassBind(e, t, n, o)
                });
                else {
                    var r = _[i],
                        a = t.identify(n);
                    r || (r = _[i] = {}, h.bind(i, s.changeThis(s._liveClassTrigger, s))), r = r[e] || (r[e] = {
                        uniqIds: {},
                        fns: []
                    }), a in r.uniqIds || (r.fns.push({
                        uniqId: a,
                        fn: s._buildLiveEventFn(n, o)
                    }), r.uniqIds[a] = r.fns.length - 1)
                }
                return this
            },
            _liveClassUnbind: function(e, i, n) {
                var o = _[i];
                if (o)
                    if (n) {
                        if (o = o[e]) {
                            var s = t.identify(n);
                            if (s in o.uniqIds) {
                                var r = o.uniqIds[s],
                                    a = o.fns.length - 1;
                                for (o.fns.splice(r, 1); a > r;) o.uniqIds[o.fns[r++].uniqId] = r - 1;
                                delete o.uniqIds[s]
                            }
                        }
                    } else delete o[e];
                return this
            },
            _liveClassTrigger: function(e) {
                var i = _[e.type];
                if (i) {
                    var n = e.target,
                        o = [];
                    for (var s in i) i.hasOwnProperty(s) && o.push(s);
                    do
                        for (var r = " " + n.className + " ", a = 0; s = o[a++];)
                            if (r.indexOf(" " + s + " ") > -1) {
                                for (var l, c = 0, d = i[s].fns, u = !1; l = d[c++];) l.fn.call(t(n), e) === !1 && (u = !0);
                                if (u && e.preventDefault(), u || e.isPropagationStopped()) return;
                                o.splice(--a, 1)
                            }
                    while (o.length && (n = n.parentNode))
                }
            },
            _buildLiveEventFn: function(e, i) {
                var n = this;
                return function(s) {
                    var r = [n._name, ((s.data || (s.data = {})).domElem = t(this)).closest(n.buildSelector()), !0],
                        a = o.apply(null, i ? r.concat([e, s]) : r);
                    return a && !i && e ? e.apply(a, arguments) : void 0
                }
            },
            liveInitOnEvent: function(e, t, i) {
                return this.liveBindTo(e, t, i, !0)
            },
            liveBindTo: function(e, n, o, s) {
                (!n || t.isFunction(n)) && (o = n, n = e, e = i), e && "string" != typeof e || (e = {
                    elem: e
                }), e.elemName && (e.elem = e.elemName);
                var r = this;
                return e.elem && e.elem.indexOf(" ") > 0 ? (e.elem.split(" ").forEach(function(t) {
                    r._liveClassBind(w(r._name, t, e.modName, e.modVal), n, o, s)
                }), r) : r._liveClassBind(w(r._name, e.elem, e.modName, e.modVal), n, o, s)
            },
            liveUnbindFrom: function(e, n, o) {
                (!n || t.isFunction(n)) && (o = n, n = e, e = i);
                var s = this;
                return e && e.indexOf(" ") > 1 ? (e.split(" ").forEach(function(e) {
                    s._liveClassUnbind(w(s._name, e), n, o)
                }), s) : s._liveClassUnbind(w(s._name, e), n, o)
            },
            _liveInitOnBlockEvent: function(e, t, i, n) {
                var o = this._name;
                return b[t].on(e, function(e) {
                    if (e.block.domElem) {
                        var t = arguments,
                            s = e.block[n](o);
                        i && s.forEach(function(e) {
                            i.apply(e, t)
                        })
                    }
                }), this
            },
            liveInitOnBlockEvent: function(e, t, i) {
                return this._liveInitOnBlockEvent(e, t, i, "findBlocksOn")
            },
            liveInitOnBlockInsideEvent: function(e, t, i) {
                return this._liveInitOnBlockEvent(e, t, i, "findBlocksOutside")
            },
            liveInitOnBlockInit: function(e, t) {
                return this.liveInitOnBlockEvent("init", e, t)
            },
            liveInitOnBlockInsideInit: function(e, t) {
                return this.liveInitOnBlockInsideEvent("init", e, t)
            },
            on: function(e, t, i, n, o) {
                return e.jquery ? this._liveCtxBind(e, t, i, n, o) : this.__base(e, t, i, n)
            },
            un: function(e, t, i, n) {
                return e.jquery ? this._liveCtxUnbind(e, t, i, n) : this.__base(e, t, i)
            },
            liveCtxBind: function(e, t, i, n, o) {
                return this._liveCtxBind(e, t, i, n, o)
            },
            _liveCtxBind: function(e, n, o, s, r) {
                var a = this;
                if ("string" == typeof n)
                    if (t.isFunction(o) && (r = s, s = o, o = i), n.indexOf(" ") > -1) n.split(" ").forEach(function(t) {
                        a._liveCtxBind(e, t, o, s, r)
                    });
                    else {
                        var l = a._buildCtxEventName(n),
                            c = g[l] || (g[l] = {
                                counter: 0,
                                ctxs: {}
                            });
                        e.each(function() {
                            var e = t.identify(this),
                                i = c.ctxs[e];
                            i || (i = c.ctxs[e] = {}, ++c.counter), i[t.identify(s) + (r ? t.identify(r) : "")] = {
                                fn: s,
                                data: o,
                                ctx: r
                            }
                        })
                    } else t.each(n, function(t, i) {
                    a._liveCtxBind(e, t, i, o)
                });
                return a
            },
            liveCtxUnbind: function(e, t, i, n) {
                return this._liveCtxUnbind(e, t, i, n)
            },
            _liveCtxUnbind: function(e, i, n, o) {
                var s = this,
                    r = g[i = s._buildCtxEventName(i)];
                return r && (e.each(function() {
                    var e, i = t.identify(this, !0);
                    i && (e = r.ctxs[i]) && (n && delete e[t.identify(n) + (o ? t.identify(o) : "")], (!n || t.isEmptyObject(e)) && (r.counter--, delete r.ctxs[i]))
                }), r.counter || delete g[i]), s
            },
            _extractElemNameFrom: function(e) {
                if (e.__bemElemName) return e.__bemElemName;
                var t = e[0].className.match(this._buildElemNameRE());
                return t ? t[1] : i
            },
            extractParams: l,
            _buildModClassPrefix: function(e, t) {
                return w(this._name) + (t ? k + ("string" == typeof t ? t : this._extractElemNameFrom(t)) : "") + M + e + M
            },
            _buildModValRE: function(e, t, i) {
                return new RegExp("(\\s|^)" + this._buildModClassPrefix(e, t) + "(" + v + ")(?=\\s|$)", i)
            },
            _buildElemNameRE: function() {
                return new RegExp(this._name + k + "(" + v + ")(?:\\s|$)")
            },
            buildSelector: function(e, t, i) {
                return "." + w(this._name, e, t, i)
            },
            getBlockByUniqId: function(e) {
                return p[e]
            },
            getWindowSize: function() {
                return {
                    width: u.width(),
                    height: u.height()
                }
            }
        });
        t(function() {
            e.DOM.scope = t("body")
        })
    }(BEM, jQuery), $.inheritSelf(BEM.DOM, {}, {
        init: function() {
            var e = $(".i-model");
            return e.length && e.each(function(e, t) {
                $(t).bem("i-model")
            }), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl("i-bem__dom", {
        getInitialMods: function() {
            var e = this.getMods();
            return delete e.js, e
        },
        liveBindTo: function(e, t, i, n) {
            var o = [].slice.call(arguments, 0);
            if (o.length < 3 || o.length > 4) throw new Error("call liveBindTo method with incorrect arguments");
            if (n = o.pop(), i = o.pop(), t = o.pop(), !(n instanceof Function) || "string" != typeof i || "string" != typeof t) throw new Error("call liveBindTo method with incorrect arguments");
            return 1 === o.length ? (e = o.pop(), "string" == typeof e && (e = this.elem(e))) : e = this.domElem, i = this._buildEventName(i), e.on(i, this.buildSelector(t), n.bind(this)), this._delegateSubscribedElems = (this._delegateSubscribedElems || jQuery()).add(e), this
        },
        destruct: function() {
            return this._delegateSubscribedElems && this._delegateSubscribedElems.unbind("." + this._uniqId), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl("i-bem__dom", {
        getInitialMods: function() {
            var e = this.getMods();
            return delete e.js, e
        },
        liveBindTo: function(e, t, i, n) {
            var o = [].slice.call(arguments, 0);
            if (o.length < 3 || o.length > 4) throw new Error("call liveBindTo method with incorrect arguments");
            if (n = o.pop(), i = o.pop(), t = o.pop(), !(n instanceof Function) || "string" != typeof i || "string" != typeof t) throw new Error("call liveBindTo method with incorrect arguments");
            return 1 === o.length ? (e = o.pop(), "string" == typeof e && (e = this.elem(e))) : e = this.domElem, i = this._buildEventName(i), e.on(i, this.buildSelector(t), n.bind(this)), this._delegateSubscribedElems = (this._delegateSubscribedElems || jQuery()).add(e), this
        },
        destruct: function() {
            return this._delegateSubscribedElems && this._delegateSubscribedElems.unbind("." + this._uniqId), this.__base.apply(this, arguments)
        }
    }),
    function() {
        String.prototype.trim || (String.prototype.trim = function() {
            for (var e = this.replace(/^\s\s*/, ""), t = /\s/, i = e.length; t.test(e.charAt(--i)););
            return e.slice(0, i + 1)
        })
    }(), BEM.decl("i-state", null, {
        initNs: function(e) {
            var t = this;
            return {
                get: function(i) {
                    return t.get(e + (i ? "." + i : ""))
                },
                set: function(i, n) {
                    var o = this;
                    return n || "object" != typeof i ? t.set(e + (i ? "." + i : ""), n) : Object.keys(i).forEach(function(e) {
                        o.set(e, i[e])
                    }), this
                }
            }
        },
        get: function() {},
        set: function(e, t) {
            for (var i, n = e.split("."), o = this.get();
                (i = n.shift()) && n.length;) o = o[i] || (o[i] = {});
            return o[i] = t, this
        },
        _getParam: function(path, state) {
            try {
                return eval('state["' + path.split(".").join('"]["') + '"]')
            } catch (err) {
                return null
            }
        }
    }),
    function() {
        var e = {};
        BEM.decl("i-state", null, {
            get: function(t) {
                return t ? this._getParam(t, e) : e
            }
        })
    }(), BEM.decl("i-global", null, {
        getBemjson: function() {
            return {
                block: "i-global",
                mods: {
                    "public-params": !0
                }
            }
        }
    }), BEM.DOM.decl("i-global", {
        onSetMod: {
            js: function() {
                this.del(this.__self._params = $.extend({}, this.params), "uniqId", "name");
                var e = this.__self._params;
                e["passport-msg"] || (e["passport-msg"] = e.id), void 0 === e["show-counters"] && (e["show-counters"] = Math.round(100 * Math.random()) <= e["show-counters-percent"]), e.locale = e.lang, $(function() {
                    e.oframebust && Lego.oframebust(e.oframebust)
                })
            }
        },
        getDefaultParams: function() {
            return {
                id: "",
                login: Lego.isSessionValid() ? $.cookie("yandex_login") || "" : "",
                yandexuid: $.cookie("yandexuid"),
                lang: "ru",
                tld: "ru",
                retpath: encodeURI($.decodeURI(location.href)),
                "passport-host": "https://passport.yandex.ru",
                "pass-host": "https://pass.yandex.ru",
                "social-host": "https://social.yandex.ru",
                "lego-path": "/lego",
                "show-counters-percent": 100
            }
        }
    }, {
        param: function(e) {
            return (this._params || {})[e]
        }
    }),
    function() {
        var state;
        BEM.decl("i-global", null, {
            get: function(path) {
                state = state || BEM.blocks["i-global"].param("jsParams");
                try {
                    return eval('state["' + path.split(".").join('"]["') + '"]')
                } catch (err) {}
            },
            param: function(e) {
                return "retpath" === e ? window.location.href : this.__base(e)
            }
        }), BEM.JSON.decl("i-global", {
            onBlock: function(e) {
                e.params().params = BEM.blocks["i-global"]._params
            }
        })
    }(), BEM.DOM.decl("i-global", {
        getDefaultParams: function() {
            var e = this.__base.apply(this, arguments);
            return e.oframebust = {
                "*metrika*.yandex.(ru|ua|com|com.tr|kz|by)": "",
                "webvisor.com": "",
                "*.webvisor.com": "",
                "tv.mtrs.yandex-team.ru": ""
            }, e
        }
    }),
    function(e) {
        e || (e = window.Lego = {}), e.isSessionValid = function() {
            return !!e.getCookie("yandex_login")
        }
    }(window.Lego),
    function(e) {
        var t = "__" + Number(new Date) + "promiseCallback";
        BEM.decl("i-promise", null, {
            createChain: function(i) {
                return i[t] = e.identify(), this.intercept.bind(i, i)
            },
            intercept: function(e, i) {
                var n = e[t];
                return function() {
                    return n !== e[t] || e._isDestructing ? void 0 : i.apply(e, arguments)
                }
            }
        })
    }(jQuery),
    function(e) {
        var t = function(e) {
            this._res = e, this._isFulfilled = !!arguments.length, this._isRejected = !1, this._fulfilledCallbacks = [], this._rejectedCallbacks = [], this._progressCallbacks = []
        };
        t.prototype = {
            valueOf: function() {
                return this._res
            },
            isFulfilled: function() {
                return this._isFulfilled
            },
            isRejected: function() {
                return this._isRejected
            },
            isResolved: function() {
                return this._isFulfilled || this._isRejected
            },
            fulfill: function(e) {
                this.isResolved() || (this._isFulfilled = !0, this._res = e, this._callCallbacks(this._fulfilledCallbacks, e), this._fulfilledCallbacks = this._rejectedCallbacks = this._progressCallbacks = i)
            },
            reject: function(e) {
                this.isResolved() || (this._isRejected = !0, this._res = e, this._callCallbacks(this._rejectedCallbacks, e), this._fulfilledCallbacks = this._rejectedCallbacks = this._progressCallbacks = i)
            },
            notify: function(e) {
                this.isResolved() || this._callCallbacks(this._progressCallbacks, e)
            },
            then: function(e, i, n) {
                var o, s = new t;
                return this._isRejected || (o = {
                    promise: s,
                    fn: e
                }, this._isFulfilled ? this._callCallbacks([o], this._res) : this._fulfilledCallbacks.push(o)), this._isFulfilled || (o = {
                    promise: s,
                    fn: i
                }, this._isRejected ? this._callCallbacks([o], this._res) : this._rejectedCallbacks.push(o)), this.isResolved() || this._progressCallbacks.push({
                    promise: s,
                    fn: n
                }), s
            },
            fail: function(e) {
                return this.then(i, e)
            },
            always: function(e) {
                var t = this,
                    i = function() {
                        return e(t)
                    };
                return this.then(i, i)
            },
            progress: function(e) {
                return this.then(i, i, e)
            },
            spread: function(e, t) {
                return this.then(function(t) {
                    return e.apply(this, t)
                }, t)
            },
            done: function() {
                this.fail(s)
            },
            delay: function(e) {
                return this.then(function(i) {
                    var n = new t;
                    return setTimeout(function() {
                        n.fulfill(i)
                    }, e), n
                })
            },
            timeout: function(e) {
                var i = new t,
                    n = setTimeout(function() {
                        i.reject(Error("timed out"))
                    }, e);
                return i.sync(this), i.always(function() {
                    clearTimeout(n)
                }), i
            },
            sync: function(e) {
                var t = this;
                e.then(function(e) {
                    t.fulfill(e)
                }, function(e) {
                    t.reject(e)
                })
            },
            _callCallbacks: function(e, t) {
                var i = e.length;
                if (i) {
                    var s = this.isResolved(),
                        a = this.isFulfilled();
                    o(function() {
                        for (var o, l, c, d = 0; i > d;)
                            if (o = e[d++], l = o.promise, c = o.fn, r(c)) {
                                var u;
                                try {
                                    u = c(t)
                                } catch (h) {
                                    l.reject(h);
                                    continue
                                }
                                s ? n.isPromise(u) ? function(e) {
                                    u.then(function(t) {
                                        e.fulfill(t)
                                    }, function(t) {
                                        e.reject(t)
                                    })
                                }(l) : l.fulfill(u) : l.notify(u)
                            } else s ? a ? l.fulfill(t) : l.reject(t) : l.notify(t)
                    })
                }
            }
        };
        var i, n = {
                promise: function(e) {
                    return arguments.length ? this.isPromise(e) ? e : new t(e) : new t
                },
                when: function(e, t, i, n) {
                    return this.promise(e).then(t, i, n)
                },
                fail: function(e, t) {
                    return this.when(e, i, t)
                },
                always: function(e, t) {
                    return this.promise(e).always(t)
                },
                progress: function(e, t) {
                    return this.promise(e).progress(t)
                },
                spread: function(e, t, i) {
                    return this.promise(e).spread(t, i)
                },
                done: function(e) {
                    this.isPromise(e) && e.done()
                },
                isPromise: function(e) {
                    return e && r(e.then)
                },
                valueOf: function(e) {
                    return this.isPromise(e) ? e.valueOf() : e
                },
                isFulfilled: function(e) {
                    return this.isPromise(e) ? e.isFulfilled() : !0
                },
                isRejected: function(e) {
                    return this.isPromise(e) ? e.isRejected() : !1
                },
                isResolved: function(e) {
                    return this.isPromise(e) ? e.isResolved() : !0
                },
                fulfill: function(e) {
                    return this.when(e, i, function(e) {
                        return e
                    })
                },
                reject: function(e) {
                    return this.when(e, function(e) {
                        var i = new t;
                        return i.reject(e), i
                    })
                },
                resolve: function(e) {
                    return this.isPromise(e) ? e : this.when(e)
                },
                invoke: function(e) {
                    try {
                        return this.promise(e.apply(null, a.call(arguments, 1)))
                    } catch (t) {
                        return this.reject(t)
                    }
                },
                forEach: function(e, t, i, n) {
                    for (var o = n ? n.length : e.length, s = 0; o > s;) this.when(e[n ? n[s] : s], t, i), ++s
                },
                all: function(e) {
                    var i = new t,
                        o = c(e),
                        s = o ? d(e) : u(e),
                        r = s.length,
                        a = o ? [] : {};
                    if (!r) return i.fulfill(a), i;
                    var l = r,
                        h = function() {
                            if (!--l) {
                                for (var t = 0; r > t;) a[s[t]] = n.valueOf(e[s[t++]]);
                                i.fulfill(a)
                            }
                        },
                        m = function(e) {
                            i.reject(e)
                        };
                    return this.forEach(e, h, m, s), i
                },
                allResolved: function(e) {
                    var i = new t,
                        n = c(e),
                        o = n ? d(e) : u(e),
                        s = o.length,
                        r = n ? [] : {};
                    if (!s) return i.fulfill(r), i;
                    var a = function() {
                        --s || i.fulfill(e)
                    };
                    return this.forEach(e, a, a, o), i
                },
                any: function(e) {
                    var i = new t,
                        n = e.length;
                    if (!n) return i.reject(Error()), i;
                    var o, s = 0,
                        r = function(e) {
                            i.fulfill(e)
                        },
                        a = function(e) {
                            s || (o = e), ++s === n && i.reject(o)
                        };
                    return this.forEach(e, r, a), i
                },
                delay: function(e, t) {
                    return this.promise(e).delay(t)
                },
                timeout: function(e, t) {
                    return this.promise(e).timeout(t)
                }
            },
            o = function() {
                if ("object" == typeof process) return process.nextTick;
                if (e.setImmediate) return e.setImmediate;
                var t = [],
                    i = function() {
                        var e = t,
                            i = 0,
                            n = t.length;
                        for (t = []; n > i;) e[i++]()
                    };
                if (e.postMessage) {
                    var n = !0;
                    if (e.attachEvent) {
                        var o = function() {
                            n = !1
                        };
                        e.attachEvent("onmessage", o), e.postMessage("__checkAsync", "*"), e.detachEvent("onmessage", o)
                    }
                    if (n) {
                        var s = "__promise" + +new Date,
                            r = function(e) {
                                e.data === s && (e.stopPropagation && e.stopPropagation(), i())
                            };
                        return e.addEventListener ? e.addEventListener("message", r, !0) : e.attachEvent("onmessage", r),
                            function(i) {
                                1 === t.push(i) && e.postMessage(s, "*")
                            }
                    }
                }
                var a = e.document;
                if ("onreadystatechange" in a.createElement("script")) {
                    var l = function() {
                        var e = a.createElement("script");
                        e.onreadystatechange = function() {
                            e.parentNode.removeChild(e), e = e.onreadystatechange = null, i()
                        }, (a.documentElement || a.body).appendChild(e)
                    };
                    return function(e) {
                        1 === t.push(e) && l()
                    }
                }
                return function(e) {
                    setTimeout(e, 0)
                }
            }(),
            s = function(e) {
                o(function() {
                    throw e
                })
            },
            r = function(e) {
                return "function" == typeof e
            },
            a = Array.prototype.slice,
            l = Object.prototype.toString,
            c = Array.isArray || function(e) {
                return "[object Array]" === l.call(e)
            },
            d = function(e) {
                for (var t = [], i = 0, n = e.length; n > i;) t.push(i++);
                return t
            },
            u = Object.keys || function(e) {
                var t = [];
                for (var i in e) e.hasOwnProperty(i) && t.push(i);
                return t
            };
        "object" == typeof exports ? module.exports = n : "function" == typeof define ? define(function(e, t, i) {
            i.exports = n
        }) : e.Vow = n
    }(this),
    function() {
        var e = function(t) {
            this.name = "CommonError", this.message = t, Error.captureStackTrace ? Error.captureStackTrace(this, e) : this.stack = (new Error).stack
        };
        e.prototype = new Error, e.prototype.constructor = e, e.prototype.serialize = function() {
            return {
                name: this.name || "Unknown",
                args: [this.message || "Unknown error"]
            }
        };
        var t = function(i) {
            var n = t.STATUS_CODES[String(i)] || "Unknown";
            e.call(this, n), this.status = Number(i), this.name = "HttpError"
        };
        t.prototype = new e, t.prototype.constructor = t, t.prototype.serialize = function() {
            var t = e.prototype.serialize.call(this);
            return t.args = [this.status], t
        }, t.STATUS_CODES = {
            100: "Continue",
            101: "Switching Protocols",
            102: "Processing",
            200: "OK",
            201: "Created",
            202: "Accepted",
            203: "Non-Authoritative Information",
            204: "No Content",
            205: "Reset Content",
            206: "Partial Content",
            207: "Multi-Status",
            300: "Multiple Choices",
            301: "Moved Permanently",
            302: "Moved Temporarily",
            303: "See Other",
            304: "Not Modified",
            305: "Use Proxy",
            307: "Temporary Redirect",
            400: "Bad Request",
            401: "Unauthorized",
            402: "Payment Required",
            403: "Forbidden",
            404: "Not Found",
            405: "Method Not Allowed",
            406: "Not Acceptable",
            407: "Proxy Authentication Required",
            408: "Request Time-out",
            409: "Conflict",
            410: "Gone",
            411: "Length Required",
            412: "Precondition Failed",
            413: "Request Entity Too Large",
            414: "Request-URI Too Large",
            415: "Unsupported Media Type",
            416: "Requested Range Not Satisfiable",
            417: "Expectation Failed",
            418: "I'm a teapot",
            422: "Unprocessable Entity",
            423: "Locked",
            424: "Failed Dependency",
            425: "Unordered Collection",
            426: "Upgrade Required",
            428: "Precondition Required",
            429: "Too Many Requests",
            431: "Request Header Fields Too Large",
            500: "Internal Server Error",
            501: "Not Implemented",
            502: "Bad Gateway",
            503: "Service Unavailable",
            504: "Gateway Time-out",
            505: "HTTP Version Not Supported",
            506: "Variant Also Negotiates",
            507: "Insufficient Storage",
            509: "Bandwidth Limit Exceeded",
            510: "Not Extended",
            511: "Network Authentication Required"
        }, BEM.decl("i-errors", null, {
            CommonError: e,
            HttpError: t,
            isHttpError: function(e, i) {
                return e instanceof t && (i ? e.status === i : !0)
            },
            serialize: function(t) {
                return t instanceof e ? t.serialize() : e.prototype.serialize.call(t)
            },
            createError: function(e) {
                var t;
                if (this[e.name]) {
                    var i = this[e.name],
                        n = function() {
                            i.apply(this, e.args)
                        };
                    n.prototype = i.prototype, t = new n
                } else e.name && console.error(e.name + " is not registered in i-errors"), t = new Error(e.args ? e.args[0] : "Unknow error"), t.name = e.name || t.name, t.message = e.message || t.message;
                return t
            }
        })
    }(),
    function() {
        var e = BEM.blocks["i-errors"];
        e.HttpError.hasStatus = function(t, i) {
            return e.isHttpError(t) && t.status === i
        }
    }(), BEM.decl("i-api-request", null, {
        _HttpError: function() {
            return BEM.blocks["i-errors"].HttpError
        }(),
        _normalizeResource: function(e) {
            return String(e).replace(/^\/|\/$/g, "")
        },
        _checkDropCache: function(e) {
            return "get" !== e
        },
        _normalizeBody: function(e) {
            return "object" == typeof e ? JSON.stringify(e) : String(e)
        },
        _parse: function(e, t) {
            try {
                e.fulfill(JSON.parse(t))
            } catch (i) {
                e.reject(i)
            }
        },
        isHttpError: function() {
            return console.error("Deprecated use BEM.blocks.i-errors.isHttpError"), BEM.blocks["i-errors"].apply(BEM.blocks["i-errors"], arguments)
        },
        _get: function(e, t) {
            return this._request("get", e, t)
        },
        _getCacheKey: function(e, t) {
            return e + "?" + (t && Object.keys(t).sort().map(function(e) {
                var i = t[e];
                return "object" == typeof i && (i = JSON.stringify(i)), e + "=" + i
            }).join("&"))
        },
        _requestCache: BEM.blocks["i-state"].initNs("i-api-request.requestCache"),
        _getCacheStorage: function() {
            var e = this._requestCache.get(this._name);
            return e || (e = {}, this._requestCache.set(this._name, e)), e
        },
        _setCache: function(e, t) {
            this._getCacheStorage()[e] = t
        },
        _getCache: function(e) {
            return this._getCacheStorage()[e]
        },
        dropCache: function() {
            this._requestCache.set(this._name, {})
        },
        get: function(e, t) {
            var i = t && t.cacheKey || this._getCacheKey(e, t),
                n = this._getCache(i);
            return n || (n = this._get(e, t), this._setCache(i, n)), n
        }
    }), BEM.decl("i-api-request", null, {
        _cache: !0,
        get: function(e, t) {
            var i, n = t && t.hasOwnProperty("cache") ? t.cache : this._cache,
                o = this;
            return n === !1 ? this._get(e, t) : (t = t || {}, t.cacheKey = this._getCacheKey(e, t), i = this.__base.apply(this, arguments), i.fail(function() {
                delete o._getCacheStorage()[t.cacheKey]
            }), i)
        },
        _abortOneRequest: function(e) {
            var t, i;
            for (t = 0; t < this._activeXhrs.length; t++)
                if (this._activeXhrs[t].promise === e) {
                    i = this._activeXhrs[t], this._activeXhrs.splice(t, 1);
                    break
                }
            i && i.xhr.abort()
        },
        abort: function(e) {
            var t;
            if (this._activeXhrs)
                if (e)
                    if (e instanceof Array)
                        for (t = 0; t < e.length; t++) this._abortOneRequest(e[t]);
                    else this._abortOneRequest(e);
            else
                for (; this._activeXhrs.length;) this._activeXhrs.pop().xhr.abort()
        },
        _prepareData: function(e, t) {
            return t = t || {}, t.resource = this._normalizeResource(e), t.ncrd = Date.now(), t.params && (t.params = JSON.stringify(t.params)), t && t.body && (t.body = this._normalizeBody(t.body)), t
        },
        _createAjaxUrl: function(e) {
            return "/ajax/" + this._name + "/" + e
        },
        _shouldRetry: function() {
            return Vow.reject()
        },
        _request: function(e, t, i) {
            return i = this._prepareData(t, i), this._checkDropCache(e, t, i) && this.dropCache(), this._activeXhrs = this._activeXhrs || [], this._makeAjax(e, t, i)
        },
        _makeAjax: function e(t, i, n) {
            var o = Vow.promise(),
                s = this;
            return BEM.channel("i-api-request").trigger("beforerequest"), BEM.blocks["i-api-request"].trigger("beforerequest"), this._activeXhrs.push({
                promise: o,
                xhr: jQuery.ajax({
                    type: n.body ? "POST" : "GET",
                    url: this._createAjaxUrl(t),
                    data: n,
                    complete: function(r) {
                        r.status >= 200 && r.status < 300 ? s._parse(o, r.responseText) : s._shouldRetry(r, t, i, n).then(function() {
                            e.call(s, t, i, n).then(o.fulfill.bind(o), o.reject.bind(o)).done()
                        }).fail(function(e) {
                            var t = e || new s._HttpError(r.status);
                            BEM.channel("i-api-request").trigger("error", t), BEM.blocks["i-api-request"].trigger("error", t), o.reject(t)
                        }).done(), s._activeXhrs = s._activeXhrs.filter(function(e) {
                            return r !== e.xhr
                        }), BEM.channel("i-api-request").trigger("afterrequest"), BEM.blocks["i-api-request"].trigger("afterrequest")
                    }
                })
            }), o
        }
    }), BEM.decl("i-api-request", null, {
        abort: function() {
            throw new Error("not implmented")
        },
        _prepareData: function(e, t) {
            return t = t || {}, t.resource = this._normalizeResource(e), t.ncrd = Date.now(), t.body && (t.body = this._normalizeBody(t.body)), t
        },
        _makeAjax: function(e, t, i) {
            var n = JSON.stringify([t, i]),
                o = this._name;
            return BEM.blocks["i-proxy"].callBlockMethod(o, e, n)
        }
    }), BEM.decl("i-router", null, {
        _state: BEM.blocks["i-state"].initNs("i-router"),
        set: function(e, t) {
            return console.error(new Error("i-router.set is deprecated")), this.set = this._state.set.bind(this._state), this.set(e, t), this
        },
        get: function(e) {
            return console.error(new Error("i-router.get is deprecated")), this.get = this._state.get.bind(this._state), this.get(e)
        },
        getUri: function() {
            return "http://" + this.getHost() + this.getPath()
        },
        getParams: function() {
            return this._state.get("params")
        },
        getReq: function() {
            return this._state.get("req")
        },
        getRes: function() {
            return this._state.get("res")
        },
        getCookies: function() {
            return this._state.get("cookies")
        },
        getPath: function() {
            return this._state.get("path")
        },
        getMatchers: function() {
            return this._state.get("matchers")
        },
        REQUEST_METHODS: ["GET", "POST", "PUT", "DELETE"],
        _routeList: [],
        define: function(e, t, i) {
            return Array.isArray(e) && !t ? void e.forEach(function(e) {
                this.define.apply(this, e)
            }, this) : (i ? (e = e.toUpperCase(), e.split(",").every(function(e) {
                if (-1 === this.REQUEST_METHODS.indexOf(e)) throw new Error("Unexpected request method: " + e);
                return !0
            }, this)) : (i = t, t = e, e = !1), void this._routeList.push({
                reqMethod: e,
                reqPath: t,
                reqHandler: this._createHandler(i)
            }))
        },
        _getRoute: function(e, t) {
            var i, n = [],
                o = e.replace(/\/{2,}/g, "/");
            return this._routeList.some(function(e) {
                if (t && e.reqMethod && -1 === e.reqMethod.indexOf(t)) return !1;
                if ("string" == typeof e.reqPath) {
                    if (o === e.reqPath) return i = e, !0
                } else if (n = o.match(e.reqPath)) return i = e, !0;
                return !1
            }), i ? {
                handler: i.reqHandler,
                matchers: n || []
            } : null
        },
        setPath: function() {
            throw new Error("Not implemented")
        },
        replacePath: function() {
            throw new Error("Not implemented")
        },
        _createHandler: function() {},
        _execHandler: function() {},
        escapeHTML: function(e) {
            return console.error(new Error("i-router.escapeHTML deprecated use BN('i-content').escapeHTML()")), this.escapeHTML = BEM.blocks["i-content"].escapeHTML, this.escapeHTML(e)
        },
        unescapeHTML: function(e) {
            return console.error(new Error("i-router.unescapeHTML deprecated use BN('i-content').unescapeHTML()")), this.unescapeHTML = BEM.blocks["i-content"].unescapeHTML, this.unescapeHTML(e)
        }
    }), BEM.decl("i-router", null, {
        getTld: function(e) {
            var t = String(this.getHost()).match(/(com\.tr|com|ru|ua|kz|by)\.?$/);
            if (t) return t[e ? 0 : 1];
            throw new Error("Unsuported host " + this.getHost())
        }
    }), BEM.decl("i-router", null, {
        getUri: function() {
            return this.getProtocol() + "//" + this.getHost() + this.getPath()
        },
        getPath: function() {
            return this.__base().replace(/^\/+/, "/")
        },
        getPathname: function() {
            var e = this.getPath();
            return e.split("?")[0]
        }
    }),
    function() {
        function e() {
            return location.pathname + location.search
        }
        BEM.decl("i-router", null, {
            _historyStateSupported: function() {
                return Boolean(history && history.pushState)
            },
            init: function() {
                var t = this;
                this._state.set("path", e()), this._lastPath = this.getPath(), this._lastHandler = this._prepearRoute(this._lastPath), this._historyStateSupported() && (jQuery(document).delegate("a", "click", function(e) {
                    e.metaKey || e.ctrlKey || this.protocol !== location.protocol || this.host !== location.host || this.attributes.target || t.setPath(this.pathname + this.search + this.hash) && e.preventDefault()
                }), jQuery(window).bind("popstate", function() {
                    t._state.set("path", e()), t._onChange()
                }), jQuery(window).bind("pageshow", function() {
                    t._prepearRoute()
                }))
            },
            define: function() {
                this.__base.apply(this, arguments), this._lastPath = this.getPath(), this._lastHandler = this._prepearRoute(this._lastPath)
            },
            setPath: function(e, t) {
                return this._changePath.call(this, "push", e, t)
            },
            replacePath: function(e, t) {
                return this._changePath.call(this, "replace", e, t)
            },
            _fallback: function(e, t) {
                return e && (window.location.href = t), !1
            },
            _changePath: function(e, t, i) {
                return this._state.set("path", t), this._historyStateSupported() ? (history[e + "State"](void 0, void 0, t), this._onChange(), !0) : this._fallback(i, t)
            },
            reload: function(e) {
                e && console.error(e instanceof Error ? e.stack : e), setTimeout(function() {
                    location.reload()
                })
            },
            missing: function() {
                return this.reload()
            },
            _onChange: function() {
                var e, t = this.getPath();
                this._lastPath !== t && (e = this._prepearRoute(), BEM.channel("i-router").trigger("update", {
                    path: t
                }), this.trigger("update", {
                    path: t
                }), e ? this._execHandler(e).fail(this.reload).done() : this.missing(), this._lastPath = t)
            },
            _prepearRoute: function(e) {
                var t, i, n, o = e || location.pathname + location.search,
                    s = o.indexOf("?");
                return s > -1 ? (t = o.substr(0, s), i = o.substr(s + 1)) : (t = o, i = ""), n = this._getRoute(t), this._state.set("matchers", n ? n.matchers : []), this._state.set("path", o), this._readParams(i || ""), n && n.handler
            },
            _createHandler: function(e) {
                var t = this;
                return {
                    enter: function() {
                        return BEM.blocks[e].init(t._state.get("matchers"))
                    },
                    update: function() {
                        return BEM.blocks[e].update(t._state.get("matchers"), t._lastPath, t.getPath())
                    },
                    leave: function() {
                        return BEM.blocks[e].destruct()
                    }
                }
            },
            _execHandler: function(e) {
                if (e !== this._lastHandler) {
                    var t = this._lastHandler ? Vow.promise(this._lastHandler.leave()) : Vow.fulfill();
                    return this._lastHandler = e, t.then(e.enter)
                }
                return e.update()
            },
            getHost: function() {
                return location.host
            },
            _readParams: function(e) {
                this._state.set("params", String(1 === arguments.length ? e : location.search).split("&").map(function(e) {
                    var t, i, n = e.replace(/\+/g, "%20"),
                        o = n.indexOf("=");
                    if (o > -1) t = n.substr(0, o), i = n.substr(o + 1);
                    else {
                        if (!n) return null;
                        t = n, i = ""
                    }
                    try {
                        t = decodeURIComponent(t), i = decodeURIComponent(i)
                    } catch (s) {}
                    return [t, i]
                }).reduce(function(e, t) {
                    return t && (e[t[0]] = t[1]), e
                }, {}))
            },
            setParams: function(e, t, i) {
                return this._changeParams.call(this, "set", e, t, i)
            },
            replaceParams: function(e, t, i) {
                return this._changeParams.call(this, "replace", e, t, i)
            },
            _changeParams: function(e, t, i, n) {
                var o = "",
                    s = t;
                return n && (s = jQuery.extend({}, this.getParams(), t)), o += jQuery.param(s), location.search !== "?" + o ? (this._state.set("params", s), this[e + "Path"](location.pathname + (o ? "?" + o : ""), i)) : void 0
            },
            encodedParams: function() {
                return location.search
            }
        }), BEM.blocks["i-router"].init()
    }(), BEM.decl("i-router", null, {
        getProtocol: function() {
            return window.document.location.protocol
        },
        _changeParams: function(e, t, i, n) {
            var o = "",
                s = t;
            return n && (s = jQuery.extend({}, this.getParams(), t)), s && "object" == typeof s && (s = Object.keys(s).reduce(function(e, t) {
                var i = s[t];
                return null !== i && void 0 !== i && (e[t] = i), e
            }, {})), o += jQuery.param(s), location.search !== "?" + o ? (this._state.set("params", s), this[e + "Path"](this.getPathname() + (o ? "?" + o : ""), i)) : void 0
        },
        setOnlyPath: function(e, t) {
            var i = jQuery.param(this._state.get("params"));
            this.setPath(e + (i ? "?" + i : ""), t)
        },
        replaceOnlyPath: function(e, t) {
            var i = jQuery.param(this._state.get("params"));
            this.replacePath(e + (i ? "?" + i : ""), t)
        }
    }), BEM.decl("i-locale", null, {
        getLang: function() {
            return BEM.blocks["i-global"].get("lang")
        }
    }), BEM.decl("i-response", null, {
        error: function() {
            setTimeout(function() {
                location.reload()
            })
        }
    });
var count = 0;
! function(e) {
    e.JSON._ctx.prototype.wait = function() {
        if (this._threads = this._threads ? this._threads + 1 : 1, !this._globalThread) throw new Error("Cant wait in synchronous build");
        this._globalThread.count++
    }, e.JSON._ctx.prototype._buildBemSync = e.JSON._ctx.prototype._buildBem, e.JSON._ctx.prototype._buildBem = function() {
        0 === this._threads && this._buildBemSync()
    }, e.JSON._ctx.prototype._runDecls = function() {
        if (this._fns.length && !this._isStopped && 0 === this._threads) {
            try {
                this._fns.shift()(this)
            } catch (e) {
                return this.remove(), void this._declErrorHandler(e)
            }
            this._runDecls()
        }
    }, e.JSON._ctx.prototype.resume = function() {
        if (this._threads = Number(this._threads) - 1, !this._globalThread) throw new Error("Cant resume in synchronous build");
        this._globalThread.count--, this._runDecls(), this._buildBem(), 0 === this._globalThread.count && this._globalThread.callback()
    }, e.JSON._ctx.prototype._findDecls = function(t, i) {
        var n = t.block || i && i.block,
            o = t.elem,
            s = n && e.JSON._decls[n];
        return s ? o ? Boolean(s._elem || s["_elem__" + o]) : Boolean(s._block) : !1
    }, e.JSON._ctx.prototype._buildSkippedContent = function(t, i, n, o, s) {
        var r, a;
        t.content && (a = e.JSON._type(t.content), r = !t.block || o && t.block === o.block && t.elem ? o : t, "object" === a && (t.content._parent = t), t.content = this._buildWithNewCtx(t.content, 1, 1, r, t, a))
    }, e.JSON._ctx.prototype._buildWithNewCtx = function(t, i, n, o, s, r) {
        if ("object" !== r || this._findDecls(t, o)) {
            var a = new e.JSON._ctx(t, i, n, o, s);
            return a._globalThread = this._globalThread, a._threads = 0, a.build()
        }
        return this._buildSkippedContent(t, i, n, o, s), t
    }, e.JSON.buildAsync = function(t, i) {
        var n, o = {
                count: 0,
                callback: function() {
                    i(n)
                }
            },
            s = new e.JSON._ctx(t);
        s._globalThread = o, s._threads = 0, n = s.build(), 0 === o.count && o.callback()
    }, e.JSON.build = function(t) {
        var i = new e.JSON._ctx(t);
        return i._threads = 0, i.build()
    }
}(BEM),
function(e) {
    var t = e.JSON._ctx.prototype.wait,
        i = e.JSON._ctx.prototype.resume;
    e.JSON._ctx.prototype.wait = function() {
        console.error("ctx.wait() is deprecated, use ctx.defer()"), t.call(this)
    }, e.JSON._ctx.prototype.resume = function() {
        console.error("ctx.resume() is deprecated, use ctx.defer()"), i.call(this)
    }, e.JSON._ctx.prototype.defer = function(e) {
        var n = this;
        t.call(n), e.fail(function(e) {
            n._declErrorHandler(e), n.remove()
        }).always(function() {
            i.call(n)
        }).done()
    }
}(BEM), BEM.decl("i-util", {}, {
        arrayUnique: function(e, t) {
            return t = t || function(e, t) {
                return e === t
            }, e.reduce(function(e, i) {
                return e.some(function(e) {
                    return t(e, i)
                }) || e.push(i), e
            }, [])
        },
        arrayIntersect: function(e, t) {
            return e.filter(function(e) {
                return -1 !== t.indexOf(e)
            })
        },
        arrayDiff: function(e, t) {
            return e.filter(function(e) {
                return -1 === t.indexOf(e)
            })
        },
        arrayFind: function(e, t) {
            var i;
            return t = t || Boolean, e.some(function(e) {
                return t(e) ? (i = e, !0) : void 0
            }), i
        },
        arrayFindIndex: function(e, t) {
            var i = -1;
            return t = t || Boolean, e.some(function(e, n) {
                return t(e) ? (i = n, !0) : void 0
            }), i
        },
        encodeQuotes: function(e) {
            return e.replace(/"/g, "%22").replace(/'/g, "%27")
        },
        decodeQuotes: function(e) {
            return e.replace(/%22/g, '"').replace(/%27/g, "'")
        },
        isNumeric: function(e) {
            return "number" == typeof e && isFinite(e)
        }
    }), BEM.decl("i-util", null, {
        selectText: function(e) {
            var t, i;
            e = jQuery(e)[0], window.getSelection ? (i = window.getSelection(), t = document.createRange(), t.selectNodeContents(e), i.removeAllRanges(), i.addRange(t)) : document.selection && document.selection.createRange && (t = document.selection.createTextRange(), t.moveToElementText(e), t.select())
        },
        getSelection: function() {
            var e, t;
            if (window.getSelection) t = window.getSelection(), e = t.toString();
            else if (document.selection && document.selection.createRange) {
                var i = document.selection.createRange();
                e = i.text
            }
            return e
        }
    }), BEM.decl("i-ip", null, {
        isInternalIp: function() {
            return BEM.blocks["i-global"].get("i-ip.isInternalIp")
        }
    }), BEM.decl("i-debug", {}, {
        checkAllowed: function() {
            return BN("i-ip").isInternalIp()
        }
    }), BEM.decl("i-debug", {}, {
        debug: function(e, t) {
            var i;
            i = this._getLog(), i.push({
                type: e,
                data: t
            }), this.trigger("debug", {
                type: e,
                data: t
            })
        },
        getLog: function() {
            return this._getLog()
        },
        clear: function() {
            var e = this._getLog();
            e.length = 0
        },
        _getLog: function() {
            return this._log || (this._log = BEM.blocks["i-global"].get("i-debug.log") || []), this._log
        }
    }), BEM.decl("i-cookie", null, {
        get: function(e) {
            return jQuery.cookie(e)
        },
        set: function(e, t, i) {
            return jQuery.cookie(e, t, i)
        }
    }), BEM.decl("i-url", null, {
        isUrl: function(e) {
            return Boolean(e && e.match(/^https?:\/\//))
        }
    }), BEM.decl("i-url", null, {
        _parser: document.createElement("a"),
        parseUrl: function(e) {
            return this._parser.href = e, {
                protocol: this._parser.protocol,
                host: this._parser.host,
                port: this._parser.port,
                hostname: this._parser.hostname,
                hash: this._parser.hash,
                search: this._parser.search,
                query: this._parser.search.replace(/^\?/, ""),
                pathname: this._parser.pathname || "/",
                path: (this._parser.pathname || "/") + this._parser.search,
                href: this._parser.href
            }
        },
        queryParam: function(e) {
            return jQuery.param(e)
        }
    }), BEM.decl({
        block: "i-user",
        baseBlock: "i-api-request"
    }), BEM.decl("i-user", null, {
        NDA_ROLES: ["manager_direct", "manager", "super", "super_limited"],
        normalizeLogin: function(e) {
            return e.toLowerCase().replace(/\./g, "-")
        },
        areLoginsEqual: function(e, t) {
            return this.normalizeLogin(e) === this.normalizeLogin(t)
        },
        checkRoles: function(e, t) {
            return t.some(function(t) {
                return -1 !== e.indexOf(t)
            })
        },
        checkNda: function() {
            var e = BN("i-errors").MetrikaHttpError,
                t = this;
            return this.getRoles().then(function(i) {
                return t.areNdaRoles(i) ? Vow.fulfill(!0) : Vow.reject(new e(403))
            })
        },
        areNdaRoles: function(e) {
            return this.checkRoles(this.NDA_ROLES, e)
        }
    }), BEM.decl({
        block: "i-user"
    }, null, {
        uid: function() {
            var e = BEM.blocks["i-global"].get("i-user.uid");
            return e ? Vow.fulfill(e) : Vow.reject(new this._HttpError(403))
        }
    }), BEM.decl("i-user", {}, {
        getMetrikaLogin: function() {
            return Vow.fulfill(BEM.blocks["i-global"].get("i-user.login"))
        },
        getRealLogin: function() {
            return Vow.fulfill(BN("i-global").get("i-user.realLogin"))
        },
        getRoles: function() {
            return Vow.fulfill(BN("i-global").get("i-user.roles"))
        },
        isUlogined: function() {
            return Vow.fulfill(BN("i-global").get("i-user.isUlogined"))
        }
    }), BEM.decl({
        block: "i-metrika-api",
        baseBlock: "i-api-request"
    }),
    function() {
        var e = BEM.blocks["i-errors"],
            t = function(e) {
                return BEM && BEM.I18N ? BEM.I18N("i-error-message", e) : e
            };
        e.CommonError.prototype.toObject = function() {
            var e = this;
            return Object.keys(this).reduce(function(t, i) {
                return t[i] = e[i], t
            }, {})
        };
        var i = e.MetrikaError = function(i, n) {
            var o = "MetrikaError: " + i;
            e.CommonError.call(this, o), n && (this.profile = n), this.name = "MetrikaError", this.code = i, this.text = t(i) || t("default")
        };
        i.prototype = new e.CommonError, i.constructor = i, i.prototype.serialize = function() {
            var t = e.CommonError.prototype.serialize.call(this);
            return t.args = [this.code, this.profile], t
        }, i.prototype.toObject = function() {
            var t = e.CommonError.prototype.toObject.call(this);
            return delete t.profile, t
        };
        var n = e.MetrikaHttpError = function(i, n) {
            this.code = "ERR_HTTP_" + i, e.HttpError.call(this, i), this.name = "MetrikaHttpError", n = n || {}, n._profile && (this.profile = n._profile), n.errors && (this.errors = n.errors), this.text = t(this.code) || n.message || t("default")
        };
        n.prototype = new i, n.constructor = n, n.prototype.serialize = function() {
            var t = e.CommonError.prototype.serialize.call(this);
            return t.args = [this.status, {
                message: this.text,
                _profile: this.profile,
                errors: this.errors
            }], t
        };
        var o = e.NetError = function(t, i) {
            e.CommonError.call(this, t), this.name = "NetError", this.code = t, this.message = i
        };
        o.prototype = new e.CommonError, o.constructor = e.CommonError, o.prototype.serialize = function() {
            var t = e.CommonError.prototype.serialize.call(this);
            return t.args = [this.code], t
        };
        var s = e.MetrikaSecretKeyError = function(t) {
            e.MetrikaError.call(this), this.name = "MetrikaSecretKeyError", this.message = "Wrong secretKey", this.status = 403, this._validSecretKey = t
        };
        s.prototype = new e.MetrikaError, s.prototype.getValidSecretKey = function() {
            return this._validSecretKey
        }, s.prototype.serialize = function() {
            var t = e.CommonError.prototype.serialize.call(this);
            return t.args = [this._validSecretKey], t
        }, s.constructor = e.MetrikaError, BEM.decl("i-error-message", null, {
            MetrikaError: i,
            MetrikaHttpError: n,
            NetError: o,
            MetrikaSecretKeyError: s,
            getResponseText: function(e) {
                var t = e.errors;
                return t && 1 === t.length ? t[0].message : BN("i-error-message").toText(e)
            },
            toText: function(e) {
                return e instanceof i ? e.text : (e instanceof Error || console.log("Error is not instance of MetrikaError or Error"), t("default"))
            }
        })
    }(),
    function(e) {
        function t(e) {
            return e.replace(/^(?:https?:)?\/\//, "")
        }
        e || (e = window.Lego = {}), !e.params && (e.params = {}), e.c = function(e, i, n) {
            var o = t(n && n.host || BEM.blocks["i-global"].param("click-host") || "clck.yandex.ru"),
                s = function(e, t, i, n) {
                    return t = t.replace("'", "%27"), t.indexOf("/dtype=") > -1 ? t : location.protocol + "//" + o + "/" + i + "/dtype=" + e + "/rnd=" + ((new Date).getTime() + Math.round(100 * Math.random())) + (n ? "/*" + (t.match(/^http/) ? t : location.protocol + "//" + location.host + (t.match("^/") ? t : "/" + t)) : "/*data=" + encodeURIComponent("url=" + encodeURIComponent(t.match(/^http/) ? t : location.protocol + "//" + location.host + (t.match("^/") ? t : "/" + t))))
                },
                r = function() {
                    var t = document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0],
                        i = document.createElement("script");
                    i.setAttribute("src", s(e, location.href, "jclck")), t.insertBefore(i, t.firstChild)
                };
            if (i)
                if (i.className.match(/b-link_pseudo_yes/) || i.href && i.href.match(/^mailto:/) || n && n.noRedirect === !0) r();
                else if (i.href) {
                var a = i.href;
                i.href = s(e, a, "redir"), setTimeout(function() {
                    i.href = a
                }, 500)
            } else if (i.form)
                if (i.type.match(/submit|button|image/)) {
                    var a = i.form.action;
                    i.form.action = s(e, a, "redir", !0), setTimeout(function() {
                        i.form.action = a
                    }, 500)
                } else r();
            else {
                if (!i.action) throw "counter.js: not link and not form!";
                i.action = s(e, i.action, "redir", !0)
            } else r()
        }
    }(window.Lego),
    function(e, t) {
        e || (e = window.Lego = {}), e.cp = function(i, n, o, s, r, a) {
            "string" == typeof s || (a = r, r = s, s = t), e.c("stred/pid=" + i + "/cid=" + n + (o ? "/path=" + o + (s ? "/vars=" + s : "") : ""), r, a)
        }
    }(window.Lego),
    function(e) {
        e || (e = window.Lego = {}), e.ch = function(t, i, n) {
            BEM.blocks["i-global"].param("show-counters") && e.cp(0, 2219, t, i, n)
        }
    }(window.Lego),
    function(e) {
        e || (e = window.Lego = {}), e.getCookie = function(e) {
            var t = document.cookie;
            if (t.length < 1) return !1;
            var i = t.indexOf(e + "=");
            if (-1 == i) return !1;
            i += e.length + 1;
            var n = t.indexOf(";", i);
            return decodeURIComponent(-1 == n ? t.substring(i) : t.substring(i, n))
        }
    }(window.Lego),
    function(e, t) {
        t || (t = window.Lego = {}), t.init || (t.init = function(i) {
            return (i = t.params = e.extend({
                id: "",
                login: t.isSessionValid() ? t.getCookie("yandex_login") || "" : "",
                yandexuid: t.getCookie("yandexuid"),
                locale: "ru",
                retpath: window.location.toString(),
                "passport-host": "https://passport.yandex.ru",
                "pass-host": "https://pass.yandex.ru",
                "passport-msg": i.id,
                "social-host": "https://social.yandex.ru",
                "lego-path": "/lego",
                "show-counters-percent": 100
            }, i, t.params))["show-counters"] = Math.round(100 * Math.random()) <= i["show-counters-percent"], BEM.blocks["i-global"]._params || e.extend(BEM.blocks["i-global"]._params = {}, i), e(function() {
                i.oframebust && t.oframebust(i.oframebust)
            }), i
        }), t.block || (t.block = {}), t.blockInit || (t.blockInit = function(i, n) {
            i = i || document, n = n || ".g-js", e(i).find(n).each(function() {
                var i = e(this),
                    n = this.onclick ? this.onclick() : {},
                    o = n.name || "",
                    s = t.block[o];
                s && !i.data(o) && (s.call(i, n), i.data(o, !0).addClass(o + "_js_inited"))
            })
        }), t.blockInitBinded || (t.blockInitBinded = !!e(document).ready(function() {
            t.blockInit()
        }))
    }(jQuery, window.Lego),
    function(e) {
        var t = 1,
            i = !1;
        if ("deviceXDPI" in screen && "logicalXDPI" in screen ? t = screen.deviceXDPI / screen.logicalXDPI : "devicePixelRatio" in e && (t = e.devicePixelRatio), "function" == typeof e.matchMedia) {
            var n = "only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 124dpi)";
            i = e.matchMedia(n).matches
        } else i = t >= 1.3;
        BEM.DOM.decl("i-ua", {
            onSetMod: {
                js: function() {
                    var e = this,
                        t = e.__self;
                    t.hiDpi && e.setMod("hi-dpi", "yes")
                }
            }
        }, {
            dpr: t,
            hiDpi: i
        })
    }(window),
    function(e) {
        e || (e = window.Lego = {}), e.messages = e.messages || {}, e.message = function(t, i) {
            return "ru" == e.params.locale ? i : e.messages[t] || i
        }
    }(window.Lego),
    function() {
        var e = new Error("You should add {block: 'i-content', mods: {type: 'bemhtml'}} into .bemdecl.js file to use bemhtml templates or some other type you want");
        BEM.decl("i-content", null, {
            html: function() {
                throw e
            },
            _htmlSync: function() {
                throw e
            },
            _htmlAsync: function() {
                throw e
            },
            escapeHTML: function(e) {
                return String(e).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#x27;").replace(/\//g, "&#x2F;")
            },
            unescapeHTML: function(e) {
                return String(e).replace(/&amp;/g, "&").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&#x27;/g, "'").replace(/&#x2F;/g, "/")
            }
        })
    }(), BEM.decl("i-content", null, ["prepend", "update", "append", "before", "replace", "after"].reduce(function(e, t) {
        return e[t] = function(e, i) {
            return this.html(i).then(function(i) {
                BEM.DOM[t](e, i)
            })
        }, e
    }, {
        destruct: function() {
            BEM.DOM.destruct.apply(BEM.DOM, arguments)
        }
    })),
    function() {
        var e = function() {
            var e, t = BH.prototype._init,
                i = !1;
            for (e in {}) {
                i = !0;
                break
            }
            return BH.prototype._init = function() {
                return this.utils.parentBlock = function() {
                    for (var e = this.ctx.block, t = this.node; t.parentNode;)
                        if (t = t.parentNode, !t.json.elem && t.json.block === e) return t.json;
                    return null
                }, this.utils.applyBaseAsync = function(e) {
                    var t, n, o = this.ctx,
                        s = this.node;
                    if (e) {
                        t = {};
                        for (n in e)(!i || e.hasOwnProperty(n)) && (t[n] = o[n], o[n] = e[n])
                    }
                    return this.bh.processBemJsonAsync(this.ctx, this.ctx.block, !0).then(function(n) {
                        var r;
                        if (n !== o && (this.newCtx = n), e)
                            for (r in e)(!i || e.hasOwnProperty(r)) && (o[r] = t[r]);
                        return this.ctx = o, this.node = s, n
                    })
                }, t.apply(this, arguments)
            }, BH.prototype._processAsyncSubRes = function(e, t, i, n, o) {
                return o ? (i[n] = o, this.processBemJsonAsync(o, t)) : (i[n] = e, this.processBemJsonAsync(e.content, t))
            }, BH.prototype.processBemJsonAsync = function(e, t, i) {
                function n() {
                    this.ctx = null, this.newCtx = null
                }
                n.prototype = this.utils, this._inited || this._init();
                var o = [e],
                    s = Vow.promise(),
                    r = [s];
                try {
                    for (var a, l, c, d, u, h, m, p, f, g = [{
                            json: e,
                            arr: o,
                            index: 0,
                            blockName: t,
                            blockMods: e.mods || {}
                        }], _ = this._fastMatcher || (this._fastMatcher = Function("ms", this.buildMatcher())(this._matchers)), b = !i, y = this._infiniteLoopDetection, v = new n; a = g.shift();) {
                        if (l = a.json, c = a.blockName, d = a.blockMods, Array.isArray(l))
                            for (u = 0, h = l.length; h > u; u++) p = l[u], p !== !1 && null != p && "object" == typeof p && g.push({
                                json: p,
                                arr: l,
                                index: u,
                                blockName: c,
                                blockMods: d,
                                parentNode: a
                            });
                        else {
                            var M, k = !1;
                            if (l.elem ? (c = l.block = l.block || c, d = l.blockMods = l.blockMods || d, l.elemMods && (l.mods = l.elemMods)) : l.block && (c = l.block, d = l.mods || (l.mods = {})), l.block) {
                                if (y && (l.__processCounter = (l.__processCounter || 0) + 1, l.__processCounter > 100)) throw new Error('Infinite loop detected at "' + l.block + (l.elem ? "__" + l.elem : "") + '".');
                                f = null, l._stop || (v.node = a, v.ctx = l, f = _(v, l), f && (Vow.isPromise(f) ? (r.push(f.then(this._processAsyncSubRes.bind(this, l, c, a.arr, a.index))), v = new n) : (l = f, a.json = l, a.blockName = c, a.blockMods = d, g.push(a)), k = !0))
                            }
                            if (!k)
                                if (Array.isArray(l)) a.json = l, a.blockName = c, a.blockMods = d, g.push(a);
                                else if (b && (M = l.content))
                                if (Array.isArray(M)) {
                                    var B;
                                    do {
                                        for (B = !1, u = 0, h = M.length; h > u; u++)
                                            if (Array.isArray(M[u])) {
                                                B = !0;
                                                break
                                            }
                                        B && (l.content = M = M.concat.apply([], M))
                                    } while (B);
                                    for (u = 0, h = M.length, m = h - 1; h > u; u++) p = M[u], p !== !1 && null != p && "object" == typeof p && g.push({
                                        json: p,
                                        arr: M,
                                        index: u,
                                        blockName: c,
                                        blockMods: d,
                                        parentNode: a
                                    })
                                } else g.push({
                                    json: M,
                                    arr: l,
                                    index: "content",
                                    blockName: c,
                                    blockMods: d,
                                    parentNode: a
                                })
                        }
                        a.arr[a.index] = l
                    }
                    s.fulfill()
                } catch (w) {
                    s.reject(w)
                }
                return Vow.all(r).then(function() {
                    return o[0]
                })
            }, BH
        };
        BEM.decl("i-bh", null, {
            match: function(e) {
                var t = this.bh();
                Object.keys(e).forEach(function(i) {
                    t.match(i, e[i])
                })
            },
            bh: function() {
                return this._bh || (this._bh = new(e()))
            }
        })
    }();
var BH = function() {
    function e() {
        this._lastMatchId = 0, this._matchers = [], this._infiniteLoopDetection = !1, this.lib = {}, this._inited = !1, this._options = {}, this._optJsAttrName = "onclick", this._optJsAttrIsJs = !0, this.utils = {
            _lastGenId: 0,
            bh: this,
            extend: function(e) {
                "object" != typeof e && (e = {});
                for (var i = 1, n = arguments.length; n > i; i++) {
                    var o, s = arguments[i];
                    if (s)
                        if (t)
                            for (o in s) s.hasOwnProperty(o) && (e[o] = s[o]);
                        else
                            for (o in s) e[o] = s[o]
                }
                return e
            },
            position: function() {
                var e = this.node;
                return "content" === e.index ? 1 : e.index + 1
            },
            isFirst: function() {
                var e = this.node;
                return "content" === e.index || 0 === e.index
            },
            isLast: function() {
                var e = this.node;
                return "content" === e.index || e.index === e.arr.length - 1
            },
            tParam: function(e, t) {
                var i = "__tp_" + e;
                if (2 === arguments.length) return this.node[i] = t, this;
                for (var n = this.node; n;) {
                    if (n.hasOwnProperty(i)) return n[i];
                    n = n.parentNode
                }
            },
            apply: function(e) {
                var t = this.ctx,
                    i = this.node,
                    n = this.bh.processBemJson(e, t.block);
                return this.ctx = t, this.node = i, n
            },
            applyCtx: function(e) {
                return this.applyBase.apply(this, arguments)
            },
            applyBase: function(e) {
                var i, n, o = this.ctx,
                    s = this.node;
                if (e) {
                    i = {};
                    for (n in e)(!t || e.hasOwnProperty(n)) && (i[n] = o[n], o[n] = e[n])
                }
                var r = this.bh.processBemJson(this.ctx, this.ctx.block, !0);
                if (r !== o && (this.newCtx = r), e)
                    for (n in e)(!t || e.hasOwnProperty(n)) && (o[n] = i[n]);
                return this.ctx = o, this.node = s, this
            },
            applyTemplates: function() {
                return this.applyBase()
            },
            stop: function() {
                return this.ctx._stop = !0, this
            },
            generateId: function() {
                return "uniq" + this._lastGenId++
            },
            mod: function(e, t, i) {
                var n;
                return void 0 !== t ? (n = this.ctx.mods || (this.ctx.mods = {}), n[e] = void 0 === n[e] || i ? t : n[e], this) : (n = this.ctx.mods, n ? n[e] : void 0)
            },
            mods: function(e, i) {
                var n = this.ctx.mods || (this.ctx.mods = {});
                if (void 0 !== e) {
                    for (var o in e)(!t || e.hasOwnProperty(o)) && (n[o] = void 0 === n[o] || i ? e[o] : n[o]);
                    return this
                }
                return n
            },
            tag: function(e, t) {
                return void 0 !== e ? (this.ctx.tag = void 0 === this.ctx.tag || t ? e : this.ctx.tag, this) : this.ctx.tag
            },
            mix: function(e, t) {
                return void 0 !== e ? (t ? this.ctx.mix = e : this.ctx.mix ? this.ctx.mix = Array.isArray(this.ctx.mix) ? this.ctx.mix.concat(e) : [this.ctx.mix].concat(e) : this.ctx.mix = e, this) : this.ctx.mix
            },
            attr: function(e, t, i) {
                var n;
                return void 0 !== t ? (n = this.ctx.attrs || (this.ctx.attrs = {}), n[e] = void 0 === n[e] || i ? t : n[e], this) : (n = this.ctx.attrs, n ? n[e] : void 0)
            },
            bem: function(e, t) {
                return void 0 !== e ? (this.ctx.bem = void 0 === this.ctx.bem || t ? e : this.ctx.bem, this) : this.ctx.bem
            },
            js: function(e, t) {
                return void 0 !== e ? (this.ctx.js = void 0 === this.ctx.js || t ? e : this.ctx.js, this) : this.ctx.js
            },
            cls: function(e, t) {
                return void 0 !== e ? (this.ctx.cls = void 0 === this.ctx.cls || t ? e : this.ctx.cls, this) : this.ctx.cls
            },
            param: function(e, t, i) {
                return void 0 !== t ? (this.ctx[e] = void 0 === this.ctx[e] || i ? t : this.ctx[e], this) : this.ctx[e]
            },
            content: function(e, t) {
                return arguments.length > 0 ? (this.ctx.content = void 0 === this.ctx.content || t ? e : this.ctx.content, this) : this.ctx.content
            },
            json: function() {
                return this.newCtx || this.ctx
            }
        }
    }
    var t = !1;
    for (var i in {}) {
        t = !0;
        break
    }
    e.prototype = {
        setOptions: function(e) {
            var i, n = this._options;
            if (t)
                for (i in e) e.hasOwnProperty(i) && (n[i] = n);
            else
                for (i in e) n[i] = n;
            return e.jsAttrName && (this._optJsAttrName = e.jsAttrName), e.jsAttrScheme && (this._optJsAttrIsJs = "js" === e.jsAttrScheme), this
        },
        getOptions: function() {
            return this._options
        },
        enableInfiniteLoopDetection: function(e) {
            return this._infiniteLoopDetection = e, this
        },
        apply: function(e) {
            return this.toHtml(this.processBemJson(e))
        },
        match: function(e, t) {
            t.__id = "__func" + this._lastMatchId++, this._matchers.push([e, t]), this._fastMatcher = null
        },
        buildMatcher: function() {
            function e(e, t) {
                for (var i = {}, n = 0, o = e.length; o > n; n++) {
                    var s = e[n],
                        r = s[t] || "__no_value__";
                    (i[r] || (i[r] = [])).push(s)
                }
                return i
            }
            var i, n, o, r, a, l, c, d, u = [""],
                h = ["bh = this"],
                m = this._matchers,
                p = [];
            for (i = m.length - 1; i >= 0; i--) l = m[i], a = l[0], a && (h.push("_m" + i + " = ms[" + i + "][1]"), r = {
                fn: l[1],
                index: i
            }, ~a.indexOf("__") ? (c = a.split("__"), d = c[0].split("_"), r.block = d[0], d.length > 1 && (r.blockMod = d[1], r.blockModVal = d[2]), c = c[1].split("_"), r.elem = c[0], c.length > 1 && (r.mod = c[1], r.modVal = c[2])) : (c = a.split("_"), r.block = c[0], c.length > 1 && (r.mod = c[1], r.modVal = c[2])), p.push(r));
            var f = e(p, "block");
            u.push("var " + h.join(", ") + ";"), u.push("function applyMatchers(ctx, json) {"), u.push("var subRes, newCtx;"), u.push("switch (json.block) {");
            for (var g in f)
                if (!t || f.hasOwnProperty(g)) {
                    u.push('case "' + s(g) + '":');
                    var _ = e(f[g], "elem");
                    u.push("switch (json.elem) {");
                    for (var b in _)
                        if (!t || _.hasOwnProperty(b)) {
                            "__no_value__" === b ? u.push("case undefined:") : u.push('case "' + s(b) + '":');
                            var y = _[b];
                            for (n = 0, o = y.length; o > n; n++) {
                                r = y[n];
                                var v = r.fn,
                                    M = [];
                                M.push("!json." + v.__id), r.mod && (M.push("json.mods"), r.modVal ? M.push('json.mods["' + s(r.mod) + '"] === "' + s(r.modVal) + '"') : M.push('json.mods["' + s(r.mod) + '"]')), r.blockMod && (M.push("json.blockMods"), r.blockModVal ? M.push('json.blockMods["' + s(r.blockMod) + '"] === "' + s(r.blockModVal) + '"') : M.push('json.blockMods["' + s(r.blockMod) + '"]')), u.push("if (" + M.join(" && ") + ") {"), u.push("json." + v.__id + " = true;"), u.push("subRes = _m" + r.index + "(ctx, json);"), u.push("if (subRes) { return subRes; }"), u.push("if (newCtx = ctx.newCtx) { ctx.newCtx = null; return newCtx; }"), u.push("if (json._stop) return;"), u.push("}")
                            }
                            u.push("return;")
                        }
                    u.push("}"), u.push("return;")
                }
            return u.push("}"), u.push("};"), u.push("return applyMatchers;"), u.join("\n")
        },
        processBemJson: function(e, t, i) {
            function n() {
                this.ctx = null, this.newCtx = null
            }
            this._inited || this._init();
            var o, s, r, a, l, c, d, u, h, m = [e],
                p = [{
                    json: e,
                    arr: m,
                    index: 0,
                    blockName: t,
                    blockMods: e.mods || {}
                }],
                f = this._fastMatcher || (this._fastMatcher = Function("ms", this.buildMatcher())(this._matchers)),
                g = !i,
                _ = this._infiniteLoopDetection;
            n.prototype = this.utils;
            for (var b = new n; o = p.shift();) {
                if (s = o.json, r = o.blockName, a = o.blockMods, Array.isArray(s))
                    for (l = 0, c = s.length; c > l; l++) u = s[l], u !== !1 && null != u && "object" == typeof u && p.push({
                        json: u,
                        arr: s,
                        index: l,
                        blockName: r,
                        blockMods: a,
                        parentNode: o
                    });
                else {
                    var y, v = !1;
                    if (s.elem ? (r = s.block = s.block || r, a = s.blockMods = s.blockMods || a, s.elemMods && (s.mods = s.elemMods)) : s.block && (r = s.block, a = s.mods || (s.mods = {})), s.block) {
                        if (_ && (s.__processCounter = (s.__processCounter || 0) + 1, s.__processCounter > 100)) throw new Error('Infinite loop detected at "' + s.block + (s.elem ? "__" + s.elem : "") + '".');
                        h = null, s._stop || (b.node = o, b.ctx = s, h = f(b, s), h && (s = h, o.json = s, o.blockName = r, o.blockMods = a, p.push(o), v = !0))
                    }
                    if (!v)
                        if (Array.isArray(s)) o.json = s, o.blockName = r, o.blockMods = a, p.push(o);
                        else if (g && (y = s.content))
                        if (Array.isArray(y)) {
                            var M;
                            do {
                                for (M = !1, l = 0, c = y.length; c > l; l++)
                                    if (Array.isArray(y[l])) {
                                        M = !0;
                                        break
                                    }
                                M && (s.content = y = y.concat.apply([], y))
                            } while (M);
                            for (l = 0, c = y.length, d = c - 1; c > l; l++) u = y[l], u !== !1 && null != u && "object" == typeof u && p.push({
                                json: u,
                                arr: y,
                                index: l,
                                blockName: r,
                                blockMods: a,
                                parentNode: o
                            })
                        } else p.push({
                            json: y,
                            arr: s,
                            index: "content",
                            blockName: r,
                            blockMods: a,
                            parentNode: o
                        })
                }
                o.arr[o.index] = s
            }
            return m[0]
        },
        toHtml: function(e) {
            var i, s, a, l;
            if (e === !1 || null == e) return "";
            if ("object" != typeof e) return e;
            if (Array.isArray(e)) {
                for (i = "", s = 0, a = e.length; a > s; s++) l = e[s], l !== !1 && null != l && (i += this.toHtml(l));
                return i
            }
            e.mix && !Array.isArray(e.mix) && (e.mix = [e.mix]);
            var c, d, u = e.bem !== !1 && e.block ? r(e, e.block) : "",
                h = "",
                m = !1;
            if (c = e.attrs)
                if (t)
                    for (s in c) c.hasOwnProperty(s) && null !== c[s] && (h += " " + s + '="' + o(c[s]) + '"');
                else
                    for (s in c) null !== c[s] && (h += " " + s + '="' + o(c[s]) + '"');
            e.js && ((d = {})[e.block + (e.elem ? "__" + e.elem : "")] = e.js === !0 ? {} : e.js);
            var p = e.mix;
            if (p && p.length)
                for (s = 0, a = p.length; a > s; s++) {
                    var f = p[s];
                    f.js && ((d = d || {})[(f.block || e.block) + (f.elem ? "__" + f.elem : "")] = f.js === !0 ? {} : f.js, m = !0)
                }
            if (d) {
                e.bem !== !1 && (u += " i-bem");
                var g = m || e.js !== !0 ? o(JSON.stringify(d)) : "{&quot;" + e.block + (e.elem ? "__" + e.elem : "") + "&quot;:{}}";
                h += " " + (e.jsAttr || this._optJsAttrName) + '="' + (this._optJsAttrIsJs ? "return " + g + ";" : g) + '"'
            }
            e.cls && (u = u ? u + " " + e.cls : e.cls);
            var _, b = e.tag || "div";
            if (i = "<" + b + (u ? ' class="' + o(u) + '"' : "") + (h ? h : ""), n[b]) i += "/>";
            else {
                if (i += ">", null != (_ = e.content))
                    if (Array.isArray(_))
                        for (s = 0, a = _.length; a > s; s++) l = _[s], l !== !1 && null != l && (i += this.toHtml(l));
                    else i += this.toHtml(_);
                i += "</" + b + ">"
            }
            return i
        },
        _init: function() {
            this._inited = !0, "undefined" != typeof BEM && "undefined" != typeof BEM.I18N && (this.lib.i18n = this.lib.i18n || BEM.I18N)
        }
    }, e.prototype.processBemjson = e.prototype.processBemJson;
    var n = {
            area: 1,
            base: 1,
            br: 1,
            col: 1,
            command: 1,
            embed: 1,
            hr: 1,
            img: 1,
            input: 1,
            keygen: 1,
            link: 1,
            meta: 1,
            param: 1,
            source: 1,
            wbr: 1
        },
        o = function(e) {
            return e += "", ~e.indexOf("&") && (e = e.replace(/&/g, "&amp;")), ~e.indexOf('"') && (e = e.replace(/"/g, "&quot;")), e
        },
        s = function(e) {
            return e += "", ~e.indexOf("\\") && (e = e.replace(/\\/g, "\\\\")), ~e.indexOf('"') && (e = e.replace(/"/g, '\\"')), e
        },
        r = function(e, i) {
            var n, o, s, a, l, c = (e.block || i) + (e.elem ? "__" + e.elem : "");
            if (o = c, n = e.mods)
                if (t)
                    for (a in n) n.hasOwnProperty(a) && n[a] && (o += " " + c + "_" + a + "_" + n[a]);
                else
                    for (a in n) n[a] && (o += " " + c + "_" + a + "_" + n[a]);
            if ((s = e.mix) && (l = s.length))
                for (a = 0; l > a; a++) o += " " + r(s[a], i);
            return o
        };
    return e
}();
"undefined" != typeof module && (module.exports = BH), BEM.decl("i-content", null, {
        html: function(e, t) {
            return Array.isArray(e) || (e = [e]), t ? this._htmlSync(e) : this._htmlAsync(e)
        },
        _htmlSync: function(e) {
            return BEMHTML.call(BEM.JSON.build(e))
        },
        _htmlAsync: function(e) {
            var t;
            return "string" == typeof e ? t = Vow.fulfill(e) : (t = Vow.promise(), BEM.JSON.buildAsync(e, function(e) {
                t.fulfill(BEMHTML.call(e))
            })), t
        }
    }), BEM.decl("i-content", null, {
        _htmlSync: function(e) {
            return e = [].concat(BEM.blocks["i-global"].getBemjson(), e), this.__base(e)
        },
        _htmlAsync: function(e) {
            return e = [].concat(BEM.blocks["i-global"].getBemjson(), e), this.__base(e)
        }
    }), BEM.decl("i-content", null, {
        _htmlAsync: function(e) {
            var t = this.__base.bind(this);
            return BEM.blocks["i-bh"].bh().processBemJsonAsync(e).then(function() {
                return t(e)
            })
        },
        _htmlSync: function(e) {
            return this.__base(BEM.blocks["i-bh"].bh().processBemJson(e))
        }
    }),
    function() {
        this.BN = function(e) {
            return BEM.blocks[e]
        };
        var e, t, i = BEM.DOM || BEM,
            n = function(e) {
                this._name = e, this._matchers = {}
            },
            o = Boolean(BEM.DOM),
            s = this.BN,
            r = [],
            a = {},
            l = BEM.blocks["i-bh"].bh(),
            c = function(e, t) {
                var i = "_data_" + e,
                    n = "_jsinit_" + e;
                Object.keys(BEM.blocks[e]).filter(RegExp.prototype.test.bind(/^_bh_/)).forEach(function(t) {
                    if (!a[t]) {
                        a[t] = !0;
                        var i = t.replace(/^_bh_/, "");
                        l.match(i, function(n, o) {
                            try {
                                return BEM.blocks[e][t](n, o)
                            } catch (r) {
                                return s._bhErrorReporter(i, r)
                            }
                        })
                    }
                }), !a[n] && t && (a[n] = !0, l.match(e, function(e) {
                    return e.applyBaseAsync().then(function(t) {
                        return e.js(!0), t
                    })
                })), BEM.blocks[e][i] && !a[i] && (a[i] = !0, setTimeout(function() {
                    l.match(e, function(t, n) {
                        return Vow.promise(BEM.blocks[e][i](t, n)).then(function() {
                            return t.applyBaseAsync()
                        }).fail(s._bhErrorReporter.bind(s, e))
                    })
                }))
            };
        o && (t = BEM.DOM.init.bind(BEM.DOM), BEM.DOM.init = function() {
            return s.init(), t.apply(BEM.DOM, arguments)
        }, e = !0), s.init = function() {
            for (; r.length;) r.shift().done()
        }, s._bhErrorReporter = function(e, t) {
            return console.error("Error in " + e), console.error(t), o && setTimeout(function() {
                throw t
            }), []
        }, s._addDeclForPage = function(e, t) {
            var i = s.addDecl(e).baseBlock("i-page");
            return t = t || {}, t.route && s("i-router").define(t.route, e), i
        }, s._addDeclForAjax = function(e, t) {
            var i = s.addDecl(e).baseBlock("i-api-request");
            return t = t || {}, t.apiHost && i.staticProp({
                _apiHost: t.apiHost
            }), s("i-ajax-proxy") && s("i-ajax-proxy").allowBlock(e), i
        }, s.addDecl = function(t, i, o) {
            var a, l;
            if (arguments.length > 1) {
                if (a = "_addDeclFor" + i.charAt(0).toUpperCase() + i.slice(1), s[a]) return s[a](t, o);
                throw new Error("No method for type " + i)
            }
            return l = new n(t), r.push(l), e || (e = setTimeout(function() {
                s.init()
            })), l
        }, n.prototype = {
            _addMatchersByMode: function(e, t) {
                var i = this;
                switch (typeof t) {
                    case "function":
                        this._matchers[e] = t;
                        break;
                    case "object":
                        Object.keys(t).forEach(function(n) {
                            if ("function" != typeof t[n]) throw new Error("Expected " + e + "_" + n + " to be a function");
                            i._matchers[e + "_" + n] = t[n]
                        });
                        break;
                    default:
                        throw new Error(e + " to be a function or object")
                }
            },
            baseBlock: function(e) {
                if (this._baseBlock) throw new Error("Cant base from multiple blocks");
                return this._baseBlock = e, this
            },
            instanceProp: function(e) {
                return this._instanceProp = jQuery.extend(this._instanceProp || {}, e), this
            },
            staticProp: function(e) {
                return this._staticProp = jQuery.extend(this._staticProp || {}, e), this
            },
            onSetMod: function(e) {
                return this._onSetMod = jQuery.extend(this._onSetMod || {}, e), this
            },
            elemTemplate: function(e) {
                return Object.keys(e).forEach(function(t) {
                    this._addMatchersByMode(this._name + "__" + t, e[t])
                }.bind(this)), this
            },
            blockTemplate: function(e) {
                return this._addMatchersByMode(this._name, e), this
            },
            dataTemplate: function(e) {
                if (this._blockData) throw new Error("Multiple data handlers is not supported");
                return this._blockData = e, this
            },
            done: function() {
                var e, t = this._staticProp || {},
                    n = this._instanceProp || {},
                    o = {
                        block: this._name
                    };
                this._baseBlock && (o.baseBlock = this._baseBlock), this._onSetMod && (n = jQuery.extend(n, {
                    onSetMod: this._onSetMod
                })), Object.keys(this._matchers).forEach(function(e) {
                    t["_bh_" + e] = this._matchers[e]
                }.bind(this)), this._blockData && (t["_data_" + this._name] = this._blockData), BEM.DOM && !BEM.blocks[this._name] && (i.decl(o, {
                    _init: function() {
                        if (this.__self.__instances.push(this), this.__self.__lastInstance = this, this.__base(), jQuery.isFunction(this.init)) try {
                            this.init()
                        } catch (e) {
                            setTimeout(function() {
                                throw e
                            })
                        }
                        return this
                    },
                    destruct: function() {
                        var e = this;
                        return this.__self.__instances = this.__self.__instances.filter(function(t) {
                            return t !== e
                        }), this.__self.__lastInstance = this.__self.__instances.length ? this.__self.__instances[this.__self.__instances.length - 1] : null, this.__base.apply(this, arguments)
                    }
                }, {
                    __instances: [],
                    __lastInstance: null
                }), delete o.baseBlock), e = n.init || n.onSetMod && n.onSetMod.js, i.decl(o, n, t), c(this._name, e)
            }
        }
    }(), (BEM.DOM || BEM).decl({
        block: "i-page"
    }, null, {
        init: function() {
            return this.out("")
        },
        setTitle: function() {
            throw new Error('Method "setTitle" should be implemented.')
        },
        setDescription: function() {
            return this
        },
        setMeta: function() {
            return this
        },
        out: function() {},
        html: function() {
            return BEM.blocks["i-content"].html.apply(BEM.blocks["i-content"], arguments)
        }
    }), BEM.decl("i-page", null, {
        _getTitle: function(e) {
            return BN("i-content").escapeHTML(e + " — " + BEM.I18N("i-page", "html-title"))
        }
    }), BEM.DOM.decl("i-page", null, {
        update: function() {
            return this.init.apply(this, arguments)
        },
        destruct: function() {
            return Vow.fulfill()
        },
        setTitle: function(e) {
            var t = jQuery("title"),
                i = jQuery("<title>" + e + "</title>");
            return t ? (i.insertBefore(t), t.remove()) : i.prependTo("head"), this
        },
        setDescription: function(e) {
            return jQuery("meta[name=description]").attr("content", e), this
        },
        getUpdateNode: function() {
            return jQuery(".b-content")
        },
        out: function(e) {
            return this.html(e).then(function(e) {
                try {
                    BEM.DOM.update(this.getUpdateNode(), e)
                } catch (t) {
                    console.error(t)
                }
                return jQuery("body, html").scrollTop(0), e
            }.bind(this))
        }
    }), BEM.decl("i-page", null, {
        init: function() {
            return Vow.reject()
        },
        update: function() {
            return Vow.fulfill()
        },
        destruct: function() {
            return Vow.reject()
        },
        setTitle: function(e) {
            return this.__base.call(this, this._getTitle(e))
        },
        out: function(e) {
            return this.html(e).then(function(e) {
                try {
                    BEM.DOM.update(this.getUpdateNode(), e)
                } catch (t) {
                    console.error(t)
                }
                return this._setInitPageScroll(), e
            }.bind(this))
        },
        _setInitPageScroll: function() {
            jQuery("body, html").scrollTop(0)
        }
    }), $(function() {
        BEM.afterCurrentEvent(function() {
            BEM.DOM.init()
        })
    }),
    function() {
        var e = {
                9: "tab",
                13: "enter",
                32: "space",
                33: "page up",
                34: "page down",
                35: "end",
                36: "home",
                37: "left arrow",
                38: "up arrow",
                39: "right arrow",
                40: "down arrow",
                46: "delete"
            },
            t = {
                27: "escape"
            };
        BEM.DOM.decl({
            block: "i-ua",
            modName: "interaction",
            modVal: "yes"
        }, {
            onSetMod: {
                js: {
                    inited: function() {
                        this.bindTo("mousedown", this._onPointer).bindTo("keydown", this._onKeyboard)
                    }
                }
            },
            _onPointer: function() {
                this.interaction = "pointer", this.domElem.attr("data-interaction", "pointer"), this.unbindFrom("mousedown")
            },
            _onKeyboard: function(i) {
                var n = i.keyCode;
                return t[n] ? void this._onPointer() : void(e[n] && "keyboard" !== this.interaction && (this.domElem.attr("data-interaction", "keyboard"), this.interaction = "keyboard", this.bindTo("mousedown", this._onPointer)))
            }
        })
    }(), BEM.DOM.decl("b-page", {
        onSetMod: {
            js: function() {
                this._contentParanja = this.findBlockOn(this.elem("content-paranja"), "paranja"), this._contentParanja && (BN("main-menu").on("open close", this._handleMenuToggle, this), this._contentParanja.domElem.bind("wheel", this._preventEvent))
            }
        },
        destruct: function() {
            this._contentParanja && (BN("main-menu").un("open close", this._handleMenuToggle, this), this._contentParanja.domElem.unbind("wheel", this._preventEvent)), this.__base.apply(this, arguments)
        },
        _handleMenuToggle: function(e) {
            this._contentParanja.setMod("state", e.type)
        },
        _preventEvent: function(e) {
            e.preventDefault()
        }
    }),
    function(e) {
        e = e || {}, e.oframebustMatchDomain = function(e, t) {
            e = "[object Array]" === Object.prototype.toString.call(e) ? e : function() {
                var t = [];
                for (var i in e) e.hasOwnProperty(i) && t.push(i);
                return t
            }();
            for (var i = 0, n = e.length; n > i; i++) {
                var o = e[i];
                if ("string" == typeof o) {
                    if (/(\?|\*)/.test(o)) {
                        var s = o.replace(/\./g, "\\.").replace(/\*/g, ".*").replace(/\?/g, ".{1}");
                        if (new RegExp("^" + s + "$").test(t)) return !0
                    } else if (t == o) return !0
                } else try {
                    if (o.test(t)) return !0
                } catch (r) {}
            }
        }
    }(window.Lego),
    function(e) {
        e = e || {}, e.oframebust = function(t) {
            if (window.top.location != window.location) {
                var i = document.referrer.match(/^https?:\/\/([^:\/\s]+)\/?.*/);
                if (!i) return;
                !e.oframebustMatchDomain(t, i[1]) && (window.top.location = window.location)
            }
        }
    }(window.Lego), BEM.HTML.decl("b-link", {
        onBlock: function(e) {
            e.tag("a").attr("href", e.param("url"));
            for (var t, i = ["title", "target"]; t = i.pop();) e.param(t) && e.attr(t, e.param(t))
        }
    }), BEM.DOM.decl("link", {
        getDefaultParams: function() {
            return {
                origTabindex: "0"
            }
        },
        onSetMod: {
            disabled: function(e, t) {
                var i = "yes" === t;
                this.domElem.attr({
                    "aria-disabled": i,
                    tabindex: i ? -1 : this.params.origTabindex
                })
            }
        }
    }), BEM.decl("i-services", null, {
        _services: {
            tune: {
                domain: "//tune.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            passport: {
                domain: "//passport.yandex.",
                tlds: {
                    ru: "ru",
                    com: "com",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            feedback2: {
                domain: "//yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru",
                path: "/support/metrika/troubleshooting"
            },
            advertising: {
                domain: "//advertising.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com"
                },
                defaultTld: "ru"
            },
            legal: {
                domain: "//legal.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            api: {
                domain: "//api.yandex.",
                tlds: {
                    ru: "ru",
                    com: "com",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            help: {
                domain: "//yandex.",
                tlds: {
                    ua: "ua",
                    com: "com",
                    "com.tr": "com.tr"
                },
                path: "/support",
                defaultTld: "ru"
            },
            partner: {
                domain: "//partner.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            metrika: {
                domain: "//metrika.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            appmetrika: {
                domain: "//appmetrika.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            webmaster: {
                domain: "//webmaster.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            browser: {
                domain: "//browser.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    com: "com",
                    by: "by",
                    kz: "kz",
                    "com.tr": "com.tr"
                },
                defaultTld: "ru"
            },
            fx: {
                domain: "//fx.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    by: "by",
                    kz: "kz"
                },
                defaultTld: "ru"
            },
            opera: {
                domain: "//opera.yandex.",
                tlds: {
                    ru: "ru",
                    ua: "ua",
                    by: "by",
                    kz: "kz",
                    com: "com",
                    "com.tr": "com"
                },
                defaultTld: "ru"
            }
        },
        getServiceUrl: function(e) {
            var t = BN("i-router").getTld(),
                i = this._services[e],
                n = i.path || "";
            if (i) return i.domain + (i.tlds[t] || i.defaultTld) + n
        }
    }), BEM.DOM.decl("header2", {
        onSetMod: {
            js: {
                inited: function() {
                    this._openedPanel = null
                }
            }
        },
        _setOpenedPanel: function(e) {
            var t = this._openedPanel;
            t !== e && (this._openedPanel = e, this.trigger("panel-switch", {
                closing: t,
                opening: e
            }))
        },
        getOpenedPanel: function() {
            return this._openedPanel
        },
        openPanel: function(e) {
            return this._setOpenedPanel(e), this
        },
        closePanel: function(e) {
            return e && e !== this._openedPanel || this._setOpenedPanel(null), this
        },
        togglePanel: function(e, t) {
            return e !== this._openedPanel || t ? (e !== this._openedPanel && t || arguments.length < 2) && this._setOpenedPanel(e) : this._setOpenedPanel(null), this
        }
    }), BEM.DOM.decl("header2", {
        onSetMod: {
            js: {
                inited: function() {
                    this.__base.apply(this, arguments), this._panelActions = {};
                    var e = this;
                    this.elem("action").each(function() {
                        var t = $(this),
                            i = (e.elemParams(t) || {}).panel;
                        i && (e._panelActions[i] = t)
                    }), $.isEmptyObject(this._panelActions) || this.on("panel-switch", this._toggleActionOnPanelSwitch)
                }
            }
        },
        onElemSetMod: {
            action: {
                checked: function(e, t, i) {
                    var n = "yes" === i;
                    e.attr("aria-pressed", n);
                    var o = this.elemParams(e) || {};
                    o.panel && (this.togglePanel(o.panel, n), e.attr("aria-expanded", n)), o.notice && this.trigger("action-change", {
                        type: this.getMod(e, "type"),
                        checked: n
                    })
                }
            }
        },
        _toggleActionOnPanelSwitch: function(e, t) {
            var i = this._panelActions[t.closing];
            i && this.delMod(i, "checked");
            var n = this._panelActions[t.opening];
            n && this.setMod(n, "checked", "yes")
        },
        _onActionMouseDown: function(e) {
            function t() {
                this.afterCurrentEvent(function() {
                    this.delMod(i, "pressed")
                }), this.unbindFrom(i, "mouseleave"), this.unbindFromDoc("mouseup touchend")
            }
            var i = e.data.domElem;
            this.setMod(i, "pressed", "yes"), this.bindTo(i, "mouseleave", t), this.bindToDoc("mouseup touchend", t)
        },
        _onActionClick: function(e) {
            this.toggleMod(e.data.domElem, "checked", "yes", "")
        },
        _onMouseOverMouseOut: function(e) {
            this.toggleMod(e.data.domElem, "hovered", "yes", "", "mouseover" === e.type)
        },
        _onFocusInFocusOut: function(e) {
            this.toggleMod(e.data.domElem, "focused", "yes", "", "focusin" === e.type)
        }
    }, {
        live: function() {
            this.__base.apply(this, arguments), this.liveBindTo("action", "leftclick tap", function(e) {
                this._onActionClick(e)
            }).liveBindTo("action", "mousedown", function(e) {
                this._onActionMouseDown(e)
            }).liveBindTo("action", "mouseover mouseout", function(e) {
                this._onMouseOverMouseOut(e)
            }).liveBindTo("action", "focusin focusout", function(e) {
                this._onFocusInFocusOut(e)
            })
        }
    }), BEM.JSON.decl("icon", {
        onElem: {
            "*": function(e) {
                e.tag("span").mix([{
                    block: "icon"
                }]).attrs({
                    title: e.param("title")
                })
            }
        }
    }), BEM.DOM.decl("progress", {
        update: function(e, t) {
            return this.setMod("timing", t || "").domElem.css({
                width: 0 >= e ? "0" : e >= 1 ? "100%" : (100 * e).toPrecision(2) + "%"
            }).css("width"), this
        }
    }), BEM.DOM.decl("header2", {
        onSetMod: {
            js: {
                inited: function() {
                    this.__base.apply(this, arguments), this._paranjaPanels = {}, this.on("panel-switch", this._onParanjaPanelSwitch)
                }
            }
        },
        bindParanjaToPanel: function(e) {
            return this._paranjaPanels[e] = !0, this
        },
        _onParanjaClick: function() {
            this.closePanel()
        },
        _onParanjaPanelSwitch: function(e, t) {
            var i = !this._paranjaPanels[t.closing],
                n = !this._paranjaPanels[t.opening];
            i !== n && this._toggleParanja(i)
        },
        _toggleParanja: function(e) {
            this.toggleMod(this.elem("paranja"), "active", "yes", "", e)
        }
    }, {
        live: function() {
            this.__base.apply(this, arguments), this.liveBindTo("paranja", "leftclick tap", function() {
                this._onParanjaClick()
            })
        }
    }), BEM.DOM.decl("header2", {
        onElemSetMod: {
            paranja: {
                active: {
                    yes: function() {
                        this.bindToWin("scroll", function() {
                            this.closePanel()
                        })
                    },
                    "": function() {
                        this.unbindFromWin("scroll")
                    }
                }
            }
        }
    }), BEM.DOM.decl("header2", {
        onSetMod: {
            js: {
                inited: function() {
                    this.__base.apply(this, arguments), this.bindParanjaToPanel("tableau"), this.on("panel-switch", this._onTableauPanelSwitch)
                }
            }
        },
        _onTableauPanelSwitch: function(e, t) {
            "tableau" === t.closing ? this.delMod(this.elem("tableau"), "opened") : "tableau" === t.opening && this.setMod(this.elem("tableau"), "opened", "yes")
        }
    }),
    function(e) {
        var t = e.event.special.leftclick = {
            setup: function() {
                e(this).bind("click", t.handler)
            },
            teardown: function() {
                e(this).unbind("click", t.handler)
            },
            handler: function(t) {
                t.button || (t.type = "leftclick", e.event.dispatch.apply(this, arguments), t.type = "click")
            }
        }
    }(jQuery), BEM.DOM.decl("user", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments);
                var e = this.findBlockOn("enter", "button");
                if (null !== e) {
                    var t = this.domElem.prop("tabindex");
                    this.domElem.attr({
                        tabindex: -1,
                        role: "group"
                    }).removeAttr("aria-haspopup aria-expanded"), e.domElem.attr("tabindex", t), this._domik = BEM.create("domik_type_popup", {
                        mods: this.params.domikMods,
                        js: this.params.domikJs,
                        hidden: this.findBlockInside({
                            block: "domik",
                            modName: "type",
                            modVal: "hidden"
                        })
                    }), e.bindTo("leftclick tap", function(e) {
                        e.preventDefault(), this._domik.open()
                    }.bind(this))
                }
            }
        },
        destruct: function() {
            this._domik && this._domik.destruct(), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl("button", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.attrs || {};
            i.autocomplete || (i.autocomplete = "off", t.attrs = i)
        }
    }), BEM.DOM.decl("button", {
        onSetMod: {
            js: function() {
                var e = this.isDisabled(),
                    t = this.domElem;
                (this._href = t.attr("href")) && e && t.removeAttr("href")
            },
            disabled: function(e, t) {
                var i = "yes" === t,
                    n = this.domElem;
                this._href && (i ? n.removeAttr("href") : n.attr("href", this._href)), this.afterCurrentEvent(function() {
                    n.attr("disabled", i)
                })
            },
            pressed: function(e, t) {
                return this.isDisabled() ? !1 : void this.trigger("yes" === t ? "press" : "release")
            }
        },
        isDisabled: function() {
            return this.hasMod("disabled", "yes")
        },
        url: function(e) {
            return "undefined" == typeof e ? this._href : (this._href = e, this.isDisabled() || this.domElem.attr("href", e), this)
        },
        _onClick: function(e) {
            this.isDisabled() ? e.preventDefault() : this.afterCurrentEvent(function() {
                this.trigger("click")
            })
        }
    }, {
        live: function() {
            this.liveBindTo("leftclick tap", function(e) {
                this._onClick(e)
            })
        }
    }), BEM.DOM.decl("button", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments)
            },
            focused: {
                yes: function() {
                    return this.isDisabled() ? !1 : (this.bindToWin("unload", function() {
                        this.delMod("focused")
                    }).bindTo("keydown", this._onKeyDown), this._isControlFocused() || this._getControl().focus(), void this.afterCurrentEvent(function() {
                        this.trigger("focus")
                    }))
                },
                "": function() {
                    this.unbindFromWin("unload").unbindFrom("keydown"), this._isControlFocused() && this._getControl().blur(), this.afterCurrentEvent(function() {
                        this.trigger("blur")
                    })
                }
            },
            disabled: function(e, t) {
                this.__base.apply(this, arguments), "yes" === t && this.domElem.keyup()
            },
            hovered: function(e, t) {
                return this.isDisabled() ? !1 : void("" === t && this.delMod("pressed"))
            },
            pressed: function() {
                return this.isDisabled() || this.setMod("focused", "yes"), this.__base.apply(this, arguments)
            }
        },
        _getControl: function() {
            return this.elem("control").length && this.elem("control") || this.domElem
        },
        _isControlFocused: function() {
            try {
                return this.containsDomElem($(this.__self.doc[0].activeElement))
            } catch (e) {
                return !1
            }
        },
        _onKeyDown: function(e) {
            var t = e.keyCode;
            13 !== t && 32 !== t || this._keyDowned || (this._keyDowned = !0, this.setMod("pressed", "yes").bindTo("keyup", function() {
                this.delMod("pressed").unbindFrom("keyup"), delete this._keyDowned, 32 === t && this.domElem.attr("href") && (document.location = this.domElem.attr("href"))
            }))
        },
        destruct: function() {
            this.delMod("focused"), this.__base.apply(this, arguments)
        }
    }, {
        live: function() {
            this.__base.apply(this, arguments);
            var e = {
                    mouseover: {
                        name: "hovered",
                        val: "yes"
                    },
                    mouseout: {
                        name: "hovered"
                    },
                    mousedown: {
                        name: "pressed",
                        val: "yes"
                    },
                    mouseup: {
                        name: "pressed"
                    },
                    focusin: {
                        name: "focused",
                        val: "yes"
                    },
                    focusout: {
                        name: "focused"
                    }
                },
                t = $.browser.msie && "8.0" === $.browser.version;
            this.liveBindTo("mouseover mouseout mouseup focusin focusout", function(i) {
                var n = e[i.type];
                this.setMod(n.name, n.val || ""), !t || this._href || "mouseup" !== i.type && "mouseout" !== i.type || this.domElem.height()
            }).liveBindTo("mousedown", function(t) {
                var i = e[t.type];
                1 === t.which && this.setMod(i.name, i.val || "")
            })
        }
    }), BEM.DOM.decl("button", {
        setText: function(e) {
            return this.elem("text").text(e || "")
        }
    }),
    function() {
        function e() {
            o = !0, setTimeout(setTimeout.bind(window, t))
        }

        function t() {
            o = !1
        }

        function i() {
            n.toggleClass("pointerfocus", o)
        }
        if (window.addEventListener) {
            var n = $(document.documentElement),
                o = !1;
            addEventListener("mousedown", e, !0), addEventListener("mouseup", e, !0), addEventListener("click", e, !0), addEventListener("onfocusin" in window ? "focusin" : "focus", i, !0)
        }
    }(), BEM.DOM.decl({
        name: "button",
        modName: "pseudo",
        modVal: "yes"
    }, {
        _onClick: function(e) {
            this.__base.apply(this, arguments), this._href && e.preventDefault()
        }
    }), BEM.decl("domik_type_popup", {
        destruct: function() {
            this._form && this._form.destruct(), this._popup && this._popup.destruct(), this.__base.apply(this, arguments)
        },
        create: function() {
            if (this._created) return this;
            var e, t, i = this.__self,
                n = i._buildTypePopup(this._uniqId, this.params.mods, this.params.js),
                o = $(BEMHTML.apply(n)),
                s = this.params.hidden;
            if (BEM.DOM.append(BEM.DOM.scope, o), t = this._popup = o.bem("popup"), e = this._form = this._popup.findBlockInside("auth"), s) {
                var r = s.domElem;
                e.getUsernameBlock().val(r.find("input[name=login]").change().val()), e.getPasswordBlock().val(r.find("input[name=passwd]").change().val()), delete this.params.hidden, s.destruct()
            }
            return this._created = !0, this
        },
        open: function() {
            var e = this;
            return BEM.blocks["i-global"].param("login") ? this : (this._created || this.create(), this.close(), this._popup.show(), this.afterCurrentEvent(function() {
                e._form.getUsernameBlock().setMod("focused", "yes"), e._form.redraw()
            }), this)
        },
        close: function() {
            return this._popup.hide(), this
        },
        isOpened: function() {
            return this._popup && this._popup.isShown() || !1
        },
        getFormBlock: function() {
            return this._form
        }
    }, {
        _buildTypePopup: function(e, t, i) {
            var n = (i || {}).explain;
            return {
                block: "popup",
                mix: [{
                    block: "domik",
                    elem: "popup"
                }],
                mods: {
                    type: "modal",
                    position: "fixed",
                    "body-scroll": "no",
                    theme: "ffffff"
                },
                underMods: {
                    type: "paranja"
                },
                content: {
                    elem: "content",
                    content: {
                        block: "domik",
                        js: $.extend({
                            _uniqId: e
                        }, i),
                        mods: $.extend({
                            type: "popup"
                        }, t),
                        content: [n ? {
                            elem: "explain",
                            content: n
                        } : "", {
                            block: "auth",
                            mods: {
                                content: "auto"
                            }
                        }]
                    }
                }
            }
        }
    }), BEM.decl("domik_type_popup", {
        forceOpen: function() {
            var e = this;
            return this._created || this.create(), this.close(), this._popup.show(), this.afterCurrentEvent(function() {
                e._form.getUsernameBlock().setMod("focused", "yes"), e._form.redraw()
            }), this
        }
    }, {
        getWithCurrentLang: function() {
            if (!this._domik) {
                var e = BN("i-locale").getLang(); - 1 === ["en", "tr"].indexOf(e) && (e = "ru"), this._domik = BEM.create("domik_type_popup", {
                    mods: {
                        logo: e
                    }
                })
            }
            return this._domik
        }
    }),
    function(e) {
        var t, i = e.browser,
            n = i.opera && i.version < 13,
            o = i.opera && i.version < 12.1 ? "keypress" : "keydown",
            s = Object.prototype.hasOwnProperty,
            r = BEM.DOM,
            a = i.msie && i.version >= 9 && i.version < 10,
            l = function(e) {
                try {
                    return e.activeElement
                } catch (t) {}
            };
        BEM.DOM.decl("popup", {
            getDefaultParams: function() {
                var e = {
                    left: 15,
                    right: 15,
                    top: 15,
                    bottom: 15
                };
                return {
                    directions: [{
                        to: "bottom",
                        axis: "center",
                        tail: {
                            axis: "center"
                        }
                    }, {
                        to: "top",
                        axis: "center",
                        tail: {
                            axis: "center"
                        }
                    }, {
                        to: "right",
                        axis: "middle",
                        tail: {
                            axis: "middle"
                        }
                    }, {
                        to: "left",
                        axis: "middle",
                        tail: {
                            axis: "middle"
                        }
                    }],
                    tail: {
                        width: 24.04,
                        height: 12.02,
                        offset: e
                    },
                    duration: 150
                }
            },
            onSetMod: {
                js: function() {
                    this._cache = {}, this._viewport = r.win, this._scope = r.scope, this._channel = BEM.channel("popups"), this._inContainer = !1, this._isParentFixed = !1, this._owner = null, this._userPosition = null, this._parent = null, this._childs = [], this._isShown = !1, this._isHiding = !1, this._positions = {}, this._currPos = {}, this._visibilityFactor = null, this._direction = !1, this._directions = {};
                    var e = this.getDefaultParams(),
                        t = this.params,
                        i = this._repackDirParams(e.directions),
                        n = t.generateDirections ? this._generateDirections : t.directions,
                        o = this._repackDirParams(n);
                    t.tail && (this.params.tail = this._mergeParams(e.tail, t.tail)), this._order = o.keys.map(function(e) {
                        var t = o.directions[e],
                            n = i.directions[e];
                        return n || (n = i.directions[t.to]), this._directions[e] = this._mergeParams(n, t, {
                            tail: this._tailParamsHook
                        }), e
                    }, this)
                },
                visibility: {
                    visible: function() {
                        this._onShown()
                    },
                    "": function() {
                        this._onHidden()
                    }
                }
            },
            show: function(t) {
                var i;
                if (t instanceof BEM) i = t.domElem.eq(0);
                else if (t instanceof e) i = t;
                else if (!t) return;
                if (i) {
                    this._owner && i[0] !== this._owner[0] && this.delMod("visibility"), this._owner = i;
                    var n = this._findParent(i);
                    n && this.setParent(n)
                } else this._userPosition = t;
                return this.setMod("visibility", "outside").repaint()
            },
            hide: function() {
                if (this._isHiding) return this;
                if (this._isShown && (this._isHiding = !0, this._childs.forEach(function(e) {
                        e.hide()
                    }), this.hasMod("animate", "yes") && !this.hasMod("fade-out", "no"))) {
                    var e = this;
                    return this.beforeHide(function() {
                        e.domElem && e.delMod("visibility")
                    }), this
                }
                return this.delMod("visibility")
            },
            toggle: function(e) {
                return this._isShown && !this._isHiding ? this.hide() : this.show(e || this._owner)
            },
            repaint: function() {
                this._moveToContainer();
                var e = this._pickDirection();
                return this.setMod("to", e.to)._show(this._positions[e.key], this._tailPos && this._tailPos[e.key]), this
            },
            repaintShadowIfNeeded: function() {
                return a && this._repaintShadow(), this
            },
            getCurrPos: function() {
                return this._currPos
            },
            getCurrDirection: function() {
                return this._direction
            },
            setContent: function(e) {
                return r.update(this.elem("content"), e), this._resetDefault(), this._isShown && this.repaint(), this
            },
            isShown: function() {
                return this._isShown
            },
            setParent: function(e) {
                return this._parent = e, this._isParentFixed = e.hasMod("position", "fixed"), e.addChild(this), this
            },
            addChild: function(e) {
                for (var t = this._childs, i = t.length, n = 0; i > n; n++)
                    if (t[n]._uniqId === e._uniqId) return;
                e.on("hide", function() {
                    this.removeChild(e)
                }, this), t.push(e)
            },
            removeChild: function(e) {
                for (var t = this._childs, i = t.length, n = 0; i > n; n++)
                    if (t[n]._uniqId === e._uniqId) return void t.splice(n, 1)
            },
            setSize: function(e) {
                return e && (this._resetDefault(), this.domElem.css(e), this._isShown && !this._isHiding && this.repaint()), this
            },
            _show: function(e, t) {
                return this._currPos = e, t && this.elem("tail").removeAttr("style").css(t), this.domElem.css(e), (!this._isShown || this._isHiding) && this.hasMod("animate", "yes") && !this.hasMod("fade-in", "no") && this.afterShow(), this._isHiding = !1, this.setMod("visibility", "visible"), this
            },
            _onShown: function() {
                this.bindToDoc(o, function(e) {
                    27 === e.which && 0 === this._childs.length && this.hide()
                }), this._bindFocusEvents(), this._attachUnder(), this._isShown = !0, this.hasMod("autoclosable", "yes") && this.afterCurrentEvent(function() {
                    this._enableAutoclosable()
                }), this.hasMod("adaptive", "yes") && this._enableAdaptive(), this._channel.on("hide", this.hide, this), this.trigger("show")
            },
            _onHidden: function() {
                this._unbindFocusEvents(), this.unbindFromDoc(o), this._detachUnder(), this.hasMod("autoclosable", "yes") && this._disableAutoclosable(), this.hasMod("adaptive", "yes") && this._disableAdaptive(), this._cache = {}, this._isShown = !1, this._isHiding = !1, this._channel.un("hide"), this._returnFocus(), this.trigger("hide")
            },
            _bindFocusEvents: function() {
                this._lastFocused = e(l(document) || this._scope);
                var t = this.__self._getFocusable(this.elem("content"));
                return this._firstFocusable = t.first(), this._lastFocusable = t.last(), this._skipReturnFocus = !1, 0 === this._firstFocusable.length ? void(this._skipReturnFocus = !0) : void this.bindTo(this._lastFocused, "keydown", this._onLastFocusedKeyDown).bindTo(this._firstFocusable, "keydown", this._onFirstFocusableKeyDown).bindTo(this._lastFocusable, "keydown", this._onLastFocusableKeyDown)
            },
            _unbindFocusEvents: function() {
                this.unbindFrom(this._firstFocusable, "keydown"), this.unbindFrom(this._lastFocusable, "keydown"), this.unbindFrom(this._lastFocused, "keydown")
            },
            _onLastFocusedKeyDown: function(e) {
                e.ctrlKey || e.altKey || e.metaKey || 9 === e.which && (e.preventDefault(), this[e.shiftKey ? "_lastFocusable" : "_firstFocusable"].focus())
            },
            _onFirstFocusableKeyDown: function(e) {
                e.ctrlKey || e.altKey || e.metaKey || e.shiftKey && 9 === e.which && (e.preventDefault(), this._lastFocused.focus())
            },
            _onLastFocusableKeyDown: function(e) {
                e.shiftKey || e.ctrlKey || e.altKey || e.metaKey || 9 === e.which && (e.preventDefault(), this._lastFocused.focus())
            },
            _returnFocus: function() {
                var e = (this._parent || {})._skipReturnFocus || this._skipReturnFocus;
                e || this._lastFocused.focus()
            },
            _mergeParams: function(e, t, i) {
                var n = {};
                return i || (i = {}), e && "object" == typeof e && Object.keys(e).forEach(function(t) {
                    n[t] = e[t]
                }), Object.keys(t).forEach(function(o) {
                    var r = s.call(i, o) ? i[o].call(this, e[o], t[o]) : t[o];
                    !r || "object" != typeof r || Array.isArray(r) ? n[o] = r : e[o] ? n[o] = this._mergeParams(e[o], r, i) : n[o] = r
                }, this), n
            },
            _tailParamsHook: function(e, t) {
                return t.offset || (t.offset = this.params.tail.offset), "number" == typeof t.offset ? {
                    offset: {
                        left: t.offset,
                        top: t.offset
                    }
                } : t
            },
            _generateDirections: function() {
                if (t) return t;
                for (var e = [
                        ["bottom", "top"],
                        ["left", "right"]
                    ], i = [
                        ["center", "left", "right"],
                        ["middle", "top", "bottom"]
                    ], n = i, o = e.length, s = [], r = 0; o > r; r++)
                    for (var a = e[r], l = a.length, c = 0; l > c; c++)
                        for (var d = i[r], u = d.length, h = 0; u > h; h++)
                            for (var m = n[r], p = m.length, f = 0; p > f; f++) s.push({
                                direction: a[c],
                                axis: d[h],
                                tail: {
                                    axis: m[f]
                                }
                            });
                return t = s, s
            },
            _repackDirParams: function(t) {
                var i = {},
                    n = [];
                return ("string" == typeof t || e.isPlainObject(t)) && (t = [t]), n = t.map(function(e) {
                    if ("string" == typeof e) {
                        var t = e.split("-");
                        e = {
                            to: t[0],
                            tail: {}
                        }, t[1] && (e.axis = t[1]), t[2] && (e.tail.axis = t[2])
                    }
                    var n = e.to;
                    return i[n] || (i[n] = e), e.axis && (n += "-" + e.axis), e.key = n, i[n] = e, n
                }, this), {
                    directions: i,
                    keys: n
                }
            },
            setViewport: function(e) {
                return this._viewport = e, this
            },
            _pickDirection: function() {
                var e, t = this._order,
                    i = this.hasMod("adaptive", "yes") ? t.length : 1;
                for (this._visibilityFactor = 0, e = 0; i > e; e++) {
                    var n = t[e],
                        o = this._directions[n];
                    this._resetPos(n)._pushPos(n, this._calcPos(o))._pushPos(n, this._calcOffsets(o)), this._hasTail() && this._resetTailPos(n)._pushTailPos(n, this._calcTailPos(o))._pushTailPos(n, this._calcTailOffset(o))._pushPos(n, this._calcOffsetByTail(o)), this._pushPos(n, this._getParentOffset());
                    var s = this._calcVisibilityFactor(o);
                    if ((s > this._visibilityFactor || !this._direction) && (this._visibilityFactor = s, this._direction = this._directions[n], this.size = this.getPlacingSize(), 100 === s)) break
                }
                return this._direction
            },
            _getParentOffset: function() {
                var e = this.domElem.offsetParent().offset();
                return e.left *= -1, e.top *= -1, e
            },
            _calcPos: function(e) {
                this._calcPlacingSize(e);
                var t = this.getOwnerPos(),
                    i = this.getOwnerSize(),
                    n = this.getPlacingSize(),
                    o = e.axis,
                    r = this.params.position || {},
                    a = {};
                switch (e.to) {
                    case "bottom":
                        a = {
                            top: s.call(r, "top") ? r.top : t.top + i.height,
                            left: s.call(r, "left") ? r.left : this._calcLeft(o)
                        };
                        break;
                    case "top":
                        a = {
                            top: s.call(r, "top") ? r.top : t.top - n.height,
                            left: s.call(r, "left") ? r.left : this._calcLeft(o)
                        };
                        break;
                    case "left":
                        a = {
                            top: s.call(r, "top") ? r.top : this._calcTop(o),
                            left: s.call(r, "left") ? r.left : t.left - n.width
                        };
                        break;
                    case "right":
                        a = {
                            top: s.call(r, "top") ? r.top : this._calcTop(o),
                            left: s.call(r, "left") ? r.left : t.left + i.width
                        }
                }
                return a
            },
            _calcTop: function(e) {
                var t = 0,
                    i = this.getPlacingSize(),
                    n = this.getOwnerPos(),
                    o = this.getOwnerSize();
                return "top" === e ? t += n.top : "middle" === e ? t += n.top + o.height / 2 - i.height / 2 : "bottom" === e && (t += n.top + o.height - i.height), t
            },
            _calcLeft: function(e) {
                var t = 0,
                    i = this.getPlacingSize(),
                    n = this.getOwnerPos(),
                    o = this.getOwnerSize();
                return "left" === e ? t += n.left : "center" === e ? t += n.left + o.width / 2 - i.width / 2 : "right" === e && (t += n.left + o.width - i.width), t
            },
            getPlacingSize: function() {
                return this.getPopupSize()
            },
            _calcOffsets: function(e) {
                var t, i = this._cache.offset || (this._cache.offset = {}),
                    n = e.key,
                    o = e.offset;
                if (i[n]) return i[n];
                if (!o) return !1;
                if (t = {
                        left: 0,
                        top: 0
                    }, "number" == typeof o) switch (n) {
                    case "left":
                        t.left += o;
                        break;
                    case "right":
                        t.left -= o;
                        break;
                    case "top":
                        t.top += o;
                        break;
                    case "bottom":
                        t.top -= o
                } else o.left && (t.left += o.left), o.right && (t.left -= o.right), o.top && (t.top += o.top), o.bottom && (t.top -= o.bottom);
                return i[n] = t, t
            },
            _hasTail: function() {
                return 0 !== this.elem("tail").length
            },
            _moveToContainer: function(e) {
                if (e) this._inContainer = !1;
                else {
                    if (this._isShown) return;
                    e = this._parent ? this._parent.domElem : this._scope
                }
                this.domElem.appendTo(e), this._inContainer = !0
            },
            _resetPos: function(e) {
                return e ? this._positions[e] = null : this._positions = {}, this
            },
            _pushPosTo: function(e, t, i) {
                i !== !1 && ("string" == typeof t ? this._sum(e[t] || (e[t] = {}), i) : (i = t, Object.keys(e).forEach(function(t) {
                    this._sum(e[t], i)
                }, this)))
            },
            _pushPos: function(e, t) {
                return this._pushPosTo(this._positions, e, t), this
            },
            _sum: function(e, t) {
                Object.keys(t).forEach(function(i) {
                    e[i] = (e[i] || 0) + t[i]
                })
            },
            _getSizeOf: function(e) {
                return {
                    height: e.outerHeight(),
                    width: e.outerWidth()
                }
            },
            getOwnerSize: function() {
                return this._owner ? this._cache.ownerSize || (this._cache.ownerSize = this._getSizeOf(this._owner)) : {
                    height: 0,
                    width: 0
                }
            },
            getPopupSize: function() {
                return this._getSizeOf(this.domElem)
            },
            _getPosOf: function(e) {
                return e.offset() || {
                    left: 0,
                    top: 0
                }
            },
            getOwnerPos: function() {
                var e;
                return this._owner && (e = this._getPosOf(this._owner), "pageYOffset" in window && (e.top -= window.pageYOffset - (document.documentElement.scrollTop || document.body.scrollTop), e.left -= window.pageXOffset - (document.documentElement.scrollLeft || document.body.scrollLeft))), e || this._userPosition
            },
            _calcVisibilityFactor: function(e) {
                var t, i, n = this._viewport,
                    o = this._getSizeOf(n),
                    s = this.getPopupSize(),
                    r = this._positions[e.key],
                    a = this._parent ? this._parent.domElem.offset() : {
                        top: 0,
                        left: 0
                    },
                    l = r.top + (this._isParentFixed ? a.top : -n.scrollTop()),
                    c = r.left + (this._isParentFixed ? a.left : -n.scrollLeft()),
                    d = c + s.width - o.width,
                    u = l + s.height - o.height,
                    h = {
                        height: s.height,
                        width: s.width
                    },
                    m = 100;
                return u > 0 && (h.height -= u), 0 > l && (h.height += l), 0 > c && (h.width += c), d > 0 && (h.width -= d), h.height < 0 || h.width < 0 ? m = 0 : (i = Math.abs(h.height * h.width), t = s.height * s.width, t !== i && (m = i / t * 100)), m
            },
            _repaintShadow: function() {
                "undefined" == typeof this._repaintShadowCounter && (this._repaintShadowCounter = 0), this.domElem.css("zoom", 1 & ++this._repaintShadowCounter)
            },
            _findParent: function(e) {
                return this.findBlockOutside(e, "popup")
            },
            destruct: function() {
                return this._childs.forEach(function(e) {
                    BEM.DOM.destruct(e.domElem)
                }), this.setMod("fade-out", "no"), this.hide(), this.__base.apply(this, arguments)
            },
            _resetDefault: function() {},
            _calcPlacingSize: function() {}
        }, {
            live: function() {
                this.liveBindTo("close", "leftclick tap", function() {
                    this.hide()
                })
            },
            _getFocusable: function(t) {
                var i = e.data(t, "popup-getFocusable-id");
                i || (i = e.identify(), e.data(t, "popup-getFocusable-id", i)), i = '*[data-popup-getFocusable-id="' + i + '"]';
                var o = n ? "" : "a[href], link, ";
                return t.find(o + '*[tabindex], button, input:not([type="hidden"]), textarea, select, menuitem').filter(function() {
                    var t = e(this),
                        n = !0;
                    return parseInt(t.prop("tabindex"), 10) < 0 || "hidden" === t.css("visibility") ? !1 : (e(this).parentsUntil(i).each(function() {
                        var t = e(this);
                        return "none" === t.css("display") ? n = !1 : void 0
                    }), n)
                })
            }
        })
    }(jQuery), BEM.DOM.decl("popup", {
        setContent: function() {
            return this.hasMod("animate", "yes") && this.domElem.stop(!0, !0), this.__base.apply(this, arguments)
        },
        holdSize: function(e) {
            return e || (e = {
                width: this.domElem.outerWidth(),
                height: this.domElem.outerHeight()
            }), this.setSize(e), this
        },
        _onHidden: function() {
            this.__base.apply(this, arguments), this._parent = null
        }
    }), BEM.DOM.decl("popup", {
        onSetMod: {
            autoclosable: {
                yes: function() {
                    this._enableAutoclosable()
                },
                "": function() {
                    this._disableAutoclosable()
                }
            }
        },
        _enableAutoclosable: function() {
            var e = this._under;
            this.hasMod(e, "type", "paranja") && (e.is("iframe") && (e = $([e[0].contentWindow, e[0].contentWindow.document])), this.bindTo(e, "leftclick tap", function(e) {
                e.stopPropagation(), this.hide()
            }), this.bindTo(e, "mousedown", function() {
                this._skipReturnFocus = !0
            })), this.bindToDoc("leftclick tap", function(e) {
                if (!this._isRelatedNode($(e.target))) {
                    var t = $.Event("outside-click");
                    this.trigger(t, e), t.isDefaultPrevented() || this.hide()
                }
            }), this.bindToDoc("mousedown", function() {
                this._skipReturnFocus = !0
            })
        },
        _disableAutoclosable: function() {
            this.hasMod(this._under, "type", "paranja") && this.unbindFrom(this._under, "leftclick tap mousedown"), this.unbindFromDoc("leftclick tap mousedown")
        },
        _isRelatedNode: function(e) {
            var t = this.containsDomElem(e);
            if (t || (t = Boolean(this._owner) && this.containsDomElem.call({
                    domElem: this._owner
                }, e)), t) return !0;
            var i, n = this._childs.length;
            for (i = 0; n > i; i++)
                if (this.containsDomElem.call({
                        domElem: this._childs[i].domElem
                    }, e)) return !0;
            return !1
        }
    }), BEM.DOM.decl("popup", {
        _enableAutoclosable: function() {
            this.__base.apply(this, arguments), this.unbindFromDoc("leftclick tap mousedown"), this._unbindAutoCloseEvents(), this._handleOutsideClick = this._handleOutsideClick.bind(this), this._handleDocumentMouseDown = this._handleDocumentMouseDown.bind(this), document.addEventListener("click", this._handleOutsideClick, !0), document.addEventListener("touchstart", this._handleOutsideClick, !0), document.addEventListener("mousedown", this._handleDocumentMouseDown, !0)
        },
        _unbindAutoCloseEvents: function() {
            document.removeEventListener("click", this._handleOutsideClick, !0), document.removeEventListener("touchstart", this._handleOutsideClick, !0), document.removeEventListener("mousedown", this._handleDocumentMouseDown, !0)
        },
        _handleOutsideClick: function(e) {
            var t = $.Event("outside-click");
            this._isRelatedNode($(e.target)) || (this.trigger(t, e), t.isDefaultPrevented() || this.hide())
        },
        _handleDocumentMouseDown: function() {
            this._skipReturnFocus = !0
        },
        destruct: function() {
            return this._unbindAutoCloseEvents(), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "adaptive",
        modVal: "yes"
    }, {
        onSetMod: {
            adaptive: {
                yes: function() {
                    this._enableAdaptive()
                },
                no: function() {
                    this._disableAdaptive()
                }
            },
            "watch-scroll": {
                yes: function() {
                    this._watchScroll()
                },
                no: function() {
                    this._unwatchScroll()
                }
            }
        },
        _enableAdaptive: function() {
            this.afterCurrentEvent(function() {
                this.domElem && this.bindToWin("resize", this.onResize)
            }), this._watchScroll()
        },
        _disableAdaptive: function() {
            this.unbindFromWin("resize")._unwatchScroll()
        },
        getScrollEvents: function() {
            return ["scroll"]
        },
        _watchScroll: function() {
            this._owner && !this.hasMod("watch-scroll", "no") && this.bindTo(this._owner.parents().add(this._viewport), this.getScrollEvents().join(" "), this.onScroll, this)
        },
        _unwatchScroll: function() {
            this._owner && this.unbindFromDomElem(this._owner.parents().add(this._viewport), this.getScrollEvents().join(" "))
        },
        onResize: function(e) {
            this._cache = {}, this._isShown && !this._isHiding && this.repaint()
        },
        onScroll: function(e) {
            this._cache = {}, this._isShown && !this._isHiding && this.repaint()
        },
        destruct: function() {
            this._disableAdaptive(), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "animate",
        modVal: "yes"
    }, {
        afterShow: function() {
            var e = this.getCurrDirection();
            if (e) {
                var t = e.to,
                    i = this.getCurrPos(),
                    n = {
                        opacity: 1,
                        top: i.top,
                        left: i.left
                    },
                    o = {
                        opacity: 0,
                        top: i.top,
                        left: i.left
                    };
                "bottom" === t ? o.top += 10 : "top" === t ? o.top -= 10 : "left" === t ? o.left -= 10 : "right" === t && (o.left += 10), this.domElem.stop(!0).css(o).animate(n, this.params.duration)
            }
        },
        beforeHide: function(e) {
            var t = this.getCurrDirection();
            if (!t) return e();
            var i = t.to,
                n = this.getCurrPos(),
                o = this.domElem,
                s = {
                    top: n.top,
                    left: n.left,
                    opacity: 0
                };
            return "bottom" === i ? s.top += 10 : "top" === i ? s.top -= 10 : "left" === i ? s.left -= 10 : "right" === i && (s.left += 10), o.stop(!0, !0).animate(s, this.params.duration, function() {
                e(), o.css("opacity", "")
            })
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "animate",
        modVal: "yes"
    }, {
        beforeHide: function() {
            this.trigger("beforeHide"), this.__base.apply(this, arguments)
        }
    }),
    function() {
        var e = [];
        BEM.DOM.decl("popup", {
            onSetMod: {
                js: function() {
                    this.__base.call(this);
                    var e = this.findElem("under").first();
                    this._underClassAttr = e.attr("class"), this.isDivEnough() ? this._under = e : (e.remove(), this._under = null), this._underInPool = !1
                }
            },
            isDivEnough: function() {
                return !1
            },
            _createUnder: function() {
                return $('<iframe frameBorder="0" tabindex="-1" src="about:blank"/>');
            },
            _getUnder: function() {
                if (this._under) return this._under;
                var t = e.pop();
                return t && (this._underInPool = !1), this._under = t || this._createUnder()
            },
            _attachUnder: function() {
                var e = this._under = this._getUnder();
                e.attr("class", this._underClassAttr), this.hasMod(e, "type", "paranja") ? e.detach().insertBefore(this.domElem) : e.prependTo(this.domElem)
            },
            _detachUnder: function() {
                var t = this._under;
                e.push(t.detach()), this._under = null, this._underInPool = !0
            },
            destruct: function() {
                return this._underInPool && e.pop(), this._under && this._under.remove(), this.__base.apply(this, arguments)
            }
        })
    }(), BEM.DOM.decl({
        block: "popup",
        modName: "type",
        modVal: "modal"
    }, {
        getDefaultParams: function() {
            var e = this.__base();
            return e.top = "50%", e.left = "50%", e
        },
        _isPercentVal: function(e) {
            return "string" == typeof e && e.indexOf("%") > 0
        },
        show: function(e) {
            return this._moveToContainer(), this.setMod("visibility", "outside").setMod("adaptive", "no"), this.repaint(e), this
        },
        repaint: function(e) {
            this._moveToContainer(), e || (e = {
                left: this.params.left,
                top: this.params.top
            });
            var t = this.getPopupSize();
            return this._isPercentVal(e.left) && !e.marginLeft && (e.marginLeft = t.width / (-100 / parseInt(e.left, 10))), this._isPercentVal(e.top) && !e.marginTop && (e.marginTop = t.height / (-100 / parseInt(e.top, 10))), this._show(e), this
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "position",
        modVal: "fixed"
    }, {
        addChild: function(e) {
            this.__base.apply(this, arguments), e.setMod("watch-scroll", "no")
        },
        _onFirstFocusableKeyDown: function(e) {
            e.ctrlKey || e.altKey || e.metaKey || e.shiftKey && 9 === e.which && (e.preventDefault(), this._lastFocusable.focus())
        },
        _onLastFocusableKeyDown: function(e) {
            e.shiftKey || e.ctrlKey || e.altKey || e.metaKey || 9 === e.which && (e.preventDefault(), this._firstFocusable.focus())
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "position",
        modVal: "fixed"
    }, {
        getOwnerPos: function() {
            var e = this.__base.apply(this, arguments);
            if (this._owner) {
                var t = this._viewport;
                e.top -= t.scrollTop(), e.left -= t.scrollLeft()
            }
            return e
        }
    }),
    function() {
        var e = {};
        BEM.DOM.decl({
            block: "popup",
            modName: "body-scroll",
            modVal: "no"
        }, {
            onSetMod: {
                visibility: function() {
                    return this.afterCurrentEvent(function() {
                        this.domElem && this.hasMod("visibility", "visible") ? e[this.params.uniqId] = !0 : delete e[this.params.uniqId], this._manageScopeOverflow()
                    }), this.__base()
                }
            },
            destruct: function() {
                var t = this.params.uniqId;
                e[t] && (delete e[t], this._manageScopeOverflow()), this.__base.apply(this, arguments)
            },
            _enableScroll: function() {
                return this._scope.css({
                    overflow: ""
                }), this
            },
            _disableScroll: function() {
                return this._scope.css({
                    overflow: "hidden"
                }), this
            },
            _manageScopeOverflow: function() {
                var t = Object.keys(e).length;
                0 === t ? this._enableScroll() : 1 === t && this._disableScroll()
            }
        })
    }(),
    function() {
        function e(e, t, i, n) {
            var o = e.__self,
                s = n.checkEmpty;
            return [function() {
                return s && 0 === t.length ? [e._username, "fill-input"] : !0
            }, function() {
                return s && 0 === i.length ? [e._password, "fill-input"] : !0
            }, function() {
                return /[а-яА-ЯёЁ]/.test(i) ? [e._password, "wrong-keyboard-layout"] : !0
            }, function() {
                return o._isUsernameValid(t, !s) ? !0 : [e._username, "wrong-characters"]
            }, function() {
                return o._isPasswordValid(i) ? !0 : [e._password, "wrong-characters"]
            }, function() {
                return i && i === t ? [e._password, "wrong-password"] : !0
            }]
        }
        BEM.DOM.decl("auth", {
            onSetMod: {
                js: {
                    inited: function() {
                        this._username = this.findBlockInside("username", "input").on("change", this._onInputChange, this), this._password = this.findBlockInside("password", "input").on("change", this._onInputChange, this), this._button = this.findBlockInside("button", "button"), this._error = null, this._errorOwner = null, this.bindTo("submit", this._onBeforeSubmit), this.redraw()
                    }
                }
            },
            destruct: function() {
                this._error && this._error.destruct(), this.__base.apply(this, arguments)
            },
            _checkInput: function(t) {
                var i = this,
                    n = e(i, i._username.val(), i._password.val(), {
                        checkEmpty: t
                    }),
                    o = n.every(function(e) {
                        var t = e();
                        return Array.isArray(t) ? (i.showError(t[0], BEM.I18N("auth", t[1])), t[0].elem("control").attr("aria-invalid", !0), !1) : !0
                    });
                return o && (this.hideError(), this._username.elem("control").removeAttr("aria-invalid"), this._password.elem("control").removeAttr("aria-invalid")), o
            },
            _onInputChange: function(e) {
                this._checkInput(!1)
            },
            enableButton: function() {
                return this._button.delMod("disabled"), this
            },
            disableButton: function() {
                return this._button.setMod("disabled", "yes"), this
            },
            _onBeforeSubmit: function(e) {
                return this._username.val(this._username.val().trim()), this._checkInput(!0) ? (this._onSubmit(e), void this.trigger("submit", e)) : !1
            },
            _onSubmit: function(e) {
                if (this.disableButton(), this.elem("retpath").val(this.__self._getRetpath()), !this._timestamp) {
                    var t = this.__self._timestampName;
                    this._timestamp = $('<input type="hidden" name="' + t + '"/>').appendTo(this.domElem)
                }
                this._timestamp.val(+new Date);
                var i = this.domElem.attr("action");
                i && this.domElem.attr("action", i.replace(/^(https?:)?/, "https:"))
            },
            _getError: function() {
                if (this._error) return this._error;
                var e = $(BEMHTML.apply(this.__self._buildError()));
                return BEM.DOM.append(this.domElem, e), this._error = this.findBlockOn(e, "popup"), this._errorMsg = this.findElem(e, "error"), this._error.on("hide", function() {
                    this._errorOwner = null
                }, this), this._error
            },
            showError: function(e, t) {
                var i = this._getError();
                return this._curErrorMsg !== t && (this._errorMsg.text(t), this._curErrorMsg = t), this._errorOwner !== e && (this._errorOwner = e, i.hide().show(e)), this
            },
            hideError: function() {
                return this._error && this._error.hide(), this
            },
            getUsernameBlock: function() {
                return this._username
            },
            getPasswordBlock: function() {
                return this._password
            },
            getHaunterBlock: function() {
                return this._haunter || (this._haunter = this.findBlockInside("haunter", "checkbox")), this._haunter
            },
            submit: function() {
                return this.domElem.submit(), this
            },
            redraw: function() {
                var e, t = this.__self;
                return this._onInputChange(), e = this.findBlockInside("register", "button"), e && e.url(t._getRegisterURL()), e = this.findBlockInside("remember", "button"), e && e.url(t._getRememberURL()), this
            }
        }, {
            _fromName: "from",
            _retpathName: "retpath",
            _timestampName: "timestamp",
            _isUsernameValid: function(e, t) {
                return this._isUsernameEmailValid(e) || this._isUsernameLoginValid(e) || this._isUsernamePhoneValid(e, t)
            },
            _isUsernameEmailValid: function(e) {
                return /^\s*[^@\s]+@[^@\s]+\s*$/.test(e)
            },
            _isUsernameLoginValid: function(e) {
                return /^\s*[-а-яА-ЯёЁA-Za-z0-9.]+\s*$/.test(e)
            },
            _isUsernamePhoneValid: function(e, t) {
                return t ? (e = e.trim(), e = e.replace(/-\)/, "+)"), e = e.replace(/(\d)-/g, "$1"), e = e.replace(/\((\d+)\)/, "$1"), e = e.replace(/(^|\d+)\(/, "$1"), e = e.replace(/^\+/, ""), /^\d*$/.test(e)) : /^\+?[-0-9]*(?:\([-0-9]+\))?[-0-9]+$/.test(e)
            },
            _isPasswordValid: function(e) {
                return !/[^\-a-zA-Z0-9`!@#$%^&*()_=+\[\]{};:"\|\\,.<>\/?]/.test(e)
            },
            _getRetpath: function() {
                return BEM.blocks["i-global"].param("retpath")
            },
            _getPassportURL: function(e) {
                var t = BEM.blocks["i-global"],
                    i = t.param("passport-host"),
                    n = t.param("passport-msg"),
                    o = this._getRetpath();
                return [i, "/passport?mode=", e, n ? "&" + this._fromName + "=" + encodeURIComponent(n) : "", o ? "&" + this._retpathName + "=" + encodeURIComponent(o) : ""].join("")
            },
            _getRegisterURL: function() {
                return this._getPassportURL("register")
            },
            _getRememberURL: function() {
                return this._getPassportURL("restore")
            },
            _buildError: function() {
                return {
                    block: "popup",
                    mods: {
                        autoclosable: "no"
                    },
                    js: {
                        directions: ["right", "left"]
                    },
                    attrs: {
                        role: "alert",
                        "aria-live": "assertive",
                        "aria-atomic": !0
                    },
                    content: [{
                        elem: "tail"
                    }, {
                        elem: "content",
                        mix: [{
                            block: "auth",
                            elem: "error"
                        }]
                    }]
                }
            }
        })
    }(), BEM.DOM.decl("auth", {
        onSetMod: {
            js: {
                inited: function() {
                    var e = this;
                    e.__base.apply(e, arguments);
                    var t = document.createElement("b");
                    t.innerHTML = "<!--[if IE 9]><i></i><![endif]-->", 1 === t.getElementsByTagName("i").length && e._username.elem("control").add(e._password.elem("control")).keydown(function(t) {
                        return 13 === t.which ? (e.submit(), !1) : void 0
                    })
                }
            }
        }
    }), BEM.DOM.decl("popup", {
        onSetMod: {
            js: function() {
                this.__base(), this._tailPos = {}
            }
        },
        _calcTailPos: function(e) {
            var t = e.to,
                i = this._positions[e.key],
                n = e.tail.axis,
                o = {};
            return "top" === t || "bottom" === t ? o.left = this._calcTailLeft(n, i) : ("left" === t || "right" === t) && (o.top = this._calcTailTop(n, i)), o
        },
        _calcTailTop: function(e, t) {
            var i = 0,
                n = this.getOwnerSize(),
                o = this.getOwnerPos(),
                s = this.params.tail.width,
                r = this.getPopupSize(),
                a = r.height,
                l = o.top - t.top,
                c = t.top + r.height - (o.top + n.height);
            return l > 0 && (i += l, a -= l), c > 0 && (a -= c), "middle" === e ? (a -= s, i += a / 2) : "bottom" === e && (a -= s, i += a), 0 > i && (i = 0), i
        },
        _calcTailLeft: function(e, t) {
            var i = 0,
                n = this.getOwnerSize(),
                o = this.getOwnerPos(),
                s = this.params.tail.width,
                r = this.getPopupSize(),
                a = o.left - t.left,
                l = r.width,
                c = t.left + r.width - (o.left + n.width);
            return a > 0 && (i += a, l -= a), c > 0 && (l -= c), "center" === e ? (l -= s, i += l / 2) : "right" === e && (l -= s, i += l), i
        },
        _calcOffsetByTail: function(e) {
            var t = this.params.tail,
                i = t.height,
                n = {};
            switch (e.to) {
                case "top":
                    n = {
                        top: -i
                    };
                    break;
                case "bottom":
                    n = {
                        top: i
                    };
                    break;
                case "right":
                    n = {
                        left: i
                    };
                    break;
                case "left":
                    n = {
                        left: -i
                    }
            }
            return n
        },
        _calcTailOffset: function(e) {
            var t = {},
                i = e.to,
                n = e.tail,
                o = n.offset,
                s = n.axis;
            return o ? ("top" === i || "bottom" === i ? (t.left = 0, "left" === s ? t.left += o.left : "center" === s ? (o.left && (t.left += o.left), o.right && (t.left -= o.right)) : "right" === s && (t.left -= o.right)) : ("left" === i || "right" === i) && (t.top = 0, "top" === s ? t.top += o.top : "middle" === s ? (o.top && (t.top += o.top), o.bottom && (t.top -= o.bottom)) : "bottom" === s && (t.top -= o.bottom)), t) : !1
        },
        _resetTailPos: function(e) {
            return e ? this._tailPos[e] = null : this._tailPos = {}, this
        },
        _pushTailPos: function(e, t) {
            return this._pushPosTo(this._tailPos, e, t), this
        }
    }),
    function() {
        function e() {}
        var t = BEM.DOM,
            i = 28;
        t.decl("auth", {
            onSetMod: {
                js: {
                    inited: function() {
                        this.__base.apply(this, arguments), this._socialDropdown = null, this._initSocialProviders()
                    }
                }
            },
            destruct: function() {
                var e = this._socialDropdown;
                e && e.domElem && e.desruct(), this.__base.apply(this, arguments)
            },
            _initSocialProviders: function() {
                var e = BEM.blocks["i-global"],
                    t = e.param("social-providers"),
                    i = this;
                if (t) i._createSocial(t);
                else {
                    var n = e.param("social-host");
                    if (!n) return;
                    i._getSocialProviders(n, function(e) {
                        i._createSocial(e)
                    })
                }
            },
            _getSocialProviders: function(e, t) {
                var n = this.elem("social");
                n.css("height", i), $.getJSON(this.__self._getProvidersURL(e), function(e) {
                    n.css("height", ""), t(e.providers)
                })
            },
            _createSocial: function(e) {
                return e.length ? (t.update(this.elem("social"), BEMHTML.apply(this.__self._buildSocial(e, this._uniqId))), void(this._socialDropdown = this.findBlockInside("social", "dropdown"))) : (this.elem("social").remove(), void this.dropElemCache("social"))
            },
            _onSocialClick: function(t) {
                t.preventDefault();
                var i = BEM.blocks["i-global"];
                this._socialDropdown && this._socialDropdown.hide(), BEM.blocks["social-broker"].start(function() {
                    i.param("retpath") && top.location.href !== i.param("retpath") ? top.location.href = i.param("retpath") : top.location.reload()
                }, e, {
                    provider: this.elemParams(t.data.domElem).provider
                })
            }
        }, {
            live: function() {
                return this.__base.apply(this, arguments), this.liveBindTo("social-link", "leftclick tap", function(e) {
                    this._onSocialClick(e)
                }).liveBindTo("social-link", "keyup", function(e) {
                    e.shiftKey || e.ctrlKey || e.altKey || e.metaKey || 32 === e.keyCode && this._onSocialClick(e)
                }), !1
            },
            _getProvidersURL: function(e) {
                return e + "/providers2.jsonp?callback=?"
            },
            _buildSocial: function(e, t) {
                var i, n, o = [];
                if (e = e.filter(function(e) {
                        return e.enabled
                    }), i = e.filter(function(e) {
                        return e.primary
                    }).map(function(e) {
                        return {
                            block: "auth",
                            elem: "social-link",
                            js: {
                                provider: e.code
                            },
                            mix: [{
                                elem: "social-icon",
                                elemMods: {
                                    code: e.code
                                }
                            }],
                            title: e.display_name
                        }
                    }), o = o.concat(i), n = e.map(function(e) {
                        return {
                            block: "auth",
                            elem: "social-link",
                            js: {
                                provider: e.code
                            },
                            title: e.display_name,
                            content: [{
                                elem: "social-icon",
                                elemMods: {
                                    code: e.code
                                }
                            }, e.display_name]
                        }
                    }), i.length < e.length) {
                    var s = BEM.I18N("auth", "more");
                    o.push({
                        block: "dropdown",
                        js: !0,
                        content: [{
                            block: "button",
                            mods: {
                                pseudo: "yes",
                                theme: "pseudo",
                                size: "s"
                            },
                            mix: [{
                                block: "dropdown",
                                elem: "switcher"
                            }],
                            attrs: {
                                title: s,
                                "aria-label": s
                            },
                            content: "· · ·"
                        }, {
                            elem: "popup",
                            content: {
                                block: "auth",
                                elem: "social-popup",
                                mix: [{
                                    block: "auth",
                                    js: {
                                        uniqId: t
                                    }
                                }],
                                content: n
                            }
                        }]
                    })
                }
                return o
            }
        })
    }(), BEM.decl("social-broker", {
        _windowWidth: 500,
        _windowHeight: 280,
        onSetMod: {
            js: {
                inited: function() {
                    this._window = null, this._timer = 0
                }
            }
        },
        start: function(e, t, i) {
            var n, o, s, r, a = this;
            if (this._cleanup(), this._onSuccess = e, this._onFailure = t, i = $.extend({}, a._getDefaultParams(), i), n = i.startUrl + "?", r = i.popupName, delete i.startUrl, delete i.popupName, o = i.display, s = i.retpath, o && "popup" !== o) i.retpath = i.retnopopup || i.retpath || window.location.href, delete i.retnopopup;
            else {
                var l = "ddom=" + (i.ddom || (location.hostname === document.domain ? "" : document.domain));
                i.retpath += (s.match("#") ? "&" : "#") + l
            }
            return n += Object.keys(i).reduce(function(e, t) {
                return e.push(encodeURIComponent(t) + "=" + encodeURIComponent(i[t])), e
            }, []).join("&"), o && "popup" !== o ? void this._navigate(n) : (this._window = window.open(n, r, a._getPopupParams()), void(this._window && (this._window.focus(), clearInterval(this._timer), this._timer = setInterval(function() {
                a.isClosed() && (clearInterval(a._timer), a.onFailure({
                    status: "error"
                }))
            }, 500))))
        },
        isClosed: function() {
            if (!this._window) return !0;
            try {
                return this._window.closed
            } catch (e) {
                return !0
            }
        },
        _navigate: function(e) {
            window.location.href = e
        },
        _getDefaultParams: function() {
            var e = BEM.blocks["i-global"],
                t = e.param("id");
            return {
                startUrl: e.param("social-startUrl") || e.param("social-host") + "/broker/start",
                retpath: e.param("social-retpath") || [location.protocol, "//", location.host, e.param("lego-path"), "/blocks-common/i-social/closer/i-social__closer.html"].join(""),
                retnopopup: e.param("social-retnopopup") || !1,
                consumer: t || "morda",
                popupName: "social_" + (t || "morda"),
                action_if_anonymous: "authorize",
                result_location: "fragment"
            }
        },
        _getPositionedParams: function(e, t, i, n) {
            return ["scrollbars=yes, resizable=1, menubar=0, toolbar=0, status=0, location=0, directories=0", ", left=", t, ", top=", e, ", width=", i, ", height=", n].join("")
        },
        _getPopupParams: function() {
            var e, t, i = this._windowWidth,
                n = this._windowHeight;
            return window.opera ? (e = (screen.availWidth - i) / 2, t = (screen.availHeight - n) / 2) : (e = (window.innerWidth - i) / 2, t = (window.innerHeight - n) / 2), e = Math.round(e), t = Math.round(t), this._getPositionedParams(t, e, i, n)
        },
        _cleanup: function() {
            clearInterval(this._timer), this.isClosed() || this._window.close(), this._window = null
        },
        onSuccess: function(e) {
            this._cleanup(), this._onSuccess && this._onSuccess(e)
        },
        onFailure: function(e) {
            this._cleanup(), this._onFailure && this._onFailure(e)
        }
    }, {
        start: function() {
            this._current && this._current.destruct(), this._current = BEM.create("social-broker"), Lego.block["i-social"] = {
                broker: this._current
            }, this._current.start.apply(this._current, arguments)
        },
        onSuccess: function() {
            this._current.onSuccess.apply(this._current, arguments)
        },
        onFailure: function() {
            this._current.onFailure.apply(this._current, arguments)
        }
    }), BEM.DOM.decl("dropdown", {
        onSetMod: {
            js: function() {
                var e = this,
                    t = e.params,
                    i = e._popup = e.findBlockOn(e.elem(t.popupElem), "popup").on("show", function() {
                        e.setMod("action", "open").trigger("show")
                    }).on("hide", function() {
                        e.setMod("action", "closed").trigger("hide")
                    });
                t.popupMethods.map(function(t) {
                    e[t] = i[t].bind(i)
                });
                var n = e.params.switcherBlock,
                    o = e.elem("switcher");
                n && (e._switcher = e.findBlockOn(o, n).domElem), o.attr({
                    "aria-haspopup": !0,
                    "aria-expanded": !1
                })
            },
            action: function(e, t) {
                this.elem("switcher").attr("aria-expanded", "open" === t)
            }
        },
        getPopup: function() {
            return this._popup
        },
        getDefaultParams: function() {
            return {
                popupElem: "popup",
                popupMethods: ["toggle", "show", "hide", "setContent"]
            }
        },
        destruct: function() {
            this._popup && this._popup.domElem && this._popup.destruct(), this.__base.apply(this, arguments)
        },
        _toggle: function() {
            this._popup.toggle(this._switcher)
        },
        _onSwitcherClick: function() {
            this._switcher || (this._switcher = this.elem("switcher")), this._toggle()
        },
        _onSwitcherKeyUp: function(e) {
            if (!(e.shiftKey || e.ctrlKey || e.altKey || e.metaKey)) {
                var t = this.elem("switcher")[0].tagName.toLowerCase();
                "button" !== t && ("a" !== t && 13 === e.which || 32 === e.which) && (e.preventDefault(), this.params.switcherBlock || this._toggle())
            }
        }
    }, {
        live: function() {
            this.liveBindTo("switcher", "leftclick tap", function(e) {
                this._onSwitcherClick(e)
            }).liveBindTo("switcher", "keyup", function(e) {
                this._onSwitcherKeyUp(e)
            })
        }
    }), BEM.DOM.decl("dropdown", {
        _onSwitcherClick: function() {
            var e, t = this.elem("switcher");
            if (!(t && t.length && (e = this.findBlockOn(t, this.params.switcherBlock), e && e.hasMod("disabled", "yes")))) return this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl("input", {
        onElem: {
            control: function(e) {
                var t = e.params(),
                    i = t.attrs || {};
                i.autocomplete || (i.autocomplete = "off", t.attrs = i)
            }
        }
    }), BEM.DOM.decl("input", {
        onSetMod: {
            js: function() {
                this._val = this.elem("control").val()
            },
            disabled: function(e, t) {
                this.elem("control").attr("disabled", "yes" === t)
            },
            focused: function(e, t) {
                if (this.hasMod("disabled", "yes")) return !1;
                var i = "yes" === t;
                i ? this._focused || this._focus() : this._focused && this._blur(), this.afterCurrentEvent(function() {
                    this.trigger(i ? "focus" : "blur")
                })
            }
        },
        isDisabled: function() {
            return this.hasMod("disabled", "yes")
        },
        val: function(e, t) {
            if ("undefined" == typeof e) return this._val;
            e = null === e ? "" : e.toString();
            var i = this.elem("control");
            return i.val() !== e && i.val(e), this._val = e, this.trigger("change", t), this
        },
        name: function(e) {
            var t = this.elem("control");
            return arguments.length ? (t.attr("name", e), this) : t.attr("name")
        },
        getSelectionEnd: function() {
            var e = this.elem("control")[0],
                t = 0;
            if ("number" == typeof e.selectionEnd) t = e.selectionEnd;
            else {
                var i = document.selection.createRange();
                if (i && i.parentElement() === e) {
                    var n = e.value.length,
                        o = e.createTextRange();
                    o.moveToBookmark(i.getBookmark());
                    var s = e.createTextRange();
                    s.collapse(!1), t = o.compareEndPoints("EndToEnd", s) > -1 ? n : -o.moveEnd("character", -n)
                }
            }
            return t
        },
        _onFocus: function() {
            return this._focused = !0, this.setMod("focused", "yes")
        },
        _onBlur: function() {
            return this._returnFocus ? (this.afterCurrentEvent(function() {
                this._focus()
            }), this) : this.hasMod(this.elem("clear"), "pressed") ? this : (this._focused = !1, this.delMod("focused"))
        },
        _focus: function() {
            return this.hasMod("disabled", "yes") ? !1 : void this.elem("control").focus()
        },
        _blur: function() {
            this._returnFocus = !1, this.elem("control").blur()
        },
        destruct: function() {
            this._blur(), this.__base.apply(this, arguments)
        }
    }, {
        live: function() {
            this.liveBindTo("control", "focusin focusout", function(e) {
                this["focusin" === e.type ? "_onFocus" : "_onBlur"](e)
            })
        }
    }),
    function() {
        var e, t = [],
            i = function() {
                t.forEach(function(e) {
                    e.val(e.elem("control").val())
                })
            },
            n = function(e) {
                try {
                    return e.activeElement
                } catch (t) {}
            };
        BEM.DOM.decl("input", {
            onSetMod: {
                js: {
                    inited: function() {
                        this.__base.apply(this, arguments), this._instanceIndex = t.push(this) - 1;
                        var o = this.elem("control"),
                            s = n(this.__self.doc[0]),
                            r = this.params.autoFocus && (!s || !$(s).is("input, textarea"));
                        (s === o[0] || r) && (this.setMod("focused", "yes")._focused = !0), e || (e = this.channel("sys").on({
                            tick: i,
                            idle: function() {
                                e.un("tick", i)
                            },
                            wakeup: function() {
                                e.on("tick", i)
                            }
                        })), this.params.shortcut && this.bindToDoc("keydown", function(e) {
                            e.ctrlKey && 38 === e.which && !$(e.target).is("input, textarea") && this.setMod("focused", "yes")
                        })
                    }
                }
            },
            val: function(e, t) {
                var i = "undefined" != typeof e,
                    n = this.elem("control");
                return e = i ? null === e ? "" : e.toString() : n.val(), this._val !== e && (this._val = e, n.val() !== e && n.val(e), this.trigger("change", t)), i ? this : e
            },
            _focus: function() {
                var e = this.elem("control")[0];
                if (e.createTextRange && !e.selectionStart) {
                    var t = e.createTextRange();
                    t.move("character", e.value.length), t.select()
                } else e.focus()
            },
            destruct: function() {
                this.__base.apply(this, arguments), this.params.shortcut && this.unbindFromDoc("keydown"), t.splice(this._instanceIndex, 1), t.slice(this._instanceIndex).forEach(function(e) {
                    e._instanceIndex--
                })
            }
        }, {})
    }(), BEM.DOM.decl("input", {
        focus: function() {
            this.elem("control").focus()
        }
    }),
    function() {
        var e, t = 0,
            i = !1,
            n = 0,
            o = BEM.channel("sys"),
            s = 50;
        BEM.decl("i-system", {}, {
            start: function() {
                $(document).bind("mousemove keydown", function() {
                    n = 0, i && (i = !1, o.trigger("wakeup"))
                }), this._tick()
            },
            _tick: function() {
                var r = this;
                o.trigger("tick", {
                    counter: t++
                }), !i && (n += s) > 3e3 && (i = !0, o.trigger("idle")), e = setTimeout(function() {
                    r._tick()
                }, s)
            }
        }).start()
    }(), BEM.DOM.decl("input", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this.on("change", this._updateClear)._updateClear()
            }
        },
        _onBoxClear: function() {
            this.hasMod("clear", "visibility", "visible") || this.hasMod("disabled", "yes") || this.setMod("focused", "yes")
        },
        _onClearClick: function() {
            return this.trigger("clear"), this.removeInsets && this.removeInsets(), this.clearInput({
                source: "clear"
            })._focus()
        },
        clearInput: function(e) {
            return this.val("", e), this
        },
        _updateClear: function() {
            return this.toggleMod(this.elem("clear"), "visibility", "visible", "", !!this._val)
        }
    }, {
        live: function() {
            this.__base.apply(this, arguments), this.liveBindTo("clear", "mousedown", function(e) {
                1 === e.which && this.setMod(this.elem("clear"), "pressed", "yes")
            }).liveBindTo("clear", "leftclick tap", function() {
                this.delMod(this.elem("clear"), "pressed"), this._onClearClick()
            }).liveBindTo("box", "leftclick tap", function() {
                this._onBoxClear()
            })
        }
    }), BEM.DOM.decl("input", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), (this._hasHint = Boolean(this.elem("hint")[0])) && this.on("change", this._updateHint)._updateHint()
            },
            focused: function() {
                return this.__base.apply(this, arguments) === !1 ? !1 : void(this._hasHint && this._updateHint())
            }
        },
        _updateHint: function() {
            this.toggleMod(this.elem("hint"), "visibility", "visible", !this.val())
        }
    }), BEM.DOM.decl("input", {
        setHint: function(e) {
            var t = this.elem("hint");
            t.text(e)
        }
    }), BEM.JSON.decl("checkbox", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.checkboxAttrs || {};
            i.autocomplete || (i.autocomplete = "off", t.checkboxAttrs = i)
        }
    }), BEM.DOM.decl("checkbox", {
        onSetMod: {
            js: function() {
                this.setMod("checked", this.elem("control").prop("checked") ? "yes" : ""), this._isControlFocused() && this.setMod("focused", "yes")
            },
            focused: {
                yes: function() {
                    return this.isDisabled() ? !1 : (this._isControlFocused() || this.elem("control").focus(), this.setMod(this.elem("box"), "focused", "yes"), void this.afterCurrentEvent(function() {
                        this.trigger("focus")
                    }))
                },
                "": function() {
                    this._isControlFocused() && this.elem("control").blur(), this.delMod(this.elem("box"), "focused"), this.afterCurrentEvent(function() {
                        this.trigger("blur")
                    })
                }
            },
            checked: function(e, t) {
                return this.isDisabled() ? !1 : (this.elem("control").prop("checked", "yes" === t), this.afterCurrentEvent(function() {
                    this.trigger("change", {
                        checked: "yes" === t
                    })
                }), void this.setMod(this.elem("box"), "checked", t))
            },
            disabled: function(e, t) {
                this.elem("control").prop("disabled", "yes" === t)
            }
        },
        isDisabled: function() {
            return this.hasMod("disabled", "yes")
        },
        isChecked: function() {
            return this.hasMod("checked", "yes")
        },
        toggle: function() {
            this.toggleMod("checked", "yes", "")
        },
        val: function(e) {
            var t = this.elem("control");
            return "undefined" == typeof e ? t.val() : (t.val(e), this)
        },
        name: function(e) {
            var t = this.elem("control");
            return arguments.length ? (t.attr("name", e), this) : t.attr("name")
        },
        _onClick: function(e) {
            this.isDisabled() || this.setMod("focused", "yes")
        },
        _onChange: function(e) {
            e.target.checked ? this.setMod("checked", "yes") : this.delMod("checked")
        },
        _onFocusInFocusOut: function(e) {
            this.setMod("focused", "focusin" === e.type ? "yes" : "")
        },
        _onMouseOverMouseOut: function(e) {
            this.isDisabled() || this.setMod("hovered", "mouseover" === e.type ? "yes" : "")
        },
        _isControlFocused: function() {
            try {
                return this.containsDomElem($(this.__self.doc[0].activeElement))
            } catch (e) {
                return !1
            }
        }
    }, {
        live: function() {
            this.liveBindTo("leftclick tap", function(e) {
                this._onClick(e)
            }).liveBindTo("control", "change", function(e) {
                this._onChange(e)
            }).liveBindTo("control", "focusin focusout", function(e) {
                this._onFocusInFocusOut(e)
            }).liveBindTo("mouseover mouseout", function(e) {
                this._onMouseOverMouseOut(e)
            })
        }
    }), BEM.DOM.decl("user", {
        redraw: function() {
            return this
        }
    }, {
        getLogoutUrl: function() {
            var e = BEM.blocks["i-global"],
                t = e.param("retpath"),
                i = e.param("yandexuid");
            return [e.param("passport-host"), "/passport?mode=logout", i ? "&yu=" + i : "", t ? "&retpath=" + encodeURIComponent(t) : ""].join("")
        }
    }), BEM.decl("i-common__string", {}, {
        cleverSubstring: function() {
            var e = "…";
            return function(t, i, n) {
                return t.length > i + n ? t.substring(0, i - 1) + e : t
            }
        }(),
        escapeHTML: function() {
            var e = {
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;"
            };
            return function(t) {
                return String(t).replace(/&(?!\w+;)|[<>"']/g, function(t) {
                    return e[t] || t
                })
            }
        }(),
        escapeRegExp: function(e) {
            return e.replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1")
        },
        highlight: function(e, t) {
            if (!$.isArray(t)) return e;
            var i, n = [],
                o = 0,
                s = t.sort(function(e, t) {
                    return e[0] - t[0]
                }),
                r = [],
                a = "?",
                l = ~e.indexOf(a),
                c = function() {
                    for (var t, i = /\&#\d+;/gi; t = i.exec(e);) r.push(t[0]), e = e.replace(t[0], a)
                },
                d = function(e) {
                    if (l) return e;
                    for (; ~e.indexOf(a) && r.length;) e = e.replace(a, r[0]), r.shift();
                    return e
                };
            return !l && c(), s.forEach(function(t) {
                i = o > t[0] ? o : t[0], n.push({
                    tag: "span",
                    elem: "span",
                    content: d(e.slice(o, i))
                }), n.push({
                    tag: "em",
                    elem: "em",
                    content: d(e.slice(i, o = t[1]))
                })
            }, this), n.push({
                tag: "span",
                elem: "span",
                content: d(e.slice(o))
            }), n
        }
    }), BEM.DOM.decl("user", {
        onSetMod: {
            js: {
                inited: function() {
                    if (this.__base.apply(this, arguments), this.elem("name").length) {
                        var e = this,
                            t = e.elemParams("name");
                        t.isUglyUserName && BEM.blocks["i-user-services"].get(function(i) {
                            var n = BEM.blocks["i-common__string"].cleverSubstring,
                                o = i.displayName ? i.displayName.name : i.login,
                                s = n(o, t.maxLength, t.maxLengthRelative);
                            e.elem("name").text(s), e.trigger("update-name")
                        })
                    }
                }
            }
        },
        toggleCollapsed: function(e) {
            return this.toggleMod("hide-name", "yes", "", e)
        }
    }), BEM.decl("i-user-services", {}, {
        get: function(e) {
            this._data ? e(this._data) : this._get(e)
        },
        getApiUrl: function() {
            return BEM.blocks["i-global"].param("pass-host") + "/services?callback=?"
        },
        _callbacks: [],
        _get: function(e) {
            var t = this;
            t._callbacks.push(e), 1 == t._callbacks.length && $.getJSON(t.getApiUrl(), {
                locale: BEM.blocks["i-global"].param("lang"),
                login: "yes",
                "current-login": BEM.blocks["i-global"].param("login"),
                yu: $.cookie("yandexuid")
            }, function(e) {
                t._data = e, $.each(t._callbacks, function() {
                    this(e)
                }), t._callbacks.length = 0
            })
        }
    }), BEM.DOM.decl("user", {
        onSetMod: {
            js: {
                inited: function() {
                    this.__base.apply(this, arguments), this._isRetina = BEM.blocks["i-ua"].hiDpi, this._isRetina && this.updateIcon()
                }
            }
        },
        _getIconPath: function() {
            var e = this.params.avatarHost,
                t = this.params.uid || BEM.blocks["i-global"].param("uid"),
                i = this._getIconSize(),
                n = (this._isRetina ? "/islands-retina-" : "/islands-") + i;
            return [e, "/get-yapic/", t, n, "?rnd=", +new Date].join("")
        },
        _setIconBackground: function(e) {
            var t = this.elem("icon");
            t && t.css("background-image", "url(" + e + ")")
        },
        updateIcon: function() {
            this._setIconBackground(this._getIconPath())
        },
        getDefaultParams: function() {
            return {
                avatarHost: "//avatars.yandex.net"
            }
        }
    }), BEM.DOM.decl("user", {
        _getIconSize: function() {
            return "middle"
        }
    }), BEM.DOM.decl("notice", {
        onSetMod: {
            js: {
                inited: function() {
                    this._count = this.params.count
                }
            }
        },
        setCount: function(e) {
            e >= 0 || (e = 0);
            var t = $(BEMHTML.apply({
                block: "notice",
                elem: "value",
                count: e,
                maxCount: this.params.maxCount
            })).text();
            return this._count = e, this.elem("value").text(t), this
        },
        getCount: function() {
            return this._count
        }
    }), BEM.DOM.decl({
        block: "user",
        modName: "menu",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments);
                var e = 60;
                this._dropdown = this.findBlockOutside("dropdown-menu") || 0, this._dropdown && this._dropdown.on("show", function() {
                    this.bindToWin("scroll", $.throttle(this._hide, e, this)).redraw().domElem.attr("aria-expanded", !0)
                }.bind(this)).on("hide", function() {
                    this.unbindFromWin("scroll").domElem.attr("aria-expanded", !1)
                }.bind(this))
            }
        },
        _hide: function() {
            this._dropdown && this._dropdown.hide()
        },
        _onClick: function(e) {
            e.preventDefault(), this.__base.apply(this, arguments), this._dropdown && this._dropdown.toggle(this.elem("icon").length ? this.elem("icon") : this.elem("name"))
        },
        redraw: function() {
            if (this.__base.apply(this, arguments), !this._dropdown) return this;
            var e = this.__self.getLogoutUrl();
            return this._dropdown._popup.findBlockInside("user").elem("logout").attr("href", e), this
        },
        destruct: function() {
            this._dropdown && this._dropdown.domElem && this._dropdown.destruct(), this.__base.apply(this, arguments)
        }
    }, {
        live: function() {
            return this.__base.apply(this, arguments), this.liveBindTo("leftclick tap", function(e) {
                this._onClick(e)
            }).liveBindTo("keyup", function(e) {
                e.shiftKey || e.ctrlKey || e.altKey || e.metaKey || 32 === e.which && this.domElem.click()
            }), !1
        }
    }), BEM.DOM.decl({
        name: "user",
        modName: "menu",
        modVal: "yes"
    }, {
        _hide: function() {}
    }), BEM.DOM.decl({
        block: "dropdown-menu",
        baseBlock: "dropdown"
    }),
    function() {
        BEM.DOM.decl("i-menu", {
            onElemSetMod: {
                item: {
                    state: {
                        current: function(e, t, i, n) {
                            if ("disabled" == n) return !1;
                            var o = this.elem("item", "state", "current");
                            this.delMod(o, "state").trigger("current", {
                                prev: o,
                                current: e
                            })
                        }
                    }
                }
            },
            onItemSelectorClick: function(e) {
                var t = this._getItemByEvent(e);
                this.setMod(t, "state", "current")
            },
            _getItemByEvent: function(e) {
                return e.data.domElem.closest(this.buildSelector("item"))
            }
        }, {
            live: function() {
                this.liveBindTo("item-selector", "leftclick", function(e) {
                    this.onItemSelectorClick(e)
                })
            }
        })
    }(), BEM.DOM.decl({
        block: "b-menu-vert",
        baseBlock: "i-menu"
    }),
    function() {
        BEM.DOM.decl({
            name: "b-menu-horiz",
            baseBlock: "i-menu"
        })
    }(), BEM.DOM.decl("user-menu-update", {
        onSetMod: {
            js: {
                inited: function() {
                    var e = this;
                    e.updateInformer(e.onUpdateSuccess, e.onUpdateError)
                }
            }
        },
        updateInformer: function(e, t) {
            var i = this;
            i._getExporter().get({
                key: $.cookie("yandexuid")
            }, function(i) {
                i.unread ? e.apply(this, arguments) : t && t.call(this)
            }, t)
        },
        onUpdateSuccess: function(e) {
            var t = parseInt(e.unread, 10) || 0,
                i = this.params.unreadMax;
            t && i && t > i && (t = i + "+");
            var n = t ? t + " " : "";
            BEM.DOM.update(this.domElem, n + BEM.I18N("user", "letter", {
                count: t
            }))
        },
        onUpdateError: function() {},
        _getExporter: function() {
            return this._exporter || (this._exporter = BEM.create("i-request_type_ajax", {
                url: this.__self.getExportApiUrl(),
                cache: !1,
                callbackCtx: this
            }))
        },
        getDefaultParams: function() {
            return {
                unreadMax: 99
            }
        }
    }, {
        getExportApiUrl: function() {
            return BEM.blocks["i-global"].param("export-host") + "/for/unread.xml?callback=?"
        }
    }),
    function() {
        var e = {};
        BEM.decl("i-request", {
            onSetMod: {
                js: function() {
                    this._preventCache = !1
                }
            },
            get: function(e, t, i, n) {
                $.isFunction(i) || (n = i, i = this.params.onError), this._get(e, t, i, $.extend({}, this.params, n))
            },
            _get: function(t, i, n, o) {
                var s = this._buildCacheKey(t, o),
                    r = e[o.cacheGroup];
                o.cache && r && s in r.data ? this.afterCurrentEvent(function() {
                    i.call(this.params.callbackCtx, r.data[s])
                }, this) : this._do(t, i, n, o)
            },
            _do: function(e, t, i, n) {},
            _onSuccess: function(e, t, i, n) {
                n.cache && !this._preventCache && this.putToCache(n, e, i), this._preventCache = !1
            },
            _buildCacheKey: function(e, t) {
                return "string" == typeof e ? e : $.param(e)
            },
            putToCache: function(t, i, n) {
                var o = e[t.cacheGroup] || (e[t.cacheGroup] = {
                    keys: [],
                    data: {}
                });
                o.keys.length >= t.cacheSize && delete o.data[o.keys.shift()];
                var s = this._buildCacheKey(i, t);
                o.data[s] = n, o.keys.push(s)
            },
            dropCache: function() {
                delete e[this.params.cacheGroup]
            },
            getDefaultParams: function() {
                return {
                    cache: !1,
                    cacheGroup: "default",
                    cacheSize: 100,
                    callbackCtx: this
                }
            }
        }, {
            _cache: e
        })
    }(),
    function(e) {
        e.decl({
            block: "i-request_type_ajax",
            baseBlock: "i-request"
        }, {
            onSetMod: {
                js: function() {
                    this.__base(), this._requestNumber = this._number = this._preventNumber = this._retryCount = 0
                }
            },
            _get: function(e, t, i, n) {
                this._number++, this._requestNumber++, this._retryCount = n.retryCount, this.__base.apply(this, arguments)
            },
            _do: function(e, t, i, n) {
                var o = this;
                if (o._number > o._preventNumber) {
                    var s = arguments,
                        r = {
                            data: n.data ? $.extend({}, n.data, e) : e
                        },
                        a = o._wrapCallback(function(i, s, r) {
                            o._onSuccess(o._buildCacheKey(e, n), e, i[0], n), o._allowCallback(s, r) && t.apply(n.callbackCtx, i)
                        }),
                        l = o._wrapCallback(function(e, t, r) {
                            o._allowCallback(t, r) && (o._retryCount-- > 0 ? setTimeout(function() {
                                o._do.apply(o, s)
                            }, n.retryInterval) : i && i.apply(n.callbackCtx, e))
                        });
                    $.each(["url", "dataType", "timeout", "type", "jsonp", "jsonpCallback"].concat(n.paramsToSettings || []), function(e, t) {
                        r[t] = n[t]
                    }), $.ajax(r).done(a).fail(l)
                }
            },
            _wrapCallback: function(e) {
                var t = this._requestNumber,
                    i = this._number;
                return function(n) {
                    null !== n && e(arguments, t, i)
                }
            },
            _allowCallback: function(e, t) {
                return t > this._preventNumber && this._requestNumber == e
            },
            _buildCacheKey: function(e, t) {
                return "string" == typeof e ? e : this.__base(e) + t.url
            },
            abort: function() {
                this._preventNumber = ++this._number
            },
            preventCallbacks: function() {
                this.abort()
            },
            getDefaultParams: function() {
                return $.extend(this.__base(), {
                    cache: !0,
                    type: "GET",
                    dataType: "jsonp",
                    timeout: 2e4,
                    retryCount: 0,
                    retryInterval: 2e3
                })
            }
        })
    }(BEM), BEM.DOM.decl({
        name: "user",
        modName: "account",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {}
        },
        update: function(e, t, i, n, o) {
            this.params = {
                uid: t,
                pos: o,
                avatarHost: "//avatars.yandex.net"
            }, this._isRetina = BEM.blocks["i-ua"].hiDpi, this.updateIcon(), this.elem("name").text(n), this.delMod("blank")
        },
        getUid: function() {
            return this.params.uid
        },
        getPos: function() {
            return this.params.pos
        }
    }), BEM.DOM.decl("multi-auth", {
        onSetMod: {
            js: function() {
                this.findBlockOn("popup").on("show", this._onShow, this)
            }
        },
        getDefaultParams: function() {
            return {
                maxAccounts: 5
            }
        },
        changeRetPath: function(e, t) {
            t = t || BEM.blocks["i-global"].param("retpath"), e.attr("href", this._replaceParamInUri(e.attr("href"), "retpath", t));
        },
        getAccounts: function() {
            this._accountsInited || (this._accountsInited = !0, this.__self.getAccounts(this.addAccounts.bind(this)))
        },
        addAccounts: function(e) {
            var t = !1;
            if ((e && e.accounts || []).length > 1) {
                var i = this.findBlockInside({
                        blockName: "user",
                        modName: "blank",
                        modVal: "yes"
                    }),
                    n = i.domElem.closest(this.buildSelector("account")).last(),
                    o = 0,
                    s = n;
                t = !0, e.accounts.forEach(function(t) {
                    if (t.uid !== e.default_uid && t && t.displayName) {
                        var i = t.displayName,
                            r = n.clone();
                        s.after(r), s = r, this.findBlockInside(r, "user").update(r, t.uid, i.default_avatar, i.name, o++)
                    }
                }, this), this.setMod(this.elem("edit"), "visible", "yes"), (!e["can-add-more"] || e.accounts.length >= this.params.maxAccounts) && this.setMod(this.findElem("add"), "hidden", "yes")
            }
            this.setMod(this.findElem("accounts"), "multiple", t ? "yes" : "")
        },
        onAccountClick: function(e) {
            var t = this.findBlockOutside(e, "user");
            this.setMainAccount(t.getUid())
        },
        setMainAccount: function(e, t) {
            var i = this.elem("form"),
                n = BEM.blocks["i-global"];
            t = t || n.param("retpath"), jQuery("[name=uid]", i).val(e), jQuery("[name=retpath]", i).val(t), jQuery("[name=yu]", i).val(n.param("yandexuid")), i.submit()
        },
        _replaceParamInUri: function(e, t, i) {
            var n = new RegExp("(" + t + "=).*?(&|$)");
            return void 0 !== i && (i = encodeURIComponent(i)), e.search(n) >= 0 ? e = e.replace(n, void 0 === i ? "$2" : "$1" + i + "$2") : void 0 !== i && (e += (e.indexOf("?") > 0 ? "&" : "?") + t + "=" + i), e
        },
        _onShow: function() {
            this.getAccounts(), ["add", "edit", "logout"].forEach(function(e) {
                this.changeRetPath(this.findElem(e))
            }, this)
        }
    }, {
        getAccounts: function(e, t) {
            var i = BEM.blocks["i-global"],
                n = i.param("tld");
            n = -1 !== ["ua", "by", "kz"].indexOf(n) ? "ru" : n, jQuery.ajax({
                url: "//pass.yandex." + n + "/accounts?yu=" + i.param("yandexuid"),
                jsonp: "callback",
                dataType: "jsonp",
                timeout: 5e3,
                success: e,
                error: t || function(e, t, i) {
                    console.error(t, i)
                }
            })
        },
        live: function() {
            return this.liveBindTo("account-link", "leftclick tap", function(e) {
                this.onAccountClick(jQuery(e.target))
            }), !1
        }
    }), BEM.DOM.decl("multi-auth", {
        changeRetPath: function(e, t) {
            var i = BEM.blocks["i-router"];
            e.hasClass(this.buildSelector("logout").substring(1)) && (t = i.getProtocol() + "//" + i.getHost()), this.__base(e, t)
        }
    }), BN.addDecl("head-menu").instanceProp({
        _itemIdsToLinksMap: {
            counters: "/list",
            calls: "/calls",
            delegates: "/delegates"
        },
        onSetMod: {
            js: function() {
                this._setActiveLink()
            }
        },
        _getItemId: function(e) {
            var t, i;
            return Object.keys(this._itemIdsToLinksMap).some(function(n) {
                return i = this._itemIdsToLinksMap[n], i === e || i.indexOf(e) > -1 ? (t = n, !0) : void 0
            }.bind(this)), t
        },
        _setActiveLink: function() {
            var e = this.findElem("item"),
                t = String(BN("i-router").getMatchers()[0]).replace(/\/+$/, ""),
                i = this._getItemId(t);
            e.map(function(t) {
                t = this.elemify(e[t], "item"), this.setMod(t, "selected", this.elemParams(t).itemId === i ? "yes" : "no")
            }.bind(this))
        }
    }), BEM.JSON.decl("smart-link", {
        onBlock: function(e) {
            e.tag("a").mix({
                block: "link"
            }).attrs(jQuery.extend({
                href: "/"
            }, e.param("linkAttrs") || {}))
        }
    }), BEM.DOM.decl("smart-link", {
        onSetMod: {
            js: function() {
                this.bindTo("focus click contextmenu", this._onFocus)
            }
        },
        formatHref: function() {
            var e = this._getNewParams(),
                t = this._getHost() + this._getPath(),
                i = -1 !== t.indexOf("?"),
                n = jQuery.param(e);
            return t + (n ? (i ? "&" : "?") + jQuery.param(e) : "")
        },
        _getNewParams: function() {
            var e = jQuery.extend({}, BN("i-router").getParams()),
                t = this.params.params || {},
                i = this.params.keepParams || [],
                n = Boolean(this.params.keepAllParams),
                o = this.__self.paramsSet;
            return i = n ? Object.keys(e) : i.reduce(function(e, t) {
                return o[t] && (e = e.concat(o[t])), e
            }, []), BN("i-util").arrayUnique(Object.keys(e).concat(Object.keys(t))).reduce(function(n, o) {
                var s;
                return -1 !== i.indexOf(o) && void 0 !== e[o] && (s = e[o]), void 0 !== t[o] && (s = t[o]), null !== s && void 0 !== s && (n[o] = s), n
            }.bind(this), {})
        },
        _getHost: function() {
            return this.params.host || location.protocol + "//" + location.host
        },
        _getPath: function() {
            return this.params.path || location.pathname
        },
        _onFocus: function(e) {
            return this.hasMod("disabled", "yes") ? (e.preventDefault(), void e.stopPropagation()) : void this.domElem.attr("href", this.formatHref())
        }
    }, {
        paramsSet: {
            "data-table-report-specific": ["selected_rows", "metrics", "dimensions", "attribution"],
            "data-table": ["goal", "metric", "percentage", "sort", "rows_limit", "metric_filters", "accuracy"],
            "data-table-compare-segments": ["goal", "metric", "percentage", "sort", "rows_limit"],
            "data-table-dimension-filter": ["dimension_filter"],
            dimension_mode: ["dimension_mode"],
            comparison: ["secondary_period", "secondary_filter", "secondary_filter_id", "compareWith"],
            chart: ["chart_type", "region"],
            delegation: ["ulogin"],
            quantile: ["quantile"],
            attribution: ["attribution"],
            "monitoring-report": ["mirror"],
            currency: ["currency"],
            inpage: ["dotsize", "opacity", "type", "url", "tld"],
            report: ["id", "gid", "filter", "filter_id", "period", "group", "goal", "metric", "percentage", "sort", "offset"],
            counter: ["id", "gid", "counter_id", "group_id"],
            period: ["period", "secondary_period"],
            group: ["group"],
            filters: ["filter", "filter_id", "secondary_filter", "secondary_filter_id"],
            goal: ["goal"],
            accuracy: ["accuracy"],
            widgetToReportParams: ["title", "table"]
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "type",
        modVal: "global-reports"
    }, {
        _getNewParams: function() {
            var e = this.__base.apply(this, arguments);
            return e.period = BN("i-period").stringifyPeriod(BN("i-period").nameToPeriod("week")), e
        }
    }), BEM.decl("i-storage", {
        get: function() {
            return this.__self.get(this.params.key)
        },
        set: function(e) {
            return this.__self.set(this.params.key, e)
        }
    }, {
        get: function(e) {
            var t;
            try {
                t = JSON.parse(localStorage.getItem(e))
            } catch (i) {
                console.log("Unable to parse value [", e, "] from local storage: ", i), t = null
            }
            return t
        },
        set: function(e, t) {
            var i = !1;
            try {
                localStorage.setItem(e, JSON.stringify(t)), i = !0
            } catch (n) {}
            return i
        }
    }), BN.addDecl("i-period").staticProp({
        DEFAULT_GROUPS: ["day", "week", "month"],
        ADDITIONAL_GROUPS: ["auto", "minutes", "hours"],
        MINUTES_GROUP: "minutes",
        DEFAULT_PERIOD: "month",
        DEFAULT_GROUPING: "day",
        periods: [{
            name: "today"
        }, {
            name: "yesterday",
            to: function(e) {
                e.setDate(e.getDate() - 1)
            }
        }, {
            name: "week",
            from: function(e) {
                e.setDate(e.getDate() - 6)
            }
        }, {
            name: "month",
            from: function(e) {
                e.setMonth(e.getMonth() - 1).setDate(e.getDate() - 1)
            }
        }, {
            name: "quarter",
            from: function(e) {
                e.setMonth(e.getMonth() - 3).setDate(e.getDate() - 1)
            }
        }, {
            name: "year",
            from: function(e) {
                e.setFullYear(e.getFullYear() - 1).setDate(e.getDate() - 1)
            }
        }],
        getDefaultGrouping: function() {
            return this.DEFAULT_GROUPING
        },
        getGroups: function(e) {
            return !e || e.useAdditionalGrouping() ? this.ADDITIONAL_GROUPS.concat(this.DEFAULT_GROUPS) : this.DEFAULT_GROUPS
        },
        getGrouping: function(e) {
            var t = BN("i-router").getParams().group;
            return -1 !== this.getGroups(e).indexOf(t) ? t : void 0
        },
        periodToName: function(e) {
            var t = null;
            return this.periods.some(function(i) {
                return jQuery.equals(this.nameToPeriod(i.name), e) ? (t = i.name, !0) : void 0
            }, this), t
        },
        nameToPeriod: function(e) {
            var t, i, n = this._getPeriod(e),
                o = null;
            return n && (i = BN("i-date").create(), n.to && n.to(i), t = i.clone(), n.from && n.from(t), o = {
                from: t.getISODate(),
                to: i.getISODate()
            }), o
        },
        getPeriodTypes: function() {
            var e = [];
            return this.periods.forEach(function(t) {
                e.push(t.name)
            }), this.getPeriodTypes = function() {
                return e
            }, e
        },
        getPeriod: function() {
            return this.parsePeriod(BN("i-router").getParams().period) || this.getDefault()
        },
        getSecondaryPeriod: function(e) {
            var t = BN("i-router").getParams(),
                i = this.parsePeriod(t.secondary_period);
            return e || (e = "custom" === t.compareWith ? "paralel" : "sequential"), i ? i : "sequential" === e ? this.prevPeriod(this.getPeriod()) : this.getPeriod()
        },
        prevPeriod: function(e) {
            var t = BN("i-date"),
                i = t.create(e.from),
                n = t.create(e.to),
                o = Math.floor((n - i + t.DAY_IN_MILLISECONDS) / 1e3);
            return {
                from: i.setSeconds(i.getSeconds() - o).getISODate(),
                to: n.setSeconds(i.getSeconds() - o).getISODate()
            }
        },
        getPeriodDuration: function(e, t) {
            return e = e || this.getPeriod(), t = t || this.getSecondaryPeriod(), jQuery.equals(this.prevPeriod(e), t) ? {
                periodName: this.periodToName(e),
                mode: "sequential"
            } : jQuery.equals(e, t) ? {
                periodName: this.periodToName(e),
                mode: "concurrent"
            } : null
        },
        stringifyPeriod: function(e) {
            return e && e.from + ":" + e.to
        },
        parsePeriod: function(e) {
            var t = String(e).split(":"),
                i = t && 2 === t.length ? {
                    from: t[0],
                    to: t[1]
                } : null;
            return i && (!BN("i-date").isISODate(i.from) || !BN("i-date").isISODate(i.to) || Date.parse(i.from) > Date.parse(i.to)) && (i = null), i
        },
        compactFormat: function(e) {
            var t, i = BN("i-date"),
                n = i.create(e.from).format("j-f-Y").split("-"),
                o = i.create(e.to).format("j-f-Y").split("-"),
                s = [];
            for (t = n.length - 1; t >= 0 && n[t] === o[t]; t--) s.unshift(n[t]), n.pop(), o.pop();
            return [n.join(" "), n.length ? " &mdash; " : "", o.join(" "), n.length ? " " : "", s.join(" ")]
        },
        getPeriodLength: function(e) {
            var t = BN("i-date"),
                i = Math.abs(t.create(e.to) - t.create(e.from));
            return Math.ceil(i / t.DAY_IN_MILLISECONDS) + 1
        },
        splitPeriodToGroups: function(e, t, i, n) {
            var o, s, r, a, l, c, d = BN("i-date"),
                u = d.create(e.from),
                h = [],
                m = i || t;
            for (r = this._alignPeriodToGroupBegin(u, m), n && (s = this._getAutoGroupingLength(i, n)), o = this._getLastGroupEnd(d.create(e.to), m, s), r.getISODate() !== u.getISODate() && h.push({
                    from: u,
                    to: d.create(r.valueOf() - d.DAY_IN_MILLISECONDS),
                    isHoliday: "day" === m && BN("i-holidays").isHoliday(u)
                }), l = a = r; a.valueOf() <= o.valueOf();) l = a, a = this._nextGroupBegining(a, m, s), c = s ? d.create(l.valueOf()) : d.create(Math.min(a.valueOf() - d.DAY_IN_MILLISECONDS, o.valueOf())), h.push({
                from: l,
                to: c,
                isHoliday: "day" === m && BN("i-holidays").isHoliday(l)
            });
            return h
        },
        combinePeriods: function(e, t) {
            var i = BN("i-date"),
                n = Math.min(i.create(e.from), t ? i.create(t.from) : 1 / 0),
                o = Math.max(i.create(e.to), t ? i.create(t.to) : -(1 / 0));
            return {
                from: i.create(n).getISODate(),
                to: i.create(o).getISODate()
            }
        },
        getDefault: function() {
            throw new Error("Not implemented")
        },
        _getAutoGroupingLength: function(e, t) {
            switch (e) {
                case "minutes":
                    return BN("i-date").MINUTE_IN_MILLISECONDS * t;
                case "week":
                    return 7 * BN("i-date").DAY_IN_MILLISECONDS;
                case "hours":
                    return BN("i-date").HOUR_IN_MILLISECONDS * t;
                case "day":
                    return BN("i-date").DAY_IN_MILLISECONDS;
                case "month":
                    return NaN;
                default:
                    throw new Error("Unknown auto_group_type: " + e)
            }
        },
        _nextGroupBegining: function(e, t, i) {
            var n = BN("i-date");
            if (i) return n.create(e.valueOf() + i);
            if ("minute" === t) return n.create(e.valueOf() + n.MINUTE_IN_MILLISECONDS);
            if ("hour" === t) return n.create(e.valueOf() + n.HOUR_IN_MILLISECONDS);
            if ("day" === t) return n.create(e.valueOf() + n.DAY_IN_MILLISECONDS);
            if ("week" === t) return n.create(e.valueOf() + 7 * n.DAY_IN_MILLISECONDS);
            if ("month" === t) return n.create(e.valueOf() + n.DAY_IN_MILLISECONDS * n.getDaysInMonth(e));
            throw new Error("Unknown group: " + t)
        },
        _getLastGroupEnd: function(e, t, i) {
            var n = BN("i-date");
            return i ? n.create(e.valueOf() + n.DAY_IN_MILLISECONDS - i) : "hour" === t ? n.create(e.valueOf() + n.DAY_IN_MILLISECONDS - n.HOUR_IN_MILLISECONDS) : e
        },
        _alignPeriodToGroupBegin: function(e, t) {
            var i, n = BN("i-date");
            if ("week" === t) i = 7 - (e.getDay() + 6) % 7;
            else {
                if ("month" !== t) return e;
                i = n.getDaysInMonth(e) - e.getDate() + 1
            }
            return n.create(e.valueOf() + i * n.DAY_IN_MILLISECONDS)
        },
        _getPeriod: function(e) {
            var t = {};
            return this.periods.forEach(function(e) {
                t[e.name] = e
            }), this._getPeriod = function(e) {
                return t[e]
            }, this._getPeriod(e)
        }
    }).done(), BN.addDecl("i-period").staticProp({
        _storage: BEM.create("i-storage", {
            key: "i-period"
        }),
        getDefault: function() {
            return this.nameToPeriod(this._storage.get() || this.DEFAULT_PERIOD)
        },
        setDefaultPeriodName: function(e) {
            this.getPeriodTypes().indexOf(e) > -1 && this._storage.set(e)
        }
    }).done(),
    function() {
        function e(e, t) {
            var i = String(e);
            for (t = t || 2; i.length < t;) i = "0" + i;
            return i
        }
        var t = {
                useUTCFormat: !1
            },
            i = function(e) {
                this.set.apply(this, e)
            },
            n = {
                MINUTE_IN_MILLISECONDS: 6e4,
                DAY_IN_MILLISECONDS: 864e5,
                HOUR_IN_MILLISECONDS: 36e5,
                create: function() {
                    return new i(arguments)
                },
                isISODate: function(e) {
                    return e && /^\d{4}-\d{2}-\d{2}$/.test(String(e))
                },
                _pad: e
            },
            o = [].slice;
        i.prototype = {
            configurate: function(e) {
                return jQuery.extend(!0, t, e), this
            },
            set: function(e) {
                var i, s, r, a = 0;
                if (0 !== arguments.length && e)
                    if (arguments.length > 1 || !isNaN(e) && 1e4 > e) r = o.call(arguments), r[1] = r[1] ? r[1] - 1 : 0, i = Date.UTC.apply(Date, r);
                    else if (isNaN(e)) {
                    if (e = String(e), e.indexOf(" ") > -1 && (e = e.replace(" ", "T")), e.indexOf("T") > -1 && !/T.*?[-+Z].*?$/i.test(e) && (e += "Z"), i = Date.parse(e), s = String(e).match(/T.*?([+-])(\d\d)(?::?(\d\d))?$/)) a = ("+" === s[1] ? -1 : 1) * (60 * s[2] + Number(s[3] || 0));
                    else if (e.indexOf("Z") < 0) {
                        var l = Date.parse("1970-01-01");
                        0 !== l && (i -= (new Date).getTimezoneOffset() * n.MINUTE_IN_MILLISECONDS)
                    }
                } else i = e > 1e10 ? e : 1e3 * e;
                else i = Date.now(), a = (new Date).getTimezoneOffset();
                return t.useUTCFormat || (i -= a * n.MINUTE_IN_MILLISECONDS, a = 0), this._tzo = a, this._date = new Date(i), this._tzString = "", this
            },
            getTime: function() {
                return this._date.getTime() + this._tzo * n.MINUTE_IN_MILLISECONDS
            },
            setTimezoneOffset: function(e) {
                return this._date = new Date(this._date.getTime() + (this._tzo - e) * n.MINUTE_IN_MILLISECONDS), this._tzo = e, this._tzString = null, this
            },
            getTimezoneOffset: function() {
                return this._tzo
            },
            getISODate: function() {
                var t = this._date;
                return t.getUTCFullYear() + "-" + e(t.getUTCMonth() + 1) + "-" + e(t.getUTCDate())
            },
            getISOTime: function(t) {
                var i = this._date,
                    n = e(i.getUTCHours()) + ":" + e(i.getUTCMinutes());
                return t ? n : n + ":" + e(i.getUTCSeconds())
            },
            toISOString: function() {
                var t;
                return this._tzString || (t = this._tzo, t ? (this._tzString = t > 0 ? "-" : "+", t = Math.abs(t), this._tzString += e(t / 60 >> 0) + ":" + e(t % 60)) : this._tzString = "Z"), this.getISODate() + "T" + this.getISOTime() + this._tzString
            },
            getDay: function() {
                return this._date.getUTCDay()
            },
            valueOf: function() {
                return this.getTime()
            },
            toString: function() {
                return this.toISOString()
            },
            getMonthName: function(e) {
                var t, i = this.getMonth() + 1;
                return e = e || {}, e["short"] ? (t = BEM.I18N("i-tanker__months", "short" + i), e.lowercase ? t : t.charAt(0).toUpperCase() + t.slice(1)) : (t = BEM.I18N("i-tanker__months", (e["case"] || "n") + i), e.lowercase && (t = t.toLowerCase()), t)
            },
            getDayName: function(e) {
                return BEM.I18N("i-tanker__days", "name", {
                    day: this.getDay() || 7,
                    "short": e || !1
                })
            },
            clone: function() {
                return BEM.blocks["i-date"].create(this.getTime()).setTimezoneOffset(this.getTimezoneOffset())
            },
            getMonth: function() {
                return this._date.getUTCMonth()
            },
            setMonth: function(e, t) {
                var i;
                return void 0 === t && (i = new Date(new Date(this._date).setMonth(e + 1, 0)).getDate(), t = Math.min(this.getDate(), i)), this._date.setUTCMonth(e, t), this
            },
            isValid: function() {
                return !isNaN(Number(this._date))
            }
        }, ["FullYear", "Date", "Hours", "Minutes", "Seconds", "Milliseconds"].forEach(function(e) {
            i.prototype["get" + e] = function() {
                return this._date["getUTC" + e]()
            }, i.prototype["set" + e] = function() {
                return this._date["setUTC" + e].apply(this._date, arguments), this
            }
        }), BEM.decl("i-date", null, n), BEM.blocks["i-date"]._DateCls = i
    }(), BEM.decl("i-date", null, {
        getDaysInMonth: function(e) {
            return new Date(e.getFullYear(), e.getMonth() + 1, 0).getDate()
        },
        localizedDateFormat: function(e) {
            return BEM.I18N("i-date", e)
        },
        secondsToTimeObj: function(e) {
            return e = e || 0, {
                hour: this._pad(3600 > e ? 0 : Math.floor(e / 3600), 2),
                minute: this._pad(60 > e ? 0 : Math.floor(e % 3600 / 60), 2),
                second: this._pad(e % 3600 % 60, 2)
            }
        },
        getDaysPeriod: function(e, t) {
            return Math.abs(this.create(e) - this.create(t)) / this.DAY_IN_MILLISECONDS
        },
        isSamePeriodDays: function(e, t) {
            return BN("i-date").getDaysPeriod(e.from, e.to) === BN("i-date").getDaysPeriod(t.from, t.to)
        }
    }),
    function() {
        var e = Date.parse,
            t = [1, 4, 5, 6, 7, 10, 11];
        Date.now || (Date.now = function() {
            return (new Date).getTime()
        }), (!Date.parse || isNaN(Date.parse("2001-02-03T04:05:06.007-06:30"))) && (Date.parse = function(i) {
            var n, o, s, r, a = 0;
            if (o = /^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(i)) {
                for (s = 0; r = t[s]; ++s) o[r] = +o[r] || 0;
                o[2] = (+o[2] || 1) - 1, o[3] = +o[3] || 1, "Z" !== o[8] && void 0 !== o[9] && (a = 60 * o[10] + o[11], "+" === o[9] && (a = 0 - a)), n = Date.UTC(o[1], o[2], o[3], o[4], o[5] + a, o[6], o[7])
            } else n = e ? e(i) : NaN;
            return n
        })
    }(),
    function(e) {
        function t(e, i) {
            var n;
            if (e === i) return !0;
            if ("function" == typeof e && "function" == typeof i || e instanceof Date && i instanceof Date || e instanceof RegExp && i instanceof RegExp) return e.toString() === i.toString();
            if (!(e instanceof Object && i instanceof Object)) return !1;
            if (e.constructor !== i.constructor || e.prototype !== i.prototype) return !1;
            for (n in e)
                if (e.hasOwnProperty(n) !== i.hasOwnProperty(n)) return !1;
            for (n in i)
                if (e.hasOwnProperty(n) !== i.hasOwnProperty(n)) return !1;
            for (n in e)
                if (e.hasOwnProperty(n) && !t(e[n], i[n])) return !1;
            return !0
        }
        e.equals = t
    }(jQuery), BEM.decl("i-report", {
        onSetMod: {
            js: function() {
                this._paramsModel = this._createParamsModel(this.params.reportParams)
            }
        },
        destruct: function() {
            return this.getParamsModel().destruct(), this._metadata && this._metadata.isFulfilled() && this._metadata.valueOf().destruct(), this._chartMeta && this._chartMeta.isFulfilled() && this._chartMeta.valueOf().destruct(), this.__base.apply(this, arguments)
        },
        getId: function() {
            return this.params.id
        },
        getName: function() {
            return this.params.name || (this.params.name = BEM.I18N("i-report", "report-" + this.getId()) || this.getId()), this.params.name
        },
        getReportPath: function() {
            return "/" + this.getUrlGroup() + "/" + this.getUrlKey()
        },
        getUrlKey: function() {
            return this.isUser() ? this.getId() : this.params.urlKey
        },
        getUrlGroup: function() {
            return this.params.urlGroup
        },
        getReportHost: function() {},
        getMetrikaHost: function() {},
        isGoalRequired: function() {
            return Boolean(this.params.requireGoal)
        },
        isAvailable: function() {
            return this.params.available !== !1
        },
        isActive: function() {
            return Boolean(this.params.isActive)
        },
        isPublicAccessible: function() {
            return this.params.publicAccess !== !1
        },
        isNda: function() {
            return this.params.nda === !0
        },
        onlySingleCounterMode: function() {
            return this.params.onlySingleCounterMode === !0
        },
        useAdditionalGrouping: function() {
            return this.params.useAdditionalGrouping === !0
        },
        isNewTab: function() {
            return this.params.newTab === !0
        },
        isNew: function() {
            return Boolean(this.params.newReport)
        },
        isWidgetReport: function() {
            return Boolean(this.params.isWidgetReport)
        },
        isCustomized: function() {
            return Boolean(this.params.isCustomized)
        },
        isGroupingDisabled: function() {
            return Boolean(this.params.disableGrouping)
        },
        getType: function() {
            return this.params.type || "default"
        },
        getPreset: function() {
            return this.params.preset
        },
        getChartPreset: function() {
            return this.params.chartPreset || this.getPreset()
        },
        getChartMode: function() {
            return this.params.chartMode || "default"
        },
        isChanged: function() {
            return !1
        },
        getOverridedPreset: function() {
            return this.params.templatePreset || void 0
        },
        getOverridedChartPreset: function() {
            return this.getChartPreset() === this.getPreset() ? this.getOverridedPreset() : this.params.templateChartPreset
        },
        isUser: function() {
            return Boolean(this.params.isUser)
        },
        needRedraw: function() {
            var e = this.__self._parseUrl();
            return e.id !== this.getId() || this.isWidgetReport() && this.isWidgetReport() !== Boolean(e.params.isWidgetReport)
        },
        loadData: function(e) {
            return BN("i-default-data").loadData(e)
        },
        getReportOptions: function() {
            return BN("i-default-data").getReportOptions()
        },
        getMetadata: function() {
            return this._metadata || (this._metadata = this._createMetadata({
                preset: this.getOverridedPreset() || this.getPreset()
            })), this._metadata
        },
        getChartMetadata: function() {
            var e;
            return this._chartMeta || (e = this.getChartPreset(), e === this.getPreset() ? this._chartMeta = this.getMetadata() : this._chartMeta = this._createMetadata({
                preset: this.getOverridedChartPreset() || e
            })), this._chartMeta
        },
        areTableRowsSelectable: function() {
            return this.hasChart() && "bytime" !== this.getChartMode() && this.params.disallowRowSelection !== !0
        },
        hasFilter: function() {
            return this.params.disallowDimFilter !== !0
        },
        getParamsModel: function() {
            return this._paramsModel
        },
        buildUrlParams: function() {
            var e = this.getParamsModel().buildUrlParams();
            return this.isWidgetReport() ? e.then(function(e) {
                return jQuery.extend({}, e, {
                    title: this.getName(),
                    table: this.getOverridedPreset().table
                })
            }.bind(this)) : e
        },
        buildParams: function() {
            return this.getParamsModel().fetch().always(function(e) {
                return e.isRejected() && console.error(e.valueOf()), this
            }.bind(this))
        },
        subscribeToChanges: function() {
            this.getParamsModel().subscribeToDataBindings()
        },
        getApiExportFormats: function() {
            return this.__self._exportFormats
        },
        hasChart: function() {
            return !this.params.hideChart
        },
        getDefaultChartType: function() {
            return this.params.defaultChartType || BN("i-chart").getDefaultChartType()
        },
        getDefaultDimensionMode: function() {
            return this.params.defaultDimensionMode
        },
        _createParamsModel: function(e) {
            return BEM.create({
                block: this.__self._getParamsModelBlockName(this.params)
            }, {
                initials: e,
                report: this
            })
        },
        _createMetadata: function(e) {
            var t = this.params.reportParams;
            return BEM.create({
                block: this.__self._getMetadataBlockName(this.getType())
            }, jQuery.extend(e, {
                report: this,
                defaults: this.isUser() ? t && t.preset : {},
                initials: t && t.preset
            })).load()
        }
    }, {
        _cache: BN("i-state").initNs("i-report"),
        _exportFormats: [],
        cleanCache: function() {
            var e = this._cache.get("reportInstance");
            e && (e.isFulfilled() && e.valueOf().destruct(), this._cache.set("reportInstance", null), e.isResolved() || e.reject())
        },
        trafficSourceToReport: function(e) {
            return {
                ad: "marketing",
                organic: "search_engines",
                referral: "sites",
                social: "social_networks"
            }[e]
        },
        getReport: function() {
            var e = this._cache.get("reportInstance");
            return (!e || e.isRejected()) && (e = this._getReport(), this._cache.set("reportInstance", e)), e
        },
        bulkCreateUserReports: function() {
            return BN("i-preset-api").list().then(function(e) {
                return e.filter(function(e) {
                    return e.reportType === BN("i-preset-api").reportTypes.USER
                })
            }.bind(this)).then(this._bulkCreateReportsByParams.bind(this))
        },
        bulkCreateReports: function(e) {
            return BN("i-preset-api").list().then(function(t) {
                var i = t.reduce(function(e, t) {
                    return e[t.id] = t, e
                }, {});
                return e.map(function(e) {
                    return i[e] || {
                        id: e
                    }
                })
            }).then(this._bulkCreateReportsByParams.bind(this))
        },
        loadData: function() {
            var e = arguments;
            return this.getReport().then(function(t) {
                return t.loadData.apply(t, e)
            })
        },
        getReportOptions: function() {
            return this.getReport().then(function(e) {
                return e.getReportOptions()
            })
        },
        getMetadata: function() {
            return this.getReport().then(function(e) {
                return e.getMetadata()
            })
        },
        getChartMetadata: function() {
            return this.getReport().then(function(e) {
                return e.getChartMetadata()
            })
        },
        registerImplementation: function() {
            BN("i-report")._implementations = BN("i-report")._implementations || [], BN("i-report")._implementations.push(this._name)
        },
        createReport: function(e, t) {
            return BN("i-counters").getAsync().then(function(t) {
                return BN("i-preset-api").getReportById(t.getApiCounterId(), e)
            }).then(function(i) {
                return this._createReportByParams(e, i, t)
            }.bind(this))
        },
        _getReport: function() {
            var e = BN("i-errors").MetrikaHttpError,
                t = this._parseUrl();
            return t ? this.createReport(t.id, !0).then(function(e) {
                return Vow.allResolved([e, BN("i-report-collection").get()])
            }).spread(function(e, t) {
                return e = e.valueOf(), t.isFulfilled() && t.valueOf().setActiveReport(e), e
            }) : Vow.reject(new e(404))
        },
        _bulkCreateReportsByParams: function(e) {
            return Vow.allResolved(e.map(function(e) {
                return this._createReportByParams(e.id, e, !1)
            }, this)).then(function(e) {
                return e.filter(function(e) {
                    return e.isFulfilled()
                }).map(function(e) {
                    return e.valueOf()
                })
            })
        },
        _createReportByParams: function(e, t, i) {
            var n, o, s, r, a = BN("i-errors").MetrikaHttpError;
            return n = this._lookupById(e), !n && t && t.templateReport && (n = this._lookupById(t.templateReport), s = !0), n ? (i && (o = this._getUrlParams()), r = this._createReportInstance(n.block, n.params, t || {}, o, {
                id: e,
                isActive: Boolean(i),
                isUser: Boolean(s),
                isCustomized: !s && t
            }), this._checkNda(r).then(function() {
                return r.buildParams()
            }).then(function(e) {
                return e.subscribeToChanges(), e
            })) : Vow.reject(new a(404))
        },
        _checkNda: function(e) {
            return e.isNda() ? BN("i-user").checkNda() : Vow.fulfill()
        },
        _createReportInstance: function(e) {
            var t = jQuery.extend.apply(jQuery, [{}].concat([].slice.call(arguments, 1)));
            return BEM.create({
                block: e
            }, t)
        },
        _lookupById: function(e) {
            return this._getReportTable().byId[e]
        },
        _lookupByUrl: function(e, t) {
            return this._getReportTable().byUrl[this._buildUrlKey(e, t)]
        },
        _buildUrlKey: function(e, t) {
            return e + "-" + t
        },
        _getReportTable: function() {
            return this._reportTable || (this._reportTable = this._implementations.reduce(function(e, t) {
                return BN(t)._reports.reduce(function(e, i) {
                    return e.byId[i.id] = {
                        block: t,
                        params: i
                    }, e.byUrl[this._buildUrlKey(i.urlGroup, i.urlKey)] = i.id, e
                }.bind(this), e)
            }.bind(this), {
                byId: {},
                byUrl: {}
            })), this._reportTable
        },
        _getUrlParams: function() {
            var e = this._parseUrl();
            return e && e.params || {}
        },
        _parseUrl: function() {
            var e, t = BN("i-router").getMatchers()[0],
                i = t.toLowerCase().match(/^\/*([^\/]+)\/([^\/]+)(\/([^\/]+))?\/?$/i),
                n = BN("i-router").getParams().title,
                o = BN("i-router").getParams().table;
            return n = n && n.trim() || void 0, o = o && o.trim(), i ? i[2].match(/[0-9a-f]{24}/i) ? {
                id: i[2],
                isUser: !0,
                params: {
                    name: n,
                    isCompare: "compare" === i[4]
                }
            } : (e = this._lookupByUrl(i[1], i[2]), e ? {
                id: e,
                isUser: !1,
                params: {
                    name: n,
                    isCompare: "compare" === i[4],
                    isWidgetReport: "new" === e && o && n,
                    templatePreset: "new" === e && o ? {
                        table: o.toLowerCase(),
                        metrics: [],
                        dimensions: [],
                        meta: {
                            metrics: [],
                            dimensions: []
                        }
                    } : void 0
                }
            } : void 0) : void 0
        },
        _getParamsModelBlockName: function(e) {
            return e.reportParamsBlock || "i-report-params"
        },
        _getMetadataBlockName: function(e) {
            return "i-" + e + "-metadata"
        },
        _reports: [{
            id: "monitoring_results",
            type: "monitoring",
            onlySingleCounterMode: !0,
            urlGroup: "stat",
            urlKey: "monitoring_results",
            reportParamsBlock: "i-report-params-monitoring",
            defaultChartType: "timeline"
        }, {
            id: "visor",
            type: "webvisor",
            publicAccess: !1,
            onlySingleCounterMode: !0,
            urlGroup: "stat",
            urlKey: "visor",
            reportParamsBlock: "i-report-params-webvisor"
        }, {
            id: "conversion_rate",
            type: "conversion",
            onlySingleCounterMode: !0,
            urlGroup: "stat",
            urlKey: "conversion_rate",
            reportParamsBlock: "i-report-params-conversion",
            useAdditionalGrouping: !0
        }]
    }).registerImplementation(), BEM.decl("i-report", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._triggerChange = jQuery.debounce(this._triggerChange.bind(this), 200), this.getParamsModel().on("change", this._triggerChange, this), this.params.isActive && this._onReportVisit()
            }
        },
        destruct: function() {
            return this.getParamsModel().un("change", this._triggerChange, this), this.__base.apply(this, arguments)
        },
        remove: function() {
            var e = this,
                t = this.getId();
            return BN("i-preset-api").remove(t).then(function() {
                BEM.blocks["i-report"].trigger("remove"), e.destruct()
            }).then(function() {
                return BN("i-popular-reports-collection").get().removeReport(t)
            })
        },
        resetToDefaults: function() {
            return Vow.all([this.getParamsModel().resetToDefaults(), BN("i-preset-api").remove(this.getId())]).then(function() {
                this.params.isCustomized = !1, this.isActive() && this.trigger("change")
            }.bind(this))
        },
        saveChanges: function(e) {
            return this._packState(e).then(function(e) {
                return BN("i-preset-api").save(this.getId(), e)
            }.bind(this)).then(function() {
                this.isNew() ? (this.params.isUser = !0, this.params.newReport = !1) : this.params.isCustomized = !0, this.params.isWidgetReport = !1, this.isActive() && (this.getParamsModel().sync(), this.trigger("change"))
            }.bind(this))
        },
        rename: function(e) {
            if (!this.isUser()) throw new Error("Predefined reports can not be renamed");
            return BN("i-preset-api").save(this.getId(), {
                name: e
            }).then(function() {
                this._setName(e), this.trigger("change")
            }.bind(this))
        },
        saveAs: function(e) {
            return this._packState({
                name: e
            }).then(function(e) {
                return BN("i-preset-api").create(e)
            }).then(function(t) {
                this.params.isUser = !0, this.params.newReport = !1, this.params.templateReport = this.params.templateReport || this.getId(), this._setId(t), this._setName(e), this.params.isWidgetReport = !1, this.isActive() && (this.getParamsModel().sync(), this.trigger("change"), this._onReportVisit())
            }.bind(this))
        },
        isChanged: function() {
            return this.getParamsModel().isReportChanged()
        },
        subscribeToChanges: function() {
            return this.isActive() && this.bindToData({
                report_id: {
                    get: "getId",
                    initAccessor: "getId",
                    event: "change"
                }
            }), this.__base()
        },
        _triggerChange: function() {
            this.trigger("change")
        },
        _setName: function(e) {
            this.params.name = e
        },
        _setId: function(e) {
            this.params.id = e
        },
        _packState: function(e) {
            var t = this.getMetadata(),
                i = null;
            return this.getChartPreset() !== this.getPreset() && (i = this.getChartMetadata()), Vow.all([t, i, this.getParamsModel().getState()]).spread(function(t, i, n) {
                var o = {
                    reportParams: n
                };
                return o.templateReport = this.params.templateReport || this.getId(), o.templatePreset = this.params.templatePreset, o.templateChartPreset = this.params.templateChartPreset, this.isActive() && (this.getParamsModel().isSignificantlyChanged() || this.isWidgetReport() ? (o.templatePreset = t.clonePreset(), i && (o.templateChartPreset = i.clonePreset())) : (o.templatePreset = void 0, o.templateChartPreset = void 0)), jQuery.extend(o, e)
            }.bind(this))
        },
        _onReportVisit: function() {
            BN("i-popular-reports-collection").get().visitReport(this.getId()).done()
        }
    }), BEM.decl({
        name: "i-report-legacy",
        baseBlock: "i-report"
    }, {
        loadData: function(e) {
            return BN("i-legacy-data").loadData(e)
        },
        getReportOptions: function() {
            return BN("i-legacy-data").getReportOptions()
        }
    }, {
        _exportFormats: ["xlsx", "csv"],
        _reports: [{
            preset: "traffic",
            chartMode: "bytime"
        }, "sources", "sites", "search_engines", {
            preset: "search_phrases",
            publicAccess: !1
        }, "social_networks", "adv_engines", "tags", "regions", "interest", "demography", "depth", "duration", "hour", "popular", "entrance", "exit", "title", "url_param", "share", "external_links", "downloads", "visit_param", {
            preset: "ecommerce",
            publicAccess: !1,
            requireGoal: !0,
            hideChart: !0
        }, "browsers", "os", "display", "mobility", "mobile", "flash", "silverlight", "java", "cookies", "js", {
            id: "robots",
            preset: "robots_all",
            chartMode: "robots",
            chartPreset: "robot_types",
            disallowRowSelection: !0,
            disallowDimFilter: !0
        }, {
            preset: "load",
            chartMode: "bytime"
        }].map(function(e) {
            return e instanceof Object || (e = {
                preset: e
            }), e.type = "legacy", e.urlGroup = "legacy", e.urlKey = e.id || e.preset, e.id = "legacy/" + (e.id || e.preset), e.reportParamsBlock = "i-report-params", e.onlySingleCounterMode = !0, e
        })
    }).registerImplementation(), BEM.decl("i-stat-data", null, {
        loadData: function(e) {
            return Vow.all([BN("i-report").getReport(), BN("i-report").getMetadata()]).spread(function(t, i) {
                return i.hasDirectClientParam() && !e.direct_client_ids ? Vow.reject(new(BN("i-errors").MetrikaError)("ERR_REPORT_REQUIRE_DIRECT_CLIENT_ID")) : t.isGoalRequired() && !e.goalId ? Vow.reject(new(BN("i-errors").MetrikaError)("ERR_REPORT_REQUIRE_GOAL")) : e
            }).then(this._loadData.bind(this))
        },
        getReportOptions: function() {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(e, t, i) {
                var n = {},
                    o = i.getParamsModel().getState();
                return n.ids = e.getApiCounterId(), n.sort = o["data-table"].sort, n.mode = o["data-table"].dimensionMode, n.goalId = o.preset.goal, n.period = o.period, n.group = o.group, n.rowsLimit = o["data-table"].rowsLimit, n.metric = o["data-table"].metric, n.dimensions = t.getDimensions(), n.metrics = t.getMetrics(), n.percentagesMetrics = o["data-table"].percentage, n
            })
        }
    }), BEM.decl("i-proxy", null, {
        _cacheSize: 30,
        _cacheTimeout: 72e5,
        _cache: {},
        _cacheKeys: [],
        _cachedMethods: {},
        initProxy: function(e, t) {
            var i = {};
            return t.forEach(function(t) {
                t.match(/(.*)\*$/) && (t = RegExp.$1, this._cachedMethods[[e, t].join(".")] = !0), i[t] = function() {
                    return BEM.blocks["i-proxy"]._cachedCall(e, t, [].slice.call(arguments, 0))
                }
            }, this), i
        },
        cleanCache: function(e, t) {
            t = t instanceof Array ? t : [t], t.forEach(function(t) {
                var i = e + "." + t;
                this._cachedMethods[i] && (this._cacheKeys = this._cacheKeys.filter(function(e) {
                    return 0 === e.indexOf(i) ? (delete this._cache[e], !1) : !0
                }.bind(this)))
            }.bind(this))
        },
        _cachedCall: function(e, t, i) {
            var n, o, s = this,
                r = JSON.stringify([].slice.call(i, 0)),
                a = [e, t, r].join(".");
            return this._cache[a] && (o = this._cacheKeys.indexOf(a), o > -1 && this._cacheKeys.splice(o, 1), Date.now() - this._cache[a].timestamp <= this._cacheTimeout) ? (this._cacheKeys.unshift(a), this._cache[a].promise) : (n = this.callBlockMethod(e, t, r).fail(function(e) {
                return delete s._cache[a], Vow.reject(e)
            }), this._cachedMethods[[e, t].join(".")] && (this._cache[a] = {
                promise: n,
                timestamp: Date.now()
            }, this._cacheKeys.unshift(a), this._cacheKeys.length > this._cacheSize && delete this._cache[this._cacheKeys.pop()]), n)
        },
        callBlockMethod: function(e, t, i) {
            return BN("i-api-request").getSecretKey("v2").then(function(n) {
                return BN("ajax").post(this.getHost() + "/i-proxy/" + e + "/" + t, {
                    lang: BN("i-locale").getLang()
                }, {
                    args: i,
                    ulogin: BN("i-router").getParams().ulogin,
                    key: n
                }).fail(function(n) {
                    return n instanceof BEM.blocks["i-error-message"].MetrikaSecretKeyError ? (BN("i-api-request").setSecretKey(n.getValidSecretKey()), this.callBlockMethod(e, t, i)) : Vow.reject(n)
                }.bind(this))
            }.bind(this))
        },
        getHost: function() {
            return BN("i-global").get("i-proxy.host")
        }
    }), BEM.decl("ajax", null, {
        get: function(e, t) {
            return this.request("GET", e, t)
        },
        post: function(e, t, i) {
            return this.request("POST", e, t, i)
        },
        _logProfileInfo: function(e) {
            e && e.profile && e.profile.forEach(function(e) {
                e && BN("i-debug").debug(e.type, e.data)
            })
        },
        request: function(e, t, i, n) {
            var o = Vow.promise(),
                s = jQuery.param(i || {}),
                r = this;
            return e = e.toUpperCase(), n = jQuery.extend(!0, {}, n, i || {}), s && (t += "?" + s), jQuery.ajax(t, {
                type: e,
                contentType: "application/json",
                data: n,
                headers: {
                    "X-Requested-With": "XMLHttpRequest"
                },
                xhrFields: {
                    withCredentials: !0
                },
                success: function(e) {
                    o.fulfill(e);
                },
                error: function(e) {
                    var t, i;
                    try {
                        if (t = JSON.parse(e.responseText), i = t.error, !i) throw new Error("Uknown error");
                        o.reject(BEM.blocks["i-errors"].createError(i))
                    } catch (n) {
                        o.reject(new BEM.blocks["i-errors"].HttpError(e.status))
                    }
                }
            }), o.then(function(e) {
                return r._logProfileInfo(e), e.result
            }).fail(function(e) {
                return r._logProfileInfo(e), Vow.reject(e)
            })
        }
    }), BEM.decl("i-api-request", null, {
        getEasySecretKey: function() {
            return Vow.fulfill(BEM.blocks["i-global"].get("i-api-request.easy-sk"))
        },
        getSecretKey: function(e) {
            return e = e || "v1", Vow.fulfill(BEM.blocks["i-global"].get("i-api-request.sk" + e))
        },
        _getSecretKey: function() {
            return this.getSecretKey()
        },
        _request: function(e, t, i) {
            var n = this.__base.bind(this);
            return "get" !== e ? (i = i || {}, this._getSecretKey().then(function(o) {
                return i.sk = o, n(e, t, i)
            })) : n(e, t, i)
        }
    }), BEM.decl("i-api-request", null, {
        setSecretKey: function(e) {
            BEM.blocks["i-global"].get("i-api-request").skv2 = e
        }
    }), BEM.decl({
        block: "i-stat-api",
        baseBlock: "i-metrika-api"
    }), BEM.decl({
        block: "i-stat-data-api",
        baseBlock: "i-stat-api"
    }, null, {
        post: function(e, t) {
            return this._request("post", e, t)
        },
        getCountersActivity: function(e, t) {
            return this.post("/activity_raw", {
                body: {
                    groups: e
                },
                params: t
            }).then(function(e) {
                return e.response
            })
        }
    }), BEM.decl("i-counters", {
        isSingle: function() {
            throw new Error("must be implemented in child/mode")
        },
        isGroup: function() {
            throw new Error("must be implemented in child/mode")
        },
        isGlobal: function() {
            return !1
        },
        isPublic: function() {
            throw new Error("must be implemented in child/mode")
        },
        isPublicAccessible: function() {
            throw new Error("must be implemented in child/mode")
        },
        isDeleted: function() {
            throw new Error("must be implemented in child/mode")
        },
        getId: function() {
            throw new Error("must be implemented in child/mode")
        },
        getApiCounterId: function() {
            throw new Error("must be implemented in child/mode")
        },
        getName: function() {
            throw new Error("must be implemented in child/mode")
        },
        getUiType: function() {
            throw new Error("must be implemented in child/mode")
        },
        needRedraw: function() {
            throw new Error("must be implemented in child/mode")
        },
        getParams: function() {
            throw new Error("must be implemented in child/mode")
        },
        getGrants: function() {
            throw new Error("must be implemented in child/mode")
        },
        getPermissions: function() {
            throw new Error("must be implemented in child/mode")
        }
    }, {
        _state: BN("i-state").initNs("i-counters"),
        getAsync: function() {
            var e = this._getCachedInstance();
            return e || (e = this._createInstance(), this._storeInstance(e)), e
        },
        getIds: function() {
            var e = BN("i-router").getParams();
            return {
                id: Number(e.id),
                gid: Number(e.gid)
            }
        },
        getCounterId: function() {
            var e = BN("i-router"),
                t = e.getParams(),
                i = t.id;
            return isNaN(i) && (i = e.getMatchers()[1]), isNaN(i) ? null : Number(i)
        },
        getGroupId: function() {
            var e = BN("i-router").getParams();
            return Number(e.gid) || null
        },
        isSingle: function() {
            return null !== this.getCounterId()
        },
        switchTo: function(e) {
            var t = this._getCachedInstance(),
                i = this;
            return t && t.isFulfilled() && t.valueOf().destruct(), t = this._createInstance(e), this._storeInstance(t), t.then(function(e) {
                return BEM.dataBindVal("counter", e.getParams()), i.trigger("switch", e.getParams()), e
            })
        },
        getGrants: function() {
            throw new Error("must be implemented in child/mod")
        },
        _getType: function() {
            return this.isSingle() ? "counter" : "group"
        },
        _createInstance: function(e) {
            var t, i;
            return !e || void 0 === e.counter_id && void 0 === e.group_id ? (t = null !== this.getCounterId(), i = t ? this.getCounterId() : this.getGroupId()) : (t = void 0 !== e.counter_id, i = t ? e.counter_id : e.group_id), void 0 === i || null === i ? Vow.reject(new BEM.blocks["i-errors"].HttpError(404)) : BN("i-counter-global").isGlobal(i) ? BN("i-counter-global").create(i) : t ? BN("i-counter-single").create(i) : BN("i-counters-group").create(i)
        },
        _storeInstance: function(e) {
            this._state.set("instance", e)
        },
        _getCachedInstance: function() {
            return this._state.get("instance")
        }
    }), BEM.decl({
        name: "i-counter-single",
        baseBlock: "i-counters"
    }, {
        onSetMod: {
            js: function() {
                this._counter = this.params.counter
            }
        },
        isSingle: function() {
            return !0
        },
        isGroup: function() {
            return !1
        },
        isDeleted: function() {
            return "Deleted" === this._counter.status
        },
        isPublic: function() {
            return this._counter.isPublic
        },
        isPublicAccessible: function() {
            return Boolean(this._counter.publicGrant)
        },
        getId: function() {
            return this._counter.id
        },
        getApiCounterId: function() {
            return this._counter.id
        },
        getName: function() {
            return this.__self.getName(this._counter)
        },
        getUiType: function() {
            return this._counter.uiType
        },
        needRedraw: function(e) {
            return Number(e.counter_id) !== this._counter.id
        },
        getPartnerId: function() {
            return this._counter.partner_id
        },
        getOwnerLogin: function() {
            return BN("i-user").normalizeLogin(this._counter.owner_login)
        },
        isPartner: function() {
            return "partner" === this._counter.type
        },
        getParams: function() {
            return {
                counter_id: this._counter.id,
                group_id: null
            }
        },
        getCounterInstance: function() {
            return this._counter
        },
        getSettings: function() {
            var e = $.extend({}, this._counter);
            return delete e.grants, delete e.isPublic, e
        },
        getGrants: function() {
            return this._counter.grants
        },
        isFavorite: function() {
            return Boolean(this._counter.favorite)
        },
        isEditable: function() {
            return Boolean(this.getPermissions().write)
        },
        getSite: function() {
            return this._counter.site
        },
        getGoals: function() {
            return this._counter.goals || []
        },
        getMirrors: function() {
            return [this._counter.site].concat(this._counter.mirrors || [])
        },
        getPermissions: function() {
            return this.params.permissions
        },
        getUpdateTime: function() {
            return this._counter.update_time
        }
    }), BEM.decl("i-counter-single", {}, BN("i-proxy").initProxy("i-counter-single", ["_getPermissions"])), BEM.decl("i-counter-single", null, {
        create: function(e) {
            return Vow.all([BN("i-counters-api").byId(e), this.getPermissions(e)]).spread(function(e, t) {
                return BEM.create({
                    block: "i-counter-single"
                }, {
                    counter: e,
                    permissions: t
                })
            }.bind(this))
        },
        getPermissions: function(e) {
            var t = this;
            return BN("i-counters-api").byId(e).then(function(i) {
                return i.isPublic ? {
                    read: !0
                } : t._getPermissions(e)
            })
        },
        isEditable: function(e) {
            return ["own", "edit"].indexOf(e.permission) >= 0
        },
        getName: function(e) {
            return e.name || e.site || e.id
        }
    }), BN.addDecl("i-counters-api").staticProp(BN("i-proxy").initProxy("i-counters-api", ["simpleLoad*", "_choose", "check", "getList*", "byId*", "getCounterGoalsById*", "saveCounterSettings", "undelete", "createCounter", "_deleteCounterGrant", "_setCounterPublicGrantEnabled", "_changeCounterGrant", "_createCounterGrant", "getCounterGrants*", "delete", "_setCounterInformerEnabled", "_assignLabel", "getCountersGroupStat", "getLabelStat", "getCountersQuantityByLabels*"])).done(),
    function() {
        var e = function(e, t) {
            return function() {
                return e.apply(this, arguments).then(function(e) {
                    return BN("i-proxy").cleanCache("i-counters-api", t), e
                })
            }
        };
        BN.addDecl("i-counters-api").staticProp({
            joinStatsToCounters: function(e, t) {
                var i, n, o = this;
                return e && e.length ? (i = BN("i-date").create(), n = e.map(function(e) {
                    return [e.id]
                }), BN("i-stat-data-api").getCountersActivity(n, {
                    date2: i.getISODate(),
                    date1: i.setDate(i.getDate() - (t || 1)).getISODate()
                }).then(function(t) {
                    return e.forEach(function(e) {
                        var i;
                        t.some(function(t) {
                            return t.group[0] === e.id ? (i = t, !0) : void 0
                        }), e.stats = i ? o._buildSimpleStatsForCounter(i.activity) : !1
                    }), e
                })) : Vow.fulfill(e)
            },
            getCounterUserGrants: function(e) {
                return this._getCounterGrants(e)
            },
            getCounterPublicGrant: function(e) {
                return this._getCounterGrants(e, !0)
            },
            _getCounterGrants: function(e, t) {
                return t = Boolean(t), this.getCounterGrants(e).then(function(e) {
                    return e = e.filter(function(e) {
                        return t ? "public_stat" === e.perm : "public_stat" !== e.perm
                    }), t ? e[0] || void 0 : e
                })
            },
            deleteCounterGrant: e(function() {
                return this._deleteCounterGrant.apply(this, arguments)
            }, "getCounterGrants"),
            setCounterPublicGrantEnabled: e(function() {
                return this._setCounterPublicGrantEnabled.apply(this, arguments)
            }, ["getCounterGrants", "byId"]),
            changeCounterGrant: e(function() {
                return this._changeCounterGrant.apply(this, arguments)
            }, "getCounterGrants"),
            createCounterGrant: e(function() {
                return this._createCounterGrant.apply(this, arguments)
            }, "getCounterGrants"),
            setCounterInformerEnabled: e(function() {
                return this._setCounterInformerEnabled.apply(this, arguments)
            }, "byId"),
            assignLabel: e(function() {
                return this._assignLabel.apply(this, arguments)
            }, "simpleLoad"),
            choose: e(function() {
                return this._choose.apply(this, arguments)
            }, "simpleLoad"),
            _buildSimpleStatsForCounter: function(e) {
                return {
                    today: e.daily[e.daily.length - 1] || {},
                    delta: e.delta,
                    weekStats: e.daily.map(function(e) {
                        return e.visits
                    })
                }
            }
        }).done()
    }(),
    function() {
        function e(e) {
            return n[e] || (n[e] = new Function("d", 'var D = BEM.blocks["i-date"]; d = d instanceof D._DateCls ? d : D.create(d); return \'' + String(e).replace(/\w/g, function(t, n) {
                return i[t] && "\\" !== e.charAt(n - 1) ? "' + (" + i[t] + ") + '" : t + "' + '"
            }) + "';")), n[e]
        }
        var t = BEM.blocks["i-date"],
            i = {
                Y: "d.getFullYear()",
                y: "D._pad(d.getFullYear() % 100)",
                m: "D._pad(d.getMonth() + 1)",
                n: "d.getMonth() + 1",
                F: "d.getMonthName()",
                f: 'd.getMonthName({case: "g"})',
                M: 'd.getMonthName({"short":true})',
                d: "D._pad(d.getDate())",
                j: "d.getDate()",
                w: "d.getDay()",
                l: "d.getDayName()",
                D: 'd.getDayName({"short":true})',
                H: "D._pad(d.getHours())",
                G: "d.getHours()",
                h: "D._pad(d.getHours() % 12 || 12)",
                g: "d.getHours() % 12 || 12",
                i: "D._pad(d.getMinutes())",
                s: "D._pad(d.getSeconds())",
                u: "D._pad(d.getMilliseconds(), 3)",
                a: 'd.getHours() < 12 ? "am" : "pm"',
                A: 'd.getHours() < 12 ? "AM" : "PM"',
                U: "Math.floor(d.getTime() / 1e3)",
                Z: "-60 * d.getTimezoneOffset()"
            },
            n = {};
        t._DateCls.prototype.format = function(e) {
            return t.format(e)(this)
        }, BEM.decl("i-date", null, {
            PERIOD_DURATIONS: [{
                key: "year",
                duration: 1
            }, {
                key: "month",
                duration: 12
            }, {
                key: "day",
                duration: 30
            }, {
                key: "hour",
                duration: 24
            }, {
                key: "minute",
                duration: 60
            }, {
                key: "second",
                duration: 60
            }, {
                key: "millisecond",
                duration: 1e3
            }],
            defineFormatter: function(e, t) {
                if (e.length > 1) throw new Error("Formatter matcher must be a single symbol");
                if ("string" != typeof t) throw new Error("Formatter must be a string");
                return i[e] = t, this
            },
            format: function(t) {
                return e(t)
            },
            splitPeriod: function(e) {
                var t = this.PERIOD_DURATIONS.reduceRight(function(t, i) {
                    return t.push({
                        key: i.key,
                        value: e % i.duration
                    }), e = Math.floor(e / i.duration), t
                }, []).reduceRight(function(e, t) {
                    return (e.length > 0 || 0 !== t.value) && e.push(t), e
                }, []);
                return t
            },
            compactPeriodByColon: function(e) {
                var t, i = this.splitPeriod(Math.abs(e)).map(function(e) {
                    return this._pad(e.value, String(this._getPeriodDuration(e.key) - 1).length)
                }, this).join(":");
                return "" === i && (i = "000"), t = i.lastIndexOf(":"), i = -1 !== t ? i.slice(0, t) + "." + i.slice(t + 1) : "00." + i, 0 > e && (i = "-" + i), i
            },
            compactPeriod: function(e) {
                var t = this.splitPeriod(e).slice(0, 2);
                return 2 === t.length && 0 === t[1].value && t.pop(), t.map(function(e) {
                    return e.value + " " + BEM.I18N("i-date", e.key)
                }).join(" ")
            },
            _getPeriodDuration: function(e) {
                var t;
                return this.PERIOD_DURATIONS.some(function(i) {
                    return i.key === e ? (t = i.duration, !0) : void 0
                }), t
            }
        })
    }(), BEM.decl({
        block: "i-management-api",
        baseBlock: "i-metrika-api"
    }, null, {
        getDelegates: function() {
            return this.get("delegates")
        },
        getDelegatesRequests: function() {
            return this.get("delegates_requests")
        },
        saveDelegate: function(e, t) {
            return this.dropCache(), this._request("post", "delegates", {
                body: {
                    delegate: {
                        user_login: e,
                        comment: t
                    }
                }
            })
        },
        removeDelegate: function(e) {
            return this.dropCache(), this._request("delete", "delegate", {
                params: {
                    user_login: e
                }
            })
        },
        voteDelegateRequest: function(e, t, i) {
            return this.dropCache(), this._request("post", "vote_delegate_request", {
                body: {
                    delegate_request: {
                        user_login: e,
                        comment: t,
                        vote: i
                    }
                }
            })
        },
        getDirectClients: function(e) {
            var t = this;
            return BN("i-counters").getAsync().then(function(i) {
                return t.get("clients", {
                    params: {
                        counters: i.getApiCounterId(),
                        date1: e.from,
                        date2: e.to
                    }
                })
            }).then(function(e) {
                return e.clients
            })
        },
        saveYandexUid: function(e) {
            return this._request("post", "save_uid", {
                params: {
                    yandexuid: e
                }
            })
        }
    }),
    function(e) {
        var t = "__" + Date.now() + "eventStorage",
            i = {
                OBSERVABLE_TRIGGER_TIMEOUT: 0,
                trigger: function(e, i) {
                    var n, o, s = this[t] || (this[t] = {});
                    return o = "string" == typeof e ? e : e.type, s[o] || (n = this.__base.bind(this), setTimeout(function() {
                        n.apply(null, s[o]), s[o] = null
                    }, this.OBSERVABLE_TRIGGER_TIMEOUT)), s[o] = [e, i], this
                }
            };
        e.observableAsync = e.inherit(e.observable, i, i)
    }(jQuery),
    function(e, t, i) {
        var n = 500,
            o = ".",
            s = ":",
            r = ",",
            a = "*",
            l = {},
            c = {},
            d = e.MODEL = t.inherit(t.observableAsync, {
                changesTimeout: n,
                __constructor: function(e, i) {
                    return this.name = e.name, this.id = e.id, this._path = d.buildPath(e), this.changed = [], this.fireChange = t.throttle(this._fireChange, this.changesTimeout, this), this.debounceTrigger = t.debounce(function(e, t) {
                        this.trigger(e, t)
                    }, this.changesTimeout, !1, this), this._initFields(i || {}), this
                },
                path: function() {
                    return this._path
                },
                _initFields: function(e) {
                    var n = this.name,
                        o = d.decls[n],
                        s = this;
                    return this.fieldsDecl = o, this.fields = {}, t.each(this.fieldsDecl, function(e, t) {
                        s.fields[e] = d.FIELD.create(e, t, s)
                    }), e && t.each(this.fields, function(t, n) {
                        var o = s.fieldsDecl[t];
                        e && !o.calculate && n.initData(e[t] !== i ? e[t] : o.value)
                    }), this.trigger("init"), this
                },
                _calcDependsTo: function(e, i) {
                    var n = this.fieldsDecl[e],
                        o = this;
                    return n && n.dependsTo && t.each(n.dependsTo, function(e, t) {
                        var n, s = o.fieldsDecl[t],
                            r = o.fields[t];
                        r && s.calculate && s.dependsFrom && (n = s.dependsFrom.length > 1 ? s.dependsFrom.reduce(function(e, t) {
                            return e[t] = o.fields[t].get(), e
                        }, {}) : o.fields[s.dependsFrom[0] || s.dependsFrom].get(), o.set(t, s.calculate.call(o, n), i))
                    }), this
                },
                get: function(e, t) {
                    t || (t = "get");
                    var i = this.fieldsDecl[e],
                        n = {
                            raw: "raw",
                            format: "format",
                            formatted: "format",
                            get: "get"
                        }[t];
                    return this.hasField(e) && n ? i.calculate && !i.dependsFrom ? i.calculate.call(this) : this.fields[e][n]() : void 0
                },
                set: function(e, i, n) {
                    var o = this.fields[e],
                        s = this.fieldsDecl[e];
                    return n = t.extend({}, n, {
                        value: i
                    }), o && s ? (o.isEqual(i) || o[n.isInit ? "initData" : "set"](i, n), this) : this
                },
                clear: function(e, i) {
                    return "string" == typeof e ? this.fields[e].clear(i) : (i = e, t.each(this.fields, function(e, t) {
                        "id" === t.getType() || this.fieldsDecl[e].calculate || t.clear(i)
                    }.bind(this))), this.trigger("clear", i), this
                },
                update: function(e, i) {
                    var n = this;
                    return t.each(e, function(e, t) {
                        n.set(e, t, i)
                    }), this.trigger("update", i), this
                },
                hasField: function(e) {
                    return !!this.fields[e]
                },
                isEmpty: function(e) {
                    if (e) return this.fields[e].isEmpty();
                    var i = !0;
                    return t.each(this.fields, function(e, t) {
                        i &= t.isEmpty()
                    }), !!i
                },
                isChanged: function(e) {
                    if (e) return this.fields[e].isChanged();
                    var i = !1;
                    return t.each(this.fields, function(e, t) {
                        i |= t.isChanged()
                    }), !!i
                },
                getType: function(e) {
                    return this.hasField(e) ? this.fields[e].getType() : void 0
                },
                fix: function(e) {
                    return t.each(this.fields, function(t, i) {
                        i.fixData(e)
                    }), this.trigger("fix", e), this
                },
                rollback: function(e) {
                    return t.each(this.fields, function(t, i) {
                        i.rollback(e)
                    }), this.trigger("rollback", e), this
                },
                toJSON: function() {
                    var e = {},
                        i = this;
                    return t.each(this.fields, function(t, n) {
                        i.fieldsDecl[t].internal || (e[t] = n.toJSON())
                    }), e
                },
                on: function(e, n, o, s, r) {
                    return t.isFunction(n) && (r = s, s = o, o = n, n = e, e = i), e ? e.split(" ").forEach(function(e) {
                        this.fields[e].on(n, o, s, r)
                    }, this) : this.__base(n, o, s, r), this
                },
                un: function(e, n, o, s) {
                    return t.isFunction(n) && (s = o, o = n, n = e, e = i), e ? e.split(" ").forEach(function(e) {
                        this.fields[e].un(n, o, s)
                    }, this) : this.__base(n, o, s), this
                },
                trigger: function(e, t, n) {
                    return ("string" != typeof e || "string" != typeof t) && (n = t, t = e, e = i), e ? e.split(" ").forEach(function(e) {
                        this.fields[e].trigger(t, n)
                    }, this) : this.__base(t, n), this
                },
                _onFieldInit: function(e) {
                    this.fieldsDecl[e.field].calculate || this._calcDependsTo(e.field, e)
                },
                _onFieldChange: function(e) {
                    var t = e.field; - 1 == this.changed.indexOf(t) && this.changed.push(t), this.fieldsDecl[t].calculate || this._calcDependsTo(t, e), this.fireChange(e)
                },
                _fireChange: function(e) {
                    this.trigger("change", e), this.changed = []
                },
                destruct: function() {
                    this.__self.destruct(this)
                },
                isValid: function() {
                    return !!this.validate().valid
                },
                validate: function(e) {
                    var i, n = this,
                        o = {};
                    return e ? (i = this.fields[e].validate(), i !== !0 && (o.errorFields = [e], o.errors = i.invalidRules)) : t.each(this.fieldsDecl, function(e) {
                        i = n.fields[e].validate(), i !== !0 && ((o.errorFields || (o.errorFields = [])).push(e), o.errors = (o.errors || []).concat(i.invalidRules), (o.errorsData || (o.errorsData = {}))[e] = i.invalidRules)
                    }), o.errors ? this.trigger("error", o) : o.valid = !0, this.trigger("validated", o), o
                }
            }, {
                models: {},
                decls: {},
                modelsData: {},
                modelsTriggers: {},
                fieldsTriggers: {},
                decl: function(e, i, n) {
                    if ("string" == typeof e ? e = {
                            model: e
                        } : e.name && (e.model = e.name), t.each(i, function(e, t) {
                            "string" == typeof t && (i[e] = {
                                type: t
                            })
                        }), e.baseModel) {
                        if (!d.models[e.baseModel]) throw 'baseModel "' + e.baseModel + '" for "' + e.model + '" is undefined';
                        i = t.extend(!0, {}, d.decls[e.baseModel], i)
                    }
                    return d.models[e.model] = {}, d.decls[e.model] = i, n && t.each(n, function(e) {
                        if (e in d.prototype) throw new Error('method "' + e + '" is protected')
                    }), c[e.model] = t.inherit(c[e.baseModel] || d, n), d._buildDeps(i, e.model), this
                },
                _buildDeps: function(e, i) {
                    function n(t, o) {
                        t.forEach(function(t) {
                            if (!e[t]) throw Error('in model "' + i + '" depended field "' + t + '" is not declared');
                            if (-1 !== o.indexOf(t)) throw Error('in model "' + i + '" circle fields dependence: ' + o.concat(t).join(" -> "));
                            var r = s[t] || (s[t] = []);
                            r.push.apply(r, o.filter(function(e) {
                                return -1 === r.indexOf(e)
                            })), e[t].dependsFrom && n(e[t].dependsFrom, o.concat(t))
                        })
                    }
                    var o = Object.keys(e),
                        s = {};
                    o.forEach(function(i) {
                        var o = e[i];
                        o.dependsFrom && !t.isArray(o.dependsFrom) && (o.dependsFrom = [o.dependsFrom]), s[i] || o.dependsFrom && n(o.dependsFrom, [i])
                    }), o.forEach(function(t) {
                        s[t] && (e[t].dependsTo = s[t].sort(function(e, t) {
                            return s[t] ? -1 != s[t].indexOf(e) ? 1 : -1 : 0
                        }))
                    })
                },
                create: function(e, i) {
                    "string" == typeof e && (e = {
                        name: e
                    });
                    var n = d.decls[e.name];
                    if (!n) throw new Error('unknown model: "' + e.name + '"');
                    t.each(n, function(t, n) {
                        "id" === n.type && (e.id = i && i[t])
                    }), "undefined" == typeof e.id && (e.id = t.identify());
                    var o = new(c[e.name] || d)(e, i);
                    return d._addModel(o), o.trigger("create", {
                        model: o
                    }), o
                },
                get: function(e, i) {
                    "string" == typeof e && (e = {
                        name: e
                    }), e = t.extend({}, e), "undefined" == typeof e.id && (e.id = a);
                    var n = e.name,
                        o = d.models[n],
                        s = [],
                        c = l[n],
                        u = e.path || d.buildPath(e),
                        h = u.split(r);
                    if (!d.decls[n]) throw 'model "' + n + '" is not declared';
                    if (!i && c && c[u]) return c[u].slice();
                    for (var m = 0, p = h.length; p > m; m++) {
                        var f = d._getPathRegexp(h[m]);
                        for (var g in o) o.hasOwnProperty(g) && null !== o[g] && new RegExp(f, "g").test(g) && s.push(o[g])
                    }
                    return c || (l[n] = {}), l[n][u] = s.slice(), s
                },
                getOne: function(e, t) {
                    return this.get(e, t).pop()
                },
                getOrCreate: function(e) {
                    "string" == typeof e && (e = {
                        name: e
                    });
                    var t = d.modelsData[e.name];
                    return d.getOne(e) || d.create(e, t && t[d.buildPath(e)] || {})
                },
                on: function(e, n, o, s, r) {
                    t.isFunction(o) && (r = s, s = o, o = n, n = i), "string" == typeof e && (e = {
                        name: e
                    });
                    var a = e.name,
                        l = d.buildPath(e),
                        c = n ? (d.fieldsTriggers[a] || (d.fieldsTriggers[a] = {})) && d.fieldsTriggers[a][n] || (d.fieldsTriggers[a][n] = {}) : d.modelsTriggers[a] || (d.modelsTriggers[a] = {});
                    return o.split(" ").forEach(function(e) {
                        (c[e] || (c[e] = [])).push({
                            name: a,
                            path: l,
                            field: n,
                            fn: s,
                            ctx: r
                        })
                    }), d.forEachModel(function() {
                        this.on(n, o, s, r)
                    }, e, !0), this
                },
                un: function(e, n, o, s, r) {
                    t.isFunction(o) && (r = s, s = o, o = n, n = i), "string" == typeof e && (e = {
                        name: e
                    });
                    var a = e.name,
                        l = d.buildPath(e),
                        c = n ? d.fieldsTriggers[a] && d.fieldsTriggers[a][n] : d.modelsTriggers[a];
                    return o.split(" ").forEach(function(i) {
                        var o;
                        c[i] && t.each(c[i], function(e, t) {
                            return t.path === l && t.fn === s && t.ctx === r && t.field === n ? (o = e, !1) : void 0
                        }), "undefined" != typeof o && (c[i].splice(o, 1), d.forEachModel(function() {
                            this.un(i.field, i, s, r)
                        }, e, !0))
                    }), this
                },
                trigger: function(e, t, n, o) {
                    return ("string" != typeof t || "string" != typeof n) && (o = n, n = t, t = i), "string" == typeof e && (e = {
                        name: e
                    }), n.split(" ").forEach(function(i) {
                        d.forEachModel(function() {
                            this.trigger(t, i, o)
                        }, e, !0)
                    }), this
                },
                _bindToModel: function(e) {
                    return this._bindToEvents(e, d.modelsTriggers[e.name])
                },
                _bindToFields: function(e) {
                    var i = this,
                        n = this.fieldsTriggers[e.name];
                    return n && t.each(n, function(t, n) {
                        i._bindToEvents(e, n)
                    }), this
                },
                _bindToEvents: function(e, i) {
                    var n = this;
                    return i && t.each(i, function(t, i) {
                        i.forEach(function(i) {
                            var n = new RegExp(this._getPathRegexp(i.path), "g");
                            n.test(e.path()) && e.on(i.field, t, i.fn, i.ctx)
                        }, n)
                    }), this
                },
                _addModel: function(e) {
                    return d.models[e.name][e.path()] = e, l[e.name] = null, d._bindToModel(e)._bindToFields(e), this
                },
                destruct: function(e) {
                    return "string" == typeof e && (e = {
                        name: e
                    }), e instanceof d && (e = {
                        path: e.path(),
                        name: e.name,
                        id: e.id
                    }), d.forEachModel(function() {
                        t.each(this.fields, function(e, t) {
                            t.destruct()
                        }), d.models[this.name][this.path()] = null, this.trigger("destruct", {
                            model: this
                        })
                    }, e, !0), l[e.name] = null, this
                },
                buildPath: function(e) {
                    if (t.isArray(e)) return e.map(d.buildPath).join(r);
                    var i = {
                        parent: "",
                        child: ""
                    };
                    return ["parent", "child"].forEach(function(t) {
                        var n = e[t + "Path"],
                            o = e[t + "Model"],
                            r = e[t + "Name"],
                            a = e[t + "Id"];
                        i[t] = o && o.path() || ("object" == typeof n ? d.buildPath(n) : n) || (r ? r + ("undefined" != typeof a ? s + a : "") : "")
                    }), (i.parent ? i.parent + o : "") + e.name + s + ("undefined" != typeof e.id ? e.id : a) + (i.child ? o + i.child : "")
                },
                _getPathRegexp: function(e) {
                    return e.replace(new RegExp("\\" + a, "g"), "([^" + o + s + "]*)") + "$"
                },
                forEachModel: function(e, t, i) {
                    var n = d.get(t, i);
                    if (Array.isArray(n))
                        for (var o = 0, s = n.length; s > o && e.call(n[o]) !== !1; o++);
                    return this
                }
            });
        e.DOM.decl("i-model", {
            onSetMod: {
                js: {
                    inited: function() {
                        var e = d.modelsData,
                            t = this.params.data,
                            i = function(t) {
                                var i = e[t.name] || (e[t.name] = {});
                                i[d.buildPath(t)] = t.data
                            };
                        Array.isArray(t) ? t.forEach(i) : i(t)
                    }
                }
            }
        })
    }(BEM, jQuery),
    function(e, t) {
        e.FIELD = t.inherit(t.observable, {
            __constructor: function(e, t) {
                this.params = e || {}, this.model = t, this.name = e.name, this._type = e.type, this._init()
            },
            _trigger: function(e, i) {
                return i = t.extend({}, i, {
                    field: this.name
                }), "init" === e && this.model._onFieldInit ? this.model._onFieldInit(i) : "change" === e && this.model._onFieldChange && this.model._onFieldChange(i), this.model.trigger("field-" + e, i), this.trigger(e, i), this
            },
            _init: function() {
                return this._initDefaults(), this
            },
            _initDefaults: function() {
                return this._default = void 0 !== this.params["default"] ? this.params["default"] : this._default, this._validationRules = this._getValidationRules(), this
            },
            initData: function(e) {
                return this.set(e, {
                    isInit: !0
                }).fixData(), this
            },
            fixData: function() {
                return this._fixedValue = this.get(), this
            },
            rollback: function() {
                return this.set(this._fixedValue, {
                    rollback: !0
                }), this
            },
            set: function(e, t) {
                return t && t.isInit || !this.isEqual(e) ? this._set(e, t) : this
            },
            _set: function(e, t) {
                return this._raw = this.checkEmpty(e) ? this.getDefault() : e, this._value = (this.params.preprocess || this._preprocess).call(this, this._raw), this._formatted = (this.params.format || this._format).call(this, this._value, this.params.formatOptions || {}), t ? t.value = this._value : t = {
                    value: this._value
                }, this._trigger(t.isInit ? "init" : "change", t), this
            },
            clear: function(e) {
                return this.set(void 0, e), this
            },
            get: function() {
                return this._value
            },
            isNaN: function(e) {
                return e != e
            },
            isEqual: function(e) {
                return e = (this.params.preprocess || this._preprocess).call(this, e), e === this.get() || this.isEmpty() && this.checkEmpty(e) || this.isNaN(e) && this.isNaN(this.get())
            },
            checkEmpty: function(e) {
                return void 0 === e || !!(e + "").match(/^\s*$/)
            },
            isChanged: function() {
                return !this.isEqual(this.getFixedValue())
            },
            getFixedValue: function() {
                return "undefined" != typeof this._fixedValue ? this._fixedValue : this.getDefault()
            },
            getDefault: function() {
                return "function" == typeof this._default ? this._default.call(this.model) : this._default
            },
            getType: function() {
                return this._type
            },
            isEmpty: function() {
                return this.checkEmpty(this._raw) || this._raw === this.getDefault()
            },
            raw: function() {
                return this._raw
            },
            format: function() {
                return this._formatted
            },
            _format: function(e, t) {
                return "" + e
            },
            toJSON: function() {
                return this.get()
            },
            _preprocess: function(e) {
                return e
            },
            isValid: function() {
                return this.validate() === !0
            },
            _commonRules: function() {
                var e = this;
                return {
                    required: {
                        value: !0,
                        validate: function(t, i, n) {
                            return e.checkEmpty(t) !== i
                        }
                    }
                }
            },
            _getValidationRules: function() {
                return this._commonRules()
            },
            validate: function() {
                if (!this.params.validation) return !0;
                var e = this,
                    i = function(i, n) {
                        return t.isFunction(i) ? i.call(e.model, e.get(), n, e.name) : i
                    },
                    n = i(this.params.validation),
                    o = [];
                if (i(n.needToValidate) === !1) return !0;
                if (n.validate) {
                    if (i(n.validate)) return !0;
                    var s = {
                        text: i(n.text)
                    };
                    return this._trigger("error", s), {
                        valid: !1,
                        invalidRules: [s]
                    }
                }
                return n.rules && t.each(n.rules, function(n, s) {
                    s = i(s), s = "object" == typeof s ? s : {
                        value: s
                    };
                    var r, a = t.extend({}, e._validationRules[n], s);
                    return i(a.needToValidate) === !1 ? !0 : void(i(a.validate, i(a.value)) || (r = {
                        rule: n,
                        text: i(a.text)
                    }, o.push(r), e._trigger("error", r)))
                }), o.length ? {
                    valid: !1,
                    invalidRules: o
                } : !0
            },
            destruct: function() {}
        }, {
            types: {},
            create: function(t, i, n) {
                return "string" == typeof i && (i = {
                    type: i
                }), i.name = t, new(e.FIELD.types[i.type] || e.FIELD)(i, n)
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types["inner-events-storage"] = t.inherit(e.FIELD, {
            __constructor: function() {
                this._eventHandlers = {}, this.__base.apply(this, arguments)
            },
            _pushEventHandler: function(e, t, i) {
                this._eventHandlers[e] || (this._eventHandlers[e] = []), this._eventHandlers[e].push({
                    name: e,
                    fn: t,
                    ctx: i
                })
            },
            _popEventHandler: function(e, t, i) {
                this._eventHandlers[e] && ("undefined" != typeof t ? this._eventHandlers[e] = this._eventHandlers[e].filter(function(e) {
                    return !(t === e.fn && i === e.ctx)
                }) : delete this._eventHandlers[e])
            },
            _bindFieldEventHandlers: function(e) {
                t.each(this._eventHandlers, function(t, i) {
                    i && i.forEach(function(i) {
                        e.on(t, i.fn, i.ctx)
                    })
                })
            },
            _unBindFieldEventHandlers: function(e) {
                t.each(this._eventHandlers, function(t, i) {
                    i && i.forEach(function(i) {
                        e.un(t, i.fn, i.ctx)
                    })
                })
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.id = t.inherit(e.FIELD, {
            isEmpty: function() {
                return !0
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.string = t.inherit(e.FIELD, {
            _default: "",
            _getValidationRules: function() {
                var e = {
                    value: 1 / 0,
                    validate: function(e, t, i) {
                        return e && e.length <= t
                    }
                };
                return t.extend(this._commonRules(), {
                    maxlength: e,
                    maxLength: e
                })
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.number = t.inherit(e.FIELD, {
            _preprocess: function(e) {
                return this.checkEmpty(e) ? void 0 : e = new Number(e.toString().replace(/[//,.юЮбБ<>]/gi, ".")).valueOf()
            },
            _initDefaults: function() {
                return this._default = void 0 === this.params["default"] ? this._default : this.params["default"], this._precision = void 0 === this.params.precision ? 2 : this.params.precision, this._validationRules = this._getValidationRules(), this
            },
            _format: function(e) {
                return isNaN(e) ? "undefined" != typeof this.getDefault() ? this._toFixed(this["default"]) : "" : this._toFixed(e)
            },
            _toFixed: function(e) {
                var t = Math.pow(10, this._precision);
                return (Math.round(e * t) / t).toFixed(this._precision)
            },
            _getValidationRules: function() {
                return t.extend(this._commonRules(), {
                    max: {
                        value: 1 / 0,
                        validate: function(e, t, i) {
                            return t > e
                        }
                    },
                    min: {
                        value: -(1 / 0),
                        validate: function(e, t, i) {
                            return e > t
                        }
                    },
                    gte: {
                        value: 1 / 0,
                        validate: function(e, t, i) {
                            return t >= e
                        }
                    },
                    lte: {
                        value: -(1 / 0),
                        validate: function(e, t, i) {
                            return e >= t
                        }
                    },
                    type: {
                        value: !0,
                        validate: function(e) {
                            return !isNaN(e)
                        }
                    }
                })
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types["boolean"] = t.inherit(e.FIELD, {
            _preprocess: function(e) {
                return this.checkEmpty(e) ? void 0 : !!("string" == typeof e ? +e : e)
            },
            _format: function(e) {
                return (0 + e).toString()
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.model = t.inherit(e.FIELD.types["inner-events-storage"], {
            initData: function(t) {
                return this._value = e.create({
                    name: this.params.modelName,
                    parentModel: this.model
                }, t), this._initEvents(), this
            },
            _initEvents: function() {
                this._value.on("change", this._onInnerModelChange, this), this._bindFieldEventHandlers(this._value)
            },
            _unBindEvents: function() {
                this._value.un("change", this._onInnerModelChange, this), this._unBindFieldEventHandlers(this._value)
            },
            _onInnerModelChange: function() {
                this._trigger("change", {
                    fields: this._value.changed
                })
            },
            fixData: function() {
                return this._value.fix(), this
            },
            rollback: function() {
                return this._value.rollback(), this
            },
            isChanged: function() {
                return this._value.isChanged()
            },
            set: function(e, t) {
                return this._set(e, t)
            },
            _set: function(t, i) {
                if (t instanceof e) {
                    if (t.name !== this.params.modelName) throw new Error('incorrect model "' + t.name + '", expected model "' + this.params.modelName + '"');
                    this._unBindEvents(), this.params.destruct && i.destruct !== !1 && this._value.destruct(), this._value = t, this._initEvents()
                } else this._value.update(t);
                return this._trigger(i && i.isInit ? "init" : "change", i), this
            },
            clear: function(e) {
                return this._value.clear(e), this
            },
            get: function() {
                return this._value
            },
            toJSON: function() {
                return this._value.toJSON()
            },
            _getValidationRules: function() {
                var e = this;
                return t.extend(this._commonRules(), {
                    deep: {
                        value: !0,
                        validate: function(t, i, n) {
                            return e._value.isValid() == i
                        }
                    }
                })
            },
            on: function(e, t, i) {
                return "change" !== e && (this._pushEventHandler(e, t, i), this._value.on(e, t, i)), this.__base.apply(this, arguments)
            },
            un: function(e, t, i) {
                return this._value.un(e, t, i), this._popEventHandler(e, t, i), this.__base.apply(this, arguments)
            },
            destruct: function() {
                this._unBindEvents(), this.params.destruct && this._value.destruct()
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.model = t.inherit(e.FIELD.types.model, {
            initData: function(t) {
                return t = t || this.getDefault(), t instanceof e ? this._value = t : t && (this._value = e.create({
                    name: this.params.modelName,
                    parentModel: this.model
                }, t)), this._initEvents(), this
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types.array = t.inherit(e.FIELD, {
            _initDefaults: function() {
                return this.__base(), this._default || (this._default = []), this
            },
            raw: function() {
                return this._raw && this._raw.slice()
            },
            fixData: function() {
                return this._fixedValue = this.raw(), this
            },
            _preprocess: function(e) {
                var t = this;
                return e = e.slice(), ["pop", "push", "reverse", "shift", "sort", "splice", "unshift"].forEach(function(i) {
                    var n = e[i];
                    e[i] = function() {
                        var e = Array.prototype.slice.call(arguments),
                            o = n.apply(t._raw, e);
                        return t._set(t._raw), ("push" == i || "unshift" == i) && t.trigger("add", {
                            data: e[0]
                        }), ("pop" == i || "shift" == i) && t.trigger("remove", {
                            data: o
                        }), "splice" == i && t.trigger("add", {
                            data: e.slice(2)
                        }).trigger("remove", {
                            data: o
                        }), t._trigger("change"), o
                    }
                }), ["map", "forEach", "filter", "reduce", "reduceRight", "some", "every", "indexOf"].forEach(function(i) {
                    var n = e[i];
                    e[i] = function() {
                        return n.apply(t._raw, arguments)
                    }
                }), e
            },
            _set: function(e, t) {
                var i = this.getDefault();
                return this._raw = this.checkEmpty(e) ? i && i.slice() : e, this._value = (this.params.preprocess || this._preprocess).call(this, this._raw && this._raw.slice()), this._formatted = (this.params.format || this._format).call(this, this._value && this._value.slice(), this.params.formatOptions || {}), t && (t.value = this._value), this._trigger(t && t.isInit ? "init" : "change", t), this
            },
            checkEmpty: function(e) {
                return t.isEmptyObject(e) || 0 == e.length
            },
            isEmpty: function() {
                return this.checkEmpty(this._raw) || this.isEqual(this.getDefault())
            },
            _format: function(e, t) {
                return e
            },
            isEqual: function(e) {
                var t = this._raw,
                    i = t && Array.isArray(e) && e.length === t.length && Array.prototype.every.call(e, function(e, i) {
                        return t[i] === e
                    });
                return i
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types["models-list"] = t.inherit(e.FIELD.types["inner-events-storage"], {
            initData: function(e) {
                return this.params["default"] || (this.params["default"] = []), this._raw = [], this._value = this._createValueObject(this), this.__base(e || this.params["default"]), this
            },
            _trigger: function(e, i) {
                var n = i && i.field;
                return this.__base(e, t.extend({
                    innerField: n
                }, i))
            },
            _createValueObject: function(i) {
                var n = this,
                    o = {
                        _createModel: function(n) {
                            var s = n instanceof e ? n : e.create({
                                name: i.params.modelName,
                                parentModel: i.model
                            }, n);
                            return s.on("change", function(e, n) {
                                i._trigger("change", t.extend({
                                    data: s,
                                    model: s
                                }, n))
                            }).on("destruct", function(e, t) {
                                o.remove(t.model.id)
                            }), s
                        },
                        add: function(e, s) {
                            var r = o._createModel(e);
                            return i._raw.push(r), n._bindFieldEventHandlers(r), i.trigger("add", t.extend({}, s, {
                                model: r
                            }))._trigger("change", s), r
                        },
                        addByIndex: function(e, n, s) {
                            var r = o._createModel(n);
                            return i._raw.splice(e, 0, r), i.trigger("add", t.extend({}, s, {
                                model: r,
                                index: e
                            }))._trigger("change", s), r
                        },
                        remove: function(e, s) {
                            var r = o._getIndex(e);
                            if (s || (s = {}), "undefined" != typeof r) {
                                var a = o.getByIndex(r);
                                i._raw.splice(r, 1), n._unBindFieldEventHandlers(a), i.trigger("remove", t.extend({}, s, {
                                    model: a
                                })), s.keepModel !== !0 && a.destruct(), i._trigger("change", s)
                            }
                        },
                        clear: function(e) {
                            var t = i._raw.slice();
                            t.forEach(function(t) {
                                o.remove(t.id, e)
                            }), e && e.silent || i._trigger("change", e)
                        },
                        getById: function(e) {
                            return o.getByIndex(o._getIndex(e))
                        },
                        _getIndex: function(e) {
                            var t;
                            return i._raw.some(function(i, n) {
                                return i.id == e ? (t = n, !0) : void 0
                            }), t
                        },
                        getByIndex: function(e) {
                            return i._raw[e]
                        },
                        where: function(e) {
                            return t.isEmptyObject(e) || !e ? [] : o.filter(function(t) {
                                return Object.keys(e).every(function(i) {
                                    return e[i] === t.get(i)
                                })
                            })
                        },
                        length: function() {
                            return i._raw.length
                        }
                    };
                return ["map", "forEach", "filter", "reduce", "reduceRight", "some", "every", "indexOf"].forEach(function(e) {
                    var t = i._raw[e];
                    o[e] = function() {
                        return t.apply(i._raw, arguments)
                    }
                }), e.on({
                    name: i.params.modelName,
                    parentModel: i.model
                }, "create", function(e, t) {
                    setTimeout(function() {
                        t.model && void 0 === o._getIndex(t.model.id) && o.add(t.model)
                    }, 0)
                }), o
            },
            fixData: function() {
                return this._fixedValue = this._raw.map(function(e) {
                    return e.toJSON()
                }, this), this
            },
            isChanged: function() {
                return this._value.some(function(e) {
                    return e.isChanged()
                })
            },
            set: function(e, t) {
                return this._set(e, t)
            },
            _set: function(e, t) {
                return this._value.clear({
                    silent: !0
                }), this._raw = e.map(function(e) {
                    return this._value.add(e)
                }, this), this._trigger(t && t.isInit ? "init" : "change", t), this
            },
            on: function(e, t, i) {
                "change" !== e && (this._pushEventHandler(e, t, i), this._raw.forEach(function(n) {
                    n.on(e, t, i)
                })), this.__base.apply(this, arguments)
            },
            un: function(e, t, i) {
                this._raw.forEach(function(n) {
                    n.un(e, t, i)
                }, this), this._popEventHandler(e, t, i), this.__base.apply(this, arguments)
            },
            clear: function(e) {
                return this._value.clear(e), this
            },
            toJSON: function() {
                return this._raw.map(function(e) {
                    return e.toJSON()
                }, this)
            },
            destruct: function() {
                this.clear()
            }
        })
    }(BEM.MODEL, jQuery),
    function(e, t) {
        e.FIELD.types["models-list"] = t.inherit(e.FIELD.types["models-list"], {
            isChanged: function() {
                return this._value.length() !== this._fixedValue.length || this._value.some(function(e) {
                    return e.isChanged()
                })
            }
        })
    }(BEM.MODEL, jQuery), BEM.MODEL.decl("m-persistent-legacy", {
        isNew: {
            type: "boolean",
            "default": !0,
            internal: !0
        },
        isDeleted: {
            type: "boolean",
            "default": !1,
            internal: !0
        }
    }, {
        isNew: function() {
            return this.get("isNew")
        },
        isDeleted: function() {
            return this.get("isDeleted")
        },
        remove: function() {
            this.isNew() ? this.destruct() : this.set("isDeleted", !0)
        },
        restore: function() {
            this.set("isDeleted", !1)
        },
        save: function() {
            return this.isDeleted() ? this.isNew() ? Vow.promise(null) : this._remove().then(function(e) {
                return this.destruct(), e
            }.bind(this)) : this.isNew() ? this._create().then(function(e) {
                return this.trigger("replace", {
                    oldModel: this,
                    newModel: BEM.MODEL.create(this.name, $.extend({
                        isNew: !1
                    }, e))
                }), this.destruct(), e
            }.bind(this)) : this._update()
        },
        _create: function() {
            throw "Not Implemented"
        },
        _update: function() {
            throw "Not Implemented"
        },
        _remove: function() {
            throw "Not Implemented"
        }
    }),
    function() {
        var e = 100;
        BEM.MODEL.decl({
            model: "m-label",
            baseModel: "m-persistent-legacy"
        }, {
            id: {
                type: "id"
            },
            name: {
                type: "string",
                format: function(e) {
                    return BN("i-string").escapeHTML(e)
                }
            },
            favorite: "boolean",
            numCounters: {
                type: "number",
                "default": 0,
                precision: 0
            },
            totalNumCounters: {
                type: "number",
                "default": 0,
                precision: 0
            },
            system: {
                type: "boolean",
                "default": !1
            },
            selected: {
                type: "boolean",
                "default": !1
            }
        }, {
            hasChanges: function() {
                var e = !1;
                return $.each(this.fields, function(t, i) {
                    "selected" !== t && (e |= i.isChanged())
                }), Boolean(e)
            },
            checkNumCountersLimit: function() {
                var t, i = null;
                return !this.get("system") && this.get("totalNumCounters") >= e && (t = BN("i-error-message").MetrikaError, i = new t("ERR_COUNTER_LABELS_LIMIT_EXCEEDED")), i
            },
            _remove: function() {
                return BN("i-labels").remove(this.get("id"))
            },
            _create: function() {
                return BN("i-labels").create({
                    name: this.get("name")
                }).then(function(e) {
                    return this.get("favorite") ? BN("i-labels").markFavorite(e.id, !0).then(function() {
                        return e.favorite = !0, e
                    }) : e
                }.bind(this))
            },
            _update: function() {
                var e = [];
                return this.isChanged("favorite") && e.push(this._getUpdatePromise("favorite", BN("i-labels").markFavorite(this.get("id"), this.get("favorite")))), this.isChanged("name") && e.push(this._getUpdatePromise("name", BN("i-labels").update(this.get("id"), {
                    name: this.get("name")
                }))), Vow.all(e)
            },
            _getUpdatePromise: function(e, t) {
                var i = this.fields[e];
                return t.then(function() {
                    i.fixData()
                }).fail(function() {
                    i.rollback(), this.trigger("error", {
                        field: e
                    })
                }.bind(this))
            }
        })
    }(), BEM.decl("i-string", null, {
        escapeHTML: function(e) {
            return String([e].join()).replace(/[&<>"']/g, function(e) {
                return {
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#39;"
                }[e] || e
            })
        },
        escapeAttr: function(e) {
            return e.replace('"', "&#34;")
        },
        escapeBemJson: function(e) {
            return "object" == typeof e ? e : this.escapeHTML(e)
        },
        stripTags: function(e) {
            return e.replace(/<\/?[^>]+>/gi, "")
        },
        hellipCut: function(e, t, i) {
            return e && e.length > t + 1 ? e.substr(0, t).replace(/\s+$/, "") + (i || "&hellip;") : e
        }
    }),
    function() {
        var e = 8;
        BEM.MODEL.decl("m-labels", {
            labels: {
                type: "models-list",
                modelName: "m-label"
            }
        }, {
            remove: function(e) {
                var t = this.get("labels").getById(e);
                t.remove(), this.trigger("labels", "remove", {
                    model: t
                })
            },
            restore: function(e) {
                var t = this.get("labels").getById(e);
                t.restore(), this.trigger("labels", "restore", {
                    model: t
                })
            },
            save: function() {
                return Vow.all(this.get("labels").map(function(e) {
                    return e.save()
                })).then(function() {
                    this.fix()
                }.bind(this))
            },
            isExistsLabelWithName: function(e) {
                return this.get("labels").where({
                    name: e
                }).length > 0
            },
            canAddFavorite: function() {
                return this.get("labels").where({
                    favorite: !0
                }).length < e
            },
            selectLabel: function(e) {
                var t = this.get("labels").where({
                    id: e
                });
                t[0] && !t[0].get("selected") && (this.get("labels").some(function(i) {
                    i.get("id") === e ? (t = i, i.set("selected", !0).fields.selected.fixData()) : i.set("selected", !1).fields.selected.fixData()
                }), this.trigger("select", t))
            },
            getSelectedLabel: function() {
                return this.get("labels").where({
                    selected: !0
                }).pop()
            },
            hasChanges: function() {
                return this.fields.labels._value.length() !== this.fields.labels._fixedValue.length || this.get("labels").some(function(e) {
                    return e.hasChanges()
                })
            }
        })
    }(), BEM.MODEL.decl("m-counter-labels", {
        id: "id",
        labels: {
            type: "models-list",
            modelName: "m-label"
        }
    }, {
        add: function(e, t) {
            return this._updateList(e, !0, t)
        },
        remove: function(e, t) {
            return this._updateList(e, !1, t)
        },
        removeAllUserLabels: function(e) {
            return Vow.all(this.get("labels").filter(function(e) {
                return !e.get("system")
            }).map(function(t) {
                return this.remove(t.id, e)
            }, this))
        },
        _updateList: function(e, t, i) {
            var n, o = this.get("id");
            return n = i ? Vow.promise(!0) : "chosen" === e ? BN("i-counters-api").choose(o, t).then(function() {
                BEM.blocks["counter-chosen"].trigger("choose", {
                    id: o,
                    favorite: t
                })
            }) : BN("i-counters-api").assignLabel(o, e, t), n.then(function() {
                var i = BEM.MODEL.getOne({
                        name: "m-label",
                        id: e
                    }),
                    n = t ? 1 : -1;
                i.set("numCounters", i.get("numCounters") + n).set("totalNumCounters", i.get("totalNumCounters") + n).fix(), t ? this.get("labels").add(i) : this.get("labels").remove(e, {
                    keepModel: !0
                })
            }.bind(this))
        }
    }),
    function() {
        var e = function(e) {
            return function() {
                return e.apply(this, arguments).then(function(e) {
                    return BN("i-proxy").cleanCache("i-counters-api", ["simpleLoad", "getList"]), e
                })
            }
        };
        BN.addDecl("i-labels").staticProp(BN("i-proxy").initProxy("i-labels", ["getList", "_create", "_remove", "_update", "markFavorite"])).staticProp({
            SYSTEM_COUNTER_TYPES: ["partner", "guest", "chosen", "deleted"],
            isUserLabel: function(e) {
                return -1 === BN("i-labels").SYSTEM_COUNTER_TYPES.concat("own", "all").indexOf(e)
            },
            sortLabelsUsersFirst: function(e) {
                return e.sort(function(e, t) {
                    var i = this.isUserLabel(e.id),
                        n = this.isUserLabel(t.id);
                    return i || n ? i ? n ? Number(t.id) - Number(e.id) : -1 : 1 : 0
                }.bind(this))
            },
            create: e(function() {
                return this._create.apply(this, arguments)
            }),
            update: e(function() {
                return this._update.apply(this, arguments)
            }),
            remove: e(function() {
                return this._remove.apply(this, arguments)
            })
        }).done()
    }(), BEM.DOM.decl("i-labels", {
        onSetMod: {
            js: function() {
                var e = this.params.labels,
                    t = this.params.counters;
                this.__self.initLabelsModels(e), this.__self.initCountersLabelsModels(t)
            }
        }
    }, {
        destruct: function() {
            BEM.MODEL.un("m-label", "replace", this._onLabelReplace, this), this.__base.apply(this, arguments)
        },
        initLabelsModels: function(e) {
            e && (this._labels = BEM.MODEL.create("m-labels", {
                labels: e
            }), BEM.MODEL.on("m-label", "replace", this._onLabelReplace, this))
        },
        initCountersLabelsModels: function(e) {
            e && e.forEach(function(e) {
                var t = BEM.MODEL.create("m-counter-labels", {
                    id: e.id
                });
                e.labels && e.labels.forEach(function(e) {
                    t.get("labels").add(BEM.MODEL.getOne({
                        name: "m-label",
                        id: e.id
                    }))
                })
            })
        },
        _onLabelReplace: function(e, t) {
            this._labels.remove(t.oldModel.get("id")), this._labels.get("labels").add(t.newModel), this._labels.fix()
        }
    }), BEM.decl({
        name: "i-counters-group",
        baseBlock: "i-counters"
    }, {
        onSetMod: {
            js: function() {
                this._label = this.params.label, this._counters = this.params.counters, this._ids = this._counters.map(function(e) {
                    return e.id
                })
            }
        },
        isSingle: function() {
            return !1
        },
        isGroup: function() {
            return !0
        },
        isDeleted: function() {
            return !1
        },
        isPublic: function() {
            return !1
        },
        isPublicAccessible: function() {
            return !1
        },
        getId: function() {
            return this._label.id
        },
        getApiCounterId: function() {
            return this._ids.join(",")
        },
        getName: function() {
            return this._label.name || this._label.id
        },
        getUiType: function() {
            return "group"
        },
        needRedraw: function(e) {
            return Number(e.group_id) !== this._label.id || void 0 !== e.counter_id && null !== e.counter_id
        },
        getParams: function() {
            return {
                group_id: this._label.id,
                counter_id: null
            }
        },
        getPermissions: function() {
            return this.params.permissions
        },
        getGoals: function() {
            return []
        }
    }), BEM.decl("i-counters-group", null, BN("i-proxy").initProxy("i-counters-group", ["loadData", "getPermissions"])), BEM.decl({
        name: "i-counters-group"
    }, null, {
        create: function(e) {
            return this.loadData(e).then(function(e) {
                return BEM.create({
                    block: "i-counters-group"
                }, e)
            }.bind(this))
        }
    }), BEM.decl({
        name: "i-counter-global",
        baseBlock: "i-counters"
    }, {}, BN("i-proxy").initProxy("i-counter-global", ["_loadData"])), BEM.decl("i-counter-global", {
        isSingle: function() {
            return !1
        },
        isGroup: function() {
            return !0
        },
        isGlobal: function() {
            return !0
        },
        isDeleted: function() {
            return !1
        },
        isPublicAccessible: function() {
            return !1
        },
        isPublic: function() {
            return !1
        },
        getId: function() {
            return this.params.id
        },
        getApiCounterId: function() {
            return this.params.id
        },
        getName: function() {
            return BEM.I18N("i-counter-global", "counter-name")
        },
        getGoals: function() {
            return []
        },
        needRedraw: function(e) {
            return Number(e.counter_id) !== this.params.id
        },
        getParams: function() {
            return {
                counter_id: this.params.id,
                group_id: null
            }
        },
        getGrants: function() {
            return this.params.grants
        },
        getPermissions: function() {
            return this.params.permissions
        }
    }, {
        GLOBAL_COUNTER_UID: 0,
        create: function(e) {
            return this._loadData(e).then(function(e) {
                return BEM.create({
                    block: this._name
                }, e)
            }.bind(this))
        },
        isGlobal: function(e) {
            return String(e) === String(this.GLOBAL_COUNTER_UID)
        }
    }), BEM.decl("i-request-id", null, {
        gen: function() {
            return Math.round(1e10 * Math.random()).toString(36)
        }
    }), BEM.decl({
        name: "i-legacy-data",
        baseBlock: "i-stat-data"
    }, null, BEM.blocks["i-proxy"].initProxy("i-legacy-data", ["_loadData*"])), BEM.decl("i-legacy-data", null, {
        loadData: function(e) {
            return this._assignPreset(e).then(this.__base.bind(this))
        },
        getReportOptions: function() {
            return this.__base.apply(this, arguments).then(this._assignPreset.bind(this))
        },
        _assignPreset: function(e) {
            return e.hasOwnProperty("preset") ? Vow.fulfill(e) : BN("i-report").getMetadata().then(function(t) {
                return e.preset = t.getPresetName(), e
            })
        }
    }), BEM.decl({
        block: "i-legacy-data-api",
        baseBlock: "i-stat-data-api"
    }),
    function(e, t) {
        function i(t, i) {
            var n = t;
            return e.isFunction(n) || (n = e.isFunction(n = i[t]) ? n : null), n && n.bind(i)
        }

        function n(e, t) {
            return i(e, t) || new Function("value", 'this["' + e.replace(/\./g, '"]["') + '"] = value;').bind(t)
        }

        function o(e, t) {
            return i(e, t) || new Function('return this["' + e.replace(/\./g, '"]["') + '"];').bind(t)
        }

        function s(e, t, i, n) {
            "string" == typeof e ? e = [e] : e && !Array.isArray(e) && (t = e, e = null), (e || Object.keys(t[l] || {})).forEach(function(e) {
                i(e, t, n)
            })
        }
        var r, a, l = "__" + Number(new Date) + "binding",
            c = t.channel(l),
            d = {};
        a = e.inherit({}, {
            getBinding: function(e, t) {
                var i = d[e];
                return !i && t && (i = d[e] = new this.Binding({
                    name: e
                })), i
            },
            getBinder: function(t, i) {
                var n, o, s, r = i[l] || (i[l] = {}),
                    a = r[t];
                if (!a && (a = new this.Binder({
                        name: t
                    }), n = e.identify(a), o = this.getBinding(t, !0), r[t] = o.binders[n] = a, t.indexOf(".") > -1))
                    for (r = t.split(".");
                        (t = r.pop()) && r.length;) s = r.join("."), this.getBinder(s, i), this.getBinding(s).addProp(t);
                return a
            },
            unbindFromData: function(t, i) {
                var n = a.getBinding(t),
                    o = i[l] || {},
                    s = o[t] || {};
                delete n.binders[e.identify(s)], delete o[t], s.event && i.un(s.event, s.eventListener, s), s.set && c.un(t, s.dataListener, s), Object.keys(n.binders).length || (delete d[t], t.indexOf(".") > -1 && (o = t.split("."), t = o.pop(), (n = a.getBinding(o.join("."))) && n.removeProp(t)))
            },
            suspendBinding: function(e, t, i) {
                var n = (t[l] || {})[e];
                n && (n.suspended = i)
            },
            prepareDataBindings: function(t, i, n) {
                var o, s;
                i && i.dataBindings && (o = i.dataBindings, delete i.dataBindings, i._getDataBindings = function() {
                    return Object.keys(o).reduce(function(t, i) {
                        return "string" == typeof o[i] && (o[i] = {
                            accessor: o[i]
                        }), t[i] = e.extend(t[i], o[i]), t
                    }, this.__base() || {})
                }), n && n.dataBindings && (s = n.dataBindings, delete n.dataBindings, n._getDataBindings = function() {
                    return s
                })
            },
            createDataBindings: function(e) {
                e._getDataBindings && (e.bindToData(e._getDataBindings()), e._getDataBindings = !1)
            },
            runInitAccessor: function(n, o, s) {
                var r, a, l = o.initAccessor,
                    c = n.name,
                    d = t.dataBindVal(c);
                (r = i(l, s)) ? a = r(d, n.nameSufix, c): "string" == typeof l && (a = l.split(".").reduce(function(e, t, i, n) {
                    return i === n.length - 1 ? void 0 === e[t] ? e[t] = d : e[t] : e[t] || (e[t] = {})
                }, s)), void 0 === a || e.equals(a, d) || t.dataBindVal(c, a)
            },
            createGetter: function(e, t, i) {
                var n = t.get || t.accessor;
                n && (e.get = o(n, i)), i.on(e.event = t.event, e.eventListener, e)
            },
            createSetter: function(e, t, i) {
                e.set = n(t.set || t.accessor, i), c.on(e.name, e.dataListener, e)
            },
            Binding: function(t) {
                this.value = null, this.binders = {}, this.props = {}, e.extend(this, t)
            },
            Binder: function(t) {
                var i, n = t.name;
                this.nameSufix = (i = n.lastIndexOf(".")) > 0 ? n.slice(i + 1) : n, e.extend(this, t)
            }
        }), a.Binding.prototype = {
            addProp: function(t) {
                this.ns || (this.ns = !0, this.trigger = e.debounce(this.trigger, 50, this)), this.props[t] || (a.getBinding(this.name + "." + t).set(this.get(t), !0), this.props[t] = !0)
            },
            removeProp: function(e) {
                delete this.props[e]
            },
            trigger: function() {
                d[this.name] && c.trigger(this.name, this.get())
            },
            get: function(e) {
                var t = JSON.parse(this.value),
                    i = this.name;
                return e ? (t = (t || {})[e], void 0 === t ? null : t) : (this.ns && (t = t || {}, Object.keys(this.props).forEach(function(e) {
                    t[e] = a.getBinding(i + "." + e).get()
                }, this)), t)
            },
            set: function(t, i) {
                var n, o = this.name;
                if (!e.equals(this.get(), t) && (this.value = JSON.stringify(t), this.ns && (t = t || {}, Object.keys(this.props).forEach(function(e) {
                        a.getBinding(o + "." + e).set(void 0 === t[e] ? null : t[e], i)
                    })), !i))
                    for (this.trigger();
                        (n = o.lastIndexOf(".")) > 0;) o = o.slice(0, n), a.getBinding(o).trigger()
            }
        }, a.Binder.prototype = {
            eventListener: function(e, i) {
                this.suspended !== !0 && (this.suspended = !0, i = this.get ? this.get(void 0, this.nameSufix, this.name) : i, t.dataBindVal(this.name, i), this.suspended = !1)
            },
            dataListener: function(e, t) {
                this.suspended !== !0 && this.set(t, this.nameSufix, this.name)
            }
        }, r = {
            bindToData: function(e, t, i) {
                var n;
                return "string" == typeof e && t ? (i = i || this, n = a.getBinder(e, i), "object" != typeof t && (t = {
                    accessor: t
                }), t.initAccessor && a.runInitAccessor(n, t, i), !n.event && t.event && a.createGetter(n, t, i), n.set || !t.set && !t.accessor || a.createSetter(n, t, i)) : "object" == typeof e && Object.keys(e).forEach(function(n) {
                    this.bindToData(n, e[n], i || t)
                }, this), this
            },
            unbindFromData: function(e, t) {
                return s(e, t || this, a.unbindFromData), this
            },
            dataBindVal: function(i, n, o) {
                var s;
                if ("string" != typeof i) return Object.keys(i).forEach(function(e) {
                    t.dataBindVal(e, i[e], n)
                }), this;
                if (s = a.getBinding(i), void 0 === n) return s ? s.get() : n;
                if (!s) throw 'Data bind "' + i + '" is undefined';
                return o && (n = e.extend(this.dataBindVal(i), n)), s.set(n), this
            },
            suspendDataBind: function(e, t, i) {
                return s(t, i || this, a.suspendBinding, void 0 === e ? !0 : Boolean(e)), this
            }
        }, e.inheritSelf(t, e.extend({
            _init: function() {
                var e = this.__base.apply(this, arguments);
                return a.createDataBindings(this), e
            },
            destruct: function() {
                return this.unbindFromData(), this.__base.apply(this, arguments)
            }
        }, r), e.extend({
            _dataBinding: a,
            decl: function() {
                var e;
                return a.prepareDataBindings.apply(this, arguments), e = this.__base.apply(this, arguments), a.createDataBindings(e), e
            }
        }, r))
    }(jQuery, BEM), BEM.decl("i-bem__dom", {
        destruct: function() {
            return this.unbindFromData(), this.__base.apply(this, arguments)
        }
    }, ["bindToData", "unbindFromData", "dataBindVal", "suspendDataBind", "decl"].reduce(function(e, t) {
        return e[t] = BEM[t], e
    }, {})), BEM.decl("i-metadata", {
        load: function() {
            return this.setMod("ready", "yes"), Vow.fulfill(this)
        },
        clonePreset: function() {
            throw new Error("method must be implemented")
        },
        getReportId: function() {
            return this.params.report.getId()
        },
        resetToDefaults: function() {},
        _publishChanges: function() {}
    }, {
        isPercentile: function(e) {
            return "percents" === e.type
        },
        cleanOutPreset: function() {
            throw new Error("method must be implemented")
        }
    }), BEM.decl("i-metadata", {
        onSetMod: {
            ready: {
                yes: function() {
                    this.bindToData(this._getDataBindingsDecl()), this._publishChanges()
                }
            }
        },
        _getDataBindingsDecl: function() {
            return {}
        },
        _publishChanges: function() {
            this.trigger("change")
        }
    }), BEM.decl({
        name: "i-report-metadata",
        baseBlock: "i-metadata"
    }, {
        DEFAULT_SELECTED_ROWS: 10,
        _metrics: null,
        _defaultMetrics: null,
        _dimensions: null,
        _defaultDimensions: null,
        _dimensionsMetaTable: null,
        _tree: null,
        _goal: null,
        getMetricMeta: function(e) {
            return this._metricsIndex[e]
        },
        getMetrics: function() {
            return (this._metrics || []).slice(0)
        },
        getDefaultSelectedMetric: function() {
            return this.getMetrics()[0]
        },
        getMetricsMeta: function(e) {
            return e ? this._buildFlatMetadata(e, this._metricsIndex) : (this._metricsMeta || (this._metricsMeta = this._buildFlatMetadata(this._metrics || [], this._metricsIndex)), this._metricsMeta)
        },
        getDimensionMeta: function(e) {
            return this._dimensionsIndex[e]
        },
        getDimensions: function() {
            return (this._dimensions || []).slice(0)
        },
        getVisibleDimensions: function() {
            return this.getDimensions().filter(this._isVisibleDimension, this)
        },
        getVisibleDimensionsMeta: function() {
            return this.getDimensionsMeta.apply(this, arguments).filter(function(e) {
                return this._isVisibleDimension(e.dim)
            }, this)
        },
        getDimensionsMeta: function(e) {
            return e ? this._buildFlatMetadata(e, this._dimensionsIndex) : (this._dimensionsMeta || (this._dimensionsMeta = this._buildFlatMetadata(this._dimensions || [], this._dimensionsIndex)), this._dimensionsMeta)
        },
        getDefaultDimensions: function() {
            return this._defaultDimensions.slice(0)
        },
        getPresetName: function() {
            return this.params.preset || this.params.report.getPreset()
        },
        getReport: function() {
            return this.params.report
        },
        constructorAllowed: function() {
            throw new Error("must be implemented in child/mod")
        },
        goalModeAllowed: function() {
            throw new Error("must be implemented in child/mod")
        },
        getGoal: function() {
            return this._goal
        },
        setGoal: function() {
            throw new Error("must be implemented in child/mod")
        },
        validateSortDirection: function(e, t) {
            var i;
            return t !== !1 && (i = this.defaultSortDirection()), this._validateSortDirection(e, i)
        },
        defaultSortDirection: function() {
            var e = BN("i-data-table").parseSortDirection(this._preset.sort);
            return e && this._validateSortDirection(e) ? e : (e || (e = BN("i-util").arrayFind(this.getMetricsMeta(), function(e) {
                return e.allow_sort
            })), e ? this._validateSortDirection({
                metrics: e.metrics,
                direction: "cba"
            }, null) : null)
        },
        getCountMetric: function() {
            throw new Error("must be implemented in child/mod")
        },
        validateMetricFilter: function() {
            throw new Error("must be implemented in child/mod")
        },
        validateMetricsList: function() {
            throw new Error("must be implemented in child/mod")
        },
        getSegmentsTree: function() {
            return this._tree
        },
        getPresetFilter: function() {
            throw new Error("must be implemented in child/mod")
        },
        getPresetFilterWithGoal: function() {
            throw new Error("must be implemented in child/mod")
        },
        hasDirectClientParam: function() {
            return !1
        },
        hasCurrencyAttr: function() {
            return !1
        },
        clonePreset: function() {
            return jQuery.extend({}, this._preset, {
                _profile: null
            })
        },
        getDefaultSelectedRowsLimit: function() {
            return this.DEFAULT_SELECTED_ROWS
        },
        isInternalAttribute: function(e) {
            return this.__self.isInternalAttribute(e)
        },
        resetToDefaults: function() {
            this.setGoal(null), this.setMetrics(this.getDefaultMetrics()), this.setDimensions(this.getDefaultDimensions())
        },
        areMetricsCompatible: function(e) {
            return this._checkCompatibilityBySubtable(this.getMetricsMeta(e))
        },
        areDimensionsCompatible: function(e) {
            return this._checkCompatibilityBySubtable(this.getDimensionsMeta(e))
        },
        _init: function() {
            return this._metricsMeta = null, this._dimensionsMeta = null, this._metricsIndex = {}, this._dimensionsIndex = {}, this.__base.apply(this, arguments)
        },
        _checkCompatibilityBySubtable: function(e) {
            var t = e.reduce(function(e, t) {
                return t.sub_table && (e[t.sub_table] = !0), e
            }, {});
            return Object.keys(t).length <= 1
        },
        _buildFlatMetadata: function(e, t) {
            return e.map(function(e) {
                return t[e]
            })
        },
        _parseSortDirection: function(e) {
            return e ? "-" === e[0] ? (e = e.slice(1), {
                metrics: e,
                direction: "cba"
            }) : {
                metrics: e,
                direction: "abc"
            } : void 0
        },
        _validateSortDirection: function() {
            throw new Error("must be implemented in child/mod")
        },
        _isVisibleDimension: function() {
            return !0
        },
        _buildIndexFromList: function(e, t) {
            return e.reduce(function(e, t) {
                return e[t.dim] = t, e
            }, t || {})
        },
        _parseMetricName: function(e) {
            return e = e.split(":"), 3 !== e.length ? !1 : {
                namespace: e[0],
                table: e[1],
                metric: e[2]
            }
        },
        _stingifyMetricName: function(e) {
            return [e.namespace, e.table, e.metric].join(":")
        },
        _metricToGoalMetric: function(e) {
            var t;
            return this._isGoalCompatibleAttr(e) ? e : (t = this._parseMetricName(e)) ? (t.metric = "goal<goal_id>" + t.metric, this._stingifyMetricName(t)) : e
        },
        _goalMetricToMetric: function(e) {
            var t;
            return this._isGoalCompatibleAttr(e) && (t = this._parseMetricName(e)) ? (t.metric = t.metric.replace("goal<goal_id>", ""), this._stingifyMetricName(t)) : e
        },
        _isGoalCompatibleAttr: function(e) {
            var t = this._metricsIndex[e];
            return t && t.disallows_goal ? !0 : (e = this._parseMetricName(e), e.metric && Boolean(e.metric.match(/^goal<goal_id>/)))
        },
        _metricToCurrentGoalMode: function(e) {
            return this._isGoalCompatibleAttr(e) !== Boolean(this._goal) ? this[this._goal ? "_metricToGoalMetric" : "_goalMetricToMetric"](e) : e
        }
    }, {
        isInternalAttribute: function(e) {
            return "internal" === e.permission_scope
        },
        getMetadataInfo: function() {
            throw new Error("must be implemented in child/mod")
        },
        _buildUrlParam: function(e, t) {
            return jQuery.equals(t, e) ? null : (t || []).join(",")
        }
    }), BEM.decl("i-report-metadata", {
        GOAL_DIMENSION: "ym:s:goalDimension",
        getGoalDimension: function() {
            var e = this.GOAL_DIMENSION;
            return this.getDimensionMeta(e) ? e : null
        }
    }), BEM.decl({
        name: "i-legacy-metadata",
        baseBlock: "i-report-metadata"
    }, null, BN("i-proxy").initProxy("i-legacy-metadata", ["_loadMetadataInfo*"])), BEM.decl("i-legacy-metadata", {
        load: function() {
            var e = this.params.report,
                t = this.params.preset,
                i = this.params.initials && this.params.initials.goal,
                n = this.__self;
            return BN("i-counters").getAsync().then(function(o) {
                return Vow.all([o, BN("i-goal").getGoal(i), n.getMetadataInfo(t), o.isSingle() && e.isGoalRequired() && o.getGoals()])
            }).spread(function(t, i, n, o) {
                return this._isCounterSingle = t.isSingle(), this._preset = n, this._metrics = n.metrics, this._dimensions = n.dimensions, this._metricsIndex = this._buildIndexFromList(n.meta.metrics), this._dimensionsIndex = this._buildIndexFromList(n.meta.dimensions), this._tree = BEM.create("i-segment-tree"), !i && e.isGoalRequired() && o.length && (i = o[0]), this.setGoal(i && i.id), this.setMod("ready", "yes"), this
            }.bind(this))
        },
        constructorAllowed: function() {
            return !1
        },
        goalModeAllowed: function() {
            return this._isCounterSingle && this._preset.enable_goal !== !1
        },
        setGoal: function(e) {
            return this.goalModeAllowed() ? (Boolean(e) !== Boolean(this._goal) && (this._metricsMeta = null), this._goal = e, e ? this._metrics = this._preset.goal_metrics || this._preset.metrics : this._metrics = this._preset.metrics, void this._publishChanges()) : this._goal = null
        },
        getCountMetric: function() {
            return this.getMetrics()[0]
        },
        validateMetricFilter: function() {
            return !1
        },
        getPresetFilter: function() {
            ""
        },
        getPresetFilterWithGoal: function() {
            return ""
        },
        validateMetricsList: function(e) {
            return BN("i-util").arrayIntersect(e, this.getMetrics())
        },
        getDefaultDimensions: function() {
            return this.getDimensions()
        },
        _validateSortDirection: function(e, t) {
            var i, n;
            return e ? (i = e.metrics, this._metricsIndex[i] && -1 === this.getMetrics().indexOf(i) && (i = this._metricToCurrentGoalMode(i)), n = this._metricsIndex[i] || this._dimensionsIndex[i], n && n.allow_sort !== !1 ? {
                metrics: i,
                direction: e.direction
            } : t) : e
        }
    }, {
        getMetadataInfo: function(e) {
            return e instanceof Object ? Vow.fulfill(e) : this._loadMetadataInfo(e)
        }
    }), BEM.decl("i-legacy-metadata", {
        _getDataBindingsDecl: function() {
            return jQuery.extend(this.__base(), {
                "preset.goal": {
                    initAccessor: "getGoal",
                    event: "change",
                    get: "_goal"
                }
            })
        }
    }), BEM.decl({
        block: "i-stat-metadata-api",
        baseBlock: "i-stat-api"
    }, null, BN("i-proxy").initProxy("i-stat-metadata-api", ["getTablesCompatibility*", "get*"])), BEM.decl("i-stat-metadata-api", null, {
        RESOURCES_REQUERES_COUNTER: ["segment_tree_values", "segment_list_values", "segment_tree_values_sample", "segment_list_values_sample", "segment_tree", "segments", "constructor-metrics-groups", "constructor_attributes_tree_table"],
        get: function(e, t) {
            var i = this.__base;
            return -1 === this.RESOURCES_REQUERES_COUNTER.indexOf(e) || t && t.params && void 0 !== t.params.ids ? i.apply(this, arguments) : BN("i-counters").getAsync().always(function(n) {
                return n.isRejected() ? (console.error("can not automatically add counter id to request for " + e), n) : i.call(this, e, jQuery.extend(!0, {}, t, {
                    params: {
                        ids: n.valueOf().getApiCounterId()
                    }
                }))
            }.bind(this))
        },
        getAttributeListValues: function(e) {
            return this.get("segment_list_values_sample", {
                params: e
            })
        },
        getAttributeTreeValues: function(e) {
            return this.get("segment_tree_values", {
                params: e
            })
        },
        getSegmentsTree: function(e) {
            return this.get("segments", {
                params: {
                    ids: e
                }
            }).then(function(e) {
                return e.segments
            })
        },
        getMetricsTree: function(e, t) {
            return this.get("constructor-metrics-groups", {
                params: {
                    table: e,
                    ids: t
                }
            }).then(function(e) {
                return jQuery.extend(!0, [], e.metric_groups)
            })
        },
        getDimensionsTree: function(e, t) {
            return this.get("constructor_attributes_tree_table", {
                params: {
                    table: e,
                    ids: t
                }
            }).then(function(e) {
                return jQuery.extend(!0, [], e.attribute_groups)
            })
        }
    }), BN.addDecl("i-goal").staticProp({
        TYPE: {
            URL: "url",
            NUMBER: "number",
            STEP: "step",
            ACTION: "action"
        },
        getGoalIdFromUrl: function() {
            var e = BN("i-router").getParams(),
                t = e.goal && String(e.goal).trim();
            return t ? t : void 0
        },
        getGoal: function(e) {
            return e = e ? e : this.getGoalIdFromUrl(), e ? BN("i-counters").getAsync().then(function(e) {
                return e.isGroup() ? null : this.getGoals()
            }.bind(this)).then(function(t) {
                return t && e ? this.getGoalById(e, t) || null : null
            }.bind(this)) : Vow.fulfill(null)
        },
        getGoalId: function() {
            return this.getGoal().then(function(e) {
                return e && e.id
            })
        },
        getGoals: function() {
            return BN("i-counters").getAsync().then(function(e) {
                return e.isGroup() ? null : e.getGoals()
            })
        },
        getGoalById: function(e, t) {
            return void 0 !== e && this._searchGoalInList(Number(e), t)
        },
        _searchGoalInList: function(e, t) {
            return (t || []).reduce(function(t, i) {
                return t ? t : i.id === e ? i : this._searchGoalInList(e, i.steps)
            }.bind(this), !1)
        },
        getDataCountsByGoals: function(e, t) {
            return BN("i-report").getMetadata().then(function(i) {
                var n = i.getGoalDimension();
                return n ? jQuery.extend({}, e, {
                    mode: t ? "compareList" : "list",
                    accuracy: "medium",
                    dimensions: ["ym:s:goalDimension"],
                    limit: 500,
                    metrics: i.getCountMetric(!0),
                    presetFilter: i.getPresetFilter() || null,
                    sort: ""
                }) : Vow.reject(new(BN("i-error-message").MetrikaHttpError)(405))
            }).then(BN("i-default-data").loadData.bind(BN("i-default-data"))).then(function(e) {
                return e = e && e.data || [], e.reduce(function(e, i) {
                    var n = i.dimensions[0].id || i.dimensions[0].name;
                    return t ? e[n] = i.metrics.a[0] + i.metrics.b[0] : e[n] = i.metrics[0], e
                }, {})
            })
        }
    }), BEM.decl({
        name: "i-default-data",
        baseBlock: "i-stat-data"
    }, null, BEM.blocks["i-proxy"].initProxy("i-default-data", ["_loadData*", "_getCurrencyList*"])), BEM.decl("i-default-data", null, {
        getReportOptions: function() {
            return Vow.all([this.__base(), BN("i-report").getReport()]).spread(function(e, t) {
                var i = t.getParamsModel().getState();
                return e.filter = i.filter, e.metricFilters = i["data-table"].metricFilters, e.dimensionFilter = i["data-table"].dimensionFilter, e.quantile = i.quantile, e.attribution = i.attribution, e.accuracy = i.accuracy, e
            })
        },
        getComparisonOptions: function() {
            return BN("i-report").getReport().then(function(e) {
                var t = e.getParamsModel().getState();
                return {
                    compareFilter: t.compareFilter,
                    comparePeriod: t.comparePeriod
                }
            })
        },
        getMetrics: function(e) {
            return Vow.all([BN("i-report").getMetadata(), BN("i-counters").getAsync(), BN("i-report").getReport()]).spread(function(t, i, n) {
                var o = e.metrics || t.getCountMetric(),
                    s = n.getParamsModel().getState();
                return this.loadData({
                    mode: "list",
                    accuracy: e.accuracy || "low",
                    ids: i.getApiCounterId(),
                    period: e.period,
                    metrics: o,
                    filter: BN("i-filter").buildFilter(e.filter || {}, t.getSegmentsTree()),
                    limit: e.limit || 1,
                    sort: e.limit > 1 ? "-" + o : "",
                    dimensions: e.dimensions || t.getDimensions().slice(0, 1),
                    requestId: e.requestId,
                    goalId: t.getGoal(),
                    quantile: e.quantile,
                    attribution: s.attribution,
                    excludeUndefined: e.excludeUndefined,
                    presetFilter: e.presetFilter
                })
            }.bind(this))
        },
        getMetricsByDimensions: function(e) {
            return this.getMetrics(jQuery.extend({
                limit: 10,
                excludeUndefined: !0
            }, e)).then(function(e) {
                return {
                    items: e && e.data || [],
                    sampled: e && e.sampled
                }
            })
        },
        loadData: function(e) {
            return Vow.all([BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(t, i) {
                var n = i.getParamsModel().getState();
                return void 0 === e.presetFilter && (e.presetFilter = t.getPresetFilterWithGoal()), e.direct_client_ids = n.preset && n.preset.direct_client_ids, e.currency = n.currency, e
            }).then(this.__base.bind(this))
        },
        getCurrencyList: function(e, t) {
            return Vow.all([BN("i-counters").getAsync(), t || BN("i-report").getReport()]).spread(function(t, i) {
                var n = i.getParamsModel().getState(),
                    o = n.preset && n.preset.direct_client_ids;
                return o ? this._getCurrencyList({
                    ids: t.getApiCounterId(),
                    clientIds: o,
                    period: e
                }) : []
            }.bind(this))
        }
    }), BN.addDecl("i-report-currency").staticProp({
        DEFAULT_CURRENCY: "YND",
        get: function(e, t) {
            var i = BN("i-router").getParams().currency,
                n = this.DEFAULT_CURRENCY;
            return i && i !== n ? BN("i-default-data").getCurrencyList(e, t).then(function(e) {
                if (i = BN("i-string").escapeHTML(i), !e.length) return i;
                for (var t = 0, o = e.length; o > t; t++)
                    if (i === e[t].id) return i;
                return n
            }) : Vow.fulfill(n)
        }
    }).done(),
    function() {
        BN.addDecl("i-filter").staticProp(BEM.blocks["i-proxy"].initProxy("i-filter", ["localizeDimensions*"]));
        var e = function() {
            this._nullsIdLocalizations = {}, this._normalIdLocalzations = {}
        };
        e.prototype = {
            lookup: function(e, t) {
                return null === t ? this._nullsIdLocalizations[e] : this._normalIdLocalzations[e] && this._normalIdLocalzations[e][t]
            },
            fill: function(e) {
                Object.keys(e).forEach(function(t) {
                    this._normalIdLocalzations[t] = this._normalIdLocalzations[t] || {}, e[t].forEach(function(e) {
                        null === e.id ? this._nullsIdLocalizations[t] = e.name : this._normalIdLocalzations[t][e.id] = e.name
                    }, this)
                }, this)
            },
            merge: function(e) {
                Object.keys(e._normalIdLocalzations).forEach(function(t) {
                    this._normalIdLocalzations[t] = this._normalIdLocalzations[t] || {}, Object.keys(e._normalIdLocalzations[t]).forEach(function(i) {
                        this._normalIdLocalzations[t][i] = e._normalIdLocalzations[t][i]
                    }, this)
                }, this), Object.keys(e._nullsIdLocalizations).forEach(function(t) {
                    this._nullsIdLocalizations[t] = e._nullsIdLocalizations[t]
                }, this)
            }
        }, BN.addDecl("i-filter").staticProp({
            DISABLE_REASONS: {
                INCOMPATIBLE_GOAL: 1,
                INCOMPATIBLE_SEGMENT: 2
            },
            GOAL_SEGMENT_ID: "Goal",
            removeDimension: function(e, t) {
                return e = $.extend({}, e), delete e[t], e
            },
            buildDimensionFilter: function(e, t) {
                var i, n, o = [];
                return (e = e ? String(e).trim() : e) ? (i = t.getDimensionsMeta().every(function(e) {
                    return e.fields && e.fields.name && e.fields.name.allow_filters ? (o.push(e.fields.name.dim), !0) : e.allow_filters ? (o.push(e.dim), !0) : !1
                }), i && o.length ? (n = o.map(function(t) {
                    return "(" + this.concatFilter(t, "=@", e, !0) + ")"
                }, this), this.disjunctionJoinFilters(n)) : "") : ""
            },
            stringifyFilter: function(e, t) {
                return this.isFiltersListEmpty(e) ? "" : BN("i-util").encodeQuotes(this.buildFilter(e, t.getSegmentsTree(), !0))
            },
            localizeFilter: function(e, t) {
                var i = this,
                    n = this._createLocalizationStorage();
                return e = jQuery.extend(!0, {}, e), this._getFilterLocalization(n, e, t).then(function(n) {
                    var o = i._createLocalizationStorage();
                    return o.fill(n), i._extendFilterWithTranslations(o, e, t)
                })
            },
            cleanFilter: function(e, t, i) {
                var n = BN("i-goal");
                return e = jQuery.extend(!0, {}, e), Object.keys(e).forEach(function(t) {
                    var n = i.findSegmentById(t);
                    n ? n.disabled && (e[t].disabled = this.DISABLE_REASONS.INCOMPATIBLE_SEGMENT) : delete e[t]
                }, this), e[this.GOAL_SEGMENT_ID] && (e[this.GOAL_SEGMENT_ID].items = e[this.GOAL_SEGMENT_ID].items || [], e[this.GOAL_SEGMENT_ID].items.some(function(e) {
                    return !e || !e.id || !n.getGoalById(e.id, t)
                }) && (e[this.GOAL_SEGMENT_ID].disabled = this.DISABLE_REASONS.INCOMPATIBLE_GOAL)), e
            },
            changedFilters: function(e, t) {
                return e = e || {}, t = t || {}, BN("i-util").arrayUnique(Object.keys(e).concat(Object.keys(t))).filter(function(i) {
                    return !jQuery.equals(e[i], t[i])
                })
            },
            getFilterFromUrl: function(e) {
                return this._getFilter(BN("i-router").getParams().filter, e)
            },
            getSecondaryFilterFromUrl: function(e) {
                return this._getFilter(BN("i-router").getParams().secondary_filter, e)
            },
            getFilter: function() {
                return BN("i-report").getReport().then(function(e) {
                    return e.getParamsModel().getState().filter
                })
            },
            getSecondaryFilter: function() {
                return BN("i-report").getReport().then(function(e) {
                    return e.getParamsModel().getState().compareFilter
                })
            },
            isFiltersListEmpty: function(e) {
                return !e || 0 === Object.keys(e).length
            },
            parseParamsTypeFilterLine: function(e) {
                var t = !1,
                    i = [],
                    n = "";
                return [].forEach.call(e, function(e) {
                    return t || "\\" !== e ? t && "\\" === e ? (t = !1, void(n += "\\")) : t && "." === e ? (t = !1, void(n += ".")) : (t && (t = !1, n += "\\"), "." === e ? (i.push(n), void(n = "")) : void(n += e)) : void(t = !0)
                }), t && (n += "\\"), i.push(n), i
            },
            serializeParamsTypeFilterLine: function(e) {
                return e.map(function(e) {
                    return e.replace(/\\/g, "\\\\").replace(/\./g, "\\.")
                }).join(".")
            },
            _getFilter: function(e, t) {
                if (!e) return Vow.promise(void 0);
                e = BN("i-util").decodeQuotes(e);
                try {
                    e = JSON.parse(e)[1]
                } catch (i) {}
                return Vow.all([t || BN("i-report").getMetadata(), BN("i-counters").getAsync()]).spread(function(t, i) {
                    var n = t.getSegmentsTree();
                    return this.cleanFilter(this.parseApiFilter(e, n), i.getGoals(), n)
                }.bind(this))
            },
            _getFilterLocalization: function(e, t, i) {
                var n = this._getNotLocalizedDimensionIds(e, t, i);
                return 0 !== Object.keys(n).length ? BN("i-counters").getAsync().then(function(e) {
                    return this.localizeDimensions(e.getApiCounterId(), n)
                }.bind(this)) : Vow.promise({})
            },
            _getNotLocalizedDimensionIds: function(e, t, i) {
                var n = {};
                return Object.keys(t).forEach(function(o) {
                    var s, r = i.findSegmentById(o) || {};
                    switch (r.type) {
                        case "list":
                            s = r.dim, t[o].items.forEach(function(t) {
                                void 0 === t.id || e.lookup(s, t.id) || (n[s] = n[s] || [], n[s].push(t.id))
                            });
                            break;
                        case "tree":
                        case "path":
                            t[o].items.forEach(function(t) {
                                t.forEach(function(t, i) {
                                    s = r.dims[i], t && void 0 !== t.id && !e.lookup(s, t.id) && (n[s] = n[s] || [], n[s].push(t.id))
                                })
                            })
                    }
                }), n
            },
            _extendFilterWithTranslations: function(e, t, i) {
                return Object.keys(t).forEach(function(n) {
                    var o = i.findSegmentById(n) || {};
                    switch (o.type) {
                        case "list":
                            t[n].items.forEach(function(t) {
                                void 0 !== t.id && (t.name = e.lookup(o.dim, t.id))
                            });
                            break;
                        case "tree":
                        case "path":
                            t[n].items.forEach(function(t) {
                                t.forEach(function(t, i) {
                                    t && void 0 !== t.id && (t.name = e.lookup(o.dims[i], t.id))
                                })
                            })
                    }
                }), t
            },
            _createLocalizationStorage: function() {
                return new e
            }
        }).done()
    }(), BN.addDecl("i-filter").staticProp({
        _getTranslationsCache: function() {
            return this._localizedDimensions || (this._localizedDimensions = this._createLocalizationStorage()), this._localizedDimensions
        },
        _getFilterLocalization: function(e, t, i) {
            return this.__base(this._getTranslationsCache(), t, i)
        },
        _extendFilterWithTranslations: function(e, t, i) {
            var n = this._getTranslationsCache();
            return n.merge(e), this.__base(n, t, i)
        }
    }).done(),
    function() {
        function e(e) {
            return !isNaN(parseFloat(e)) && isFinite(e)
        }

        function t() {
            this._inputIndex = 0, this._input = ""
        }

        function i() {
            this._stack = [new n], this._inputIndex = 0, this._stackIndex = 0, this._conditionParser = new o
        }

        function n() {
            this._nodes = []
        }

        function o() {}
        BN.addDecl("i-filter").staticProp({
            parseApiFilter: function(e, t) {
                var n, o;
                if (e = (e || "").trim(), 0 === e.length) return {};
                n = new i;
                try {
                    return o = n.parse(e), this._convertToInternalFilter(o, t)
                } catch (s) {
                    console.log("Can't parse filter: Wrong format", s)
                }
                return {}
            },
            _convertToInternalFilter: function(e, t) {
                var i = {},
                    n = this._preProcessNodeTree(e, t);
                return n.isOperator() && !n.getMetaSegment() ? n.getSubNodes().forEach(function(e) {
                    this._addSegmentToFilter(i, e)
                }, this) : this._addSegmentToFilter(i, n), i
            },
            _addSegmentToFilter: function(e, t) {
                var i = this._convertToInternalSegment(t);
                i && (e[i.id] = i.value)
            },
            _convertToInternalSegment: function(e) {
                var t, i, n = e.getMetaSegment();
                if (!n) throw new Error("must be with segment");
                if (t = n.type, i = "_convertTo" + t.charAt(0).toUpperCase() + t.substr(1) + "Segment", "function" == typeof this[i]) return {
                    id: n.id,
                    value: this[i](e)
                };
                throw new Error("Unknown segment type: " + t)
            },
            _getDateFieldByOperator: function(e, t) {
                var i = BN("i-date");
                return e.reduce(function(e, n) {
                    var o, s = n.getCondition();
                    return s.op === t && (o = i.create(s.value), o.isValid()) ? o.getISODate() : e
                }, !1)
            },
            _convertToDateSegment: function(e) {
                var t, i, n = e.getSubNodes();
                if (2 !== n.length || !n[0].isCondition() || !n[1].isCondition()) throw new Error("Incorrect date type segment");
                if (t = this._getDateFieldByOperator(n, ">="), i = this._getDateFieldByOperator(n, "<="), !i || !t) throw new Error("Incorrect date type segment");
                return {
                    from: t,
                    to: i
                }
            },
            _convertToUidSegment: function(e) {
                return {
                    value: String(e.getCondition().value)
                }
            },
            _convertToBoolSegment: function(e) {
                return {
                    value: e.getCondition().value
                }
            },
            _convertToNumberSegment: function(e) {
                var t = {};
                return e.isOperator() ? (t.op = "<>", t.value = [e.getSubNodes()[0].getCondition().value, e.getSubNodes()[1].getCondition().value]) : (t.op = e.getCondition().op, t.value = e.getCondition().value), t
            },
            _convertToGoalsSegment: function(e) {
                var t = {},
                    i = this;
                return e.isOperator() ? t.items = e.getSubNodes().map(function(e) {
                    return {
                        id: i._convertToGoalsItem(e)
                    }
                }) : t.items = [{
                    id: this._convertToGoalsItem(e)
                }], t.exclude = !1, t
            },
            _convertToGoalsItem: function(e) {
                var t = new RegExp(e.getMetaSegment().filter_template.replace("<goal_id>", "(\\d*)")),
                    i = e.getCondition(),
                    n = i.key + i.op + "'" + i.value + "'";
                return n.match(t)[1]
            },
            _convertToTreeSegment: function(e) {
                for (var t, i, n = {}, o = e; !o.isCondition();) o = o.getSubNodes()[0];
                return t = o.getCondition().op.trim(), ["in", "not in"].indexOf(t) < 0 ? this._convertToPathSegment(e) : (n.exclude = "not in" === t, e.isOperator() ? (i = e.getSubNodes().map(this._convertToTreeValue, this), i = i.concat.apply([], i)) : i = this._convertToTreeValue(e), n.items = i, n)
            },
            _convertToTreeValue: function(e) {
                var t = e.getCondition(),
                    i = e.getMetaSegment().dims.indexOf(t.key);
                return t.value.map(function(e) {
                    var t = [];
                    return t[i] = {
                        id: e
                    }, t
                })
            },
            _convertToPathSegment: function(e) {
                for (var t = {}, i = e, n = this; !i.isCondition();) i = i.getSubNodes()[0];
                return t.exclude = "!=" === i.getCondition().op, e.isOperator() ? "and" === e.getOperator() && t.exclude === !0 || "or" === e.getOperator() && t.exclude === !1 ? t.items = e.getSubNodes().map(function(e) {
                    return n._convertToPathGroup(e)
                }) : t.items = [this._convertToPathGroup(e)] : t.items = [
                    [this._convertToListItem(e)]
                ], t
            },
            _convertToPathGroup: function(e) {
                var t, i = this;
                return t = e.isOperator() ? e.getSubNodes().map(function(e) {
                    return i._convertToListItem(e)
                }) : [i._convertToListItem(e)]
            },
            _convertToUrlSegment: function(e) {
                var t = {};
                return t = this._convertToMultilineSegment(e), e.isOperator() && (e = e.getSubNodes()[0]), ["dim", "path_dim", "host_dim"].some(function(i) {
                    return e.getMetaSegment()[i] === e.getCondition().key ? (t.urlMode = i, !0) : void 0
                }), t
            },
            _convertToMultilineSegment: function(e) {
                var t = {},
                    i = this;
                return e.isOperator() ? (t.conjunction = "and" === e.getOperator(), t.items = e.getSubNodes().map(function(e) {
                    return i._convertToMultilineItem(e)
                })) : (t.conjunction = !1, t.items = [this._convertToMultilineItem(e)]), t
            },
            _convertToMultilineItem: function(e) {
                var t = e.getCondition().value,
                    i = e.getCondition().op;
                return ("@" === i[1] || "~" === i[1]) && (t = i[1] + t), "!" === i.charAt(0) && (t = "!" + t), t
            },
            _convertToParamsSegment: function(e) {
                var t, i = {
                        op: "==",
                        paramVal: "",
                        paramType: ""
                    },
                    n = e.isCondition() ? [e] : e.getSubNodes();
                return n.length > 1 && (t = n.pop(), i.paramType = t.getCondition().key, i.op = t.getCondition().op, i.paramVal = t.getCondition().value), i.paramName = this.serializeParamsTypeFilterLine(n.map(function(e) {
                    return e.getCondition().value
                })), i
            },
            _convertToListSegment: function(e) {
                var t = {},
                    i = this;
                return e.isOperator() ? (t.exclude = "and" === e.getOperator(), t.items = e.getSubNodes().map(function(e) {
                    return i._convertToListItem(e)
                })) : (t.exclude = "!" === e.getCondition().op[0], t.items = [this._convertToListItem(e)]), t
            },
            _convertToListItem: function(e) {
                var t = {};
                return t.id = e.getCondition().value, t
            },
            _findOutSegment: function(e, t) {
                var i = e.key,
                    n = t.findByDim(i);
                if (n) return n;
                throw new Error("Segment type unknown " + i)
            },
            _preProcessNodeTree: function(e, t) {
                for (var i, n, o, s = this; !e.isCondition() && !e.isOperator();) {
                    if (i = e.getSubNodes(), i.length > 1 || 0 === i.length) throw new Error("Parsing filter: node must be operator or segment");
                    e = i[0]
                }
                if (e.isOperator()) {
                    e.setSubNodes(e.getSubNodes().reduce(function(e, i) {
                        return e.push(s._preProcessNodeTree(i, t)), e
                    }, []));
                    var r = !1;
                    for (n = 0, o = e.getSubNodes().length - 1; o > n && (r = e.getSubNodes()[n].getMetaSegment().id === e.getSubNodes()[n + 1].getMetaSegment().id, r); n++);
                    r && e.setMetaSegment(e.getSubNodes()[0].getMetaSegment())
                } else e.setMetaSegment(this._findOutSegment(e.getCondition(), t));
                return e
            }
        }).done(), t.prototype = {
            _matchNextInput: function(e) {
                return e === this._input.substr(this._inputIndex, e.length).toLowerCase()
            },
            _nextInput: function(e) {
                return e = void 0 === e ? 1 : e, this._inputIndex += e, this._getInput()
            },
            _getInput: function(e) {
                return e = e || 0, this._inputIndex + e >= this._input.length ? void 0 : this._input.charAt(this._inputIndex + e)
            }
        }, i.prototype = new t, i.prototype._STATES = {
            PARSING_EXPRESSION: 0,
            PARSING_CONDITION: 1
        }, i.prototype.parse = function(e) {
            for (this._input = e, this._state = this._STATES.PARSING_EXPRESSION; void 0 !== this._getInput();) switch (this._state) {
                case this._STATES.PARSING_EXPRESSION:
                    this._handleExpression();
                    break;
                case this._STATES.PARSING_CONDITION:
                    this._handleCondition()
            }
            return this._getNode()
        }, i.prototype._handleExpression = function() {
            var e = this._getInput(),
                t = 1;
            switch (e) {
                case "(":
                    this._pushNode();
                    break;
                case ")":
                    this._popNode();
                    break;
                case " ":
                    break;
                case "e":
                case "E":
                    this._matchNextInput("exists") ? this._handleQuantor("exists") : (t = 0, this._state = this._STATES.PARSING_CONDITION);
                    break;
                case "N":
                case "n":
                    this._matchNextInput("none") ? this._handleQuantor("none") : (t = 0, this._state = this._STATES.PARSING_CONDITION);
                    break;
                case "a":
                case "A":
                    this._matchNextInput("and") ? t = this._handleOperator("and") : this._matchNextInput("all") ? this._handleQuantor("all") : (t = 0, this._state = this._STATES.PARSING_CONDITION);
                    break;
                case "o":
                case "O":
                    this._matchNextInput("or") ? t = this._handleOperator("or") : (t = 0, this._state = this._STATES.PARSING_CONDITION);
                    break;
                default:
                    t = 0, this._state = this._STATES.PARSING_CONDITION
            }
            this._nextInput(t)
        }, i.prototype._handleQuantor = function(e) {
            for (var t = this._nextInput(e.length); t;) {
                if ("(" === t) return void this._pushNode().setQuantor(e);
                if (" " !== t) throw new Error('Bad quantor syntax. Expexed "(" but has "' + t + '"');
                t = this._nextInput()
            }
            throw new Error('Bad quantor syntax. Expexed "(" but has end of line')
        }, i.prototype._handleCondition = function() {
            var e;
            this._pushNode(), e = this._conditionParser.parse(this._input, this._inputIndex), this._inputIndex = e.index, this._getNode().setCondition(e.value), this._popNode(), this._state = this._STATES.PARSING_EXPRESSION
        }, i.prototype._handleOperator = function(e) {
            return this._getNode().setOperator(e), e.length
        }, i.prototype._getNode = function() {
            return this._stack[this._stackIndex]
        }, i.prototype._pushNode = function() {
            var e = new n;
            return this._stack[this._stackIndex].addNode(e), this._stack.push(e), this._stackIndex++, this._stack[this._stackIndex]
        }, i.prototype._popNode = function() {
            this._stack.pop(), this._stackIndex--
        }, n.prototype = {
            setOperator: function(e) {
                this._operator = e
            },
            addNode: function(e) {
                this._nodes.push(e)
            },
            setSubNodes: function(e) {
                this._nodes = e
            },
            getSubNodes: function() {
                return this._nodes
            },
            getOperator: function() {
                return this._operator
            },
            setCondition: function(e) {
                this._condition = e
            },
            getCondition: function() {
                return this._condition
            },
            setMetaSegment: function(e) {
                this._segment = e
            },
            getMetaSegment: function() {
                return this._segment
            },
            isCondition: function() {
                return void 0 !== this._condition
            },
            isOperator: function() {
                return void 0 !== this._operator
            },
            setQuantor: function(e) {
                this._quantor = e
            },
            getQuantor: function() {
                return this._quantor
            }
        }, o.prototype = new t, o.prototype._CHECK_AS_DIGIT = [".", "-", "+"], o.prototype._STATES = {
            PARSING_KEY: 0,
            PARSING_RELATION: 1,
            PARSING_VALUE: 2,
            PARSING_DIGITAL_VALUE: 3,
            PARSING_STRING_VALUE: 4,
            PARSING_COMPLETE: 5
        }, o.prototype._RELATIONS = ["==", "!=", ">", "<", ">=", "<=", "=@", "!@", "=~", "!~", "=*", "!*", "!n", "=n", " in", " not in"], o.prototype._RELATIONS.sort(function(e, t) {
            return t.length - e.length
        }), o.prototype.parse = function(e, t) {
            for (this._buffer = "", this._value = {}, this._multiple = !1, this._input = e, this._inputIndex = t, this._state = this._STATES.PARSING_KEY; void 0 !== this._getInput() && this._state !== this._STATES.PARSING_COMPLETE;) switch (this._state) {
                case this._STATES.PARSING_KEY:
                    this._handleKey();
                    break;
                case this._STATES.PARSING_RELATION:
                    this._handleRelation();
                    break;
                case this._STATES.PARSING_VALUE:
                    this._handleValue();
                    break;
                case this._STATES.PARSING_DIGITAL_VALUE:
                    this._handleDigitalValue();
                    break;
                case this._STATES.PARSING_STRING_VALUE:
                    this._handleStringValue()
            }
            return {
                index: this._inputIndex,
                value: this._value
            }
        }, o.prototype._handleKey = function() {
            var e = this._getInput();
            if ("<" === e && (e = this._lookAheadForParameter()), this._someRelationStartsWithSymbol(e)) return this._value.key = this._buffer.trim(), this._buffer = "", void(this._state = this._STATES.PARSING_RELATION);
            if (")" === e || "(" === e) throw new Error("Condition parser: dimension value incorrect");
            this._buffer += e, this._nextInput()
        }, o.prototype._lookAheadForParameter = function() {
            for (var e, t = this._inputIndex, i = !1; e = this._nextInput();) {
                if (">" === e) {
                    i = !0;
                    break
                }
                if ("'" === e) {
                    i = !1;
                    break
                }
            }
            return i ? (this._buffer += this._input.slice(t, this._inputIndex + 1), this._nextInput()) : (this._inputIndex = t, this._getInput())
        }, o.prototype._handleRelation = function() {
            var e = this._RELATIONS.filter(function(e) {
                return this._matchNextInput(e)
            }, this);
            if (0 === e.length) throw new Error("Relation is unknown");
            this._value.op = e[0], "!n" === this._value.op || "=n" === this._value.op ? (this._value.op = {
                "!n": "!=",
                "=n": "=="
            }[this._value.op], this._value.value = null, this._state = this._STATES.PARSING_COMPLETE) : this._state = this._STATES.PARSING_VALUE, this._nextInput(this._value.op.length)
        }, o.prototype._handleValue = function() {
            var t = this._getInput();
            "'" === t ? (this._state = this._STATES.PARSING_STRING_VALUE, this._nextInput()) : e(t) || "+" === t || "-" === t ? this._state = this._STATES.PARSING_DIGITAL_VALUE : "(" === t ? (this._nextInput(), this._multiple = !0) : "," === t && this._multiple ? this._nextInput() : ")" === t && this._multiple ? (this._nextInput(), this._state = this._STATES.PARSING_COMPLETE) : " " === t ? this._nextInput() : (this._state = this._STATES.PARSING_COMPLETE, this._value.value = null)
        }, o.prototype._handleStringValue = function() {
            var e = this._getInput();
            return "'" !== e || this._isEscaped ? ("\\" === e ? this._isEscaped = !this._isEscaped : this._isEscaped = !1, this._buffer += e, void this._nextInput()) : (this._saveValue(this._buffer.replace(/\\'/g, "'").replace(/\\\\/g, "\\")), void this._nextInput())
        }, o.prototype._handleDigitalValue = function() {
            var t = this._getInput();
            e(t) || this._CHECK_AS_DIGIT.indexOf(t) > -1 ? (this._buffer += t, this._nextInput()) : this._saveValue(-1 !== this._buffer.indexOf(".") ? parseFloat(this._buffer) : parseInt(this._buffer))
        }, o.prototype._saveValue = function(e) {
            this._multiple ? (e = (this._value.value || []).concat(e), this._state = this._STATES.PARSING_VALUE) : this._state = this._STATES.PARSING_COMPLETE, this._buffer = "", this._value.value = e
        }, o.prototype._someRelationStartsWithSymbol = function(e) {
            return this._RELATIONS.some(function(t) {
                return t[0] === e
            })
        }
    }(), BN.addDecl("i-filter").staticProp({
        _serializersCache: {},
        disjunctionJoinFilters: function() {
            return this._joinFiltersWithOp("or", arguments)
        },
        conjunctionJoinFilters: function() {
            return this._joinFiltersWithOp("and", arguments)
        },
        concatFilter: function(e, t, i, n) {
            return null === i && (t = {
                "==": "=",
                "!=": "!"
            }[t], i = "n", n = !1), e + t + (n ? this._escapeStringValue(i) : i)
        },
        buildFilter: function(e, t, i) {
            var n;
            return e ? (n = Object.keys(e).map(function(n) {
                var o, s = t.findSegmentById(n),
                    r = e[n];
                if (!s) {
                    if (!r.type) return;
                    s = {
                        type: r.type,
                        dim: n
                    }
                }
                if (i || !s.disabled && !r.disabled) {
                    if (o = this._getSerializer(s.type), !o) throw new Error("Can not serialize filter. Segment is of unknown type: " + s.type);
                    return o.call(this, e[n], s)
                }
            }, this).filter(Boolean).map(function(e) {
                return "(" + e + ")"
            }), this.conjunctionJoinFilters(n)) : ""
        },
        _getSerializer: function(e) {
            var t;
            return this._serializersCache[e] || (t = String(e).split("-").map(function(e) {
                return e.charAt(0).toUpperCase() + e.slice(1)
            }), t.unshift("serialize"), this._serializersCache[e] = t.join("")), this[this._serializersCache[e]]
        },
        serializeList: function(e, t) {
            var i = e.items.map(function(i) {
                return i = i.id, this.concatFilter(t.dim, e.exclude ? "!=" : "==", i, !0)
            }, this);
            return this._joinFiltersWithOp(e.exclude ? "and" : "or", i)
        },
        serializeParams: function(e, t) {
            var i = [],
                n = [];
            return e.paramName && (i = this.parseParamsTypeFilterLine(e.paramName), n = i.map(function(e, i) {
                return this.concatFilter(t.dims[i], "==", e, !0)
            }, this)), e.paramVal && e.paramType && n.push(this.concatFilter(e.paramType, e.op, e.paramVal, !0)), e.tail && n.push(this.concatFilter(t.dims[i.length], "=@", e.tail, !0)), n = this.conjunctionJoinFilters(n), e.noQuantifier ? n : "EXISTS(" + n + ")"
        },
        serializeMultiline: function(e, t) {
            var i = e.items.map(function(e) {
                var i, n, o;
                return null === e ? (i = "=", n = null) : ("!" === e.charAt(0) && (o = !0, e = e.substr(1)), e.match(/^(~|@)/) ? (i = RegExp.$1, n = e.substr(1)) : (i = "*", n = e)), this.concatFilter(t.dim, (o ? "!" : "=") + i, n, !0)
            }, this);
            return this._joinFiltersWithOp(e.conjunction ? "and" : "or", i)
        },
        serializeUrl: function(e, t) {
            return this.serializeMultiline(e, {
                dim: e.urlMode && t[e.urlMode] || t.dim
            })
        },
        serializeTree: function(e, t) {
            var i = {};
            return e.items.forEach(function(e) {
                e.forEach(function(e, n, o) {
                    var s;
                    n + 1 === o.length && (s = t.dims[n], i[s] || (i[s] = []), i[s].push(e.id))
                })
            }), i = Object.keys(i).map(function(t) {
                return t + (e.exclude ? " NOT IN" : " IN") + "(" + i[t].map(this._escapeStringValue, this).join(",") + ")"
            }, this), this._joinFiltersWithOp(e.exclude ? "and" : "or", i)
        },
        serializePath: function(e, t) {
            var i = e.items.map(function(i) {
                return "(" + this._joinFiltersWithOp(e.exclude ? "or" : "and", i.map(function(i, n) {
                    return i = i.id || null, this.concatFilter(t.dims[n], e.exclude ? "!=" : "==", i, !0)
                }, this)) + ")"
            }, this);
            return this._joinFiltersWithOp(e.exclude ? "and" : "or", i)
        },
        serializeGoals: function(e, t) {
            return this.disjunctionJoinFilters.apply(this, e.items.map(function(e) {
                return t.filter_template.replace("<goal_id>", e.id)
            }))
        },
        serializeBool: function(e, t) {
            return this.concatFilter(t.dim, "==", e.value, !0)
        },
        serializeUid: function(e, t) {
            return this.concatFilter(t.dim, "==", e.value)
        },
        serializeNumber: function(e, t) {
            return "<>" === e.op ? this.conjunctionJoinFilters(this.concatFilter(t.dim, ">=", e.value[0]), this.concatFilter(t.dim, "<=", e.value[1])) : this.concatFilter(t.dim, e.op, e.value)
        },
        serializeDate: function(e, t) {
            return this.conjunctionJoinFilters(this.concatFilter(t.dim, ">=", e.from, !0), this.concatFilter(t.dim, "<=", e.to, !0))
        },
        _joinFiltersWithOp: function(e, t) {
            return e = " " + e.trim() + " ", Array.prototype.reduce.call(t, function(e, t) {
                return t && (t instanceof Array ? e.push.apply(e, t) : e.push(t)), e
            }, []).join(e)
        },
        _escapeStringValue: function(e) {
            return "'" + String(e).replace(/\\/g, "\\\\").replace(/\'/g, "\\'") + "'"
        }
    }).done(), BN.addDecl("i-attribution").staticProp({
        ATTRIBUTION_VALUES: ["Last", "First", "LastSign"],
        getDefaultAttribution: function() {
            return this.ATTRIBUTION_VALUES[0]
        },
        getAttribution: function(e) {
            return (e ? Vow.promise(e) : BN("i-report").getMetadata()).then(function(e) {
                var t = BN("i-router").getParams("attribution").attribution;
                return t = t && String(t).trim(), t && -1 !== this.ATTRIBUTION_VALUES.indexOf(t) && this.checkAttributionDimensionsPresent(e.getDimensionsMeta()) ? t : void 0
            }.bind(this))
        },
        serialize: function(e) {
            return e === this.getDefaultAttribution() ? null : e
        },
        checkAttributionDimensionsPresent: function(e) {
            return e.some(function(e) {
                return e.parameter && "attribution" === e.parameter.id
            })
        }
    }), BEM.decl("i-segment-tree", {
        KNOWN_SEGMENT_TYPES: ["list", "bool", "goals", "tree", "path", "multiline", "params", "number", "url", "date", "uid"],
        onSetMod: {
            js: function() {
                var e = this.params.compatibility || {};
                this._table = this.params.table, this._tablesCompatibility = (e[this._table] || []).reduce(function(e, t) {
                    return e[t] = !0, e
                }, {}), this._tree = this._preprocessSegmentsTree(this.params.tree || {})
            }
        },
        getTree: function() {
            return this._tree
        },
        getVisibleSubtree: function(e) {
            return e = e || jQuery.extend(!0, [], this.getTree()), e.filter(function(e) {
                return e.chld ? (e.chld = this.getVisibleSubtree(e.chld), Boolean(e.chld.length)) : !e.hidden
            }, this)
        },
        searchByName: function(e) {
            var t = this.getVisibleSubtree();
            return e = e.trim(), e ? this._searchFlattenTree(t, this._testNamePatternMatch.bind(this, e)) : t
        },
        segmentName: function(e) {
            var t = this.findSegmentById(e);
            return t ? t.name : ""
        },
        segmentType: function(e) {
            var t = this.findSegmentById(e);
            return t ? t.type : ""
        },
        findSegmentById: function(e) {
            return this._ensureIdSegmentCache()[e]
        },
        findByDim: function(e) {
            var t, i = this.getByDimensionMap()[e];
            return i || (t = this.getByTypeMap(), Object.keys(t).some(function(n) {
                var o = "_findByDimFor" + n.charAt(0).toUpperCase() + n.substr(1);
                return "function" == typeof this[o] ? i = this[o](e, t[n]) : void 0
            }, this)), i || null
        },
        getSegmentParents: function(e) {
            return this._ensureSegmentParentsCache()[e]
        },
        serialize: function() {
            return this._tree
        },
        getByDimensionMap: function() {
            var e = this._cacheByDimension;
            return e || (this._cacheByDimension = e = {}, this.getAsList().forEach(function(t) {
                if (e[t.dim] = t, t.dims)
                    for (var i, n = 0; i = t.dims[n]; n++) e[i] = t
            })), e
        },
        getByTypeMap: function() {
            var e = this._cacheByType;
            return e || (this._cacheByType = e = {}, this.getAsList().forEach(function(t) {
                e[t.type] || (e[t.type] = []), e[t.type].push(t)
            })), e
        },
        getAsList: function() {
            var e = this._cacheAsList;
            if (!e) {
                this._cacheAsList = e = [];
                for (var t, i = 0, n = this._tree.slice(); t = n[i]; i++) t.chld ? n.push.apply(n, t.chld) : e.push(t)
            }
            return e
        },
        _findByDimForUrl: function(e, t) {
            var i;
            return t.some(function(t) {
                return [t.host_dim, t.path_dim].indexOf(e) > -1 ? i = t : void 0
            }), i
        },
        _findByDimForParams: function(e, t) {
            var i;
            return t.some(function(t) {
                return t.dim_value_double === e ? i = t : void 0
            }), i
        },
        _findByDimForGoals: function(e, t) {
            var i;
            return t.some(function(t) {
                var n = new RegExp(t.filter_template.replace(/^([\w:]+)<goal_id>([\w]+).*$/, "$1\\d+$2"));
                return n.test(e) ? i = t : void 0
            }), i
        },
        _ensureIdSegmentCache: function() {
            return this._idSegmentCache || (this._idSegmentCache = {}, this.getAsList().forEach(function(e) {
                this._idSegmentCache[e.id] = e
            }, this)), this._idSegmentCache
        },
        _ensureSegmentParentsCache: function() {
            return this._segmentParentsCache || (this._segmentParentsCache = this._makeSegmentParentsMap(this._tree)), this._segmentParentsCache
        },
        _makeSegmentParentsMap: function(e, t, i) {
            return i = i || [], t = t || {}, e.forEach(function(e) {
                t[e.id] = i.concat(e), e.chld && e.chld.length > 0 && this._makeSegmentParentsMap(e.chld, t, t[e.id])
            }, this), t
        },
        _isKnownSegment: function(e) {
            return -1 !== this.KNOWN_SEGMENT_TYPES.indexOf(e.type)
        },
        _isSegmentEnabled: function(e) {
            return !(e.restricted && "constructor" !== e.restricted || this.params.isGroupReport && "goals" === e.type)
        },
        _isSegmentVisible: function(e) {
            return (!e.restricted || "constructor" === e.restricted) && BN("segment-panel").isKnownSegment(e.type)
        },
        _preprocessSegmentsTree: function(e) {
            return e = jQuery.extend(!0, [], e), e.filter(function(e) {
                return e.dims ? e.id = e.dims[0] : e.dim && (e.id = e.dim), e.chld ? (e.chld = this._preprocessSegmentsTree(e.chld), e.chld.length ? (e.disabled = e.chld.every(function(e) {
                    return e.disabled
                }), e.hidden = e.chld.every(function(e) {
                    return e.hidden
                }), !0) : !1) : (e.disabled = !this._tablesCompatibility[e.table] || !this._isSegmentEnabled(e), e.hidden = !this._isSegmentVisible(e), this._isKnownSegment(e))
            }, this)
        },
        _searchFlattenTree: function(e, t) {
            return e.reduce(function(e, i) {
                return i.chld && i.chld.length > 0 ? (t(i) || (i.chld = this._searchFlattenTree(i.chld, t)), (i.chld.length || t(i)) && e.push(i)) : t(i) && e.push(i), e
            }.bind(this), [])
        },
        _testNamePatternMatch: function(e, t) {
            return -1 !== t.name.toLowerCase().indexOf(e)
        }
    }, {
        create: function(e, t, i) {
            return Vow.all([BN("i-stat-metadata-api").getSegmentsTree(i), BN("i-stat-metadata-api").getTablesCompatibility()]).spread(function(i, n) {
                return BEM.create(this._name, jQuery.extend({}, t, {
                    tree: i,
                    table: e,
                    compatibility: n
                }))
            }.bind(this))
        },
        isInternalSegment: function(e) {
            return "internal" === e.permission_scope
        }
    }), (BEM.DOM || BEM).decl("segment-panel", {}, {
        KNOWN_SEGMENT_TYPES: ["list", "bool", "goals", "tree", "path", "multiline", "params", "number", "url", "date"],
        isKnownSegment: function(e) {
            return -1 !== this.KNOWN_SEGMENT_TYPES.indexOf(e)
        }
    }), BEM.JSON.decl("segment-panel", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.segment,
                n = t.filter,
                o = n && n[i.id];
            delete i.chld, e.js(jQuery.extend(e.js(), {
                segment: i,
                noCounts: t.noCounts
            })).content([{
                elem: "header",
                segment: i,
                value: o
            }, {
                elem: "content-wrap",
                content: {
                    elem: "content",
                    mods: {
                        type: e.mod("type")
                    },
                    segment: i,
                    value: o,
                    filter: n
                }
            }, {
                elem: "footer"
            }])
        },
        onElem: {
            inverse: function(e) {
                var t = e.param("value"),
                    i = e.param("type"),
                    n = i ? "-" + i : "";
                e.content({
                    block: "radiobox",
                    mods: {
                        size: "s"
                    },
                    name: "segment-panel__inverse",
                    value: t ? "exclude" : "include",
                    content: [BEM.I18N("segment-panel", "inverse-selected-items-label" + n), {
                        block: "segment-panel",
                        elem: "gap",
                        mods: {
                            size: "s"
                        }
                    }, {
                        elem: "radio",
                        content: BEM.I18N("segment-panel", "inverse-selected-items-include" + n),
                        controlAttrs: {
                            value: "include"
                        }
                    }, {
                        block: "segment-panel",
                        elem: "gap",
                        mods: {
                            size: "s"
                        }
                    }, {
                        elem: "radio",
                        content: BEM.I18N("segment-panel", "inverse-selected-items-exclude" + n),
                        controlAttrs: {
                            value: "exclude"
                        }
                    }]
                })
            },
            footer: function(e) {
                e.content() || e.remove()
            },
            header: function(e) {
                e.beforeContent({
                    elem: "title",
                    content: e.blockParams().segment.name
                })
            },
            gap: function(e) {
                e.tag("span")
            }
        }
    }), BEM.DOM.decl("segment-panel", {
        onSetMod: {
            js: function() {
                var e = this.findBlockInside("inverse", "radiobox");
                this.params.segmentId = this.params.segment.id, this._triggerChangesDebounced = jQuery.debounce(this._triggerChangesImmediately, 350), e && e.on("change", this._onInverseChange, this)
            }
        },
        val: function() {
            throw new Error("Must be implemented by mod type")
        },
        _onInverseChange: function() {
            var e = this.val();
            e && this._triggerChangesImmediately()
        },
        _onChangeValue: function() {
            this._triggerChangesDebounced()
        },
        _triggerChangesImmediately: function() {
            var e = this.val();
            e ? this._filter[this.params.segmentId] = e : delete this._filter[this.params.segmentId], this.trigger("change", this._filter)
        },
        _onSelectMultilineItem: function(e) {
            var t = e.target,
                i = this.findBlockInside("multiline-ctrl", "input");
            i.val([i.val(), t.val()].join("\n").trim()), t.val("")
        }
    }),
    function() {
        var e = BEM.DOM,
            t = $.browser.opera && $.browser.version < 12.1 ? "keypress" : "keydown";
        e.decl({
            name: "input",
            modName: "suggest",
            modVal: "yes"
        }, {
            onSetMod: {
                js: function() {
                    var e = this;
                    e.params.foot && (e.foot = e.params.foot), e._preventRequest = !0, e.__base.apply(e, arguments), e._userVal = e.val();
                    var t = e._focused;
                    t && e.delMod("focused"), e.elem("control").attr("autocomplete", "off"), e._preventRequest = !1, t && e.setMod("focused", "yes"), e._items = [], e._curItemIndex = -1, e._doRequest = $.debounce(e._doRequest, e.params.debounceDelay), this.bindToWin("resize", $.throttle(this._setWidth, 60))
                },
                focused: {
                    yes: function() {
                        this.__base();
                        var e = this.params.showListOnFocus ? this._onChange() : this._onChange;
                        this.on("change", e)
                    },
                    "": function() {
                        this.__base(), this.un("change", this._onChange)._preventHide || this._getPopup().hide()
                    }
                }
            },
            getDataprovider: function() {
                var e = this.params.dataprovider.url;
                return this._dataprovider || (this._dataprovider = BEM.create(this.params.dataprovider.name || this.__self.getName() + "__dataprovider", $.extend(this.params.dataprovider, {
                    url: e,
                    callbackCtx: this
                })))
            },
            _onChange: function() {
                return this._preventRequest || this._doRequest(), this._onChange
            },
            _onKeyDown: function(e) {
                var t = 38 === e.which || 40 === e.which;
                if (t && !e.shiftKey) {
                    e.preventDefault();
                    var i = this._items.length,
                        n = !1;
                    if (i) {
                        var o = e.which - 39,
                            s = this._curItemIndex,
                            r = 0;
                        do n = (0 === s && -1 === o || s + o >= i) && this._onLeaveItem(this._items[s], !0), s += o, 0 > s ? s = i - 1 : s >= i && (s = 0); while (!n && this._onEnterItem(this._items[s], !0) === !1 && ++r < i)
                    }
                }
            },
            _onKeyPress: function(e) {
                13 === e.which && this._curItemIndex > -1 && this._isCurItemEnteredByKeyboard && (e.preventDefault(), this._onSelectItem(this._items[this._curItemIndex], !0))
            },
            _getPopup: function() {
                var i = this;
                if (!i._popup) {
                    var n = i.__self.getName(),
                        o = [{
                            elem: "items",
                            tag: "ul",
                            mix: [{
                                block: n,
                                elem: "popup-items"
                            }]
                        }],
                        s = Array.isArray(i.params.popupMixs) ? i.params.popupMixs : [],
                        r = {
                            directions: "bottom-left"
                        };
                    i._hasPopupFade() && o.push({
                        block: n,
                        elem: "fade"
                    }), $.extend(r, i.params.popupParams), s.push({
                        block: n,
                        elem: "popup",
                        mods: i.params.popupMods,
                        js: {
                            uniqId: i._uniqId
                        }
                    }), i._popup = $(BEMHTML.apply({
                        block: "popup",
                        mods: {
                            animate: "no"
                        },
                        mix: s,
                        js: r,
                        content: {
                            elem: "content",
                            content: o
                        }
                    })).bem("popup").on({
                        show: function() {
                            i.bindTo("keypress", i._onKeyPress).bindTo(t, i._onKeyDown)
                        },
                        hide: function() {
                            i.unbindFrom("keypress " + t)._curItemIndex = -1
                        }
                    }), $.each({
                        mouseover: i._onEnterItem,
                        mouseout: i._onLeaveItem,
                        "mousedown touchstart": i._onSelectItem,
                        "mouseup touchend": i._onItemMouseUp
                    }, function(e, t) {
                        BEM.blocks["b-autocomplete-item"].on(i._popup.domElem, e, function(e) {
                            t.call(i, e.block)
                        })
                    }), e.init(i._popup.domElem)
                }
                return i._popup
            },
            getPopup: function() {
                return this._getPopup()
            },
            _hasPopupFade: function() {
                return "yes" === (this.params.popupMods || {}).fade
            },
            _onEnterItem: function(e, t) {
                if (e.hasMod("enterable", "no")) return !1;
                var i = this._items,
                    n = this._curItemIndex;
                n > -1 && i[n].delMod("hovered"), n = this._getItemIndex(e), n > -1 && i[n].setMod("hovered", "yes"), this._curItemIndex = n, this._isCurItemEnteredByKeyboard = !!t, t && this.params.updateOnEnter && (this._preventRequest = !0, this.val(e.enter() !== !1 ? e.val() : this._userVal, {
                    source: "autocomplete",
                    itemIndex: this._curItemIndex
                }).del("_preventRequest"))
            },
            _onLeaveItem: function(e, t) {
                var i = this._curItemIndex;
                return i > -1 && i === this._getItemIndex(e) && (this._items[i].delMod("hovered"), this._curItemIndex = -1), t && this.val(this._userVal), !0
            },
            _onSelectItem: function(e, t) {
                var i = e.select(t || !1),
                    n = "object" == typeof i ? i.needUpdate : i !== !1,
                    o = "object" == typeof i && i.needEvent;
                this._preventRequest = !0, n && (this._userVal = e.val(), this.val(this._userVal, {
                    source: "autocomplete",
                    itemIndex: this._curItemIndex
                })), t ? this.del("_preventRequest")._getPopup().hide() : (this._returnFocus = !0, this.bindToDoc("mouseup touchend", this._onDocMouseUp), n || (this._preventHide = !0), this.afterCurrentEvent(function() {
                    this.setMod("focused", "yes").del("_preventRequest", "_preventHide")
                })), (n || o) && this.trigger("select", {
                    item: e,
                    byKeyboard: t
                })
            },
            _onItemMouseUp: function() {
                this._closePopupByMouseUp()
            },
            _onDocMouseUp: function() {
                this._closePopupByMouseUp()
            },
            _closePopupByMouseUp: function() {
                this.unbindFromDoc("mouseup touchend").del("_returnFocus")._getPopup().hide()
            },
            _getItemIndex: function(e) {
                return $.inArray(e, this._items)
            },
            _doRequest: function() {
                var t = this;
                t._userVal = t.val(), t.trigger("data-requested").getDataprovider().get(t.val(), function(i) {
                    t.trigger("data-received", i);
                    var n = t._getPopup(),
                        o = i.items || i;
                    t.foot && o.length && -1 === $.inArray(t.foot, o) && o.push(t.foot), o.length ? (t._curItemIndex = -1, e.update(n.elem("items"), t._buildItemsHtml(o), function() {
                        n.isShown() || (n.show(t.elem("box")), t._setWidth()), n.repaintShadowIfNeeded(), t._items = n.findBlocksInside("b-autocomplete-item"), t.trigger("update-items")
                    })) : n.hide()
                })
            },
            _setWidth: function() {
                this._hasPopupFade() && this._getPopup().domElem.css("width", this.elem("box").outerWidth())
            },
            _buildItemsHtml: function(e) {
                var t = this;
                return BEMHTML.apply($.map(e, function(e, i) {
                    var n, o = {
                        block: "b-autocomplete-item",
                        data: e,
                        mods: {
                            type: $.isArray(e) ? e[0] : "text"
                        },
                        suggestVersion: t.params.dataprovider.version || 4
                    };
                    return $.isArray(e) && $.isPlainObject(n = e.concat().pop()) && $.extend(o, n), o
                }))
            },
            setFoot: function(e) {
                return this.foot = e, this.foot
            },
            getDefaultParams: function() {
                return $.extend(this.__base(), {
                    updateOnEnter: !0,
                    debounceDelay: 50,
                    showListOnFocus: !0
                })
            }
        })
    }(), BEM.decl({
        name: "input__dataprovider",
        baseBlock: "i-request_type_ajax"
    }, {
        get: function(e, t) {
            return this.__base({
                part: e
            }, function(e) {
                t.call(this, {
                    items: e[1],
                    metainfo: e[2]
                })
            })
        }
    }), BEM.DOM.decl("b-autocomplete-item", {
        val: function() {
            return this.params.val || this.elem("text").text() || this.domElem.text()
        },
        enter: function() {},
        select: function(e) {}
    }), BEM.DOM.decl("b-autocomplete-item", {}, {
        live: function() {
            this.liveBindTo("mouseover mouseout mousedown mouseup", function(e) {
                this.trigger(e.type)
            })
        }
    }), BEM.HTML.decl("b-autocomplete-item", {
        onBlock: function(e) {
            var t = e.param("data"),
                i = BEM.blocks["i-common__string"].escapeHTML($.isArray(t) ? t[1] : t);
            $.isArray(e.param("search_cgi")) && e.js({
                cgi: e.param("search_cgi")
            }), e.tag("li").mod("pers", e.param("pers") ? "yes" : !1).content(BEM.blocks["i-common__string"].highlight(i, e.param("hl"))).js(!0)
        }
    }), BEM.DOM.decl({
        block: "b-autocomplete-item",
        modName: "nav",
        modVal: "yes"
    }, {
        enter: function() {
            return !1
        },
        select: function(e) {
            return e && $('<form style="display:none" action="' + this.val() + '" target="_blank"/>').appendTo("body").submit().remove(), {
                needEvent: !0
            }
        }
    }, {
        getUrl: function(e) {
            return (e.match(/^\w[\w-]*:\/\//g) ? "" : "http://") + e
        }
    }), BEM.DOM.decl({
        block: "b-autocomplete-item",
        modName: "type",
        modVal: "nav"
    }, {
        onSetMod: {
            js: function() {
                this.setMod("nav", "yes")
            }
        },
        enter: function() {
            return this.__base.apply(this, arguments)
        },
        select: function() {
            return this.__base.apply(this, arguments)
        }
    }), BEM.HTML.decl({
        block: "b-autocomplete-item",
        modName: "type",
        modVal: "nav"
    }, {
        onBlock: function(e) {
            var t = e.param("data"),
                i = 4 == e.param("suggestVersion"),
                n = t[4] || t[3],
                o = (n.match(/^\w[\w-]*:\/\//g) ? "" : "http://") + n;
            e.js({
                val: o
            }).content({
                elem: "link",
                url: o,
                title: BEM.blocks["i-common__string"].escapeHTML(i ? t[3] : t[2]),
                description: BEM.blocks["i-common__string"].highlight(i ? t[2] : t[1], e.param("hl"))
            })
        },
        onElem: {
            link: function(e) {
                e.tag("a").attrs({
                    href: e.param("url"),
                    target: "_blank"
                }).content([{
                    elem: "link-url",
                    tag: "span",
                    content: e.param("title")
                }, {
                    elem: "link-info",
                    tag: "span",
                    content: ["&nbsp;&mdash; "].concat(e.param("description"))
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "b-autocomplete-item",
        modName: "type",
        modVal: "foot"
    }, {
        select: function() {
            return !1
        }
    }), BEM.HTML.decl({
        block: "b-autocomplete-item",
        modName: "type",
        modVal: "foot"
    }, {
        onBlock: function(e) {
            e.mod("enterable", "no").content($.map(e.param("data").slice(1), function(e) {
                return $.isArray(e) ? {
                    tag: "span",
                    elem: "foot",
                    content: e[0]
                } : e
            }))
        }
    }), BEM.HTML.decl({
        block: "b-autocomplete-item",
        modName: "type",
        modVal: "lingvo"
    }, {
        onBlock: function(e) {
            var t = e.param("data")[1];
            e.content([{
                tag: "span",
                elem: "text",
                content: t.text
            }, {
                tag: "span",
                elem: "translation",
                content: [" — ", t.translation]
            }])
        }
    }), BEM.decl({
        block: "i-dataprovider"
    }, {
        get: function(e, t) {
            this._contextBlock[this.params.method](e).then(t)
        },
        setBlock: function(e) {
            this._contextBlock = e
        }
    }), BEM.JSON.decl("radiobox", {
        onElem: {
            radio: function(e) {
                var t = e.params(),
                    i = t.controlAttrs || {};
                i.autocomplete || (i.autocomplete = "off", t.controlAttrs = i)
            }
        }
    }),
    function(e, t) {
        e.DOM.decl("radiobox", {
            onSetMod: {
                js: function() {
                    var e = this;
                    e._val = e.findElem(e.elem("radio", "checked", "yes"), "control").val(), e.elem("control").each(function(t, i) {
                        var n = [];
                        if (e._isControlFocused($(i)) && n.push("focused"), i.checked && n.push("checked"), n[0]) {
                            var o = e.__self._getRadioByElem($(i));
                            n.forEach(function(t) {
                                e.setMod(o, t, "yes")
                            })
                        }
                    })
                },
                disabled: {
                    yes: function() {
                        this.setMod(this.elem("radio"), "disabled", "yes")
                    },
                    "": function() {
                        this.delMod(this.elem("radio"), "disabled")
                    }
                }
            },
            onElemSetMod: {
                radio: {
                    focused: {
                        yes: function(e) {
                            this.delMod(this.elem("radio", "focused", "yes"), "focused");
                            var t = this.findElem(e, "control");
                            this._isControlFocused(t) || t.focus(), this.afterCurrentEvent(function() {
                                this.trigger("focus", {
                                    current: e
                                })
                            })
                        },
                        "": function(e) {
                            this.afterCurrentEvent(function() {
                                this.trigger("blur", {
                                    prev: e
                                })
                            })
                        }
                    },
                    checked: {
                        yes: function(e) {
                            this._val = this.findElem(e, "control").prop("checked", !0).val();
                            var t = this.elem("radio", "checked", "yes");
                            this.delMod(t, "checked"), this.trigger("change", {
                                current: e,
                                prev: t
                            })
                        }
                    },
                    hovered: function(e) {
                        return !this.isDisabled(e)
                    },
                    disabled: function(e, t, i) {
                        e.find(this.buildSelector("control")).prop("disabled", "yes" === i)
                    }
                }
            },
            _isControlFocused: function(e) {
                try {
                    return e[0] === this.__self.doc[0].activeElement
                } catch (t) {
                    return !1
                }
            },
            isDisabled: function(e) {
                return this.hasMod(e, "disabled", "yes")
            },
            val: function(e) {
                if ("undefined" == typeof e) return this._val;
                var t = this;
                return this.elem("control").each(function(i, n) {
                    return n.value === e ? (t.setMod(t.__self._getRadioByElem($(n)), "checked", "yes"), !1) : void 0
                }), t
            },
            name: function(e) {
                var t = this.elem("control");
                return arguments.length ? (t.attr("name", e), this) : t.attr("name")
            },
            getCurrent: function() {
                return this.findElem("radio", "checked", "yes")
            },
            uncheckAll: function() {
                var e = this.elem("radio", "checked", "yes");
                return this.delMod(e, "checked").findElem(e, "control").prop("checked", !1), this._val = t, this.trigger("change", {
                    current: t,
                    prev: e
                }), this
            },
            _onLeftClick: function(e) {
                this.isDisabled(e.data.domElem) || this.setMod(e.data.domElem, "focused", "yes")
            },
            _onChange: function(e) {
                this.setMod(this.__self._getRadioByElem(e.data.domElem), "checked", "yes")
            }
        }, {
            live: function() {
                return this.liveBindTo("radio", "leftclick tap", function(e) {
                    this._onLeftClick(e)
                }).liveBindTo("control", "change", function(e) {
                    this._onChange(e)
                }).liveBindTo("radio", "mouseover mouseout", function(e) {
                    this.setMod(e.data.domElem, "hovered", "mouseover" === e.type ? "yes" : "")
                }).liveBindTo("control", "focusin focusout", function(e) {
                    this.setMod(this.__self._getRadioByElem(e.data.domElem), "focused", "focusin" === e.type ? "yes" : "")
                }), !1
            },
            _getRadioByElem: function(e) {
                return e.closest(this.buildSelector("radio"))
            }
        })
    }(BEM), BEM.JSON.decl("check-button", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.controlAttrs || {};
            i.autocomplete || (i.autocomplete = "off", t.controlAttrs = i)
        }
    }), BEM.DOM.decl({
        block: "check-button",
        baseBlock: "checkbox"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this.elem("control").attr({
                    role: "button",
                    "aria-labelledby": this.elem("text").attr("id"),
                    "aria-pressed": this.hasMod("checked", "yes")
                }), this.bindTo("keyup", function(e) {
                    e.shiftKey || e.ctrlKey || e.altKey || 13 === e.which && this.elem("control").click()
                })
            },
            checked: function(e, t) {
                if (this.__base.apply(this, arguments) === !1) return !1;
                var i = "yes" === t;
                this.elem("control").attr("aria-pressed", i)
            },
            pressed: function(e, t) {
                return this.isDisabled() ? !1 : void 0
            }
        },
        _onMouseDown: function() {
            this.setMod("pressed", "yes"), this.bindToDoc("mouseup touchend", function() {
                this.delMod("pressed"), this.unbindFromDoc("mouseup touchend")
            })
        }
    }, {
        live: function() {
            return this.__base.apply(this, arguments), this.liveBindTo("mousedown touchstart", function(e) {
                this._onMouseDown(e)
            }), !1
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "autosize",
        modVal: "yes"
    }, {
        getDefaultParams: function() {
            var e = this.__base();
            return e.offsetWithoutTail = 5, e
        },
        repaint: function() {
            return this._saveDefault(), this.__base(), this.domElem.css({
                maxWidth: this.size.width,
                height: this.size.height
            }), this
        },
        _saveDefault: function() {
            this._defSize || (this._defSize = this.getPopupSize())
        },
        _resetDefault: function() {
            return this._defSize = null, this.domElem.css({
                maxWidth: "",
                height: ""
            }), this
        },
        _getAvailableSpace: function(e) {
            return this._owner ? {
                width: this._getAvailableWidth(e),
                height: this._getAvailableHeight(e)
            } : $.extend({}, this._defSize)
        },
        _getAvailableWidth: function(e) {
            var t = BEM.DOM.getWindowSize(),
                i = t.width,
                n = e.offset,
                o = this._owner[0].getBoundingClientRect(),
                s = $.extend({}, this._defSize);
            switch (e.to) {
                case "left":
                    i = o.left, "number" == typeof n && (i -= n), "object" == typeof n && (n.left && (i += n.left), n.right && (i -= n.right));
                    break;
                case "right":
                    i = t.width - o.right, "number" == typeof n && (i -= n), "object" == typeof n && (n.left && (i -= n.left), n.right && (i += n.right))
            }
            return ("left" === e.to || "right" === e.to) && (i -= this._tailPos ? 2 * this.params.tail.width : this.params.offsetWithoutTail), Math.min(s.width, i)
        },
        _getAvailableHeight: function(e) {
            var t = BEM.DOM.getWindowSize(),
                i = t.height,
                n = e.offset,
                o = this._owner[0].getBoundingClientRect(),
                s = $.extend({}, this._defSize);
            switch (e.to) {
                case "bottom":
                    i = t.height - o.bottom, "number" == typeof n && (i -= n), "object" == typeof n && (n.bottom && (i += n.bottom), n.top && (i -= n.top));
                    break;
                case "top":
                    i = o.top, "number" == typeof n && (i -= n), "object" == typeof n && (n.bottom && (i -= n.bottom), n.top && (i += n.top))
            }
            return ("bottom" === e.to || "top" === e.to) && (i -= this._tailPos ? 2 * this.params.tail.height : this.params.offsetWithoutTail), Math.min(s.height, i)
        },
        _calcTop: function(e) {
            var t, i = this.__base(e),
                n = $(window).scrollTop(),
                o = BEM.DOM.getWindowSize(),
                s = this.getPlacingSize(),
                r = this.getOwnerPos(),
                a = this.getOwnerSize();
            return 0 > i && (i = 0), t = Math.max(o.height + n, r.top + a.height), i + s.height > t && (i = t - s.height), i
        },
        _calcLeft: function(e) {
            var t, i = this.__base(e),
                n = $(window).scrollLeft(),
                o = BEM.DOM.getWindowSize(),
                s = this.getPlacingSize(),
                r = this.getOwnerPos(),
                a = this.getOwnerSize();
            return 0 > i && (i = 0), t = Math.max(o.width + n, r.left + a.width), i + s.width > t && (i = t - s.width), i
        },
        getPlacingSize: function() {
            return this._availSizes
        },
        _calcPlacingSize: function(e) {
            return this._availSizes = this._getAvailableSpace(e), this._availSizes
        },
        _calcVisibilityFactor: function() {
            var e = this._defSize,
                t = this.getPlacingSize(),
                i = t.height * t.width,
                n = e.height * e.width;
            return i / n * 100
        }
    }), BEM.JSON.decl("select", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.attrs || {};
            i.autocomplete || (i.autocomplete = "off", t.attrs = i)
        }
    }), BN.addDecl("select").staticProp({
        createJson: function(e) {
            var t, i = {
                    block: "select",
                    mods: $.extend({
                        size: "m",
                        theme: "normal"
                    }, e.mods || {})
                },
                n = e.value ? e.value.toString() : "",
                o = Object.keys(e.options).map(function(i) {
                    var o = i === n,
                        s = {
                            elem: "option",
                            attrs: {
                                value: i
                            },
                            content: e.options[i]
                        };
                    return o && (s.attrs.selected = "selected", t = i), s
                });
            return t || (o[0].attrs.selected = "selected", t = o[0].content), ["name", "mix"].forEach(function(t) {
                e[t] && (i[t] = e[t])
            }), i.content = [{
                block: "button",
                content: t
            }, {
                elem: "control",
                content: o
            }], i
        }
    }).done(),
    function(e, t, i) {
        function n(e, t, i) {
            var o = {};
            return "option" === e.item ? (o = {
                block: c,
                elem: "option",
                tag: "option",
                attrs: {
                    value: e.value
                },
                content: e.content
            }, e.disabled && (o.attrs.disabled = "disabled"), e.selected && (o.attrs.selected = "selected")) : "optgroup" === e.item && (o = {
                elem: "option-group",
                tag: "optgroup",
                attrs: {
                    label: e.label
                }
            }, e.disabled && (o.attrs.disabled = "disabled"), o.content = Array.isArray(e.content) ? e.content.map(function(e, t) {
                return n(e, t)
            }) : e.content), o.block = c, o
        }
        var o = e.browser.opera && e.browser.version < 12.1 ? "keypress" : "keydown",
            s = e.browser,
            r = s.msie && parseInt(s.version, 10) <= 10,
            a = s.msie && 8 === parseInt(s.version, 10),
            l = null,
            c = "select";
        t.DOM.decl("select", {
            onSetMod: {
                js: function() {
                    this._items = [], this._curItemIndex = -1, this._scrollableElemOutsidePopup = null, this._rowHeight = 22, this.on("change", this._redrawParentPopup), this._getSelectedText() !== this._getButtonText() && this.elem("control").trigger("change")
                },
                disabled: function(e, t) {
                    var i = "yes" === t;
                    this.elem("control").attr("disabled", i), this._getButton().setMod(e, t), i && this.delMod("opened").delMod("focused")
                },
                focused: {
                    yes: function() {
                        return this.hasMod("disabled", "yes") ? !1 : (this._useNativeControl() || this.bindTo(o, this._onKeyDown), void this.afterCurrentEvent(function() {
                            this.trigger("focus")
                        }))
                    },
                    "": function() {
                        this._useNativeControl() || this.delMod("opened").unbindFrom(o), this.afterCurrentEvent(function() {
                            this.trigger("blur")
                        })
                    }
                }
            },
            isDisabled: function() {
                return this.hasMod("disabled", "yes")
            },
            isOpened: function() {
                return this.hasMod("opened", "yes")
            },
            open: function() {
                return this.setMod("opened", "yes")
            },
            close: function() {
                return this.delMod("opened")
            },
            val: function(t, i) {
                if ("undefined" == typeof t) return this.elem("control").val();
                var n, o = -1;
                return this.findElem("option").each(function(i) {
                    this.value === t && !this.disabled && (n = e(this).parent("optgroup")[0], !(n && n.disabled)) && (o = i)
                }), o > -1 && this._selectedIndex(o, i), this
            },
            name: function(e) {
                var t = this.elem("control");
                return arguments.length ? (t.attr("name", e), this) : t.attr("name")
            },
            _selectedIndex: function(t, i) {
                var n = this._getSelectedIndex();
                return "undefined" == typeof t || t === n ? n : (this.elem("control").prop("selectedIndex", t), this._useNativeControl() || (this._setButtonText(this._getSelectedText()), this._items[0] && this.delMod(this._items, "selected").setMod(this._items.eq(t), "selected", "yes")), this.trigger("change", e.extend({
                    index: t,
                    prev: n
                }, i)), t)
            },
            setOptions: function(i) {
                return i ? (t.DOM.update(this.elem("control"), BEMHTML.apply(e.map(i, n))), this.redraw()) : this
            },
            redraw: function() {
                return this._popup && this._redrawList(), this.elem("control").trigger("change"), this
            },
            _useNativeControl: function() {
                return null !== l ? l : l = "none" !== this.elem("control").css("display")
            },
            _redrawParentPopup: function() {
                return this._isParentPopup() && this._popup._parent.repaint(), this
            },
            _isParentPopup: function() {
                return this._popup && this._popup._parent && !this.hasMod("layout", "fixed")
            },
            _onSelectChange: function() {
                var e = this;
                e._setButtonText(e._getSelectedText()), e.trigger("change", {
                    index: e._getSelectedIndex(),
                    prev: -1
                })
            },
            _onControlFocusInOut: function(e) {
                this._useNativeControl() && this.toggleMod("focused", "yes", "", "focusin" === e.type)
            },
            _onMouseDown: function(e) {
                this._isControlFocused() && e.preventDefault()
            },
            _onKeyDown: function(e) {
                var t = 38 === e.keyCode,
                    i = 40 === e.keyCode,
                    n = 13 === e.keyCode,
                    o = 32 === e.keyCode;
                if (t || i) {
                    if (e.preventDefault(), !this.isOpened()) return this.open();
                    var s = this._items.length,
                        r = this._curItemIndex;
                    if (t && 0 === r || i && r > s - 2) return;
                    if (s) {
                        var a = i ? 1 : -1,
                            l = 0;
                        for (l = r; l >= 0 && s >= l;)
                            if (l += a, this._isSelectableItem(this._items.eq(l))) {
                                r = l;
                                break
                            }
                        this._onEnterItem(this._items.eq(r), !0)
                    }
                }(n || o) && this._onEnterItem(this._items.eq(this._curItemIndex), !0, !0)
            },
            _onEnterItem: function(e, t, i) {
                this.elem("button").attr("aria-activedescendant", e.attr("id"));
                var n = this._curItemIndex,
                    o = this._getItemIndex(e),
                    s = this._items;
                n > -1 && this.delMod(s.eq(n), "hovered"), o > -1 && (this._curItemIndex = o, this.setMod(s.eq(o), "hovered", "yes")), i && this._selectedIndex(this._curItemIndex), t && this._scrollToCurrent()
            },
            _onLeaveItem: function(e) {
                var t = this._curItemIndex;
                t > -1 && t === this._getItemIndex(e) && (this.delMod(this._items.eq(t), "hovered")._curItemIndex = -1)
            },
            _onSelectItem: function(e) {
                return this._isSelectableItem(e) && this._selectedIndex(this._curItemIndex), this.close()
            },
            _onButtonFocus: function() {
                this.setMod("focused", "yes")
            },
            _findScrollableElemOutsidePopup: function() {
                if (null === this._scrollableElemOutsidePopup) {
                    var e, t = this._getPopup().domElem;
                    do t = t.parent(), e = t.css("overflow-y"); while ("scroll" !== e && "auto" !== e && "HTML" !== t.prop("tagName"));
                    this._scrollableElemOutsidePopup = t
                }
                return this._scrollableElemOutsidePopup
            },
            _onButtonBlur: function() {
                if (this.isOpened() && this._isPopupFocused())
                    if (a) {
                        var e = this._findScrollableElemOutsidePopup(),
                            t = e.scrollTop();
                        this._focusButton(), e.scrollTop(t)
                    } else this._focusButton();
                else this.delMod("focused")
            },
            _onButtonPress: function() {
                this.toggleMod("opened", "yes", "")
            },
            _focusButton: function() {
                return this._getButton().setMod("focused", "yes"), this
            },
            _blurButton: function() {
                return this._getButton().delMod("focused"), this
            },
            _isPopupFocused: function() {
                try {
                    return this._getPopup().containsDomElem(e(document.activeElement))
                } catch (t) {
                    return !1
                }
            },
            _getButtonText: function() {
                return this._getButton().elem("text").text()
            },
            _setButtonText: function(e) {
                this._getButton().elem("text").text(e || "​"), r && this.domElem.parent().css("outline", "")
            },
            _isOutsideClicked: function(t, i) {
                return this.containsDomElem(e(i.target))
            },
            _getItemIndex: function(t) {
                return e.inArray(t.get(0), this._items)
            },
            _getSelectedText: function() {
                return this.elem("control").find(":selected").text()
            },
            _getSelectedIndex: function() {
                return this.elem("control").prop("selectedIndex")
            },
            _isSelectableItem: function(e) {
                var t;
                return t = this.hasMod(e, "disabled", "yes") || this.hasMod(e, "label", "yes") ? !1 : !0
            },
            _getButton: function() {
                return this._button || (this._button = this.findBlockOn("button", "button"))
            },
            _getRowHeight: function() {
                return this.findElem(this._getPopup().domElem, "item").outerHeight()
            },
            _isControlFocused: function() {
                try {
                    return this.containsDomElem(e(this.__self.doc[0].activeElement))
                } catch (t) {
                    return !1
                }
            },
            destruct: function() {
                this._outPopup && this._outPopup.un("outside-click"), this.delMod("opened");
                var e = this._popup;
                e && e.domElem && e.destruct(), this.__base.apply(this, arguments)
            },
            getDefaultParams: function() {
                return {
                    rows: 15,
                    popupMods: {
                        direction: "down"
                    }
                }
            }
        }, {
            live: function() {
                return this.liveBindTo("control", "change", function(e) {
                    this._onSelectChange()
                }), this.liveBindTo("control", "focusin focusout", function(e) {
                    this._onControlFocusInOut(e)
                }), this.liveBindTo("mousedown", function(e) {
                    this._onMouseDown(e)
                }), !1
            }
        })
    }(jQuery, BEM),
    function(e, t, i) {
        var n = e.browser.opera && e.browser.version < 15;
        t.DOM.decl("select", {
            onElemSetMod: {
                item: {
                    hovered: function() {
                        n && this._popup.domElem.css("display", "inline").css("display", "")
                    }
                }
            }
        })
    }(jQuery, BEM), BEM.DOM.decl("select", {
        setOptions: function() {
            this.__base.apply(this, arguments), this._setButtonText(this._getSelectedText())
        }
    }),
    function(e) {
        function t(e, t, i) {
            var n = {
                block: "select",
                elem: "item",
                content: {
                    elem: "text",
                    tag: "span",
                    content: t || " &nbsp; "
                },
                elemMods: {}
            };
            return i && (n.elemMods = i), n
        }

        function i(e) {
            function i(e, n) {
                var l = e.length;
                if (l) {
                    var c = 0;
                    do {
                        var d = $(e[c]),
                            u = d.attr("disabled") && {
                                disabled: "yes"
                            };
                        if (d.is("optgroup")) {
                            a = !0, !d.prev().is("optgroup") && c > 0 && s.push(o), r.push(s), s = [], s.push(t(d, d.attr("label"), $.extend({
                                label: "yes"
                            }, u, n))), i(d.children(), $.extend({
                                inner: "yes"
                            }, u, n));
                            var h = s;
                            s = r.pop(), s.push({
                                block: "select",
                                elem: "group",
                                content: h
                            })
                        } else s.push(t(d, d.text(), $.extend(u, d.is(":selected") && {
                            selected: "yes"
                        }, n)))
                    } while (++c < l || (a = !1))
                }
            }
            var n = "select",
                o = {
                    block: n,
                    elem: "separator",
                    tag: "i"
                },
                s = [],
                r = [],
                a = !1;
            return i(e), BEMHTML.apply(s)
        }
        e.DOM.decl("select", {
            onSetMod: {
                js: function() {
                    this.__base.apply(this, arguments), this._initButton()
                }
            },
            _initButton: function() {
                this._getButton().on("focus", this._onButtonFocus, this).on("blur", this._onButtonBlur, this).on("press", this._onButtonPress, this)
            },
            _redrawList: function() {
                var t, n = this,
                    o = this._getPopup().domElem;
                return e.DOM.update(this.findElem(o, "list"), i(this.elem("control").children())), t = this.findElem(o, "item"), this._curItemIndex = -1, this._items = t.filter(function() {
                    return !n.hasMod($(this), "label", "yes")
                }), this
            }
        })
    }(BEM), BEM.DOM.decl("select", {
        _redrawList: function() {
            this.__base();
            var e = this;
            this.bindTo(e._items, {
                mouseup: function(t) {
                    1 === t.which && (t.preventDefault(), e._onSelectItem(t.data.domElem))
                },
                mouseover: function(t) {
                    e._onEnterItem(t.data.domElem)
                },
                mouseout: function(t) {
                    e._onLeaveItem(t.data.domElem)
                }
            })
        }
    }),
    function(e) {
        function t(e, t, i) {
            var n = {
                block: "select",
                elem: "item",
                content: {
                    elem: "text",
                    tag: "span",
                    content: t || " &nbsp; "
                },
                elemMods: {}
            };
            return i && (n.elemMods = i), n
        }

        function i(e) {
            function i(e, n) {
                var l = e.length;
                if (l) {
                    var c = 0;
                    do {
                        var d = $(e[c]),
                            u = d.attr("disabled") && {
                                disabled: "yes"
                            };
                        if (d.is("optgroup")) {
                            a = !0, !d.prev().is("optgroup") && c > 0 && s.push(o), r.push(s), s = [], s.push(t(d, d.attr("label"), $.extend({
                                label: "yes"
                            }, u, n))), i(d.children(), $.extend({
                                inner: "yes"
                            }, u, n));
                            var h = s;
                            s = r.pop(), s.push({
                                block: "select",
                                elem: "group",
                                content: h
                            })
                        } else s.push(t(d, d.html(), $.extend(u, d.is(":selected") && {
                            selected: "yes"
                        }, n)))
                    } while (++c < l || (a = !1))
                }
            }
            var n = "select",
                o = {
                    block: n,
                    elem: "separator",
                    tag: "i"
                },
                s = [],
                r = [],
                a = !1;
            return i(e), BEMHTML.apply(s)
        }
        e.DOM.decl("select", {
            _redrawList: function() {
                var t, n = this,
                    o = this._getPopup().domElem;
                return e.DOM.update(this.findElem(o, "list"), i(this.elem("control").children())), t = this.findElem(o, "item"), this._curItemIndex = -1, this._items = t.filter(function() {
                    return !n.hasMod($(this), "label", "yes")
                }), this.bindTo(n._items, {
                    mouseup: function(e) {
                        1 === e.which && (e.preventDefault(), n._onSelectItem(e.data.domElem))
                    },
                    mouseover: function(e) {
                        n._onEnterItem(e.data.domElem)
                    },
                    mouseout: function(e) {
                        n._onLeaveItem(e.data.domElem)
                    }
                }), this
            }
        })
    }(BEM), BEM.DOM.decl("select", {
        onSetMod: {
            opened: {
                yes: function() {
                    if (this.hasMod("disabled", "yes")) return !1;
                    this._drawPopup();
                    var e = this.findElem(this._popup.domElem, "item", "selected", "yes");
                    this.elem("button").attr({
                        "aria-activedescendant": e.attr("id"),
                        "aria-expanded": !0
                    })
                },
                "": function() {
                    this.elem("button").attr("aria-expanded", !1).removeAttr("aria-activedescendant"), this._getPopup().hide()
                }
            }
        },
        _getPopupContent: function(e) {
            return {
                block: e,
                elem: "list"
            }
        },
        _getPopupMix: function(e) {
            return {
                block: e,
                elem: "popup",
                elemMods: {}
            }
        },
        _getPopup: function() {
            if (this._popup) return this._popup;
            var e = this,
                t = e.params,
                i = e.__self.getName(),
                n = this._getPopupContent(i),
                o = this._getPopupMix(i),
                s = {
                    animate: "no"
                },
                r = {
                    directions: [{
                        to: "bottom",
                        axis: "left",
                        offset: {
                            top: 8
                        }
                    }, {
                        to: "top",
                        axis: "left",
                        offset: {
                            bottom: 8
                        }
                    }]
                };
            ["size", "layout", "theme", "width"].forEach(function(t) {
                e.hasMod(t) && (o.elemMods[t] = e.getMod(t))
            }), $.extend(o.elemMods, t.elemPopupMods), $.extend(s, t.popupMods), $.extend(r, t.popupParams);
            var a = $(BEMHTML.apply({
                block: "popup",
                mods: s,
                mix: o,
                js: r,
                content: {
                    elem: "content",
                    content: n
                }
            }));
            return (e._popup = e.findBlockOn(a, "popup")).on({
                show: function() {
                    e._curItemIndex = e._getSelectedIndex();
                    var t = e._items.eq(e._curItemIndex);
                    e.delMod(e._items, "selected").setMod(t, "hovered", "yes").setMod(t, "selected", "yes")
                },
                "outside-click": function(t, i) {
                    e._isOutsideClicked(t, i) ? t.preventDefault() : e._blurButton()
                },
                hide: function() {
                    e.delMod("opened").delMod(e._items, "hovered").delMod(e.findElem(e._popup.domElem, "popup"), "scrollable")
                }
            }).bindTo("mousedown", function(e) {
                e.preventDefault()
            }), BEM.DOM.append(BEM.DOM.scope, e._popup.domElem), e._redrawList(), e._outPopup = e.findBlockOutside("button", "popup"), e._outPopup && e._outPopup.on("outside-click", function(t, i) {
                e._popup.containsDomElem($(i.target)) && t.preventDefault()
            }), e._popup
        },
        _calcPopupDimensions: function() {
            this._popupContent || (this._popupContent = this._getPopup().findBlockInside("popup").elem("content"));
            var e = parseInt(this.params.rows, 10) || !1;
            if (e && this.findElem(this._popupContent, "item").size() > e) {
                this._rowHeight = this._getRowHeight();
                var t = parseInt(this._getPopup().domElem.css("height"), 10);
                if (t > e * this._rowHeight) this._getPopup().setSize({
                    height: e * this._rowHeight
                }), this.setMod(this.findElem(this._getPopup().domElem, "popup"), "scrollable", "yes");
                else {
                    var i = e * this._rowHeight + "px";
                    this._getPopup().domElem.css("height") !== i && this._getPopup().setSize({
                        height: i
                    })
                }
            } else this._getPopup().setSize({
                height: "auto"
            })
        },
        _drawPopup: function() {
            var e = this.findBlockInside("select"),
                t = this._getPopup();
            t.show(e), this._calcPopupDimensions(), this._scrollToCurrent()
        },
        _scrollToCurrent: function() {
            if (this._popupContent && !(this._curItemIndex < 0)) {
                var e, t = this._items.eq(this._curItemIndex).get(0).offsetTop,
                    i = this._popupContent,
                    n = i.scrollTop(),
                    o = t - n,
                    s = 2 * this._rowHeight;
                o > i.height() - s ? e = t - s : n && s > o && (e = t - i.height() + s), e && i.scrollTop(e)
            }
        }
    }, {
        SHADOW_OFFSET: 1
    }), BEM.JSON.decl("radio-button", {
        onElem: {
            radio: function(e) {
                var t = e.params(),
                    i = t.controlAttrs || {};
                i.autocomplete || (i.autocomplete = "off", t.controlAttrs = i)
            }
        }
    }),
    function(e, t) {
        e.DOM.decl({
            block: "radio-button",
            baseBlock: "radiobox"
        }, {
            onElemSetMod: {
                radio: {
                    checked: function(e, t, i) {
                        this.__base.apply(this, arguments), this.setMod(e, "pressed", i)
                    },
                    "next-for-pressed": {
                        yes: function() {
                            this.delMod(this.elem("radio", "next-for-pressed", "yes"), "next-for-pressed")
                        }
                    },
                    pressed: {
                        yes: function(e) {
                            this.delMod(this.elem("radio"), "pressed").setMod(e.next(), "next-for-pressed", "yes")
                        },
                        "": function(e) {
                            this.delMod(e.next(), "next-for-pressed")
                        }
                    }
                }
            },
            _onMouseDown: function(e) {
                var t = e.data.domElem;
                this.isDisabled(t) || this.hasMod(t, "checked", "yes") || (this.setMod(t, "pressed", "yes"), this.bindToDoc("mouseup touchend", function(e) {
                    this.afterCurrentEvent(function() {
                        var i = this.findElem(t, "control");
                        i.prop("checked") || (t.find(e.target).add(t).length ? i.trigger("change").focus() : this.delMod(t, "pressed").setMod(this.elem("radio", "checked", "yes"), "pressed", "yes"))
                    }), this.unbindFromDoc("mouseup touchend")
                }))
            }
        }, {
            live: function() {
                return this.__base.apply(this, arguments), this.liveBindTo("radio", "mousedown", function(e) {
                    this._onMouseDown(e)
                }), !1
            }
        })
    }(BEM), BEM.JSON.decl({
        name: "segment-panel",
        modName: "multiline",
        modVal: "yes"
    }, {
        onElem: {
            content: function(e) {
                e.js({
                    value: e.params().value
                }).mix({
                    block: "error-message",
                    mods: {
                        type: "popup"
                    }
                }).content([{
                    block: "input",
                    mods: {
                        type: "textarea",
                        size: "s"
                    },
                    content: {
                        elem: "control"
                    },
                    mix: [{
                        block: "segment-panel",
                        elem: "multiline-ctrl"
                    }]
                }])
            },
            header: function(e) {
                var t = e.param("value"),
                    i = e.param("segment");
                e.beforeContent([i.disable_suggest ? void 0 : {
                    elem: "search-multiline"
                }, {
                    elem: "inverse",
                    type: "multiline",
                    value: (t || {}).conjunction
                }])
            },
            footer: function(e) {
                e.content([{
                    elem: "multiline-desc"
                }, {
                    elem: "multiline-desc-list"
                }])
            },
            "search-multiline": function(e) {
                e.mix([{
                    elem: "search"
                }]).content({
                    block: "input",
                    mods: {
                        suggest: "yes",
                        size: "s"
                    },
                    js: {
                        dataprovider: {
                            name: "i-dataprovider",
                            block: "segment-panel",
                            method: "dimensionSuggest"
                        },
                        debounceDelay: 300,
                        popupMods: {
                            size: "s",
                            fade: "yes"
                        }
                    },
                    content: {
                        elem: "control"
                    }
                })
            },
            "multiline-desc-list": function(e) {
                e.tag("ul").content([{
                    elem: "multiline-desc-item",
                    tag: "li",
                    content: BEM.I18N("segment-panel", "multiline-desc-item-1")
                }, {
                    elem: "multiline-desc-item",
                    tag: "li",
                    content: BEM.I18N("segment-panel", "multiline-desc-item-2")
                }, {
                    elem: "multiline-desc-item",
                    tag: "li",
                    content: BEM.I18N("segment-panel", "multiline-desc-item-3")
                }, {
                    elem: "multiline-desc-item",
                    tag: "li",
                    content: BEM.I18N("segment-panel", "multiline-desc-item-4")
                }])
            },
            "multiline-desc": function(e) {
                e.tag("p").content(BEM.I18N("segment-panel", "multiline-desc"))
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "multiline",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                var e = this.findBlockInside("search-multiline", "input"),
                    t = this.elemParams("content").value;
                e && e.on("select", this._onSelectMultilineItem, this).getDataprovider().setBlock(this), t && (this.params.autofocus = "content"), this.findBlockInside("multiline-ctrl", "input").on("change", jQuery.debounce(this._change.bind(this), 300)), this.__base.apply(this, arguments), this.val(t)
            }
        },
        val: function(e) {
            return this._multilineVal(e)
        },
        dimensionSuggest: function(e) {
            var t = jQuery.extend(!0, {}, this._filter),
                i = this.params.segment,
                n = this._urlMode && this._urlMode.val(),
                o = n ? i[n] : i.dim,
                s = BN("i-promise").createChain(this);
            return e = e.trim(), e ? (e.match(/^[@~]/) || (e = "*" + e + "*"), t[i.id] = {
                urlMode: n,
                items: [e]
            }) : delete t[i.id], this._getSuggestData(t, [o], i, !0).then(s(function(e) {
                return {
                    items: (e && e.items || []).map(function(t) {
                        return ["lingvo", {
                            text: null === t.dimensions[0].name ? BEM.I18N("segment-panel", "undefined") : BN("i-string").escapeHTML(t.dimensions[0].name),
                            translation: BN("humanize").format("number", t.metrics[0]),
                            sampled: e.sampled
                        }]
                    })
                }
            }))
        },
        _multilineVal: function(e) {
            var t;
            return void 0 === e ? (t = this.findBlockInside("multiline-ctrl", "input").val().split(/\r?\n/).map(function(e) {
                return e.trim()
            }).filter(Boolean), t.length ? {
                conjunction: "exclude" === this.findBlockInside("inverse", "radiobox").val(),
                items: t
            } : null) : (this.findBlockInside("inverse", "radiobox").val(e.conjunction ? "exclude" : "include"), this.findBlockInside("multiline-ctrl", "input").val(e.items.join("\n")), this)
        },
        _change: function(e) {
            var t, i, n = this.val(),
                o = {},
                s = this;
            n && n.items && (t = n.items.some(function(e) {
                return e.match(/^~/)
            })), t ? (i = BN("i-promise").createChain(this), o[this.params.segmentId] = n, this._validateFilter(o).then(i(function() {
                BN("error-message").hideError(s), s._onChangeValue(e)
            }), i(function(e) {
                BN("error-message").showError(s, e)
            })).done()) : (BN("error-message").hideError(this), this._onChangeValue(e))
        },
        _validateFilter: function(e) {
            return BN("i-default-data").getMetrics({
                filter: e,
                period: this._period
            })
        }
    }), BEM.JSON.decl("error-message", {
        onElem: {
            message: function(e) {
                var t = [],
                    i = e.param("error");
                e.param("hasIcon") && t.push({
                    block: "icon",
                    elem: "alert",
                    mods: {
                        color: "white"
                    }
                }), e.param("hasCloser") && t.push({
                    block: "icon",
                    elem: "close",
                    mix: [{
                        block: "error-message",
                        elem: "close-button"
                    }],
                    mods: {
                        color: "white"
                    }
                }), t.push({
                    elem: "message-content",
                    error: i
                }), e.mix({
                    elem: "message-background"
                }).content(t)
            },
            "message-content": function(e) {
                var t = e.param("error");
                e.content(BN("i-error-message").getResponseText(t))
            }
        }
    }), BEM.DOM.decl("error-message", {}, {
        live: function() {
            this.liveBindTo("close-button", "leftclick", function() {
                this._hide()
            })
        },
        hideError: function(e) {
            var t = this._findErrorMessageHolder(e);
            return t ? t._hide() : void 0
        },
        showError: function(e, t) {
            var i = "string" == typeof t ? new BEM.blocks["i-error-message"].MetrikaError(t) : t,
                n = this._findErrorMessageHolder(e),
                o = i instanceof BEM.blocks["i-error-message"].MetrikaError;
            return o || setTimeout(function() {
                throw i
            }, 0), n ? n._show(i) : void 0
        },
        toggleError: function(e, t) {
            return this[t ? "showError" : "hideError"].apply(this, arguments)
        },
        _findErrorMessageHolder: function(e) {
            return e.findBlockOn("error-message") || e.findBlockInside("error-message")
        }
    }), BEM.decl("humanize", null, {
        _formattersCache: {},
        formatSecond: function(e) {
            var t = Math.round(Number(e)),
                i = [];
            return t >= 3600 && i.push(Math.floor(t / 3600)), i.push(Math.floor(t % 3600 / 60)), i.push(t % 60), i = i.map(function(e, t) {
                return 0 !== t ? this._pad(e) : e
            }, this), i.join(":")
        },
        formatMillisecond: function(e) {
            return BN("i-date").compactPeriodByColon(e)
        },
        formatNumber: function(e) {
            var t, i;
            return i = " ", e = parseFloat(e) || 0, t = Math.abs(e), e === 1 / 0 ? "+∞" : e === -(1 / 0) ? "-∞" : (e >= 1e9 ? e = this._removeUnsignificantZero((e / 1e9).toPrecision(3)) + i + BEM.I18N("humanize", "giga") : t >= 1e6 ? e = this._removeUnsignificantZero((e / 1e6).toPrecision(3)) + i + BEM.I18N("humanize", "mega") : t >= 100 ? e = this._humanizeInt(Math.round(e)) : t >= 1 ? e = this._removeUnsignificantZero(e.toPrecision(3)) : t >= .01 ? e = this._removeUnsignificantZero(e.toPrecision(2)) : 0 === e ? e = String(0) : (e = e.toExponential(2).split("e"), e[0] = this._removeUnsignificantZero(e[0]), e[1] = e[1] ? this._sup(e[1]) : "", e = e.join("×10")), this._humanizeDecimalDelim(e))
        },
        formatPercents: function(e, t) {
            var i;
            return e = this.formatDouble(e, t), i = this._thinspaceForPercents(e), BEM.I18N("humanize", "percents", {
                value: e,
                space: i
            })
        },
        formatInt: function(e, t) {
            return this.formatNumber(e, t)
        },
        formatDouble: function(e, t) {
            return this.formatNumber(e, t)
        },
        formatCurrency: function(e) {
            return e = parseFloat(e), isNaN(e) ? "0" : (e = Math.round(100 * e) / 100, this._humanizeInt(this._humanizeDecimalDelim(e)))
        },
        formatDateTime: function(e) {
            return BN("i-date").format(BN("i-date").localizedDateFormat("common-date-time-format"))(e)
        },
        formatDate: function(e) {
            return BN("i-date").format(BN("i-date").localizedDateFormat("common-date-format"))(e)
        },
        formatPhoneNumber: function(e) {
            var t, i, n, o = String(e).replace(/\s/g, "").match(/^((\+?(\d))?\((\d+)\))?([\d\-]{5,})$/);
            return o ? (t = o[3], i = o[4], n = o[5]) : n = String(e), (t ? "+" + t + " " : "") + (i ? "(" + i + ") " : "") + n.replace(/[^\d]/g, "").replace(/(\d\d)(?=(\d\d)+($))/g, "$1-")
        },
        format: function(e, t, i) {
            var n, o, s, r = i && i.svg ? BN("humanize-svg") : this;
            if (1 === arguments.length && (console.log("deprecated use of humanize.format"), t = e.value, e = e.type), o = this._getFormatter(e), n = r[o], !n) return setTimeout(function() {
                throw new Error(this._name + "." + o + "() for type " + e + " is not implemented")
            }.bind(r)), this._defaultFormatting(t);
            switch (s = n.call(r, t, i), typeof s) {
                case "string":
                    return s;
                case "object":
                    return BN("i-content").html(s, !0);
                default:
                    return String(s)
            }
        },
        _humanizeInt: function(e) {
            return this._noWrap(String(e).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, "$1 "))
        },
        _humanizeDecimalDelim: function(e) {
            var t = String(e).split(".");
            return t[0] + (t[1] ? BEM.I18N("humanize", "digit-delimiter") + t[1] : "")
        },
        _removeUnsignificantZero: function(e) {
            return -1 !== e.indexOf(".") ? e.replace(/\.?(0?)+$/g, "") : e
        },
        _pad: function(e) {
            return e = Number(e), 10 > e ? "0" + e : e
        },
        _noWrap: function(e) {
            return BN("i-content").html({
                block: "humanize",
                elem: "no-wrap",
                tag: "span",
                content: e
            }, !0)
        },
        _sup: function(e) {
            return BN("i-content").html({
                block: "humanize",
                elem: "sup",
                tag: "sup",
                content: e
            }, !0)
        },
        _thinspaceForPercents: function() {
            return " "
        },
        _getFormatter: function(e) {
            var t;
            return this._formattersCache[e] || (t = String(e).split("-").map(function(e) {
                return e.charAt(0).toUpperCase() + e.slice(1)
            }), t.unshift("format"), this._formattersCache[e] = t.join("")), this._formattersCache[e]
        },
        _defaultFormatting: function(e) {
            return String(e)
        }
    }), BEM.decl({
        name: "humanize-svg",
        baseBlock: "humanize"
    }, null, {
        _noWrap: function(e) {
            return BN("i-content").html({
                block: "humanize",
                elem: "no-wrap",
                tag: "tspan",
                content: e
            }, !0)
        },
        _sup: function(e) {
            return BN("i-content").html({
                block: "humanize",
                elem: "sup",
                tag: "tspan",
                attrs: {
                    dy: -7
                },
                content: e
            }, !0)
        },
        _thinspaceForPercents: function(e) {
            return String(e).indexOf('dy="-7"') >= 0 ? '<tspan dy="7"> </tspan>' : " "
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "list",
        modVal: "yes"
    }, {
        onElem: {
            header: function(e) {
                e.content([{
                    elem: "search-list"
                }, {
                    elem: "inverse",
                    value: (e.param("value") || {}).exclude
                }])
            },
            "search-list": function(e) {
                e.mix([{
                    elem: "search"
                }]).content({
                    block: "input",
                    mods: {
                        size: "s"
                    },
                    content: {
                        elem: "control"
                    }
                })
            },
            content: function(e) {
                var t = e.params(),
                    i = e.blockParams();
                e.content({
                    block: "segment-panel-checkbox-list",
                    mods: {
                        type: t.segment.type,
                        data: i.mods.data
                    },
                    js: jQuery.extend({
                        filter: t.filter,
                        segmentId: i.segmentId,
                        period: i.period,
                        hasCounts: !i.noCounts
                    }, t.addCheckboxListJsParams)
                })
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "list",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                this._multiselect = this.findBlockInside("segment-panel-checkbox-list").on("change", this._onMultiselectChange, this), this.findBlockInside(this.elem("search-list"), "input").on("change", this._onChangeSearchList, this), this.__base.apply(this, arguments)
            }
        },
        val: function(e) {
            var t;
            return this._filter || (this._filter = {}), this._filter[this.params.segmentId] || (this._filter[this.params.segmentId] = {}), void 0 === e ? (t = this._filter[this.params.segmentId].items, t && t.length ? {
                exclude: this._getInverse(),
                items: t
            } : null) : (this._filter[this.params.segmentId].items = e, this)
        },
        _onMultiselectChange: function(e) {
            this.val(e.block.val()), this._onChangeValue()
        },
        _onChangeSearchList: function(e) {
            this.findBlockInside("segment-panel-checkbox-list").filter(e.block.val())
        },
        _getInverse: function() {
            return "exclude" === this.findBlockInside("inverse", "radiobox").val()
        }
    }), BEM.DOM.decl("segment-panel-checkbox-list", {
        onSetMod: {
            js: function() {
                this.setMod("state", "loading"), this.getSource().fetch(), BN("checkbox").on(this.domElem, "change", this._onCheckboxChange, this)
            },
            state: {
                "*": function() {
                    BEM.DOM.destruct(this.findElem("layer"))
                },
                loading: function() {
                    BN("i-content").append(this.domElem, this._getWaitJson())
                },
                empty: function() {
                    BN("i-content").append(this.domElem, this._getEmptyJson()).then(function() {
                        BEM.DOM.update(this.getBody(), "")
                    }.bind(this))
                },
                error: function() {
                    BN("i-content").append(this.domElem, this._getErrorJson())
                }
            }
        },
        getSource: function() {
            return this._source || (this._source = BEM.create({
                block: "data-source-segment-values",
                mods: {
                    type: this.hasMod("tree") ? "tree" : "list",
                    data: this.getMod("data")
                }
            }, this.params).onFirst("ready", this._onFirstDataReady, this).on("ready", this._onDataReady, this).on("change", this._onDataChange, this)), this._source
        },
        getBody: function() {
            return this.elem("list")
        },
        val: function() {
            return this.findBlocksInside({
                block: "checkbox",
                modName: "checked",
                modVal: "yes"
            }).map(function(e) {
                return e.val()
            })
        },
        destruct: function() {
            this._source.destruct(), BN("checkbox").un(this.domElem, "change", this._onCheckboxChange, this), this.__base.apply(this, arguments)
        },
        filter: function(e) {
            this.getSource().setFilter(e)
        },
        _onDataReady: function() {
            var e, t, i, n = this.getSource();
            if (n.getError()) return this.setMod("state", "error");
            if (t = n.getTotal(), i = n.getOffset(), BEM.DOM.destruct(this.findElem("show-more")), t > n.getLimit() + i) BN("i-content").append(this.domElem, this._getMoreJson());
            else if (!t) return this.setMod("state", "empty");
            e = 0 === i ? "update" : "append", BN("i-content")[e](this.getBody(), this._getItemListJson(n)).then(function() {
                this.setMod("state", "ready")
            }.bind(this))
        },
        _getItemListJson: function(e) {
            return e.getData().map(function(t, i) {
                return this._getItemJson({
                    item: t,
                    source: e,
                    idx: i
                })
            }, this)
        },
        _getItemJson: function(e) {
            var t = e.item,
                i = e.source,
                n = parseInt(t.count, 10),
                o = i.getId(t);
            return {
                block: this.__self.getName(),
                blockMods: this.getInitialMods(),
                elem: "item",
                elemMods: {
                    disabled: 0 === n ? "yes" : ""
                },
                tag: "li",
                content: {
                    block: "checkbox",
                    checkboxAttrs: {
                        value: o
                    },
                    mods: {
                        size: "s",
                        checked: this._isChecked(o) ? "yes" : ""
                    },
                    content: {
                        elem: "label",
                        content: [{
                            block: "filtered-text",
                            pattern: i.getFilter(),
                            text: t.name
                        }, n && this.params.hasCounts ? {
                            block: this.__self.getName(),
                            blockMods: this.getInitialMods(),
                            elem: "caption",
                            tag: "span",
                            content: (i.isSampled() ? "&asymp;" : "") + BN("humanize").format("number", n)
                        } : ""]
                    }
                }
            }
        },
        _getMoreJson: function() {
            var e = this.getSource();
            return {
                block: this.__self.getName(),
                mods: this.getInitialMods(),
                elem: "show-more",
                content: {
                    block: "button",
                    mix: [{
                        block: this.__self.getName(),
                        elem: "more-button"
                    }],
                    mods: {
                        size: "s",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("table", "show-more", {
                        limit: e.getLimit(),
                        offset: e.getOffset() + e.getLimit(),
                        total: e.getTotal()
                    })
                }
            }
        },
        _getWaitJson: function() {
            return {
                block: "wait",
                mods: {
                    state: "active"
                },
                mix: {
                    block: this.__self.getName(),
                    elem: "layer"
                }
            }
        },
        _getEmptyJson: function() {
            return {
                block: this.__self.getName(),
                elem: "layer",
                mods: this.getInitialMods(),
                content: {
                    elem: "no-data",
                    content: BEM.I18N("table", "no-data")
                }
            }
        },
        _getErrorJson: function() {
            return {
                block: "error-message",
                mods: {
                    theme: "light"
                },
                mix: {
                    block: this.__self.getName(),
                    elem: "layer"
                },
                js: !0,
                content: {
                    elem: "body",
                    mods: {
                        type: "above"
                    },
                    error: this.getSource().getError()
                }
            }
        },
        _onDataChange: function() {
            this.setMod("state", "loading")
        },
        _onFirstDataReady: function() {
            this.getSource().moveRecords(this._getChecked())
        },
        _onCheckboxChange: function() {
            this.trigger("change")
        },
        _getChecked: function() {
            return this._checkedItems || this._cacheChecked(), this._checkedItems
        },
        _cacheChecked: function() {
            this._checkedItems = this._getFilterValue().map(function(e) {
                return String(e.id)
            })
        },
        _getFilterValue: function() {
            var e = (this.params.filter || {})[this.params.segmentId];
            return (e || {}).items || []
        },
        _isChecked: function(e) {
            return this._getChecked().indexOf(e) > -1
        }
    }, {
        live: function() {
            return this.liveBindTo("more-button", "click", function() {
                this.getSource().next()
            }), !1
        }
    }), BEM.JSON.decl("segment-panel-checkbox-list", {
        onBlock: function(e) {
            e.content({
                elem: "list",
                tag: "ul"
            })
        }
    }), BEM.JSON.decl("filtered-text", {
        onBlock: function(e) {
            var t = e.param("text"),
                i = (e.param("pattern") || "").trim().toLowerCase(),
                n = t.toLowerCase(),
                o = [],
                s = 0,
                r = 0;
            if (e.tag("span"), !i) return void e.content(BN("i-string").escapeHTML(t));
            for (; - 1 !== (s = n.indexOf(i, r));) r !== s && o.push(t.slice(r, s)), r = s + i.length, o.length && "highlight" === o[o.length - 1].elem ? o[o.length - 1].content += t.slice(s, r) : o.push({
                elem: "highlight",
                tag: "span",
                content: t.slice(s, r)
            });
            r !== t.length && o.push(t.slice(r)), e.content(o.map(function(e) {
                return e.content ? e.content = BN("i-string").escapeHTML(e.content) : e = BN("i-string").escapeHTML(e), e
            }))
        }
    }), BEM.JSON.decl({
        name: "error-message",
        modName: "type",
        modVal: "above"
    }, {
        onElem: {
            body: function(e) {
                e.content([{
                    elem: "message",
                    error: e.param("error")
                }, {
                    elem: "background"
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "error-message",
        modName: "type",
        modVal: "above"
    }, {
        _hide: function() {
            this.setMod("hidden", "yes")
        },
        _show: function(e) {
            var t, i = this.findElem("body"),
                n = {
                    block: "error-message",
                    mods: {
                        type: this.getMod("type")
                    },
                    elem: "body",
                    error: e
                };
            t = i.length ? BN("i-content").replace(i, n) : BN("i-content").prepend(this.domElem, n), this.setMod("hidden", "no")
        }
    }), BEM.decl("data-source", {
        DEBOUNCE_TIME: 100,
        onSetMod: {
            js: function() {
                return this._options = {}, this._data = null, this._error = null, this._workPromise = null, this.reload = jQuery.debounce(this._reload, this.DEBOUNCE_TIME, this), this.change = jQuery.debounce(this._change, this.DEBOUNCE_TIME, this), this.__base.apply(this, arguments)
            }
        },
        getData: function() {
            return jQuery.extend(!0, {}, this._data)
        },
        getDataLag: function() {
            return this._dataLag || 0
        },
        getError: function() {
            return this._error
        },
        isBuzy: function() {
            return Boolean(this._workPromise)
        },
        destruct: function() {
            this.un(), this.__base.apply(this, arguments)
        },
        _triggerReady: function() {
            this._workPromise = null, this.trigger("ready", this)
        },
        _triggerBeforeLoad: function() {
            this.trigger("beforeload", this)
        },
        _change: function() {
            this.trigger("change", this)
        },
        _reload: function() {
            var e = BN("i-promise").createChain(this);
            this._triggerBeforeLoad(), this._workPromise = Vow.promise(this._getOptions()).then(e(this._loadData.bind(this))).then(e(function(e) {
                this._data = e, this._error = null
            }.bind(this))).fail(e(function(e) {
                this._data = null, this._error = e, e instanceof BN("i-errors").MetrikaError || setTimeout(function() {
                    throw e
                })
            }.bind(this))).always(e(this._triggerReady.bind(this))).done()
        },
        _getOptions: function() {
            throw new Error("must be implemented in successor")
        },
        _loadData: function() {
            throw new Error("must be implemented in successor")
        },
        _setDataLag: function(e) {
            this._dataLag = e || 0
        }
    }), BEM.decl({
        name: "table-data-source",
        baseBlock: "data-source"
    }, {
        offset: 0,
        limit: 50,
        sort: null,
        onSetMod: {
            js: function() {
                this.sort = this.params.sort || this.sort || {}, this.__base.apply(this, arguments)
            }
        },
        getLimit: function() {
            return this.limit
        },
        setLimit: function(e) {
            return this.limit !== e && (this.limit = e, this.trigger("limit.change", e)), this
        },
        getOffset: function() {
            return this.offset
        },
        setOffset: function(e) {
            return this.offset !== e && (this.offset = e, this.trigger("offset.change", e)), this
        },
        getSort: function() {
            return this.sort
        },
        setSort: function(e) {
            return jQuery.equals(this.sort, e) || (this.sort = e || {}, this.setOffset(0).fetch(), this.trigger("sort.change", e)), this
        },
        fetch: function() {
            return this.change(), this.reload(), this
        },
        next: function() {
            return this.setOffset(this.offset + this.limit), this.fetch()
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        baseBlock: "table-data-source"
    }, {
        limit: 20,
        _filter: "",
        getData: function() {
            return this.__base().response.slice(this.offset, this.offset + this.limit)
        },
        getTotal: function() {
            return this._data.response.length
        },
        isSampled: function() {
            return Boolean(this._data.sampled)
        },
        setFilter: function(e) {
            return e = String(e || "").toLowerCase().trim(), this._filter !== e && (this._filter = e, this.setOffset(0).fetch(), this.trigger("change.filter", e)), this
        },
        getFilter: function() {
            return this._filter
        },
        moveRecords: function(e) {
            return this._data && this._data.response && this._data.response.sort(function(t, i) {
                var n = e.indexOf(t.id) > -1,
                    o = e.indexOf(i.id) > -1;
                return n ^ o ? n ? -1 : 1 : i.count - t.count
            }), this
        }
    }), BEM.decl({
        block: "table-data-source",
        modName: "source",
        modVal: "array"
    }, {
        DEBOUNCE_TIME: 0,
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._source = this.params.source
            }
        },
        getTotal: function() {
            return this._data.length
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        modName: "source",
        modVal: "array"
    }, {
        _reload: function() {
            this._data = this._afterLoadData(this._source), this.trigger("ready", this)
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        modName: "type",
        modVal: "tree"
    }, {
        PATH_SEPARATOR: "/",
        _itemMap: null,
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._itemMap = {}
            }
        },
        getChildren: function(e) {
            var t, i, n, o = e,
                s = this._itemMap[o],
                r = e.split(this.PATH_SEPARATOR);
            if (!s) {
                for (n = function(e) {
                        return e.id === i ? (t = e.chld, !0) : void 0
                    }, t = this._data.response;
                    (i = r.shift()) && t;) t.some(n);
                s = this._itemMap[o] = BEM.create({
                    block: "data-source-segment-values",
                    mods: {
                        type: "tree",
                        source: "array"
                    }
                }, {
                    path: e,
                    source: {
                        response: t,
                        sampled: this.isSampled()
                    }
                })
            }
            return s.setFilter(this._filter)
        },
        getPath: function() {
            return this.params.path || ""
        },
        findPathTo: function(e) {
            var t = [];
            return this._data.response.some(function i(n) {
                return n.id === e || n.chld && n.chld.some(i) ? t.unshift(n.id) : void 0
            }), t.join(this.PATH_SEPARATOR)
        },
        getId: function(e) {
            return [].concat(this.getPath() || [], e.id).join(this.PATH_SEPARATOR)
        },
        moveRecords: function(e) {
            var t = [];
            return e.forEach(function(e) {
                t.push.apply(t, e.split(this.PATH_SEPARATOR))
            }, this), this.__base(t)
        },
        destruct: function() {
            Object.keys(this._itemMap).forEach(function(e) {
                this._itemMap[e].destruct()
            }, this), this.__base.apply(this, arguments)
        },
        _loadData: function(e) {
            return BN("i-stat-metadata-api").getAttributeTreeValues(e).then(this._afterLoadData.bind(this))
        },
        _afterLoadData: function(e) {
            var t = e.response;
            return this._filter && (t = t.filter(this._filterFn, this), 0 === t.length && "" !== this.getPath() && (t = e.response)), {
                sampled: e.sampled,
                response: t
            }
        },
        _filterFn: function(e) {
            return String(e.name || "").toLowerCase().indexOf(this._filter) > -1 || e.chld && e.chld.some(this._filterFn, this)
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        modName: "type",
        modVal: "list"
    }, {
        getId: function(e) {
            return e.id
        },
        _loadData: function(e) {
            return BN("i-stat-metadata-api").getAttributeListValues(e).then(function(e) {
                var t = e.response;
                return this._filter && (t = t.filter(function(e) {
                    return String(e.name || "").toLowerCase().indexOf(this._filter) > -1
                }, this)), {
                    sampled: e.sampled,
                    response: t
                }
            }.bind(this))
        }
    }), BEM.decl({
        block: "table-data-source",
        modName: "source",
        modVal: "ajax"
    }, {
        limitKey: "limit",
        offsetKey: "offset",
        sortKey: "sort",
        totalKey: "total",
        onSetMod: {
            js: function() {
                var e;
                this.__base.apply(this, arguments), this._source = this.params.source, "string" == typeof(e = this.sort) && (this.sort = "-" === e.charAt(0) ? {
                    field: e.slice(1),
                    mode: "desc"
                } : {
                    field: e,
                    mode: "asc"
                })
            }
        },
        getSerializedSort: function() {
            var e = this.getSort();
            if (e && e.mode && e.field) return ("asc" === e.mode ? "" : "-") + e.field
        },
        getTotal: function() {
            return this._data[this.totalKey]
        },
        _getOptions: function() {
            var e = {};
            return e[this.limitKey] = this.getLimit(), e[this.offsetKey] = this.getOffset(), this.sortKey && (e[this.sortKey] = this.getSerializedSort()), Vow.fulfill(e)
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        modName: "data",
        modVal: "report"
    }, {
        _getMeta: function() {
            return BN("i-report").getMetadata()
        },
        _getSegment: function() {
            return this._segment || (this._segment = this._getMeta().then(function(e) {
                return e.getSegmentsTree().findSegmentById(this.params.segmentId)
            }.bind(this))), this._segment
        },
        _getOptions: function() {
            return this._staticOpts || (this._staticOpts = Vow.all([this._getMeta(), this._getSegment(), BN("i-report").getReport(), BN("i-counters").getAsync()]).spread(function(e, t, i, n) {
                var o = i.getParamsModel().getState(),
                    s = o.preset && o.preset.direct_client_ids,
                    r = t.dims && t.dims.length ? t.dims : [t.dim];
                return e.hasDirectClientParam() && !s ? Vow.reject(new(BN("i-error-message").MetrikaError)("ERR_REPORT_REQUIRE_DIRECT_CLIENT_ID")) : {
                    ids: n.getApiCounterId(),
                    date1: this.params.period.from,
                    date2: this.params.period.to,
                    filters: BN("i-filter").buildFilter(BN("i-filter").removeDimension(this.params.filter, this.params.segmentId), e.getSegmentsTree()),
                    metric: t.count_metric,
                    dimension: r[0],
                    dimensions: r.join(","),
                    goal_id: e.getGoal(),
                    attribution: o.attribution,
                    direct_client_ids: s,
                    currency: o.currency,
                    limit: 1e3
                }
            }.bind(this))), this._staticOpts
        }
    }), BEM.decl({
        block: "data-source-segment-values",
        modName: "data",
        modVal: "dashboard"
    }, {
        _getOptions: function() {
            var e;
            return this._staticOpts ? this._staticOpts : (e = BN("m-widget").getOne(this.params.widgetModelId), Vow.all([e.getStatRequestParams(), e.getFilterObject(), e.getSegmentsTree()]).spread(function(t, i, n) {
                var o = n.findSegmentById(this.params.segmentId),
                    s = jQuery.extend(i, this.params.filter),
                    r = o.dims && o.dims.length ? o.dims : [o.dim],
                    a = {
                        ids: t.ids,
                        date1: t.date1,
                        date2: t.date2,
                        goal_id: t.goal_id,
                        metrics: o.count_metric || e.getDefaultMetric(),
                        limit: 1e3,
                        dimension: r[0],
                        dimensions: r.join(","),
                        filters: BN("i-filter").buildFilter(BN("i-filter").removeDimension(s, this.params.segmentId), n)
                    };
                return a
            }.bind(this)))
        }
    }), BEM.JSON.decl("table", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.columns || [];
            e.js(jQuery.extend(e.js(), {
                sort: t.sort,
                model: t.model,
                source: t.source,
                footer: t.footer,
                columns: i,
                firstLoadLimit: t.firstLoadLimit
            }))
        }
    }), BEM.DOM.decl("table", {
        onSetMod: {
            js: function() {
                var e = this.params;
                this.setMod("state", "loading"), this.getModel().then(function(e) {
                    this._isDestructing || (this._model = e, e.on("change", this._onModelChange, this))
                }.bind(this)).done(), this._source = this._createSource(e.source, {
                    sort: e.sort
                }).on("ready", this._onDataReady, this).on("change", this._onDataChange, this), e.firstLoadLimit && (this._sourceRegularLimit = this._source.getLimit(), this._source.setLimit(e.firstLoadLimit)), this.render().then(this._source.fetch.bind(this._source)).done()
            },
            state: {
                "*": function() {
                    BEM.DOM.destruct(this.findElem("layer"))
                },
                loading: function() {
                    BN("i-content").append(this.domElem, this._getWaitJson())
                },
                empty: function() {
                    BN("i-content").append(this.domElem, this._getEmptyJson()).then(function() {
                        BEM.DOM.update(this.getBody(), "")
                    }.bind(this)).done()
                },
                error: function() {
                    BN("i-content").append(this.domElem, this._getErrorJson())
                }
            }
        },
        reload: function() {
            this.setMod("state", "loading"), this.getSource().reload()
        },
        render: function() {
            return this.getModel().then(function(e) {
                var t = this.findElem("table"),
                    i = {
                        block: this.__self.getName(),
                        mods: this.getInitialMods(),
                        elem: "table",
                        model: e,
                        footer: this.params.footer,
                        sort: this.getSort()
                    };
                return t.length ? BN("i-content").update(t, i) : BN("i-content").append(this.domElem, i)
            }.bind(this))
        },
        getModel: function() {
            return this._modelPromise || (this._modelPromise = BN(this.params.model || "table__model").get({
                columns: this.params.columns
            })), this._modelPromise
        },
        getSource: function() {
            return this._source
        },
        getBody: function() {
            return this.findElem("body")
        },
        getSort: function() {
            return this.getSource().getSort()
        },
        setSort: function(e) {
            return this.getSource().setSort(e).fetch(), this
        },
        destruct: function() {
            return this._model && (this._model.un("change", this._onModelChange, this), this._model.destruct()), BN("data-lag-notification").setLag(0), this._source.destruct(), this.__base.apply(this, arguments)
        },
        _onDataChange: function() {
            this.setMod("state", "loading")
        },
        _onModelChange: function() {
            this.render().then(this._source.fetch.bind(this._source)).done()
        },
        _onDataReady: function() {
            this.getModel().then(function(e) {
                var t, i, n, o = this.getSource();
                if (this.trigger("ready"), o.getError()) return this.setMod("state", "error");
                if (i = o.getTotal(), n = o.getOffset(), BEM.DOM.destruct(this.findElem("show-more")), i > o.getLimit() + n) BN("i-content").append(this.domElem, this._getMoreJson(e));
                else if (!i) return this.setMod("state", "empty");
                return t = 0 === n ? "update" : "append", BN("i-content")[t](this.getBody(), this._getRowListJson(e)).then(function() {
                    this.setMod("state", "ready"), this.trigger("resize")
                }.bind(this))
            }.bind(this)).then(function() {
                this.params.firstLoadLimit && this._sourceRegularLimit && (this._source.setLimit(this._sourceRegularLimit), this._source.setOffset(this.params.firstLoadLimit - this._sourceRegularLimit), this._sourceRegularLimit = NaN)
            }.bind(this)).done(), BN("data-lag-notification").setLag(this.getSource().getDataLag())
        },
        _getRowListJson: function(e) {
            return {
                block: this.__self.getName(),
                mods: this.getInitialMods(),
                elem: "row-list",
                source: this.getSource(),
                model: e
            }
        },
        _getMoreJson: function(e) {
            return {
                block: this.__self.getName(),
                mods: this.getInitialMods(),
                elem: "show-more",
                source: this.getSource(),
                model: e
            }
        },
        _getWaitJson: function() {
            return {
                block: "wait",
                mods: {
                    state: "active"
                },
                mix: {
                    block: this.__self.getName(),
                    elem: "layer"
                }
            }
        },
        _getEmptyJson: function() {
            return {
                block: this.__self.getName(),
                elem: "layer",
                mods: this.getInitialMods(),
                content: {
                    elem: "no-data"
                }
            }
        },
        _getErrorJson: function() {
            return {
                block: "error-message",
                mods: {
                    type: "above"
                },
                mix: {
                    block: this.__self.getName(),
                    elem: "layer"
                },
                js: !0,
                content: {
                    elem: "body",
                    mods: {
                        type: "above"
                    },
                    error: this.getSource().getError()
                }
            }
        },
        _createSource: function(e, t) {
            if ("string" == typeof e) e = {
                name: e
            };
            else if (!e) throw new Error("Data source not specified");
            return "string" == typeof e.name && (e.name = {
                block: e.name
            }), e.name.mods && e.name.mods.source || (e.name.mods = jQuery.extend(e.name.mods, {
                source: "ajax"
            })), BEM.create(e.name, jQuery.extend(e, t))
        }
    }, {
        live: function() {
            return this.liveBindTo("more-button", "click", function() {
                this.getSource().next()
            }), !1
        }
    }), BEM.JSON.decl("table", {
        onElem: {
            table: function(e) {
                var t = e.params();
                e.tag("table").content([{
                    elem: "column-list",
                    model: t.model
                }, {
                    elem: "head",
                    model: t.model,
                    sort: t.sort
                }, t.footer && {
                    elem: "foot",
                    model: t.model
                }, {
                    elem: "body"
                }])
            },
            "column-list": function(e) {
                e.tag("colgroup").content(e.params().model.getColumns().map(function(e) {
                    return {
                        elem: "col",
                        column: e
                    }
                }))
            },
            col: function(e) {
                e.tag("col").mod("n", e.pos() - 1)
            },
            head: function(e) {
                var t = e.params(),
                    i = t.sort || {};
                e.tag("thead").content({
                    elem: "head-row",
                    tag: "tr",
                    content: t.model.getColumns().map(function(e) {
                        return {
                            elem: "th",
                            column: e,
                            sort: e.getName() && i.field === e.getName() ? i : null
                        }
                    })
                })
            },
            foot: function(e) {
                var t = e.params();
                e.tag("tfoot").content({
                    elem: "foot-row",
                    model: t.model,
                    tag: "tr"
                })
            },
            "foot-cell": function(e) {
                e.tag("td")
            },
            th: function(e) {
                e.tag("th").mods({
                    n: e.pos() - 1,
                    name: BEM.toModVal(e.params().column.getName())
                }).content({
                    elem: "th-inner",
                    column: e.params().column,
                    sort: e.params().sort
                })
            },
            "th-inner": function(e) {
                var t = e.params(),
                    i = t.column;
                e.content(i.getHeader()), i.isSortable() && e.mod("sortable", "yes").afterContent({
                    elem: "sorter",
                    column: i,
                    sort: t.sort
                })
            },
            body: function(e) {
                e.tag("tbody")
            },
            "show-more": function(e) {
                var t = e.params().source;
                e.content({
                    block: "button",
                    mix: [{
                        block: "table",
                        elem: "more-button"
                    }],
                    mods: {
                        size: "l",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("table", "show-more", {
                        limit: t.getLimit(),
                        offset: t.getOffset() + t.getLimit(),
                        total: t.getTotal()
                    })
                })
            },
            "no-data": function(e) {
                e.content(BEM.I18N("table", "no-data"))
            },
            "row-list": function(e) {
                var t = e.params(),
                    i = e.mods(),
                    n = t.source.getOffset();
                e.wrap(t.source.getData().map(function(e, o) {
                    return {
                        block: "table",
                        blockMods: i,
                        elem: "body-row",
                        source: t.source,
                        model: t.model,
                        data: e,
                        idx: n + o
                    }
                }))
            },
            "body-row": function(e) {
                var t = e.params();
                e.tag("tr").mod("n", t.idx).content(t.model.getColumns().map(function() {
                    return {
                        elem: "td",
                        data: t.data,
                        source: t.source,
                        model: t.model,
                        rowIdx: t.idx
                    }
                }))
            },
            td: function(e) {
                var t = e.params(),
                    i = e.pos() - 1;
                e.tag("td").mod("n", i).content({
                    elem: "td-inner",
                    data: t.data,
                    source: t.source,
                    model: t.model,
                    rowIdx: t.rowIdx,
                    colIdx: i
                })
            },
            "td-inner": function(e) {
                var t = e.params();
                e.content(t.model.getCell({
                    data: t.data,
                    source: t.source,
                    colIdx: t.colIdx,
                    rowIdx: t.rowIdx
                }))
            }
        }
    }), BEM.decl("table__model", {
        columns: null,
        onSetMod: {
            js: function() {
                this._createColumns(this.params.columns)
            }
        },
        update: function(e) {
            this._createColumns(e), this.trigger("change")
        },
        getColumns: function() {
            return this.columns
        },
        getCell: function(e) {
            return this.getColumns()[e.colIdx].getCell(e)
        },
        destruct: function() {
            this._destructColumns(), this.__base.apply(this, arguments)
        },
        _createColumns: function(e) {
            this._destructColumns(), this.columns = e.map(this._createColumn, this)
        },
        _createColumn: function(e, t) {
            var i = {
                idx: t
            };
            return e.type && (i.type = e.type), i.mode = e.compose ? "composite" : "simple", BEM.create({
                block: "table__column",
                mods: i
            }, e)
        },
        _destructColumns: function() {
            this.columns && (this.columns.forEach(function(e) {
                e.destruct()
            }), this.columns = null)
        }
    }, {
        get: function(e) {
            return Vow.fulfill(BEM.create({
                block: this._name
            }, e))
        }
    }), BN.addDecl("table__formatter").staticProp({
        lookup: function(e) {
            return this["format." + e] || this["format.dummy"]
        },
        "format.dummy": function(e) {
            return e && String(e)
        },
        "format.escape": function(e) {
            return e && BN("i-string").escapeHTML(e)
        },
        "format.date": function(e, t, i) {
            return BN("i-date").create(e).format(i.format)
        },
        "format.duration": function(e) {
            return BN("humanize").format("second", e)
        },
        "format.row-number": function(e, t) {
            return String(t.rowIdx + 1)
        }
    }).done(), BN.addDecl("table__reader").staticProp({
        "reader.key": function(e, t, i) {
            return e[i.key]
        },
        "reader.row": function(e) {
            return e
        }
    }).done(),
    function() {
        function e(e, t, i) {
            return function() {
                return e.apply(t, Array.prototype.slice.call(arguments, 0).concat(i))
            }
        }

        function t(e, t) {
            return this.reduce(function(e, i) {
                return i(e, t)
            }, e)
        }

        function i(e, t) {
            return this.map(function(i) {
                return i(e, t)
            })
        }
        BEM.decl("table__column", {
            onSetMod: {
                js: function() {
                    this.params.name || (this.params.name = this.getMod("idx")), this._createMethods()
                }
            },
            getCell: function() {
                throw new Error("Method table__column.getCell is not implemented")
            },
            getName: function() {
                return this.params.name
            },
            getHeader: function() {
                return this.params.header || ""
            },
            isSortable: function() {
                return this.params.sortable === !0
            },
            source: function(e, t) {
                return t(e.data, e)
            },
            format: function(e, t, i) {
                return t(e, i)
            },
            _createMethods: function() {
                throw new Error("Method table__column._createMethods is not implemented")
            },
            _createReader: function(t) {
                var i;
                if ("string" == typeof t && (t = {
                        name: t
                    }), t && t.name || (t = {
                        name: "key",
                        key: this.getName()
                    }), i = BN("table__reader")["reader." + t.name], !i) throw new Error("Unknown reader: " + t.name);
                return e(i, this, t)
            },
            _createFormatter: function(n) {
                var o;
                if (n && n.type && n.format) return o = n.format.map(this._createFormatter, this), "join" === n.type ? i.bind(o) : t.bind(o);
                if ("string" == typeof n && (n = {
                        name: n
                    }), n && n.name || (n = {
                        name: "dummy"
                    }), o = BN("table__formatter").lookup(n.name), !o) throw new Error("Unknown formatter: " + n.name);
                return e(o, this, n)
            }
        })
    }(), BEM.decl({
        block: "table__column",
        modName: "mode",
        modVal: "simple"
    }, {
        getCell: function(e) {
            return this.format(this.source(e, this._fns.source), this._fns.format, e)
        },
        _createMethods: function() {
            this._fns = {
                source: this._createReader(this.params.source),
                format: this._createFormatter(this.params.format)
            }
        }
    }), BEM.decl({
        block: "table__column",
        modName: "mode",
        modVal: "composite"
    }, {
        getCell: function(e) {
            return this._fns.map(function(t) {
                return {
                    elem: "td-inner-part",
                    tag: "span",
                    content: this.format(this.source(e, t.source), t.format, e)
                }
            }, this)
        },
        _createMethods: function() {
            this._fns = this.params.compose.map(function(e) {
                return {
                    source: this._createReader(e.source),
                    format: this._createFormatter(e.format)
                }
            }, this)
        }
    }), BEM.JSON.decl("wait", {
        onBlock: function(e) {
            e.content([{
                elem: "wait",
                spinMods: e.params().spinMods
            }, {
                elem: "paranja"
            }])
        },
        onElem: {
            wait: function(e) {
                e.wrap([{
                    block: "spin2",
                    mods: jQuery.extend({
                        size: "xs",
                        progress: "yes"
                    }, e.params().spinMods),
                    mix: [{
                        block: "wait",
                        elem: "indicator"
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("wait", {
        show: function() {
            this.isHiding = !1, setTimeout(function() {
                this.isHiding || this._isDestructing || this.setMod("state", "active")
            }.bind(this), 10)
        },
        hide: function() {
            this.isHiding = !0, this.delMod("state")
        }
    }), BEM.JSON.decl({
        name: "error-message",
        modName: "theme",
        modVal: "light"
    }, {
        onElem: {
            body: function(e) {
                var t = e.param("error");
                e.mod("has-title", /^<h[\d].*?>.*?<\/h[\d]>/gi.test(t.text) ? "yes" : "no").content([{
                    elem: "message",
                    error: t
                }, {
                    elem: "background"
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "error-message",
        modName: "theme",
        modVal: "light"
    }, {
        _hide: function() {
            this.setMod("hidden", "yes")
        },
        _show: function(e) {
            var t = this.findElem("body"),
                i = {
                    block: "error-message",
                    mods: this.getInitialMods(),
                    elem: "body",
                    error: e
                };
            t.length ? BN("i-content").replace(t, i) : BN("i-content").prepend(this.domElem, i), this.setMod("hidden", "no")
        }
    }), BEM.JSON.decl("data-lag-notification", {
        onBlock: function(e) {
            e.js("true").mods({
                hidden: "yes"
            }).content([{
                block: "icon",
                elem: "alert",
                mods: {
                    color: "black"
                }
            }, {
                elem: "lag-text"
            }])
        },
        onElem: {
            "lag-text": function(e) {
                var t = e.param("lag") || 0;
                e.content([BEM.I18N("data-lag-notification", "lag-message"), "&nbsp", t && BN("i-date").compactPeriod(1e3 * t)])
            }
        }
    }), BEM.DOM.decl("data-lag-notification", {
        MIN_DATA_LAG: 1800,
        onSetMod: {
            js: function() {
                this.__self._instances.push(this)
            }
        },
        destruct: function() {
            this.__self._instances = this.__self._instances.filter(function(e) {
                return e !== this
            }, this)
        },
        setLag: function(e) {
            e > this.MIN_DATA_LAG ? BN("i-content").replace(this.findElem("lag-text"), {
                elem: "lag-text",
                block: this.__self._name,
                lag: e
            }).then(function() {
                this.delMod("hidden")
            }.bind(this)).done() : this.setMod("hidden", "yes")
        }
    }, {
        _instances: [],
        setLag: function(e) {
            this._instances.forEach(function(t) {
                t.setLag(e)
            })
        }
    }), BEM.DOM.decl({
        block: "segment-panel-checkbox-list",
        modName: "tree",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._separator = this.getSource().PATH_SEPARATOR, BN("toggle-expand").on(this.domElem, "change", this._onToggleExpand, this)
            }
        },
        onElemSetMod: {
            item: {
                expanded: {
                    yes: function(e) {
                        var t, i;
                        this.findElem(e, "tree-item-list").length || (t = this.elemParams(e), i = this.getSource().getChildren(t).onFirst("ready", function() {
                            i.moveRecords(this._getChecked()), BN("i-content").append(e, this._getTreeInnerJson(i)).done(), this._appendTreeMoreJson(e, i).done()
                        }, this).fetch())
                    },
                    "": function(e) {
                        this.findBlocksInside(e, {
                            block: "toggle-expand",
                            modName: "state",
                            modVal: "expanded"
                        }).forEach(function(e) {
                            e.setMod("state", "collapsed")
                        })
                    }
                }
            }
        },
        val: function() {
            return this._getChecked().map(function(e) {
                return e.split(this._separator).map(function(e) {
                    return {
                        id: e
                    }
                })
            }, this)
        },
        _getItemJson: function(e) {
            var t = this.__base.apply(this, arguments),
                i = e.item,
                n = e.source.getId(i),
                o = t.content.mods;
            return o["fake-checked"] = o.checked || o.disabled || !this._isFakeChecked(n) ? "" : "yes", i.chld && i.chld.length && (t.js = n, t.content = [{
                block: "toggle-expand"
            }, t.content]), t
        },
        _getTreeInnerJson: function(e) {
            return {
                block: this.__self.getName(),
                blockMods: this.getInitialMods(),
                elem: "tree-item-list",
                tag: "ul",
                content: this._getTreeItemListJson(e)
            }
        },
        _getTreeItemListJson: function(e) {
            return e.getData().map(function(t) {
                return this._getItemJson({
                    item: t,
                    source: e
                })
            }, this)
        },
        _appendTreeMoreJson: function(e, t) {
            return this.afterCurrentEvent(function() {
                BEM.DOM.destruct(this.findElem(e, "tree-show-more"))
            }), t.getTotal() > t.getLimit() + t.getOffset() ? BN("i-content").append(e, {
                block: this.__self.getName(),
                elem: "tree-show-more",
                content: {
                    block: "button",
                    mix: [{
                        block: this.__self.getName(),
                        elem: "tree-more-button",
                        js: t.getPath()
                    }],
                    mods: {
                        size: "xs",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("table", "show-more", {
                        limit: t.getLimit(),
                        offset: t.getOffset() + t.getLimit(),
                        total: t.getTotal()
                    })
                }
            }).then(function() {
                this.bindTo(this.findElem(e, "tree-more-button"), "click", this._onTreeMoreClick)
            }.bind(this)) : Vow.fulfill()
        },
        _isFakeChecked: function(e) {
            var t = e + this._separator;
            return this._getChecked().some(function(e) {
                return 0 === e.indexOf(t)
            })
        },
        _onToggleExpand: function(e, t) {
            this.toggleMod(e.block.domElem.parent(this.buildSelector("item")), "expanded", "yes", t)
        },
        _onCheckboxChange: function(e) {
            var t, i, n, o, s, r = this._separator;
            this._isChanging || (t = e.block.val(), i = this._getChecked(), n = e.block.domElem.parent(this.buildSelector("item")), o = this, e.block.hasMod("checked", "yes") ? (t.split(r).reduce(function(e, t) {
                return e.push(t), s = i.indexOf(e.join(r)), s > -1 && i.splice(s, 1), e
            }, []), i.push(t), t += r, this._checkedItems = i.filter(function(e) {
                return 0 !== e.indexOf(t)
            }), n.parents(this.buildSelector("item")).each(function(e, t) {
                o.findBlockInside(o.elemify(t, "item"), "checkbox").delMod("checked").setMod("fake-checked", "yes")
            }), e.block.hasMod("fake-checked") && (e.block.delMod("fake-checked"), n = this.findElem(n, "tree-item-list"), this.findBlocksInside(n, {
                block: "checkbox",
                mods: {
                    checked: "yes"
                }
            }).forEach(function(e) {
                e.delMod("checked")
            }), this.findBlocksInside(n, {
                block: "checkbox",
                mods: {
                    "fake-checked": "yes"
                }
            }).forEach(function(e) {
                e.delMod("fake-checked")
            }))) : (s = i.indexOf(t)) > -1 && (i.splice(s, 1), n.parents(this.buildSelector("item")).each(function(e, t) {
                var i = o.elemify(t, "item");
                o._isFakeChecked(o.elemParams(i)) || o.findBlockInside(i, {
                    block: "checkbox",
                    mods: {
                        "fake-checked": "yes"
                    }
                }).delMod("fake-checked")
            })), this.afterCurrentEvent(function() {
                this._isChanging = !1, this.trigger("change")
            }))
        },
        _onTreeMoreClick: function(e) {
            var t = this.elemify(e.data.domElem.parents(this.buildSelector("item"))[0], "item"),
                i = this.getSource().getChildren(this.elemParams(t));
            BN("i-content").append(this.findElem(t, "tree-item-list"), this._getTreeItemListJson(i.next())).done(), this._appendTreeMoreJson(t, i).done()
        },
        _cacheChecked: function() {
            this._checkedItems = this._getFilterValue().map(function(e) {
                return e.map(function(e) {
                    return String(e.id)
                }).join(this._separator)
            }, this)
        }
    }), BEM.JSON.decl("toggle-expand", {
        onBlock: function(e) {
            var t = e.params().expanded;
            e.js(!0).mod("state", t ? "expanded" : "collapsed").content([{
                block: "icon",
                elem: "minus"
            }, {
                block: "icon",
                elem: "plus"
            }])
        }
    }), BEM.DOM.decl("toggle-expand", {
        onSetMod: {
            state: function(e, t) {
                this.trigger("change", "expanded" === t)
            }
        }
    }, {
        live: function() {
            this.liveBindTo("click", function() {
                this.toggleMod("state", "expanded", "collapsed")
            })
        }
    }), BEM.JSON.decl({
        name: "segment-panel-checkbox-list",
        modName: "type",
        modVal: "tree"
    }, {
        onBlock: function(e) {
            e.mod("tree", "yes")
        }
    }), BEM.DOM.decl({
        block: "segment-panel-checkbox-list",
        modName: "type",
        modVal: "tree"
    }, {
        val: function() {
            return this.__base.apply(this, arguments).map(function(e) {
                var t = [];
                return t[e.length - 1] = e.pop(), t
            })
        },
        _cacheChecked: function() {
            var e = this.getSource();
            this._checkedItems = this._getFilterValue().map(function(t) {
                return e.findPathTo(String(t.pop().id))
            })
        }
    }), BEM.JSON.decl({
        name: "segment-panel-checkbox-list",
        modName: "type",
        modVal: "path"
    }, {
        onBlock: function(e) {
            e.mod("tree", "yes")
        }
    }), BEM.DOM.decl({
        block: "segment-panel-checkbox-list",
        modName: "list",
        modVal: "yes"
    }, {
        val: function() {
            return (this.__base() || []).map(function(e) {
                return {
                    id: e
                }
            })
        }
    }), BEM.JSON.decl({
        name: "segment-panel-checkbox-list",
        modName: "type",
        modVal: "list"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel-checkbox-list",
        modName: "type",
        modVal: "goals"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "bool"
    }, {
        onElem: {
            content: function(e) {
                var t = e.param("segment"),
                    i = e.param("value");
                i = i && i.value, e.content([{
                    block: "radiobox",
                    mix: [{
                        block: "segment-panel",
                        elem: "bool-switcher"
                    }],
                    mods: {
                        size: "s"
                    },
                    name: "segment-panel__bool-control",
                    value: i || !1,
                    content: [{
                        elem: "radio",
                        mix: [{
                            block: "segment-panel",
                            elem: "bool-radio"
                        }],
                        content: t.yes_label,
                        controlAttrs: {
                            value: "Yes"
                        }
                    }, {
                        elem: "radio",
                        mix: [{
                            block: "segment-panel",
                            elem: "bool-radio"
                        }],
                        content: t.no_label,
                        controlAttrs: {
                            value: "No"
                        }
                    }, {
                        elem: "radio",
                        mix: [{
                            block: "segment-panel",
                            elem: "bool-radio"
                        }],
                        content: BEM.I18N("segment-panel", "no-matter"),
                        controlAttrs: {
                            value: ""
                        }
                    }]
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "bool"
    }, {
        onSetMod: {
            js: function() {
                return this.findBlockOn("bool-switcher", "radiobox").on("change", this._onChangeValue, this), this.__base.apply(this, arguments)
            }
        },
        val: function(e) {
            var t = this.findBlockOn("bool-switcher", "radiobox");
            return void 0 === e ? t.val() ? {
                value: t.val()
            } : null : t.val(e.value)
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "list"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "multiline"
    }, {
        onBlock: function(e) {
            e.mod("multiline", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "number"
    }, {
        OPERATIONS: [
            [">", "more"],
            ["<", "less"],
            ["==", "equal"],
            ["<>", "from-to"]
        ],
        onElem: {
            content: function(e) {
                var t = e.param("segment").units,
                    i = e.param("value") || {};
                i = BN("i-segment-filter").decorateValue(i, t), e.content([t && t.length > 1 ? {
                    elem: "number-units-row",
                    value: i.unit && i.unit.x,
                    units: t
                } : null, {
                    elem: "number-modes",
                    value: i.op
                }, {
                    elem: "gap",
                    mods: {
                        size: "s"
                    }
                }, {
                    elem: "number-input",
                    tag: "span",
                    content: {
                        block: "input",
                        mods: {
                            size: "s",
                            clear: "no"
                        },
                        value: i.value[0],
                        content: {
                            elem: "control"
                        }
                    }
                }, {
                    elem: "number-extra",
                    mods: i.value.length > 1 ? "" : {
                        hidden: "yes"
                    },
                    tag: "span",
                    content: [{
                        elem: "number-mdash",
                        tag: "span",
                        content: " — "
                    }, {
                        elem: "number-input",
                        tag: "span",
                        content: {
                            block: "input",
                            mods: {
                                size: "s",
                                clear: "no"
                            },
                            value: i.value[1],
                            content: {
                                elem: "control"
                            }
                        }
                    }]
                }])
            },
            title: function(e) {
                var t = e.content(),
                    i = e.blockParams().segment;
                i.units && 1 === i.units.length && (t += ", " + i.units[0].label, e.content(t, !0))
            },
            "number-units-row": function(e) {
                var t = e.param("units"),
                    i = e.param("value");
                e.content({
                    block: "radio-button",
                    name: "segment-panel__number-units",
                    mix: [{
                        block: "segment-panel",
                        elem: "number-units"
                    }],
                    mods: {
                        size: "s"
                    },
                    value: i || t[0].x,
                    content: t.map(function(e) {
                        return {
                            elem: "radio",
                            controlAttrs: {
                                value: e.x
                            },
                            content: e.label
                        }
                    })
                })
            },
            "number-modes": function(e) {
                var t, i = e.params().value,
                    n = this.OPERATIONS[0];
                t = this.OPERATIONS.map(function(e) {
                    return i === e[0] && (n = e), {
                        elem: "option",
                        attrs: {
                            value: e[0],
                            selected: i === e[0] ? "selected" : void 0
                        },
                        content: BEM.I18N("segment-panel", "operation-" + e[1])
                    }
                }), e.wrap([{
                    block: "select",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    mix: [{
                        block: "segment-panel",
                        elem: "number-modes"
                    }],
                    content: [{
                        block: "button",
                        content: BEM.I18N("segment-panel", "operation-" + n[1])
                    }, {
                        elem: "control",
                        content: t
                    }]
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "number"
    }, {
        onSetMod: {
            js: function() {
                var e = this,
                    t = this.findBlockOn("number-units", "radio-button");
                this.findBlockInside("number-modes", "select").on("change", this._onChangeNumberMode, this), this.findBlocksInside("number-input", "input").forEach(function(t) {
                        t.on("change", e._onChangeValue, e)
                    }), t && t.on("change", this._onChangeValue, this),
                    this.findBlockInside("number-modes", "select").on("change", this._onChangeValue, this), this.__base.apply(this, arguments)
            }
        },
        val: function(e) {
            return void 0 === e ? this._getVal() : this
        },
        _getVal: function() {
            var e, t, i, n = this._getValueAsNumber("number-input");
            if (isNaN(n)) return null;
            if (e = this.findBlockInside("number-units", "radio-button"), e = e ? e.val() : 1, n *= e, i = this.findBlockInside("number-modes", "select").val(), "<>" === i) {
                if (t = this._getValueAsNumber("number-extra") * e, isNaN(t) || n > t) return null;
                n = [n, t]
            }
            return {
                op: i,
                value: n
            }
        },
        _getValueAsNumber: function(e) {
            return parseInt(this.findBlockInside(e, "input").val().trim())
        },
        _onChangeNumberMode: function(e) {
            this.toggleMod(this.findElem("number-extra"), "hidden", "yes", "<>" !== e.target.val())
        }
    }), BN.addDecl("i-segment-filter").staticProp({
        decorateValue: function(e, t) {
            var i;
            return e = jQuery.extend(!0, {}, e), void 0 === e.value && (e.value = ""), e.value = i = [].concat(e.value), e.value[0] && t && t.length > 1 && [].concat(t).reverse().some(function(t) {
                var n = i.every(function(e) {
                    return !Boolean(e % t.x)
                });
                return n ? (e.unit = t, e.value = i.map(function(e) {
                    return e / t.x
                }), !0) : void 0
            }), e
        }
    }).done(), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "params"
    }, {
        OPERATION_LIST: [
            ["==", "equally"],
            [">", "more"],
            ["<", "less"]
        ],
        onElem: {
            content: function(e) {
                var t = e.param("value") || {},
                    i = e.params().segment,
                    n = t.paramType === i.dim_value_double ? "double" : "string";
                e.content([{
                    elem: "params-label",
                    content: BEM.I18N("segment-panel", "param-name")
                }, {
                    block: "input",
                    content: [{
                        elem: "hint",
                        content: BEM.I18N("segment-panel", "level1-level2")
                    }, {
                        elem: "control"
                    }],
                    value: t.paramName,
                    mix: [{
                        block: "segment-panel",
                        elem: "params-ctrl"
                    }],
                    mods: {
                        size: "s",
                        suggest: "yes"
                    },
                    js: {
                        dataprovider: {
                            name: "i-dataprovider",
                            block: "segment-panel",
                            method: "paramsSuggest"
                        },
                        debounceDelay: 300,
                        popupMods: {
                            size: "s",
                            fade: "yes"
                        }
                    }
                }, {
                    elem: "params-label",
                    content: BEM.I18N("segment-panel", "param-value")
                }, {
                    block: "radio-button",
                    mix: [{
                        block: "segment-panel",
                        elem: "params-type-checker"
                    }],
                    mods: {
                        size: "s"
                    },
                    name: "value-type",
                    value: n,
                    content: [{
                        elem: "radio",
                        controlAttrs: {
                            value: "string"
                        },
                        content: BEM.I18N("segment-panel", "dim-value-string")
                    }, {
                        elem: "radio",
                        controlAttrs: {
                            value: "double"
                        },
                        content: BEM.I18N("segment-panel", "dim-value-double")
                    }]
                }, {
                    elem: "params-value-controls",
                    mods: {
                        type: n
                    },
                    value: t
                }])
            },
            "params-value-input-wrapper": function(e) {
                var t = e.param("value");
                e.content([{
                    block: "input",
                    mix: [{
                        block: "segment-panel",
                        elem: "params-value-input"
                    }],
                    mods: {
                        size: "s"
                    },
                    value: t.paramVal,
                    content: [{
                        elem: "hint",
                        content: BEM.I18N("segment-panel", "param-value")
                    }, {
                        elem: "control"
                    }]
                }])
            },
            "params-value-controls": function(e) {
                var t = e.param("value");
                e.content([{
                    block: "select",
                    mix: [{
                        block: "segment-panel",
                        elem: "params-dim-value-op"
                    }],
                    name: "ParamDimValueDoubleOp",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    content: [{
                        block: "button",
                        content: BEM.I18N("segment-panel", "dim-value-equally")
                    }, {
                        elem: "control",
                        controlAttrs: {
                            autocomplete: "off"
                        },
                        content: this.OPERATION_LIST.map(function(e) {
                            return {
                                elem: "option",
                                attrs: {
                                    value: e[0],
                                    selected: t.op === e[0] ? "selected" : void 0
                                },
                                content: BEM.I18N("segment-panel", "dim-value-" + e[1])
                            }
                        })
                    }]
                }, {
                    elem: "params-value-input-wrapper",
                    value: t
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "params"
    }, {
        onSetMod: {
            js: function() {
                var e = this,
                    t = this.findBlockInside("params-ctrl", "input");
                t.getDataprovider().setBlock(this), this.findBlockOn("params-type-checker", "radio-button").on("change", function() {
                    e.setMod(e.elem("params-value-controls"), "type", this.val().replace(/_/g, "-"))
                }), t.on("select", this._onChangeValue, this), this.findBlockInside("params-type-checker", "radio-button").on("change", this._changeType, this), this.findBlockOn("params-value-input", "input").on("change", this._onChangeValue, this), this.findBlockOn("params-dim-value-op", "select").on("change", this._onChangeValue, this), this.findBlockOn("params-ctrl", "input").on("change", this._onChangeValue, this), this.__base.apply(this, arguments)
            }
        },
        paramsSuggest: function(e) {
            var t = this.params.segment,
                i = BN("i-filter").parseParamsTypeFilterLine(e.trim()),
                n = i.pop(),
                o = i.length,
                s = t.dims[o],
                r = jQuery.extend(!0, {}, this._filter);
            return o || n ? r[t.id] = {
                tail: n,
                paramName: BN("i-filter").serializeParamsTypeFilterLine(i),
                noQuantifier: !0
            } : delete r[t.id], this._getSuggestData(r, [s], t).then(BN("i-promise").intercept(this, function(e) {
                return {
                    items: (e && e.items || []).map(function(t) {
                        return ["lingvo", {
                            text: null === t.dimensions[0].name ? BEM.I18N("segment-panel", "undefined") : BN("i-string").escapeHTML(t.dimensions[0].name),
                            translation: BN("humanize").format("number", t.metrics[0]),
                            sampled: e.sampled,
                            value: BN("i-filter").serializeParamsTypeFilterLine(i.concat([t.dimensions[0].name]))
                        }]
                    })
                }
            }))
        },
        val: function() {
            var e, t, i = this.findBlockOn("params-ctrl", "input").val().trim(),
                n = this.findBlockOn("params-value-input", "input").val().trim(),
                o = this.findBlockOn("params-type-checker", "radio-button").val(),
                s = this.params.segment,
                r = "==";
            return i ? ("double" === o ? (r = this.findBlockOn("params-dim-value-op", "select").val(), t = s.dim_value_double, isNaN(parseFloat(n)) && (n = "")) : (e = BN("i-filter").parseParamsTypeFilterLine(i), t = s.dims[e.length]), {
                paramName: i,
                paramVal: n,
                paramType: t,
                op: r
            }) : null
        },
        _changeType: function(e) {
            var t = this.findBlockOn("params-type-checker", "radio-button").val();
            return this.setMod(this.findElem("params-value-controls"), "type", t), this._onChangeValue(e)
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "url"
    }, {
        onBlock: function(e) {
            e.mod("multiline", "yes")
        },
        onElem: {
            header: function(e) {
                e.afterContent({
                    elem: "url-modes"
                })
            },
            "url-modes": function(e) {
                e.content([{
                    block: "radio-button",
                    mods: {
                        size: "s"
                    },
                    name: "segment-panel__url-modes",
                    value: "dim",
                    content: ["dim", "host_dim", "path_dim"].map(function(e) {
                        return {
                            elem: "radio",
                            controlAttrs: {
                                value: e
                            },
                            content: {
                                dim: BEM.I18N("segment-panel", "url-modes-full"),
                                host_dim: BEM.I18N("segment-panel", "url-modes-host"),
                                path_dim: BEM.I18N("segment-panel", "url-modes-path")
                            }[e]
                        }
                    })
                }, {
                    block: "hint-icon",
                    mix: [{
                        block: "segment-panel",
                        elem: "hint"
                    }],
                    text: BEM.I18N("segment-panel", "url-modes-hint")
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "url"
    }, {
        onSetMod: {
            js: function() {
                return this._urlMode = this.findBlockInside("url-modes", "radio-button"), this._urlMode.on("change", this._onChangeValue, this), this.__base.apply(this, arguments)
            }
        },
        val: function(e) {
            var t;
            return void 0 === e ? (t = this._multilineVal(), t ? jQuery.extend({}, t, {
                urlMode: this.findBlockInside("url-modes", "radio-button").val()
            }) : null) : (this.findBlockInside("url-modes", "radio-button").val(e.urlMode), this._multilineVal(e))
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "tree"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "path"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "goals"
    }, {
        onBlock: function(e) {
            e.mod("list", "yes")
        },
        onElem: {
            inverse: function(e) {
                e.remove()
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "goals"
    }, {
        _getInverse: function() {
            return !1
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "type",
        modVal: "date"
    }, {
        onElem: {
            content: function(e) {
                var t = e.param("value");
                e.content({
                    block: "date-range-selector",
                    period: t
                })
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "type",
        modVal: "date"
    }, {
        onSetMod: {
            js: function() {
                this._value = void 0, this._dateRangeSelector = this.findBlockInside("date-range-selector"), this._dateRangeSelector.on("change", this._onChangeValue, this), this.__base.apply(this, arguments)
            }
        },
        val: function() {
            return this._value
        },
        _onChangeValue: function(e, t) {
            return this._value = t, this.__base.apply(this, arguments)
        }
    }), BEM.decl("i-holidays", null, {
        HOLIDAYS: {},
        isHoliday: function(e) {
            var t, i = BN("i-date").create(e),
                n = i.getISODate();
            try {
                t = this.getHolidays()[n]
            } catch (o) {}
            return void 0 === t && (t = !Boolean(i.getDay() % 6)), Boolean(t)
        },
        getHolidays: function() {
            return this.HOLIDAYS[BN("i-router").getTld()]
        }
    }), BEM.decl("i-holidays", null, {
        HOLIDAYS: {
            ru: {
                "2008-03-08": 1,
                "2008-03-10": 1,
                "2008-05-01": 1,
                "2008-05-02": 1,
                "2008-05-04": 0,
                "2008-05-09": 1,
                "2008-06-07": 0,
                "2008-06-12": 1,
                "2008-06-13": 1,
                "2008-11-01": 0,
                "2008-11-03": 1,
                "2008-11-04": 1,
                "2009-01-01": 1,
                "2009-01-02": 1,
                "2009-01-03": 1,
                "2009-01-04": 1,
                "2009-01-05": 1,
                "2009-01-06": 1,
                "2009-01-07": 1,
                "2009-01-08": 1,
                "2009-01-09": 1,
                "2009-01-11": 0,
                "2009-02-23": 1,
                "2009-03-08": 1,
                "2009-03-09": 1,
                "2009-05-01": 1,
                "2009-05-09": 1,
                "2009-05-11": 1,
                "2009-06-12": 1,
                "2009-11-04": 1,
                "2010-01-01": 1,
                "2010-01-02": 1,
                "2010-01-03": 1,
                "2010-01-04": 1,
                "2010-01-05": 1,
                "2010-01-06": 1,
                "2010-01-07": 1,
                "2010-01-08": 1,
                "2010-02-22": 1,
                "2010-02-23": 1,
                "2010-02-27": 0,
                "2010-03-08": 1,
                "2010-05-01": 1,
                "2010-05-03": 1,
                "2010-05-09": 1,
                "2010-05-10": 1,
                "2010-06-12": 1,
                "2010-06-14": 1,
                "2010-11-04": 1,
                "2010-11-05": 1,
                "2010-11-13": 0,
                "2011-01-01": 1,
                "2011-01-02": 1,
                "2011-01-03": 1,
                "2011-01-04": 1,
                "2011-01-05": 1,
                "2011-01-06": 1,
                "2011-01-07": 1,
                "2011-01-10": 1,
                "2011-02-23": 1,
                "2011-03-05": 0,
                "2011-03-07": 1,
                "2011-03-08": 1,
                "2011-05-01": 1,
                "2011-05-02": 1,
                "2011-05-09": 1,
                "2011-06-12": 1,
                "2011-06-13": 1,
                "2011-11-04": 1,
                "2012-01-01": 1,
                "2012-01-02": 1,
                "2012-01-03": 1,
                "2012-01-04": 1,
                "2012-01-05": 1,
                "2012-01-06": 1,
                "2012-01-07": 1,
                "2012-01-09": 1,
                "2012-02-23": 1,
                "2012-03-08": 1,
                "2012-03-09": 1,
                "2012-03-11": 0,
                "2012-04-28": 0,
                "2012-04-30": 1,
                "2012-05-01": 1,
                "2012-05-05": 0,
                "2012-05-07": 1,
                "2012-05-08": 1,
                "2012-05-09": 1,
                "2012-05-12": 0,
                "2012-06-09": 0,
                "2012-06-11": 1,
                "2012-06-12": 1,
                "2012-11-04": 1,
                "2012-11-05": 1,
                "2012-12-29": 0,
                "2012-12-31": 1,
                "2013-01-01": 1,
                "2013-01-02": 1,
                "2013-01-03": 1,
                "2013-01-04": 1,
                "2013-01-05": 1,
                "2013-01-06": 1,
                "2013-01-07": 1,
                "2013-01-08": 1,
                "2013-02-23": 1,
                "2013-03-08": 1,
                "2013-05-01": 1,
                "2013-05-02": 1,
                "2013-05-03": 1,
                "2013-05-09": 1,
                "2013-05-10": 1,
                "2013-06-12": 1,
                "2013-11-04": 1,
                "2014-01-01": 1,
                "2014-01-02": 1,
                "2014-01-03": 1,
                "2014-01-04": 1,
                "2014-01-05": 1,
                "2014-01-06": 1,
                "2014-01-07": 1,
                "2014-01-08": 1,
                "2014-02-23": 1,
                "2014-03-08": 1,
                "2014-03-10": 1,
                "2014-05-01": 1,
                "2014-05-02": 1,
                "2014-05-09": 1,
                "2014-06-12": 1,
                "2014-06-13": 1,
                "2014-11-03": 1,
                "2014-11-04": 1,
                "2015-01-01": 1,
                "2015-01-02": 1,
                "2015-01-03": 1,
                "2015-01-04": 1,
                "2015-01-05": 1,
                "2015-01-06": 1,
                "2015-01-07": 1,
                "2015-01-08": 1,
                "2015-01-09": 1,
                "2015-02-23": 1,
                "2015-03-08": 1,
                "2015-03-09": 1,
                "2015-05-01": 1,
                "2015-05-04": 1,
                "2015-05-09": 1,
                "2015-05-11": 1,
                "2015-06-12": 1,
                "2015-11-04": 1,
                "2016-01-01": 1,
                "2016-01-02": 1,
                "2016-01-03": 1,
                "2016-01-04": 1,
                "2016-01-05": 1,
                "2016-01-06": 1,
                "2016-01-07": 1,
                "2016-01-08": 1,
                "2016-02-20": 0,
                "2016-02-22": 1,
                "2016-02-23": 1,
                "2016-03-07": 1,
                "2016-03-08": 1,
                "2016-05-01": 1,
                "2016-05-02": 1,
                "2016-05-03": 1,
                "2016-05-09": 1,
                "2016-06-12": 1,
                "2016-06-13": 1,
                "2016-11-04": 1,
                "2017-01-01": 1,
                "2017-01-02": 1,
                "2017-01-03": 1,
                "2017-01-04": 1,
                "2017-01-05": 1,
                "2017-01-06": 1,
                "2017-01-07": 1,
                "2017-01-08": 1,
                "2017-02-23": 1,
                "2017-03-08": 1,
                "2017-05-01": 1,
                "2017-05-09": 1,
                "2017-06-12": 1,
                "2017-11-04": 1
            },
            ua: {
                "2008-03-08": 1,
                "2008-03-10": 1,
                "2008-04-27": 1,
                "2008-04-28": 1,
                "2008-05-01": 1,
                "2008-05-02": 1,
                "2008-05-09": 1,
                "2008-06-15": 1,
                "2008-06-16": 1,
                "2008-06-28": 1,
                "2008-06-30": 1,
                "2008-08-24": 1,
                "2008-08-25": 1,
                "2009-01-01": 1,
                "2009-01-07": 1,
                "2009-03-08": 1,
                "2009-03-09": 1,
                "2009-04-19": 1,
                "2009-04-20": 1,
                "2009-05-01": 1,
                "2009-05-02": 1,
                "2009-05-04": 1,
                "2009-05-09": 1,
                "2009-05-11": 1,
                "2009-06-07": 1,
                "2009-06-08": 1,
                "2009-06-28": 1,
                "2009-06-29": 1,
                "2009-08-24": 1,
                "2010-01-01": 1,
                "2010-01-07": 1,
                "2010-03-08": 1,
                "2010-05-01": 1,
                "2010-05-02": 1,
                "2010-05-09": 1,
                "2010-06-28": 1,
                "2010-08-24": 1,
                "2011-01-01": 1,
                "2011-01-03": 1,
                "2011-01-07": 1,
                "2011-03-08": 1,
                "2011-04-15": 1,
                "2011-04-24": 1,
                "2011-04-25": 1,
                "2011-05-01": 1,
                "2011-05-02": 1,
                "2011-05-03": 1,
                "2011-05-09": 1,
                "2011-06-03": 1,
                "2011-06-12": 1,
                "2011-06-13": 1,
                "2011-06-28": 1,
                "2011-08-24": 1,
                "2012-01-01": 1,
                "2012-01-02": 1,
                "2012-01-06": 1,
                "2012-01-07": 1,
                "2012-03-03": 0,
                "2012-03-08": 1,
                "2012-03-09": 1,
                "2012-04-16": 1,
                "2012-04-28": 0,
                "2012-04-30": 1,
                "2012-05-01": 1,
                "2012-05-02": 1,
                "2012-05-09": 1,
                "2012-06-04": 1,
                "2012-06-28": 1,
                "2012-06-29": 1,
                "2012-07-07": 0,
                "2012-08-24": 1,
                "2013-01-01": 1,
                "2013-01-07": 1,
                "2013-03-08": 1,
                "2013-05-01": 1,
                "2013-05-02": 1,
                "2013-05-03": 1,
                "2013-05-05": 1,
                "2013-05-06": 1,
                "2013-05-09": 1,
                "2013-05-10": 1,
                "2013-05-18": 0,
                "2013-06-01": 0,
                "2013-06-23": 1,
                "2013-06-24": 1,
                "2013-06-28": 1,
                "2013-08-24": 1,
                "2013-08-26": 1,
                "2014-01-01": 1,
                "2014-01-02": 1,
                "2014-01-03": 1,
                "2014-01-06": 1,
                "2014-01-07": 1,
                "2014-01-11": 0,
                "2014-01-25": 0,
                "2014-02-08": 0,
                "2014-03-08": 1,
                "2014-03-10": 1,
                "2014-04-20": 1,
                "2014-04-21": 1,
                "2014-05-01": 1,
                "2014-05-02": 1,
                "2014-05-09": 1,
                "2014-06-08": 1,
                "2014-06-09": 1,
                "2014-06-28": 1,
                "2014-06-30": 1,
                "2014-08-24": 1,
                "2014-08-25": 1,
                "2015-01-01": 1,
                "2015-01-07": 1,
                "2015-03-08": 1,
                "2015-03-09": 1,
                "2015-04-12": 1,
                "2015-04-13": 1,
                "2015-05-01": 1,
                "2015-05-02": 1,
                "2015-05-04": 1,
                "2015-05-09": 1,
                "2015-05-11": 1,
                "2015-05-31": 1,
                "2015-06-01": 1,
                "2015-06-28": 1,
                "2015-06-29": 1,
                "2015-08-24": 1,
                "2015-10-14": 1,
                "2016-01-01": 1,
                "2016-01-07": 1,
                "2016-01-08": 1,
                "2016-01-16": 0,
                "2016-03-07": 1,
                "2016-03-08": 1,
                "2016-03-12": 0,
                "2016-05-01": 1,
                "2016-05-02": 1,
                "2016-05-03": 1,
                "2016-05-09": 1,
                "2016-06-19": 1,
                "2016-06-20": 1,
                "2016-06-27": 1,
                "2016-06-28": 1,
                "2016-07-02": 0,
                "2016-08-24": 1,
                "2016-10-14": 1,
                "2017-01-01": 1,
                "2017-01-07": 1,
                "2017-03-08": 1,
                "2017-05-01": 1,
                "2017-05-02": 1,
                "2017-05-09": 1,
                "2017-06-28": 1,
                "2017-08-24": 1,
                "2017-10-14": 1
            },
            "com.tr": {
                "2008-04-23": 1,
                "2008-05-01": 1,
                "2008-05-19": 1,
                "2008-08-30": 1,
                "2008-10-29": 1,
                "2009-01-01": 1,
                "2009-04-23": 1,
                "2009-05-01": 1,
                "2009-05-19": 1,
                "2009-08-30": 1,
                "2009-10-29": 1,
                "2010-01-01": 1,
                "2010-04-23": 1,
                "2010-05-01": 1,
                "2010-05-19": 1,
                "2010-08-30": 1,
                "2010-10-29": 1,
                "2011-01-01": 1,
                "2011-04-23": 1,
                "2011-05-01": 1,
                "2011-05-19": 1,
                "2011-08-30": 1,
                "2011-08-31": 1,
                "2011-09-01": 1,
                "2011-10-29": 1,
                "2011-11-06": 1,
                "2011-11-07": 1,
                "2011-11-08": 1,
                "2011-11-09": 1,
                "2012-01-01": 1,
                "2012-04-23": 1,
                "2012-05-01": 1,
                "2012-05-19": 1,
                "2012-08-30": 1,
                "2012-10-29": 1,
                "2013-01-01": 1,
                "2013-04-23": 1,
                "2013-05-01": 1,
                "2013-05-19": 1,
                "2013-08-07": 1,
                "2013-08-08": 1,
                "2013-08-09": 1,
                "2013-08-10": 1,
                "2013-08-30": 1,
                "2013-10-14": 1,
                "2013-10-15": 1,
                "2013-10-16": 1,
                "2013-10-17": 1,
                "2013-10-18": 1,
                "2013-10-28": 1,
                "2013-10-29": 1,
                "2014-01-01": 1,
                "2014-04-23": 1,
                "2014-05-01": 1,
                "2014-05-19": 1,
                "2014-07-27": 1,
                "2014-07-28": 1,
                "2014-07-29": 1,
                "2014-07-30": 1,
                "2014-08-30": 1,
                "2014-10-03": 1,
                "2014-10-04": 1,
                "2014-10-05": 1,
                "2014-10-06": 1,
                "2014-10-28": 1,
                "2014-10-29": 1,
                "2015-01-01": 1,
                "2015-04-23": 1,
                "2015-05-01": 1,
                "2015-05-19": 1,
                "2015-06-18": 1,
                "2015-07-16": 1,
                "2015-08-30": 1,
                "2015-09-23": 1,
                "2015-09-24": 1,
                "2015-09-25": 1,
                "2015-10-28": 1,
                "2015-10-29": 1,
                "2016-01-01": 1,
                "2016-04-23": 1,
                "2016-05-01": 1,
                "2016-05-19": 1,
                "2016-07-04": 1,
                "2016-07-05": 1,
                "2016-07-06": 1,
                "2016-07-07": 1,
                "2016-08-30": 1,
                "2016-09-12": 1,
                "2016-09-13": 1,
                "2016-09-14": 1,
                "2016-09-15": 1,
                "2016-10-28": 1,
                "2016-10-29": 1,
                "2017-01-01": 1,
                "2017-04-23": 1,
                "2017-05-01": 1,
                "2017-05-19": 1,
                "2017-08-30": 1,
                "2017-10-29": 1
            }
        }
    }), $.fn.findAtText = function(e, t) {
        var i = $([]);
        return $(e, this).each(function() {
            return this.innerHTML === t.toString() ? (i = $(this), !1) : void 0
        }), i
    }, SuperCalendar.prototype = {
        lang: "ru",
        locale: {},
        holidays: BEM.blocks["i-holidays"] && BEM.blocks["i-holidays"].HOLIDAYS || {},
        daysMonth: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
        selectedStep: 0,
        minMonth: 0,
        maxMonth: 11,
        cellWidthMonth: 4,
        cellHeightMonth: 1,
        minCellWidthMonth: 3,
        minCellHeightMonth: 1,
        maxCellWidthMonth: 30,
        maxCellHeightMonth: 20,
        WIDTH_MONTH: 10,
        WIDTH_YEAR: 120,
        MS_DAY: 864e5,
        DAYS_PADDING_BOTTOM: 30,
        getString: function(e) {
            return this.locale[this.lang] ? this.locale[this.lang][e] : this.locale.common ? this.locale.common(e) : ""
        },
        setPeriod: function(e) {
            this.prefs.period = e, this._selectPeriod(e), this._initPeriod(this.prefs), this.selectedPeriod.from && this.selectedPeriod.to && (this._fineSelectedPeriod(), this._setDraggerAtBeginDate(), this.updateDate())
        },
        _initPrefs: function(e) {
            var t = this,
                i = t._currentYear();
            t.prefs = {}, t._prefs = e, t.positionElement = e.positionElement ? $(e.positionElement) : null, t.calledElement = e.calledElement ? $(e.calledElement) : null, t._setPrefs("speedAnimation", "fast"), t._setPrefs("title", "title"), t._setPrefs("touch", !1), t._setPrefs("animation", !1), t._setPrefs("submitButton", "show"), t._setPrefs("resize", !0), t._setPrefs("center", !0), t._setPrefs("onSelect", function() {}), t._setPrefs("shadow", !1), t._setPrefs("opacityShadow", .2), t._setPrefs("selectorWeeks", !1), t._setPrefs("selectorMonths", !0), t._setPrefs("markedDate", null), t._setPrefs("disabledDates", []), 0 !== t.prefs.disabledDates.length && (t.prefs.selectorWeeks = !1, t.prefs.selectorMonths = !1), t._setPrefs("mousewheel", !0), t.prefs.minYear = e.minYear || i - 10, t.prefs.maxYear = e.maxYear || i + 1, e.minDate = t._prepareMinDate(e.minDate || "01.01." + t.prefs.minYear), t._setPrefs("minDate", null), e.maxDate = t._prepareMaxDate(e.maxDate || "01.01." + t.prefs.maxYear), t._setPrefs("maxDate", null), e.minGrayDate = t._prepareMinDate(e.minGrayDate), t._setPrefs("minGrayDate", null), e.maxGrayDate = t._prepareMaxDate(e.maxGrayDate), t._setPrefs("maxGrayDate", null), t._setPrefs("buttons", {
                close: !0,
                maximize: !0
            }), t._setPrefs("single", !1)
        },
        _prepareMinDate: function(e) {
            return "string" == typeof e && (e = this._textToDate(e)), e
        },
        _prepareMaxDate: function(e) {
            return "tomorrow" === e ? e = this._tomorrow() : "string" == typeof e && (e = this._textToDate(e)), e
        },
        _yesterday: function(e) {
            var t, i;
            return t = "undefined" == typeof e ? new Date : new Date(e.year, e.month, e.day), t.setHours(12), t.setTime(t.getTime() - this.MS_DAY), i = {
                day: t.getDate(),
                month: t.getMonth(),
                year: t.getFullYear()
            }, i.text = this._dateToText(i), i
        },
        _tomorrow: function(e) {
            var t, i;
            return t = "undefined" == typeof e ? new Date : new Date(e.year, e.month, e.day), t.setHours(12), t.setTime(t.getTime() + this.MS_DAY), i = {
                day: t.getDate(),
                month: t.getMonth(),
                year: t.getFullYear()
            }, i.text = this._dateToText(i), i
        },
        _currentYear: function() {
            return (new Date).getFullYear()
        },
        _setPrefs: function(e, t) {
            this.prefs[e] = "undefined" != typeof this._prefs[e] ? this._prefs[e] : t
        },
        _recalcDate: function(e) {
            var t, i, n, o, s, r = "";
            return e.text ? r = e.text : "string" == typeof e && (r = e), r ? (o = this._prepareTextDate(r).split("."), t = parseInt(o[0], 10), i = parseInt(o[1], 10) - 1, n = parseInt(o[2], 10)) : (t = e.day, i = e.month, n = e.year), s = {
                day: t,
                month: i,
                year: n,
                text: r
            }, s.text = this._dateToText(s), s
        },
        _isCorrectDates: function(e, t, i, n) {
            return e && t ? i && 1 === this._cmpDates(i, t) ? !1 : n && 1 === this._cmpDates(e, n) ? !1 : 1 !== this._cmpDates(e, t) : !1
        },
        _correctMinDate: function(e, t) {
            return e = this._recalcDate(e), t = this._recalcDate(t), t && 1 === this._cmpDates(t, e) && (e = t), e
        },
        _correctMaxDate: function(e, t) {
            var i = this._recalcDate(e);
            return t && -1 === this._cmpDates(t, i) && (i = this._yesterday(t)), i
        },
        _howManyMonths: function(e) {
            return e.to.month + 12 * e.to.year - (e.from.month + 12 * e.from.year)
        },
        _initPeriod: function(e) {
            if (this.selectedPeriod = {
                    to: null,
                    from: null
                }, e.period) {
                this._isCorrectDates(e.period.from, e.period.to, this.prefs.minDate, this.prefs.maxDate) && (this.selectedPeriod.from = this._correctMinDate(e.period.from, this.prefs.minDate), this.selectedPeriod.to = this._correctMaxDate(e.period.to, this.prefs.maxDate), this.jFrom.val(this._dateToText(this.selectedPeriod.from)), this.jTo.val(this._dateToText(this.selectedPeriod.to)));
                var t, i = this.selectedPeriod.from;
                i ? this._fineSelectedPeriod() : (t = new Date, this.beginDate = {
                    day: t.getDate(),
                    month: t.getMonth(),
                    year: t.getFullYear()
                }), this._oldSelectedPeriod = this.selectedPeriod
            }
        },
        _fineSelectedPeriod: function() {
            var e = this.selectedPeriod.from,
                t = this._howManyMonths(this.selectedPeriod),
                i = this.cellHeightMonth * this.cellWidthMonth;
            t >= i ? this.beginDate = e : this.beginDate = this._addMonths(e.month, e.year, -Math.floor((i - t) / 2))
        },
        _cacheElements: function() {
            var e = this.jElement,
                t = this,
                i = t._namespace,
                n = function(t) {
                    return $("." + i + t, e)
                };
            t.jFrom = n("from"), t.jTo = n("to"), t.jShow = n("show"), t.jMaxmin = n("max-min"), t.jClose = n("close"), t.jHead = n("head"), t.jSubmitShadow = n("submit-shadow"), t.jResizer = n("resizer"), t.jDays = n("days"), t.jYears = n("years"), t.jSelectedStart = null, t.jSelectedEnd = null, t.jYearsSelectedPeriod = n("years-period"), t.jYearsContainer = n("years-selector-container"), t.jYearsSelector = n("years-selector"), t.jYearsDragger = n("years-dragger")
        },
        _events: function() {
            function e(e, i) {
                var n = t._namespace + "error";
                !t._isCorrectDate(e.value) && e.value ? i || $(e).closest(".input").addClass(n) : $(e).closest(".input").removeClass(n), i || t._periodContainsDisabledDates() && (t.jFrom.closest(".input").addClass(n), t.jTo.closest(".input").addClass(n))
            }
            var t = this,
                i = 13,
                n = 38,
                o = 40,
                s = null,
                r = null,
                a = null,
                l = null,
                c = 0;
            t.jYearsContainer.on("click", "div" + t._namespaceClassname + "year", function() {
                var e, i = parseInt($(this).html(), 10),
                    n = t._addMonths(1, i, -Math.floor(t.cellHeightMonth * t.cellWidthMonth / 2));
                i === t.prefs.minYear && (n = {
                    month: 0,
                    year: i
                }), i === t.prefs.maxYear && (e = t.cellHeightMonth * t.cellWidthMonth, e > 12 && (e = 12), n = t._addMonths(1, i, -Math.floor(e) - 1)), t.beginDate = {
                    day: 1,
                    month: n.month,
                    year: n.year
                }, t._setDraggerAtYear(i), t.updateDate(), t._selectPeriod(t.selectedPeriod), t._updateSelectorDateContainer(t.prefs.animation)
            }), t.jYearsContainer.on("click", "div" + t._namespaceClassname + "years-line", function(e) {
                t._setDraggerAtX(e.pageX), t.beginDate = t._whatDraggerDate(), t.updateDate(), t._selectPeriod(t.selectedPeriod), t._updateSelectorDateContainer(t.prefs.animation)
            }), t.jDays.on("click", "th" + t._namespaceClassname + "month", function() {
                var e = $(this);
                if (!e.hasClass(t._namespace + "selector-month-disabled")) {
                    var i, n = $("b", this).html().split("."),
                        o = parseInt(n[0], 10),
                        s = parseInt(n[1], 10),
                        r = 0,
                        a = 0,
                        l = t.prefs.minDate,
                        c = t.prefs.maxDate;
                    l && l.month === o && l.year === s && (r = l.day), c && c.month === o && c.year === s && (a = c.day - 1), i = {
                        from: {
                            day: r || 1,
                            month: o,
                            year: s
                        },
                        to: {
                            day: a || t._daysPerMonth(o, s),
                            month: o,
                            year: s
                        }
                    }, t._updatePeriod(i)
                }
            }), t.jDays.on("click", "td" + t._namespaceClassname + "selector-week", function() {
                var e, i, n, o, s, r, a, l = $(this);
                l.hasClass(t._namespace + "selector-week-disabled") || (e = l.closest("tr"), i = l.closest("table").find("th").eq(0), n = e.find("td").not(t._namespaceClassname + "selector-week").not(t._namespaceClassname + "disabled-day").not(t._namespaceClassname + "empty"), n.length && (o = $("b", i).html().split("."), s = parseInt(o[0], 10), r = parseInt(o[1], 10), a = {
                    from: {
                        day: parseInt(n.eq(0).html(), 10),
                        month: s,
                        year: r
                    },
                    to: {
                        day: parseInt(n.eq(n.length - 1).html(), 10),
                        month: s,
                        year: r
                    }
                }, t._updatePeriod(a)))
            }), t.jDays.on("click", "td" + t._namespaceClassname + "month-td td", function() {
                if (this.innerHTML) {
                    var i, n, o, s, r, a, l, c = $(this),
                        d = !1,
                        u = function() {
                            t.jFrom.val(n), t.jTo.val(n), t.prefs.touch || t.jTo.focus(), t.selectedStep = 1, o = t.jFrom.val().split("."), r = {
                                from: {
                                    day: parseInt(o[0], 10),
                                    month: parseInt(o[1], 10) - 1,
                                    year: parseInt(o[2], 10)
                                },
                                to: null
                            }, t.selectedPeriod = r, t._selectPeriod(r)
                        };
                    if (!(c.hasClass(t._namespace + "day-disabled") || c.hasClass(t._namespace + "empty") || c.hasClass(t._namespace + "selector-week"))) {
                        switch (c.addClass(t._namespace + "selected"), i = t._getDateFromTd(this), n = t._dateToText(i), t.prefs.single && (t.selectedStep = 0), t.selectedStep) {
                            case 0:
                                u();
                                break;
                            case 1:
                                if (t.jTo.val(n).blur(), t.selectedStep = 0, r = {
                                        from: null,
                                        to: null
                                    }, s = t.jTo.val().split("."), o = t.jFrom.val().split("."), r = {
                                        from: {
                                            day: parseInt(o[0], 10),
                                            month: parseInt(o[1], 10) - 1,
                                            year: parseInt(o[2], 10)
                                        },
                                        to: {
                                            day: parseInt(s[0], 10),
                                            month: parseInt(s[1], 10) - 1,
                                            year: parseInt(s[2], 10)
                                        }
                                    }, a = t._cmpDates(r.from, r.to), 1 === a && (l = r.from, r.from = r.to, r.to = l, l = t.jTo.val(), t.jTo.val(t.jFrom.val()), t.jFrom.val(l)), d = t.prefs.disabledDates.some(function(e) {
                                        return 0 === t._dateInPeriod(e, t.jTo.val(), t.jFrom.val())
                                    })) {
                                    e(t.jTo[0], !0), e(t.jFrom[0], !0), u();
                                    break
                                }
                                t.selectedPeriod = r, t._selectPeriod(r)
                        }
                        t._updateSelectorDateSelectedPeriod(r), t.prefs.single && t.jShow.click()
                    }
                }
            }), t.prefs.mousewheel && t.jElement.on("mousewheel", function(e, i) {
                e.preventDefault();
                var n, o = 0 > i ? 1 : -1,
                    s = t._whatDraggerDate(),
                    r = t._addMonths(s.month, s.year, o);
                t._setDraggerAtDate(r.month, r.year), n = t._whatDraggerDate(), (s.month !== n.month || s.year !== n.year) && (t.beginDate = n, t._setDraggerAtBeginDate(), t.updateDate(), t._selectPeriod(t.selectedPeriod), t._updateSelectorDateContainer(t.prefs.animation))
            }), t._skipEvent = !1, t._addEvent(t.calledElement, "click", function(e) {
                ("BUTTON" !== this.tagName || e.clientY || e.clientX) && (t._skipEvent = !0, t.toggle())
            }), t._addEvent(document, "keypress", function(e) {
                var i = 27;
                t.jElement.is(":visible") && e.keyCode === i && t.close()
            }), t._addEvent(document, "click", function(e) {
                !t._skipEvent && e.clientY > 0 && t.jElement.is(":visible") && t.close(), t._skipEvent = !1
            }), t._addEvent(window, "resize", function() {
                t.jElement.is(":visible") && t.resize()
            }), t.jFrom.click(function() {
                $(t.jTo).removeClass(t._namespace + "to-selected"), t.selectedStep = 0
            }), t.jTo.click(function() {
                $(t.jFrom).removeClass(t._namespace + "from-selected"), t.selectedStep = 1
            }), t.jFrom.focus(function() {
                $(this).addClass(t._namespace + "from-selected"), t.jTo.removeClass(t._namespace + "to-selected")
            }).blur(function() {
                e(this), $(this).removeClass(t._namespace + "from-selected")
            }), t.jTo.focus(function() {
                $(this).addClass(t._namespace + "to-selected"), t.jFrom.removeClass(t._namespace + "from-selected")
            }).blur(function() {
                e(this), $(this).removeClass(t._namespace + "to-selected")
            }), t.jTo.add(t.jFrom).keyup(function(s) {
                var r, a, l, c, d, u, h, m, p;
                $.browser.mozilla && !t.isMacOS() && (r = $(this), s.keyCode === o ? (a = t._selectedDateField(r, -1), a && t._cursorAddDate(r, a)) : s.keyCode === n && (a = t._selectedDateField(r, 1), a && t._cursorAddDate(r, a))), l = t.jFrom.val(), c = t.jTo.val(), d = t._isCorrectDate(l), u = t._isCorrectDate(c), h = {
                    from: null,
                    to: null
                }, d && u && !t._periodContainsDisabledDates() ? (m = t._textToDate(l), p = t._textToDate(c), 1 === t._cmpDates(m, p) ? (h.from = p, h.to = m) : (h.from = m, h.to = p), t.selectedPeriod = h, t._isEqualPeriods(t._lastSelectedPeriod, h) || (t._deselectPeriod(), t._selectPeriod(h))) : (t._deselectPeriod(), t.selectedPeriod = {
                    from: null,
                    to: null
                }), t._updateSelectorDateSelectedPeriod(h), d && e(t.jFrom[0], !0), u && e(t.jTo[0], !0), t._updateShowButton(), s.keyCode === i && t.jShow.click()
            }), t.jShow.click(function() {
                if (!this.disabled) {
                    var e, i, n = t._textToDate(t.jFrom.val()),
                        o = t._textToDate(t.jTo.val());
                    1 === t._cmpDates(n, o) ? (e = o, i = n) : (e = n, i = o), e.text = t._dateToText(e), e.reverseText = t._dateToReverseText(e), i.text = t._dateToText(i), i.reverseText = t._dateToReverseText(i), t.selectedPeriod = {
                        from: e,
                        to: i
                    }, t._oldSelectedPeriod = t.selectedPeriod, t.hide(), t.prefs.onSelect(e, i, t.finePeriod(e, i), t.prefs.submitButton), $(document).trigger("selectDate" + t._namespaceEvent)
                }
            }), t.jClose.click(function() {
                t.close()
            }), t.jHead.on("dblclick", function() {
                t.jMaxmin.click()
            }), t.jMaxmin.click(function() {
                var e, i = !1,
                    n = function() {
                        t.resize(), i && t.selectedPeriod && t.selectedPeriod.from && (t._fineSelectedPeriod(), t._setDraggerAtBeginDate(), t._manualUpdateDragger(!0))
                    };
                t.jElement.hasClass(t._namespace + "maximize") ? (t.jElement.removeClass(t._namespace + "maximize"), e = {
                    left: s,
                    top: r,
                    width: a,
                    height: l
                }, t.jMaxmin.attr("title", t.getString("expand")), i = !0) : (s = t.jElement.css("left"), r = t.jElement.css("top"), a = t.jElement.width(), l = t.jElement.height(), c = t.cellWidthMonth, e = {
                    left: "0",
                    top: "0",
                    width: "100%",
                    height: "100%"
                }, t.jElement.addClass(t._namespace + "maximize"), t.jMaxmin.attr("title", t.getString("collapse"))), t.prefs.animation ? t.jElement.animate(e, t.prefs.speedAnimation, n) : (t.jElement.css(e), n())
            }), $(t.jElement).click(function() {
                return !1
            })
        },
        _periodContainsDisabledDates: function() {
            var e, t, i, n, o, s, r = this.jFrom.val(),
                a = this.jTo.val();
            return 0 === this.prefs.disabledDates.length ? !1 : r && a && this._isCorrectDate(r) && this._isCorrectDate(a) ? (e = this._cmpDates(r, a), t = this._textToDate(r), i = this._textToDate(a), n = new Date(t.year, t.month, t.day), o = new Date(i.year, i.month, i.day), 1 === e && (s = o, o = n, n = s), this.prefs.disabledDates.some(function(e) {
                var t = this._textToDate(e),
                    i = new Date(t.year, t.month, t.day);
                return i >= n && o >= i
            }, this)) : !1
        },
        _cursorAddDate: function(e, t) {
            var i, n = e.val(),
                o = this._textToDate(n);
            o.day += t.day, o.month += t.month, o.year += t.year, o.month > this.maxMonth && (o.month = this.minMonth), o.month < this.minMonth && (o.month = this.maxMonth), o.year > this.prefs.maxYear && (o.year = this.prefs.maxYear), o.year < this.prefs.minYear && (o.year = this.prefs.minYear), i = this._daysPerMonth(o.month, o.year), o.day < 1 && (o.day = i), o.day > i && (0 !== t.day ? o.day = 1 : o.day = i), e.val(this._dateToText(o))[0].setSelectionRange(t.selectionStart, t.selectionEnd)
        },
        _selectedDateField: function(e, t) {
            var i, n = e.get(0).selectionStart,
                o = e.val(),
                s = 0,
                r = {
                    day: 0,
                    month: 0,
                    year: 0
                };
            if (!this._isCorrectDate(o, !0)) return !1;
            for (i = 0; i < o.length && n > i; i++) "." === o.charAt(i) && s++;
            switch (s) {
                case 0:
                    r.day = t, r.selectionStart = 0, r.selectionEnd = r.selectionStart + 2;
                    break;
                case 1:
                    r.month = t, r.selectionStart = 3, r.selectionEnd = r.selectionStart + 2;
                    break;
                case 2:
                    r.year = t, r.selectionStart = 6, r.selectionEnd = r.selectionStart + 4
            }
            return r
        },
        _updateShowButton: function() {
            var e = this._isCorrectDate(this.jFrom.val()) && this._isCorrectDate(this.jTo.val());
            this.jShow[0].disabled = e && !this._periodContainsDisabledDates() ? !1 : !0
        },
        _addEvent: function(e, t, i) {
            this._bufferEvents.push({
                el: e,
                t: t,
                func: i
            }), $(e).on(t, i)
        },
        _removeEvents: function() {
            var e, t;
            for (e = 0; e < this._bufferEvents.length; e++) t = this._bufferEvents[e], $(t.el).off(t.t, t.func)
        },
        _removeSelectedStartEnd: function() {
            this.jSelectedStart && (this.jSelectedStart.removeClass(this._namespace + "selected-start"), this.jSelectedStart = null), this.jSelectedEnd && (this.jSelectedEnd.removeClass(this._namespace + "selected-end"), this.jSelectedEnd = null)
        },
        _setSelectedStart: function(e) {
            var t = this._namespace + "selected-start";
            this.jSelectedStart && this.jSelectedStart.removeClass(t), e.addClass(t), this.jSelectedStart = e
        },
        _setSelectedEnd: function(e) {
            var t = this._namespace + "selected-end";
            this.jSelectedEnd && this.jSelectedEnd.removeClass(t), e.addClass(t), this.jSelectedEnd = e
        },
        _getDateFromTd: function(e) {
            e = $(e);
            var t = parseInt(e.html(), 10),
                i = e.closest("table").find("th b").html().split(/\./),
                n = parseInt(i[0], 10),
                o = parseInt(i[1], 10);
            return {
                day: t,
                month: n,
                year: o
            }
        },
        _leadZero: function(e) {
            return 10 > e ? "0" + e : "" + e
        },
        _addMonths: function(e, t, i) {
            var n = 12,
                o = t * n + e + i;
            return {
                month: o % n,
                year: Math.floor(o / n)
            }
        },
        _whatDraggerDate: function() {
            var e = this.jYearsDragger.position().left,
                t = this.prefs.minYear + Math.floor(e / this.WIDTH_YEAR),
                i = Math.floor((e - (t - this.prefs.minYear) * this.WIDTH_YEAR) / this.WIDTH_MONTH);
            return {
                day: 1,
                month: i,
                year: t
            }
        },
        _manualUpdateDragger: function(e) {
            var t = this._whatDraggerDate();
            (e || t.month !== this.beginDate.month || t.year !== this.beginDate.year) && (this.beginDate = t, this.updateDate()), this._selectPeriod(this.selectedPeriod)
        },
        _setDraggerAtBeginDate: function() {
            var e = (this.beginDate.year - this.prefs.minYear) * this.WIDTH_YEAR + this.beginDate.month * this.WIDTH_MONTH;
            this.jYearsDragger.css("left", e + "px")
        },
        _dateToText: function(e) {
            return this._leadZero(e.day) + "." + this._leadZero(e.month + 1) + "." + e.year
        },
        _dateToReverseText: function(e) {
            return e.year + this._leadZero(e.month + 1) + this._leadZero(e.day)
        },
        _textToDate: function(e) {
            var t = e.split(/\./);
            return {
                day: parseInt(t[0], 10),
                month: parseInt(t[1], 10) - 1,
                year: parseInt(t[2], 10)
            }
        },
        _reverseTextToDate: function(e) {
            var t = e.substr(0, 4),
                i = e.substr(4, 2),
                n = e.substr(6, 2);
            return {
                day: parseInt(n, 10),
                month: parseInt(i, 10) - 1,
                year: parseInt(t, 10)
            }
        },
        _prepareTextDate: function(e) {
            if (-1 !== e.search(/\./)) return e;
            var t = e.substr(0, 4),
                i = e.substr(4, 2),
                n = e.substr(6, 2);
            return n + "." + i + "." + t
        },
        _daysPerMonth: function(e, t) {
            var i = 1;
            return this.isLeapYear(t) && e === i ? 29 : this.daysMonth[e]
        },
        _updatePeriod: function(e) {
            var t = this;
            t.jFrom.val(t._dateToText(e.from)), t.jTo.val(t._dateToText(e.to)), t.selectedPeriod = e, t._selectPeriod(e), t._updateSelectorDateSelectedPeriod(e)
        },
        _updateSelectorDateContainer: function(e) {
            var t, i = this.jYears.width(),
                n = this.jYearsContainer.width(),
                o = this.jYearsDragger.width();
            i > n ? t = (i - n) / 2 : (t = -this.jYearsDragger.position().left + (i - o) / 2, t > 0 && (t = 0), i > t + n && (t = i - n)), e ? this.jYearsContainer.stop().animate({
                left: t + "px"
            }, this.prefs.speedAnimation) : this.jYearsContainer.css("left", t + "px")
        },
        _updateSelectorDateSelectedPeriod: function(e) {
            var t, i, n, o, s, r = 1,
                a = 2592e6;
            return e.from && e.to ? (this.jYearsSelectedPeriod.show(), t = new Date(e.from.year, e.from.month, e.from.day), i = new Date(e.to.year, e.to.month, e.to.day), n = (i.getTime() - t.getTime()) / a * this.WIDTH_MONTH || r, o = this.jYearsContainer.width(), n > o && (n = o), s = (e.from.year - this.prefs.minYear) * this.WIDTH_YEAR + e.from.month * this.WIDTH_MONTH + e.from.day / 30 * this.WIDTH_MONTH, void this.jYearsSelectedPeriod.css({
                width: n + "px",
                left: s + "px"
            })) : void this.jYearsSelectedPeriod.hide().width(r)
        },
        _updateSelectorDateDragger: function() {
            var e = this,
                t = e.cellWidthMonth * e.cellHeightMonth * e.WIDTH_MONTH,
                i = e.jYearsContainer.width(),
                n = e.jYearsDragger.position(),
                o = n.left;
            0 > o && (o = 0, e.jYearsDragger.css("left", o)), t > i && (t = i), t + o > i && e.jYearsDragger.css("left", i - t + "px"), e.jYearsDragger.css("width", t + "px")
        },
        _setDraggerAtYear: function(e) {
            var t = this.jYearsDragger.width(),
                i = this.jYearsContainer.width(),
                n = this.WIDTH_YEAR * (e - this.prefs.minYear) - t / 2;
            0 > n && (n = 0), n + t > i && (n = i - t), this.jYearsDragger.css("left", n + "px")
        },
        _setDraggerAtDate: function(e, t) {
            var i = this.jYearsDragger.width(),
                n = this.jYearsContainer.width(),
                o = this.WIDTH_YEAR * (t - this.prefs.minYear) + this.WIDTH_MONTH * e;
            0 > o && (o = 0), o + i > n && (o = n - i), this.jYearsDragger.css("left", o + "px")
        },
        _setDraggerAtX: function(e) {
            var t = this.jYearsDragger.width(),
                i = this.jYearsContainer.width(),
                n = e - this.jYearsSelector.offset().left - this.jYearsContainer.position().left - t / 2;
            0 > n && (n = 0), n + t > i && (n = i - t), this.jYearsDragger.css("left", n + "px")
        },
        _selectPeriod: function(e) {
            this._lastSelectedPeriod = e;
            var t = this;
            if ($("table table", this.jDays).each(function() {
                    $(this).closest("td").removeClass(t._namespace + "selected").removeClass(t._namespace + "partially-selected")
                }), e.from) {
                if (e.to) {
                    switch (this._cmpDates(e.from, e.to)) {
                        case 0:
                            this._selectDay(e.from);
                            break;
                        default:
                            this._selectOnlyPeriod(e.from, e.to)
                    }
                    this._removeClassError()
                } else this._selectDay(e.from);
                this._updateShowButton()
            }
        },
        _removeClassError: function() {
            this.jTo.add(this.jFrom).removeClass(this._namespace + "error")
        },
        _deselectPeriod: function() {
            var e = this;
            this._lastSelectedPeriod = null, this._removeSelectedStartEnd(), $("td", this.jDays).each(function() {
                $(this).removeClass(e._namespace + "selected").removeClass(e._namespace + "partially-selected")
            })
        },
        _selectOnlyPeriod: function(e, t) {
            var i, n, o, s, r, a = this,
                l = function(e, t, i) {
                    e.closest("td").addClass(s).removeClass(o), e.find("td").each(function() {
                        var e, n = parseInt(this.innerHTML, 10);
                        isNaN(n) || (e = $(this), "to" === i && n <= t.day || n >= t.day && "from" === i ? ("from" === i && n === t.day && a._setSelectedStart(e), "to" === i && n === t.day && a._setSelectedEnd(e), e.addClass(o)) : e.removeClass(o))
                    })
                };
            this._removeSelectedStartEnd(), i = this._leadZero(e.year) + this._leadZero(e.month), n = this._leadZero(t.year) + this._leadZero(t.month), a = this, o = this._namespace + "selected", s = this._namespace + "partially-selected", i === n ? (r = this.jDays.findAtText("table table th b", e.month + "." + e.year).closest("table"), r.closest("td").addClass(s).removeClass(o), r.find("td").each(function() {
                var i, n = parseInt(this.innerHTML, 10);
                isNaN(n) || (i = $(this), n >= e.day && n <= t.day ? (n === e.day && a._setSelectedStart(i), n === t.day && a._setSelectedEnd(i), i.addClass(o)) : i.removeClass(o))
            })) : this.jDays.find("table table th b").each(function() {
                var i = $(this).closest("table"),
                    n = i.closest("td"),
                    r = e.month + "." + e.year,
                    c = t.month + "." + t.year;
                return this.innerHTML === r ? void l.call(a, i, e, "from") : this.innerHTML === c ? void l.call(a, i, t, "to") : void(0 === a._dateInPeriodWithoutDay(this.innerHTML, r, c) ? n.removeClass(s).addClass(o) : n.removeClass(s).removeClass(o))
            })
        },
        _selectDay: function(e) {
            this._removeSelectedStartEnd();
            var t = e.month + "." + e.year,
                i = this.jDays.findAtText("table table th b", t).closest("table"),
                n = this._namespace + "selected";
            i.closest("td").removeClass(n).addClass(this._namespace + "partially-selected"), i.find("td").removeClass(n), i.findAtText("td", e.day).addClass(n)
        },
        _prepareDate: function(e) {
            return "string" != typeof e && (e = e.text || this._dateToText(e)), parseInt(e.split(".").reverse().join(""), 10)
        },
        _cmpDates: function(e, t) {
            var i = this._prepareDate(e),
                n = this._prepareDate(t);
            return i === n ? 0 : i > n ? 1 : -1
        },
        _isEqualPeriods: function(e, t) {
            function i(i) {
                var n = e[i],
                    o = t[i];
                return n === o && null === o ? !0 : null === n || null === o ? !1 : n.day !== o.day || n.month !== o.month || n.year !== o.year ? !1 : !0
            }
            return e && t ? i("to") && i("from") : !1
        },
        _dateInPeriod: function(e, t, i) {
            var n = this._prepareDate(e),
                o = this._prepareDate(t),
                s = this._prepareDate(i);
            return n > o ? -1 : s > n ? 1 : 0
        },
        _weekOfYear: function(e) {
            var t = 7 * this.MS_DAY,
                i = Date.UTC(e.getFullYear(), e.getMonth(), e.getDate() + 3) / this.MS_DAY,
                n = Math.floor(i / 7),
                o = new Date(n * t).getUTCFullYear();
            return n - Math.floor(Date.UTC(o, 0, 7) / t) + 1
        },
        _dateInPeriodWithoutDay: function(e, t, i) {
            var n = function(e) {
                    var t = e.split(".");
                    return t[0] = this._leadZero(parseInt(t[0], 10)), parseInt(t.reverse().join(""), 10)
                },
                o = n.call(this, e),
                s = n.call(this, i),
                r = n.call(this, t);
            return o > s ? 1 : r > o ? -1 : 0
        },
        _initDragger: function() {
            function e(e) {
                s = !0;
                var t = $(r).position();
                o = t.left, n = l._getPageX(e), a = $(this), e.preventDefault()
            }

            function t(e) {
                s && !l.prefs.touch && i(e), s = !1, a = null, l._updateSelectorDateContainer(l.prefs.animation)
            }

            function i(e) {
                if (s) {
                    var t, i, a = l._getPageX(e) - (n - o);
                    0 > a && (a = 0), t = r.width(), i = l.jYearsContainer.width() - t, a > i && (a = i), $(r).css({
                        left: a + "px"
                    }), l._manualUpdateDragger()
                }
            }
            var n, o, s = !1,
                r = this.jYearsDragger,
                a = null,
                l = this;
            l.prefs.touch ? (this._addEvent(document, "touchmove", i), this._addEvent(document, "touchcancel touchend", t), r.on("touchstart", e)) : (this._addEvent(document, "mousemove", i), this._addEvent(document, "mouseup", t), r.on("mousedown", e))
        },
        _initResizer: function() {
            function e(e) {
                if (p.jElement.hasClass(p._namespace + "maximize")) return void(h = !1);
                h = !0;
                var t = $(f).offset();
                d = t.left, u = t.top, r = p._getPageX(e), a = p._getPageY(e), b = $(this), e.preventDefault()
            }

            function t(e) {
                h && !p.prefs.touch && i(e), h = !1, b = null
            }

            function i(e) {
                if (h) {
                    var t = p._getPageX(e) - (r - d),
                        i = p._getPageY(e) - (a - u);
                    0 > i && (i = 0), $(f).css({
                        left: t + "px",
                        top: i + "px"
                    }), e.preventDefault()
                }
            }

            function n(e) {
                m = !0;
                var t, i, n = $(f).offset();
                d = n.left, u = n.top, r = p._getPageX(e), a = p._getPageY(e), t = $("> table > table", p.jDays), i = p.jHead, l = t.outerWidth(), c = t.outerHeight() + i.outerHeight(), y = $(this), e.preventDefault()
            }

            function o(e) {
                m && !p.prefs.touch && s(e), m = !1, y = null
            }

            function s(e) {
                if (m) {
                    var t = p._getPageX(e) - d,
                        i = p._getPageY(e) - u;
                    l > t && (t = l), c > i && (i = c), y.hasClass(p._namespace + "resizer") && ($(f).css({
                        width: t + "px",
                        height: i + "px"
                    }), p.resize()), e.preventDefault()
                }
            }
            var r, a, l, c, d, u, h = !1,
                m = !1,
                p = this,
                f = p.jElement,
                g = p.jHead,
                _ = p.jResizer,
                b = null,
                y = null,
                v = "mousemove",
                M = "mousedown",
                k = "mouseup";
            this.prefs.touch && (v = "touchmove", M = "touchstart", k = "touchcancel touchend"), this._addEvent(document, v, s), this._addEvent(document, v, i), this._addEvent(document, k, o), this._addEvent(document, k, t), _.on(M, n), g.on(M, e)
        },
        _getPageX: function(e) {
            return this.prefs.touch && e.type.match("touch") ? e.originalEvent.touches[0].pageX : e.pageX
        },
        _getPageY: function(e) {
            return this.prefs.touch && e.type.match("touch") ? e.originalEvent.touches[0].pageY : e.pageY
        },
        _beforePaste: function(e) {
            return e.replace(/\{n\}/g, this._namespace)
        },
        _selectorYears: function() {
            var e, t = this.WIDTH_YEAR * (this.prefs.maxYear - this.prefs.minYear),
                i = [],
                n = 0;
            for (i.push('<div class="{n}years-selector"><div class="{n}years-selector-container" style="width:' + t + 'px"><div class="{n}years-dragger" title="' + this.getString("move") + '"></div><div class="{n}years-period"></div>'), e = this.prefs.minYear; e <= this.prefs.maxYear; e++) i.push('<div class="{n}year" style="left:' + this.WIDTH_YEAR * n + 'px">' + e + "</div>"), n++;
            return i.push("</div></div>"), i.join("")
        },
        _pasteDays: function(e, t, i) {
            function n() {
                if (l._cacheFirstLetters) return l._cacheFirstLetters;
                var e, t = l.getString("firstLetterWeekDay"),
                    i = [],
                    n = 6,
                    o = 5;
                for (i.push('<td class="' + l._namespace + 'first-letters-td"><table class="' + l._namespace + 'first-letters-table"><tr>'), l.prefs.selectorWeeks && i.push('<th class="{n}selector-week-cap"><span class="{n}selector-week-cap"></span></th>'), e = 0; e < t.length; e++) i.push("<th" + (e === n || e === o ? ' class="{n}holiday"' : "") + ">" + t[e] + "</th>");
                return i.push("</tr></table></td>"), l._cacheFirstLetters = i.join(""), l._cacheFirstLetters
            }
            var o, s, r, a, l = this,
                c = 0,
                d = [],
                u = "",
                h = i;
            for (d.push('<table><tr class="' + this._namespace + 'first-letters-tr">'), o = 0; o < this.cellWidthMonth; o++) d.push(n());
            for (d.push("</tr>"), s = 0; s < this.cellHeightMonth; s++) {
                for (d.push('<tr class="' + this._namespace + 'month-tr">'), r = 0; r < this.cellWidthMonth; r++) s || r ? (u = "", i !== h && (u = h = i)) : u = i, a = this._namespace + "month" + t + " " + this._namespace + "month-td " + this._namespace + (i % 2 ? "even-year" : "odd-year"), i >= this.prefs.minYear && i < this.prefs.maxYear ? d.push('<td class="' + a + '">' + this._cacheBuildDays(e, t, i, u) + "</td>") : d.push("<td>&nbsp;</td>"), t++, t > this.maxMonth && (t = this.minMonth, i++), c++;
                d.push("</tr>")
            }
            d.push("</table>"), $("> table", this.jDays).remove(), this.jDays.html(this._beforePaste(d.join("")))
        },
        _setMinSize: function() {
            if (!this._minSize) {
                this._minSize = !0;
                var e, t = this.jDays.find(this._namespaceClassname + "first-letters-td:eq(0)").outerWidth(!0),
                    i = t * this.minCellWidthMonth + parseInt(this.jElement.css("padding-right"), 10) + parseInt(this.jElement.css("padding-left"), 10),
                    n = 0;
                this._maxWidthTd = t, this.jDays.find(this._namespaceClassname + "month-td").each(function() {
                    n = Math.max(n, $(this).outerHeight(!0))
                }), this._maxHeightTd = n, e = this.jHead.outerHeight(!0) + this.minCellHeightMonth * n + this.jYears.outerHeight(!0) + this.jDays.find("tr" + this._namespaceClassname + "first-letters-tr").outerHeight(!0) + this.jSubmitShadow.outerHeight(!0) + this.DAYS_PADDING_BOTTOM, this.jElement.css({
                    minWidth: i + "px",
                    minHeight: e + "px"
                })
            }
        },
        _calcNewSize: function() {
            var e = this,
                t = Math.floor((e.jElement.outerWidth() - parseInt(e.jElement.css("padding-right"), 10)) / e._maxWidthTd),
                i = Math.floor((e.jElement.outerHeight() - e.jHead.outerHeight(!0) - e.jYears.outerHeight(!0) - e.jDays.find("tr" + e._namespaceClassname + "first-letters-tr").outerHeight(!0) - e.jSubmitShadow.outerHeight(!0) - e.DAYS_PADDING_BOTTOM) / e._maxHeightTd);
            t < e.minCellWidthMonth && (t = e.minCellWidthMonth), t > e.maxCellWidthMonth && (t = e.maxCellWidthMonth), i < e.minCellHeightMonth && (i = e.minCellHeightMonth), i > e.maxCellHeightMonth && (i = e.maxCellHeightMonth), (t !== e.cellWidthMonth || i !== e.cellHeightMonth) && (e.cellWidthMonth = t, e.cellHeightMonth = i, e.updateDate())
        },
        _isCorrectDate: function(e, t) {
            if (!e) return !1;
            var i, n, o, s, r, a = e.split(/\./);
            return 3 !== a.length ? !1 : (i = parseInt(a[0], 10), n = parseInt(a[1], 10), o = parseInt(a[2], 10), s = this._dateToText({
                day: i,
                month: n - 1,
                year: o
            }), isNaN(i) || isNaN(n) || isNaN(o) ? !1 : 1900 > o || o < this.prefs.minYear ? !1 : o > this.prefs.maxYear ? !1 : n < this.minMonth + 1 || n > this.maxMonth + 1 ? !1 : (n -= 1, t ? !0 : 1 > i || i > this._daysPerMonth(n, o) ? !1 : (r = this.prefs, r.minDate && -1 === this._cmpDates(s, this._dateToText(r.minDate)) ? !1 : !(r.maxDate && -1 !== this._cmpDates(s, this._dateToText(r.maxDate))))))
        },
        _cacheBuildDays: function(e, t, i, n) {
            var o = t + "." + i;
            this._cacheMonths[o];
            return this._buildDays(e, t, i, n)
        },
        _getDateObj: function(e) {
            return e ? new Date(e.year, e.month, e.day, 0, 0, 0) : e
        },
        _buildDays: function(e, t, i, n) {
            function o(e, t, i) {
                return e === x && t === E && i === N
            }

            function s(e) {
                return S && e.valueOf() < S.valueOf() ? -1 : D && e.valueOf() >= D.valueOf() ? 1 : 0
            }

            function r(e) {
                return C && e.valueOf() < C.valueOf() ? -1 : T && e.valueOf() >= T.valueOf() ? 1 : 0
            }

            function a(e, t, i, n) {
                var o, s, r = !0;
                for (o = i, s = e.length; A >= t && s >= o; o++) {
                    if (e[o] === !1) {
                        r = !1;
                        break
                    }
                    t++
                }
                return '<td class="{n}selector-week' + (r ? ' {n}selector-week-disabled"' : '" title="' + I.getString("selectWeek") + " " + n + '"') + '><span class="{n}selector-week"></span></td>'
            }
            var l, c, d, u, h, m, p, f, g, _, b, y, v, M, k, B, w = new Date,
                x = w.getDate(),
                E = w.getMonth(),
                N = w.getFullYear(),
                I = this,
                S = I._getDateObj(I.prefs.minDate),
                D = I._getDateObj(I.prefs.maxDate),
                C = I._getDateObj(I.prefs.minGrayDate),
                T = I._getDateObj(I.prefs.maxGrayDate),
                O = 1,
                P = 5,
                A = 6;
            for (l = new Date(i, t, 1, 0, 0, 0), I.isLeapYear(i) ? I.daysMonth[O] = 29 : I.daysMonth[O] = 28, c = I.getString("months")[t], d = [], u = l.getDay() - 1, -1 === u && (u = A), h = [], m = [], p = 1; p <= I.daysMonth[t]; p++) l.setDate(p), h[p] = 0 !== s(l), m[p] = 0 !== r(l);
            for (B = I._isMonthDisabled(t, i, h), d.push('<table><tr><th class="{n}month' + (B ? " {n}selector-month-gray" : "") + (I.prefs.single || !I.prefs.selectorMonths || B ? " {n}selector-month-disabled" : "") + '" colspan="' + (I.prefs.selectorWeeks ? 8 : 7) + '" title="' + c + " " + i + '">' + c + "&nbsp;" + (0 === t || 11 === t ? i : n) + "<b>" + t + "." + i + "</b></th></tr>"), f = 0, p = 0; u > p; p++) f || (d.push("<tr>"), I.prefs.selectorWeeks && (l.setDate(1), d.push(a(h, p, 1, I._weekOfYear(l))))), d.push('<td class="{n}empty">&nbsp;</td>'), f++;
            for (g = 1; g <= I.daysMonth[t]; g++) l.setDate(g), u = l.getDay() - 1, f || (d.push("<tr>"), I.prefs.selectorWeeks && d.push(a(h, u, g, I._weekOfYear(l)))), -1 === u && (u = A), _ = "", b = "", y = I._leadZero(g) + "." + I._leadZero(t + 1) + "." + i, v = i + "-" + I._leadZero(t + 1) + "-" + I._leadZero(g), _ = u !== A && u !== P ? "{n}weekday" : "{n}holiday", I.holidays && I.holidays[I.lang] && (M = I.holidays[I.lang][v], 1 === M ? _ = "{n}holiday" : 0 === M && (_ = "{n}weekday")), g === I.day && t === I.month && i === I.year && (_ += " {n}selected"), h[g] && (_ += " {n}day-disabled"), m[g] && (_ += " {n}gray-period"), o(g, t, i) && (_ += " {n}now", b += I.getString("now")), I.prefs.markedDate && (k = I.prefs.markedDate[y], k && (_ += " {n}marked", b && (b += ", "), b += k)), 0 !== I.prefs.disabledDates.length && -1 !== I.prefs.disabledDates.indexOf(y) && (_ += " {n}day-disabled"), d.push('<td class="' + _ + '"' + (b ? ' title="' + b + '"' : "") + ">" + g + "</td>"), f === A && (d.push("</tr>"), f = -1), f++;
            return f && d.push("</tr>"), d.push("</table>"), d.join("")
        },
        _isMonthDisabled: function(e, t, i) {
            var n, o, s, r = parseInt(String(t) + this._leadZero(e), 10),
                a = !0,
                l = !0,
                c = this.prefs;
            if (c.minDate && (n = parseInt(String(c.minDate.year) + this._leadZero(c.minDate.month), 10), a = r >= n), c.maxDate && (o = parseInt(String(c.maxDate.year) + this._leadZero(c.maxDate.month), 10), l = o >= r), !a || !l) return !0;
            if (0 !== this.prefs.disabledDates.length) {
                for (var d = 1; d <= this.daysMonth[e]; d++)
                    if (s = this._leadZero(d) + "." + this._leadZero(e + 1) + "." + t, -1 === c.disabledDates.indexOf(s) && !i[d]) return !1;
                return !0
            }
            return !1
        },
        isLeapYear: function(e) {
            return e % 4 === 0 && e % 100 !== 0 || e % 400 === 0
        },
        resize: function() {
            this._setMinSize(), this._calcNewSize(), this._updateSelectorDateContainer(), this._updateSelectorDateDragger(), this._manualUpdateDragger()
        },
        updateDate: function() {
            var e = this.beginDate;
            this._pasteDays(e.day, e.month, e.year)
        },
        _animationShow: function(e) {
            e.css({
                marginTop: "-150px",
                opacity: "0"
            }), e.stop().animate({
                opacity: "1",
                marginTop: "0"
            }, this.prefs.speedAnimation)
        },
        _animationHide: function(e) {
            e.css({
                marginTop: "0",
                opacity: "1"
            }), e.stop().animate({
                opacity: "0",
                marginTop: "-150px"
            }, {
                duration: this.prefs.speedAnimation,
                complete: function() {
                    e.hide()
                }
            })
        },
        _plugins: [],
        _initPlugins: function() {
            for (var e = 0; e < this._plugins.length; e++) this._plugins[e].call(this)
        },
        addPlugin: function(e) {
            e && this._plugins.push(e)
        },
        _firstShow: !0,
        show: function() {
            var e = function() {
                    t._firstShow && (t._setDraggerAtBeginDate(), t._initPlugins()), t.resize(), t._updateSelectorDateSelectedPeriod(t.selectedPeriod), t._updateSelectorDateContainer(t.prefs.animation), t._firstShow && t.prefs.center && t.jElement.css("left", ($(window).width() - t.jElement.width()) / 2 + "px"), t._firstShow = !1, t.jFrom.val() && t.jTo.val() || (t.jShow[0].disabled = !0), t.jFrom.addClass(t._namespace + "from-selected"), t.prefs.touch || t.jFrom.focus(), $(document).trigger("show" + t._namespaceEvent)
                },
                t = this,
                i = t.positionElement.offset(),
                n = i.left;
            t._ignoreResize = !0, t._firstShow && t.jElement.css({
                left: n,
                top: i.top + t.positionElement.outerHeight()
            }), t.prefs.animation ? (t.jElement.css({
                opacity: 0,
                visibility: "hidden"
            }).show().css({
                visibility: "visible"
            }), e(), t.jElement.css({
                visibility: "visible"
            }), t._animationShow(t.jElement), t.prefs.shadow && (t.jShadow.css({
                opacity: 0
            }).show(), t.jShadow.stop().animate({
                opacity: t.prefs.opacityShadow
            }, t.prefs.speedAnimation))) : (t.jElement.show(), t.prefs.shadow && t.jShadow.show(), e())
        },
        close: function() {
            this.prefs.single || (this.selectedPeriod = this._oldSelectedPeriod), this.hide()
        },
        hide: function() {
            if (this.selectedPeriod && this.selectedPeriod.from && this.selectedPeriod.to && (this._fineSelectedPeriod(), this._setDraggerAtBeginDate()), this.selectedStep = 0, this.updateDate(), this.prefs.animation ? this._animationHide(this.jElement) : this.jElement.hide(), this.prefs.shadow)
                if (this.prefs.animation) {
                    var e = this;
                    this.jShadow.stop().animate({
                        opacity: "0"
                    }, {
                        duration: this.prefs.speedAnimation,
                        complete: function() {
                            e.jShadow.hide()
                        }
                    })
                } else this.jShadow.hide();
            this.selectedPeriod.from && this.selectedPeriod.to && (this.jFrom.val(this._dateToText(this.selectedPeriod.from)), this.jTo.val(this._dateToText(this.selectedPeriod.to))), $(document).trigger("hide" + this._namespaceEvent)
        },
        toggle: function() {
            this.jElement.is(":visible") ? this.hide() : this.show()
        },
        remove: function() {
            this.jElement.remove(), this.prefs.shadow && this.jShadow.remove(), this._removeEvents()
        },
        finePeriod: function(e, t, i) {
            function n(e, t, i, n) {
                return !(1 !== e || t !== c._daysPerMonth(i, n))
            }
            if (!e) return this.getString("selectionError");
            var o, s, r, a, l, c = this;
            return i = i || '<span class="super-calendar__selector-dash">&mdash;</span>', e = this._recalcDate(e), t = this._recalcDate(t), o = "", s = this.getString("months")[e.month], r = this.getString("months")[t.month], a = this.getString("monthsCase")[e.month], l = this.getString("monthsCase")[t.month], this._cmpDates(e, t) ? (o = e.year === t.year ? e.month === t.month ? n(e.day, t.day, e.month, e.year) ? [s.toLowerCase(), e.year] : [e.day + i + t.day, a, e.year] : [e.day, a + i + t.day, l, e.year] : [e.day, a, e.year + i + t.day, l, t.year], o.join(" ")) : [e.day, a, e.year].join(" ")
        },
        isMacOS: function() {
            var e = ("" + navigator.userAgent).toLowerCase();
            return -1 !== e.search("mac os x")
        },
        correctPeriodForMinMaxDate: function(e, t, i) {
            return e.from = this._recalcDate(e.from), e.to = this._recalcDate(e.to), t = this._recalcDate(this._prepareMinDate(t)), i = this._recalcDate(this._prepareMaxDate(i)), this._isCorrectDates(e.from, e.to, t, i) ? (e.from = this._correctMinDate(e.from, t), e.to = this._correctMaxDate(e.to, i), e) : !1
        }
    }, SuperCalendar.prototype.locale = {
        common: function(e) {
            var t;
            for (this._keysets = {
                    title: BEM.I18N("super-calendar", "title"),
                    selectWeek: BEM.I18N("super-calendar", "choose-week"),
                    now: BEM.I18N("super-calendar", "today"),
                    selectionError: BEM.I18N("super-calendar", "selection-error"),
                    submit: {
                        show: BEM.I18N("super-calendar", "submit-show"),
                        ok: BEM.I18N("super-calendar", "submit-ok"),
                        select: BEM.I18N("super-calendar", "submit-select")
                    },
                    collapse: BEM.I18N("super-calendar", "collapse"),
                    expand: BEM.I18N("super-calendar", "expand"),
                    close: BEM.I18N("super-calendar", "close"),
                    move: BEM.I18N("super-calendar", "move"),
                    months: [],
                    monthsCase: [],
                    firstLetterWeekDay: []
                }, t = 0; 7 > t; t++) this._keysets.firstLetterWeekDay[t] = BEM.I18N("i-tanker__days", "name", {
                "short": !0,
                day: t + 1
            }).toUpperCase();
            for (t = 0; 12 > t; t++) this._keysets.months[t] = BEM.I18N("i-tanker__months", "n" + (t + 1)), this._keysets.monthsCase[t] = BEM.I18N("i-tanker__months", "g" + (t + 1));
            return this.common = function(e) {
                return this._keysets[e] || e
            }, this.common(e)
        }
    },
    function(e) {
        function t(t) {
            var i = t || window.event,
                n = [].slice.call(arguments, 1),
                o = 0,
                s = 0,
                r = 0;
            return t = e.event.fix(i), t.type = "mousewheel", i.wheelDelta && (o = i.wheelDelta / 120), i.detail && (o = -i.detail / 3), r = o, void 0 !== i.axis && i.axis === i.HORIZONTAL_AXIS && (r = 0, s = -1 * o), void 0 !== i.wheelDeltaY && (r = i.wheelDeltaY / 120), void 0 !== i.wheelDeltaX && (s = -1 * i.wheelDeltaX / 120), n.unshift(t, o, s, r), (e.event.dispatch || e.event.handle).apply(this, n)
        }
        var i = ["DOMMouseScroll", "mousewheel"];
        if (e.event.fixHooks)
            for (var n = i.length; n;) e.event.fixHooks[i[--n]] = e.event.mouseHooks;
        e.event.special.mousewheel = {
            setup: function() {
                if (this.addEventListener)
                    for (var e = i.length; e;) this.addEventListener(i[--e], t, !1);
                else this.onmousewheel = t
            },
            teardown: function() {
                if (this.removeEventListener)
                    for (var e = i.length; e;) this.removeEventListener(i[--e], t, !1);
                else this.onmousewheel = null
            }
        }, e.fn.extend({
            mousewheel: function(e) {
                return e ? this.bind("mousewheel", e) : this.trigger("mousewheel")
            },
            unmousewheel: function(e) {
                return this.unbind("mousewheel", e)
            }
        })
    }(jQuery), BEM.JSON.decl({
        name: "error-message",
        modName: "type",
        modVal: "popup"
    }, {
        onElem: {
            body: function(e) {
                e.content({
                    block: "popup",
                    mix: [{
                        block: "error-message",
                        elem: "popup"
                    }],
                    js: {
                        directions: e.param("directions") || {
                            to: "bottom",
                            axis: "left"
                        }
                    },
                    content: [{
                        elem: "tail",
                        mix: {
                            block: "error-message",
                            elem: "popup-tail"
                        }
                    }, {
                        elem: "content",
                        mix: {
                            block: "error-message",
                            elem: "popup-content"
                        },
                        content: [{
                            block: "error-message",
                            elem: "message",
                            error: e.param("error"),
                            mods: e.mods()
                        }]
                    }, {
                        elem: "close",
                        mix: [{
                            block: "error-message",
                            elem: "popup-close"
                        }, {
                            block: "icon",
                            elem: "close",
                            mods: {
                                color: "white"
                            }
                        }]
                    }]
                })
            }
        }
    }), BEM.DOM.decl({
        block: "error-message",
        modName: "type",
        modVal: "popup"
    }, {
        _directions: ["bottom-left", "top-left", "bottom-right", "top-right"],
        _hide: function() {
            this._popup && this._popup.hide()
        },
        _show: function(e) {
            var t;
            return t = this._popup ? BN("i-content").html({
                block: "error-message",
                mods: this.getInitialMods(),
                elem: "message",
                error: e
            }).then(function(e) {
                this._popup.setContent(e)
            }.bind(this)) : BN("i-content").prepend(this.domElem, {
                block: "error-message",
                mods: this.getInitialMods(),
                elem: "body",
                error: e,
                directions: this.params.directions || this._directions
            }).then(function() {
                this._popup = this.findBlockInside("popup"), this._popup.on("show", this.trigger.bind(this, "show")), this._popup.on("hide", this.trigger.bind(this, "hide"))
            }.bind(this)), t.then(function() {
                return this._popup.show(this.domElem), this
            }.bind(this))
        }
    }), BEM.decl({
        name: "i-report-comparable",
        baseBlock: "i-report"
    }, {
        getReportPath: function() {
            return this.__base() + (this.isCompareMode() ? "/compare" : "")
        },
        getComparePath: function() {
            return "/" + this.getUrlGroup() + "/" + this.getUrlKey() + "/compare"
        },
        getSinglePath: function() {
            return "/" + this.getUrlGroup() + "/" + this.getUrlKey()
        },
        isCompareMode: function() {
            return this.params.isCompare
        },
        needRedraw: function() {
            var e = this.__self._parseUrl();
            return this.__base() || Boolean(e.params && e.params.isCompare) !== this.isCompareMode()
        },
        setCompareMode: function(e) {
            this.params.isCompare !== Boolean(e) && (this.params.isCompare = Boolean(e), this.trigger("change"))
        },
        getReportOptions: function() {
            return Vow.all([this.__base(), this.isCompareMode() && BN("i-default-data").getComparisonOptions()]).spread(function(e, t) {
                return t && (e.compareFilter = t.compareFilter, e.comparePeriod = t.comparePeriod, e.metricFilters = null), e
            })
        }
    }, {
        _exportFormats: ["xlsx", "csv"],
        _reports: [{
            id: "browsers",
            preset: "tech_browsers"
        }, {
            id: "hourly",
            defaultChartType: "bar-chart"
        }, {
            id: "resolution",
            preset: "tech_display"
        }, {
            id: "downloads",
            defaultDimensionMode: "list"
        }, {
            id: "search_engines",
            publicAccess: !1
        }, {
            id: "cookies",
            preset: "tech_cookies"
        }, {
            id: "deepness_depth",
            defaultChartType: "bar-chart"
        }, {
            id: "loyalty_recency",
            defaultChartType: "bar-chart"
        }, {
            id: "flash",
            preset: "tech_flash"
        }, "tags_from", {
            id: "exit",
            preset: "content_exit",
            defaultDimensionMode: "list"
        }, {
            id: "sources",
            preset: "sources_summary"
        }, {
            id: "silverlight",
            preset: "tech_silverlight"
        }, {
            id: "loyalty_newness",
            defaultChartType: "bar-chart"
        }, {
            id: "url_param",
            preset: "url_params"
        }, "titles", {
            id: "demography_age",
            preset: "age"
        }, {
            id: "loyalty_period",
            defaultChartType: "bar-chart"
        }, {
            id: "user_vars",
            preset: "content_visit_params"
        }, {
            id: "marketing",
            preset: "adv_engine"
        }, {
            id: "geo",
            preset: "geo_country",
            defaultChartType: "map"
        }, {
            id: "direct_summary",
            preset: "sources_direct_summary",
            publicAccess: !1
        }, {
            id: "loyalty_visits",
            defaultChartType: "bar-chart"
        }, {
            id: "java",
            preset: "tech_java"
        }, "tags_openstat", {
            id: "javascript",
            preset: "tech_java_script"
        }, {
            id: "direct_sites",
            preset: "sources_direct_platforms",
            publicAccess: !1
        }, {
            id: "sources_direct_clicks",
            onlySingleCounterMode: !0,
            publicAccess: !1
        }, {
            id: "interest",
            preset: "interests"
        }, "tech_devices", {
            id: "tags_utm",
            preset: "tags_u_t_m"
        }, {
            id: "entrance",
            preset: "content_entrance",
            defaultDimensionMode: "list"
        }, {
            id: "links",
            preset: "external_links",
            defaultDimensionMode: "list"
        }, {
            id: "sites",
            preset: "sources_sites",
            defaultDimensionMode: "list"
        }, {
            id: "phrases",
            preset: "sources_search_phrases",
            publicAccess: !1
        }, {
            id: "os",
            preset: "tech_platforms"
        }, {
            id: "popular",
            defaultDimensionMode: "list"
        }, {
            id: "traffic",
            chartMode: "bytime"
        }, {
            id: "deepness_time",
            defaultChartType: "bar-chart"
        }, {
            id: "demography_structure",
            preset: "gender"
        }, {
            id: "social_networks",
            preset: "sources_social"
        }, "share_services", {
            id: "bpage_load_time",
            preset: "site_speed",
            defaultChartType: "map"
        }, {
            id: "store_params",
            available: !1,
            publicAccess: !1
        }, {
            id: "new_report",
            available: !1
        }, {
            id: "favorites",
            available: !1
        }, {
            id: "recent_reports",
            available: !1
        }, {
            id: "load_on_site",
            onlySingleCounterMode: !0
        }, {
            id: "traffic_by_minute",
            preset: "minutely",
            chartMode: "minutely",
            reportParamsBlock: "i-report-params-minutely",
            disableGrouping: !0,
            disallowRowSelection: !0,
            disallowDimFilter: !0
        }, {
            id: "robots",
            onlySingleCounterMode: !0
        }, {
            id: "click_from_islands",
            available: !1
        }, {
            id: "search_queries",
            available: !1
        }, {
            id: "filter_contents",
            available: !1
        }, {
            id: "filters_interactions",
            available: !1
        }, {
            id: "new",
            templateReport: "sources",
            preset: "sources_summary",
            newReport: !0
        }, {
            id: "top_products"
        }, {
            id: "top_brands"
        }, {
            id: "basket"
        }, {
            id: "purchase"
        }, {
            id: "coupon"
        }, {
            id: "basket_products"
        }].map(function(e) {
            return e instanceof Object || (e = {
                id: e
            }), e.urlGroup = "stat", e.urlKey = e.id || e.preset, e.type = e.type || "default", e.preset = e.preset || e.id, e.reportParamsBlock = e.reportParamsBlock || "i-report-params-comparable", e.useAdditionalGrouping = !0, e
        })
    }).registerImplementation(), BEM.decl("i-report-comparable", {
        _packState: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return e.isCompare = this.isCompareMode(), e
            }.bind(this))
        }
    }), BEM.decl("i-report-params", {
        destruct: function() {
            this._customizations && this._customizations.destruct(), this.__base.apply(this, arguments)
        },
        buildUrlParams: function() {
            var e;
            return e = this._getReport().isUser() ? this._getInitials() : Vow.all([this._getDefaults(), this._getInitials()]).spread(function(e, t) {
                var i = this._maskDefaults(t, e);
                return this._maskDefaults(this._mergeReportParameters(e, t), i)
            }.bind(this)), e.then(function(e) {
                return this._stateToUrlParams(this._maskDefaults(this.getState(), e))
            }.bind(this))
        },
        getState: function() {
            return this.getParams()
        },
        getParams: function() {
            return jQuery.extend(!0, {}, this.params.params)
        },
        getCustomizations: function() {
            return this._customizations
        },
        fetch: function() {
            return this._getReport().isActive() ? Vow.all([this._getInitials(), this._getParamsFromUrl()]).spread(function(e, t) {
                return this.params.params = this._mergeReportParameters(e, t), this._createCustomizations(e, this.params.params), this
            }.bind(this)) : (this.params.params = jQuery.extend(!0, {}, this.params.initials), Vow.promise(this))
        },
        subscribeToDataBindings: function() {},
        _getInitials: function() {
            var e, t = this.params.initials;
            return e = t && Object.keys(t).length ? this._getReport().getMetadata().then(function(e) {
                var i = t["data-table"];
                return i.metric && -1 === e.getMetrics().indexOf(i.metric) && (i.metric = void 0), "tree" === i.dimensionMode && e.getDimensions().length <= 1 && (i.dimensionMode = "list"), i.sort && (i.sort = e.validateSortDirection(i.sort)), i.percentage && (i.percentage = e.validateMetricsList(i.percentage)), t
            }.bind(this)) : Vow.fulfill({}), this._getReport().isGoalRequired() && (e = Vow.all([this._getReport().getMetadata(), e]).spread(function(e, t) {
                return t.preset = t.preset || {}, t.preset.goal = e.getGoal(), t
            })), Vow.all([this._getDefaults(), e]).spread(function(e, t) {
                return this._mergeReportParameters(e, t)
            }.bind(this))
        },
        _createCustomizations: function(e, t) {
            this._customizations = BEM.create("i-customization", {
                reportParams: this,
                defaults: e,
                urlParams: jQuery.extend(!0, {}, t)
            })
        },
        _maskDefaults: function(e, t) {
            var i = {};
            return e ? (Object.keys(e).forEach(function(n) {
                jQuery.equals(e[n], t[n]) ? i[n] = null : i[n] = e[n]
            }, this), e["data-table"] && (i["data-table"] = this._maskDefaults(e["data-table"], t["data-table"])), i) : e
        },
        _getDefaults: function() {
            return this._buildDefaults().then(function(e) {
                return jQuery.extend(!0, {}, e)
            }.bind(this))
        },
        _mergeReportParameters: function() {
            var e = [].reduce.call(arguments, function(e, t) {
                var i = jQuery.extend({}, e, t);
                return i.preset = jQuery.extend({}, e.preset, t.preset), i["data-table"] = jQuery.extend({}, e["data-table"], t["data-table"]), i
            }, {});
            return jQuery.extend(!0, {}, e)
        },
        _getReport: function() {
            return this.params.report
        },
        _periodToUrl: function(e, t) {
            return e.period = BN("i-period").stringifyPeriod(t.period), e
        },
        _stateToUrlParams: function(e) {
            var t = BN("i-data-table"),
                i = BN("i-chart"),
                n = {},
                o = e["data-table"] || {};
            return e.preset && (n.goal = e.preset.goal), o && (n.metric = o.metric, n.percentage = t.stringifyPercentage(o.percentage), n.sort = t.stringifySortDirection(o.sort), n.rows_limit = t.stringifyRowsLimit(o.rowsLimit), n.dimension_mode = o.dimensionMode, o.rows && (n.selected_rows = t.stringifySelectedRows(o.rows.rows, o.rows.totals))), n = this._periodToUrl(n, e), e.chartType && (n.chart_type = i.serializeChartType(e.chartType)), n.group = e.group, Vow.fulfill(n)
        },
        _buildDefaults: function() {
            var e = this._getReport();
            return e.getMetadata().then(function(t) {
                var i = {
                        "data-table": {}
                    },
                    n = i["data-table"];
                return i.group = BN("i-period").getDefaultGrouping(), i.period = BN("i-period").getDefault(), i.chartType = e.getDefaultChartType(), n.rowsLimit = BN("i-data-table").DEFAULT_ROWS_LIMIT, n.dimensionMode = e.getDefaultDimensionMode(), (!n.dimensionMode || "tree" === n.dimensionMode && t.getDimensions().length <= 1) && (n.dimensionMode = t.getDimensions().length > 1 ? "tree" : "list"), n.percentage = [], n.sort = t.defaultSortDirection(), n.metric = t.getDefaultSelectedMetric(), i.preset = {
                    goal: null
                }, i
            })
        },
        _periodFromUrl: function(e) {
            return e.period = BN("i-period").getPeriod(), e
        },
        _getParamsFromUrl: function() {
            return this._getReport().getMetadata().then(function(e) {
                var t = BN("i-router").getParams(),
                    i = BN("i-data-table"),
                    n = {
                        "data-table": {},
                        preset: {}
                    };
                return n.preset.goal = e.getGoal(), n["data-table"].metric = i.getSelectedMetric(e), n["data-table"].percentage = i.parsePercentage(t.percentage), n["data-table"].sort = i.getSortDirection(e), n["data-table"].rowsLimit = i.parseRowsLimit(t.rows_limit), n["data-table"].dimensionMode = i.getDimensionMode(e), n["data-table"].rows = i.parseSelectedRows(t.selected_rows), n.chartType = BN("i-chart").getChartType(), n = this._periodFromUrl(n), n.group = BN("i-period").getGrouping(this._getReport()), n["data-table"] = Vow.all(n["data-table"]), Vow.all(n)
            }.bind(this))
        }
    }), BEM.decl("i-report-params", {
        isChanged: function() {
            return !jQuery.equals(this._packState(), this.getParams())
        },
        isReportChanged: function() {
            return !jQuery.equals(this._maskReportNonImportant(this.getParams()), this._maskReportNonImportant(this._packState()))
        },
        isReportSignificantlyChanged: function() {
            return !1
        },
        sync: function() {
            this.params.params = this._packState(), this.params.initials = jQuery.extend(!0, {}, this.params.params), this.getCustomizations().leaveCustomizations()
        },
        resetToInitials: function(e) {
            return this._getInitials().then(function(t) {
                return this._bulkSetToState(t, e)
            }.bind(this))
        },
        resetToDefaults: function() {
            return this.params.initials = {}, this._getReport().getMetadata().then(function(e) {
                return e.resetToDefaults(), this._getDefaults()
            }.bind(this)).then(this._bulkSetToState.bind(this))
        },
        getState: function() {
            return this._getReport().isActive() ? this._packState() : this.getParams()
        },
        setToState: function(e, t) {
            var i;
            if (this._getParamsDeclaration().some(function(t) {
                    return t.param === e ? (i = t.binding, !0) : void 0
                }), i) {
                if ("preset.goal" === i) return this._getReport().getMetadata().then(function(e) {
                    e.setGoal(t)
                });
                "chartType.url" === i ? BEM.dataBindVal("chartType", {
                    url: t,
                    actual: t
                }) : BEM.dataBindVal(i, t)
            }
            return Vow.fulfill()
        },
        _bulkSetToState: function(e, t) {
            return t = t || this._getParamsDeclaration().map(function(e) {
                return e.param
            }), e = jQuery.extend({}, e, {
                counter: this.params.params.counter
            }), Vow.all(t.map(function(t) {
                return this.setToState(t, this._getFromState(e, t))
            }, this)).then(this.sync.bind(this))
        },
        _packState: function() {
            var e = {};
            return this._getParamsDeclaration().forEach(function(t) {
                this._setToState(e, t.param, BEM.dataBindVal(t.binding))
            }, this), e
        },
        subscribeToDataBindings: function() {
            this._getReport().isActive() && this.bindToData(this._getBindingsDeclaration())
        },
        _getFromState: function(e, t) {
            return t.split(".").reduce(function(e, t) {
                return e && e[t] || null
            }, e)
        },
        _setToState: function(e, t, i) {
            var n = t.split("."),
                o = n.pop();
            n.forEach(function(t) {
                void 0 === e[t] && (e[t] = {}), e = e[t]
            }), e[o] = i
        },
        _maskReportNonImportant: function(e) {
            return jQuery.extend(!0, {}, e, {
                period: null,
                "data-table": {
                    rows: null,
                    rowsLimit: null
                }
            })
        },
        _getParamsDeclaration: function() {
            return [{
                binding: "preset.goal",
                param: "preset.goal"
            }, {
                binding: "data-table.metric",
                param: "data-table.metric"
            }, {
                binding: "data-table.percentage",
                param: "data-table.percentage"
            }, {
                binding: "data-table.sort",
                param: "data-table.sort"
            }, {
                binding: "data-table.rowsLimit",
                param: "data-table.rowsLimit"
            }, {
                binding: "data-table.dimensionMode",
                param: "data-table.dimensionMode"
            }, {
                binding: "data-table.selectedRows",
                param: "data-table.rows.rows"
            }, {
                binding: "data-table.totalsChecked",
                param: "data-table.rows.totals"
            }, {
                binding: "chartType.url",
                param: "chartType"
            }, {
                binding: "report.period",
                param: "period"
            }, {
                binding: "report.group",
                param: "group"
            }]
        },
        _getBindingsDeclaration: function() {
            return this._getParamsDeclaration().reduce(function(e, t) {
                return e[t.binding] = {
                    set: "_dataBindingsChange",
                    initAccessor: "params.params." + t.param
                }, e
            }, {})
        },
        _dataBindingsChange: function() {
            this.trigger("change")
        }
    }), BEM.decl("i-chart", null, {
        chartTypes: ["pie", "line-chart", "stacked-chart", "bar-chart", "map"],
        monitoringChartTypes: ["timeline", "errors"],
        defaultChartType: "line-chart",
        chartTypesStructure: function() {
            return {
                pie: {
                    name: BEM.I18N("i-chart", "pie"),
                    excludes: ["disallow-by-time", "not-normalisable", "dimensionless"]
                },
                "line-chart": {
                    name: BEM.I18N("i-chart", "line"),
                    excludes: ["disallow-by-time", "one-period"]
                },
                "stacked-chart": {
                    name: BEM.I18N("i-chart", "stack"),
                    excludes: ["disallow-by-time", "one-period", "compare-mode", "percent-metrics", "dimensionless"]
                },
                "bar-chart": {
                    name: BEM.I18N("i-chart", "multibar"),
                    excludes: ["dimensionless"]
                },
                map: {
                    name: BEM.I18N("i-chart", "map"),
                    excludes: ["compare-mode", "affinity", "custom-report"]
                }
            }
        },
        monitoringTypesStructure: function() {
            var e = {};
            return this.monitoringChartTypes.forEach(function(t) {
                e[t] = {
                    name: BEM.I18N("i-chart", t)
                }
            }), e
        },
        enabledChartTypes: function(e, t, i, n, o) {
            var s = t.some(function(e) {
                    return e.allow_by_time === !1 || e.disallow_by_time
                }),
                r = [s && "disallow-by-time", i && t.length > 0 && "one-period", n && "compare-mode", !e.allow_normalisation && "not-normalisable", "percents" === e.type && "percent-metrics", 0 === t.length && "dimensionless", "affinity" === e.type && "affinity", !o && "custom-report"],
                a = this.chartTypesStructure();
            return this.chartTypes.filter(function(e) {
                return !BN("i-util").arrayIntersect(a[e].excludes, r).length
            })
        },
        serializeChartType: function(e) {
            return e
        },
        getChartType: function() {
            var e = BN("i-router").getParams();
            return this._parseValidateChartType(e.chart_type, this.chartTypes)
        },
        getMonitoringChartType: function() {
            var e = BN("i-router").getParams();
            return this._parseValidateChartType(e.chart_type, this.monitoringChartTypes)
        },
        getDefaultChartType: function() {
            return this.defaultChartType
        },
        _parseValidateChartType: function(e, t) {
            return e = e && e.toLowerCase(), -1 !== t.indexOf(e) ? e : void 0
        }
    }), BN.addDecl("i-data-table").staticProp({
        _metricHeaderRules: [{
            id: "currency",
            callback: function(e) {
                return e.contains_direct_expenses
            }
        }],
        NO_SELECTABLE_ROWS: "NO_SELECTABLE_ROWS",
        DEFAULT_ROWS_LIMIT: 50,
        ADDITIONAL_FIELDS: ["direct_id", "owner"],
        parsePercentage: function(e) {
            return (e = e || "") ? e.split(",") : void 0
        },
        stringifyPercentage: function(e) {
            return e ? e.join(",") : null
        },
        parseSortDirection: function(e) {
            return e ? "-" === e[0] ? (e = e.slice(1), {
                metrics: e,
                direction: "cba"
            }) : {
                metrics: e,
                direction: "abc"
            } : void 0
        },
        getSortDirection: function(e) {
            var t = e ? Vow.fulfill(e) : BN("i-report").getMetadata();
            return t.then(function(e) {
                var t = BN("i-router").getParams().sort;
                return t = this.parseSortDirection(t), e.validateSortDirection(t, !1)
            }.bind(this))
        },
        stringifySortDirection: function(e) {
            return e && ("cba" === e.direction ? "-" : "") + e.metrics
        },
        getMetricFilters: function(e) {
            var t = e ? Vow.fulfill(e) : BN("i-report").getMetadata();
            return t.then(function(e) {
                var t = this._parseMetricFilters(BN("i-router").getParams().metric_filters);
                return e.validateMetricFilter(t)
            }.bind(this))
        },
        stringifyMetricFilters: function(e) {
            return e && Object.keys(e).length ? JSON.stringify(e) : null
        },
        stringifyRowsLimit: function(e) {
            return e && String(e)
        },
        parseRowsLimit: function(e) {
            return Number(e) || this.DEFAULT_ROWS_LIMIT
        },
        stringifySelectedRows: function(e, t) {
            return e = e || [], e === this.NO_SELECTABLE_ROWS && (e = ""), e = (e || []).slice(0), t && e.push("totals"), e.length ? BN("i-util").encodeQuotes(e.join(",")) : null
        },
        parseSelectedRows: function(e) {
            var t;
            try {
                e = e && BN("i-util").decodeQuotes(e).split(",") || []
            } catch (i) {
                e = []
            }
            return t = e.indexOf("totals"), -1 !== t && e.splice(t), {
                rows: e,
                totals: -1 !== t
            }
        },
        getSelectedMetric: function(e) {
            var t = e ? Vow.fulfill(e) : BN("i-report").getMetadata();
            return t.then(function(e) {
                var t = BN("i-router").getParams().metric,
                    i = e.getMetrics().some(function(e) {
                        return t === e
                    });
                return i ? t : void 0
            })
        },
        getDimensionMode: function(e) {
            var t = BN("i-router").getParams().dimension_mode || "";
            return t = t.trim().toLowerCase(), -1 === ["list", "tree"].indexOf(t) || "tree" === t && e.getDimensions().length <= 1 ? void 0 : t
        },
        getAdditionalFields: function(e) {
            return this.ADDITIONAL_FIELDS.filter(function(t) {
                return e.hasOwnProperty(t)
            })
        },
        getDimensionFilterFromUrl: function(e) {
            var t = e ? Vow.fulfill(e) : BN("i-report").getMetadata();
            return t.then(function(e) {
                var t = BN("i-router").getParams().dimension_filter;
                if (BN("i-filter").buildDimensionFilter(t || "", e)) return t
            })
        },
        stringifyDimensionFilter: function(e) {
            return e = String(e || "").trim(), e ? e : null
        },
        getDataMarking: function(e, t, i) {
            var n, o, s = [],
                r = t.meta;
            return o = r.dimensions.length && r.dimensions.some(function(e) {
                return e.allow_by_time === !1 || e.disallow_by_time
            }), n = r.dimensions.map(function(t) {
                var n = t.fields,
                    o = n && n.name || t,
                    s = {},
                    r = this.getAdditionalFields(n);
                return r.forEach(function(t) {
                    s[t] = BN("formatter").findFormatters(e, {
                        dim: n[t].dim,
                        dataType: n[t].type
                    })
                }), s.name = BN("formatter").findFormatters(e, {
                    type: "dimension",
                    "dimension-item": !0,
                    dim: o.dim,
                    dataType: o.type,
                    group: i.group,
                    compare: i.compare || !1
                }), s
            }.bind(this)), s.push({
                type: "dimension",
                rowType: "content",
                mode: i.mode,
                disallowByTime: o,
                dimensions: r.dimensions,
                dimensionless: 0 === r.dimensions.length,
                dim: r.dimensions.length && r.dimensions[0].dim,
                dataType: r.dimensions.length && r.dimensions[0].type,
                formatters: n
            }), this._isCompareTable(t.totals) ? r.metrics.forEach(function(e) {
                s = s.concat([{
                    rowType: "content",
                    type: "metric-left",
                    dataType: e.type,
                    allowNormalization: e.allow_normalisation,
                    dim: e.dim
                }, {
                    rowType: "content",
                    type: "metric-center",
                    allowNormalization: e.allow_normalisation,
                    dim: e.dim,
                    negative: e.negative
                }, {
                    rowType: "content",
                    type: "metric-right",
                    dataType: e.type,
                    allowNormalization: e.allow_normalisation,
                    dim: e.dim
                }])
            }) : s = s.concat(r.metrics.map(function(e) {
                return {
                    dim: e.dim,
                    type: "metric",
                    rowType: "content",
                    dataType: e.type,
                    allowNormalization: e.allow_normalisation,
                    mode: i.mode
                }
            })), s
        },
        getDataFormatters: function(e, t, i) {
            return this.getDataMarking(e, t, i).map(function(t) {
                return BN("formatter").findFormatters(e, t)
            })
        },
        getDataColumns: function(e, t) {
            var i = [],
                n = this;
            return i.push({
                dimensions: e.dimensions,
                dimension: e.dimension,
                raw: e.dimension || e.dimensions && e.dimensions[e.level] || {},
                value: e.dimension && e.dimension.name,
                originValue: e.dimension && e.dimension.name,
                id: e.dimension && e.dimension.id,
                level: t.level,
                rowId: t.rowId,
                color: t.color,
                disabled: t.disabled
            }), this._isCompareTable(t.totals) ? e.metrics.a.forEach(function(o, s) {
                var r = n._compareValues(e.metrics.b[s], e.metrics.a[s]),
                    a = n._compareValues(e.metrics.b[s] / t.totals.b[s], e.metrics.a[s] / t.totals.a[s]);
                i = i.concat([{
                    value: e.metrics.a[s],
                    originValue: e.metrics.a[s],
                    total: t.totals.a[s]
                }, {
                    value: r,
                    originValue: r,
                    relativeValue: a
                }, {
                    value: e.metrics.b[s],
                    originValue: e.metrics.b[s],
                    total: t.totals.b[s]
                }])
            }) : i = i.concat(e.metrics.map(function(e, i) {
                return {
                    value: e,
                    originValue: e,
                    max: t.max && t.max[i] || 0,
                    total: t.totals[i]
                }
            })), i
        },
        getHeaderColumns: function(e, t) {
            var i = {
                    header: [],
                    controls: []
                },
                n = e.dimensions.length && e.dimensions.every(function(e) {
                    return e.allow_sort
                }),
                o = "";
            return e.dimensions.length && (o = e.dimensions[0].group_name || e.dimensions.map(function(e) {
                return e.name
            }).join(", ")), i.header.push({
                rowType: "header",
                index: 0,
                sortBy: e.dimensions.length ? e.dimensions[0].dim : void 0,
                sortable: n,
                type: "dimension",
                sort: t.sort,
                dimensionMode: t.dimensionMode,
                value: o,
                selectable: e.dimensions.length > 0 && t.selectable,
                filtrable: t.filtrable
            }), [].push.apply(i.header, e.metrics.map(function(i, n) {
                var o = {
                    rowType: "header",
                    sortBy: i.dim,
                    sortable: e.dimensions.length > 0 && i.allow_sort,
                    index: n + 1,
                    type: "metric",
                    sort: t.sort,
                    value: i.name,
                    selected: i.dim === t.selectedMetric || !t.selectedMetric && 0 === n,
                    hint: i.description
                };
                return this._metricHeaderRules.forEach(function(e) {
                    e.callback(i) && (o[e.id] = !0)
                }), o
            }, this)), i.controls.push({
                rowType: "controls",
                type: "dimension",
                sort: t.sort,
                index: 0,
                dimensionMode: t.dimensionMode,
                sortBy: e.dimensions.length ? e.dimensions[0].dim : void 0,
                sortable: n,
                dimensionFilter: t.dimensionFilter,
                allowDimFilter: t.filtrable && e.dimensions.length && e.dimensions.every(function(e) {
                    return e.allow_filters || e.fields && e.fields.name && e.fields.name.allow_filters
                }),
                hasChart: Boolean(t.hasChart)
            }), [].push.apply(i.controls, e.metrics.map(function(i, n) {
                return {
                    rowType: "controls",
                    type: "metric",
                    sortBy: i.dim,
                    sortable: e.dimensions.length > 0 && i.allow_sort,
                    sort: t.sort,
                    metric: i,
                    index: n + 1,
                    allowFilters: e.dimensions.length > 0 && i.allow_filters,
                    allowNormalization: e.dimensions.length > 0 && i.allow_normalisation,
                    normalized: -1 === t.percentagesMetrics.indexOf(i.dim),
                    selected: i.dim === t.selectedMetric || !t.selectedMetric && 0 === n,
                    metricFilters: t.metricFilters,
                    hasChart: Boolean(t.hasChart)
                }
            })), i
        },
        getTotalColumns: function(e, t) {
            var i = [],
                n = e.meta,
                o = e.totals,
                s = this;
            return n.dimensions.length ? (i.push({
                rowType: "total",
                dataType: "total-title",
                checked: t
            }), this._isCompareTable(e.totals) ? n.metrics.forEach(function(e, t) {
                var n = s._compareValues(o.b[t], o.a[t]);
                i = i.concat([{
                    rowType: "total",
                    dim: e.dim,
                    type: "metric-left",
                    value: o.a[t],
                    originValue: o.a[t],
                    dataType: e.type
                }, {
                    rowType: "total",
                    dim: e.dim,
                    type: "metric-center",
                    value: n,
                    originValue: n,
                    negative: e.negative
                }, {
                    rowType: "total",
                    dim: e.dim,
                    type: "metric-right",
                    value: o.b[t],
                    originValue: o.b[t],
                    dataType: e.type
                }])
            }) : i = i.concat(n.metrics.map(function(e, t) {
                return {
                    dim: e.dim,
                    type: "metric",
                    rowType: "total",
                    dataType: e.type,
                    value: o[t],
                    originValue: o[t]
                }
            })), i) : []
        },
        _parseMetricFilters: function(e) {
            if (e) try {
                return e = JSON.parse(e), e || void 0
            } catch (t) {
                return
            }
        },
        _compareValues: function(e, t) {
            var i;
            return t === e ? 1 : (i = e > t ? 1 : -1, t && e ? i * (Math.max(t, e) / Math.min(t, e)) : i * (1 / 0))
        },
        _isCompareTable: function(e) {
            return !Array.isArray(e)
        }
    }), BEM.decl("formatter", null, {
        register: {},
        formatters: function(e) {
            var t = this;
            return void 0 === this.register[e] && (this.register[e] = []), {
                add: function(i, n) {
                    return t.register[e].push({
                        conditions: i,
                        preprocessor: n
                    }), this
                }
            }
        },
        run: function(e, t) {
            return this.runFormatters(this.findFormatters(e, t), t)
        },
        runFormatters: function(e, t) {
            var i;
            for (t.column = e.column, i = 0; i < e.fns.length && e.fns[i].preprocessor.call(this, t) !== !1; i++);
            return t.value
        },
        findFormatters: function(e, t) {
            var i = [],
                n = this;
            return ["common"].concat(e).forEach(function(e) {
                [].push.apply(i, n.register[e].filter(function(e) {
                    return n._match(e.conditions, t)
                }))
            }), {
                column: t,
                fns: i
            }
        },
        _match: function(e, t) {
            var i = t;
            return Object.keys(e).every(function(t) {
                return Array.isArray(e[t]) ? -1 !== e[t].indexOf(i[t]) : e[t] === i[t]
            })
        }
    }), BEM.decl("i-customization", {
        MAPPING: {
            filter: "filter",
            compareFilter: "filter",
            attribution: "attribution",
            "preset.goal": "goal"
        },
        _state: BN("i-state").initNs("i-customizations"),
        onSetMod: {
            js: function() {
                this._prevParametersValue = this.params.urlParams, this._diff = BN("i-util").arrayDiff(this._treeDiff(this.params.defaults, this._prevParametersValue), this._getMask()), this.params.reportParams.on("change", this._onReportParamsChange, this)
            }
        },
        destruct: function() {
            this.params.reportParams.un("change", this._onReportParamsChange, this), this.__base.apply(this, arguments)
        },
        getCustomizations: function() {
            return this._diff
        },
        resetCustomizations: function(e) {
            var t;
            t = void 0 === e ? Object.keys(this.MAPPING) : Object.keys(this.MAPPING).reduce(function(t, i) {
                return this.MAPPING[i] === e && t.push(i), t
            }.bind(this), []), this.params.reportParams.resetToInitials(t).done()
        },
        leaveCustomizations: function() {
            this._setUserMask(BN("i-util").arrayUnique(this._getUserMask().concat(this._diff))), this._diff = [], this.trigger("change")
        },
        _isFirstLoad: function() {
            var e;
            return this._state.get("isLoaded") ? e = !1 : (this._state.set("isLoaded", !0), e = !0), this._isFirstLoad = function() {
                return e
            }, e
        },
        _getMask: function() {
            return this._mask || (this._isFirstLoad() ? this._mask = BN("i-util").arrayUnique(Object.keys(this.MAPPING).map(function(e) {
                return this.MAPPING[e]
            }, this)) : this._mask = this._getUserMask()), this._mask
        },
        _setMask: function(e) {
            this._mask = e
        },
        _getUserMask: function() {
            return this._state.get("crossReportMask") || []
        },
        _setUserMask: function(e) {
            this._state.set("crossReportMask", e)
        },
        _getByPath: function(e, t) {
            return t.split(".").reduce(function(e, t) {
                return void 0 !== e ? e[t] : void 0
            }, e)
        },
        _treeDiff: function(e, t) {
            var i = Object.keys(this.MAPPING).filter(function(i) {
                return !jQuery.equals(this._getByPath(e, i), this._getByPath(t, i))
            }, this).map(function(e) {
                return this.MAPPING[e]
            }, this).filter(Boolean);
            return BN("i-util").arrayUnique(i)
        },
        _onReportParamsChange: function() {
            var e = this.params.reportParams.getState(),
                t = this._treeDiff(e, this._prevParametersValue),
                i = this._getUserMask(),
                n = BN("i-util");
            this._prevParametersValue = e, this._setMask(n.arrayUnique(i.concat(this._getMask()).concat(t))), this._setUserMask(n.arrayDiff(i, t)), t = n.arrayDiff(this._diff, this._getMask()), jQuery.equals(t, this._diff) || (this._diff = t, this.trigger("change"))
        }
    }), BEM.decl("i-dimension-chooser", {}, {
        getDimensionsForCompactLabel: function(e, t) {
            var i = this._collectDimensionsIntoGroups(e);
            return t = t || [], i.reduce(function(i, n) {
                var o = this._getDimensionsGroupLabel(n, t, e),
                    s = t[o],
                    r = i.length > 0 ? t[i[i.length - 1]] : void 0;
                return s = s && s.name, r = r && r.name, (void 0 === r || null !== r || null !== s) && i.push(o), i
            }.bind(this), []).map(function(t) {
                return e[t].dim
            })
        },
        _getDimensionsGroupLabel: function(e, t, i) {
            return e.reduce(function(e, n) {
                var o = i[n],
                    s = t[n],
                    r = i[e],
                    a = t[e];
                return s = s && s.name, a = a && a.name, null === a || null !== s && (o.level > r.level || "url" === o.type && "url-part" === r.type) ? n : e
            }, e[0])
        },
        _collectDimensionsIntoGroups: function(e) {
            var t, i = [];
            return e.forEach(function(e, n) {
                !t || t.urlDim !== e.url_dim && t.urlDim !== e.dim ? (t && (i.push(t.parts), t = void 0), t = {
                    urlDim: e.url_dim || e.dim,
                    parts: [n]
                }) : t.parts.push(n)
            }), t && i.push(t.parts), i
        }
    }), BEM.decl({
        block: "i-report-params-comparable",
        baseBlock: "i-report-params"
    }, {
        getParams: function() {
            var e = jQuery.extend(!0, {}, this.__base());
            return this._getReport().isCompareMode() ? delete e.metricFilters : (delete e.compareFilter, delete e.comparePeriod), e
        },
        _filterToUrl: function(e, t, i) {
            var n = BN("i-filter");
            return t.filter && (e.filter = n.stringifyFilter(t.filter, i)), t.filterId && (e.filter_id = t.filterId), this._getReport().isCompareMode() && (t.compareFilterId && (e.secondary_filter_id = t.compareFilterId), t.compareFilter && (e.secondary_filter = n.stringifyFilter(t.compareFilter, i))), e
        },
        _periodToUrl: function(e, t) {
            return e = this.__base.apply(this, arguments), this._getReport().isCompareMode() && (t.comparePeriod && (e.secondary_period = BN("i-period").stringifyPeriod(t.comparePeriod)), t.compareWith && (e.compareWith = t.compareWith)), e
        },
        _stateToUrlParams: function(e) {
            return Vow.all([this.__base(e), this._getReport().getMetadata()]).spread(function(t, i) {
                var n = BN("i-data-table"),
                    o = BN("i-attribution"),
                    s = e["data-table"] || {};
                return t.metrics = i.serializeMetrics(), t.dimensions = i.serializeDimensions(), t.dimension_filter = n.stringifyDimensionFilter(s.dimensionFilter), t = this._filterToUrl(t, e, i), t = this._periodToUrl(t, e), t.region = BN("ymaps").serializeRegion(e.region), this._getReport().isCompareMode() || (t.metric_filters = n.stringifyMetricFilters(s.metricFilters)), t.attribution = o.serialize(e.attribution), t.accuracy = e.accuracy, t.currency = e.currency, t.direct_client_ids = e.direct_client_ids, t
            }.bind(this))
        },
        _getSecondaryPeriodDefault: function(e) {
            return this._getReport().isCompareMode() ? "previous" === this.getState().compareWith ? BN("i-period").prevPeriod(e) : e : void 0
        },
        _buildDefaults: function() {
            return Vow.all([this.__base.apply(this, arguments), this._getReport().getMetadata()]).spread(function(e, t) {
                return e.preset = e.preset || {}, e.preset.metrics = t.getDefaultMetrics(), e.preset.dimensions = t.getDefaultDimensions(), t.hasDirectClientParam() && (e.preset.direct_client_ids = this._getDirectClientIds(e.period, e.comparePeriod)), t.hasCurrencyAttr() && (e.currency = BN("i-report-currency").DEFAULT_CURRENCY), e.preset = Vow.all(e.preset), e.quantile = BN("i-quantile").DEFAULT_QUANTILE, e.attribution = BN("i-attribution").getDefaultAttribution(), e.filter = {}, e.accuracy = BN("m-accuracy").getDefaultSampling(), e["data-table"] = e["data-table"] || {}, e["data-table"].dimensionFilter = null, this._getReport().isCompareMode() && (e.comparePeriod = this._getSecondaryPeriodDefault(e.period), e.compareFilter = {}), e.region = BN("ymaps").getRegion(), Vow.all(e)
            }.bind(this))
        },
        _getCurrency: function(e, t) {
            var i;
            return i = BN("i-period").combinePeriods(e, t), BN("i-report-currency").get(i, this._getReport())
        },
        _getDirectClientIds: function(e, t, i) {
            return BN("i-management-api").getDirectClients(BN("i-period").combinePeriods(e, t)).then(function(e) {
                var t;
                return e && e.length ? i && (t = BN("i-router").getParams().direct_client_ids, e.some(function(e) {
                    return String(e.id) === t
                })) ? t : String(e[0].id) : void 0
            })
        },
        _filterFromUrl: function(e, t) {
            return e.filter = BN("i-filter").getFilterFromUrl(t), e.filterId = BN("i-segments").getSegment(t), this._getReport().isCompareMode() && (e.compareFilter = BN("i-filter").getSecondaryFilterFromUrl(t), e.compareFilterId = BN("i-segments").getSecondarySegment(t)), e
        },
        _periodFromUrl: function(e) {
            var t;
            return e = this.__base.apply(this, arguments), this._getReport().isCompareMode() && (e.compareWith = this._getCompareWithParameterFromUrl(), t = {
                previous: "sequential"
            }[e.compareWith] || "paralel", e.comparePeriod = BN("i-period").getSecondaryPeriod(t)), e
        },
        _getParamsFromUrl: function() {
            return Vow.all([this.__base(), this._getReport().getMetadata()]).spread(function(e, t) {
                return e.preset = e.preset || {}, e["data-table"] = e["data-table"] || {}, e.preset.metrics = t.getMetrics(), e.preset.dimensions = t.getDimensions(), e["data-table"].dimensionFilter = BN("i-data-table").getDimensionFilterFromUrl(t), e = this._filterFromUrl(e, t), e = this._periodFromUrl(e), this._getReport().isCompareMode() || (e["data-table"].metricFilters = BN("i-data-table").getMetricFilters(t)), e.quantile = BN("i-quantile").get(), e.attribution = BN("i-attribution").getAttribution(t), e.accuracy = BN("m-accuracy").getInstance().get("share"), t.hasCurrencyAttr() && (e.currency = this._getCurrency(e.period, e.comparePeriod)), t.hasDirectClientParam() && (e.direct_client_ids = this._getDirectClientIds(e.period, e.comparePeriod, !0)), e.region = BN("ymaps").getRegionFromUrl(), e["data-table"] = Vow.all(e["data-table"]), Vow.all(e)
            }.bind(this)).then(function(e) {
                return e.filterId = e.filterId && e.filterId.id, e.compareFilterId = e.compareFilterId && e.compareFilterId.id, e
            })
        },
        _getCompareWithParameterFromUrl: function() {
            var e = BN("i-router").getParams(),
                t = String(e.compareWith || "").trim().toLowerCase();
            return t && -1 !== ["previous", "custom"].indexOf(t) ? t : null
        }
    }), BEM.decl("i-report-params-comparable", {
        isSignificantlyChanged: function() {
            return !jQuery.equals(this._packState().preset.dimensions, this.getParams().preset.dimensions)
        },
        _maskReportNonImportant: function(e) {
            return jQuery.extend(!0, {}, e, {
                period: null,
                comparePeriod: null,
                filterId: null,
                accuracy: null,
                compareFilterId: null,
                "data-table": {
                    rows: null,
                    rowsLimit: null,
                    metricFilters: this._getReport().isCompareMode() ? null : void 0,
                    dimensionFilter: null
                },
                compareWith: null
            })
        },
        setToState: function(e, t) {
            var i;
            return this._getParamsDeclaration().some(function(t) {
                return t.param === e ? (i = t.binding, !0) : void 0
            }), i ? "preset.metrics" === i || "preset.dimensions" === i ? this._getReport().getMetadata().then(function(e) {
                "preset.metrics" === i ? e.setMetrics(t) : e.setDimensions(t)
            }) : this.__base.apply(this, arguments) : Vow.fulfill()
        },
        _packState: function() {
            var e = {},
                t = this._getReport().isCompareMode();
            return this._getParamsDeclaration().forEach(function(i) {
                (void 0 === i.compare || i.compare === t) && this._setToState(e, i.param, BEM.dataBindVal(i.binding))
            }, this), e
        },
        _getParamsDeclaration: function() {
            return this.__base().concat([{
                binding: "preset.metrics",
                param: "preset.metrics"
            }, {
                binding: "preset.dimensions",
                param: "preset.dimensions"
            }, {
                binding: "report.filter",
                param: "filter",
                compare: !1
            }, {
                binding: "report.segment.id",
                param: "filterId",
                compare: !1
            }, {
                binding: "report.region",
                param: "region",
                compare: !1
            }, {
                binding: "segments.primary.filter",
                param: "filter",
                compare: !0
            }, {
                binding: "segments.secondary.filter",
                param: "compareFilter",
                compare: !0
            }, {
                binding: "segments.primary.segment.id",
                param: "filterId",
                compare: !0
            }, {
                binding: "segments.secondary.segment.id",
                param: "compareFilterId",
                compare: !0
            }, {
                binding: "data-table.metricFilters",
                param: "data-table.metricFilters",
                compare: !1
            }, {
                binding: "data-table.dimensionFilter",
                param: "data-table.dimensionFilter"
            }, {
                binding: "quantile",
                param: "quantile"
            }, {
                binding: "attribution",
                param: "attribution"
            }, {
                binding: "preset.currency",
                param: "currency"
            }, {
                binding: "preset.direct_client_ids",
                param: "preset.direct_client_ids"
            }, {
                binding: "segments.primary.period",
                param: "period",
                compare: !0
            }, {
                binding: "segments.secondary.period",
                param: "comparePeriod",
                compare: !0
            }, {
                binding: "segments.group",
                param: "group",
                compare: !0
            }, {
                binding: "compareWith",
                param: "compareWith",
                compare: !0
            }, {
                binding: "sampling.accuracy",
                param: "accuracy"
            }])
        }
    }), BEM.decl("ymaps", null, {
        _regionsObj: null,
        _knownRegions: null,
        DEFAULT_REGION: "001",
        REGIONS: [{
            region: {
                isoName: "001",
                id: ""
            },
            settings: {
                state: {
                    center: [43, 72],
                    zoom: 1
                },
                options: {
                    minZoom: 1,
                    maxZoom: 5
                }
            }
        }, {
            region: {
                isoName: "ru",
                id: "225"
            },
            settings: {
                state: {
                    center: [61.7, 99.5],
                    zoom: 3
                },
                options: {
                    minZoom: 2,
                    maxZoom: 5
                }
            },
            combine: [{
                what: "RU-MOS",
                "with": ["RU-MOW"]
            }, {
                what: "RU-LEN",
                "with": ["RU-SPE"]
            }, {
                what: "UA-43",
                "with": ["UA-40"]
            }]
        }, {
            region: {
                isoName: "ua",
                id: "187"
            },
            settings: {
                state: {
                    center: [48.5, 31.7],
                    zoom: 5
                },
                options: {
                    minZoom: 5,
                    maxZoom: 8
                }
            },
            combine: [{
                what: "UA-32",
                "with": ["UA-30"]
            }, {
                what: "UA-43"
            }]
        }, {
            region: {
                isoName: "by",
                id: "149"
            },
            settings: {
                state: {
                    center: [53.7, 28],
                    zoom: 6
                },
                options: {
                    minZoom: 6,
                    maxZoom: 9
                }
            },
            combine: [{
                what: "BY-MI"
            }]
        }, {
            region: {
                isoName: "tr",
                id: "983"
            },
            settings: {
                state: {
                    center: [39.3, 35.4],
                    zoom: 6
                },
                options: {
                    minZoom: 6,
                    maxZoom: 9
                }
            }
        }],
        getRegion: function(e) {
            var t = this.parseValidateRegionName(e);
            return this._getRegionsObject()[t].region
        },
        getRegionSettings: function(e) {
            var t = this.parseValidateRegionName(e);
            return this._getRegionsObject()[t].settings
        },
        getRegionRecombine: function(e) {
            var t = this.parseValidateRegionName(e);
            return this._getRegionsObject()[t].combine
        },
        parseValidateRegionName: function(e) {
            return this.validateRegionName(e) || this.DEFAULT_REGION
        },
        validateRegionName: function(e) {
            return e = e && String(e).toLowerCase(), -1 !== this.getKnownRegions().indexOf(e) ? e : void 0
        },
        getKnownRegions: function() {
            return this._knownRegions || (this._knownRegions = this.REGIONS.map(function(e) {
                return e.region.isoName
            })), this._knownRegions
        },
        getRegionFromUrl: function() {
            var e = BN("i-router").getParams(),
                t = this.validateRegionName(e.region);
            return t ? this.getRegion(t) : void 0
        },
        serializeRegion: function(e) {
            return e && e.isoName
        },
        _getRegionsObject: function() {
            return this._regionsObj || (this._regionsObj = this.REGIONS.reduce(function(e, t) {
                return e[t.region.isoName] = t, e
            }, {})), this._regionsObj
        }
    }), BEM.decl("ymaps", null, {
        getMapPromise: function() {
            return ymaps.ready()
        },
        getNewMap: function(e, t) {
            return this.getMapPromise().then(function(i) {
                i.modules.require("map.copyrights.counter").spread(function(e) {
                    e.create("yandex", "")
                });
                var n = new i.Map(e, jQuery.extend({
                    type: null,
                    controls: [],
                    behaviors: ["drag", "multiTouch", "dblClickZoom"]
                }, t.state || {}), jQuery.extend({
                    copyrightLogoVisible: !1,
                    backgroundVisible: !1,
                    geoObjectPixelRendering: "static",
                    autoFitToViewport: "always",
                    avoidFractionalZoom: !1
                }, t.options || {}));
                return n.controls.add("zoomControl", {
                    position: {
                        top: 10,
                        right: 20
                    }
                }), Vow.fulfill(n)
            })
        },
        loadRegions: function(e) {
            var t = this;
            return this.getMapPromise().then(function(i) {
                var n = {
                    quality: 2,
                    disputedBorders: t.getDisputedBordersId(e)
                };
                return i.regions.load(e.toUpperCase(), n)
            })
        },
        getDisputedBordersId: function(e) {
            var t = BN("i-router").getTld();
            return -1 !== ["ru", "by", "kz"].indexOf(t) ? "RU" : e === this.DEFAULT_REGION ? "UN" : "UA"
        },
        recombine: function(e, t) {
            var i, n = this.getRegionRecombine(e) || [];
            n.length && (i = ymaps.geoQuery(t), n.forEach(function(e) {
                var n, o = i.search(this._getSearchCondition(e.what)),
                    s = [];
                o.getLength() && (s = s.concat(o.get(0).geometry.getCoordinates())), (e["with"] || []).forEach(function(e) {
                    var t = i.search(this._getSearchCondition(e));
                    t.getLength() && (s = s.concat(t.get(0).geometry.getCoordinates()))
                }, this), n = new ymaps.Polygon(s), n.properties.set("properties", {
                    iso3166: e.what
                }), t.add(n)
            }, this))
        },
        clonePolygon: function(e, t, i) {
            var n = this._cloneGeometry(e.geometry);
            return new ymaps.Polygon(n, t || {}, i || {})
        },
        _cloneGeometry: function(e) {
            return e.constructor.fromEncodedCoordinates(e.constructor.toEncodedCoordinates(e))
        },
        _getSearchCondition: function(e) {
            return 'properties.properties.iso3166 == "' + e + '"'
        }
    }), BN.addDecl("i-quantile").staticProp({
        DEFAULT_QUANTILE: "50",
        QUANTILE_LIST: ["50", "75", "90", "95", "99"],
        get: function() {
            var e = BN("i-router").getParams();
            return this.sanitize(e.quantile)
        },
        getList: function() {
            return this.QUANTILE_LIST
        },
        hasAnyMetricQuantileParam: function(e) {
            return e.length ? e.some(function(e) {
                return void 0 !== e.parameters && e.parameters.length ? e.parameters.some(function(e) {
                    return e.id && "quantile" === e.id
                }) : !1
            }) : !1
        },
        sanitize: function(e) {
            return e = e && String(e).trim(), -1 !== this.QUANTILE_LIST.indexOf(e) ? e : void 0
        }
    }), BN.addDecl("i-segments").staticProp({
        getSegment: function(e) {
            return this.getSegmentById(BN("i-router").getParams().filter_id, e)
        },
        getSecondarySegment: function(e) {
            return this.getSegmentById(BN("i-router").getParams().secondary_filter_id, e)
        },
        getSegmentById: function(e, t) {
            return e = String(e || "").toLowerCase().trim(), e ? BN("i-predefined-segments").getSegmentById(e).always(function(i) {
                return i = i.isFulfilled() ? i.valueOf() : null, i || BN("i-user-segments").getSegmentById(e, t)
            }).always(function(e) {
                return e.isFulfilled() && e.valueOf() ? e.valueOf() : null
            }) : Vow.promise(null)
        }
    }).done(), BEM.decl({
        block: "i-user-segments",
        baseBlock: "i-management-api"
    }, null, {
        add: function(e) {
            return this._extendSegmentWithApiParams(e).then(function(e) {
                return this._request("post", e.counterId + "/segments", {
                    body: {
                        segment: {
                            name: e.name,
                            expression: e.segment
                        }
                    }
                })
            }.bind(this)).then(function(e) {
                return {
                    id: String(e.segment.segment_id)
                }
            })
        },
        update: function(e, t) {
            return this._extendSegmentWithApiParams(t).then(function(t) {
                return Vow.all([this._request("put", t.counterId + "/segment/" + e, {
                    body: {
                        segment: {
                            name: t.name,
                            expression: t.segment
                        }
                    }
                }), BN("i-report").getMetadata()])
            }.bind(this)).spread(function(e, t) {
                return {
                    id: String(e.segment.segment_id),
                    name: e.segment.name,
                    segment: BN("i-filter").parseApiFilter(e.segment.segment, t.getSegmentsTree())
                }
            })
        },
        remove: function(e) {
            return BN("i-counters").getAsync().then(function(t) {
                return t.isSingle() ? this._request("delete", t.getId() + "/segment/" + e) : Vow.reject(new Error("can not remove segment from group"))
            }.bind(this))
        },
        getSegmentById: function(e, t) {
            return BN("i-counters").getAsync().then(function(i) {
                return i.isSingle() ? Vow.all([this.get(i.getId() + "/segment/" + e), t || BN("i-report").getMetadata()]) : null
            }.bind(this)).spread(function(e, t) {
                return {
                    id: String(e.segment.segment_id),
                    name: e.segment.name,
                    segment: BN("i-filter").parseApiFilter(e.segment.expression, t.getSegmentsTree())
                }
            })
        },
        getList: function() {
            return BN("i-counters").getAsync().then(function(e) {
                return e.isSingle() ? this._getList(e.getId()) : []
            }.bind(this))
        },
        _extendSegmentWithApiParams: function(e) {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getMetadata()]).spread(function(t, i) {
                return t.isSingle() ? {
                    name: e.name,
                    segment: BN("i-filter").buildFilter(e.segment, i.getSegmentsTree(), !0),
                    counterId: t.getId()
                } : Vow.reject(new Error("Can not save segment for group of counters"))
            })
        },
        _getList: function(e) {
            return Vow.all([this.get(e + "/segments"), BN("i-report").getMetadata()]).spread(function(e, t) {
                var i = BN("i-filter"),
                    n = t.getSegmentsTree();
                return e.segments.map(function(e) {
                    return {
                        id: String(e.segment_id),
                        name: e.name,
                        segment: i.parseApiFilter(e.expression, n),
                        applicable: !0
                    }
                })
            }).then(function(e) {
                return {
                    offset: 0,
                    limit: e.length,
                    total: e.length,
                    segments: e
                }
            })
        }
    }), BEM.decl("i-segments-list", null, {
        _segmentToFilterFormat: function(e) {
            return e.segment
        },
        _checkApplicability: function(e) {
            return Vow.all([BN("i-report").getMetadata(), BN("i-counters").getAsync()]).spread(function(t, i) {
                var n = BN("i-filter"),
                    o = t.getSegmentsTree(),
                    s = i.getGoals();
                return e.map(function(e) {
                    var t = this._segmentToFilterFormat(e),
                        i = n.cleanFilter(t, s, o);
                    return e.applicable = jQuery.equals(i, t), e
                }, this)
            }.bind(this))
        }
    }),
    function() {
        var e = [{
            id: 1,
            name: "new-visitors",
            segment: {
                "ym:s:isNewUser": {
                    value: "Yes"
                }
            }
        }, {
            id: 2,
            name: "old-visitors",
            segment: {
                "ym:s:isNewUser": {
                    value: "No"
                }
            }
        }, {
            id: 3,
            name: "search-traffic",
            segment: {
                "ym:s:trafficSource": {
                    items: [{
                        id: "organic"
                    }],
                    exclude: !1
                }
            }
        }, {
            id: 4,
            name: "advert-traffic",
            segment: {
                "ym:s:trafficSource": {
                    items: [{
                        id: "ad"
                    }],
                    exclude: !1
                }
            }
        }, {
            id: 5,
            name: "reference-traffic",
            segment: {
                "ym:s:trafficSource": {
                    items: [{
                        id: "referral"
                    }],
                    exclude: !1
                }
            }
        }, {
            id: 6,
            name: "reject",
            segment: {
                "ym:s:bounce": {
                    value: "Yes"
                }
            }
        }, {
            id: 7,
            name: "not-reject",
            segment: {
                "ym:s:bounce": {
                    value: "No"
                }
            }
        }, {
            id: 10,
            name: "mobile-traffic",
            segment: {
                "ym:s:deviceCategory": {
                    items: [
                        [{
                            id: "mobile"
                        }],
                        [{
                            id: "tablet"
                        }]
                    ],
                    exclude: !1
                }
            }
        }, {
            id: 11,
            name: "desktop-traffic",
            segment: {
                "ym:s:deviceCategory": {
                    items: [
                        [{
                            id: "desktop"
                        }]
                    ],
                    exclude: !1
                }
            }
        }];
        BN.addDecl("i-predefined-segments").staticProp({
            getSegmentById: function(e) {
                var t = null,
                    i = this._getLocalizedList();
                return i.some(function(i) {
                    return String(i.id) === e ? (t = i, !0) : void 0
                }), Vow.fulfill(t)
            },
            _getLocalizedList: function() {
                return e.map(function(e) {
                    return {
                        id: e.id,
                        segment: e.segment,
                        type: "predefined",
                        name: BEM.I18N("i-predefined-segments", e.name)
                    }
                })
            }
        }).done()
    }(), BEM.decl({
        block: "i-predefined-segments",
        baseBlock: "i-segments-list"
    }, null, {
        getList: function(e, t) {
            var i = this._getLocalizedList();
            return void 0 !== e && void 0 !== t && (i = i.slice(t, t + e)), this._checkApplicability(i).then(function(n) {
                return {
                    total: i.length,
                    limit: e,
                    offset: t,
                    segments: n
                }
            })
        }
    }),
    function t(e, i, n) {
        function o(r, a) {
            if (!i[r]) {
                if (!e[r]) {
                    var l = "function" == typeof require && require;
                    if (!a && l) return l(r, !0);
                    if (s) return s(r, !0);
                    var c = new Error("Cannot find module '" + r + "'");
                    throw c.code = "MODULE_NOT_FOUND", c
                }
                var d = i[r] = {
                    exports: {}
                };
                e[r][0].call(d.exports, function(t) {
                    var i = e[r][1][t];
                    return o(i ? i : t)
                }, d, d.exports, t, e, i, n)
            }
            return i[r].exports
        }
        for (var s = "function" == typeof require && require, r = 0; r < n.length; r++) o(n[r]);
        return o
    }({
        1: [function(e, t, i) {
            ! function() {
                BEM.Model = e("promised-models")
            }(BEM)
        }, {
            "promised-models": 5
        }],
        2: [function(e, t, i) {
            var n = e("./inheritable"),
                o = n.inherit({
                    __constructor: function(e) {
                        this._cachBranches = {}, this.DEFAULT_BRANCH = "DEFAULT_BRANCH", this.value = this.parse(void 0 === e ? this._callOrGetDefault() : e), this.commit()
                    },
                    validate: function() {
                        return !0
                    },
                    toJSON: function() {
                        return this.get()
                    },
                    isEqual: function(e) {
                        return this.value === this.parse(e)
                    },
                    isChanged: function(e) {
                        return e = e || this.DEFAULT_BRANCH, !this.isEqual(this._cachBranches[e])
                    },
                    revert: function(e) {
                        e = e || this.DEFAULT_BRANCH, this.isEqual(this._cachBranches[e]) || (this.value = this._cachBranches[e], this._emitChange())
                    },
                    commit: function(e) {
                        e = e || this.DEFAULT_BRANCH, this._cachBranches[e] = this.value
                    },
                    set: function(e) {
                        this.isEqual(e) || (this.value = this.parse(e), this._emitChange())
                    },
                    get: function() {
                        if (arguments.length > 0) throw new Error("Attribute.get() supports no arguments");
                        return this.value
                    },
                    parse: function() {
                        throw new Error("Not implemented")
                    },
                    _emitChange: function() {
                        this.model.calculate().done()
                    },
                    _callOrGetDefault: function() {
                        return "function" == typeof this["default"] ? this["default"]() : this["default"]
                    }
                });
            t.exports = o
        }, {
            "./inheritable": 3
        }],
        3: [function(e, t, i) {
            var n = window.$.inherit;
            t.exports = n({}, {
                inherit: function(e, t) {
                    return n(this, e, t)
                }
            })
        }, {}],
        4: [function(e, t, i) {
            var n = function(e) {
                this._attribute = e
            };
            n.prototype.isEqual = function(e) {
                return this._attribute.isEqual(e)
            }, n.prototype.toArray = function() {
                return this._attribute.value.slice()
            }, n.prototype.get = function(e) {
                return this._attribute.value[e]
            }, n.prototype.length = function() {
                return this._attribute.value.length
            }, ["pop", "push", "reverse", "shift", "sort", "splice", "unshift"].forEach(function(e) {
                n.prototype[e] = function() {
                    var t;
                    return this._attribute.isListCashed(this._attribute.value) && (this._attribute.value = this.toArray()), t = Array.prototype[e].apply(this._attribute.value, arguments), this._attribute.emitListChange(), t
                }
            }), t.exports = n
        }, {}],
        5: [function(e, t, i) {
            var n = e("eventemitter3"),
                o = window.Vow,
                s = e("./uniq"),
                r = e("./inheritable"),
                a = r.inherit({
                    __constructor: function(e, t) {
                        var i = this,
                            r = this.storage || a.Storage;
                        this.CHANGE_BRANCH = s(), this.CALCULATIONS_BRANCH = s(), 1 === arguments.length && "object" == typeof e && (t = e, e = null), this.id = e, t = t || {}, this._eventEmitter = new n, this._readyPromise = o.fulfill(), this.storage = new r, this.attributes = Object.keys(this.attributes || {}).reduce(function(e, n) {
                            var o = i.attributes[n];
                            return e[n] = new(o.inherit({
                                name: n,
                                model: i
                            }))(t[n]), e
                        }, {}), this._attributesAr = Object.keys(this.attributes).map(function(e) {
                            return i.attributes[e]
                        }), this.commit(this.CHANGE_BRANCH), this.calculate().done()
                    },
                    throwCalculationErrors: !0,
                    isNew: function() {
                        return !this.id
                    },
                    save: function() {
                        var e = this;
                        return e.isNew() ? e.ready().then(function() {
                            return e.storage.insert(e)
                        }).then(function(t) {
                            return e.id = t, e.commit(), e.calculate().done(), e.ready()
                        }) : e.ready().then(function() {
                            return e.storage.update(e)
                        }).then(function() {
                            e.commit()
                        })
                    },
                    fetch: function() {
                        var e = this;
                        return o.fulfill().then(function() {
                            return e.storage.find(e)
                        }).then(function(t) {
                            return e.set(t), e.ready()
                        }).then(function() {
                            e.commit()
                        })
                    },
                    remove: function() {
                        var e = this;
                        return e.isNew() ? (e.destruct(), o.fulfill()) : o.fulfill().then(function() {
                            return e.storage.remove(e)
                        }).then(function() {
                            e.destruct()
                        })
                    },
                    isDestructed: function() {
                        return Boolean(this._isDestructed)
                    },
                    destruct: function() {
                        this._isDestructed = !0, this.trigger("destruct"), this._eventEmitter.removeAllListeners()
                    },
                    validate: function() {
                        var e = this;
                        return e.ready().then(function() {
                            return o.all(e._attributesAr.map(function(e) {
                                return e.validate()
                            }))
                        }).then(function(t) {
                            return Math.min.apply(Math, t) ? o.fulfill(!0) : o.reject(t.reduce(function(t, i, n) {
                                return i || t.attributes.push(e._attributesAr[n]), t
                            }, new e.__self.ValidationError))
                        })
                    },
                    isChanged: function(e) {
                        var t = this;
                        return Object.keys(this.attributes).some(function(i) {
                            return t.attributes[i].isChanged(e)
                        })
                    },
                    revert: function(e) {
                        var t = this;
                        return Object.keys(this.attributes).forEach(function(i) {
                            return t.attributes[i].revert(e)
                        })
                    },
                    commit: function(e) {
                        var t = this;
                        return Object.keys(this.attributes).forEach(function(i) {
                            return t.attributes[i].commit(e)
                        })
                    },
                    set: function(e, t) {
                        var i, n = this;
                        if (1 === arguments.length) i = e, Object.keys(i).forEach(function(e) {
                            n.set(e, i[e]);
                        });
                        else {
                            if (!this.attributes[e]) return !1;
                            this.attributes[e].set(t)
                        }
                        return !0
                    },
                    get: function(e) {
                        return this._throwMissedAttribute(e), this.attributes[e].get()
                    },
                    toJSON: function() {
                        var e = this;
                        return Object.keys(this.attributes).filter(function(t) {
                            return !e.attributes[t].internal
                        }).reduce(function(t, i) {
                            var n = e.attributes[i];
                            return t[i] = n.toJSON(), t
                        }, {})
                    },
                    un: function(e, t, i, n) {
                        this._callEventEmitter("removeListener", e, t, i, n)
                    },
                    on: function(e, t, i, n) {
                        this._callEventEmitter("on", e, t, i, n)
                    },
                    trigger: function() {
                        this._eventEmitter.emit.apply(this._eventEmitter, arguments)
                    },
                    isReady: function() {
                        return this._readyPromise.isResolved()
                    },
                    ready: function() {
                        var e = this;
                        return e._readyPromise.always(function(t) {
                            return e._readyPromise === t ? t : e.ready()
                        })
                    },
                    calculate: function() {
                        return this.isReady() && (this.trigger("calculate"), this._readyPromise = this._calculate()), this.throwCalculationErrors ? this._readyPromise : this._readyPromise.always(function() {
                            return o.fulfill()
                        })
                    },
                    maxCalculations: 100,
                    _calculate: function(e) {
                        var t = this,
                            i = {},
                            n = [],
                            s = [];
                        return e = e || 0, e >= t.maxCalculations ? t._throwCalculationLoop() : (t.commit(t.CALCULATIONS_BRANCH), t._attributesAr.forEach(function(e) {
                            e.calculate && (i[e.name] = e.calculate()), e.amend && e.isChanged(t.CHANGE_BRANCH) && n.push(e.amend()), e.ready && s.push(e.ready())
                        }), o.all([o.all(i), o.all(n), o.all(s)]).spread(function(i) {
                            return t.set(i), t.isChanged(t.CALCULATIONS_BRANCH) ? t._calculate(++e) : void t._triggerEvents()
                        }))
                    },
                    _throwCalculationLoop: function() {
                        var e = this,
                            t = e._attributesAr.filter(function(t) {
                                return t.isChanged(e.CALCULATIONS_BRANCH)
                            }).map(function(e) {
                                return e.name
                            });
                        return o.reject(new Error("After " + e.maxCalculations + " calculations fileds " + t + " still changed"))
                    },
                    _triggerEvents: function() {
                        var e, t = this;
                        t.isChanged(t.CHANGE_BRANCH) && (e = t._attributesAr.filter(function(e) {
                            return e.isChanged(t.CHANGE_BRANCH)
                        }), t.commit(t.CHANGE_BRANCH), e.forEach(function(e) {
                            t._emitAttributeChange(e)
                        }), t._emitChange())
                    },
                    _callEventEmitter: function(e, t, i, n, o) {
                        var s = this;
                        "string" != typeof i && (o = n, n = i, i = t, t = void 0), o = o || this, t ? t.split(/\s+/).forEach(function(t) {
                            i.split(/\s+/).forEach(function(i) {
                                s._eventEmitter[e](i + ":" + t, n, o)
                            })
                        }) : i.split(/\s+/).forEach(function(t) {
                            s._eventEmitter[e](t, n, o)
                        })
                    },
                    _emitAttributeChange: function(e) {
                        this.trigger("change:" + e.name)
                    },
                    _emitChange: function() {
                        this.trigger("change")
                    },
                    _throwMissedAttribute: function(e) {
                        if (!this.attributes[e]) throw new Error("Unknown attribute " + e)
                    }
                }, {
                    Storage: e("./storage"),
                    attributeTypes: {
                        String: e("./types/string"),
                        Number: e("./types/number"),
                        Boolean: e("./types/boolean"),
                        List: e("./types/list"),
                        Model: e("./types/model"),
                        ModelsList: e("./types/models-list"),
                        Object: e("./types/object")
                    },
                    Attribute: e("./attribute"),
                    ValidationError: function() {
                        var e = function() {
                            this.name = "ValidationError", this.attributes = [], Error.call(this), Error.captureStackTrace(this, this.constructor)
                        };
                        return e.prototype = new Error, e.prototype.constructor = e, e
                    }()
                });
            t.exports = a
        }, {
            "./attribute": 2,
            "./inheritable": 3,
            "./storage": 6,
            "./types/boolean": 7,
            "./types/list": 8,
            "./types/model": 9,
            "./types/models-list": 10,
            "./types/number": 11,
            "./types/object": 12,
            "./types/string": 13,
            "./uniq": 14,
            eventemitter3: 15
        }],
        6: [function(e, t, i) {
            var n = e("./inheritable");
            t.exports = n.inherit({
                insert: function() {
                    throw new Error(".insert() is not implemented")
                },
                update: function() {
                    throw new Error(".update() is not implemented")
                },
                find: function() {
                    throw new Error(".find() is not implemented")
                },
                remove: function() {
                    throw new Error(".find() is not implemented")
                }
            })
        }, {
            "./inheritable": 3
        }],
        7: [function(e, t, i) {
            var n = e("../attribute");
            t.exports = n.inherit({
                "default": !1,
                parse: function(e) {
                    return Boolean(e)
                }
            })
        }, {
            "../attribute": 2
        }],
        8: [function(e, t, i) {
            var n = e("../attribute"),
                o = e("../list");
            t.exports = n.inherit({
                "default": [],
                toJSON: function() {
                    return this.get().toArray()
                },
                get: function() {
                    return new o(this)
                },
                isEqual: function(e) {
                    return e instanceof o ? e.isEqual(this.value) : this.value === e
                },
                parse: function(e) {
                    return e instanceof o ? e.toArray() : [].concat(e)
                },
                isListCashed: function(e) {
                    var t = this;
                    return Object.keys(t._cachBranches).some(function(i) {
                        return e === t._cachBranches[i]
                    })
                },
                emitListChange: function() {
                    this._emitChange()
                }
            })
        }, {
            "../attribute": 2,
            "../list": 4
        }],
        9: [function(e, t, i) {
            var n, o, s = e("../attribute");
            n = s.inherit({
                __constructor: function() {
                    this.__base.apply(this, arguments), this._initModel()
                },
                ready: function() {
                    return this.value.ready()
                },
                validate: function() {
                    return this.value.validate()
                },
                isChanged: function(e) {
                    return this.value.isChanged(e)
                },
                commit: function(e) {
                    return this.value.commit(e)
                },
                revert: function(e) {
                    return this.value.commit(e)
                },
                modelType: null,
                toJSON: function() {
                    return this.value.toJSON()
                },
                parse: function(e) {
                    return e instanceof this.modelType ? e : new this.modelType(e)
                },
                _onModelChange: function() {
                    this._emitChange()
                },
                _initModel: function() {
                    this.value.on("calculate", this._onModelChange, this)
                }
            }), o = function(e) {
                return this instanceof o ? new n(e) : n.inherit({
                    modelType: e
                })
            }, o.inherit = n.inherit.bind(n), t.exports = o
        }, {
            "../attribute": 2
        }],
        10: [function(e, t, i) {
            var n, o, s = e("../attribute"),
                r = e("../list"),
                a = function(e, t) {
                    return e.filter(function(e) {
                        return -1 === t.indexOf(e)
                    })
                },
                l = window.Vow,
                c = e("../uniq");
            n = s.inherit({
                __constructor: function() {
                    this.__base.apply(this, arguments), this.LISTEN_BRANCH = c(), this._registerEvents()
                },
                "default": [],
                modelType: null,
                get: function() {
                    return new r(this)
                },
                ready: function() {
                    return l.all(this.value.map(function(e) {
                        return e.ready()
                    }))
                },
                validate: function() {
                    return l.all(this.value.map(function(e) {
                        return e.validate()
                    })).then(function() {
                        return 1
                    })
                },
                toJSON: function() {
                    return this.value.map(function(e) {
                        return e.toJSON()
                    })
                },
                isEqual: function(e) {
                    return e instanceof r ? e.isEqual(this.value) : this.value === e
                },
                set: function(e) {
                    this.isEqual(e) || (this.value = this.parse(e), this.emitListChange())
                },
                isChanged: function(e) {
                    return this.__base(e) || Boolean(this.value.length && Math.max.apply(Math, this.value.map(function(t) {
                        return t.isChanged(e)
                    })))
                },
                commit: function(e) {
                    this.__base(e), this.value.map(function(t) {
                        return t.commit(e)
                    })
                },
                revert: function(e) {
                    this.__base(e), this.value.map(function(t) {
                        return t.revert(e)
                    })
                },
                parse: function(e) {
                    var t = [].concat(e),
                        i = this;
                    return t.map(function(e) {
                        return e instanceof i.modelType ? e : new i.modelType(e)
                    })
                },
                isListCashed: function(e) {
                    var t = this;
                    return Object.keys(t._cachBranches).some(function(i) {
                        return e === t._cachBranches[i]
                    })
                },
                emitListChange: function() {
                    var e = this;
                    e.value.forEach(function(t, i) {
                        t instanceof e.modelType || (e.value[i] = new e.modelType(t))
                    }), e._registerEvents(), e._emitChange()
                },
                _onModelCalculate: function() {
                    this._emitChange()
                },
                _onModelDestruct: function() {
                    this.set(this.value.filter(function(e) {
                        return !e.isDestructed()
                    }))
                },
                _registerEvents: function() {
                    var e = this._cachBranches[this.LISTEN_BRANCH] || [],
                        t = a(e, this.value),
                        i = a(this.value, e),
                        n = this;
                    i.forEach(function(e) {
                        e.on("calculate", n._onModelCalculate, n), e.on("destruct", n._onModelDestruct, n)
                    }), t.forEach(function(e) {
                        e.un("calculate", n._onModelCalculate, n), e.un("destruct", n._onModelDestruct, n)
                    }), n.commit(n.LISTEN_BRANCH)
                }
            }), o = function(e) {
                return this instanceof o ? new n(e) : n.inherit({
                    modelType: e
                })
            }, o.inherit = n.inherit.bind(n), t.exports = o
        }, {
            "../attribute": 2,
            "../list": 4,
            "../uniq": 14
        }],
        11: [function(e, t, i) {
            var n = e("../attribute");
            t.exports = n.inherit({
                "default": NaN,
                isEqual: function(e) {
                    return isNaN(e) && isNaN(this.value) ? !0 : this.__base(e)
                },
                parse: function(e) {
                    return Number(e)
                }
            })
        }, {
            "../attribute": 2
        }],
        12: [function(e, t, i) {
            var n = e("./string");
            t.exports = n.inherit({
                "default": "null",
                get: function() {
                    return JSON.parse(this.value)
                },
                parse: function(e) {
                    return "string" != typeof e ? JSON.stringify(e) : e
                }
            })
        }, {
            "./string": 13
        }],
        13: [function(e, t, i) {
            var n = e("../attribute");
            t.exports = n.inherit({
                "default": "",
                parse: function(e) {
                    return String(e)
                }
            })
        }, {
            "../attribute": 2
        }],
        14: [function(e, t, i) {
            var n = 0;
            t.exports = function() {
                return "uniq" + n++
            }
        }, {}],
        15: [function(e, t, i) {
            "use strict";

            function n(e, t, i) {
                this.fn = e, this.context = t, this.once = i || !1
            }

            function o() {}
            var s = "function" != typeof Object.create ? "~" : !1;
            o.prototype._events = void 0, o.prototype.listeners = function(e, t) {
                var i = s ? s + e : e,
                    n = this._events && this._events[i];
                if (t) return !!n;
                if (!n) return [];
                if (this._events[i].fn) return [this._events[i].fn];
                for (var o = 0, r = this._events[i].length, a = new Array(r); r > o; o++) a[o] = this._events[i][o].fn;
                return a
            }, o.prototype.emit = function(e, t, i, n, o, r) {
                var a = s ? s + e : e;
                if (!this._events || !this._events[a]) return !1;
                var l, c, d = this._events[a],
                    u = arguments.length;
                if ("function" == typeof d.fn) {
                    switch (d.once && this.removeListener(e, d.fn, void 0, !0), u) {
                        case 1:
                            return d.fn.call(d.context), !0;
                        case 2:
                            return d.fn.call(d.context, t), !0;
                        case 3:
                            return d.fn.call(d.context, t, i), !0;
                        case 4:
                            return d.fn.call(d.context, t, i, n), !0;
                        case 5:
                            return d.fn.call(d.context, t, i, n, o), !0;
                        case 6:
                            return d.fn.call(d.context, t, i, n, o, r), !0
                    }
                    for (c = 1, l = new Array(u - 1); u > c; c++) l[c - 1] = arguments[c];
                    d.fn.apply(d.context, l)
                } else {
                    var h, m = d.length;
                    for (c = 0; m > c; c++) switch (d[c].once && this.removeListener(e, d[c].fn, void 0, !0), u) {
                        case 1:
                            d[c].fn.call(d[c].context);
                            break;
                        case 2:
                            d[c].fn.call(d[c].context, t);
                            break;
                        case 3:
                            d[c].fn.call(d[c].context, t, i);
                            break;
                        default:
                            if (!l)
                                for (h = 1, l = new Array(u - 1); u > h; h++) l[h - 1] = arguments[h];
                            d[c].fn.apply(d[c].context, l)
                    }
                }
                return !0
            }, o.prototype.on = function(e, t, i) {
                var o = new n(t, i || this),
                    r = s ? s + e : e;
                return this._events || (this._events = s ? {} : Object.create(null)), this._events[r] ? this._events[r].fn ? this._events[r] = [this._events[r], o] : this._events[r].push(o) : this._events[r] = o, this
            }, o.prototype.once = function(e, t, i) {
                var o = new n(t, i || this, !0),
                    r = s ? s + e : e;
                return this._events || (this._events = s ? {} : Object.create(null)), this._events[r] ? this._events[r].fn ? this._events[r] = [this._events[r], o] : this._events[r].push(o) : this._events[r] = o, this
            }, o.prototype.removeListener = function(e, t, i, n) {
                var o = s ? s + e : e;
                if (!this._events || !this._events[o]) return this;
                var r = this._events[o],
                    a = [];
                if (t)
                    if (r.fn)(r.fn !== t || n && !r.once || i && r.context !== i) && a.push(r);
                    else
                        for (var l = 0, c = r.length; c > l; l++)(r[l].fn !== t || n && !r[l].once || i && r[l].context !== i) && a.push(r[l]);
                return a.length ? this._events[o] = 1 === a.length ? a[0] : a : delete this._events[o], this
            }, o.prototype.removeAllListeners = function(e) {
                return this._events ? (e ? delete this._events[s ? s + e : e] : this._events = s ? {} : Object.create(null), this) : this
            }, o.prototype.off = o.prototype.removeListener, o.prototype.addListener = o.prototype.on, o.prototype.setMaxListeners = function() {
                return this
            }, o.prefixed = s, t.exports = o
        }, {}]
    }, {}, [5, 1]),
    function(e) {
        var t = e.inherit({
            __constructor: function() {
                var t = this;
                this.attributes = Object.keys(this.attributes || {}).reduce(function(i, n) {
                    var o, s = t.attributes[n],
                        r = s.type,
                        a = s.modelType;
                    if (s instanceof e.Attribute) o = s;
                    else if ("Model" === r || "ModelsList" === r) {
                        if (!BEM.blocks[a]) throw new Error("Unknown attribute modelType:" + a);
                        o = e.attributeTypes[r].inherit(s).inherit({
                            modelType: BEM.blocks[a]
                        })
                    } else if (e.attributeTypes[r]) o = e.attributeTypes[r].inherit(s);
                    else {
                        if (!BEM.blocks[r]) throw new Error("Unknown attribute type:" + r);
                        o = BEM.blocks[r].inherit(s)
                    }
                    return i[n] = o, i
                }, {}), this.cid = jQuery.identify(), e.getList().push(this), this.__base.apply(this, arguments)
            },
            destruct: function() {
                var t = e.getList(),
                    i = t.indexOf(this); - 1 !== i && t.splice(i, 1), this.__base.apply(this, arguments)
            }
        }, {
            getOne: function(t) {
                var i = this;
                return 0 === arguments.length ? e.getList().filter(function(e) {
                    return e instanceof i
                })[0] : e.getOne(t)
            },
            getAny: function(t) {
                var i, n = this;
                return 0 === arguments.length ? (i = this.getOne(), i || (i = this.create())) : (i = e.getList().filter(function(e) {
                    return e.id === t && e instanceof n
                })[0], i || (i = this.create(t))), i
            },
            create: function(e, t) {
                var i;
                return i = 1 === arguments.length ? new this(e) : new this(e, t)
            }
        });
        e.decl = function(i, n, o, s) {
            var r, a;
            "string" != typeof n && (s = o, o = n, n = null), o = o || {}, r = BEM.blocks[i] ? BEM.blocks[i] : n ? BEM.blocks[n] : t, a = r.prototype.storage || e.Storage, !o.storage || o.storage instanceof e.Storage || (o.storage = a.inherit(o.storage)), BEM.blocks[i] = r.inherit(o, s).inherit({
                blockName: i,
                attributes: jQuery.extend({}, r.prototype.attributes || {}, o.attributes || {})
            })
        }, e.getOne = function(e) {
            return 0 === arguments.length ? this.getList()[0] : this.getList().filter(function(t) {
                return t.cid === e
            })[0]
        }, e.getList = function() {
            throw new Error("not implemented")
        }
    }(BEM.Model),
    function(e) {
        var t = [];
        e.getList = function() {
            return t
        }
    }(BEM.Model), BEM.Model.decl("m-accuracy", {
        MIN_SHARE_VALUE: .001,
        MAX_SHARE_VALUE: 1,
        _distribution: [],
        attributes: {
            enabled: {
                type: "Boolean",
                "default": !1,
                calculate: function() {
                    return this.model.get("minShare") < this.model.MAX_SHARE_VALUE
                }
            },
            share: {
                type: "Number",
                "default": function() {
                    var e = Number(BN("i-router").getParams().accuracy),
                        t = !1;
                    return isNaN(e) || (e = this.model._fixExtermums(e), t = 1 === Number(Number(e).toFixed(3).replace(/[\.0]/g, ""))), t ? e : NaN
                },
                amend: function() {
                    var e = this.model._fixExtermums(this.get()),
                        t = this.model.get("minShare");
                    t > e && this.model.set("share", t)
                }
            },
            minShare: {
                type: "Number",
                amend: function() {
                    var e = Number(this.get()),
                        t = this.model.get("share");
                    e = 0 === e ? this.model.MAX_SHARE_VALUE : this.model._fixExtermums(e), this.model._updateDistribution(e), this.model.set("minShare", e), e > t && this.model.set("share", e)
                }
            }
        },
        getShareSteps: function() {
            var e = this._distribution,
                t = Number((100 / (e.length - 1 || 1)).toFixed(2));
            return e.map(function(e, i) {
                return {
                    percent: Number((t * i).toFixed(2)),
                    step: 1,
                    value: i,
                    label: this._toPercents(e)
                }
            }, this)
        },
        getShareByIndex: function(e) {
            var t = this._distribution.length ? this._distribution.length - 1 : 0;
            return e = 0 > e ? 0 : e > t ? t : e, this._distribution[e]
        },
        getShareIndex: function() {
            return this._distribution.indexOf(this.get("share"))
        },
        getSharePercents: function() {
            return this._toPercents(this.get("share"))
        },
        setFullDistributionParams: function() {
            this.set("share", this.MAX_SHARE_VALUE), this.set("minShare", this.MIN_SHARE_VALUE)
        },
        _fixExtermums: function(e) {
            return e < this.MIN_SHARE_VALUE ? this.MIN_SHARE_VALUE : e > this.MAX_SHARE_VALUE ? this.MAX_SHARE_VALUE : e
        },
        _toPercents: function(e) {
            return Number((100 * e).toFixed(2)) + "%"
        },
        _updateDistribution: function(e) {
            var t = e;
            for (this._distribution.length = 0; 1 > t;) this._distribution.unshift(Number(Math.pow(.1, this._distribution.length).toFixed(this._distribution.length))), t *= 10;
            this._distribution.unshift(e)
        }
    }, {
        getInstance: function() {
            var e = BN("m-accuracy").getOne();
            return e || (e = BN("m-accuracy").create()), e
        },
        getDefaultSampling: function() {
            return BN("i-counters").getAsync().then(function(e) {
                return e.isGlobal() ? "low" : "medium"
            })
        }
    }), BEM.decl({
        block: "i-report-params-minutely",
        baseBlock: "i-report-params-comparable"
    }, {
        _stateToUrlParams: function() {
            var e = this;
            return this.__base.apply(this, arguments).then(function(t) {
                return t.group = e.getParams().oldGroup, t
            })
        },
        _getParamsFromUrl: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return e.oldGroup = e.group, e.group = BN("i-period").MINUTES_GROUP, e
            })
        },
        _buildDefaults: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return e.oldGroup = e.group, e.group = BN("i-period").MINUTES_GROUP, e
            })
        },
        _maskReportNonImportant: function() {
            var e = this.__base.apply(this, arguments);
            return jQuery.extend(!0, {}, e, {
                group: null,
                oldGroup: null
            })
        }
    }), BEM.decl({
        name: "i-report-calltracking",
        baseBlock: "i-report"
    }, {
        loadData: function(e) {
            return BN("i-calltracking-data").loadData(e)
        },
        getReportOptions: function() {
            return BN("i-calltracking-data").getReportOptions()
        }
    }, {
        _getMetadataBlockName: function() {
            return "i-calltracking-metadata"
        },
        _exportFormats: ["xlsx", "csv"],
        _reports: ["sources", "dn", "un", {
            preset: "log",
            type: "calltracking-log",
            reportParamsBlock: "i-report-params-calltracking-log"
        }].map(function(e) {
            return "string" == typeof e && (e = {
                preset: e
            }), jQuery.extend({
                id: "markedphones/" + e.preset,
                type: "legacy",
                onlySingleCounterMode: !0,
                publicAccess: !1,
                urlGroup: "markedphones",
                urlKey: e.preset
            }, e)
        })
    }).registerImplementation(), BEM.decl({
        block: "i-report-params-calltracking-log",
        baseBlock: "i-report-params"
    }, {
        _stateToUrlParams: function(e) {
            var t = {};
            return t.offset = e.offset, t.period = BN("i-period").stringifyPeriod(e.period), t.sort = e.sort && ("desc" === e.sort.mode ? "-" : "") + e.sort.field, Vow.fulfill(t)
        },
        _buildDefaults: function() {
            var e = {};
            return e.limit = 50, e.offset = 0, e.period = BN("i-period").getDefault(), e.sort = this._getReport().getMetadata().then(function(e) {
                var t = e.defaultSortDirection();
                return {
                    field: t.metrics,
                    mode: "abc" === t.direction ? "asc" : "desc"
                }
            }), Vow.all(e)
        },
        _getParamsFromUrl: function() {
            var e = {},
                t = BN("i-data-table");
            return e.offset = Number(BN("i-router").getParams().offset) || void 0, e.period = BN("i-period").getPeriod(), e.sort = this._getReport().getMetadata().then(t.getSortDirection.bind(t)).then(function(e) {
                return e && {
                    field: e.metrics,
                    mode: "abc" === e.direction ? "asc" : "desc"
                }
            }), Vow.all(e)
        }
    }), BEM.decl("i-report-params-calltracking-log", {
        _getParamsDeclaration: function() {
            return [{
                binding: "report.period",
                param: "period"
            }, {
                binding: "report.sort",
                param: "sort"
            }, {
                binding: "report.limit",
                param: "limit"
            }, {
                binding: "report.offset",
                param: "offset"
            }]
        }
    }), BEM.decl({
        name: "i-calltracking-data",
        baseBlock: "i-legacy-data"
    }, null, BEM.blocks["i-proxy"].initProxy("i-calltracking-data", ["_loadData*"])), BEM.decl({
        name: "i-calltracking-metadata",
        baseBlock: "i-legacy-metadata"
    }, {}, {
        getMetadataInfo: function(e) {
            return BN("i-calltracking-meta-api").getPreset(e)
        }
    }), BEM.decl({
        block: "i-calltracking-data-api",
        baseBlock: "i-stat-api"
    }, null, {
        getList: function(e) {
            return this.get("", {
                params: e
            })
        }
    }), BEM.decl({
        block: "i-calltracking-meta-api",
        baseBlock: "i-calltracking-data-api"
    }, null, {
        getPreset: function(e) {
            return this.get("preset", {
                params: {
                    preset: e
                }
            })
        }
    }), BEM.decl({
        name: "i-report-orders",
        baseBlock: "i-report"
    }, {
        loadData: function(e) {
            return e.accuracy = "full", BN("i-default-data").loadData(e)
        }
    }, {
        _exportFormats: ["xlsx", "csv"],
        _reports: [{
            id: "orders_products",
            type: "orders",
            publicAccess: !1,
            urlGroup: "stat",
            urlKey: "orders_products",
            reportParamsBlock: "i-report-params-orders",
            disallowRowSelection: !0
        }]
    }).registerImplementation(), BEM.decl({
        name: "i-report-inpage",
        baseBlock: "i-report-comparable"
    }, {
        getReportHost: function() {
            return this.__self.getReportHost()
        },
        getMetrikaHost: function() {
            return this.__self.getMetrikaHost()
        },
        getInpageReportType: function() {
            return this.params.reportType
        }
    }, {
        _exportFormats: [],
        getInpageList: function() {
            return ["link_map", "click_map", "scroll_map", "form_analysis"]
        },
        _reports: [{
            id: "link_map",
            preset: "link_map",
            reportType: "linkmap"
        }, {
            id: "form_analysis",
            preset: "click_map",
            reportType: "form-analytic"
        }, {
            id: "click_map",
            preset: "click_map",
            reportType: "clickmap"
        }, {
            id: "scroll_map",
            preset: "click_map",
            reportType: "scrollmap"
        }].map(function(e) {
            return e.urlGroup = "inpage", e.urlKey = e.id, e.newTab = !0, e.publicAccess = !0, e.onlySingleCounterMode = !0, e.reportParamsBlock = "i-report-params-inpage", e
        })
    }).registerImplementation(), BEM.decl("i-report-inpage", null, {
        getReportHost: function() {
            return BN("i-global").get("inpage-hosts").inpageHost
        },
        getMetrikaHost: function() {
            return BN("i-global").get("inpage-hosts").metrikaHost
        }
    }), BEM.decl("i-inpage-maps", null, {
        DEFAULT_OPACITY: .5,
        MIN_OPACITY: 0,
        MAX_OPACITY: 1,
        OPACITY_STEP: .1,
        DEFAULT_DOT_SIZE: 11,
        MIN_DOT_SIZE: 1,
        MAX_DOT_SIZE: 20,
        DOT_SIZE_STEP: 1,
        MAP_TYPES: {
            click_map: ["heatmap", "monochrome", "linksandbutton", "opacity", "elements"],
            scroll_map: ["heatmap", "opacity"]
        },
        URL_DIMENSION: "ym:pv:URLHash",
        URL_METRIC: "ym:pv:pageviews",
        URL_SEARCH_DIMENSION: "ym:pv:WWWURL",
        getDotSize: function() {
            var e = Number(BN("i-router").getParams().dotsize);
            return (isNaN(e) || e < this.MIN_DOT_SIZE || e > this.MAX_DOT_SIZE) && (e = this.DEFAULT_DOT_SIZE), e
        },
        getOpacity: function() {
            var e = Number(BN("i-router").getParams().opacity);
            return (isNaN(e) || e < this.MIN_OPACITY || e > this.MAX_OPACITY) && (e = this.DEFAULT_OPACITY), e
        },
        getMapType: function(e) {
            var t = this.getMapTypes(e),
                i = (BN("i-router").getParams().type || "").toLowerCase();
            return -1 === t.indexOf(i) && (i = t[0]), i
        },
        getMapTypes: function(e) {
            return this.MAP_TYPES[e.getId()] || []
        },
        getUrl: function(e, t) {
            var i = BN("i-router").getParams().url;
            return i && i.match(/^https?/) ? Vow.fulfill(decodeURIComponent(i)) : e.getMetadata().then(function(e) {
                var i = {
                    limit: 10
                };
                return i.period = BN("i-period").combinePeriods(t.period, t.comparePeriod), i.filters = BN("i-filter").conjunctionJoinFilters(BN("i-filter").buildFilter(t.filter, e.getSegmentsTree()), BN("i-filter").buildFilter(t.compareFilter, e.getSegmentsTree())), this.getUrls(i)
            }.bind(this)).then(function(e) {
                var t;
                return e.some(function(e) {
                    var i = BN("i-url").parseUrl(e);
                    return "/" === i.pathname ? t = i.protocol + "//" + i.host : void 0
                }), t || e[0] || ""
            })
        },
        getOptions: function() {
            return Vow.all([BN("i-report").getReport(), BN("i-report").getMetadata(), BN("i-counters").getAsync()]).spread(function(e, t, i) {
                var n = BN("i-filter"),
                    o = e.getParamsModel().getState(),
                    s = {};
                return s.counterId = i.getId(), s.url = o.inpage.url, s.type = o.inpage.type || "", s.opacity = o.inpage.opacity, s.dotSize = o.inpage.dotSize, s.period = this._periodToInpage(o.period), s.filter = n.buildFilter(o.filter, t.getSegmentsTree()), e.isCompareMode() && (s.periodB = this._periodToInpage(o.comparePeriod), s.filterB = n.buildFilter(o.compareFilter, t.getSegmentsTree()), s.mode = "comparison"), s
            }.bind(this))
        },
        getUrls: function(e, t) {
            var i = jQuery.extend({}, {
                offset: 1,
                dimensions: this.URL_DIMENSION,
                metrics: this.URL_METRIC,
                sort: "-" + this.URL_METRIC,
                include_undefined: !0
            }, e);
            return t && (i.filters = BN("i-filter").conjunctionJoinFilters(i.filters, BN("i-filter").concatFilter(this.URL_SEARCH_DIMENSION, "=@", t, !0))), BN("i-counters").getAsync().then(function(e) {
                return i.ids = e.getApiCounterId(), BN("i-stat-data-api").get("/", {
                    params: i
                })
            }).then(function(e) {
                return e.data.map(function(e) {
                    return e.dimensions[0].name
                })
            })
        },
        _periodToInpage: function(e) {
            return [e.from, e.to]
        }
    }), BEM.decl("i-webvisor-data", null, {
        getVisitInfo: function(e, t) {
            return this._getVisit(e, t, ["popup"])
        },
        getRequiredVisitInfo: function(e, t) {
            return this._getVisit(e, t).then(function(e) {
                return this._apiResultToArray(e.visits)[0]
            }.bind(this))
        },
        _getVisit: function(e, t, i) {
            return BN("i-webvisor-meta-api").getDefaultVisitDimensions().then(function(n) {
                var o = [];
                return Array.isArray(i) && i.length && i.forEach(function(e) {
                    o = o.concat(n[e])
                }), o = BN("i-util").arrayUnique(o.concat(n.required)), BN("i-webvisor-data-api").getList({
                    id: BN("i-counters").getCounterId(),
                    date1: t,
                    date2: t,
                    dimensions: o.join(","),
                    filters: BN("i-filter").concatFilter("ym:s:visitID", "==", e)
                }).then(function(e) {
                    return {
                        visits: e,
                        dimensions: n
                    }
                })
            }.bind(this))
        },
        choose: function(e) {
            var t = e.marked ? "favorites_add" : "favorites_remove",
                i = {
                    id: e.id,
                    visit_id: e.visit_id
                };
            return e.marked && (i.comment = e.comment), BN("i-webvisor-data-api").post(t, {
                params: i
            })
        },
        getHitList: function(e, t) {
            return BN("i-webvisor-meta-api").getDefaultiHitDimensions().then(function(i) {
                var n = BN("i-period").getPeriod(),
                    o = [].concat(i.required, i.defaults);
                return BN("i-webvisor-data-api").getHitList({
                    id: BN("i-counters").getCounterId(),
                    visitId: e,
                    userIDHash: t,
                    limit: 1e3,
                    date1: n.from,
                    date2: n.to,
                    dimensions: o.join(",")
                }).then(this._apiResultToArray.bind(this))
            }.bind(this))
        },
        markAllVisitsVisited: function(e) {
            return BN("i-webvisor-data-api").post("mark_all_viewed", {
                params: {
                    id: e
                }
            })
        },
        _apiResultToArray: function(e) {
            return (e.data || []).map(function(t) {
                return this._apiArrayToObject(t, e.meta)
            }, this)
        },
        _apiArrayToObject: function(e, t) {
            var i = {};
            return t.dimensions.forEach(function(t, n) {
                i[t.id] = e.dimensions[n]
            }), t.metrics.forEach(function(t, n) {
                i[t.id] = e.metrics[n]
            }), i
        }
    }), BEM.decl({
        block: "i-webvisor-data-api",
        baseBlock: "i-stat-api"
    }, null, {
        post: function(e, t) {
            return this._request("post", e, t)
        },
        getList: function(e) {
            return this.get("visits", {
                params: e
            })
        },
        getActivityMap: function(e) {
            return this.get("activity.gif", {
                params: e,
                proxy: !0
            })
        },
        getHitList: function(e) {
            return this.get("hits", {
                params: e
            })
        }
    }), BEM.decl({
        block: "i-webvisor-meta-api",
        baseBlock: "i-webvisor-data-api"
    }, null, {
        getVisitDimensions: function() {
            return this.get("visit_dimensions").then(function(e) {
                return e.response
            })
        },
        getDefaultVisitDimensions: function() {
            return this.get("default_visit_dimensions")
        },
        getDefaultiHitDimensions: function() {
            return this.get("default_hit_dimensions")
        }
    }), BEM.decl({
        block: "i-report-params-inpage",
        baseBlock: "i-report-params-comparable"
    }, {
        _stateToUrlParams: function(e) {
            return this._getReport().getMetadata().then(function(t) {
                var i = {};
                return i = this._filterToUrl(i, e, t), i = this._periodToUrl(i, e), i.opacity = e.inpage.opacity, i.dotsize = e.inpage.dotSize, i.type = e.inpage.type, i.url = encodeURIComponent(e.inpage.url), i.tld = e.inpage.tld, i
            }.bind(this))
        },
        _buildDefaults: function() {
            var e = BN("i-inpage-maps"),
                t = this._getReport().getId(),
                i = {
                    inpage: {}
                };
            return i.period = BN("i-period").getDefault(), i.filter = {}, i.comparePeriod = this._getSecondaryPeriodDefault(i.period), i.inpage.dotSize = e.DEFAULT_DOT_SIZE, i.inpage.opacity = e.DEFAULT_OPACITY, i.inpage.type = e.MAP_TYPES[t] && e.MAP_TYPES[t][0], i.inpage.tld = "ru", Vow.fulfill(i)
        },
        _maskDefaults: function(e, t) {
            var i = this.__base.apply(this, arguments);
            return e.inpage && (i.inpage = this.__base(e.inpage, t.inpage)), i
        },
        _getParamsFromUrl: function() {
            var e = this._getReport(),
                t = BN("i-inpage-maps");
            return e.getMetadata().then(function(e) {
                var i = {
                    inpage: {}
                };
                return i = this._filterFromUrl(i, e), i = this._periodFromUrl(i), i.inpage.opacity = t.getOpacity(), i.inpage.dotSize = t.getDotSize(), i.inpage.type = t.getMapType(this._getReport()), i.inpage.tld = BN("i-router").getParams().tld, i.inpage = Vow.all(i.inpage), Vow.all(i)
            }.bind(this)).then(function(i) {
                return t.getUrl(e, i).then(function(e) {
                    return i.inpage.url = e, i.filterId = i.filterId && i.filterId.id, i.compareFilterId = i.compareFilterId && i.compareFilterId.id, i
                })
            })
        }
    }), BEM.decl("i-report-params-inpage", {
        _getParamsDeclaration: function() {
            return [{
                binding: "report.period",
                param: "period",
                compare: !1
            }, {
                binding: "segments.primary.period",
                param: "period",
                compare: !0
            }, {
                binding: "segments.secondary.period",
                param: "comparePeriod",
                compare: !0
            }, {
                binding: "compareWith",
                param: "compareWith",
                compare: !0
            }, {
                binding: "report.filter",
                param: "filter",
                compare: !1
            }, {
                binding: "report.segment.id",
                param: "filterId",
                compare: !1
            }, {
                binding: "segments.primary.filter",
                param: "filter",
                compare: !0
            }, {
                binding: "segments.secondary.filter",
                param: "compareFilter",
                compare: !0
            }, {
                binding: "segments.primary.segment.id",
                param: "filterId",
                compare: !0
            }, {
                binding: "segments.secondary.segment.id",
                param: "compareFilterId",
                compare: !0
            }, {
                binding: "inpage",
                param: "inpage"
            }]
        }
    }), BEM.decl({
        name: "i-report-visor-player",
        baseBlock: "i-report-inpage"
    }, {}, {
        _reports: [{
            id: "visor-player",
            type: "webvisor",
            onlySingleCounterMode: !0,
            urlGroup: "inpage",
            urlKey: "visor-player",
            publicAccess: !1,
            reportParamsBlock: "i-report-params-visor-player"
        }]
    }).registerImplementation(), BEM.decl({
        block: "i-report-params-visor-player",
        baseBlock: "i-report-params"
    }, {
        buildUrlParams: function() {
            return Vow.fulfill({})
        },
        _getParamsFromUrl: function() {
            return Vow.fulfill({})
        }
    }), BEM.decl("i-report-params-visor-player", {
        _getParamsDeclaration: function() {
            return []
        }
    }), BEM.decl({
        name: "i-default-metadata",
        baseBlock: "i-report-metadata"
    }, null, BN("i-proxy").initProxy("i-default-metadata", ["_loadMetadataInfo*"])), BEM.decl("i-default-metadata", {
        MAX_METRICS_COUNT: 10,
        MAX_DIMENSIONS_COUNT: 7,
        ATTRIBUTE_PARAM_CURRENCY: "<currency>",
        DATE_PERIOD_DIMENSION: "ym:s:datePeriod<group>",
        GEO_TYPES: ["country", "area"],
        _geoDims: {},
        getTableId: function() {
            return this._table.id
        },
        getMaxMetricsCount: function() {
            return this.MAX_METRICS_COUNT
        },
        getFixedMetrics: function() {
            return this._goal ? this._fixedGoalMetrics : this._fixedMetrics
        },
        setMetrics: function(e) {
            this.constructorAllowed() && this._setMetrics(e)
        },
        getMaxDimensionsCount: function() {
            return this.MAX_DIMENSIONS_COUNT
        },
        setDimensions: function(e) {
            this.constructorAllowed() && this._setDimensions(e)
        },
        goalModeAllowed: function() {
            return this._isCounterSingle && this._table.enable_goal
        },
        constructorAllowed: function() {
            return (void 0 === this._table.enable_constructor ? !0 : this._table.enable_constructor) && (void 0 === this._preset.enable_constructor ? !0 : this._preset.enable_constructor)
        },
        setGoal: function(e) {
            var t = Boolean(e) !== Boolean(this._goal),
                i = t && BN("i-util").arrayDiff(this.getMetrics(), this.getFixedMetrics());
            this.goalModeAllowed() && (this._goal = e, this._dimensionsTreeCache = null, t && this._setMetrics(i), this._publishChanges())
        },
        getPresetFilter: function(e) {
            var t = BN("i-filter"),
                i = this.getDimensionsMeta()[0];
            return !e && i && i.allow_null === !1 ? t.concatFilter(i.dim, "!=", null) : ""
        },
        getPresetFilterWithGoal: function() {
            var e = BN("i-filter"),
                t = this._goal && this._table.goal_filter_metric && jQuery.equals(this.getDimensions(), [this.DATE_PERIOD_DIMENSION]) ? e.concatFilter(this._table.goal_filter_metric, ">", 0) : "";
            return e.conjunctionJoinFilters(this.getPresetFilter(), t)
        },
        getCountMetric: function(e) {
            return this._goal && !e ? this._table.goal_count_metric : this._table.count_metric
        },
        getCountMetricName: function(e) {
            var t;
            return e ? this._table.plural : (t = this._metricsIndex[this.getCountMetric()], t ? t.name : "")
        },
        getAllowedMetricsTree: function() {
            return this._metricsTreeCache || (this._metricsTreeCache = jQuery.extend(!0, [], this._metricsTree), this._metricsTreeCache = this._goalifyTree(this._metricsTreeCache), this._metricsTreeCache = this._markFixedIncompatibleMetrics(this._metricsTreeCache, this.getFixedMetrics()), this._metricsTreeCache = this._removeGoalIncompatible(this._metricsTreeCache)), this._metricsTreeCache
        },
        getAllowedDimensionsTree: function() {
            return this._dimensionsTreeCache || (this._dimensionsTreeCache = jQuery.extend(!0, [], this._dimensionsTree), this._dimensionsTreeCache = this._markIncompatibleDimensions(this._dimensionsTreeCache), this.getGoal() || (this._dimensionsTreeCache = this._removeGoalIncompatible(this._dimensionsTreeCache))), this._dimensionsTreeCache
        },
        getGeoDimensions: function() {
            return this._geoDims
        },
        getAllowedVisibleDimensionsTree: function() {
            return this.getAllowedDimensionsTree()
        },
        validateMetricFilter: function(e) {
            return e && (e = Object.keys(e).reduce(function(t, i) {
                var n = this._metricToCurrentGoalMode(i);
                return t[n] = e[i], t
            }.bind(this), {}), e = BN("i-util").arrayIntersect(Object.keys(e), this.getMetrics()).reduce(function(t, i) {
                return t[i] = e[i], t
            }.bind(this), {}), !BN("i-filter").isFiltersListEmpty(e)) ? e : void 0
        },
        validateMetricsList: function(e) {
            return e = e.filter(Boolean).map(this._metricToCurrentGoalMode, this).filter(this._isCompatibleMetric, this), BN("i-util").arrayIntersect(this.getMetrics(), e)
        },
        sortItems: function(e, t) {
            var i = t.slice(0).reverse().reduce(function(e, t, i) {
                return e[t] = i + 1, e
            }, {});
            return e.sort(function(e, t) {
                return (i[t] || 0) - (i[e] || 0)
            })
        },
        getDefaultMetrics: function() {
            return this._goal ? this._defaultGoalMetrics : this._defaultMetrics
        },
        serializeMetrics: function(e) {
            return this.__self._buildUrlParam(e || this.getDefaultMetrics(), this.getMetrics())
        },
        serializeDimensions: function(e) {
            return this.__self._buildUrlParam(e || this.getDefaultDimensions(), this.getDimensions())
        },
        load: function() {
            var e = this.__self,
                t = BN("i-goal").getGoalIdFromUrl();
            return t = t || this.params.initials && this.params.initials.goal, this._geoDims = {}, BN("i-counters").getAsync().then(function(i) {
                return Vow.all([BN("i-goal").getGoal(t), e.getMetadataInfo(i.getApiCounterId(), this.params.preset), i])
            }.bind(this)).spread(function(e, t, i) {
                return Vow.all([e, t, i, BN("i-segment-tree").create(t.table.id, {
                    isGroupReport: i.isGroup()
                })])
            }).spread(function(e, t, i, n) {
                var o, s, r = BN("i-router").getParams();
                return this._isCounterSingle = i.isSingle(), this._metricsTree = t.metricsTree, this._metricsMetaTable = t.metricsMeta, this._dimensionsTree = t.dimensionsTree, this._geoDims = this._findGeoDims(t.dimensionsTree), this._dimensionsMetaTable = t.dimensionsMeta, this._tree = n, this._preset = t.preset, this._table = t.table, this._metricsIndex = this._buildIndexFromList(this._metricsMetaTable), this._metricsIndex = this._appendGoalMetricsToIndex(this._metricsIndex), this._dimensionsIndex = this._buildIndexFromList(this._dimensionsMetaTable), this._defaultMetrics = this.params.defaults && this.params.defaults.metrics || this._preset.metrics, this._fixedMetrics = this._table.fixedMetrics, this._fixedGoalMetrics = this._table.fixedGoalMetrics, this._defaultGoalMetrics = BN("i-util").arrayUnique((this._fixedGoalMetrics || []).concat(this._defaultMetrics.map(this._metricToGoalMetric.bind(this)))), this._defaultDimensions = this.params.defaults && this.params.defaults.dimensions || this._preset.dimensions, this.setGoal(e && e.id), i.isGlobal() ? this._setMetrics([this.getCountMetric()]) : this._setMetrics(this._defaultMetrics), this._setDimensions(this._defaultDimensions), o = this.params.initials && this.params.initials.metrics || (i.isGlobal() ? [this.getCountMetric()] : this._defaultMetrics), s = this.params.initials && this.params.initials.dimensions || this._defaultDimensions, o = void 0 !== r.metrics ? r.metrics.split(",") : o, s = void 0 !== r.dimensions ? r.dimensions.split(",") : s, this.setMetrics(o), this.setDimensions(s), this.setMod("ready", "yes"), this
            }.bind(this))
        },
        hasDirectClientParam: function() {
            return this.getDimensionsMeta().concat(this.getMetricsMeta()).some(function(e) {
                var t = e.required_keys;
                return t && -1 !== t.indexOf("client")
            })
        },
        hasCurrencyAttr: function() {
            var e = this.ATTRIBUTE_PARAM_CURRENCY,
                t = function(t) {
                    return String(t).indexOf(e) >= 1
                };
            return this.getDimensions().some(t) || this.getMetrics().some(t)
        },
        getDefaultSelectedRowsLimit: function() {
            return this._preset.default_selected_rows || this.DEFAULT_SELECTED_ROWS
        },
        _setDimensions: function(e) {
            e = e instanceof Array ? e : this._defaultDimensions, e = this._cleanItems(e, this._isCompatibleDimension.bind(this)), e = this.sortItems(BN("i-util").arrayUnique(e), e), e = e.slice(0, this.getMaxDimensionsCount()), jQuery.equals(this._dimensions, e) || (this._dimensions = e, this._dimensionsMeta = null, this._subTable = null, this._metricsTreeCache = null, this._dimensionsTreeCache = null, this._publishChanges())
        },
        _setMetrics: function(e) {
            e = e.map(this._metricToCurrentGoalMode, this), e = this._cleanItems(e, this._isCompatibleMetric.bind(this)), e = e && e.length ? e : this.getDefaultMetrics(), e = this.sortItems(BN("i-util").arrayUnique(this.getFixedMetrics().concat(e)), this.getFixedMetrics().concat(e)), e = e.slice(0, this.getMaxMetricsCount()), jQuery.equals(this._metrics, e) || (this._metrics = e, this._metricsMeta = null, this._subTable = null, this._metricsTreeCache = null, this._dimensionsTreeCache = null, this._publishChanges())
        },
        _validateSortDirection: function(e, t) {
            return e && (!this._metricsIndex[e.metrics] || (e.metrics = this._metricToCurrentGoalMode(e.metrics), this._isCompatibleMetric(e.metrics) && this._metricsIndex[e.metrics].allow_sort)) && (!this._dimensionsIndex[e.metrics] || this._isCompatibleDimension(e.metrics) && this._dimensionsIndex[e.metrics].allow_sort) ? -1 === this.getMetrics().concat(this.getDimensions()).indexOf(e.metrics) ? t : e : t
        },
        _appendGoalMetricsToIndex: function(e) {
            return Object.keys(e).forEach(function(t) {
                var i;
                this._isGoalCompatibleAttr(t) || (i = jQuery.extend(!0, {}, e[t]), i.id = i.dim = this._metricToGoalMetric(t), e[i.dim] = e[i.dim] || i)
            }, this), e
        },
        _buildIndexFromTree: function(e) {
            var t;
            if (!this._indexFromTreeCache) {
                this._indexFromTreeCache = {}, t = e.slice(0);
                for (var i, n = 0; i = t[n]; n++) i.chld && t.push.apply(t, i.chld), this._indexFromTreeCache[i.id] = i
            }
            return this._indexFromTreeCache
        },
        _getCurrentSubTable: function() {
            return this._subTable || this.getMetricsMeta().concat(this.getDimensionsMeta()).reduce(function(e, t) {
                if (e && t.sub_table && t.sub_table !== e) throw new Error("incompatible metirics and dimensions has been chosen");
                return e || t.sub_table
            }, !1)
        },
        _isCompatibleMetric: function(e) {
            var t = this._metricsIndex[e],
                i = this._getCurrentSubTable();
            return t && (!t.sub_table || !i || t.sub_table === i) && (t.required_dimension ? -1 !== this.getDimensions().indexOf(t.required_dimension) : !0)
        },
        _isCompatibleDimension: function(e) {
            var t = this._dimensionsIndex[e],
                i = this._getCurrentSubTable(),
                n = Boolean(this._isGoalCompatibleAttr(e));
            return t && (!t.sub_table || !i || t.sub_table === i) && (!n || Boolean(this.getGoal()))
        },
        _cleanItems: function(e, t) {
            return (e || []).filter(t)
        },
        _goalifyTree: function(e, t) {
            return this._goal ? (t = t || this._buildIndexFromTree(e), e.reduce(function(e, i) {
                var n;
                return i.chld && (i.chld = this._goalifyTree(i.chld, t), i.chld.length || delete i.chld), !i.dim || this._isGoalCompatibleAttr(i.dim) ? e.push(i) : (n = this._metricToGoalMetric(i.dim), t[n] || (i.dim = i.id = n, e.push(i))), e
            }.bind(this), [])) : e
        },
        _removeGoalIncompatible: function(e) {
            return e.filter(function(e) {
                return e.chld && (e.chld = this._removeGoalIncompatible(e.chld), e.chld.length || delete e.chld), !e.dim && e.chld || e.dim && (e.disallows_goal || this._isGoalCompatibleAttr(e.dim) === Boolean(this._goal))
            }, this)
        },
        _markFixedIncompatibleMetrics: function(e, t) {
            return e.forEach(function(e) {
                e.dim && (e.disabled = -1 !== t.indexOf(e.dim) || !this._isCompatibleMetric(e.dim)), e.chld && (e.chld = this._markFixedIncompatibleMetrics(e.chld, t))
            }.bind(this)), e
        },
        _markIncompatibleDimensions: function(e) {
            return e.forEach(function(e) {
                e.dim && (e.disabled = !this._isCompatibleDimension(e.dim)), e.chld && (e.chld = this._markIncompatibleDimensions(e.chld))
            }, this), e
        },
        _findGeoDims: function(e) {
            return e.forEach(function(e) {
                -1 !== this.GEO_TYPES.indexOf(e.type) && (this._geoDims[e.type] = e.dim), e.chld && e.chld.length && this._findGeoDims(e.chld), e.attributes && e.attributes.length && this._findGeoDims(e.attributes)
            }, this), this._geoDims
        }
    }, {
        getMetadataInfo: function(e, t) {
            var i;
            return t instanceof Object && (i = t, t = void 0), this._loadMetadataInfo(e, t, i && i.table).then(function(e) {
                return {
                    preset: jQuery.extend({}, e.preset || i),
                    table: e.table,
                    dimensionsMeta: e.dimensionsMeta,
                    dimensionsTree: e.dimensionsTree,
                    metricsMeta: e.metricsMeta,
                    metricsTree: e.metricsTree
                }
            })
        }
    }), BEM.decl("i-default-metadata", {
        _getDataBindingsDecl: function() {
            return jQuery.extend(this.__base(), {
                "preset.goal": {
                    initAccessor: "getGoal",
                    event: "change",
                    get: "_goal"
                },
                "preset.metrics": {
                    initAccessor: "getMetrics",
                    event: "change",
                    get: "_metrics"
                },
                "preset.dimensions": {
                    initAccessor: "getDimensions",
                    event: "change",
                    get: "_dimensions"
                }
            })
        }
    }), BEM.decl({
        name: "i-monitoring-metadata",
        baseBlock: "i-metadata"
    }, {
        clonePreset: function() {
            return {}
        }
    }), BEM.decl({
        block: "i-webvisor-metadata",
        baseBlock: "i-report-metadata"
    }, {
        dimNameVisitId: "ym:s:visitID",
        dimNameViewed: "ym:s:webVisorViewed",
        dimNameSelected: "ym:s:webVisorSelected",
        dimNameComment: "ym:s:webVisorSelectedText",
        dimNameActivity: "ym:s:webVisorActivity",
        dimNameDateTime: "ym:s:dateTime",
        dimNameDuration: "ym:s:visitDurationShort",
        dimNameUserIdHash: "ym:s:userIDHash",
        metricNameCount: "ym:s:visits",
        DEFAULT_SORT: {
            field: "ym:s:dateTime",
            mode: "desc"
        },
        load: function() {
            return Vow.all([BN("i-webvisor-meta-api").getVisitDimensions(), BN("i-webvisor-meta-api").getDefaultVisitDimensions(), BN("i-webvisor-settings-api").getDimensions(), BN("i-segment-tree-webvisor").create(this.getTableId(), {
                isGroupReport: !1
            })]).spread(function(e, t, i, n) {
                return this._tree = n, this._metrics = [], this._dimensionsMetaTable = this._normalizeDimensionsStructure(e), this._dimensionsIndex = this._buildIndexFromList(this._dimensionsMetaTable), this._defaultDimensions = t.defaults, this._dimensions = [].concat(t.required, t.first_column, t.defaults), this._firstColumnDimensions = t.first_column, this._requiredDimensions = t.required, this._hiddenDimensions = t.custom_displayed, this._dimensionsMeta = null, this._cacheDimIdx = {}, i && i.length && this._setDimensions(i), this.setMod("ready", "yes"), this
            }.bind(this))
        },
        getTableId: function() {
            return "visits"
        },
        constructorAllowed: function() {
            return !0
        },
        goalModeAllowed: function() {
            return !1
        },
        getAllowedDimensionsTree: function() {
            var e;
            return this._visibleDimensionsCache || (e = this._hiddenDimensions.concat(this._firstColumnDimensions, this._requiredDimensions), this._visibleDimensionsCache = this._dimensionsMetaTable.filter(function(t) {
                return -1 === e.indexOf(t.dim)
            })), this._visibleDimensionsCache
        },
        getAllowedVisibleDimensionsTree: function() {
            return this._allowedDimensionsTree || (this._allowedDimensionsTree = this._filterTree(this.getAllowedDimensionsTree(), function(e) {
                return this._isVisibleDimension(e.dim)
            }, this)), this._allowedDimensionsTree
        },
        getMaxDimensionsCount: function() {
            return this.getAllowedDimensionsTree().length
        },
        setDimensions: function(e) {
            this._setDimensions(e) && this._saveUsersDimensions()
        },
        isFirstColumnDimension: function(e) {
            return this._firstColumnDimensions.indexOf(e.dim) > -1
        },
        isColumnDimension: function(e) {
            return this._hiddenDimensions.indexOf(e.dim) < 0
        },
        isTableColumnDimension: function(e) {
            return -1 === this._hiddenDimensions.indexOf(e) && -1 === this._firstColumnDimensions.indexOf(e)
        },
        defaultSortDirection: function() {
            return this.DEFAULT_SORT
        },
        serializeDimensions: function() {
            return this.__self._buildUrlParam(this.getDefaultDimensions(), this.getVisibleDimensions())
        },
        getVisitIdIdx: function() {
            return this._getDimensionIdx(this.dimNameVisitId)
        },
        getUserIdHashIdx: function() {
            return this._getDimensionIdx(this.dimNameUserIdHash)
        },
        getViewedIdx: function() {
            return this._getDimensionIdx(this.dimNameViewed)
        },
        getSelectedIdx: function() {
            return this._getDimensionIdx(this.dimNameSelected)
        },
        getCommentIdx: function() {
            return this._getDimensionIdx(this.dimNameComment)
        },
        getActivityIdx: function() {
            return this._getDimensionIdx(this.dimNameActivity)
        },
        getDateTimeIdx: function() {
            return this._getDimensionIdx(this.dimNameDateTime)
        },
        getDurationIdx: function() {
            return this._getDimensionIdx(this.dimNameDuration)
        },
        getPresetFilter: function() {
            return ""
        },
        getCountMetric: function() {
            return this.metricNameCount
        },
        getPresetFilterWithGoal: function() {
            return ""
        },
        _filterTree: function(e, t, i) {
            return i = i || e, e.filter(function(e) {
                return e.chld ? (e.chld = this._cleanTree(e.chld, t), e.chld && e.chld.length) : t.call(i, e)
            }, this)
        },
        _isVisibleDimension: function(e) {
            return -1 === this._hiddenDimensions.indexOf(e) && -1 === this._firstColumnDimensions.indexOf(e) && -1 === this._requiredDimensions.indexOf(e)
        },
        _setDimensions: function(e) {
            var t = BN("i-util").arrayUnique(this._hiddenDimensions.concat(this._firstColumnDimensions, this._requiredDimensions));
            return e = e.filter(function(e) {
                return Boolean(this._dimensionsIndex[e])
            }, this), e = BN("i-util").arrayDiff(t, e).concat(e), jQuery.equals(e, this._dimensions) ? !1 : (this._dimensions = e, this._dimensionsMeta = null, this._cacheDimIdx = {}, this._publishChanges(), !0)
        },
        _getDimensionIdx: function(e) {
            return this._cacheDimIdx[e] || (this._cacheDimIdx[e] = this.getDimensions().indexOf(e)), this._cacheDimIdx[e]
        },
        _validateSortDirection: function(e, t) {
            var i;
            return e && (i = this.getDimensionMeta(e.field), -1 !== this._dimensions.indexOf(e.field) && i && i.allow_sort) ? e : t
        },
        _normalizeDimensionsStructure: function(e) {
            return e.map(function(e) {
                return jQuery.extend({}, e, {
                    id: e.dim
                })
            })
        },
        _saveUsersDimensions: function() {}
    }), BEM.decl("i-webvisor-metadata", {
        onSetMod: {
            js: function() {
                return this._saveUsersDimensions = jQuery.debounce(this._saveUsersDimensions.bind(this), 500), this.__base.apply(this, arguments)
            },
            ready: {
                yes: function() {
                    this.bindToData({
                        "preset.dimensions": {
                            initAccessor: "getDimensions",
                            event: "change",
                            get: "_dimensions"
                        },
                        "preset.reportId": {
                            initAccessor: "getReportId",
                            event: "change",
                            get: "getReportId"
                        }
                    }), this._publishChanges()
                }
            }
        },
        _saveUsersDimensions: function() {
            BN("i-webvisor-settings-api").saveDimensions(this.getDimensions()).done()
        }
    }), BEM.decl("i-webvisor-settings-api", null, BEM.blocks["i-proxy"].initProxy("i-webvisor-settings-api", ["getColumnWidthes", "saveColumnWidthes", "getDimensions", "saveDimensions"])), BEM.decl("i-webvisor-settings-api", null, {
        saveColumnWidthes: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return BN("i-proxy").cleanCache(this._name, ["getColumnWidthes"]), e
            }.bind(this))
        },
        saveDimensions: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return BN("i-proxy").cleanCache(this._name, ["getDimensions"]), e
            }.bind(this))
        }
    }), BEM.decl({
        block: "i-segment-tree-webvisor",
        baseBlock: "i-segment-tree"
    }, {
        _isSegmentVisible: function(e) {
            return (!e.restricted || "webvisor" === e.restricted) && BN("segment-panel").isKnownSegment(e.type)
        },
        _isSegmentEnabled: function(e) {
            return !(e.restricted && "webvisor" !== e.restricted || this.params.isGroupReport && "goals" === e.type)
        }
    }), BEM.decl({
        block: "i-orders-metadata",
        baseBlock: "i-report-metadata"
    }, {
        DEFAULT_SORT: {
            metrics: "ym:s:pProductPurchasedQuantity",
            direction: "cba"
        },
        load: function() {
            return BN("i-stat-custom-metadata-api").getMetadata("orders_products").then(function(e) {
                return BN("i-segment-tree").create(e.table).then(function(t) {
                    return this._preset = e, this._table = e.table, this._tree = t, this._metrics = e.metrics, this._dimensions = e.dimensions, this._metricsIndex = this._buildIndexFromList(e.meta.metrics), this._dimensionsIndex = this._buildIndexFromList(e.meta.dimensions), this.setMod("ready", "yes"), this
                }.bind(this))
            }.bind(this))
        },
        getTableId: function() {
            return this._table
        },
        constructorAllowed: function() {
            return !1
        },
        goalModeAllowed: function() {
            return !1
        },
        getPresetFilterWithGoal: function() {
            return ""
        },
        defaultSortDirection: function() {
            return this.DEFAULT_SORT
        },
        _validateSortDirection: function(e, t) {
            return e && (this._metricsIndex[e.metrics] || this._dimensionsIndex[e.metrics]) ? e : t
        }
    }), BEM.decl("i-orders-metadata", {
        onSetMod: {
            ready: {
                yes: function() {
                    this.bindToData({
                        "preset.dimensions": {
                            initAccessor: "getDimensions",
                            event: "change",
                            get: "_dimensions"
                        },
                        "preset.reportId": {
                            initAccessor: "getReportId",
                            event: "change",
                            get: "getReportId"
                        }
                    }), this._publishChanges()
                }
            }
        }
    }), BEM.decl({
        block: "i-stat-custom-metadata-api",
        baseBlock: "i-stat-api"
    }, null, BN("i-proxy").initProxy("i-stat-custom-metadata-api", ["getPreset*"])), BEM.decl("i-stat-custom-metadata-api", null, {
        getMetadata: function(e) {
            return this.get("preset", {
                params: {
                    preset: e
                }
            })
        }
    }), BEM.decl({
        name: "i-conversion-metadata",
        baseBlock: "i-report-metadata"
    }, {
        COUNT_METRIC: "ym:s:visits",
        _dimensions: ["ym:s:goalDimension"],
        _metrics: ["ym:s:goalDimensionInternalReaches", "ym:s:sumVisits"],
        load: function() {
            return BN("i-segment-tree").create(this.getTableId()).then(function(e) {
                return this._tree = e, this
            }.bind(this))
        },
        getTableId: function() {
            return "visits"
        },
        getPresetFilter: function() {
            return ""
        },
        getPresetFilterWithGoal: function() {
            return ""
        },
        getCountMetric: function() {
            return this.COUNT_METRIC
        },
        _init: function() {
            this.__base.apply(this, arguments), this._metricsIndex = this._buildIndex(this._metrics), this._dimensionsIndex = this._buildIndex(this._dimensions)
        },
        _buildIndex: function(e) {
            return e.reduce(function(e, t) {
                return e[t] = t, e
            }, {})
        },
        _validateSortDirection: function() {
            return !1
        }
    }), BEM.decl({
        block: "i-report-params-monitoring",
        baseBlock: "i-report-params"
    }, {
        _stateToUrlParams: function(e) {
            var t = {};
            return t.mirror = e.mirror, t.sort = e.sort, t.chart_type = BN("i-chart").serializeChartType(e.chartType), t.period = BN("i-period").stringifyPeriod(e.period), Vow.fulfill(t)
        },
        _buildDefaults: function() {
            var e = {};
            return e.period = BN("i-period").getDefault(), e.chartType = this._getReport().getDefaultChartType(), e.mirror = null, e.sort = "from", Vow.fulfill(e)
        },
        _getParamsFromUrl: function() {
            var e = {},
                t = BN("i-router").getParams();
            return e.chartType = BN("i-chart").getMonitoringChartType(), e.period = BN("i-period").getPeriod(), e.sort = t.sort, e.mirror = isNaN(t.mirror) ? null : t.mirror, Vow.all(e)
        }
    }), BEM.decl("i-report-params-monitoring", {
        _getParamsDeclaration: function() {
            return [{
                binding: "report.mirror",
                param: "mirror"
            }, {
                binding: "report.sort",
                param: "sort"
            }, {
                binding: "chartType.url",
                param: "chartType"
            }, {
                binding: "report.period",
                param: "period"
            }]
        }
    }), BEM.decl({
        block: "i-report-params-webvisor",
        baseBlock: "i-report-params"
    }, {
        _stateToUrlParams: function(e) {
            return this._getReport().getMetadata().then(function(t) {
                var i = BN("i-filter"),
                    n = {};
                return e.filterId && (n.filter_id = e.filterId), e.filter && (n.filter = i.stringifyFilter(e.filter, t)), e.sort && (n.sort = ("desc" === e.sort.mode ? "-" : "") + e.sort.field), n.period = BN("i-period").stringifyPeriod(e.period), n.offset = e.offset, n
            }.bind(this))
        },
        _buildDefaults: function() {
            return this._getReport().getMetadata().then(function(e) {
                var t = {
                    preset: {}
                };
                return t.sort = e.defaultSortDirection(), t.period = BN("i-period").getDefault(), t.filter = {}, t.offset = 0, t.limit = 50, t
            })
        },
        _getParamsFromUrl: function() {
            return this._getReport().getMetadata().then(function(e) {
                var t = {
                    preset: {}
                };
                return t.preset.dimensions = e.getDimensions(), t.period = BN("i-period").getPeriod(), t.sort = this._getSortFromUrl(e), t.offset = Number(BN("i-router").getParams().offset) || void 0, t.filterId = BN("i-segments").getSegment(e), t.filter = BN("i-filter").getFilterFromUrl(e), Vow.all(t)
            }.bind(this)).then(function(e) {
                return e.filterId = e.filterId && e.filterId.id, e
            })
        },
        _getSortFromUrl: function(e) {
            var t = BN("i-router").getParams().sort;
            return t = t ? {
                field: t,
                mode: "asc"
            } : null, t && "-" === t.field.charAt(0) && (t.mode = "desc", t.field = t.field.substring(1)), e.validateSortDirection(t)
        }
    }), BEM.decl("i-report-params-webvisor", {
        _getParamsDeclaration: function() {
            return [{
                binding: "preset.dimensions",
                param: "preset.dimensions"
            }, {
                binding: "report.period",
                param: "period"
            }, {
                binding: "report.sort",
                param: "sort"
            }, {
                binding: "report.filter",
                param: "filter"
            }, {
                binding: "report.segment.id",
                param: "filterId"
            }, {
                binding: "report.offset",
                param: "offset"
            }, {
                binding: "report.limit",
                param: "limit"
            }]
        }
    }), BEM.decl({
        block: "i-report-params-conversion",
        baseBlock: "i-report-params"
    }, {
        _filterToUrl: function(e, t, i) {
            var n = BN("i-filter");
            return t.filter && (e.filter = n.stringifyFilter(t.filter, i)), t.filterId && (e.filter_id = t.filterId), e
        },
        _stateToUrlParams: function(e) {
            return this._getReport().getMetadata().then(function(t) {
                var i = {};
                return i = this._filterToUrl(i, e, t), i.period = BN("i-period").stringifyPeriod(e.period), i.group = e.group, i.accuracy = e.accuracy, i
            }.bind(this))
        },
        _buildDefaults: function() {
            var e = {};
            return e.period = BN("i-period").getDefault(), e.group = BN("i-period").getDefaultGrouping(), e.accuracy = BN("m-accuracy").getDefaultSampling(), e.filter = {}, Vow.all(e)
        },
        _filterFromUrl: function(e, t) {
            return e.filter = BN("i-filter").getFilterFromUrl(t), e.filterId = BN("i-segments").getSegment(t), e
        },
        _getParamsFromUrl: function() {
            var e = {};
            return e = this._periodFromUrl(e), e.group = BN("i-period").getGrouping(this._getReport()), e.accuracy = BN("m-accuracy").getInstance().get("share"), this._getReport().getMetadata().then(function(t) {
                return Vow.all(this._filterFromUrl(e, t))
            }.bind(this)).then(function(e) {
                return e.filterId = e.filterId && e.filterId.id, e
            })
        }
    }), BEM.decl("i-report-params-conversion", {
        _getParamsDeclaration: function() {
            return [{
                binding: "report.filter",
                param: "filter"
            }, {
                binding: "report.segment.id",
                param: "filterId"
            }, {
                binding: "report.period",
                param: "period"
            }, {
                binding: "report.group",
                param: "group"
            }, {
                binding: "sampling.accuracy",
                param: "accuracy"
            }]
        }
    }), BEM.decl({
        block: "i-report-params-orders",
        baseBlock: "i-report-params"
    }, {
        _stateToUrlParams: function(e) {
            return this._getReport().getMetadata().then(function(t) {
                var i = BN("i-filter"),
                    n = BN("i-data-table"),
                    o = e["data-table"] || {},
                    s = {};
                return e.filterId && (s.filter_id = e.filterId), e.filter && (s.filter = i.stringifyFilter(e.filter, t)), o.sort && (s.sort = n.stringifySortDirection(o.sort)), o.dimensionFilter && (s.dimension_filter = n.stringifyDimensionFilter(o.dimensionFilter)), s.period = BN("i-period").stringifyPeriod(e.period), s.offset = e.offset, s
            }.bind(this))
        },
        _buildDefaults: function() {
            return this._getReport().getMetadata().then(function(e) {
                var t = {
                    preset: {}
                };
                return t.period = BN("i-period").getDefault(), t.filter = {}, t.offset = 0, t.limit = BN("i-data-table").DEFAULT_ROWS_LIMIT, t.accuracy = "full", t["data-table"] = {
                    dimensionMode: "list",
                    dimensionFilter: null,
                    sort: e.defaultSortDirection()
                }, t
            })
        },
        _getParamsFromUrl: function() {
            return this._getReport().getMetadata().then(function(e) {
                var t = {
                    preset: {}
                };
                return t.preset.dimensions = e.getDimensions(), t.period = BN("i-period").getPeriod(), t.offset = Number(BN("i-router").getParams().offset) || void 0, t.filterId = BN("i-segments").getSegment(e), t.filter = BN("i-filter").getFilterFromUrl(e), t.dimensionFilter = BN("i-data-table").getDimensionFilterFromUrl(e), t.sort = BN("i-data-table").getSortDirection(e), Vow.all(t)
            }.bind(this)).then(function(e) {
                return e["data-table"] = {
                    dimensionFilter: e.dimensionFilter,
                    sort: e.sort
                }, delete e.dimensionFilter, delete e.sort, e.filterId = e.filterId && e.filterId.id, e
            })
        }
    }), BEM.decl("i-report-params-orders", {
        _getParamsDeclaration: function() {
            return this.__base().concat([{
                binding: "preset.metrics",
                param: "preset.metrics"
            }, {
                binding: "preset.dimensions",
                param: "preset.dimensions"
            }, {
                binding: "report.filter",
                param: "filter",
                compare: !1
            }, {
                binding: "report.segment.id",
                param: "filterId",
                compare: !1
            }, {
                binding: "data-table.metricFilters",
                param: "data-table.metricFilters",
                compare: !1
            }, {
                binding: "data-table.dimensionFilter",
                param: "data-table.dimensionFilter"
            }])
        }
    }), BEM.decl("i-popular-reports-collection", {
        _changed: !1,
        _cache: !1,
        visitReport: function(e) {
            return this.markChanged(), BN("i-user").uid().always(function(t) {
                return t.isRejected() ? void 0 : BN("i-popular-reports").hitReport(e)
            })
        },
        removeReport: function(e) {
            return this.markChanged(), BN("i-popular-reports").removeUserReportData(e)
        },
        isChanged: function() {
            return this._changed
        },
        markChanged: function() {
            this._changed = !0, this._cache = !1
        },
        getPopularReports: function() {
            return !this._cache || this._cache.isRejected() || this._changed ? (this._cache = BN("i-user").uid().always(function(e) {
                return e.isRejected() ? [] : BN("i-popular-reports").getPopularReports()
            }).then(function(e) {
                return BN("i-report").bulkCreateReports(e)
            }).then(function(e) {
                return this._changed = !1, e
            }.bind(this)), this._cache) : this._cache
        }
    }, {
        get: function() {
            var e = BN("i-state").get(this._name + ".instance");
            return e || (e = BEM.create(this._name), BN("i-state").set(this._name + ".instance", e)), e
        }
    }), BN.addDecl("i-popular-reports").staticProp(BN("i-proxy").initProxy("i-popular-reports", ["hitReport", "getPopularReports*", "removeUserReportData"])).done(), BEM.decl("i-popular-reports", null, {
        removeUserReportData: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return BN("i-proxy").cleanCache("i-popular-reports", "getPopularReports"), e
            })
        }
    }), BEM.decl("i-report-collection", {
        setCompareMode: function(e) {
            Object.keys(this._itemsIndex).forEach(function(t) {
                var i = this._itemsIndex[t].item;
                i.setCompareMode instanceof Function && i.setCompareMode(e)
            }, this)
        },
        getTree: function() {
            return this._tree
        },
        search: function(e) {
            return e = e.toLowerCase().trim(), this.getTree().reduce(function(t, i) {
                var n = Boolean(i.items),
                    o = this._searchTree(n ? i.items : [i], e);
                return o.length && (n ? t.push({
                    name: i.name,
                    items: o
                }) : t.push(o[0])), t
            }.bind(this), [])
        },
        getMenuItem: function(e) {
            return this._menuIndex[e] || {}
        },
        getReportPositionInTree: function(e) {
            return this._itemsIndex[e] && this._itemsIndex[e].prefix || []
        },
        getReportById: function(e) {
            return this._itemsIndex[e].item
        },
        setActiveReport: function(e) {
            e && this.setCompareMode(e.isCompareMode instanceof Function && e.isCompareMode())
        },
        _initModels: function() {
            var e = this.__self._structure;
            return BN("i-report").bulkCreateReports(this._flattenStructure(e)).then(function(t) {
                var i = t.reduce(function(e, t) {
                    return e[t.getId()] = t, e
                }, {});
                return this._tree = this._preprocessStructure(e, i), this._itemsIndex = this._buildReportIndex(this._tree), this._menuIndex = this._buildMenuItemsIndex(this._tree), this
            }.bind(this))
        },
        _isGroupingItem: function(e) {
            return e && void 0 !== e.items
        },
        _searchTree: function(e, t, i) {
            return i = i || [], e.forEach(function(e) {
                this._isGroupingItem(e) ? this._searchTree(e.items, t, i) : -1 !== e.getName().toLowerCase().indexOf(t) && i.push(e)
            }, this), i
        },
        _buildMenuItemsIndex: function(e, t) {
            return t = t || {}, e.forEach(function(e) {
                this._isGroupingItem(e) && (t[e.id] = e, this._buildMenuItemsIndex(e.items, t))
            }, this), t
        },
        _buildReportIndex: function(e, t, i) {
            return i = i || {}, t = t || [], e.forEach(function(e) {
                this._isGroupingItem(e) ? this._buildReportIndex(e.items, t.concat(e.id), i) : i[e.getId()] = {
                    item: e,
                    prefix: t
                }
            }, this), i
        },
        _flattenStructure: function(e, t) {
            return t = t || [], e.forEach(function(e) {
                this._isGroupingItem(e) ? t.push.apply(t, this._flattenStructure(e.items)) : t.push(e)
            }, this), t
        },
        _preprocessStructure: function(e, t) {
            var i = BN("i-router").getTld();
            return e.filter(function(e) {
                return !(e.availableTlds && -1 === e.availableTlds.indexOf(i))
            }).map(function(e) {
                return this._isGroupingItem(e) ? {
                    id: e.id,
                    name: BEM.I18N("i-report", "menu-" + e.id) || e.id,
                    items: this._preprocessStructure(e.items, t)
                } : t[e]
            }, this).filter(Boolean)
        }
    }, {
        _cache: BN("i-state").initNs("i-report-collection"),
        _menuItemsKeepParams: ["report", "delegation", "data-table", "comparison", "chart", "attribution"],
        get: function() {
            var e = this._cache.get("instance");
            return (!e || e.isRejected()) && (e = BEM.create({
                block: this._name
            })._initModels(), this._cache.set("instance", e)), e
        },
        processReports: function(e, t, i) {
            var n = t.isPublicCounter,
                o = t.isSingle,
                s = t.reportTreePath,
                r = t.currentReportId,
                a = t.isFilter || !1,
                l = t.maxLevel || 999,
                c = jQuery.extend({
                    "report-mode": "auto"
                }, t.linkMods || {}),
                d = [];
            return i = i || 0, e.forEach(function(e) {
                var u, h, m = e instanceof BN("i-report"),
                    p = m && !o && e.onlySingleCounterMode(),
                    f = m ? e.getId() : e.id,
                    g = -1 !== [r, s && s[i]].indexOf(f),
                    _ = m && (!e.isAvailable() || n && !e.isPublicAccessible() || p);
                m ? d.push({
                    id: f,
                    name: e.getName(),
                    js: a ? {
                        filter: e.getName().toLowerCase()
                    } : null,
                    selected: g,
                    disabled: _,
                    nda: e.isNda(),
                    attrs: p ? {
                        title: BEM.I18N("main-menu", "unavailable-in-group-mode")
                    } : null,
                    link: {
                        mods: c,
                        params: {
                            host: e.getReportHost(),
                            path: e.getReportPath(),
                            reportId: e.getId(),
                            keepParams: this._menuItemsKeepParams,
                            params: {
                                metric_filters: ""
                            }
                        },
                        attrs: {
                            target: e.isNewTab() ? "_blank" : void 0
                        }
                    }
                }) : e.items && (u = {
                    id: f,
                    name: e.name
                }, h = this.processReports(e.items, t, i + 1), h.length && (d.push(u), l > i ? (u.selected = g, u.items = h) : (h.push({
                    spacer: !0
                }), Array.prototype.push.apply(d, h))))
            }, this), d
        },
        _structure: ["traffic", "conversion_rate", {
            id: "sources",
            items: ["sources", "sites", "search_engines", "phrases", "social_networks", "marketing", {
                id: "direct",
                items: ["direct_summary", "direct_sites", "sources_direct_clicks"]
            }, "tags_from", "tags_utm", "tags_openstat"]
        }, {
            id: "visitors",
            items: ["geo", "interest", {
                id: "demography",
                items: ["demography_age", "demography_structure"]
            }, {
                id: "deepness",
                items: ["deepness_depth", "deepness_time", "hourly"]
            }, {
                id: "loyalty",
                items: ["loyalty_visits", "loyalty_period", "loyalty_newness", "loyalty_recency"]
            }]
        }, {
            id: "content",
            items: ["popular", "entrance", "exit", "titles", "url_param", "share_services", "links", "downloads", "user_vars", "legacy/ecommerce"]
        }, {
            id: "behaviour",
            items: [{
                id: "webvisor",
                items: ["visor", "form_analysis"]
            }, {
                id: "maps",
                items: ["link_map", "click_map", "scroll_map"]
            }]
        }, {
            id: "tech_specs",
            items: ["browsers", "resolution", "os", "tech_devices", "flash", "silverlight", "java", "cookies", "javascript"]
        }, {
            id: "monitoring",
            items: ["legacy/load", "traffic_by_minute", "bpage_load_time", "monitoring_results", "legacy/robots"]
        }, {
            id: "markedphones",
            availableTlds: ["ru"],
            items: ["markedphones/sources", "markedphones/dn", "markedphones/un", "markedphones/log"]
        }, {
            id: "ecommerce",
            items: ["purchase", "orders_products", "top_brands", "top_products", "basket", "basket_products", "coupon"]
        }, {
            id: "legacy",
            items: ["legacy/traffic", {
                id: "legacy/sources",
                items: ["legacy/sources", "legacy/sites", "legacy/search_engines", "legacy/search_phrases", "legacy/social_networks", "legacy/adv_engines", "legacy/tags"]
            }, {
                id: "legacy/visitors",
                items: ["legacy/regions", "legacy/interest", "legacy/demography", "legacy/depth", "legacy/duration", "legacy/hour"]
            }, {
                id: "legacy/content",
                items: ["legacy/popular", "legacy/entrance", "legacy/exit", "legacy/title", "legacy/url_param", "legacy/share", "legacy/external_links", "legacy/downloads", "legacy/visit_param"]
            }, {
                id: "legacy/tech_specs",
                items: ["legacy/browsers", "legacy/os", "legacy/display", "legacy/mobility", "legacy/mobile", "legacy/flash", "legacy/silverlight", "legacy/java", "legacy/cookies", "legacy/js"]
            }]
        }]
    }), BEM.decl("i-preset-api", null, BEM.blocks["i-proxy"].initProxy("i-preset-api", ["_list*", "save", "create", "remove", "getReportById*"])), BEM.decl("i-preset-api", null, {
        reportTypes: {
            USER: "user",
            PREDEFINED: "predefined"
        },
        list: function() {
            return BN("i-counters").getAsync().then(function(e) {
                return this._list(e.getApiCounterId())
            }.bind(this))
        },
        save: function(e, t) {
            return this.__base(e, t).then(function() {
                BN("i-proxy").cleanCache(this._name, ["_list", "getReportById"])
            }.bind(this))
        },
        create: function(e) {
            return this.__base(e).then(function(e) {
                return BN("i-proxy").cleanCache(this._name, ["_list", "getReportById"]), e
            }.bind(this))
        },
        remove: function(e) {
            return this.__base(e).then(function() {
                BN("i-proxy").cleanCache(this._name, ["_list", "getReportById"])
            }.bind(this))
        }
    }), BEM.DOM.decl("head-administration-menu", {
        onSetMod: {
            js: function() {
                this._popup = this.findBlockInside("dropdown-menu").getPopup(), this.bindTo(this.findElem(this._popup.domElem, "link"), "click", this._onLinkClick)
            }
        },
        _onLinkClick: function() {
            this._popup.hide()
        }
    }), BEM.DOM.decl("header2", {
        onSetMod: {
            js: function() {
                var e = this;
                this.__base.apply(this, arguments), this.findElem("action", "type", "admin-menu").each(function() {
                    var t = jQuery(this);
                    e.findBlockInside(t, "dropdown-menu").on("hide", e._onDropdownHide.bind(e, t))
                })
            }
        },
        _onDropdownHide: function(e) {
            this.delMod(e, "checked")
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "type",
        modVal: "ulogin"
    }, {
        _getNewParams: function() {
            var e = BN("i-router").getParams(),
                t = this.params.ulogin;
            return t ? e.ulogin = t : delete e.ulogin, e
        }
    }), BEM.DOM.decl("footer", {}, {
        _FOOTER_HEIGHT: 38,
        getFooterHeight: function() {
            return this._FOOTER_HEIGHT
        }
    }), BEM.DOM.decl("lang-switcher", {
        _onLangKeyUp: function(e) {
            var t = e.data.domElem;
            this.hasMod(t, "selected", "yes") || !this.findBlockOn("popup").containsDomElem(t) || e.shiftKey || e.ctrlKey || e.altKey || e.metaKey || 32 === e.which && t.click()
        }
    }, {
        live: function() {
            this.liveBindTo("lang", "keyup", function(e) {
                this._onLangKeyUp(e)
            })
        }
    }), BEM.DOM.decl({
        name: "link",
        modName: "pseudo",
        modVal: "yes"
    }, {
        _onClick: function(e) {
            e.preventDefault(), this.hasMod("disabled", "yes") || this.afterCurrentEvent(function() {
                this.trigger("click")
            })
        },
        _onKeyUp: function(e) {
            e.shiftKey || e.ctrlKey || e.altKey || (13 === e.which || 32 === e.which) && (this.hasMod("disabled", "yes") || this.afterCurrentEvent(function() {
                this.trigger("click")
            }))
        }
    }, {
        live: function() {
            this.__base.apply(this, arguments), this.liveBindTo({
                modName: "pseudo",
                modVal: "yes"
            }, "leftclick tap", function(e) {
                this._onClick(e)
            }).liveBindTo({
                modName: "pseudo",
                modVal: "yes"
            }, "keyup", function(e) {
                this._onKeyUp(e)
            })
        }
    }), BEM.JSON.decl({
        name: "smart-link",
        modName: "tune",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.stop()
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "tune",
        modVal: "yes"
    }, {
        _buildTuneUrl: function(e, t) {
            return BN("i-services").getServiceUrl("tune") + "/api/lang/v1.1/save.xml?intl=" + e + "&sk=" + this.params.sk + "&retpath=" + encodeURIComponent(t)
        },
        _onFocus: function() {
            var e = this._buildTuneUrl(this.params.lang, BN("i-router").getUri());
            this.domElem.attr("href", e)
        }
    }), BEM.DOM.decl("mooa", {
        onSetMod: {
            js: function() {
                BEM.blocks["i-debug"].on("debug", this._handleDebugMessage.bind(this)), this._tabBlocks = this.params.tabBlocks.reduce(function(e, t) {
                    return e[t] = this.findBlockInside(t), e
                }.bind(this), {}), this._appendToDebug(BEM.blocks["i-debug"].getLog()), this._minHeight = this.elem("log-body").css("min-height").replace("px", "")
            }
        },
        _appendToDebug: function(e) {
            e instanceof Array || (e = [e]), Object.keys(this._tabBlocks).forEach(function(t) {
                e.forEach(function(e) {
                    this._tabBlocks[t].debugMessage(e.type, e.data)
                }.bind(this))
            }.bind(this))
        },
        _handleDebugMessage: function(e, t) {
            this._appendToDebug(t)
        },
        _switchTab: function(e) {
            var t = this.elemify(e.data.domElem, "tab-title"),
                i = this.elemParams(t);
            Array.prototype.forEach.call(this.elem("tab-title"), function(e) {
                e = this.elemify(e, "tab-title");
                var t = this.elemParams(e),
                    n = this.elemify(this._tabBlocks[t].domElem, "tab-body");
                t === i ? (this.setMod(e, "selected", "yes"), this.setMod(n, "visible", "yes")) : (this.setMod(e, "selected", ""), this.setMod(n, "visible", ""))
            }.bind(this))
        },
        _clear: function() {
            BEM.blocks["i-debug"].clear(), Object.keys(this._tabBlocks).forEach(function(e) {
                this._tabBlocks[e].clear()
            }.bind(this))
        }
    }, {
        live: function() {
            this.liveBindTo("close", "click", function() {
                this.setMod("visible", "no")
            }), this.liveBindTo("opener", "click", function() {
                this.toggleMod("visible", "yes", "no", this.hasMod("visible", "no"))
            }), this.liveBindTo("clear", "click", function() {
                this._clear()
            }), this.liveBindTo("tab-title", "leftclick", function(e) {
                this._switchTab(e)
            })
        },
        getHosts: function() {
            return BN("i-global").get("mooa.hosts") || {}
        }
    }), BEM.JSON.decl("mooa-api-request", {
        onBlock: function(e) {
            e.content([{
                block: "mooa-api-request-summary"
            }, {
                elem: "request-list"
            }])
        },
        onElem: {
            "tab-title": function(e) {
                e.content(BEM.I18N("mooa-api-request", "title"))
            }
        }
    }), BEM.DOM.decl("mooa-api-request", {
        onSetMod: {
            js: function() {
                this._summaries = {
                    count: 0,
                    fail: 0,
                    success: 0,
                    time: 0,
                    apiCpuTime: 0,
                    apiDbTime: 0,
                    apiTime: 0,
                    layers: []
                }
            }
        },
        debugMessage: function(e, t) {
            "api-request" === e && (this._updateSummary(t), BEM.DOM.append(this.elem("request-list"), BEM.blocks["i-content"].html({
                block: "mooa-api-request-request",
                info: t
            }, !0)))
        },
        clear: function() {
            BEM.DOM.update(this.findElem("request-list"), ""), Object.keys(this._summaries).forEach(function(e) {
                this._summaries[e] = 0
            }.bind(this)), this._summaries.layers = [], this._redrawSummaries()
        },
        _redrawSummaries: function() {
            this.findBlockInside("mooa-api-request-summary").update(this._summaries)
        },
        _updateSummary: function(e) {
            this._summaries.count++, e.success ? this._summaries.success++ : this._summaries.fail++, this._summaries.time += e.time, e.profile && (this._summaries.apiCpuTime += e.profile.javaTime || e.profile.java_time || 0, this._summaries.apiTime += e.profile.totalTime || e.profile.total_time || 0, this._summaries.apiDbTime += (e.profile.queries || []).reduce(function(e, t) {
                return e + t.time
            }, 0), e.profile.additional && e.profile.additional.layer && this._summaries.layers.push(e.profile.additional.layer)), this._summaries.layers = BN("i-util").arrayUnique(this._summaries.layers), this._redrawSummaries()
        }
    }), BEM.JSON.decl("mooa-api-request-summary", {
        onBlock: function(e) {
            var t = e.param("summaries") || {};
            e.content([{
                content: "Summary"
            }, {
                elem: "full-count",
                count: t.count
            }, {
                elem: "success-count",
                count: t.success
            }, {
                elem: "error-count",
                count: t.fail
            }, {
                elem: "full-time",
                time: t.time
            }, {
                elem: "server-side-time",
                time: t.apiTime
            }, {
                elem: "cpu-time",
                time: t.apiCpuTime
            }, {
                elem: "db-time",
                time: t.apiDbTime
            }, {
                elem: "layers",
                layers: t.layers || []
            }])
        },
        onElem: {
            "full-count": function(e) {
                e.content("Request Number:&nbsp;" + (e.param("count") || 0))
            },
            "success-count": function(e) {
                e.content("Succeeded Requestis:&nbsp;" + (e.param("count") || 0))
            },
            "error-count": function(e) {
                e.content("Failed Requests:&nbsp;" + (e.param("count") || 0))
            },
            "full-time": function(e) {
                e.content("Sum Request time:&nbsp;" + (e.param("time") || 0) + "(ms)")
            },
            "server-side-time": function(e) {
                e.content("Sum time on backend:&nbsp;" + (e.param("time") || 0) + "(ms)")
            },
            "cpu-time": function(e) {
                e.content("Sum cpu time on backend:&nbsp;" + (e.param("time") || 0) + "(ms)")
            },
            "db-time": function(e) {
                e.content("Sum time in database queries:&nbsp;" + (e.param("time") || 0) + "(ms)")
            },
            layers: function(e) {
                e.content("Used layers:&nbsp;" + e.param("layers").join(","))
            }
        }
    }), BEM.DOM.decl("mooa-api-request-summary", {
        update: function(e) {
            BEM.DOM.replace(this.domElem, BEM.blocks["i-content"].html({
                block: "mooa-api-request-summary",
                summaries: e
            }, !0))
        }
    }), BEM.JSON.decl("mooa-api-request-request", {
        onBlock: function(e) {
            var t = e.param("info");
            e.js(!0).mods({
                closed: "yes"
            }).content([{
                elem: "header",
                info: t,
                mods: {
                    status: t.success ? "success" : "error"
                }
            }, {
                elem: "info",
                info: t
            }])
        },
        onElem: {
            header: function(e) {
                var t = e.param("info");
                e.content([{
                    block: "icon",
                    elem: "arrow",
                    mix: [{
                        block: "mooa-api-request-request",
                        elem: "opener"
                    }, {
                        block: "icon",
                        mods: {
                            direction: "right"
                        }
                    }]
                }, this.toTimeElem(t.time), " ", {
                    elem: "method",
                    method: t.method
                }, " ", {
                    elem: "url",
                    url: t.url
                }])
            },
            method: function(e) {
                e.tag("span").content(e.param("method"))
            },
            url: function(e) {
                var t = e.param("url");
                e.tag("span").attrs({
                    title: t
                }).content(BEM.blocks["i-string"].escapeHTML(t))
            },
            info: function(e) {
                var t = e.param("info"),
                    i = [];
                i.push([{
                    elem: "open-new-tab",
                    info: t
                }, {
                    elem: "info-time",
                    info: t
                }, {
                    elem: "info-full-url",
                    tag: "textarea",
                    content: BN("i-string").escapeHTML(t.url)
                }, {
                    elem: "info-db-queries",
                    info: t
                }]), t.success || i.push(" ", {
                    elem: "error-info",
                    info: t
                }), e.content(i)
            },
            "open-new-tab": function(e) {
                e.content({
                    block: "link",
                    attrs: {
                        target: "_blank"
                    },
                    url: e.param("info").url,
                    content: BEM.I18N("mooa-api-request-request", "open-new-tab")
                })
            },
            "info-time": function(e) {
                var t = e.param("info"),
                    i = t.profile && (t.profile.javaTime || t.profile.java_time) || 0,
                    n = t.profile && (t.profile.totalTime || t.profile.total_time) || 0,
                    o = t.profile && t.profile.additional && t.profile.additional.layer,
                    s = t.profile && (t.profile.queries || []).reduce(function(e, t) {
                        return e + t.time
                    }, 0) || 0,
                    r = [this.toTimeElem(t.time, "Full time"), this.toTimeElem(n, "Server side time"), this.toTimeElem(i, "Cpu time"), this.toTimeElem(s, "Database time")],
                    a = t.success ? "success" : "error";
                o && r.push("Layer: " + o), e.tag("span").content([{
                    elem: "info-status",
                    tag: "span",
                    mods: {
                        status: a
                    },
                    content: a
                }, r.join(" ")])
            },
            "info-db-queries": function(e) {
                var t = e.param("info"),
                    i = t.profile && t.profile.queries;
                return i && i.length ? void e.content([{
                    elem: "queries-title",
                    content: "Queries"
                }].concat(i.map(function(e) {
                    return {
                        block: "mooa-api-request-query",
                        query: e
                    }
                }))) : e.remove()
            },
            "error-info": function(e) {
                var t = e.param("info");
                e.mix([{
                    elem: "message-box"
                }]).content(t.error && BN("i-content").escapeHTML(JSON.stringify(t.error, null, 4)))
            }
        },
        toTimeElem: function(e, t) {
            return '<span class="mooa-api-request-request__time">' + (t ? t + ": " : "") + e + "ms</span>"
        }
    }), BEM.DOM.decl("mooa-api-request-request", {
        onSetMod: {
            closed: function(e, t) {
                var i = "yes" === t ? "right" : "down";
                this.findBlockInside("opener", "icon").setMod("direction", i)
            }
        }
    }, {
        live: function() {
            this.liveBindTo("header", "click", function() {
                this.toggleMod("closed", "yes")
            })
        }
    }), BEM.JSON.decl("mooa-api-request-query", {
        onBlock: function(e) {
            var t = e.param("query");
            e.content([{
                elem: "header",
                database: t.database,
                host: t.host,
                time: t.time,
                mods: {
                    status: t.error ? "error" : "success"
                },
                query: t.query
            }, {
                elem: "query",
                query: t
            }, {
                elem: "error",
                error: t.error
            }])
        },
        onElem: {
            "header-database": function(e) {
                var t = e.param("database"),
                    i = e.param("host");
                e.tag("span").content(t + (i ? "@" + i : ""))
            },
            "header-time": function(e) {
                e.content(e.param("time") + "ms")
            },
            header: function(e) {
                var t = e.param("database"),
                    i = e.param("host"),
                    n = e.param("time"),
                    o = e.param("query");
                e.content([{
                    elem: "header-time",
                    tag: "span",
                    time: n
                }, {
                    elem: "header-database",
                    database: t,
                    host: i
                }, {
                    elem: "header-query",
                    tag: "span",
                    content: BN("i-content").escapeHTML(o)
                }])
            },
            query: function(e) {
                var t = e.param("query"),
                    i = t.query_beautified ? t.query_beautified.join("\n") : t.query;
                e.tag("pre").content(BN("i-content").escapeHTML(i))
            },
            error: function(e) {
                var t = e.param("error");
                t ? e.content([{
                    elem: "error-head",
                    content: "Error:"
                }, {
                    elem: "error-body",
                    tag: "textarea",
                    content: BN("i-content").escapeHTML(t)
                }]) : e.remove()
            }
        }
    }), BEM.JSON.decl("mooa-mongo-request", {
        onBlock: function(e) {
            e.content([{
                elem: "request-list"
            }])
        },
        onElem: {
            "tab-title": function(e) {
                e.content(BEM.I18N("mooa-mongo-request", "title"))
            }
        }
    }), BEM.DOM.decl("mooa-mongo-request", {
        debugMessage: function(e, t) {
            "mongo-request" === e && BEM.DOM.append(this.elem("request-list"), BN("i-content").html({
                block: "mooa-api-request-request",
                mods: {
                    type: "mongo"
                },
                info: t
            }, !0))
        },
        clear: function() {
            BEM.DOM.update(this.findElem("request-list"), "")
        }
    }), BEM.JSON.decl({
        name: "mooa-api-request-request",
        modName: "type",
        modVal: "mongo"
    }, {
        onElem: {
            header: function(e) {
                var t = e.param("info");
                e.content([{
                    block: "icon",
                    elem: "arrow",
                    mix: [{
                        block: "mooa-api-request-request",
                        elem: "opener"
                    }, {
                        block: "icon",
                        mods: {
                            direction: "right"
                        }
                    }]
                }, {
                    elem: "time",
                    time: t.time
                }, "collection&nbsp;-&nbsp;", {
                    elem: "collection",
                    tag: "span",
                    content: t.collection
                }, "&nbsp;host&nbsp;-&nbsp;", {
                    elem: "host",
                    tag: "span",
                    content: t.host
                }])
            },
            info: function(e) {
                var t = e.param("info"),
                    i = [],
                    n = "db." + t.collection + t.profile;
                i.push([{
                    elem: "info-status",
                    tag: "span",
                    mods: {
                        status: t.success ? "success" : "error"
                    }
                }, {
                    elem: "info-time",
                    info: t
                }, {
                    elem: "parameters",
                    content: [BEM.I18N("mooa-api-request-request", "parameters"), {
                        elem: "message-box",
                        content: BN("i-content").escapeHTML(n)
                    }]
                }]), t.success === !1 && i.push({
                    elem: "error-info",
                    info: t
                }), e.content(i)
            }
        }
    }), BEM.JSON.decl("mooa-popular-counters", {
        _counters: [{
            name: "metrika",
            site: "metrika.yandex.ru",
            counterId: "101500"
        }, {
            name: "metrika2",
            site: "beta.metrika.yandex.ru",
            counterId: "24226447"
        }, {
            name: "appmetrika",
            site: "appmetrika.yandex.ru",
            counterId: "22430419"
        }, {
            name: "yandex",
            site: "yandex.ru",
            counterId: "722545"
        }, {
            name: "yandex-search",
            site: "yandex.ru",
            counterId: "731962"
        }, {
            name: "yandex-tr",
            site: "yandex.com.tr",
            counterId: "9927757"
        }, {
            name: "direct",
            site: "direct.yandex.ru",
            counterId: "34"
        }, {
            name: "pogoda",
            site: "pogoda.yandex.ru",
            counterId: "115080"
        }, {
            name: "fotki",
            site: "fotki.yandex.ru",
            counterId: "149814"
        }, {
            name: "market",
            site: "market.yandex.ru",
            counterId: "160656"
        }, {
            name: "lenta",
            site: "lenta.ru",
            counterId: "4308403"
        }, {
            name: "mail",
            site: "mail.yandex.ru",
            counterId: "1143050"
        }, {
            name: "sendflowers",
            site: "sendflowers.ru",
            counterId: "101024"
        }, {
            name: "shatura",
            site: "shatura.com",
            counterId: "501087"
        }, {
            name: "genvik",
            site: "genvik.ru",
            counterId: "21714361"
        }, {
            name: "wikimart",
            site: "wikimart.ru",
            counterId: "1310521"
        }, {
            name: "democrat",
            site: "democrat-sbp.ru",
            counterId: "176877"
        }, {
            name: "watch",
            site: "mc.yandex.ru",
            counterId: "26302566"
        }, {
            name: "notik.ru",
            site: "notik.ru",
            counterId: "37138"
        }],
        onBlock: function(e) {
            e.content({
                elem: "list",
                report: e.param("report")
            })
        },
        onElem: {
            "tab-title": function(e) {
                e.content(BEM.I18N("mooa-popular-counters", "title"))
            },
            list: function(e) {
                var t = e.param("report");
                e.tag("ul").content(this._counters.map(function(e) {
                    return {
                        elem: "list-item",
                        counter: e,
                        report: t
                    }
                }))
            },
            "list-item": function(e) {
                var t, i = e.param("counter"),
                    n = e.param("report");
                t = n ? {
                    block: "smart-link",
                    mix: [{
                        block: "mooa-popular-counters",
                        elem: "link"
                    }],
                    js: {
                        params: {
                            id: i.counterId,
                            gid: null,
                            filter: "",
                            filter_id: "",
                            goal: ""
                        },
                        keepAllParams: !0
                    }
                } : {
                    block: "link",
                    mix: {
                        block: "mooa-popular-counters",
                        elem: "link"
                    },
                    url: "/dashboard?id=" + encodeURIComponent(i.counterId)
                }, t.content = [{
                    block: "icon",
                    mods: {
                        type: "favicon"
                    },
                    mix: [{
                        block: "selection-disabler"
                    }, {
                        block: "mooa-popular-counters",
                        elem: "favicon"
                    }],
                    domain: i.site
                }, BN("i-string").escapeHTML(BEM.I18N("mooa-popular-counters", i.name))], e.tag("li").content([t, " ", {
                    elem: "counter_id",
                    tag: "span",
                    content: BN("i-string").escapeHTML(i.counterId)
                }])
            }
        }
    }), BEM.JSON.decl("mooa-popular-counters", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().always(function(t) {
                e.params().report = t.isFulfilled() ? t.valueOf() : null
            }))
        }
    }), BEM.DOM.decl("mooa-popular-counters", {
        debugMessage: function() {},
        clear: function() {}
    }), BN.addDecl("mooa-panel").instanceProp({
        _onBetaChange: function() {
            var e = this.findBlockOn(this.elem("dev-host-input"), "input"),
                t = jQuery.trim(e.val()),
                i = BN("mooa").getHosts().devHost;
            t && i && (window.location.href = "https://" + t + "." + i + BN("i-router").getTld() + BN("i-router").getPath())
        }
    }).staticProp({
        live: function() {
            this.liveBindTo("dev-host-button", "click", function() {
                this._onBetaChange()
            }).liveBindTo("dev-host-input", "keyup", function(e) {
                13 === e.keyCode && this._onBetaChange()
            })
        }
    }), BEM.DOM.decl("browser-warning", {
        onSetMod: {
            js: function() {
                this.elem("close-icon").on("click", function() {
                    this.setMod("closed", "yes")
                }.bind(this))
            }
        }
    }), BEM.JSON.decl({
        name: "link",
        modName: "external",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            var t = String(e.param("url"));
            /^(https?:)?\/?\//.test(t) || (t = "http://" + t), BN("i-ip").isInternalIp() && (t = "https://h.yandex-team.ru/?" + encodeURIComponent(t)), e.params().url = t
        }
    }), BEM.decl("metrika-counter", null, {
        COUNTER_ID: null
    }), BEM.decl("metrika-counter", null, {
        COUNTER_ID: 24226447
    }),
    function(e, t) {
        var i = [];
        BEM.decl("metrika-counter", null, ["id", "userParams", "params", "trackLinks", "reachGoal", "notBounce", "replacePhones", "hit", "file", "extLink", "enableAll", "clickmap", "addFileExtension"].reduce(function(e, t) {
                return e[t] = function() {
                    return this._invoke(t, arguments)
                }, e
            }, {
                _invoke: function() {
                    i.push(arguments)
                }
            })),
            function n() {
                var o, s = BEM.blocks["metrika-counter"].COUNTER_ID,
                    r = window["yaCounter" + s];
                r || (e[t] = e[t] || []).push(function() {
                    setTimeout(n)
                }), o = BEM.decl("metrika-counter", null, {
                    _invoke: function(e, t) {
                        if (r) try {
                            r[e].apply(r, t)
                        } catch (i) {
                            console.error(i)
                        }
                    }
                }), i.forEach(function(e) {
                    o._invoke.apply(o, e)
                })
            }(BEM.blocks["metrika-counter"].COUNTER_ID)
    }(window, "yandex_metrika_callbacks"), BEM.decl("i-counter-code", null, {
        PREVIEW_URL: "https://informer.yandex.ru/informer/1/",
        _syncTemplate: ["<!-- Yandex.Metrika counter -->", '<script src="https://mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>', '<script type="text/javascript">', "try {", "    var yaCounter##id## = new Ya.Metrika({", "##params##", "    });", "} catch(e) { }", "</script>", '<noscript><div><img src="https://mc.yandex.ru/watch/##id####ut##" style="position:absolute; left:-9999px;" alt="" /></div></noscript>', "<!-- /Yandex.Metrika counter -->"].join("\n"),
        _asyncTemplate: ["<!-- Yandex.Metrika counter -->", '<script type="text/javascript">', "    (function (d, w, c) {", "        (w[c] = w[c] || []).push(function() {", "            try {", "                w.yaCounter##id## = new Ya.Metrika({", "##params##", "                });", "            } catch(e) { }", "        });", "", '        var n = d.getElementsByTagName("script")[0],', '            s = d.createElement("script"),', "            f = function () { n.parentNode.insertBefore(s, n); };", '        s.type = "text/javascript";', "        s.async = true;", '        s.src = "https://mc.yandex.ru/metrika/watch.js";', "", '        if (w.opera == "[object Opera]") {', '            d.addEventListener("DOMContentLoaded", f, false);', "        } else { f(); }", '    })(document, window, "yandex_metrika_callbacks");', "</script>", '<noscript><div><img src="https://mc.yandex.ru/watch/##id####ut##" style="position:absolute; left:-9999px;" alt="" /></div></noscript>', "<!-- /Yandex.Metrika counter -->"].join("\n"),
        _informerTemplate: ["<!-- Yandex.Metrika informer -->", '<a href="https://metrika.yandex.##tld##/stat/?id=##id##&amp;from=informer"', 'target="_blank" rel="nofollow"><img src="https://informer.yandex.ru/informer/##id##/##lastUrlPart##"', 'style="width:##width##px; height:##height##px; border:0;" alt="##alt##" title="##alt##: ##title##"##extInformerPart## /></a>', "<!-- /Yandex.Metrika informer -->"].join("\n"),
        _extInformer: " onclick=\"try{Ya.Metrika.informer({i:this,id:##id##,lang:'##lang##'});return false}catch(e){}\"",
        _params: [{
            name: "visor",
            codeName: "webvisor",
            value: !0
        }, {
            name: "track_hash",
            codeName: "trackHash",
            value: !0
        }, {
            name: "ut",
            codeName: "ut",
            value: "noindex"
        }, {
            name: "ecommerce",
            codeName: "ecommerce",
            valueProperty: "ecommerce_object",
            defaultValue: "dataLayer"
        }],
        _sizeToObject: {
            3: {
                width: 88,
                height: 31
            },
            2: {
                width: 80,
                height: 31
            },
            1: {
                width: 80,
                height: 15
            }
        },
        generateCode: function(e, t) {
            var i = this._getTemplate(t.async),
                n = this._getSpaces(t.async),
                o = [n + "id:" + e, n + "clickmap:true", n + "trackLinks:true", n + "accurateTrackBounce:true"];
            return t.informer = t.informer || {}, this._params.forEach(function(e) {
                var i = e.value,
                    s = e.defaultValue;
                if (t[e.name]) {
                    e.valueProperty && (i = t[e.valueProperty]), !i && s && (i = s);
                    try {
                        i = JSON.stringify(i)
                    } catch (r) {
                        i = JSON.stringify(null)
                    }
                    o.push(n + e.codeName + ":" + i)
                }
            }, this), i = i.replace(/##id##/g, e), i = i.replace(/##params##/g, o.join(",\n")), t.xml_site && (i = i.replace(/<noscript>(.*)<\/noscript>(\r\n|\n|\r)/g, "")), t.informer.enabled && (i = this.generateInformerCode(e, t.informer) + "\n\n" + i), t.in_one_line && (i = i.replace(/\s{2,}/g, " ").replace(/(\r\n|\n|\r)/gm, " ")), i = i.replace(/##ut##/g, this._getUTString(t.ut))
        },
        generateInformerCode: function(e, t) {
            var i = this._sizeToObject[t.size],
                n = this._informerTemplate.replace(/##width##/g, i.width).replace(/##height##/g, i.height).replace(/##id##/g, e).replace(/##tld##/g, BEM.blocks["i-router"].getTld()).replace(/##alt##/g, BEM.I18N("i-counter-code", "alt")).replace(/##lastUrlPart##/g, this._getLastPart(t)).replace(/##extInformerPart##/g, this._getExtInformerType(e, t));
            return n = 3 === t.size ? n.replace("##title##", BEM.I18N("i-counter-code", "title-all")) : n.replace("##title##", BEM.I18N("i-counter-code", "title-" + t.indicator))
        },
        generatePreviewUrl: function(e) {
            return this.PREVIEW_URL + this._getLastPart(e)
        },
        _getExtInformerType: function(e, t) {
            return "ext" === t.type ? this._extInformer.replace("##id##", e).replace("##lang##", this._getInformerLang()) : ""
        },
        _getLastPart: function(e) {
            return [e.size, e.color_arrow, e.color_start, e.color_end, e.color_text, e.indicator].join("_")
        },
        _getTemplate: function(e) {
            return e ? this._asyncTemplate : this._syncTemplate
        },
        _getSpaces: function(e) {
            return new Array(e ? 21 : 9).join(" ")
        },
        _getUTString: function(e) {
            return e ? "?ut=noindex" : ""
        },
        _getInformerLang: function() {
            var e = BEM.blocks["i-locale"].getLang();
            return {
                uk: "ua"
            }[e] || e
        }
    }), BEM.DOM.decl("paranja", {
        onSetMod: {
            js: function() {
                var e = this;
                $(e.params.rel).each(function() {
                    $(this.elem || e.domElem).on(this.event, e[this.method].bind(e))
                }), this.bindTo("leftclick tap", function() {
                    this.trigger("click")
                })
            },
            state: {
                open: function() {
                    this.trigger("open")
                },
                close: function() {
                    this.trigger("close")
                }
            }
        },
        open: function() {
            this.setMod("state", "open")
        },
        close: function() {
            this.setMod("state", "close")
        }
    }, {
        live: !1
    }), BEM.JSON.decl("main-menu", {
        onBlock: function(e) {
            e.js(!0)
        }
    }), BEM.JSON.decl("main-menu", {
        onElem: {
            renderer: function(e) {
                e.wrap([{
                    elem: "toggle"
                }, {
                    elem: "list"
                }])
            },
            toggle: function(e) {
                e.content([{
                    elem: "toggle-icon",
                    content: {
                        block: "icon",
                        elem: "arrow",
                        mods: {
                            type: "white"
                        }
                    }
                }, {
                    elem: "toggle-text",
                    content: BEM.I18N("main-menu", "toggle")
                }])
            },
            list: function(e) {
                var t = BN("main-menu").MENU_CONFIG,
                    i = e.params();
                e.content(Object.keys(t).map(function(e) {
                    return {
                        elem: "item",
                        type: e,
                        itemConfig: t[e],
                        userLogined: i.userLogined,
                        isSingle: i.isSingle,
                        isPublicCounter: i.isPublicCounter,
                        isGlobalCounter: i.isGlobalCounter
                    }
                }))
            },
            item: function(e) {
                var t = e.params(),
                    i = t.itemConfig,
                    n = i.onlySingleCounterMode,
                    o = i.publicallyInaccessible,
                    s = i.disabled || i.requireUser && !t.userLogined,
                    r = n && !t.isSingle,
                    a = o && t.isPublicCounter,
                    l = t.isGlobalCounter && t.itemConfig.disallowGlobal,
                    c = i.additionalBemJson || [],
                    d = t.type,
                    u = Boolean(i.gui),
                    h = BEM.I18N("main-menu", "root-item-" + d);
                u && e.js({
                    gui: i.gui
                }), e.mods({
                    type: d,
                    visible: s || r || a || l ? "no" : "yes",
                    single: s || !n ? "no" : "yes",
                    "public-restrict": s || !o ? "no" : "yes",
                    prerender: i.prerender ? "yes" : ""
                }).content(c.concat([{
                    elem: "item-icon",
                    content: {
                        block: "icon",
                        elem: i.icon
                    }
                }, u ? {
                    elem: "item-text",
                    text: h
                } : {
                    elem: "item-link",
                    text: h,
                    linkParams: i.link
                }]))
            },
            "item-text": function(e) {
                e.content(e.param("text"))
            },
            "item-link": function(e) {
                var t = e.param("linkParams");
                e.wrap([{
                    block: "smart-link",
                    mods: t.mods,
                    mix: [{
                        block: "main-menu",
                        elem: "item-text"
                    }],
                    js: t.js,
                    content: e.param("text")
                }])
            }
        }
    }), BEM.DOM.decl("main-menu", {
        _storage: BEM.create("i-storage", {
            key: "blocks:common:main-menu:main-menu_view"
        }),
        dataBindings: {
            counter: {
                set: "_onCounterChange"
            }
        },
        onSetMod: {
            js: function() {
                var e = this._storage.get(),
                    t = BN("i-content").update(this.domElem, {
                        block: "main-menu",
                        elem: "items-wrap",
                        content: [{
                            block: "main-menu",
                            elem: "renderer"
                        }]
                    });
                e = -1 !== ["basic", "compact"].indexOf(e) ? e : "basic", this.setMod("view", e), BN("metrika-counter").params("side-menu-state", "compact" === e ? "collapsed" : "expanded"), t.then(this._afterDrawInit.bind(this)).done(), this._onCounterChange = t.then.bind(t, this._onCounterChange.bind(this))
            }
        },
        destruct: function() {
            this.elem("list").un("click", this.buildSelector("item"), this._onRootClick), BN("b-page").un("heightChange", this._updateItemsWrapHeight, this), BN("i-router").un("update", this._onLocationChange, this), this.__base.apply(this, arguments)
        },
        _afterDrawInit: function() {
            this._itemsWrap = this.elem("items-wrap"), this._currentGui = null, this._currentLocation = null, this._doPrerender(), this._updateMenuDisplay(), this._onToggle = jQuery.debounce(this._onToggle, 50, this), this._onRootClick = jQuery.debounce(this._onRootClick, 50, this), this._doBindings(), this._onLocationChange(), this._selectCurrentItem()
        },
        _doPrerender: function() {
            var e = this.elem("item", "prerender", "yes").toArray();
            e.forEach(function(e) {
                var t = this.elemParams(jQuery(e)).gui;
                BN("i-content").html(t).done()
            }, this)
        },
        _doBindings: function() {
            this.bindTo("toggle", "click", this._onToggle), this.elem("list").on("click", this.buildSelector("item"), this._onRootClick), this.bindToWin("scroll", jQuery.throttle(this._updateMenuDisplay, 100, this), this), this.bindToWin("resize", jQuery.debounce(this._updateItemsWrapHeight, 150, this), this), BN("b-page").on("heightChange", this._updateItemsWrapHeight, this), BN("i-router").on("update", this._onLocationChange, this)
        },
        _onCounterChange: function() {
            BN("i-counters").getAsync().then(function(e) {
                var t = this.buildSelector("item", "single", "yes") + "," + this.buildSelector("item", "public-restrict", "yes"),
                    i = jQuery(t),
                    n = [e.isGroup(), e.isPublic()];
                Array.prototype.forEach.call(i, function(e) {
                    var t = [this.hasMod(jQuery(e), "single"), this.hasMod(jQuery(e), "public-restrict")],
                        i = t.some(function(e, t) {
                            return e && e === n[t]
                        });
                    this.toggleMod(jQuery(e), "visible", "no", "yes", i)
                }, this)
            }.bind(this)).done()
        },
        _onToggle: function() {
            var e = this.hasMod("view", "basic") ? "compact" : "basic";
            this.setMod("view", e), BN("metrika-counter").params("side-menu-state", "compact" === e ? "collapsed" : "expanded"), this._storage.set(e), setTimeout(this.trigger.bind(this, "toggle", e), 200)
        },
        _onRootClick: function(e) {
            var t, i = this.elemify(e.currentTarget);
            this.hasMod(i, "disabled", "yes") || (this.hasMod(i, "selected", "yes") ? (this._hideSection(), this._selectCurrentItem()) : (t = this.elemParams(i).gui, t && this._showSection(t), this._updateItemsSelection(i), BN("metrika-counter").params("side-menu-open", this.getMod(i, "type"))))
        },
        _showSection: function(e) {
            BN("i-content").html(e).then(function(t) {
                var i = jQuery(t).bem(e.block),
                    n = i.getView();
                i.on("deselect", function() {
                    var e = this._currentGui === i;
                    (!n || e) && (this.trigger("close"), this._selectCurrentItem())
                }, this), n && (this._itemsWrap.append(n), this.trigger("open")), i.select(), this._currentGui = i
            }.bind(this)).done()
        },
        _hideSection: function() {
            this._currentGui && this._currentGui.deselect()
        },
        _selectCurrentItem: function() {
            this._updateItemsSelection(this.elem("item", "current", "yes"), "initial")
        },
        _updateItemsSelection: function(e, t) {
            this.delMod(this.elem("item"), "selected"), e && (t = t || "yes", this.setMod(e, "selected", t))
        },
        _onLocationChange: function() {
            var e, t = window.location.pathname,
                i = BN("main-menu").MENU_CONFIG;
            this._currentLocation !== t && (Object.keys(i).some(function(n) {
                var o = i[n].match;
                return o && t.match(o) ? (e = n, !0) : void 0
            }), e && (this.delMod(this.elem("item"), "current"), this.setMod(this.elem("item", "type", e), "current", "yes")), this._currentLocation = t)
        },
        _updateMenuDisplay: function() {
            var e = BEM.DOM.win,
                t = e.scrollTop(),
                i = this.domElem,
                n = i.offset().top < t ? "yes" : "",
                o = this._itemsWrap;
            this.setMod(o, "fixed", n), "yes" === n && o.css("left", -e.scrollLeft()), this._updateItemsWrapHeight()
        },
        _updateItemsWrapHeight: function() {
            var e, t, i, n = BEM.DOM.win,
                o = n.height(),
                s = n.scrollTop(),
                r = BEM.DOM.doc.height() - BN("footer").getFooterHeight();
            this._selfOffset = this._selfOffset || this.domElem.offset().top, e = o + s - r, e = e > 0 ? e : 0, t = this._selfOffset - s, t = t > 0 ? t : 0, i = this.hasMod(this.elem("items-wrap"), "fixed") ? {
                bottom: e,
                height: ""
            } : {
                bottom: "",
                height: o - t - e
            }, this._itemsWrap.css(i)
        }
    }, {
        MENU_CONFIG: {
            dashboard: {
                icon: "speedometer",
                match: /^\/dashboard/,
                link: {
                    js: {
                        path: "/dashboard",
                        keepParams: ["delegation", "counter", "period"]
                    }
                },
                additionalBemJson: [{
                    block: "advice",
                    mods: {
                        orient: "right-inner"
                    },
                    type: "dashboard",
                    index: 1
                }],
                disallowGlobal: !0
            },
            reports: {
                icon: "bar-chart2",
                match: /^\/stat\/(?!visor)|markedphones|legacy/,
                gui: {
                    block: "main-menu-finder",
                    mods: {
                        data: "reports",
                        filter: "yes"
                    },
                    mix: [{
                        block: "main-menu",
                        elem: "finder"
                    }]
                },
                prerender: !0
            },
            maps: {
                icon: "window",
                onlySingleCounterMode: !0,
                gui: {
                    block: "main-menu-finder",
                    mods: {
                        data: "selected-reports"
                    },
                    ids: ["link_map", "click_map", "scroll_map", "form_analysis"],
                    linkMods: {
                        tld: "yes"
                    },
                    mix: [{
                        block: "main-menu",
                        elem: "finder"
                    }]
                },
                disallowGlobal: !0
            },
            webvisor: {
                icon: "play2",
                match: /^\/stat\/visor/,
                onlySingleCounterMode: !0,
                link: {
                    mods: {
                        type: "report"
                    },
                    js: {
                        reportId: "visor",
                        keepParams: ["delegation", "counter", "period", "filters", "goal", "accuracy", "attribution"]
                    }
                },
                requireUser: !0,
                disallowGlobal: !0,
                publicallyInaccessible: !0,
                prerender: !0
            },
            settings: {
                icon: "gear",
                match: /^\/\d+\?/,
                onlySingleCounterMode: !0,
                link: {
                    mods: {
                        type: "counter"
                    },
                    js: {
                        keepParams: ["delegation"]
                    }
                },
                requireUser: !0,
                disallowGlobal: !0,
                publicallyInaccessible: !0
            }
        }
    }), BEM.JSON.decl("main-menu", {
        onElem: {
            list: function(e) {
                var t = e.params();
                e.defer(Vow.allResolved([BN("i-user").uid(), BN("i-counters").getAsync()]).spread(function(e, i) {
                    var n;
                    return i.isRejected() ? i : (n = i.valueOf(), t.userLogined = e.isFulfilled(), t.isSingle = n.isSingle(), t.isPublicCounter = n.isPublic(), void(t.isGlobalCounter = n.isGlobal()))
                }))
            }
        }
    }), BEM.JSON.decl("advice", {
        onBlock: function(e) {
            var t = e.params();
            e.remove(), e.js({
                type: t.type
            }).mix([{
                block: "i-font",
                mods: {
                    face: "textbook"
                }
            }]).content({
                elem: "inner",
                content: t.index
            })
        }
    }), BEM.DOM.decl("advice", {
        _showControl: null,
        onSetMod: {
            js: function() {
                var e = this;
                BN("i-advices-api").get().then(function(t) {
                    var i = t.advices || {};
                    e._showControl = t.hasUid, i[e.params.type] === !1 ? e.destruct() : (e.bindTo("inner", "click", e._onClick), e.setMod("visible", "yes"))
                }).done()
            }
        },
        _onClick: function(e) {
            var t, i = this;
            this.hasMod("disabled", "yes") || (e.stopPropagation(), t = this.hasMod("opened", "yes") ? this._hide() : this._open(), t.then(function(e) {
                return e === i.__self.DESTRUCT ? (i.setMod("disabled", "yes"), BN("i-advices-api").save(i.params.type, !1).then(function() {
                    i.destruct()
                })) : void 0
            }).always(function() {
                i._isDestructing || (i.delMod("opened"), i.delMod("disabled"))
            }).done())
        },
        _open: function() {
            return this.setMod("opened", "yes"), this.__self.show(this.params.type, this._showControl, this.elem("inner"))
        },
        _hide: function() {
            return this.__self.hide()
        }
    }, {
        DESTRUCT: "destruct",
        _popup: null,
        _promise: Vow.promise(),
        show: function(e, t, i) {
            var n = BN("i-content").html(this._getContentBEMJSON(e, t), !0),
                o = this._getPopup();
            return o.hide(), o.setContent(n).show(i), this._promise = Vow.promise(), this._promise
        },
        hide: function() {
            return this._getPopup().hide(), this._promise
        },
        _getPopup: function() {
            var e = this;
            return this._popup || (this._popup = jQuery(BN("i-content").html(this._getPopupBEMJSON(), !0)).bem("popup"), BN("button").on(this._popup.findElem("content"), "click", function() {
                e._promise.fulfill(e.DESTRUCT), e._popup.hide()
            }), this._popup.on("hide", function() {
                e._promise.fulfill("")
            })), this._popup
        },
        _getPopupBEMJSON: function() {
            return {
                block: "popup",
                mix: [{
                    block: "advice",
                    elem: "popup"
                }],
                mods: {
                    adaptive: "yes"
                },
                js: {
                    directions: ["bottom", "bottom-left", "top", "top-left", "bottom-right", "right"]
                },
                content: [{
                    elem: "close",
                    mix: [{
                        block: "advice",
                        elem: "close-wrap"
                    }],
                    content: {
                        block: "advice",
                        elem: "close",
                        mix: [{
                            block: "icon"
                        }, {
                            block: "icon",
                            elem: "cross"
                        }]
                    }
                }, {
                    elem: "tail"
                }, {
                    elem: "content"
                }]
            }
        },
        _getContentBEMJSON: function(e, t) {
            return {
                block: "advice",
                elem: "popup-content",
                type: e,
                showControl: t
            }
        }
    }), BEM.JSON.decl("advice", {
        onElem: {
            "popup-content": function(e) {
                var t = e.param("type");
                e.mix([{
                    block: "i-font",
                    mods: {
                        face: "textbook"
                    }
                }]).content([{
                    block: "icon",
                    elem: "promo",
                    mods: {
                        type: t
                    },
                    mix: [{
                        block: "advice",
                        elem: "icon"
                    }]
                }, {
                    block: "advice",
                    elem: "header",
                    content: BEM.I18N("advice", "header-" + t)
                }, {
                    block: "advice",
                    elem: "text",
                    content: BEM.I18N("advice", "text-" + t)
                }, e.param("showControl") ? {
                    elem: "controls",
                    mix: [{
                        block: "popup",
                        elem: "controls"
                    }],
                    content: [{
                        block: "button",
                        mods: {
                            size: "s"
                        },
                        mix: [{
                            block: "popup",
                            elem: "advice-close"
                        }],
                        content: BEM.I18N("advice", "dont-show")
                    }]
                } : ""])
            }
        }
    }), BEM.decl("i-advices-api", null, BN("i-proxy").initProxy("i-advices-api", ["get*", "save"])), BEM.decl("i-advices-api", null, {
        save: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return BN("i-proxy").cleanCache("i-advices-api", "get"), e
            })
        }
    }), BEM.JSON.decl("search-input", {
        onBlock: function(e) {
            var t = e.param("search"),
                i = e.param("hint"),
                n = e.mods() || {};
            e.js(!0).content({
                block: "input",
                mods: {
                    size: n.size || "m"
                },
                content: [i && {
                    elem: "hint",
                    mix: {
                        block: "search-input",
                        elem: "hint"
                    },
                    content: i
                }, {
                    elem: "control",
                    mix: {
                        block: "search-input",
                        elem: "control"
                    },
                    attrs: {
                        value: t ? BEM.blocks["i-string"].escapeHTML(t) : void 0,
                        autocomplete: "off"
                    }
                }]
            })
        }
    }), BEM.DOM.decl("search-input", {
        DEBOUNCE_TIMEOUT: 500,
        onSetMod: {
            js: function() {
                var e = this.params.debounce;
                e || 0 === e || (e = this.DEBOUNCE_TIMEOUT), this._input = this.findBlockInside("input"), this._val = this._input.val().trim(), this._emit = jQuery.debounce(this._emit, e, this), this.elem("control").on("keypress", function(e) {
                    13 === e.charCode && this._emit()
                }.bind(this)), this._input.on("change", this._emit, this), this._input.on("focus", this._onInputFocus, this)
            }
        },
        val: function(e) {
            return this._input.val(e)
        },
        focus: function() {
            this._input.focus()
        },
        destruct: function() {
            this._input.un("change", this._emit, this), this._input.un("focus", this._onInputFocus, this), this.__base.apply(this, arguments)
        },
        _onInputFocus: function() {
            this.trigger("focus", this._val)
        },
        _emit: function() {
            var e = this._input.val().trim();
            e !== this._val && (this._val = e, this.trigger("search", this._val))
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "report-mode",
        modVal: "auto"
    }, {
        onSetMod: {
            js: function() {
                BN("i-report-collection").get().then(function(e) {
                    var t = e.getReportById(this.params.reportId);
                    t.on("change", function() {
                        this.params.path = t.getReportPath()
                    }.bind(this))
                }.bind(this)), this.__base.apply(this, arguments)
            }
        },
        _getPath: function() {
            return this.params.path
        }
    }), BEM.JSON.decl({
        name: "smart-link",
        modName: "type",
        modVal: "report"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").createReport(e.js().reportId, !1).then(function(t) {
                e.js(jQuery.extend(e.js(), {
                    host: t.getReportHost(),
                    path: t.getReportPath()
                }))
            }))
        }
    }), BEM.JSON.decl({
        name: "smart-link",
        modName: "type",
        modVal: "counter"
    }, {
        onBlock: function(e) {
            e.js(jQuery.extend(e.js(), {
                path: "/" + BN("i-router").getParams().id || ""
            }))
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "tld",
        modVal: "yes"
    }, {
        _getNewParams: function() {
            var e = this.__base.apply(this, arguments);
            return e.tld = BN("i-router").getTld(), e
        }
    }), BEM.DOM.decl("main-menu-gui", {
        getView: function() {
            throw "Should be implemented in child class"
        },
        select: function() {
            throw "Should be implemented in child class"
        },
        deselect: function() {
            this.trigger("deselect"), this._isDestructing || this.destruct()
        }
    }), BEM.JSON.decl("main-menu-finder", {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("main-menu-finder").processStructure(t.structure);
            e.content(i.map(function(e, t) {
                return {
                    elem: "panel",
                    items: e,
                    level: t
                }
            }))
        },
        onElem: {
            panel: function(e) {
                var t = e.params();
                e.mod("level", t.level), e.content([t.beforeContent].concat(t.items).concat([t.afterContent]))
            },
            item: function(e) {
                var t = e.params(),
                    i = t.item,
                    n = i.disabled,
                    o = i.selected,
                    s = Boolean(!n && i.link),
                    r = BN("i-string").escapeHTML(i.name),
                    a = [];
                e.mods(jQuery.extend(i.mods, {
                    id: t.id,
                    pid: t.pid,
                    disabled: n ? "yes" : "no",
                    type: t.group ? "group" : t.spacer ? "spacer" : s ? "link" : n ? "disabled" : "fake",
                    selected: o ? "yes" : "no"
                })), e.attrs(i.attrs), e.js(i.js), i.icon && a.push({
                    elem: "icon",
                    mods: {
                        id: i.icon
                    },
                    mix: [{
                        block: "icon",
                        elem: i.icon
                    }, {
                        block: "icon"
                    }]
                }), s ? (o && (e.mod("with-tick", "yes"), e.mix([{
                    block: "icon",
                    elem: "tick",
                    mods: {
                        after: "yes"
                    }
                }])), a.push({
                    block: "smart-link",
                    mods: i.link.mods,
                    js: i.link.params,
                    attrs: i.link.attrs,
                    content: r,
                    mix: [{
                        block: "main-menu-finder",
                        elem: "link"
                    }, {
                        block: "main-menu-finder",
                        elem: "item-content"
                    }, i.nda ? {
                        block: "nda-message"
                    } : null]
                })) : i.content ? a.push(i.content) : (a.push({
                    elem: "item-content",
                    mix: i.nda ? {
                        block: "nda-message"
                    } : null,
                    content: r
                }), t.group && a.push({
                    block: "icon",
                    elem: "arrow",
                    mix: [{
                        block: "icon",
                        mods: {
                            direction: "right"
                        }
                    }, {
                        block: "main-menu-finder",
                        elem: "group-icon"
                    }]
                })), e.content(a)
            }
        }
    }), BEM.DOM.decl({
        name: "main-menu-finder",
        baseBlock: "main-menu-gui"
    }, {
        _FADE_TIME: 250,
        onSetMod: {
            js: function() {
                this.findBlocksInside("smart-link"), this._panels = this.findElem("panel"), this._activePanelLevel = -1, this._setDebouncedMethods(), this._activateChildren(0, "root"), this._doBindings()
            }
        },
        onElemSetMod: {
            item: {
                selected: {
                    yes: function(e) {
                        BN("metrika-counter").params("reports-menu-select-group", this.getMod(e, "id"))
                    }
                }
            }
        },
        getView: function() {
            return this.domElem
        },
        select: function() {
            this.domElem.show()
        },
        deselect: function() {
            setTimeout(this.__base.bind(this), this._FADE_TIME), this._hidePanel(this._panels)
        },
        destruct: function() {
            this._panels.off("wheel", this._preventEventIfNoNeed), jQuery(document).off("keyup", this._onEscPress), jQuery(document).off("click", this._onOutsideClick), this.__base.apply(this, arguments)
        },
        _setDebouncedMethods: function() {
            var e = {
                _onOutsideClick: 50,
                _onEscPress: 50,
                _onPanelMouse: 120
            };
            Object.keys(e).forEach(function(t) {
                this[t] = jQuery.debounce(this[t], e[t], this)
            }, this)
        },
        _doBindings: function() {
            this._bindPanelsHoverEvents(), this._panels.on("wheel", this._preventEventIfNoNeed), jQuery(document).on("keyup", this._onEscPress), jQuery(document).on("click", this._onOutsideClick), this.bindTo(this._panels, "click", this._onItemLinkClick)
        },
        _bindPanelsHoverEvents: function() {
            this.bindTo(this._panels, "mouseover", this._onPanelMouse), this.bindTo(this._panels, "hover", function(e) {
                this._activePanelLevel = "mouseenter" === e.type ? this._getEventPanelLevel(jQuery(e.currentTarget)) : -1
            }, this)
        },
        _onPanelMouse: function(e) {
            var t, i = jQuery(e.currentTarget),
                n = this._getEventPanelLevel(i);
            n === this._activePanelLevel && (t = jQuery(e.target).closest(this.buildSelector("item"), i), t.length && (this.setMod(this.findElem(i, "item", "selected", "yes"), "selected", "current"), "group" === this.getMod(t, "type") ? (this.setMod(t, "selected", "yes"), this._activateChildren(n + 1, this.getMod(t, "id"))) : this._hidePanel(this._panels.slice(n + 1))))
        },
        _getEventPanelLevel: function(e) {
            return Number(this.getMod(e, "level"))
        },
        _onOutsideClick: function(e) {
            0 === jQuery(e.target).closest(this.domElem).length && this.deselect()
        },
        _onEscPress: function(e) {
            27 === e.keyCode && this.deselect()
        },
        _onItemLinkClick: function(e) {
            var t, i, n = jQuery(e.target).closest(this.buildSelector("item", "type", "link") + this.buildSelector("item", "disabled", "no"), e.currentTarget);
            n.length && (t = this.getMods(n), i = "root" === t.pid ? "recent-reports" : t.pid, BN("metrika-counter").params("reports-menu-report-open", i, t.id), this.deselect())
        },
        _activateChildren: function(e, t) {
            var i = t;
            Array.prototype.forEach.call(this._panels.slice(e), function(e) {
                var t, n = jQuery(e),
                    o = this.findElem(n, "item").hide(),
                    s = null === i ? [] : o.filter(this.buildSelector("item", "pid", i)).show();
                s.length ? (n.is(":not(:visible)") && this._showPanel(n), t = s.filter(this.buildSelector("item", "selected", "yes")), 0 === t.length && (t = jQuery(o.get(0))), i = this.hasMod(t, "type", "group") ? this.getMod(t, "id") : null) : (i = null, this._hidePanel(n))
            }, this)
        },
        _showPanel: function(e) {
            e.fadeIn(this._FADE_TIME)
        },
        _hidePanel: function(e) {
            e.fadeOut(this._FADE_TIME)
        },
        _preventEventIfNoNeed: function(e) {
            var t = $(e.currentTarget),
                i = t.get(0),
                n = t.outerHeight(),
                o = i.scrollHeight,
                s = -parseInt(e.originalEvent.deltaY),
                r = i.scrollTop === o - n && 0 > s,
                a = 0 === i.scrollTop && s > 0;
            (r || a) && e.preventDefault()
        }
    }, {
        processStructure: function(e, t, i, n) {
            return t = t || 0, i = i || "root", n = n || [], n[t] = n[t] || [], e.forEach(function(e) {
                var o = e.id ? BEM.toModVal(e.id) : jQuery.identify(),
                    s = {
                        elem: "item",
                        id: o,
                        pid: i,
                        group: Boolean(e.items),
                        spacer: e.spacer,
                        item: e
                    };
                n[t].push(s), e.items && this.processStructure(e.items, t + 1, o, n)
            }, this), n
        }
    }), BEM.JSON.decl({
        name: "main-menu-finder",
        modName: "data",
        modVal: "reports"
    }, {
        onBlock: function(e) {
            var t, i, n = e.params(),
                o = n.userLogined,
                s = {
                    isPublicCounter: n.isPublicCounter,
                    isSingle: n.isSingle
                },
                r = BN("i-report-collection").processReports(n.popularReports, s),
                a = BN("i-report-collection").processReports(n.userReports, jQuery.extend(null, s, {
                    isFilter: !0,
                    currentReportId: n.currentReportId
                })),
                l = jQuery.extend(null, s, {
                    reportTreePath: n.reportTreePath,
                    currentReportId: n.currentReportId,
                    maxLevel: 1,
                    isFilter: !0
                }),
                c = BN("i-report-collection").processReports(n.favoriteReports, s);
            t = n.collectionTree.filter(function(e) {
                return "legacy" === e.id ? (i = e.items, !1) : "behaviour" === e.id ? !1 : !0
            }), t = BN("i-report-collection").processReports(t, l), n.structure = [{
                id: "standart-reports",
                name: BEM.I18N("main-menu-finder", "all-reports"),
                selected: BN("main-menu-finder").hasSelected(t),
                icon: "list2",
                items: [{
                    name: BEM.I18N("main-menu-finder", "all-reports"),
                    mods: {
                        header: "yes"
                    }
                }].concat(t)
            }], o && (a.length ? a.unshift({
                content: {
                    elem: "my-reports-new-report"
                },
                mods: {
                    "new-report-button": "yes"
                }
            }, {
                name: BEM.I18N("main-menu-finder", "my-reports"),
                mods: {
                    header: "yes"
                }
            }) : a.push({
                mods: {
                    "my-reports": "yes"
                },
                content: {
                    elem: "my-reports-custom-content"
                }
            }), n.structure.push({
                id: "user-reports",
                name: BEM.I18N("main-menu-finder", "my-reports"),
                selected: BN("main-menu-finder").hasSelected(a),
                icon: "inbox",
                items: a
            }), c.length ? c.unshift({
                name: BEM.I18N("main-menu-finder", "favorites"),
                mods: {
                    header: "yes"
                }
            }) : c.push({
                mods: {
                    favorites: "yes"
                },
                content: {
                    elem: "favorites-custom-content"
                }
            }), n.structure.push({
                id: "favorite-reports",
                name: BEM.I18N("main-menu-finder", "favorites"),
                icon: "bookmark2",
                items: c
            })), i && (Array.isArray(l.reportTreePath) && l.reportTreePath.shift(), l.isFilter = !1, i = BN("i-report-collection").processReports(i, l), n.structure.push({
                id: "legacy-reports",
                name: BEM.I18N("main-menu-finder", "legacy-reports"),
                selected: BN("main-menu-finder").hasSelected(i),
                icon: "box",
                items: [{
                    name: BEM.I18N("main-menu-finder", "legacy-reports"),
                    mods: {
                        header: "yes"
                    }
                }].concat(i)
            })), o && Array.prototype.push.apply(n.structure, [{
                name: BEM.I18N("main-menu-finder", "popular-reports")
            }].concat(r))
        },
        onElem: {
            "favorites-custom-content": function(e) {
                e.wrap([{
                    elem: "custom-content",
                    content: [{
                        elem: "custom-content-title",
                        content: BEM.I18N("main-menu-finder", "favorites")
                    }, {
                        elem: "custom-content-icon",
                        mods: {
                            id: "bookmark"
                        },
                        mix: {
                            block: "icon",
                            elem: "bookmark",
                            mods: {
                                state: "active2"
                            }
                        }
                    }, {
                        elem: "custom-content-text",
                        content: BEM.I18N("main-menu-finder", "favorites-desc")
                    }]
                }])
            },
            "my-reports-custom-content": function(e) {
                e.wrap([{
                    elem: "custom-content",
                    content: [{
                        elem: "custom-content-title",
                        content: BEM.I18N("main-menu-finder", "my-reports")
                    }, {
                        elem: "custom-content-text",
                        content: BEM.I18N("main-menu-finder", "my-reports-desc")
                    }, {
                        block: "button",
                        mods: {
                            size: "s",
                            theme: "normal"
                        },
                        url: "#",
                        mix: [{
                            block: "main-menu-finder",
                            elem: "custom-content-button"
                        }, {
                            block: "smart-link",
                            mods: {
                                "report-mode": "auto"
                            },
                            js: {
                                path: "/stat/new",
                                keepParams: ["delegation", "counter", "period"]
                            }
                        }],
                        content: BEM.I18N("main-menu-finder", "new-button")
                    }]
                }])
            },
            "my-reports-new-report": function(e) {
                e.blockParams().userLogined && e.wrap([{
                    elem: "custom-content",
                    content: {
                        elem: "new-report-link",
                        tag: "a",
                        attrs: {
                            title: BEM.I18N("main-menu-finder", "new-button")
                        },
                        mix: [{
                            block: "smart-link",
                            mods: {
                                "report-mode": "auto"
                            },
                            js: {
                                path: "/stat/new",
                                keepParams: ["delegation", "counter", "period"]
                            }
                        }],
                        content: [{
                            block: "icon",
                            elem: "thin-plus",
                            mix: [{
                                block: "main-menu-finder",
                                elem: "new-report-icon"
                            }]
                        }]
                    }
                }])
            }
        }
    }), BEM.DOM.decl({
        name: "main-menu-finder",
        modName: "data",
        modVal: "reports"
    }, {
        onSetMod: {
            js: function() {
                this.bindTo("custom-content-button", "click", this.deselect.bind(this)), this.bindTo(this.elem("item", "new-report-button", "yes"), "click", this.deselect.bind(this)), this.__base.call(this)
            }
        }
    }, {
        hasSelected: function(e) {
            return e.some(function(e) {
                return Boolean(e.selected)
            })
        }
    }), BEM.JSON.decl({
        name: "main-menu-finder",
        modName: "data",
        modVal: "reports"
    }, {
        onBlock: function(e) {
            e.defer(Vow.all({
                counter: BN("i-counters").getAsync(),
                collection: BN("i-report-collection").get(),
                popularReports: BN("i-popular-reports-collection").get().getPopularReports(),
                userReports: BN("i-report").bulkCreateUserReports(),
                report: BN("i-report").getReport().always(function(e) {
                    return e.isFulfilled() ? e.valueOf() : null
                }),
                userLogined: BN("i-user").uid().always(function(e) {
                    return e.isFulfilled()
                }),
                favoriteReports: BN("i-favorite-reports-api").get().then(function(e) {
                    return BN("i-report").bulkCreateReports(e.reports)
                })
            }).then(function(t) {
                e.param("isPublicCounter", t.counter.isPublic()), e.param("isSingle", t.counter.isSingle()), e.param("collectionTree", t.collection.getTree()), e.param("popularReports", t.popularReports), e.param("favoriteReports", t.favoriteReports), e.param("userReports", t.userReports), e.param("userLogined", t.userLogined), t.report && (e.param("currentReportId", t.report.getId()), e.param("reportTreePath", t.collection.getReportPositionInTree(t.report.getId())))
            }))
        }
    }), BEM.JSON.decl({
        name: "main-menu-finder",
        modName: "data",
        modVal: "selected-reports"
    }, {
        onBlock: function(e) {
            var t = e.params();
            t.structure = BN("i-report-collection").processReports(t.reports, {
                isPublicCounter: t.isPublicCounter,
                isSingle: t.isSingle,
                currentReportId: t.currentReportId,
                linkMods: t.linkMods
            })
        }
    }), BEM.JSON.decl({
        name: "main-menu-finder",
        modName: "data",
        modVal: "selected-reports"
    }, {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-counters").getAsync(), BN("i-report").bulkCreateReports(e.param("ids")), BN("i-report").getReport().always(function(e) {
                return e.isFulfilled() ? e.valueOf() : null
            })]).spread(function(t, i, n) {
                e.param("isPublicCounter", t.isPublic()), e.param("isSingle", t.isSingle()), e.param("reports", i), n && e.param("currentReportId", n.getId())
            }))
        }
    }), BEM.JSON.decl({
        name: "main-menu-finder",
        modName: "filter",
        modVal: "yes"
    }, {
        onElem: {
            panel: function(e) {
                var t = e.params();
                0 === t.level && (t.beforeContent = [{
                    elem: "filter"
                }, {
                    elem: "filter-panel"
                }])
            },
            filter: function(e) {
                e.content({
                    block: "search-input",
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "main-menu-finder",
                        elem: "search-input"
                    }],
                    js: {
                        debounce: 25
                    }
                })
            }
        }
    }), BEM.JSON.decl("main-menu-finder", {
        onElem: {
            "found-item": function(e) {
                var t = e.params();
                e.mix({
                    block: "main-menu-finder",
                    elem: "item",
                    mods: {
                        type: "link",
                        disabled: "no"
                    }
                }).content({
                    block: "link",
                    url: t.href,
                    attrs: t.attrs,
                    mix: [{
                        block: "main-menu-finder",
                        elem: "link"
                    }, {
                        block: "main-menu-finder",
                        elem: "item-content"
                    }],
                    content: {
                        block: "filtered-text",
                        pattern: t.pattern,
                        text: t.name
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        name: "main-menu-finder",
        modName: "filter",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                this._searchInput = this.findBlockInside("search-input"), this._filterPanel = this.findElem("filter-panel"), this._sendMetrikaParams = jQuery.debounce(this._sendMetrikaParams, 1e3, this), this.__base.call(this), this.afterCurrentEvent(function() {
                    this._searchInput.focus()
                })
            }
        },
        destruct: function() {
            this._searchInput.un("search", this._onSearch, this), this.__base.apply(this, arguments)
        },
        _doBindings: function() {
            this._searchInput.on("search", this._onSearch, this), this.bindTo("filter-panel", "click", this._onItemLinkClick), this.__base.call(this)
        },
        _onSearch: function(e, t) {
            var i = [];
            return "" === t ? this._resetSearch() : (this._visiblePanels = this._panels.filter(":visible").slice(1), this._hidePanel(this._visiblePanels), this._showPanel(this._filterPanel), this._sendMetrikaParams(t), t = t.toLowerCase().trim(), Array.prototype.forEach.call(this.elem("item", "type", "link"), function(e) {
                var n, o = jQuery(e),
                    s = this.elemParams(o).filter || null;
                s && -1 !== s.indexOf(t) && (n = this.findElem(o, "link"), i.push({
                    block: "main-menu-finder",
                    elem: "found-item",
                    name: n.text(),
                    href: n.bem("smart-link").formatHref(),
                    attrs: {
                        title: n.attr("title"),
                        target: n.attr("target")
                    },
                    pattern: t
                }))
            }, this), void BN("i-content").update(this._filterPanel, i).done())
        },
        _resetSearch: function() {
            this._searchInput.val(""), this._hidePanel(this._filterPanel), this._showPanel(this._visiblePanels)
        },
        _sendMetrikaParams: function(e) {
            BN("metrika-counter").params("side-menu-search", e)
        }
    }), BEM.JSON.decl("counter-toolbar", {
        onElem: {
            name: function(e) {
                var t = e.params().counter;
                e.tag("span").content(BN("i-string").escapeHTML(t && t.getName() || BEM.I18N("counter-toolbar", "select-counter")))
            },
            caption: function(e) {
                var t = e.params().counter;
                e.tag("span"), t && t.isSingle() && e.content([{
                    elem: "site",
                    site: t.getSite()
                }, " &nbsp;&bull;&nbsp; ", {
                    elem: "number",
                    number: t.getId()
                }])
            },
            site: function(e) {
                var t = BN("i-string").escapeHTML(e.params().site);
                return t ? void e.content({
                    block: "link",
                    mix: [{
                        block: "counter-toolbar",
                        elem: "site"
                    }],
                    mods: {
                        external: "yes"
                    },
                    target: "_blank",
                    content: t,
                    url: t
                }) : e.remove()
            },
            number: function(e) {
                var t = e.params().number;
                return t ? void e.tag("span").content(BN("i-string").escapeHTML(t)) : e.remove()
            }
        }
    }), BEM.DOM.decl("counter-toolbar", {
        dataBindings: {
            counter: "_updateCounter"
        },
        _updateCounter: function() {
            var e = this;
            this._dropdown && this._dropdown.hide(), BN("i-counters").getAsync().then(function(t) {
                return Vow.all([BN("i-content").replace(e.findElem("name"), {
                    block: "counter-toolbar",
                    elem: "name",
                    counter: t
                }), BN("i-content").replace(e.findElem("caption"), {
                    block: "counter-toolbar",
                    elem: "caption",
                    counter: t
                })])
            }).done()
        }
    }, {
        live: function() {
            return this.liveInitOnBlockInsideEvent("content-ready", "dropdown", function(e) {
                this._dropdown = e.block.on("show", this.__self._sendMetrikaParams).getPopup().focusSearchInput(), this.__self._sendMetrikaParams()
            }), !1
        },
        _sendMetrikaParams: function() {
            BN("metrika-counter").params("counters-menu", "open")
        }
    }), BEM.DOM.decl({
        name: "popup",
        modName: "search",
        modVal: "yes"
    }, {
        focusSearchInput: function() {
            var e = this.findBlockInside("search-input");
            return e && e.focus(), this
        },
        _onShown: function() {
            this.__base.apply(this, arguments), this.afterCurrentEvent(this.focusSearchInput)
        }
    }), BEM.DOM.decl("counters-abstract", {
        onSetMod: {
            js: function() {
                this._offset = this.params.offset || 0, this._totalCount = this.params.totalCount, this._count = this.params.count, this._type = this.params.selectedType || this.params.type, this._search = this.params.search || "", this._moreItemsStep = this.params.moreItemsStep || 5, this._waitBlock = this.findBlockInside("wait", "wait")
            }
        },
        _setCountersList: function() {},
        _redrawLabelCountersStatistic: function() {},
        _addCountersToList: function() {},
        _setMoreVisibility: function() {},
        _setTabVisibility: function() {},
        _setListEmptyState: function(e) {
            this.setMod("empty", e ? "yes" : "")
        },
        _setTabCount: function(e, t) {
            this._typeSelector.setTabCount(e, t)
        },
        _getTabCount: function(e) {
            return this._typeSelector.getTabCount(e)
        },
        _updateSelectedLabel: function() {},
        _isSearchMode: function() {
            return Boolean(this._search)
        },
        _onSearch: function(e, t) {
            this._applySearchFilter(t).then(function() {
                return this._updateSelectedLabel()
            }.bind(this)).done()
        },
        _onTypeChange: function(e, t) {
            this._setSelectedType(t.id), this._loadCounters({
                offset: 0,
                type: t.id
            }).then(BN("i-promise").intercept(this, function(e) {
                this._setCountersList(e), this._redrawLabelCountersStatistic(e, t)
            })).done()
        },
        _addClickHandler: function() {
            BN("metrika-counter").reachGoal("NewCounter")
        },
        _moreClickHandler: function() {
            this._loadCounters().then(this._addCountersToList.bind(this)).done()
        },
        _updateCounterLabelsModel: function(e) {
            BEM.blocks["i-labels"].initCountersLabelsModels(e)
        },
        _applySearchFilter: function(e) {
            var t = BN("i-proxy"),
                i = BN("i-promise").createChain(this);
            return this._search = e, t.cleanCache("i-counters-api", ["simpleLoad", "getList"]), Vow.allResolved([this._applyFilterToCounts().then(i(function() {
                this._setTabsVisibility(this._getAllLabelsIdsExceptCurrent())
            })), this._loadCounters({
                offset: 0
            }, i).then(i(function(e) {
                this._setCountersList(e), this._redrawLabelCountersStatistic(e)
            }))])
        },
        _applyFilterToCounts: function() {
            var e = this._search;
            return BN("i-counters-api").getCountersQuantityByLabels(e).then(function(e) {
                this._getLabelsToApplyFilter().forEach(function(t) {
                    this._setTabCount(t, e[t] || 0)
                }.bind(this))
            }.bind(this))
        },
        _getLabelsToApplyFilter: function() {
            return this._getAllLabelsIdsExceptCurrent()
        },
        _adjustFavoritesCount: function(e) {
            var t = this._getTabCount("chosen"),
                i = t + e;
            this._setTabCount("chosen", i), i > 0 && this._setTabVisibility("chosen", !0), 0 >= i && "chosen" !== this._type && !this._isSearchMode() && this._setTabVisibility("chosen", !1)
        },
        _getAllLabelsIdsExceptCurrent: function() {
            return this._getFavoriteLabelsIds().filter(function(e) {
                return e !== this._type
            }.bind(this))
        },
        _getFavoriteLabelsIds: function() {
            return BEM.MODEL.getOne("m-labels").get("labels").reduce(function(e, t) {
                return t.get("favorite") && e.push(t.get("id")), e
            }, [])
        },
        _getAllLabels: function() {
            return BEM.MODEL.getOne("m-labels").get("labels").map(function(e) {
                return e.id
            })
        },
        _setTabsVisibility: function(e) {
            var t = this._isSearchMode();
            e.forEach(function(e) {
                var i = this._getTabCount(e);
                t || i > 0 ? this._setTabVisibility(e, !0) : this._setTabVisibility(e, !1)
            }.bind(this))
        },
        _setSelectedType: function(e) {
            this._type = e, this._setTabsVisibility(this._getAllLabelsIdsExceptCurrent())
        },
        _isEmpty: function(e) {
            return this._offset + e.length === 0
        },
        _isMoreVisible: function() {
            return !(this._offset + this._count >= this._totalCount || this._totalCount <= this._moreItemsStep)
        },
        _loadCounters: function(e, t) {
            var i, n = this;
            return t = t || BN("i-promise").createChain(this), e = jQuery.extend({
                type: this._type,
                limit: this._moreItemsStep,
                offset: this._offset + this._count,
                search: this._search || "",
                fields: ["grants", "labels"]
            }, e), this._waitBlock.show(), i = BN("i-counters-api").simpleLoad(e.type, e).then(t(function(t) {
                return n._offset = t.offset, n._count = t.count, n._totalCount = t.totalCount, n._setTabCount(e.type, t.totalCount), t
            })), i.always(t(function(e) {
                e.isRejected() ? BN("error-message").showError(n, e.valueOf()) : BN("error-message").hideError(n), n._waitBlock.hide()
            })), i.then(t(function(e) {
                return this._setListEmptyState(this._isEmpty(e.counters)), e
            }))
        },
        _adjustCurrentTabCount: function(e) {
            var t = this._getTabCount(this._type),
                i = t + e;
            this._setTabCount(this._type, i)
        },
        _getFilterString: function() {
            return this._search
        },
        _updateTabCounts: function(e, t) {
            return Vow.allResolved(e.map(function(e) {
                return BN("i-counters-api").getList(e, {
                    search: t,
                    limit: 0,
                    offset: 0
                }).then(function(t) {
                    this._setTabCount(e, t.total)
                }.bind(this))
            }.bind(this)))
        }
    }), BEM.JSON.decl("counter-selector", {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                selectedType: t.selectedType,
                totalCount: t.totals,
                count: t.count
            }).content([{
                elem: "top-row",
                content: [{
                    block: "add-counter",
                    mix: [{
                        block: "counter-selector",
                        elem: "add-button"
                    }]
                }, {
                    block: "search-input",
                    hint: BEM.I18N("counter-selector", "search-hint"),
                    mix: [{
                        block: "counter-selector",
                        elem: "search"
                    }]
                }]
            }, {
                block: "counter-selector-accordion",
                selectedGroup: t.selectedType,
                totals: t.totals,
                counters: t.counters,
                labels: t.labels,
                isReportPage: t.isReportPage
            }, {
                block: "wait"
            }])
        }
    }), BEM.DOM.decl({
        name: "counter-selector",
        baseBlock: "counters-abstract"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this._typeSelector = this.findBlockInside("counter-selector-accordion").on("more", this._moreClickHandler.bind(this)).on("choose", function(e, t) {
                    this.adjustFavoritesCount(t.favorite ? 1 : -1)
                }.bind(this)).on("change", this._onTypeChange.bind(this)), this.findBlockInside("search-input").on("search", this._onSearch.bind(this)), this._waitBlock = this.findBlockInside("wait"), this._sendMetrikaParams = jQuery.debounce(this._sendMetrikaParams, 1e3, this)
            }
        },
        adjustFavoritesCount: function(e) {
            BEM.blocks["i-proxy"].cleanCache("i-counters-api", "simpleLoad"), this._adjustFavoritesCount(e)
        },
        _setCountersList: function(e) {
            this._typeSelector.setCounters(e.counters), this._setMoreVisibility()
        },
        _addCountersToList: function(e) {
            this._typeSelector.addCounters(e.counters), this._setMoreVisibility()
        },
        _setMoreVisibility: function() {
            this._typeSelector.setMoreVisibility(this._isMoreVisible())
        },
        _setTabVisibility: function(e, t) {
            t ? this._typeSelector.showGroup(e) : this._typeSelector.hideGroup(e)
        },
        _getAllLabelsIdsExceptCurrent: function() {
            return this._typeSelector.getLabelsIds().filter(function(e) {
                return e !== this._type
            }.bind(this))
        },
        _applySearchFilter: function(e) {
            return this._sendMetrikaParams(e), this.__base.apply(this, arguments)
        },
        _sendMetrikaParams: function(e) {
            e && BN("metrika-counter").params("counters-menu-search", e)
        }
    }), BEM.JSON.decl("counter-selector", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-counters-api").getList(e.param("selectedType"), {
                offset: 0,
                limit: 5
            }), BN("i-labels").getList()]).spread(function(t, i) {
                e.param("count", t.counters.length), e.param("totals", t.total), e.param("counters", t.counters), e.param("labels", i)
            }))
        }
    }), BEM.JSON.decl("counter-selector-accordion", {
        onBlock: function(e) {
            var t = [{
                id: "all",
                name: BEM.I18N("counters", "label-type-all")
            }];
            e.param("isReportPage") && e.mod("report", "yes"), e.js({
                selectedGroup: e.param("selectedGroup")
            }).content(t.concat(e.param("labels")).map(function(t) {
                return "deleted" !== t.id ? {
                    elem: "group",
                    total: t.numCounters,
                    groupType: t.id,
                    groupName: t.name,
                    counters: e.param("counters"),
                    selectedGroup: e.param("selectedGroup")
                } : ""
            }))
        },
        onElem: {
            group: function(e) {
                var t, i = e.params(),
                    n = i.total,
                    o = i.selectedGroup,
                    s = i.groupType,
                    r = i.groupName;
                ["own", "guest", "partner"].indexOf(o) >= 0 && (o = "all"), t = "number" == typeof n ? Vow.promise({
                    total: n
                }) : BN("i-counters-api").getList(s, {
                    limit: 0,
                    offset: 0
                }), e.defer(t.always(function(t) {
                    var i = t.valueOf(),
                        n = i.total || 0;
                    e.js({
                        total: n,
                        group: s
                    }).mods({
                        hidden: i.total || s === o ? "" : "yes"
                    }).content([{
                        elem: "group-header",
                        mix: [{
                            elem: "group-title-expander"
                        }],
                        total: n,
                        groupType: s,
                        groupName: r,
                        isUserGroup: BN("i-labels").isUserLabel(s)
                    }, {
                        elem: "group-content",
                        content: s === o ? {
                            elem: "item",
                            content: {
                                block: "counter-selector-table",
                                counters: e.param("counters"),
                                totalCount: n
                            }
                        } : ""
                    }])
                }))
            },
            "group-header": function(e) {
                var t = e.params(),
                    i = t.groupType,
                    n = BN("i-string").escapeHTML(t.groupName);
                e.content([{
                    elem: "group-title",
                    content: [{
                        elem: "group-title-text",
                        content: [e.param("isUserGroup") ? {
                            elem: "group-label",
                            groupType: i,
                            groupName: n
                        } : n, {
                            elem: "group-total",
                            tag: "span",
                            content: e.param("total")
                        }]
                    }, {
                        block: "counter-selector-accordion",
                        elem: "group-title-expander-button",
                        content: {
                            block: "icon",
                            elem: "arrow",
                            mix: [{
                                block: "counter-selector-accordion",
                                elem: "group-title-icon"
                            }, {
                                block: "icon",
                                mods: {
                                    direction: "down"
                                }
                            }]
                        }
                    }]
                }])
            },
            "group-label": function(e) {
                var t = e.params();
                e.wrap([{
                    block: "smart-link",
                    mods: {
                        type: "report-like"
                    },
                    js: {
                        keepAllParams: !0,
                        params: {
                            id: null,
                            gid: t.groupType
                        }
                    },
                    mix: [{
                        block: "counter-selector-accordion",
                        elem: "group-label",
                        js: {
                            labelId: t.groupType
                        }
                    }],
                    content: t.groupName
                }])
            }
        }
    }), BEM.DOM.decl("counter-selector-accordion", {
        onSetMod: function() {
            this._tabs = Array.prototype.reduce.call(this.findElem("group"), function(e, t) {
                return t = jQuery(t), e[this.elemParams(t).group] = {
                    count: this.elemParams(t).total,
                    elem: t
                }, e
            }.bind(this), {}), this._currentGroup = null, this.params.selectGroup && (this.selectGroup(this._tabs[this.params.selectedGroup].elem), this._bindTableHandlers()), this.bindTo("group-title-expander", "leftclick", this._onGroupSelect), this.bindTo("group-label", "leftclick", this._onGroupClick)
        },
        setCounters: function(e) {
            this._setCurrentGroupContent(BN("i-content").html({
                block: "counter-selector-table",
                counters: e
            }, !0)), this._bindTableHandlers()
        },
        addCounters: function(e) {
            this._getTableBlock().addCounters(e)
        },
        setMoreVisibility: function(e) {
            this._getTableBlock().setMoreVisibility(e)
        },
        showGroup: function(e, t) {
            this._tabs[e] && (void 0 !== t && this.setTabCount(e, t), this.setMod(this._tabs[e].elem, "hidden", ""))
        },
        hideGroup: function(e) {
            this._tabs[e] && this.setMod(this._tabs[e].elem, "hidden", "yes")
        },
        getTabCount: function(e) {
            return this._tabs[e] && this._tabs[e].count
        },
        selectGroup: function(e) {
            this.toggleMod(e, "expanded", "yes"), this.hasMod(e, "expanded", "yes") ? (this._currentGroup && this.toggleMod(this._tabs[this._currentGroup].elem, "expanded", "yes"), this._currentGroup = this.elemParams(e).group, this.trigger("change", {
                id: this._currentGroup
            })) : this._currentGroup = null
        },
        getLabelsIds: function() {
            return Object.keys(this._tabs)
        },
        setTabCount: function(e, t) {
            this._tabs[e].count = t, BEM.DOM.update(this.findElem(this._tabs[e].elem, "group-total"), t)
        },
        _bindTableHandlers: function() {
            var e = this;
            this._getTableBlock().on("more", function() {
                this.trigger("more")
            }.bind(this)), Array.prototype.forEach.call(this.findBlocksInside(this._tabs[this._currentGroup].elem, "counter-chosen"), function(t) {
                t.on("choose", function(t, i) {
                    e.trigger("choose", i)
                })
            })
        },
        _onGroupSelect: function(e) {
            this.selectGroup(e.data.domElem.closest(this.buildSelector("group"))), BN("metrika-counter").params("counters-menu-open-group", this._currentGroup)
        },
        _onGroupClick: function(e) {
            var t, i, n = this.elemify(e.currentTarget, "group-label");
            e.preventDefault(), this.hasMod(n, "disabled", "yes") || (t = this.elemParams(n).labelId, i = {
                group_id: t
            }, BN("metrika-counter").params("counters-menu-select-group", i), BN("i-counters").switchTo(i).then(function() {
                this.selectGroup(this._tabs[t].elem)
            }.bind(this)).done())
        },
        _setCurrentGroupContent: function(e) {
            BEM.DOM.update(this.findElem(this._tabs[this._currentGroup].elem, "group-content"), e)
        },
        _getTableBlock: function() {
            return this.findBlockInside(this._tabs[this._currentGroup].elem, "counter-selector-table")
        }
    }), BEM.JSON.decl("counter-selector-table", {
        onBlock: function(e) {
            var t = e.param("counters") || [],
                i = e.param("totalCount");
            e.content([{
                elem: "counters-list",
                content: e.params().counters.map(function(e, t) {
                    return {
                        block: "counter-selector-table",
                        elem: "list-item-wrap",
                        counter: e,
                        serial: t + 1
                    }
                })
            }, t.length ? {
                block: "button",
                mods: {
                    pseudo: "yes",
                    size: "s"
                },
                mix: [{
                    block: "counter-selector-table",
                    elem: "more-button",
                    mods: {
                        hidden: !t.length || 5 >= i ? "yes" : ""
                    }
                }],
                content: BEM.I18N("counter-selector-table", "more-button")
            } : {
                elem: "no-data",
                content: BEM.I18N("counter-selector-table", "no-data")
            }])
        },
        onElem: {
            "list-item-wrap": function(e) {
                var t = e.params(),
                    i = t.counter;
                e.content([{
                    block: "smart-link",
                    mods: {
                        type: "report-like"
                    },
                    js: {
                        keepAllParams: !0,
                        params: {
                            id: i.id,
                            gid: null
                        }
                    },
                    mix: [{
                        block: "counter-selector-table",
                        elem: "list-item",
                        js: {
                            counter: {
                                counter_id: i.id
                            }
                        }
                    }],
                    content: [{
                        block: "counter-selector-table",
                        elem: "serial",
                        content: e.param("serial")
                    }, {
                        block: "counter-selector-table",
                        elem: "counter-info",
                        counter: i
                    }]
                }, {
                    block: "counter-editor",
                    counter: i
                }])
            },
            "counter-info": function(e) {
                var t = e.param("counter");
                e.content([{
                    elem: "line",
                    content: [{
                        block: "counter-status",
                        mods: {
                            compact: "yes"
                        },
                        mix: [{
                            block: "counter-selector-table",
                            elem: "counter-status"
                        }],
                        counter: t
                    }, {
                        elem: "counter-site",
                        content: BN("i-content").escapeHTML(t.name || t.site || t.id)
                    }]
                }, {
                    elem: "line",
                    content: {
                        block: "infected-hint",
                        counter: t
                    }
                }])
            }
        }
    }), BEM.DOM.decl("counter-selector-table", {
        onSetMod: {
            js: function() {
                var e = this.findBlockOn(this.elem("more-button"), "button");
                e && e.on("click", function() {
                    this.trigger("more")
                }.bind(this))
            }
        },
        setMoreVisibility: function(e) {
            this.setMod(this.findElem("more-button"), "hidden", e ? "" : "yes")
        },
        addCounters: function(e) {
            var t = this.findElem("counters-list"),
                i = this.findElem("list-item-wrap").length;
            BN("i-content").append(t, e.map(function(e, t) {
                return {
                    block: "counter-selector-table",
                    elem: "list-item-wrap",
                    counter: e,
                    serial: i + t + 1
                }
            })).then(function() {
                t.scrollTop(t[0].scrollHeight + t.height())
            }.bind(this))
        },
        _switchToCounter: function(e) {
            var t = this.elemParams(e.data.domElem).counter;
            BN("metrika-counter").params("counters-menu-select-counter", t), BN("i-counters").switchTo(t)
        }
    }, {
        live: function() {
            this.liveBindTo("list-item", "leftclick", function(e) {
                e.preventDefault(), this._switchToCounter(e)
            })
        }
    }), BEM.JSON.decl("counter-status", {
        COUNTER_STATES: {
            CS_WAIT_FOR_CHECKING: "warn",
            CS_WAIT_FOR_CHECKING_LOAD_DATA: "warn",
            CS_OK: "ok",
            CS_NEW_COUNTER: "warn",
            CS_OK_NO_DATA: "warn",
            CS_ERR_HTML_CODE: "warn",
            CS_NA: "bad",
            CS_OBSOLETE: "bad",
            CS_NOT_EVERYWHERE: "bad",
            CS_NOT_FOUND_HOME: "bad",
            CS_ERR_CONNECT: "bad",
            CS_ERR_UNKNOWN: "bad",
            CS_NOT_FOUND_HOME_LOAD_DATA: "bad",
            CS_ERR_EMPTY_DOMAIN_NAME: "disabled",
            CS_ERR_INFECTED: "infected",
            CS_CUSTOM_ERR_CONNECT: "warn"
        },
        onBlock: function(e) {
            var t = e.param("counter");
            e.js({
                counterId: t.id
            }).mods({
                disabled: "CS_ERR_EMPTY_DOMAIN_NAME" === t.code_status ? "yes" : ""
            }).content({
                elem: "status-icon",
                compact: (e.mods() || {}).compact,
                status: t.code_status
            })
        },
        onElem: {
            "status-icon": function(e) {
                var t = e.param("status"),
                    i = e.param("compact"),
                    n = "circle-arrow",
                    o = {
                        type: "CS_WAIT_FOR_CHECKING_LOAD_DATA" === t ? "rotating-circle" : "circle"
                    };
                "CS_ERR_INFECTED" === t && (n = "infected", o = {
                    color: i ? "red" : "white"
                }), e.mods({
                    status: this.COUNTER_STATES[t] || "bad"
                }).mix({
                    block: "icon",
                    elem: n,
                    mods: o
                }).attrs({
                    title: BEM.I18N("counter-status", t)
                })
            }
        }
    }), BN.addDecl("counter-status").instanceProp({
        _check: function() {
            this._isLoading || this.hasMod("disabled", "yes") || this.hasMod("compact", "yes") || (this._update("CS_WAIT_FOR_CHECKING_LOAD_DATA", !0), BN("i-counters-api").check(this.params.counterId).always(function(e) {
                var t = e.isFulfilled() ? e.valueOf() : {
                    code_status: "CS_CUSTOM_ERR_CONNECT"
                };
                this._update(t.code_status)
            }.bind(this)))
        },
        _update: function(e, t) {
            BN("i-content").update(this.domElem, {
                block: "counter-status",
                elem: "status-icon",
                status: e
            }), this._isLoading = Boolean(t)
        }
    }).staticProp({
        live: function() {
            this.liveBindTo("click", function() {
                this._check()
            })
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "type",
        modVal: "report-like"
    }, {
        _predefinedPathnames: [/^\/secret\/?/],
        _getPath: function() {
            var e = this.__base.apply(this, arguments);
            return this._isReportLikePage() || (e = "/dashboard"), e
        },
        _isReportLikePage: function() {
            var e = BN("i-counters").getIds(),
                t = BN("i-router").getPathname(),
                i = this._predefinedPathnames.some(function(e) {
                    var i = !1;
                    return i = e instanceof RegExp ? e.test(t) : e === t
                });
            return i || Object.keys(e).some(function(t) {
                return Boolean(e[t])
            })
        }
    }), BEM.JSON.decl("counter-editor", {
        onBlock: function(e) {
            var t = e.param("counter"),
                i = BN("i-router").getParams().ulogin;
            if (t) {
                if (!BN("i-counter-single").isEditable(t)) return void e.remove();
                e.content({
                    elem: "open-button",
                    content: {
                        block: "button",
                        mods: {
                            pseudo: "yes",
                            "only-icon": "yes",
                            size: "s"
                        },
                        url: "/" + t.id + (i ? "?ulogin=" + i : ""),
                        attrs: {
                            title: BEM.I18N("counter-editor", "button-edit")
                        },
                        content: {
                            block: "icon",
                            elem: "settings",
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }]
                        }
                    }
                })
            } else e.mod("hidden", "yes").stop()
        }
    }), BEM.DOM.decl("hint", {}, {
        live: function() {
            this.liveBindTo("click", function(e) {
                if (e.stopPropagation(), !this.hasMod("disabled", "yes")) {
                    var t = this.__self._getPopup();
                    t._owner === this.domElem && t.isShown() ? (t.hide(), t._owner = null) : (t._parent = null, t.hide().setContent(this.params.text).show(this.domElem))
                }
            })
        },
        _getPopup: function() {
            var e = jQuery(BN("i-content").html({
                block: "popup",
                mix: [{
                    block: "hint",
                    elem: "popup"
                }],
                content: [{
                    elem: "tail"
                }, {
                    elem: "content"
                }]
            }, !0)).bem("popup");
            return this._getPopup = function() {
                return e
            }, e
        }
    }), BEM.JSON.decl("infected-hint", {
        onBlock: function(e) {
            var t = e.param("counter");
            return "CS_ERR_INFECTED" !== t.code_status ? void e.remove() : void e.content([BEM.I18N("infected-hint", "infected-hint"), {
                block: "link",
                mods: {
                    external: "yes"
                },
                target: "_blank",
                url: "https://yandex." + BN("i-router").getTld() + "/search/infected?url=" + encodeURIComponent("http://" + t.site),
                content: BEM.I18N("infected-hint", "help-reference")
            }])
        }
    }), BEM.DOM.decl({
        name: "counter-selector-accordion",
        modName: "report",
        modVal: "yes"
    }, {
        dataBindings: {
            report_id: {
                set: "_onReportChange"
            }
        },
        onSetMod: function() {
            this.__base.apply(this, arguments), this._updateGroupLinksAvailability()
        },
        _onReportChange: function() {
            this._updateGroupLinksAvailability()
        },
        _updateGroupLinksAvailability: function() {
            BN("i-report").getReport().then(function(e) {
                this.findElem("group-label").each(function(t, i) {
                    var n = this.elemify(i),
                        o = this.findBlockOn(n, "smart-link");
                    e.onlySingleCounterMode() ? (this.setMod(n, "disabled", "yes"), o.setMod("disabled", "yes"), this.domElem.attr({
                        title: BEM.I18N("main-menu", "unavailable-in-group-mode")
                    })) : (this.delMod(n, "disabled"), o.delMod("disabled"), this.domElem.attr({
                        title: ""
                    }))
                }.bind(this))
            }.bind(this)).done()
        }
    }), BEM.JSON.decl("counters", {
        _LABEL_TYPE_ALL_ID: "all",
        onBlock: function(e) {
            var t = e.param("selected"),
                i = e.param("pagingStep") || 100,
                n = e.param("search") || "",
                o = e.param("countersData"),
                s = e.param("labels"),
                r = o.counters || [],
                a = o.errors,
                l = {
                    id: this._LABEL_TYPE_ALL_ID,
                    name: BEM.I18N("counters", "label-type-all"),
                    favorite: !0,
                    numCounters: e.param("labelTypeAllData").total,
                    selected: t === this._LABEL_TYPE_ALL_ID,
                    isNew: !1
                },
                c = {},
                d = l;
            s.forEach(function(e) {
                return e.isNew = !1, e.id === t ? (d = e, e.selected = !0, !0) : void 0
            }), c[t] = o.totalCount || 0, e.mods({
                empty: r.length ? "" : "yes"
            }), e.js({
                totalCount: o.totalCount,
                count: o.count,
                offset: o.offset,
                selectedType: t,
                search: n,
                moreItemsStep: i,
                loadingError: a
            }).mix([{
                block: "error-message",
                mods: {
                    type: "above"
                }
            }]).content([{
                block: "wait",
                mix: {
                    block: "counters",
                    elem: "wait"
                },
                mods: {
                    theme: "dark"
                }
            }, {
                block: "i-labels",
                counters: r,
                labels: [l].concat(s)
            }, {
                elem: "header-line",
                content: [{
                    block: "add-counter",
                    mix: [{
                        block: "counters",
                        elem: "add"
                    }]
                }, {
                    block: "search-input",
                    search: n,
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "counters",
                        elem: "search"
                    }],
                    hint: BEM.I18N("counters", "search-hint")
                }]
            }, {
                elem: "body",
                content: [{
                    block: "counters-type-selector",
                    selected: t,
                    totals: c,
                    search: n,
                    labelTypeAll: l,
                    labels: s
                }, {
                    block: "label-counters-statistic",
                    label: d,
                    countersList: o
                }, {
                    block: "counters-table",
                    mix: [{
                        block: "counters",
                        elem: "table"
                    }],
                    counterList: o,
                    mods: {
                        type: t
                    }
                }, {
                    elem: "more-button-line",
                    mods: {
                        hidden: !r.length || o.totalCount <= i ? "yes" : ""
                    }
                }, {
                    elem: "no-data",
                    content: BEM.I18N("counters", "no-data")
                }]
            }, {
                block: "counters-labels",
                js: {
                    id: "labels"
                },
                labels: s,
                content: {
                    elem: "edit-popup"
                }
            }])
        },
        onElem: {
            "more-button-line": function(e) {
                e.content({
                    block: "button",
                    content: BEM.I18N("counters", "show-more"),
                    mods: {
                        pseudo: "yes",
                        size: "l"
                    }
                })
            }
        }
    }), BEM.JSON.decl("counters", {
        onBlock: function(e) {
            var t = e.param("pagingStep") || 100,
                i = e.param("search") || "",
                n = {
                    search: i,
                    offset: 0,
                    limit: t,
                    fields: ["grants", "labels"]
                },
                o = e.param("selected");
            e.defer(BN("i-labels").getList().then(function(t) {
                return e.param("labels", t), 0 === t.filter(function(e) {
                    return e.id === o
                }).length && e.param("selected", "all", !0), Vow.all([BN("i-counters-api").simpleLoad(e.param("selected"), n), BN("i-counters-api").getList("all", {
                    search: i,
                    limit: 0,
                    offset: 0
                })]).spread(function(t, i) {
                    e.param("countersData", t), e.param("labelTypeAllData", i)
                })
            }))
        }
    }), BEM.DOM.decl({
        name: "counters",
        baseBlock: "counters-abstract"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this.findBlockInside("i-labels"), this._typeSelector = this.findBlockInside("counters-type-selector"), this._labelsModel = BEM.MODEL.getOne("m-labels"), this._labelsModel.on("select", this._onTypeChange, this).on("fix", this._onFix), this.findBlockInside("more-button-line", "button").on("press", this._moreClickHandler.bind(this)), this.findBlockInside("add", "button").on("click", this._addClickHandler.bind(this)), this.findBlockInside("search-input").on("search", this._onSearch.bind(this)), this.params.loadingError && BN("error-message").showError(this, this.params.loadingError)
            }
        },
        destruct: function() {
            this._labelsModel.un("select", this._onTypeChange, this).un("fix", this._onFix), this.__base.apply(this, arguments)
        },
        _loadCounters: function() {
            return this.__base.apply(this, arguments).then(BN("i-promise").intercept(this, function(e) {
                return this._setMoreVisibility(), this._updateCounterLabelsModel(e.counters), e
            }))
        },
        _onFix: function() {
            this.getSelectedLabel() || this.selectLabel("all")
        },
        _updateSelectedLabel: function() {
            var e = this._labelsModel,
                t = e.getSelectedLabel(),
                i = e.get("labels");
            t.get("numCounters") || ["all", "deleted"].some(function(t) {
                return i.getById(t).get("numCounters") ? (e.selectLabel(t), !0) : void 0
            })
        },
        _setCountersList: function(e) {
            var t = this.findBlockInside("counters-table");
            BEM.blocks["i-content"].replace(t.domElem, {
                block: "counters-table",
                mix: {
                    block: "counters",
                    elem: "table"
                },
                counterList: e,
                mods: {
                    type: this._type
                }
            }).done()
        },
        _redrawLabelCountersStatistic: function(e, t) {
            var i = this.findBlockInside("label-counters-statistic");
            t = t || this._labelsModel.get("labels").getById(this._type), e.count && "deleted" !== t.id ? (i.delMod("hidden"), BEM.blocks["i-content"].replace(i.domElem, {
                block: "label-counters-statistic",
                countersList: e,
                label: t
            }).done()) : i.setMod("hidden", "yes")
        },
        _addCountersToList: function(e) {
            var t = this.findBlockInside("counters-table");
            BEM.blocks["i-content"].append(t.domElem, {
                block: "counters-table",
                elem: "body",
                counterList: e,
                mods: {
                    type: this._type
                }
            })
        },
        _setMoreVisibility: function() {
            this.setMod(this.elem("more-button-line"), "hidden", this._isMoreVisible() ? "" : "yes")
        },
        _applySearchFilter: function(e) {
            return BEM.blocks["i-router"].replaceParams({
                search: e
            }, !0, !0), this.__base.apply(this, arguments)
        },
        _setSelectedType: function(e) {
            return BEM.blocks["i-router"].replaceParams({
                type: e
            }, !0, !0), this.__base.apply(this, arguments)
        },
        _getLabelsToApplyFilter: function() {
            return this._labelsModel.get("labels").map(function(e) {
                return e.get("id")
            })
        }
    }, {
        _updateAfterRemove: function() {
            var e = !1;
            return function(t, i) {
                if (!e) {
                    var n, o, s = this._getAllLabels();
                    e = !0, BN("i-proxy").cleanCache("i-counters-api", ["simpleLoad", "getList"]), this._adjustCurrentTabCount("restore" === t.type && "deleted" !== this._type ? 0 : -1),
                        "deleted" === t.type && (n = BEM.MODEL.getOne({
                            name: "m-counter-labels",
                            id: i.counterId
                        }), n.removeAllUserLabels(!0)), o = this._updateTabCounts(s, this._getFilterString()), o.always(function() {
                            e = !1
                        }).done()
                }
            }
        }(),
        live: function() {
            return this.liveInitOnBlockInsideEvent("deleted", "counter-delete", this._updateAfterRemove), this.liveInitOnBlockInsideEvent("restore", "counter-restore", this._updateAfterRemove), this.liveInitOnBlockInsideEvent("unsubscribe", "counter-grant-unsubscribe", this._updateAfterRemove), !1
        }
    }), BEM.JSON.decl("small-chart", {
        onBlock: function(e) {
            e.content({
                elem: "chart"
            })
        }
    }), BEM.DOM.decl("small-chart", {
        onSetMod: {
            js: function() {
                this._chartAdapter = BEM.create({
                    block: "report-chart-small-line"
                }), this._chartAdapter.setDestination(this.findElem("chart")), this._chartAdapter.draw(this.params).done(), BN("main-menu").on("toggle", this.resize, this)
            }
        },
        destruct: function() {
            BN("main-menu").un("toggle", this.resize, this), this.__base.apply(this, arguments)
        },
        beforeDrag: function() {
            this._chartAdapter.beforeDrag()
        },
        afterDrag: function() {
            this._chartAdapter.afterDrag()
        },
        resize: function() {
            this._chartAdapter.resize()
        }
    }), BEM.decl("report-chart", {
        AXES_COLOR: "#e5e5e5",
        OTHER_COLOR: "rgb(243, 241, 237)",
        metricIndex: 0,
        _chart: null,
        setDataModel: function(e) {
            this._dataModel = e
        },
        setDestination: function(e) {
            this._renderTo = jQuery(e).get(0)
        },
        setLegendBlock: function(e) {
            this._legendBlock = e
        },
        draw: function(e) {
            var t;
            if (e && this.setDataModel(e), !this._dataModel || !this._renderTo) return Vow.reject(new Error("data model and render destination should be set to render chart"));
            this._initChartOptions();
            try {
                this._updateChartDataOptions()
            } catch (i) {
                return Vow.reject(i)
            }
            return t = Vow.promise(), this.drawLegend().then(function() {
                this.clear(), this._chartOptions.chart.renderTo = this._renderTo, this._chartOptions.chart.events.load = t.fulfill.bind(t), this._render(this._chartOptions)
            }.bind(this)), t
        },
        drawLegend: function() {
            var e = this._getLegendData();
            return this._legendBlock && e ? this._legendBlock.draw(e) : Vow.fulfill()
        },
        clear: function() {
            this._chart && (this._chart.destroy(), this._chart = null), this._clearRenderTarget()
        },
        resize: function() {
            this._chart && this._chart.reflow && this._chart.reflow(), this._legendBlock && this._legendBlock.update && this._legendBlock.update()
        },
        beforeDrag: function() {
            this._chart && (this._chart.options.tooltip.enabled = !1, this._render(this._chart.options))
        },
        afterDrag: function() {
            this._chart && (this._chart.options.tooltip.enabled = !0, this._render(this._chart.options))
        },
        _initChartOptions: function() {
            var e = this;
            this._chartOptions = {
                chart: {
                    height: 400,
                    spacing: [20, 0, 20, 0],
                    marginLeft: 90,
                    marginRight: 50,
                    style: {
                        fontFamily: "Arial, Helvetica, sans-serif"
                    },
                    plotBorderColor: this.AXES_COLOR,
                    plotBorderWidth: 1,
                    events: {}
                },
                title: {
                    text: null
                },
                legend: {
                    enabled: !1
                },
                credits: {
                    enabled: !1
                },
                tooltip: {
                    useHTML: !1,
                    hideDelay: 50,
                    shadow: !1,
                    backgroundColor: "#ffffff",
                    positioner: this._tooltipPositioner,
                    shape: "square",
                    formatter: function() {
                        return e._tooltipFormatter(this.series.name, this.point)
                    },
                    style: {
                        padding: 8,
                        width: 600,
                        lineHeight: "20px"
                    }
                },
                plotOptions: {
                    series: {
                        animation: !1,
                        states: {
                            hover: {
                                lineWidth: 2,
                                halo: {
                                    size: 1
                                }
                            }
                        },
                        turboThreshold: 5e3
                    },
                    column: {
                        minPointLength: 3
                    }
                },
                xAxis: this._getXAxisOptions(),
                yAxis: this._getYAxisOptions()
            }
        },
        _getLabelsOptions: function() {
            return {
                labels: {
                    useHTML: !0,
                    style: {
                        fontSize: "12px",
                        color: "black"
                    },
                    autoRotationLimit: 0
                }
            }
        },
        _getXAxisOptions: function() {
            return jQuery.extend(!0, this._getLabelsOptions(), {
                allowDecimals: !1,
                min: 0,
                startOnTick: !1,
                endOnTick: !1,
                gridLineWidth: 1,
                tickWidth: 0,
                tickmarkPlacement: "on",
                lineColor: this.AXES_COLOR,
                gridLineColor: this.AXES_COLOR,
                maxPadding: 0,
                minPadding: 0,
                tickPixelInterval: 150
            })
        },
        _getYAxisOptions: function() {
            return jQuery.extend(!0, this._getLabelsOptions(), {
                min: 0,
                title: {
                    text: null
                },
                gridLineWidth: 1,
                tickWidth: 0,
                lineWidth: 1,
                tickPixelInterval: 50,
                lineColor: this.AXES_COLOR,
                gridLineColor: this.AXES_COLOR
            })
        },
        _getDisabledAxisOptions: function() {
            return {
                lineWidth: 0,
                gridLineWidth: 0,
                lineColor: "transparent",
                labels: {
                    enabled: !1
                },
                title: {
                    enabled: !1
                },
                tickWidth: 0,
                tickLength: 0
            }
        },
        _render: function(e) {
            this._chart = new Highcharts.Chart(e)
        },
        _clearRenderTarget: function() {
            this._renderTo && jQuery(this._renderTo).html("")
        },
        _getLegendData: function() {
            return this._chartOptions.series
        },
        _updateChartDataOptions: function() {
            throw new Error("should be implemented in child/mod")
        },
        _getTotals: function(e, t) {
            var i, n = e.totals[this.metricIndex];
            return t ? (i = e.data[0] && e.data[0].metrics[0], i && i.length !== n.length && (n = i.map(function(e, t) {
                return t in n ? n[t] : n[0]
            }) || n)) : Array.isArray(n) && (n = n[0]), n
        },
        _buildTotalsAveragesLabel: function() {
            var e = this._dataModel.getMetricMeta();
            return BEM.I18N("report-chart", e.allow_normalisation ? "totals" : "averages")
        },
        _formatMetric: function(e, t, i) {
            var n = t && t.attributeFormatOptions || {},
                o = n.svg;
            return o = void 0 === o ? !0 : Boolean(o), BN("formatter").run(i ? [] : "metric", jQuery.extend({
                dim: this._dataModel.getMetricMeta().dim,
                type: "metric",
                value: Number(e),
                originValue: e,
                dataType: this._dataModel.getMetricMeta().type,
                options: jQuery.extend(n, {
                    svg: o
                })
            }, t))
        },
        _formatDimension: function(e) {
            var t = this._dataModel.getDimensionsMeta()[0],
                i = this._dataModel.getGroup(),
                n = t && BN("formatter").run("dimension", {
                    type: "dimension",
                    dataType: t.type,
                    originValue: e,
                    value: e,
                    group: i
                }) || e;
            return n
        },
        _getDimName: function(e, t) {
            return BN("formatter").run(["chart"], {
                type: "dimension",
                chart: t,
                dimensionsMeta: this._dataModel.getDimensionsMeta(),
                dimensions: e.dimensions,
                dimension: e.dimension
            })
        },
        _yAxisMetricFormatter: function(e, t, i) {
            return BN("formatter").run("chart", {
                type: "metric",
                normalization: i,
                value: e,
                totals: t
            })
        },
        _yAxisFormatter: function(e) {
            var t = this._dataModel.isNormalized();
            return this._formatMetric(e, {
                dataType: t ? "percents" : void 0,
                attributeFormatOptions: this._getYAxisFormatOptions()
            })
        },
        _getYAxisFormatOptions: function() {
            return {
                svg: !1
            }
        },
        _xAxisFormatter: function(e) {
            return this._formatAxisDate({
                date1: e.from,
                date2: e.to,
                isHoliday: e.isHoliday
            })
        },
        _tooltipFormatter: function(e, t) {
            var i = this._getTooltipValue(t.y, t.originalVal),
                n = this._formatTooltipDate(t);
            return n + "<br />" + BN("i-content").unescapeHTML(this._injectSoftBreaks(this._formatDimension(e))) + "<br />" + this._dataModel.getMetricMeta().name + ": " + i
        },
        _getTooltipValue: function(e, t) {
            return this._dataModel.isNormalized() ? this._formatMetric(e, {
                dataType: "percents",
                attributeFormatOptions: {
                    svg: !0
                }
            }, !0) + " (" + this._formatMetric(t, {
                attributeFormatOptions: {
                    svg: !0
                }
            }) + ")" : this._formatMetric(e, {
                attributeFormatOptions: {
                    svg: !0
                }
            })
        },
        _formatDate: function(e) {
            return e.group = e.group || this._dataModel.getGroup(), BN("i-content").html(BN("formatter").run(["chart"], {
                type: "chart-date",
                group: e.group,
                date1: e.date1,
                date2: e.date2,
                localeKey: e.localeKey,
                isHoliday: e.isHoliday
            }), !0)
        },
        _formatTooltipDate: function(e) {
            return this._formatDate(jQuery.extend({
                localeKey: "tooltip"
            }, e))
        },
        _formatAxisDate: function(e) {
            return this._formatDate(jQuery.extend({
                localeKey: "axis"
            }, e))
        },
        _formatDateTime: function(e) {
            var t = BN("i-date").create(e.dateTime),
                i = BN("i-holidays").isHoliday(e.dateTime);
            return this._formatDate({
                group: e.group,
                date1: t,
                date2: t,
                localeKey: e.localeKey,
                isHoliday: i
            })
        },
        _injectSoftBreaks: function(e) {
            return jQuery.trim(e).replace(/.{1,99}/g, function(e) {
                return e + " "
            })
        },
        _getPatterns: function(e) {
            return e.map(function(e) {
                return {
                    id: "pattern-" + e,
                    path: {
                        d: "M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2",
                        stroke: e,
                        strokeWidth: 2
                    },
                    width: 4,
                    height: 4
                }
            })
        },
        _tooltipPositioner: function(e) {
            var t = Highcharts.Tooltip.prototype.getPosition.apply(this, arguments),
                i = this.chart.options.chart.marginLeft,
                n = this.chart.options.chart.marginRight;
            return t.x = isNaN(t.x) ? i : Math.min(Math.max(t.x, i), this.chart.chartWidth - n - e), t
        },
        _getColorPool: function(e) {
            return BN("i-colorpool").create(e)
        },
        _riseIncorrectDataError: function() {
            throw new(BN("i-error-message").MetrikaError)("ERR_INCORRECT_CHART_DATA")
        }
    }),
    function() {
        function e() {
            var e, t, i = arguments,
                n = {},
                o = function(e, t) {
                    var i, n;
                    "object" != typeof e && (e = {});
                    for (n in t) t.hasOwnProperty(n) && (i = t[n], e[n] = i && "object" == typeof i && "[object Array]" !== Object.prototype.toString.call(i) && "renderTo" !== n && "number" != typeof i.nodeType ? o(e[n] || {}, i) : t[n]);
                    return e
                };
            for (i[0] === !0 && (n = i[1], i = Array.prototype.slice.call(i, 2)), t = i.length, e = 0; t > e; e++) n = o(n, i[e]);
            return n
        }

        function t(e, t) {
            return parseInt(e, t || 10)
        }

        function i(e) {
            return "string" == typeof e
        }

        function n(e) {
            return e && "object" == typeof e
        }

        function o(e) {
            return "[object Array]" === Object.prototype.toString.call(e)
        }

        function s(e) {
            return "number" == typeof e
        }

        function r(e) {
            return ae.log(e) / ae.LN10
        }

        function a(e) {
            return ae.pow(10, e)
        }

        function l(e, t) {
            for (var i = e.length; i--;)
                if (e[i] === t) {
                    e.splice(i, 1);
                    break
                }
        }

        function c(e) {
            return e !== T && null !== e
        }

        function d(e, t, o) {
            var s, r;
            if (i(t)) c(o) ? e.setAttribute(t, o) : e && e.getAttribute && (r = e.getAttribute(t));
            else if (c(t) && n(t))
                for (s in t) e.setAttribute(s, t[s]);
            return r
        }

        function u(e) {
            return o(e) ? e : [e]
        }

        function h(e, t) {
            ve && !Ee && t && t.opacity !== T && (t.filter = "alpha(opacity=" + 100 * t.opacity + ")"), Ve(e.style, t)
        }

        function m(e, t, i, n, o) {
            return e = se.createElement(e), t && Ve(e, t), o && h(e, {
                padding: 0,
                border: Ae,
                margin: 0
            }), i && h(e, i), n && n.appendChild(e), e
        }

        function p(e, t) {
            var i = function() {
                return T
            };
            return i.prototype = new e, Ve(i.prototype, t), i
        }

        function f(e, t) {
            return Array((t || 2) + 1 - String(e).length).join(0) + e
        }

        function g(e) {
            return 6e4 * (G && G(e) || U || 0)
        }

        function _(e, t) {
            for (var i, n, o, s, r, a = "{", l = !1, c = []; - 1 !== (a = e.indexOf(a));) {
                if (i = e.slice(0, a), l) {
                    for (n = i.split(":"), o = n.shift().split("."), r = o.length, i = t, s = 0; r > s; s++) i = i[o[s]];
                    n.length && (n = n.join(":"), o = /\.([0-9])/, s = L.lang, r = void 0, /f$/.test(n) ? (r = (r = n.match(o)) ? r[1] : -1, null !== i && (i = oe.numberFormat(i, r, s.decimalPoint, n.indexOf(",") > -1 ? s.thousandsSep : ""))) : i = R(n, i))
                }
                c.push(i), e = e.slice(a + 1), a = (l = !l) ? "}" : "{"
            }
            return c.push(e), c.join("")
        }

        function b(e) {
            return ae.pow(10, ce(ae.log(e) / ae.LN10))
        }

        function y(e, t, i, n, o) {
            var s, r = e,
                i = ze(i, 1);
            for (s = e / i, t || (t = [1, 2, 2.5, 5, 10], n === !1 && (1 === i ? t = [1, 2, 5, 10] : .1 >= i && (t = [1 / i]))), n = 0; n < t.length && (r = t[n], !(o && r * i >= e || !o && s <= (t[n] + (t[n + 1] || t[n])) / 2)); n++);
            return r *= i
        }

        function v(e, t) {
            var i, n, o = e.length;
            for (n = 0; o > n; n++) e[n].ss_i = n;
            for (e.sort(function(e, n) {
                    return i = t(e, n), 0 === i ? e.ss_i - n.ss_i : i
                }), n = 0; o > n; n++) delete e[n].ss_i
        }

        function M(e) {
            for (var t = e.length, i = e[0]; t--;) e[t] < i && (i = e[t]);
            return i
        }

        function k(e) {
            for (var t = e.length, i = e[0]; t--;) e[t] > i && (i = e[t]);
            return i
        }

        function B(e, t) {
            for (var i in e) e[i] && e[i] !== t && e[i].destroy && e[i].destroy(), delete e[i]
        }

        function w(e) {
            A || (A = m(Pe)), e && A.appendChild(e), A.innerHTML = ""
        }

        function x(e, t) {
            var i = "Highcharts error #" + e + ": www.highcharts.com/errors/" + e;
            if (t) throw i;
            re.console && console.log(i)
        }

        function E(e) {
            return parseFloat(e.toPrecision(14))
        }

        function N(e, t) {
            j = ze(e, t.animation)
        }

        function I() {
            var e = L.global,
                t = e.useUTC,
                i = t ? "getUTC" : "get",
                n = t ? "setUTC" : "set";
            z = e.Date || window.Date, U = t && e.timezoneOffset, G = t && e.getTimezoneOffset, H = function(e, i, n, o, s, r) {
                var a;
                return t ? (a = z.UTC.apply(0, arguments), a += g(a)) : a = new z(e, i, ze(n, 1), ze(o, 0), ze(s, 0), ze(r, 0)).getTime(), a
            }, q = i + "Minutes", W = i + "Hours", J = i + "Day", Y = i + "Date", $ = i + "Month", Q = i + "FullYear", X = n + "Milliseconds", K = n + "Seconds", Z = n + "Minutes", ee = n + "Hours", te = n + "Date", ie = n + "Month", ne = n + "FullYear"
        }

        function S() {}

        function D(e, t, i, n) {
            this.axis = e, this.pos = t, this.type = i || "", this.isNew = !0, !i && !n && this.addLabel()
        }

        function C(e, t, i, n, o) {
            var s = e.chart.inverted;
            this.axis = e, this.isNegative = i, this.options = t, this.x = n, this.total = null, this.points = {}, this.stack = o, this.alignOptions = {
                align: t.align || (s ? i ? "left" : "right" : "center"),
                verticalAlign: t.verticalAlign || (s ? "middle" : i ? "bottom" : "top"),
                y: ze(t.y, s ? 4 : i ? 14 : -6),
                x: ze(t.x, s ? i ? -6 : 6 : 0)
            }, this.textAlign = t.textAlign || (s ? i ? "right" : "left" : "center")
        }
        var T, O, P, A, L, R, j, F, V, z, H, U, G, q, W, J, Y, $, Q, X, K, Z, ee, te, ie, ne, oe, se = document,
            re = window,
            ae = Math,
            le = ae.round,
            ce = ae.floor,
            de = ae.ceil,
            ue = ae.max,
            he = ae.min,
            me = ae.abs,
            pe = ae.cos,
            fe = ae.sin,
            ge = ae.PI,
            _e = 2 * ge / 360,
            be = navigator.userAgent,
            ye = re.opera,
            ve = /(msie|trident)/i.test(be) && !ye,
            Me = 8 === se.documentMode,
            ke = /AppleWebKit/.test(be),
            Be = /Firefox/.test(be),
            we = /(Mobile|Android|Windows Phone)/.test(be),
            xe = "http://www.w3.org/2000/svg",
            Ee = !!se.createElementNS && !!se.createElementNS(xe, "svg").createSVGRect,
            Ne = Be && parseInt(be.split("Firefox/")[1], 10) < 4,
            Ie = !Ee && !ve && !!se.createElement("canvas").getContext,
            Se = {},
            De = 0,
            Ce = function() {
                return T
            },
            Te = [],
            Oe = 0,
            Pe = "div",
            Ae = "none",
            Le = /^[0-9]+$/,
            Re = ["plotTop", "marginRight", "marginBottom", "plotLeft"],
            je = "stroke-width",
            Fe = {};
        oe = re.Highcharts = re.Highcharts ? x(16, !0) : {}, oe.seriesTypes = Fe;
        var Ve = oe.extend = function(e, t) {
                var i;
                e || (e = {});
                for (i in t) e[i] = t[i];
                return e
            },
            ze = oe.pick = function() {
                var e, t, i = arguments,
                    n = i.length;
                for (e = 0; n > e; e++)
                    if (t = i[e], t !== T && null !== t) return t
            },
            He = oe.wrap = function(e, t, i) {
                var n = e[t];
                e[t] = function() {
                    var e = Array.prototype.slice.call(arguments);
                    return e.unshift(n), i.apply(this, e)
                }
            };
        R = function(e, t, i) {
                if (!c(t) || isNaN(t)) return "Invalid date";
                var n, e = ze(e, "%Y-%m-%d %H:%M:%S"),
                    o = new z(t - g(t)),
                    s = o[W](),
                    r = o[J](),
                    a = o[Y](),
                    l = o[$](),
                    d = o[Q](),
                    u = L.lang,
                    h = u.weekdays,
                    o = Ve({
                        a: h[r].substr(0, 3),
                        A: h[r],
                        d: f(a),
                        e: a,
                        w: r,
                        b: u.shortMonths[l],
                        B: u.months[l],
                        m: f(l + 1),
                        y: d.toString().substr(2, 2),
                        Y: d,
                        H: f(s),
                        I: f(s % 12 || 12),
                        l: s % 12 || 12,
                        M: f(o[q]()),
                        p: 12 > s ? "AM" : "PM",
                        P: 12 > s ? "am" : "pm",
                        S: f(o.getSeconds()),
                        L: f(le(t % 1e3), 3)
                    }, oe.dateFormats);
                for (n in o)
                    for (; - 1 !== e.indexOf("%" + n);) e = e.replace("%" + n, "function" == typeof o[n] ? o[n](t) : o[n]);
                return i ? e.substr(0, 1).toUpperCase() + e.substr(1) : e
            }, V = {
                millisecond: 1,
                second: 1e3,
                minute: 6e4,
                hour: 36e5,
                day: 864e5,
                week: 6048e5,
                month: 24192e5,
                year: 314496e5
            }, oe.numberFormat = function(e, i, n, o) {
                var s = L.lang,
                    e = +e || 0,
                    r = -1 === i ? he((e.toString().split(".")[1] || "").length, 20) : isNaN(i = me(i)) ? 2 : i,
                    i = void 0 === n ? s.decimalPoint : n,
                    o = void 0 === o ? s.thousandsSep : o,
                    s = 0 > e ? "-" : "",
                    n = String(t(e = me(e).toFixed(r))),
                    a = n.length > 3 ? n.length % 3 : 0;
                return s + (a ? n.substr(0, a) + o : "") + n.substr(a).replace(/(\d{3})(?=\d)/g, "$1" + o) + (r ? i + me(e - n).toFixed(r).slice(2) : "")
            }, F = {
                init: function(e, t, i) {
                    var n, o, s, t = t || "",
                        r = e.shift,
                        a = t.indexOf("C") > -1,
                        l = a ? 7 : 3,
                        t = t.split(" "),
                        i = [].concat(i),
                        c = function(e) {
                            for (n = e.length; n--;) "M" === e[n] && e.splice(n + 1, 0, e[n + 1], e[n + 2], e[n + 1], e[n + 2])
                        };
                    if (a && (c(t), c(i)), e.isArea && (o = t.splice(t.length - 6, 6), s = i.splice(i.length - 6, 6)), r <= i.length / l && t.length === i.length)
                        for (; r--;) i = [].concat(i).splice(0, l).concat(i);
                    if (e.shift = 0, t.length)
                        for (e = i.length; t.length < e;) r = [].concat(t).splice(t.length - l, l), a && (r[l - 6] = r[l - 2], r[l - 5] = r[l - 1]), t = t.concat(r);
                    return o && (t = t.concat(o), i = i.concat(s)), [t, i]
                },
                step: function(e, t, i, n) {
                    var o = [],
                        s = e.length;
                    if (1 === i) o = n;
                    else if (s === t.length && 1 > i)
                        for (; s--;) n = parseFloat(e[s]), o[s] = isNaN(n) ? e[s] : i * parseFloat(t[s] - n) + n;
                    else o = t;
                    return o
                }
            },
            function(e) {
                re.HighchartsAdapter = re.HighchartsAdapter || e && {
                    init: function(t) {
                        var n = e.fx;
                        e.extend(e.easing, {
                            easeOutQuad: function(e, t, i, n, o) {
                                return -n * (t /= o) * (t - 2) + i
                            }
                        }), e.each(["cur", "_default", "width", "height", "opacity"], function(t, i) {
                            var o, s = n.step;
                            "cur" === i ? s = n.prototype : "_default" === i && e.Tween && (s = e.Tween.propHooks[i], i = "set"), (o = s[i]) && (s[i] = function(e) {
                                var n, e = t ? e : this;
                                return "align" !== e.prop ? (n = e.elem, n.attr ? n.attr(e.prop, "cur" === i ? T : e.now) : o.apply(this, arguments)) : void 0
                            })
                        }), He(e.cssHooks.opacity, "get", function(e, t, i) {
                            return t.attr ? t.opacity || 0 : e.call(this, t, i)
                        }), this.addAnimSetter("d", function(e) {
                            var i, n = e.elem;
                            e.started || (i = t.init(n, n.d, n.toD), e.start = i[0], e.end = i[1], e.started = !0), n.attr("d", t.step(e.start, e.end, e.pos, n.toD))
                        }), this.each = Array.prototype.forEach ? function(e, t) {
                            return Array.prototype.forEach.call(e, t)
                        } : function(e, t) {
                            var i, n = e.length;
                            for (i = 0; n > i; i++)
                                if (t.call(e[i], e[i], i, e) === !1) return i
                        }, e.fn.highcharts = function() {
                            var e, t, n = "Chart",
                                o = arguments;
                            return this[0] && (i(o[0]) && (n = o[0], o = Array.prototype.slice.call(o, 1)), e = o[0], e !== T && (e.chart = e.chart || {}, e.chart.renderTo = this[0], new oe[n](e, o[1]), t = this), e === T && (t = Te[d(this[0], "data-highcharts-chart")])), t
                        }
                    },
                    addAnimSetter: function(t, i) {
                        e.Tween ? e.Tween.propHooks[t] = {
                            set: i
                        } : e.fx.step[t] = i
                    },
                    getScript: e.getScript,
                    inArray: e.inArray,
                    adapterRun: function(t, i) {
                        return e(t)[i]()
                    },
                    grep: e.grep,
                    map: function(e, t) {
                        for (var i = [], n = 0, o = e.length; o > n; n++) i[n] = t.call(e[n], e[n], n, e);
                        return i
                    },
                    offset: function(t) {
                        return e(t).offset()
                    },
                    addEvent: function(t, i, n) {
                        e(t).bind(i, n)
                    },
                    removeEvent: function(t, i, n) {
                        var o = se.removeEventListener ? "removeEventListener" : "detachEvent";
                        se[o] && t && !t[o] && (t[o] = function() {}), e(t).unbind(i, n)
                    },
                    fireEvent: function(t, i, n, o) {
                        var s, r = e.Event(i),
                            a = "detached" + i;
                        !ve && n && (delete n.layerX, delete n.layerY, delete n.returnValue), Ve(r, n), t[i] && (t[a] = t[i], t[i] = null), e.each(["preventDefault", "stopPropagation"], function(e, t) {
                            var i = r[t];
                            r[t] = function() {
                                try {
                                    i.call(r)
                                } catch (e) {
                                    "preventDefault" === t && (s = !0)
                                }
                            }
                        }), e(t).trigger(r), t[a] && (t[i] = t[a], t[a] = null), o && !r.isDefaultPrevented() && !s && o(r)
                    },
                    washMouseEvent: function(e) {
                        var t = e.originalEvent || e;
                        return t.pageX === T && (t.pageX = e.pageX, t.pageY = e.pageY), t
                    },
                    animate: function(t, i, n) {
                        var o = e(t);
                        t.style || (t.style = {}), i.d && (t.toD = i.d, i.d = 1), o.stop(), i.opacity !== T && t.attr && (i.opacity += "px"), t.hasAnim = 1, o.animate(i, n)
                    },
                    stop: function(t) {
                        t.hasAnim && e(t).stop()
                    }
                }
            }(re.jQuery);
        var Ue = re.HighchartsAdapter,
            Ge = Ue || {};
        Ue && Ue.init.call(Ue, F);
        var qe = Ge.adapterRun,
            We = Ge.getScript,
            Je = Ge.inArray,
            Ye = oe.each = Ge.each,
            $e = Ge.grep,
            Qe = Ge.offset,
            Xe = Ge.map,
            Ke = Ge.addEvent,
            Ze = Ge.removeEvent,
            et = Ge.fireEvent,
            tt = Ge.washMouseEvent,
            it = Ge.animate,
            nt = Ge.stop;
        L = {
            colors: "#7cb5ec,#434348,#90ed7d,#f7a35c,#8085e9,#f15c80,#e4d354,#2b908f,#f45b5b,#91e8e1".split(","),
            symbols: ["circle", "diamond", "square", "triangle", "triangle-down"],
            lang: {
                loading: "Loading...",
                months: "January,February,March,April,May,June,July,August,September,October,November,December".split(","),
                shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),
                weekdays: "Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
                decimalPoint: ".",
                numericSymbols: "k,M,G,T,P,E".split(","),
                resetZoom: "Reset zoom",
                resetZoomTitle: "Reset zoom level 1:1",
                thousandsSep: " "
            },
            global: {
                useUTC: !0,
                canvasToolsURL: "http://code.highcharts.com/4.1.5/modules/canvas-tools.js",
                VMLRadialGradientURL: "http://code.highcharts.com/4.1.5/gfx/vml-radial-gradient.png"
            },
            chart: {
                borderColor: "#4572A7",
                borderRadius: 0,
                defaultSeriesType: "line",
                ignoreHiddenSeries: !0,
                spacing: [10, 10, 15, 10],
                backgroundColor: "#FFFFFF",
                plotBorderColor: "#C0C0C0",
                resetZoomButton: {
                    theme: {
                        zIndex: 20
                    },
                    position: {
                        align: "right",
                        x: -10,
                        y: 10
                    }
                }
            },
            title: {
                text: "Chart title",
                align: "center",
                margin: 15,
                style: {
                    color: "#333333",
                    fontSize: "18px"
                }
            },
            subtitle: {
                text: "",
                align: "center",
                style: {
                    color: "#555555"
                }
            },
            plotOptions: {
                line: {
                    allowPointSelect: !1,
                    showCheckbox: !1,
                    animation: {
                        duration: 1e3
                    },
                    events: {},
                    lineWidth: 2,
                    marker: {
                        lineWidth: 0,
                        radius: 4,
                        lineColor: "#FFFFFF",
                        states: {
                            hover: {
                                enabled: !0,
                                lineWidthPlus: 1,
                                radiusPlus: 2
                            },
                            select: {
                                fillColor: "#FFFFFF",
                                lineColor: "#000000",
                                lineWidth: 2
                            }
                        }
                    },
                    point: {
                        events: {}
                    },
                    dataLabels: {
                        align: "center",
                        formatter: function() {
                            return null === this.y ? "" : oe.numberFormat(this.y, -1)
                        },
                        style: {
                            color: "contrast",
                            fontSize: "11px",
                            fontWeight: "bold",
                            textShadow: "0 0 6px contrast, 0 0 3px contrast"
                        },
                        verticalAlign: "bottom",
                        x: 0,
                        y: 0,
                        padding: 5
                    },
                    cropThreshold: 300,
                    pointRange: 0,
                    states: {
                        hover: {
                            lineWidthPlus: 1,
                            marker: {},
                            halo: {
                                size: 10,
                                opacity: .25
                            }
                        },
                        select: {
                            marker: {}
                        }
                    },
                    stickyTracking: !0,
                    turboThreshold: 1e3
                }
            },
            labels: {
                style: {
                    position: "absolute",
                    color: "#3E576F"
                }
            },
            legend: {
                enabled: !0,
                align: "center",
                layout: "horizontal",
                labelFormatter: function() {
                    return this.name
                },
                borderColor: "#909090",
                borderRadius: 0,
                navigation: {
                    activeColor: "#274b6d",
                    inactiveColor: "#CCC"
                },
                shadow: !1,
                itemStyle: {
                    color: "#333333",
                    fontSize: "12px",
                    fontWeight: "bold"
                },
                itemHoverStyle: {
                    color: "#000"
                },
                itemHiddenStyle: {
                    color: "#CCC"
                },
                itemCheckboxStyle: {
                    position: "absolute",
                    width: "13px",
                    height: "13px"
                },
                symbolPadding: 5,
                verticalAlign: "bottom",
                x: 0,
                y: 0,
                title: {
                    style: {
                        fontWeight: "bold"
                    }
                }
            },
            loading: {
                labelStyle: {
                    fontWeight: "bold",
                    position: "relative",
                    top: "45%"
                },
                style: {
                    position: "absolute",
                    backgroundColor: "white",
                    opacity: .5,
                    textAlign: "center"
                }
            },
            tooltip: {
                enabled: !0,
                animation: Ee,
                backgroundColor: "rgba(249, 249, 249, .85)",
                borderWidth: 1,
                borderRadius: 3,
                dateTimeLabelFormats: {
                    millisecond: "%A, %b %e, %H:%M:%S.%L",
                    second: "%A, %b %e, %H:%M:%S",
                    minute: "%A, %b %e, %H:%M",
                    hour: "%A, %b %e, %H:%M",
                    day: "%A, %b %e, %Y",
                    week: "Week from %A, %b %e, %Y",
                    month: "%B %Y",
                    year: "%Y"
                },
                footerFormat: "",
                headerFormat: '<span style="font-size: 10px">{point.key}</span><br/>',
                pointFormat: '<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',
                shadow: !0,
                snap: we ? 25 : 10,
                style: {
                    color: "#333333",
                    cursor: "default",
                    fontSize: "12px",
                    padding: "8px",
                    whiteSpace: "nowrap"
                }
            },
            credits: {
                enabled: !0,
                text: "Highcharts.com",
                href: "http://www.highcharts.com",
                position: {
                    align: "right",
                    x: -10,
                    verticalAlign: "bottom",
                    y: -5
                },
                style: {
                    cursor: "pointer",
                    color: "#909090",
                    fontSize: "9px"
                }
            }
        };
        var ot = L.plotOptions,
            Ue = ot.line;
        I();
        var st = /rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,
            rt = /#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
            at = /rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,
            lt = function(i) {
                var n, o, r = [];
                return function(e) {
                    e && e.stops ? o = Xe(e.stops, function(e) {
                        return lt(e[1])
                    }) : (n = st.exec(e)) ? r = [t(n[1]), t(n[2]), t(n[3]), parseFloat(n[4], 10)] : (n = rt.exec(e)) ? r = [t(n[1], 16), t(n[2], 16), t(n[3], 16), 1] : (n = at.exec(e)) && (r = [t(n[1]), t(n[2]), t(n[3]), 1])
                }(i), {
                    get: function(t) {
                        var n;
                        return o ? (n = e(i), n.stops = [].concat(n.stops), Ye(o, function(e, i) {
                            n.stops[i] = [n.stops[i][0], e.get(t)]
                        })) : n = r && !isNaN(r[0]) ? "rgb" === t ? "rgb(" + r[0] + "," + r[1] + "," + r[2] + ")" : "a" === t ? r[3] : "rgba(" + r.join(",") + ")" : i, n
                    },
                    brighten: function(e) {
                        if (o) Ye(o, function(t) {
                            t.brighten(e)
                        });
                        else if (s(e) && 0 !== e) {
                            var i;
                            for (i = 0; 3 > i; i++) r[i] += t(255 * e), r[i] < 0 && (r[i] = 0), r[i] > 255 && (r[i] = 255)
                        }
                        return this
                    },
                    rgba: r,
                    setOpacity: function(e) {
                        return r[3] = e, this
                    },
                    raw: i
                }
            };
        S.prototype = {
            opacity: 1,
            textProps: "fontSize,fontWeight,fontFamily,fontStyle,color,lineHeight,width,textDecoration,textShadow".split(","),
            init: function(e, t) {
                this.element = "span" === t ? m(t) : se.createElementNS(xe, t), this.renderer = e
            },
            animate: function(t, i, n) {
                return i = ze(i, j, !0), nt(this), i ? (i = e(i, {}), n && (i.complete = n), it(this, t, i)) : (this.attr(t), n && n()), this
            },
            colorGradient: function(t, i, n) {
                var s, r, a, l, d, u, h, m, p, f, g = this.renderer,
                    _ = [];
                if (t.linearGradient ? r = "linearGradient" : t.radialGradient && (r = "radialGradient"), r) {
                    a = t[r], l = g.gradients, u = t.stops, p = n.radialReference, o(a) && (t[r] = a = {
                        x1: a[0],
                        y1: a[1],
                        x2: a[2],
                        y2: a[3],
                        gradientUnits: "userSpaceOnUse"
                    }), "radialGradient" === r && p && !c(a.gradientUnits) && (a = e(a, {
                        cx: p[0] - p[2] / 2 + a.cx * p[2],
                        cy: p[1] - p[2] / 2 + a.cy * p[2],
                        r: a.r * p[2],
                        gradientUnits: "userSpaceOnUse"
                    }));
                    for (f in a) "id" !== f && _.push(f, a[f]);
                    for (f in u) _.push(u[f]);
                    _ = _.join(","), l[_] ? t = l[_].attr("id") : (a.id = t = "highcharts-" + De++, l[_] = d = g.createElement(r).attr(a).add(g.defs), d.stops = [], Ye(u, function(e) {
                        0 === e[1].indexOf("rgba") ? (s = lt(e[1]), h = s.get("rgb"), m = s.get("a")) : (h = e[1], m = 1), e = g.createElement("stop").attr({
                            offset: e[0],
                            "stop-color": h,
                            "stop-opacity": m
                        }).add(d), d.stops.push(e)
                    })), n.setAttribute(i, "url(" + g.url + "#" + t + ")")
                }
            },
            applyTextShadow: function(e) {
                var i, n = this.element,
                    o = -1 !== e.indexOf("contrast"),
                    s = this.renderer.forExport || n.style.textShadow !== T && !ve;
                o && (e = e.replace(/contrast/g, this.renderer.getContrast(n.style.fill))), s ? o && h(n, {
                    textShadow: e
                }) : (this.fakeTS = !0, this.ySetter = this.xSetter, i = [].slice.call(n.getElementsByTagName("tspan")), Ye(e.split(/\s?,\s?/g), function(e) {
                    var o, s, r = n.firstChild,
                        e = e.split(" ");
                    o = e[e.length - 1], (s = e[e.length - 2]) && Ye(i, function(e, i) {
                        var a;
                        0 === i && (e.setAttribute("x", n.getAttribute("x")), i = n.getAttribute("y"), e.setAttribute("y", i || 0), null === i && n.setAttribute("y", 0)), a = e.cloneNode(1), d(a, {
                            "class": "highcharts-text-shadow",
                            fill: o,
                            stroke: o,
                            "stroke-opacity": 1 / ue(t(s), 3),
                            "stroke-width": s,
                            "stroke-linejoin": "round"
                        }), n.insertBefore(a, r)
                    })
                }))
            },
            attr: function(e, t) {
                var i, n, o, s, r = this.element,
                    a = this;
                if ("string" == typeof e && t !== T && (i = e, e = {}, e[i] = t), "string" == typeof e) a = (this[e + "Getter"] || this._defaultGetter).call(this, e, r);
                else {
                    for (i in e) n = e[i], s = !1, this.symbolName && /^(x|y|width|height|r|start|end|innerR|anchorX|anchorY)/.test(i) && (o || (this.symbolAttr(e), o = !0), s = !0), !this.rotation || "x" !== i && "y" !== i || (this.doTransform = !0), s || (this[i + "Setter"] || this._defaultSetter).call(this, n, i, r), this.shadows && /^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(i) && this.updateShadows(i, n);
                    this.doTransform && (this.updateTransform(), this.doTransform = !1)
                }
                return a
            },
            updateShadows: function(e, t) {
                for (var i = this.shadows, n = i.length; n--;) i[n].setAttribute(e, "height" === e ? ue(t - (i[n].cutHeight || 0), 0) : "d" === e ? this.d : t)
            },
            addClass: function(e) {
                var t = this.element,
                    i = d(t, "class") || "";
                return -1 === i.indexOf(e) && d(t, "class", i + " " + e), this
            },
            symbolAttr: function(e) {
                var t = this;
                Ye("x,y,r,start,end,width,height,innerR,anchorX,anchorY".split(","), function(i) {
                    t[i] = ze(e[i], t[i])
                }), t.attr({
                    d: t.renderer.symbols[t.symbolName](t.x, t.y, t.width, t.height, t)
                })
            },
            clip: function(e) {
                return this.attr("clip-path", e ? "url(" + this.renderer.url + "#" + e.id + ")" : Ae)
            },
            crisp: function(e) {
                var t, i, n = {},
                    o = e.strokeWidth || this.strokeWidth || 0;
                i = le(o) % 2 / 2, e.x = ce(e.x || this.x || 0) + i, e.y = ce(e.y || this.y || 0) + i, e.width = ce((e.width || this.width || 0) - 2 * i), e.height = ce((e.height || this.height || 0) - 2 * i), e.strokeWidth = o;
                for (t in e) this[t] !== e[t] && (this[t] = n[t] = e[t]);
                return n
            },
            css: function(e) {
                var i, n, o = this.styles,
                    s = {},
                    r = this.element,
                    a = "";
                if (i = !o, e && e.color && (e.fill = e.color), o)
                    for (n in e) e[n] !== o[n] && (s[n] = e[n], i = !0);
                if (i) {
                    if (i = this.textWidth = e && e.width && "text" === r.nodeName.toLowerCase() && t(e.width) || this.textWidth, o && (e = Ve(o, s)), this.styles = e, i && (Ie || !Ee && this.renderer.forExport) && delete e.width, ve && !Ee) h(this.element, e);
                    else {
                        o = function(e, t) {
                            return "-" + t.toLowerCase()
                        };
                        for (n in e) a += n.replace(/([A-Z])/g, o) + ":" + e[n] + ";";
                        d(r, "style", a)
                    }
                    i && this.added && this.renderer.buildText(this)
                }
                return this
            },
            on: function(e, t) {
                var i = this,
                    n = i.element;
                return P && "click" === e ? (n.ontouchstart = function(e) {
                    i.touchEventFired = z.now(), e.preventDefault(), t.call(n, e)
                }, n.onclick = function(e) {
                    (-1 === be.indexOf("Android") || z.now() - (i.touchEventFired || 0) > 1100) && t.call(n, e)
                }) : n["on" + e] = t, this
            },
            setRadialReference: function(e) {
                return this.element.radialReference = e, this
            },
            translate: function(e, t) {
                return this.attr({
                    translateX: e,
                    translateY: t
                })
            },
            invert: function() {
                return this.inverted = !0, this.updateTransform(), this
            },
            updateTransform: function() {
                var e = this.translateX || 0,
                    t = this.translateY || 0,
                    i = this.scaleX,
                    n = this.scaleY,
                    o = this.inverted,
                    s = this.rotation,
                    r = this.element;
                o && (e += this.attr("width"), t += this.attr("height")), e = ["translate(" + e + "," + t + ")"], o ? e.push("rotate(90) scale(-1,1)") : s && e.push("rotate(" + s + " " + (r.getAttribute("x") || 0) + " " + (r.getAttribute("y") || 0) + ")"), (c(i) || c(n)) && e.push("scale(" + ze(i, 1) + " " + ze(n, 1) + ")"), e.length && r.setAttribute("transform", e.join(" "))
            },
            toFront: function() {
                var e = this.element;
                return e.parentNode.appendChild(e), this
            },
            align: function(e, t, n) {
                var o, s, r, a, c = {};
                return s = this.renderer, r = s.alignedObjects, e ? (this.alignOptions = e, this.alignByTranslate = t, (!n || i(n)) && (this.alignTo = o = n || "renderer", l(r, this), r.push(this), n = null)) : (e = this.alignOptions, t = this.alignByTranslate, o = this.alignTo), n = ze(n, s[o], s), o = e.align, s = e.verticalAlign, r = (n.x || 0) + (e.x || 0), a = (n.y || 0) + (e.y || 0), ("right" === o || "center" === o) && (r += (n.width - (e.width || 0)) / {
                    right: 1,
                    center: 2
                }[o]), c[t ? "translateX" : "x"] = le(r), ("bottom" === s || "middle" === s) && (a += (n.height - (e.height || 0)) / ({
                    bottom: 1,
                    middle: 2
                }[s] || 1)), c[t ? "translateY" : "y"] = le(a), this[this.placed ? "animate" : "attr"](c), this.placed = !0, this.alignAttr = c, this
            },
            getBBox: function(e) {
                var t, i, n = this.renderer,
                    o = this.rotation,
                    s = this.element,
                    r = this.styles,
                    a = o * _e;
                i = this.textStr;
                var l, c, d, u = s.style;
                if (i !== T && (d = ["", o || 0, r && r.fontSize, s.style.width].join(","), d = "" === i || Le.test(i) ? "num:" + i.toString().length + d : i + d), d && !e && (t = n.cache[d]), !t) {
                    if (s.namespaceURI === xe || n.forExport) {
                        try {
                            c = this.fakeTS && function(e) {
                                Ye(s.querySelectorAll(".highcharts-text-shadow"), function(t) {
                                    t.style.display = e
                                })
                            }, Be && u.textShadow ? (l = u.textShadow, u.textShadow = "") : c && c(Ae), t = s.getBBox ? Ve({}, s.getBBox()) : {
                                width: s.offsetWidth,
                                height: s.offsetHeight
                            }, l ? u.textShadow = l : c && c("")
                        } catch (h) {}(!t || t.width < 0) && (t = {
                            width: 0,
                            height: 0
                        })
                    } else t = this.htmlGetBBox();
                    n.isSVG && (e = t.width, i = t.height, ve && r && "11px" === r.fontSize && "16.9" === i.toPrecision(3) && (t.height = i = 14), o && (t.width = me(i * fe(a)) + me(e * pe(a)), t.height = me(i * pe(a)) + me(e * fe(a)))), n.cache[d] = t
                }
                return t
            },
            show: function(e) {
                return e && this.element.namespaceURI === xe ? this.element.removeAttribute("visibility") : this.attr({
                    visibility: e ? "inherit" : "visible"
                }), this
            },
            hide: function() {
                return this.attr({
                    visibility: "hidden"
                })
            },
            fadeOut: function(e) {
                var t = this;
                t.animate({
                    opacity: 0
                }, {
                    duration: e || 150,
                    complete: function() {
                        t.attr({
                            y: -9999
                        })
                    }
                })
            },
            add: function(e) {
                var t, i = this.renderer,
                    n = this.element;
                return e && (this.parentGroup = e), this.parentInverted = e && e.inverted, void 0 !== this.textStr && i.buildText(this), this.added = !0, (!e || e.handleZ || this.zIndex) && (t = this.zIndexSetter()), t || (e ? e.element : i.box).appendChild(n), this.onAdd && this.onAdd(), this
            },
            safeRemoveChild: function(e) {
                var t = e.parentNode;
                t && t.removeChild(e)
            },
            destroy: function() {
                var e, t, i = this,
                    n = i.element || {},
                    o = i.shadows,
                    s = i.renderer.isSVG && "SPAN" === n.nodeName && i.parentGroup;
                if (n.onclick = n.onmouseout = n.onmouseover = n.onmousemove = n.point = null, nt(i), i.clipPath && (i.clipPath = i.clipPath.destroy()), i.stops) {
                    for (t = 0; t < i.stops.length; t++) i.stops[t] = i.stops[t].destroy();
                    i.stops = null
                }
                for (i.safeRemoveChild(n), o && Ye(o, function(e) {
                        i.safeRemoveChild(e)
                    }); s && s.div && 0 === s.div.childNodes.length;) n = s.parentGroup, i.safeRemoveChild(s.div), delete s.div, s = n;
                i.alignTo && l(i.renderer.alignedObjects, i);
                for (e in i) delete i[e];
                return null
            },
            shadow: function(e, t, i) {
                var n, o, s, r, a, l, c = [],
                    u = this.element;
                if (e) {
                    for (r = ze(e.width, 3), a = (e.opacity || .15) / r, l = this.parentInverted ? "(-1,-1)" : "(" + ze(e.offsetX, 1) + ", " + ze(e.offsetY, 1) + ")", n = 1; r >= n; n++) o = u.cloneNode(0), s = 2 * r + 1 - 2 * n, d(o, {
                        isShadow: "true",
                        stroke: e.color || "black",
                        "stroke-opacity": a * n,
                        "stroke-width": s,
                        transform: "translate" + l,
                        fill: Ae
                    }), i && (d(o, "height", ue(d(o, "height") - s, 0)), o.cutHeight = s), t ? t.element.appendChild(o) : u.parentNode.insertBefore(o, u), c.push(o);
                    this.shadows = c
                }
                return this
            },
            xGetter: function(e) {
                return "circle" === this.element.nodeName && (e = {
                    x: "cx",
                    y: "cy"
                }[e] || e), this._defaultGetter(e)
            },
            _defaultGetter: function(e) {
                return e = ze(this[e], this.element ? this.element.getAttribute(e) : null, 0), /^[\-0-9\.]+$/.test(e) && (e = parseFloat(e)), e
            },
            dSetter: function(e, t, i) {
                e && e.join && (e = e.join(" ")), /(NaN| {2}|^$)/.test(e) && (e = "M 0 0"), i.setAttribute(t, e), this[t] = e
            },
            dashstyleSetter: function(e) {
                var i;
                if (e = e && e.toLowerCase()) {
                    for (e = e.replace("shortdashdotdot", "3,1,1,1,1,1,").replace("shortdashdot", "3,1,1,1").replace("shortdot", "1,1,").replace("shortdash", "3,1,").replace("longdash", "8,3,").replace(/dot/g, "1,3,").replace("dash", "4,3,").replace(/,$/, "").split(","), i = e.length; i--;) e[i] = t(e[i]) * this["stroke-width"];
                    e = e.join(",").replace("NaN", "none"), this.element.setAttribute("stroke-dasharray", e)
                }
            },
            alignSetter: function(e) {
                this.element.setAttribute("text-anchor", {
                    left: "start",
                    center: "middle",
                    right: "end"
                }[e])
            },
            opacitySetter: function(e, t, i) {
                this[t] = e, i.setAttribute(t, e)
            },
            titleSetter: function(e) {
                var t = this.element.getElementsByTagName("title")[0];
                t || (t = se.createElementNS(xe, "title"), this.element.appendChild(t)), t.textContent = String(ze(e), "").replace(/<[^>]*>/g, "")
            },
            textSetter: function(e) {
                e !== this.textStr && (delete this.bBox, this.textStr = e, this.added && this.renderer.buildText(this))
            },
            fillSetter: function(e, t, i) {
                "string" == typeof e ? i.setAttribute(t, e) : e && this.colorGradient(e, t, i)
            },
            zIndexSetter: function(e, i) {
                var n, o, s, r = this.renderer,
                    a = this.parentGroup,
                    r = (a || r).element || r.box,
                    l = this.element;
                n = this.added;
                var u;
                if (c(e) && (l.setAttribute(i, e), e = +e, this[i] === e && (n = !1), this[i] = e), n) {
                    for ((e = this.zIndex) && a && (a.handleZ = !0), a = r.childNodes, u = 0; u < a.length && !s; u++) n = a[u], o = d(n, "zIndex"), n !== l && (t(o) > e || !c(e) && c(o)) && (r.insertBefore(l, n), s = !0);
                    s || r.appendChild(l)
                }
                return s
            },
            _defaultSetter: function(e, t, i) {
                i.setAttribute(t, e)
            }
        }, S.prototype.yGetter = S.prototype.xGetter, S.prototype.translateXSetter = S.prototype.translateYSetter = S.prototype.rotationSetter = S.prototype.verticalAlignSetter = S.prototype.scaleXSetter = S.prototype.scaleYSetter = function(e, t) {
            this[t] = e, this.doTransform = !0
        }, S.prototype["stroke-widthSetter"] = S.prototype.strokeSetter = function(e, t, i) {
            this[t] = e, this.stroke && this["stroke-width"] ? (this.strokeWidth = this["stroke-width"], S.prototype.fillSetter.call(this, this.stroke, "stroke", i), i.setAttribute("stroke-width", this["stroke-width"]), this.hasStroke = !0) : "stroke-width" === t && 0 === e && this.hasStroke && (i.removeAttribute("stroke"), this.hasStroke = !1)
        };
        var ct = function() {
            this.init.apply(this, arguments)
        };
        if (ct.prototype = {
                Element: S,
                init: function(e, t, i, n, o) {
                    var s, r = location,
                        n = this.createElement("svg").attr({
                            version: "1.1"
                        }).css(this.getStyle(n));
                    s = n.element, e.appendChild(s), -1 === e.innerHTML.indexOf("xmlns") && d(s, "xmlns", xe), this.isSVG = !0, this.box = s, this.boxWrapper = n, this.alignedObjects = [], this.url = (Be || ke) && se.getElementsByTagName("base").length ? r.href.replace(/#.*?$/, "").replace(/([\('\)])/g, "\\$1").replace(/ /g, "%20") : "", this.createElement("desc").add().element.appendChild(se.createTextNode("Created with Highcharts 4.1.5")), this.defs = this.createElement("defs").add(), this.forExport = o, this.gradients = {}, this.cache = {}, this.setSize(t, i, !1);
                    var a;
                    Be && e.getBoundingClientRect && (this.subPixelFix = t = function() {
                        h(e, {
                            left: 0,
                            top: 0
                        }), a = e.getBoundingClientRect(), h(e, {
                            left: de(a.left) - a.left + "px",
                            top: de(a.top) - a.top + "px"
                        })
                    }, t(), Ke(re, "resize", t))
                },
                getStyle: function(e) {
                    return this.style = Ve({
                        fontFamily: '"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',
                        fontSize: "12px"
                    }, e)
                },
                isHidden: function() {
                    return !this.boxWrapper.getBBox().width
                },
                destroy: function() {
                    var e = this.defs;
                    return this.box = null, this.boxWrapper = this.boxWrapper.destroy(), B(this.gradients || {}), this.gradients = null, e && (this.defs = e.destroy()), this.subPixelFix && Ze(re, "resize", this.subPixelFix), this.alignedObjects = null
                },
                createElement: function(e) {
                    var t = new this.Element;
                    return t.init(this, e), t
                },
                draw: function() {},
                buildText: function(e) {
                    for (var i, n, o = e.element, s = this, r = s.forExport, a = ze(e.textStr, "").toString(), l = -1 !== a.indexOf("<"), c = o.childNodes, u = d(o, "x"), m = e.styles, p = e.textWidth, f = m && m.lineHeight, g = m && m.textShadow, _ = m && "ellipsis" === m.textOverflow, b = c.length, y = p && !e.added && this.box, v = function(e) {
                            return f ? t(f) : s.fontMetrics(/(px|em)$/.test(e && e.style.fontSize) ? e.style.fontSize : m && m.fontSize || s.style.fontSize || 12, e).h
                        }, M = function(e) {
                            return e.replace(/&lt;/g, "<").replace(/&gt;/g, ">")
                        }; b--;) o.removeChild(c[b]);
                    l || g || _ || -1 !== a.indexOf(" ") ? (i = /<.*style="([^"]+)".*>/, n = /<.*href="(http[^"]+)".*>/, y && y.appendChild(o), a = l ? a.replace(/<(b|strong)>/g, '<span style="font-weight:bold">').replace(/<(i|em)>/g, '<span style="font-style:italic">').replace(/<a/g, "<span").replace(/<\/(b|strong|i|em|a)>/g, "</span>").split(/<br.*?>/g) : [a], "" === a[a.length - 1] && a.pop(), Ye(a, function(t, a) {
                        var l, c = 0,
                            t = t.replace(/<span/g, "|||<span").replace(/<\/span>/g, "</span>|||");
                        l = t.split("|||"), Ye(l, function(t) {
                            if ("" !== t || 1 === l.length) {
                                var f, g = {},
                                    b = se.createElementNS(xe, "tspan");
                                if (i.test(t) && (f = t.match(i)[1].replace(/(;| |^)color([ :])/, "$1fill$2"), d(b, "style", f)), n.test(t) && !r && (d(b, "onclick", 'location.href="' + t.match(n)[1] + '"'), h(b, {
                                        cursor: "pointer"
                                    })), t = M(t.replace(/<(.|\n)*?>/g, "") || " "), " " !== t) {
                                    if (b.appendChild(se.createTextNode(t)), c ? g.dx = 0 : a && null !== u && (g.x = u), d(b, g), o.appendChild(b), !c && a && (!Ee && r && h(b, {
                                            display: "block"
                                        }), d(b, "dy", v(b))), p) {
                                        for (var y, k, B, g = t.replace(/([^\^])-/g, "$1- ").split(" "), w = l.length > 1 || a || g.length > 1 && "nowrap" !== m.whiteSpace, x = [], E = v(b), N = 1, I = e.rotation, S = t, D = S.length;
                                            (w || _) && (g.length || x.length);) e.rotation = 0, y = e.getBBox(!0), B = y.width, !Ee && s.forExport && (B = s.measureSpanWidth(b.firstChild.data, e.styles)), y = B > p, void 0 === k && (k = y), _ && k ? (D /= 2, "" === S || !y && .5 > D ? g = [] : (y && (k = !0), S = t.substring(0, S.length + (y ? -1 : 1) * de(D)), g = [S + "…"], b.removeChild(b.firstChild))) : y && 1 !== g.length ? (b.removeChild(b.firstChild), x.unshift(g.pop())) : (g = x, x = [], g.length && (N++, b = se.createElementNS(xe, "tspan"), d(b, {
                                            dy: E,
                                            x: u
                                        }), f && d(b, "style", f), o.appendChild(b)), B > p && (p = B)), g.length && b.appendChild(se.createTextNode(g.join(" ").replace(/- /g, "-")));
                                        k && e.attr("title", e.textStr), e.rotation = I
                                    }
                                    c++
                                }
                            }
                        })
                    }), y && y.removeChild(o), g && e.applyTextShadow && e.applyTextShadow(g)) : o.appendChild(se.createTextNode(M(a)))
                },
                getContrast: function(e) {
                    return e = lt(e).rgba, e[0] + e[1] + e[2] > 384 ? "#000" : "#FFF"
                },
                button: function(t, i, n, o, s, r, a, l, c) {
                    var d, u, h, m, p, f, g = this.label(t, i, n, c, null, null, null, null, "button"),
                        _ = 0,
                        t = {
                            x1: 0,
                            y1: 0,
                            x2: 0,
                            y2: 1
                        },
                        s = e({
                            "stroke-width": 1,
                            stroke: "#CCCCCC",
                            fill: {
                                linearGradient: t,
                                stops: [
                                    [0, "#FEFEFE"],
                                    [1, "#F6F6F6"]
                                ]
                            },
                            r: 2,
                            padding: 5,
                            style: {
                                color: "black"
                            }
                        }, s);
                    return h = s.style, delete s.style, r = e(s, {
                        stroke: "#68A",
                        fill: {
                            linearGradient: t,
                            stops: [
                                [0, "#FFF"],
                                [1, "#ACF"]
                            ]
                        }
                    }, r), m = r.style, delete r.style, a = e(s, {
                        stroke: "#68A",
                        fill: {
                            linearGradient: t,
                            stops: [
                                [0, "#9BD"],
                                [1, "#CDF"]
                            ]
                        }
                    }, a), p = a.style, delete a.style, l = e(s, {
                        style: {
                            color: "#CCC"
                        }
                    }, l), f = l.style, delete l.style, Ke(g.element, ve ? "mouseover" : "mouseenter", function() {
                        3 !== _ && g.attr(r).css(m)
                    }), Ke(g.element, ve ? "mouseout" : "mouseleave", function() {
                        3 !== _ && (d = [s, r, a][_], u = [h, m, p][_], g.attr(d).css(u))
                    }), g.setState = function(e) {
                        (g.state = _ = e) ? 2 === e ? g.attr(a).css(p) : 3 === e && g.attr(l).css(f): g.attr(s).css(h)
                    }, g.on("click", function() {
                        3 !== _ && o.call(g)
                    }).attr(s).css(Ve({
                        cursor: "default"
                    }, h))
                },
                crispLine: function(e, t) {
                    return e[1] === e[4] && (e[1] = e[4] = le(e[1]) - t % 2 / 2), e[2] === e[5] && (e[2] = e[5] = le(e[2]) + t % 2 / 2), e
                },
                path: function(e) {
                    var t = {
                        fill: Ae
                    };
                    return o(e) ? t.d = e : n(e) && Ve(t, e), this.createElement("path").attr(t)
                },
                circle: function(e, t, i) {
                    return e = n(e) ? e : {
                        x: e,
                        y: t,
                        r: i
                    }, t = this.createElement("circle"), t.xSetter = function(e) {
                        this.element.setAttribute("cx", e)
                    }, t.ySetter = function(e) {
                        this.element.setAttribute("cy", e)
                    }, t.attr(e)
                },
                arc: function(e, t, i, o, s, r) {
                    return n(e) && (t = e.y, i = e.r, o = e.innerR, s = e.start, r = e.end, e = e.x), e = this.symbol("arc", e || 0, t || 0, i || 0, i || 0, {
                        innerR: o || 0,
                        start: s || 0,
                        end: r || 0
                    }), e.r = i, e
                },
                rect: function(e, t, i, o, s, r) {
                    var s = n(e) ? e.r : s,
                        a = this.createElement("rect"),
                        e = n(e) ? e : e === T ? {} : {
                            x: e,
                            y: t,
                            width: ue(i, 0),
                            height: ue(o, 0)
                        };
                    return r !== T && (e.strokeWidth = r, e = a.crisp(e)), s && (e.r = s), a.rSetter = function(e) {
                        d(this.element, {
                            rx: e,
                            ry: e
                        })
                    }, a.attr(e)
                },
                setSize: function(e, t, i) {
                    var n = this.alignedObjects,
                        o = n.length;
                    for (this.width = e, this.height = t, this.boxWrapper[ze(i, !0) ? "animate" : "attr"]({
                            width: e,
                            height: t
                        }); o--;) n[o].align()
                },
                g: function(e) {
                    var t = this.createElement("g");
                    return c(e) ? t.attr({
                        "class": "highcharts-" + e
                    }) : t
                },
                image: function(e, t, i, n, o) {
                    var s = {
                        preserveAspectRatio: Ae
                    };
                    return arguments.length > 1 && Ve(s, {
                        x: t,
                        y: i,
                        width: n,
                        height: o
                    }), s = this.createElement("image").attr(s), s.element.setAttributeNS ? s.element.setAttributeNS("http://www.w3.org/1999/xlink", "href", e) : s.element.setAttribute("hc-svg-href", e), s
                },
                symbol: function(e, t, i, n, o, s) {
                    var r, a, l, c = this.symbols[e],
                        c = c && c(le(t), le(i), n, o, s),
                        d = /^url\((.*?)\)$/;
                    return c ? (r = this.path(c), Ve(r, {
                        symbolName: e,
                        x: t,
                        y: i,
                        width: n,
                        height: o
                    }), s && Ve(r, s)) : d.test(e) && (l = function(e, t) {
                        e.element && (e.attr({
                            width: t[0],
                            height: t[1]
                        }), e.alignByTranslate || e.translate(le((n - t[0]) / 2), le((o - t[1]) / 2)))
                    }, a = e.match(d)[1], e = Se[a] || s && s.width && s.height && [s.width, s.height], r = this.image(a).attr({
                        x: t,
                        y: i
                    }), r.isImg = !0, e ? l(r, e) : (r.attr({
                        width: 0,
                        height: 0
                    }), m("img", {
                        onload: function() {
                            l(r, Se[a] = [this.width, this.height])
                        },
                        src: a
                    }))), r
                },
                symbols: {
                    circle: function(e, t, i, n) {
                        var o = .166 * i;
                        return ["M", e + i / 2, t, "C", e + i + o, t, e + i + o, t + n, e + i / 2, t + n, "C", e - o, t + n, e - o, t, e + i / 2, t, "Z"]
                    },
                    square: function(e, t, i, n) {
                        return ["M", e, t, "L", e + i, t, e + i, t + n, e, t + n, "Z"]
                    },
                    triangle: function(e, t, i, n) {
                        return ["M", e + i / 2, t, "L", e + i, t + n, e, t + n, "Z"]
                    },
                    "triangle-down": function(e, t, i, n) {
                        return ["M", e, t, "L", e + i, t, e + i / 2, t + n, "Z"]
                    },
                    diamond: function(e, t, i, n) {
                        return ["M", e + i / 2, t, "L", e + i, t + n / 2, e + i / 2, t + n, e, t + n / 2, "Z"]
                    },
                    arc: function(e, t, i, n, o) {
                        var s = o.start,
                            i = o.r || i || n,
                            r = o.end - .001,
                            n = o.innerR,
                            a = o.open,
                            l = pe(s),
                            c = fe(s),
                            d = pe(r),
                            r = fe(r),
                            o = o.end - s < ge ? 0 : 1;
                        return ["M", e + i * l, t + i * c, "A", i, i, 0, o, 1, e + i * d, t + i * r, a ? "M" : "L", e + n * d, t + n * r, "A", n, n, 0, o, 0, e + n * l, t + n * c, a ? "" : "Z"]
                    },
                    callout: function(e, t, i, n, o) {
                        var s = he(o && o.r || 0, i, n),
                            r = s + 6,
                            a = o && o.anchorX,
                            l = o && o.anchorY,
                            o = le(o.strokeWidth || 0) % 2 / 2;
                        return e += o, t += o, o = ["M", e + s, t, "L", e + i - s, t, "C", e + i, t, e + i, t, e + i, t + s, "L", e + i, t + n - s, "C", e + i, t + n, e + i, t + n, e + i - s, t + n, "L", e + s, t + n, "C", e, t + n, e, t + n, e, t + n - s, "L", e, t + s, "C", e, t, e, t, e + s, t], a && a > i && l > t + r && t + n - r > l ? o.splice(13, 3, "L", e + i, l - 6, e + i + 6, l, e + i, l + 6, e + i, t + n - s) : a && 0 > a && l > t + r && t + n - r > l ? o.splice(33, 3, "L", e, l + 6, e - 6, l, e, l - 6, e, t + s) : l && l > n && a > e + r && e + i - r > a ? o.splice(23, 3, "L", a + 6, t + n, a, t + n + 6, a - 6, t + n, e + s, t + n) : l && 0 > l && a > e + r && e + i - r > a && o.splice(3, 3, "L", a - 6, t, a, t - 6, a + 6, t, i - s, t), o
                    }
                },
                clipRect: function(e, t, i, n) {
                    var o = "highcharts-" + De++,
                        s = this.createElement("clipPath").attr({
                            id: o
                        }).add(this.defs),
                        e = this.rect(e, t, i, n, 0).add(s);
                    return e.id = o, e.clipPath = s, e.count = 0, e
                },
                text: function(e, t, i, n) {
                    var o = Ie || !Ee && this.forExport,
                        s = {};
                    return n && !this.forExport ? this.html(e, t, i) : (s.x = Math.round(t || 0), i && (s.y = Math.round(i)), (e || 0 === e) && (s.text = e), e = this.createElement("text").attr(s), o && e.css({
                        position: "absolute"
                    }), n || (e.xSetter = function(e, t, i) {
                        var n, o, s = i.getElementsByTagName("tspan"),
                            r = i.getAttribute(t);
                        for (o = 0; o < s.length; o++) n = s[o], n.getAttribute(t) === r && n.setAttribute(t, e);
                        i.setAttribute(t, e)
                    }), e)
                },
                fontMetrics: function(e, i) {
                    e = e || this.style.fontSize, i && re.getComputedStyle && (i = i.element || i, e = re.getComputedStyle(i, "").fontSize);
                    var e = /px/.test(e) ? t(e) : /em/.test(e) ? 12 * parseFloat(e) : 12,
                        n = 24 > e ? e + 3 : le(1.2 * e),
                        o = le(.8 * n);
                    return {
                        h: n,
                        b: o,
                        f: e
                    }
                },
                rotCorr: function(e, t, i) {
                    var n = e;
                    return t && i && (n = ue(n * pe(t * _e), 4)), {
                        x: -e / 3 * fe(t * _e),
                        y: n
                    }
                },
                label: function(t, i, n, o, s, r, a, l, d) {
                    function u() {
                        var e, t;
                        e = w.element.style, f = (void 0 === g || void 0 === _ || B.styles.textAlign) && c(w.textStr) && w.getBBox(), B.width = (g || f.width || 0) + 2 * E + N, B.height = (_ || f.height || 0) + 2 * E, v = E + k.fontMetrics(e && e.fontSize, w).b, M && (p || (e = le(-x * E), t = l ? -v : 0, B.box = p = o ? k.symbol(o, e, t, B.width, B.height, D) : k.rect(e, t, B.width, B.height, 0, D[je]), p.attr("fill", Ae).add(B)), p.isImg || p.attr(Ve({
                            width: le(B.width),
                            height: le(B.height)
                        }, D)), D = null)
                    }

                    function h() {
                        var e, t = B.styles,
                            t = t && t.textAlign,
                            i = N + E * (1 - x);
                        e = l ? 0 : v, c(g) && f && ("center" === t || "right" === t) && (i += {
                            center: .5,
                            right: 1
                        }[t] * (g - f.width)), (i !== w.x || e !== w.y) && (w.attr("x", i), e !== T && w.attr("SPAN" === w.element.nodeName ? "y" : "translateY", e)), w.x = i, w.y = e
                    }

                    function m(e, t) {
                        p ? p.attr(e, t) : D[e] = t
                    }
                    var p, f, g, _, b, y, v, M, k = this,
                        B = k.g(d),
                        w = k.text("", 0, 0, a).attr({
                            zIndex: 1
                        }),
                        x = 0,
                        E = 3,
                        N = 0,
                        I = 0,
                        D = {};
                    B.onAdd = function() {
                        w.add(B), B.attr({
                            text: t || 0 === t ? t : "",
                            x: i,
                            y: n
                        }), p && c(s) && B.attr({
                            anchorX: s,
                            anchorY: r
                        })
                    }, B.widthSetter = function(e) {
                        g = e
                    }, B.heightSetter = function(e) {
                        _ = e
                    }, B.paddingSetter = function(e) {
                        c(e) && e !== E && (E = B.padding = e, h())
                    }, B.paddingLeftSetter = function(e) {
                        c(e) && e !== N && (N = e, h())
                    }, B.alignSetter = function(e) {
                        x = {
                            left: 0,
                            center: .5,
                            right: 1
                        }[e]
                    }, B.textSetter = function(e) {
                        e !== T && w.textSetter(e), u(), h()
                    }, B["stroke-widthSetter"] = function(e, t) {
                        e && (M = !0), I = e % 2 / 2, m(t, e)
                    }, B.strokeSetter = B.fillSetter = B.rSetter = function(e, t) {
                        "fill" === t && e && (M = !0), m(t, e)
                    }, B.anchorXSetter = function(e, t) {
                        s = e, m(t, e + I - b)
                    }, B.anchorYSetter = function(e, t) {
                        r = e, m(t, e - y)
                    }, B.xSetter = function(e) {
                        B.x = e, x && (e -= x * ((g || f.width) + E)), b = le(e), B.attr("translateX", b)
                    }, B.ySetter = function(e) {
                        y = B.y = le(e), B.attr("translateY", y)
                    };
                    var C = B.css;
                    return Ve(B, {
                        css: function(t) {
                            if (t) {
                                var i = {},
                                    t = e(t);
                                Ye(B.textProps, function(e) {
                                    t[e] !== T && (i[e] = t[e], delete t[e])
                                }), w.css(i)
                            }
                            return C.call(B, t)
                        },
                        getBBox: function() {
                            return {
                                width: f.width + 2 * E,
                                height: f.height + 2 * E,
                                x: f.x - E,
                                y: f.y - E
                            }
                        },
                        shadow: function(e) {
                            return p && p.shadow(e), B
                        },
                        destroy: function() {
                            Ze(B.element, "mouseenter"), Ze(B.element, "mouseleave"), w && (w = w.destroy()), p && (p = p.destroy()), S.prototype.destroy.call(B), B = k = u = h = m = null
                        }
                    })
                }
            }, O = ct, Ve(S.prototype, {
                htmlCss: function(e) {
                    var t = this.element;
                    return (t = e && "SPAN" === t.tagName && e.width) && (delete e.width, this.textWidth = t, this.updateTransform()), e && "ellipsis" === e.textOverflow && (e.whiteSpace = "nowrap", e.overflow = "hidden"), this.styles = Ve(this.styles, e), h(this.element, e), this
                },
                htmlGetBBox: function() {
                    var e = this.element;
                    return "text" === e.nodeName && (e.style.position = "absolute"), {
                        x: e.offsetLeft,
                        y: e.offsetTop,
                        width: e.offsetWidth,
                        height: e.offsetHeight
                    }
                },
                htmlUpdateTransform: function() {
                    if (this.added) {
                        var e = this.renderer,
                            i = this.element,
                            n = this.translateX || 0,
                            o = this.translateY || 0,
                            s = this.x || 0,
                            r = this.y || 0,
                            a = this.textAlign || "left",
                            l = {
                                left: 0,
                                center: .5,
                                right: 1
                            }[a],
                            d = this.shadows,
                            u = this.styles;
                        if (h(i, {
                                marginLeft: n,
                                marginTop: o
                            }), d && Ye(d, function(e) {
                                h(e, {
                                    marginLeft: n + 1,
                                    marginTop: o + 1
                                })
                            }), this.inverted && Ye(i.childNodes, function(t) {
                                e.invertChild(t, i)
                            }), "SPAN" === i.tagName) {
                            var m, p = this.rotation,
                                f = t(this.textWidth),
                                g = [p, a, i.innerHTML, this.textWidth].join(",");
                            g !== this.cTT && (m = e.fontMetrics(i.style.fontSize).b, c(p) && this.setSpanRotation(p, l, m), d = ze(this.elemWidth, i.offsetWidth), d > f && /[ \-]/.test(i.textContent || i.innerText) && (h(i, {
                                width: f + "px",
                                display: "block",
                                whiteSpace: u && u.whiteSpace || "normal"
                            }), d = f), this.getSpanCorrection(d, m, l, p, a)), h(i, {
                                left: s + (this.xCorr || 0) + "px",
                                top: r + (this.yCorr || 0) + "px"
                            }), ke && (m = i.offsetHeight), this.cTT = g
                        }
                    } else this.alignOnAdd = !0
                },
                setSpanRotation: function(e, t, i) {
                    var n = {},
                        o = ve ? "-ms-transform" : ke ? "-webkit-transform" : Be ? "MozTransform" : ye ? "-o-transform" : "";
                    n[o] = n.transform = "rotate(" + e + "deg)", n[o + (Be ? "Origin" : "-origin")] = n.transformOrigin = 100 * t + "% " + i + "px", h(this.element, n)
                },
                getSpanCorrection: function(e, t, i) {
                    this.xCorr = -e * i, this.yCorr = -t
                }
            }), Ve(ct.prototype, {
                html: function(e, t, i) {
                    var n = this.createElement("span"),
                        o = n.element,
                        s = n.renderer;
                    return n.textSetter = function(e) {
                        e !== o.innerHTML && delete this.bBox, o.innerHTML = this.textStr = e
                    }, n.xSetter = n.ySetter = n.alignSetter = n.rotationSetter = function(e, t) {
                        "align" === t && (t = "textAlign"), n[t] = e, n.htmlUpdateTransform()
                    }, n.attr({
                        text: e,
                        x: le(t),
                        y: le(i)
                    }).css({
                        position: "absolute",
                        fontFamily: this.style.fontFamily,
                        fontSize: this.style.fontSize
                    }), o.style.whiteSpace = "nowrap", n.css = n.htmlCss, s.isSVG && (n.add = function(e) {
                        var t, i = s.box.parentNode,
                            r = [];
                        if (this.parentGroup = e) {
                            if (t = e.div, !t) {
                                for (; e;) r.push(e), e = e.parentGroup;
                                Ye(r.reverse(), function(e) {
                                    var n;
                                    t = e.div = e.div || m(Pe, {
                                        className: d(e.element, "class")
                                    }, {
                                        position: "absolute",
                                        left: (e.translateX || 0) + "px",
                                        top: (e.translateY || 0) + "px"
                                    }, t || i), n = t.style, Ve(e, {
                                        translateXSetter: function(t, i) {
                                            n.left = t + "px", e[i] = t, e.doTransform = !0
                                        },
                                        translateYSetter: function(t, i) {
                                            n.top = t + "px", e[i] = t, e.doTransform = !0
                                        },
                                        visibilitySetter: function(e, t) {
                                            n[t] = e
                                        }
                                    })
                                })
                            }
                        } else t = i;
                        return t.appendChild(o), n.added = !0, n.alignOnAdd && n.htmlUpdateTransform(), n
                    }), n
                }
            }), !Ee && !Ie) {
            Ge = {
                init: function(e, t) {
                    var i = ["<", t, ' filled="f" stroked="f"'],
                        n = ["position: ", "absolute", ";"],
                        o = t === Pe;
                    ("shape" === t || o) && n.push("left:0;top:0;width:1px;height:1px;"), n.push("visibility: ", o ? "hidden" : "visible"), i.push(' style="', n.join(""), '"/>'), t && (i = o || "span" === t || "img" === t ? i.join("") : e.prepVML(i), this.element = m(i)), this.renderer = e
                },
                add: function(e) {
                    var t = this.renderer,
                        i = this.element,
                        n = t.box,
                        n = e ? e.element || e : n;
                    return e && e.inverted && t.invertChild(i, n), n.appendChild(i), this.added = !0, this.alignOnAdd && !this.deferUpdateTransform && this.updateTransform(), this.onAdd && this.onAdd(), this
                },
                updateTransform: S.prototype.htmlUpdateTransform,
                setSpanRotation: function() {
                    var e = this.rotation,
                        t = pe(e * _e),
                        i = fe(e * _e);
                    h(this.element, {
                        filter: e ? ["progid:DXImageTransform.Microsoft.Matrix(M11=", t, ", M12=", -i, ", M21=", i, ", M22=", t, ", sizingMethod='auto expand')"].join("") : Ae
                    })
                },
                getSpanCorrection: function(e, t, i, n, o) {
                    var s, r = n ? pe(n * _e) : 1,
                        a = n ? fe(n * _e) : 0,
                        l = ze(this.elemHeight, this.element.offsetHeight);
                    this.xCorr = 0 > r && -e, this.yCorr = 0 > a && -l, s = 0 > r * a, this.xCorr += a * t * (s ? 1 - i : i), this.yCorr -= r * t * (n ? s ? i : 1 - i : 1), o && "left" !== o && (this.xCorr -= e * i * (0 > r ? -1 : 1), n && (this.yCorr -= l * i * (0 > a ? -1 : 1)), h(this.element, {
                        textAlign: o
                    }))
                },
                pathToVML: function(e) {
                    for (var t = e.length, i = []; t--;) s(e[t]) ? i[t] = le(10 * e[t]) - 5 : "Z" === e[t] ? i[t] = "x" : (i[t] = e[t], !e.isArc || "wa" !== e[t] && "at" !== e[t] || (i[t + 5] === i[t + 7] && (i[t + 7] += e[t + 7] > e[t + 5] ? 1 : -1), i[t + 6] === i[t + 8] && (i[t + 8] += e[t + 8] > e[t + 6] ? 1 : -1)));
                    return i.join(" ") || "x"
                },
                clip: function(e) {
                    var t, i = this;
                    return e ? (t = e.members, l(t, i), t.push(i), i.destroyClip = function() {
                        l(t, i)
                    }, e = e.getCSS(i)) : (i.destroyClip && i.destroyClip(), e = {
                        clip: Me ? "inherit" : "rect(auto)"
                    }), i.css(e)
                },
                css: S.prototype.htmlCss,
                safeRemoveChild: function(e) {
                    e.parentNode && w(e)
                },
                destroy: function() {
                    return this.destroyClip && this.destroyClip(), S.prototype.destroy.apply(this)
                },
                on: function(e, t) {
                    return this.element["on" + e] = function() {
                        var e = re.event;
                        e.target = e.srcElement, t(e)
                    }, this
                },
                cutOffPath: function(e, i) {
                    var n, e = e.split(/[ ,]/);
                    return n = e.length, (9 === n || 11 === n) && (e[n - 4] = e[n - 2] = t(e[n - 2]) - 10 * i), e.join(" ")
                },
                shadow: function(e, i, n) {
                    var o, s, r, a, l, c, d, u = [],
                        h = this.element,
                        p = this.renderer,
                        f = h.style,
                        g = h.path;
                    if (g && "string" != typeof g.value && (g = "x"), l = g, e) {
                        for (c = ze(e.width, 3), d = (e.opacity || .15) / c, o = 1; 3 >= o; o++) a = 2 * c + 1 - 2 * o, n && (l = this.cutOffPath(g.value, a + .5)), r = ['<shape isShadow="true" strokeweight="', a, '" filled="false" path="', l, '" coordsize="10 10" style="', h.style.cssText, '" />'], s = m(p.prepVML(r), null, {
                            left: t(f.left) + ze(e.offsetX, 1),
                            top: t(f.top) + ze(e.offsetY, 1)
                        }), n && (s.cutOff = a + 1), r = ['<stroke color="', e.color || "black", '" opacity="', d * o, '"/>'], m(p.prepVML(r), null, null, s), i ? i.element.appendChild(s) : h.parentNode.insertBefore(s, h), u.push(s);
                        this.shadows = u
                    }
                    return this
                },
                updateShadows: Ce,
                setAttr: function(e, t) {
                    Me ? this.element[e] = t : this.element.setAttribute(e, t)
                },
                classSetter: function(e) {
                    this.element.className = e
                },
                dashstyleSetter: function(e, t, i) {
                    (i.getElementsByTagName("stroke")[0] || m(this.renderer.prepVML(["<stroke/>"]), null, null, i))[t] = e || "solid", this[t] = e
                },
                dSetter: function(e, t, i) {
                    var n = this.shadows,
                        e = e || [];
                    if (this.d = e.join && e.join(" "), i.path = e = this.pathToVML(e), n)
                        for (i = n.length; i--;) n[i].path = n[i].cutOff ? this.cutOffPath(e, n[i].cutOff) : e;
                    this.setAttr(t, e)
                },
                fillSetter: function(e, t, i) {
                    var n = i.nodeName;
                    "SPAN" === n ? i.style.color = e : "IMG" !== n && (i.filled = e !== Ae, this.setAttr("fillcolor", this.renderer.color(e, i, t, this)))
                },
                opacitySetter: Ce,
                rotationSetter: function(e, t, i) {
                    i = i.style, this[t] = i[t] = e, i.left = -le(fe(e * _e) + 1) + "px", i.top = le(pe(e * _e)) + "px"
                },
                strokeSetter: function(e, t, i) {
                    this.setAttr("strokecolor", this.renderer.color(e, i, t))
                },
                "stroke-widthSetter": function(e, t, i) {
                    i.stroked = !!e, this[t] = e, s(e) && (e += "px"), this.setAttr("strokeweight", e)
                },
                titleSetter: function(e, t) {
                    this.setAttr(t, e)
                },
                visibilitySetter: function(e, t, i) {
                    "inherit" === e && (e = "visible"), this.shadows && Ye(this.shadows, function(i) {
                        i.style[t] = e
                    }), "DIV" === i.nodeName && (e = "hidden" === e ? "-999em" : 0, Me || (i.style[t] = e ? "visible" : "hidden"), t = "top"), i.style[t] = e
                },
                xSetter: function(e, t, i) {
                    this[t] = e, "x" === t ? t = "left" : "y" === t && (t = "top"), this.updateClipping ? (this[t] = e, this.updateClipping()) : i.style[t] = e
                },
                zIndexSetter: function(e, t, i) {
                    i.style[t] = e
                }
            }, oe.VMLElement = Ge = p(S, Ge), Ge.prototype.ySetter = Ge.prototype.widthSetter = Ge.prototype.heightSetter = Ge.prototype.xSetter;
            var dt = {
                Element: Ge,
                isIE8: be.indexOf("MSIE 8.0") > -1,
                init: function(e, t, i, n) {
                    var o;
                    if (this.alignedObjects = [], n = this.createElement(Pe).css(Ve(this.getStyle(n), {
                            position: "relative"
                        })), o = n.element, e.appendChild(n.element), this.isVML = !0, this.box = o, this.boxWrapper = n, this.cache = {}, this.setSize(t, i, !1), !se.namespaces.hcv) {
                        se.namespaces.add("hcv", "urn:schemas-microsoft-com:vml");
                        try {
                            se.createStyleSheet().cssText = "hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "
                        } catch (s) {
                            se.styleSheets[0].cssText += "hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } "
                        }
                    }
                },
                isHidden: function() {
                    return !this.box.offsetWidth
                },
                clipRect: function(e, t, i, o) {
                    var s = this.createElement(),
                        r = n(e);
                    return Ve(s, {
                        members: [],
                        count: 0,
                        left: (r ? e.x : e) + 1,
                        top: (r ? e.y : t) + 1,
                        width: (r ? e.width : i) - 1,
                        height: (r ? e.height : o) - 1,
                        getCSS: function(e) {
                            var t = e.element,
                                i = t.nodeName,
                                e = e.inverted,
                                n = this.top - ("shape" === i ? t.offsetTop : 0),
                                o = this.left,
                                t = o + this.width,
                                s = n + this.height,
                                n = {
                                    clip: "rect(" + le(e ? o : n) + "px," + le(e ? s : t) + "px," + le(e ? t : s) + "px," + le(e ? n : o) + "px)"
                                };
                            return !e && Me && "DIV" === i && Ve(n, {
                                width: t + "px",
                                height: s + "px"
                            }), n
                        },
                        updateClipping: function() {
                            Ye(s.members, function(e) {
                                e.element && e.css(s.getCSS(e))
                            })
                        }
                    })
                },
                color: function(e, t, i, n) {
                    var o, s, r, a = this,
                        l = /^rgba/,
                        c = Ae;
                    if (e && e.linearGradient ? r = "gradient" : e && e.radialGradient && (r = "pattern"), r) {
                        var d, u, h, p, f, g, _, b, y = e.linearGradient || e.radialGradient,
                            v = "",
                            e = e.stops,
                            M = [],
                            k = function() {
                                s = ['<fill colors="' + M.join(",") + '" opacity="', f, '" o:opacity2="', p, '" type="', r, '" ', v, 'focus="100%" method="any" />'], m(a.prepVML(s), null, null, t)
                            };
                        if (h = e[0], b = e[e.length - 1], h[0] > 0 && e.unshift([0, h[1]]), b[0] < 1 && e.push([1, b[1]]), Ye(e, function(e, t) {
                                l.test(e[1]) ? (o = lt(e[1]), d = o.get("rgb"), u = o.get("a")) : (d = e[1], u = 1), M.push(100 * e[0] + "% " + d), t ? (f = u, g = d) : (p = u, _ = d)
                            }), "fill" === i)
                            if ("gradient" === r) i = y.x1 || y[0] || 0, e = y.y1 || y[1] || 0, h = y.x2 || y[2] || 0, y = y.y2 || y[3] || 0, v = 'angle="' + (90 - 180 * ae.atan((y - e) / (h - i)) / ge) + '"', k();
                            else {
                                var B, c = y.r,
                                    w = 2 * c,
                                    x = 2 * c,
                                    E = y.cx,
                                    N = y.cy,
                                    I = t.radialReference,
                                    c = function() {
                                        I && (B = n.getBBox(), E += (I[0] - B.x) / B.width - .5, N += (I[1] - B.y) / B.height - .5, w *= I[2] / B.width, x *= I[2] / B.height), v = 'src="' + L.global.VMLRadialGradientURL + '" size="' + w + "," + x + '" origin="0.5,0.5" position="' + E + "," + N + '" color2="' + _ + '" ', k()
                                    };
                                n.added ? c() : n.onAdd = c, c = g
                            } else c = d
                    } else l.test(e) && "IMG" !== t.tagName ? (o = lt(e), s = ["<", i, ' opacity="', o.get("a"), '"/>'], m(this.prepVML(s), null, null, t), c = o.get("rgb")) : (c = t.getElementsByTagName(i), c.length && (c[0].opacity = 1, c[0].type = "solid"), c = e);
                    return c
                },
                prepVML: function(e) {
                    var t = this.isIE8,
                        e = e.join("");
                    return t ? (e = e.replace("/>", ' xmlns="urn:schemas-microsoft-com:vml" />'), e = -1 === e.indexOf('style="') ? e.replace("/>", ' style="display:inline-block;behavior:url(#default#VML);" />') : e.replace('style="', 'style="display:inline-block;behavior:url(#default#VML);')) : e = e.replace("<", "<hcv:"), e
                },
                text: ct.prototype.html,
                path: function(e) {
                    var t = {
                        coordsize: "10 10"
                    };
                    return o(e) ? t.d = e : n(e) && Ve(t, e), this.createElement("shape").attr(t)
                },
                circle: function(e, t, i) {
                    var o = this.symbol("circle");
                    return n(e) && (i = e.r, t = e.y, e = e.x), o.isCircle = !0, o.r = i, o.attr({
                        x: e,
                        y: t
                    })
                },
                g: function(e) {
                    var t;
                    return e && (t = {
                        className: "highcharts-" + e,
                        "class": "highcharts-" + e
                    }), this.createElement(Pe).attr(t)
                },
                image: function(e, t, i, n, o) {
                    var s = this.createElement("img").attr({
                        src: e
                    });
                    return arguments.length > 1 && s.attr({
                        x: t,
                        y: i,
                        width: n,
                        height: o
                    }), s
                },
                createElement: function(e) {
                    return "rect" === e ? this.symbol(e) : ct.prototype.createElement.call(this, e)
                },
                invertChild: function(e, i) {
                    var n = this,
                        o = i.style,
                        s = "IMG" === e.tagName && e.style;
                    h(e, {
                        flip: "x",
                        left: t(o.width) - (s ? t(s.top) : 1),
                        top: t(o.height) - (s ? t(s.left) : 1),
                        rotation: -90
                    }), Ye(e.childNodes, function(t) {
                        n.invertChild(t, e)
                    })
                },
                symbols: {
                    arc: function(e, t, i, n, o) {
                        var s = o.start,
                            r = o.end,
                            a = o.r || i || n,
                            i = o.innerR,
                            n = pe(s),
                            l = fe(s),
                            c = pe(r),
                            d = fe(r);
                        return r - s === 0 ? ["x"] : (s = ["wa", e - a, t - a, e + a, t + a, e + a * n, t + a * l, e + a * c, t + a * d], o.open && !i && s.push("e", "M", e, t), s.push("at", e - i, t - i, e + i, t + i, e + i * c, t + i * d, e + i * n, t + i * l, "x", "e"), s.isArc = !0, s)
                    },
                    circle: function(e, t, i, n, o) {
                        return o && (i = n = 2 * o.r), o && o.isCircle && (e -= i / 2, t -= n / 2), ["wa", e, t, e + i, t + n, e + i, t + n / 2, e + i, t + n / 2, "e"]
                    },
                    rect: function(e, t, i, n, o) {
                        return ct.prototype.symbols[c(o) && o.r ? "callout" : "square"].call(0, e, t, i, n, o)
                    }
                }
            };
            oe.VMLRenderer = Ge = function() {
                this.init.apply(this, arguments)
            }, Ge.prototype = e(ct.prototype, dt), O = Ge
        }
        ct.prototype.measureSpanWidth = function(e, t) {
            var i, n = se.createElement("span");
            return i = se.createTextNode(e), n.appendChild(i), h(n, t), this.box.appendChild(n), i = n.offsetWidth, w(n), i
        };
        var ut;
        Ie && (oe.CanVGRenderer = Ge = function() {
            xe = "http://www.w3.org/1999/xhtml"
        }, Ge.prototype.symbols = {}, ut = function() {
            function e() {
                var e, i = t.length;
                for (e = 0; i > e; e++) t[e]();
                t = []
            }
            var t = [];
            return {
                push: function(i, n) {
                    0 === t.length && We(n, e), t.push(i)
                }
            }
        }(), O = Ge), D.prototype = {
            addLabel: function() {
                var t, i = this.axis,
                    n = i.options,
                    o = i.chart,
                    s = i.categories,
                    r = i.names,
                    l = this.pos,
                    d = n.labels,
                    u = i.tickPositions,
                    h = l === u[0],
                    m = l === u[u.length - 1],
                    r = s ? ze(s[l], r[l], l) : l,
                    s = this.label,
                    u = u.info;
                i.isDatetimeAxis && u && (t = n.dateTimeLabelFormats[u.higherRanks[l] || u.unitName]), this.isFirst = h, this.isLast = m, n = i.labelFormatter.call({
                    axis: i,
                    chart: o,
                    isFirst: h,
                    isLast: m,
                    dateTimeLabelFormat: t,
                    value: i.isLog ? E(a(r)) : r
                }), c(s) ? s && s.attr({
                    text: n
                }) : (this.labelLength = (this.label = s = c(n) && d.enabled ? o.renderer.text(n, 0, 0, d.useHTML).css(e(d.style)).add(i.labelGroup) : null) && s.getBBox().width, this.rotation = 0)
            },
            getLabelSize: function() {
                return this.label ? this.label.getBBox()[this.axis.horiz ? "height" : "width"] : 0
            },
            handleOverflow: function(e) {
                var t, i = this.axis,
                    n = e.x,
                    o = i.chart.chartWidth,
                    s = i.chart.spacing,
                    r = ze(i.labelLeft, s[3]),
                    s = ze(i.labelRight, o - s[1]),
                    a = this.label,
                    l = this.rotation,
                    c = {
                        left: 0,
                        center: .5,
                        right: 1
                    }[i.labelAlign],
                    d = a.getBBox().width,
                    u = i.slotWidth;
                l ? 0 > l && r > n - c * d ? t = le(n / pe(l * _e) - r) : l > 0 && n + c * d > s && (t = le((o - n) / pe(l * _e))) : (o = n - c * d, n += c * d, r > o ? (u -= r - o, e.x = r, a.attr({
                    align: "left"
                })) : n > s && (u -= n - s, e.x = s, a.attr({
                    align: "right"
                })), (d > u || i.autoRotation && a.styles.width) && (t = u)), t && a.css({
                    width: t,
                    textOverflow: "ellipsis"
                })
            },
            getPosition: function(e, t, i, n) {
                var o = this.axis,
                    s = o.chart,
                    r = n && s.oldChartHeight || s.chartHeight;
                return {
                    x: e ? o.translate(t + i, null, null, n) + o.transB : o.left + o.offset + (o.opposite ? (n && s.oldChartWidth || s.chartWidth) - o.right - o.left : 0),
                    y: e ? r - o.bottom + o.offset - (o.opposite ? o.height : 0) : r - o.translate(t + i, null, null, n) - o.transB
                }
            },
            getLabelPosition: function(e, t, i, n, o, s, r, a) {
                var l = this.axis,
                    c = l.transA,
                    d = l.reversed,
                    u = l.staggerLines,
                    h = l.tickRotCorr || {
                        x: 0,
                        y: 0
                    },
                    i = ze(o.y, h.y + (2 === l.side ? 8 : -(i.getBBox().height / 2))),
                    e = e + o.x + h.x - (s && n ? s * c * (d ? -1 : 1) : 0),
                    t = t + i - (s && !n ? s * c * (d ? 1 : -1) : 0);
                return u && (t += r / (a || 1) % u * (l.labelOffset / u)), {
                    x: e,
                    y: le(t)
                }
            },
            getMarkPath: function(e, t, i, n, o, s) {
                return s.crispLine(["M", e, t, "L", e + (o ? 0 : -i), t + (o ? i : 0)], n)
            },
            render: function(e, t, i) {
                var n = this.axis,
                    o = n.options,
                    s = n.chart.renderer,
                    r = n.horiz,
                    a = this.type,
                    l = this.label,
                    c = this.pos,
                    d = o.labels,
                    u = this.gridLine,
                    h = a ? a + "Grid" : "grid",
                    m = a ? a + "Tick" : "tick",
                    p = o[h + "LineWidth"],
                    f = o[h + "LineColor"],
                    g = o[h + "LineDashStyle"],
                    _ = o[m + "Length"],
                    h = o[m + "Width"] || 0,
                    b = o[m + "Color"],
                    y = o[m + "Position"],
                    m = this.mark,
                    v = d.step,
                    M = !0,
                    k = n.tickmarkOffset,
                    B = this.getPosition(r, c, k, t),
                    w = B.x,
                    B = B.y,
                    x = r && w === n.pos + n.len || !r && B === n.pos ? -1 : 1,
                    i = ze(i, 1);
                this.isActive = !0, p && (c = n.getPlotLinePath(c + k, p * x, t, !0), u === T && (u = {
                    stroke: f,
                    "stroke-width": p
                }, g && (u.dashstyle = g), a || (u.zIndex = 1), t && (u.opacity = 0), this.gridLine = u = p ? s.path(c).attr(u).add(n.gridGroup) : null), !t && u && c && u[this.isNew ? "attr" : "animate"]({
                    d: c,
                    opacity: i
                })), h && _ && ("inside" === y && (_ = -_), n.opposite && (_ = -_), a = this.getMarkPath(w, B, _, h * x, r, s), m ? m.animate({
                    d: a,
                    opacity: i
                }) : this.mark = s.path(a).attr({
                    stroke: b,
                    "stroke-width": h,
                    opacity: i
                }).add(n.axisGroup)), l && !isNaN(w) && (l.xy = B = this.getLabelPosition(w, B, l, r, d, k, e, v), this.isFirst && !this.isLast && !ze(o.showFirstLabel, 1) || this.isLast && !this.isFirst && !ze(o.showLastLabel, 1) ? M = !1 : r && !n.isRadial && !d.step && !d.rotation && !t && 0 !== i && this.handleOverflow(B), v && e % v && (M = !1), M && !isNaN(B.y) ? (B.opacity = i, l[this.isNew ? "attr" : "animate"](B), this.isNew = !1) : l.attr("y", -9999))
            },
            destroy: function() {
                B(this, this.axis)
            }
        }, oe.PlotLineOrBand = function(e, t) {
            this.axis = e, t && (this.options = t, this.id = t.id)
        }, oe.PlotLineOrBand.prototype = {
            render: function() {
                var t, i = this,
                    n = i.axis,
                    o = n.horiz,
                    s = i.options,
                    a = s.label,
                    l = i.label,
                    d = s.width,
                    u = s.to,
                    h = s.from,
                    m = c(h) && c(u),
                    p = s.value,
                    f = s.dashStyle,
                    g = i.svgElem,
                    _ = [],
                    b = s.color,
                    y = s.zIndex,
                    v = s.events,
                    B = {},
                    w = n.chart.renderer;
                if (n.isLog && (h = r(h), u = r(u), p = r(p)), d) _ = n.getPlotLinePath(p, d), B = {
                    stroke: b,
                    "stroke-width": d
                }, f && (B.dashstyle = f);
                else {
                    if (!m) return;
                    _ = n.getPlotBandPath(h, u, s), b && (B.fill = b), s.borderWidth && (B.stroke = s.borderColor, B["stroke-width"] = s.borderWidth)
                }
                if (c(y) && (B.zIndex = y), g) _ ? g.animate({
                    d: _
                }, null, g.onGetPath) : (g.hide(), g.onGetPath = function() {
                    g.show()
                }, l && (i.label = l = l.destroy()));
                else if (_ && _.length && (i.svgElem = g = w.path(_).attr(B).add(), v))
                    for (t in s = function(e) {
                            g.on(e, function(t) {
                                v[e].apply(i, [t])
                            })
                        }, v) s(t);
                return a && c(a.text) && _ && _.length && n.width > 0 && n.height > 0 ? (a = e({
                    align: o && m && "center",
                    x: o ? !m && 4 : 10,
                    verticalAlign: !o && m && "middle",
                    y: o ? m ? 16 : 10 : m ? 6 : -4,
                    rotation: o && !m && 90
                }, a), l || (B = {
                    align: a.textAlign || a.align,
                    rotation: a.rotation
                }, c(y) && (B.zIndex = y), i.label = l = w.text(a.text, 0, 0, a.useHTML).attr(B).css(a.style).add()), n = [_[1], _[4], m ? _[6] : _[1]], m = [_[2], _[5], m ? _[7] : _[2]], _ = M(n), o = M(m), l.align(a, !1, {
                    x: _,
                    y: o,
                    width: k(n) - _,
                    height: k(m) - o
                }), l.show()) : l && l.hide(), i
            },
            destroy: function() {
                l(this.axis.plotLinesAndBands, this), delete this.axis, B(this)
            }
        };
        var ht = oe.Axis = function() {
            this.init.apply(this, arguments)
        };
        ht.prototype = {
            defaultOptions: {
                dateTimeLabelFormats: {
                    millisecond: "%H:%M:%S.%L",
                    second: "%H:%M:%S",
                    minute: "%H:%M",
                    hour: "%H:%M",
                    day: "%e. %b",
                    week: "%e. %b",
                    month: "%b '%y",
                    year: "%Y"
                },
                endOnTick: !1,
                gridLineColor: "#D8D8D8",
                labels: {
                    enabled: !0,
                    style: {
                        color: "#606060",
                        cursor: "default",
                        fontSize: "11px"
                    },
                    x: 0,
                    y: 15
                },
                lineColor: "#C0D0E0",
                lineWidth: 1,
                minPadding: .01,
                maxPadding: .01,
                minorGridLineColor: "#E0E0E0",
                minorGridLineWidth: 1,
                minorTickColor: "#A0A0A0",
                minorTickLength: 2,
                minorTickPosition: "outside",
                startOfWeek: 1,
                startOnTick: !1,
                tickColor: "#C0D0E0",
                tickLength: 10,
                tickmarkPlacement: "between",
                tickPixelInterval: 100,
                tickPosition: "outside",
                tickWidth: 1,
                title: {
                    align: "middle",
                    style: {
                        color: "#707070"
                    }
                },
                type: "linear"
            },
            defaultYAxisOptions: {
                endOnTick: !0,
                gridLineWidth: 1,
                tickPixelInterval: 72,
                showLastLabel: !0,
                labels: {
                    x: -8,
                    y: 3
                },
                lineWidth: 0,
                maxPadding: .05,
                minPadding: .05,
                startOnTick: !0,
                tickWidth: 0,
                title: {
                    rotation: 270,
                    text: "Values"
                },
                stackLabels: {
                    enabled: !1,
                    formatter: function() {
                        return oe.numberFormat(this.total, -1)
                    },
                    style: e(ot.line.dataLabels.style, {
                        color: "#000000"
                    })
                }
            },
            defaultLeftAxisOptions: {
                labels: {
                    x: -15,
                    y: null
                },
                title: {
                    rotation: 270
                }
            },
            defaultRightAxisOptions: {
                labels: {
                    x: 15,
                    y: null
                },
                title: {
                    rotation: 90
                }
            },
            defaultBottomAxisOptions: {
                labels: {
                    autoRotation: [-45],
                    x: 0,
                    y: null
                },
                title: {
                    rotation: 0
                }
            },
            defaultTopAxisOptions: {
                labels: {
                    autoRotation: [-45],
                    x: 0,
                    y: -15
                },
                title: {
                    rotation: 0
                }
            },
            init: function(e, t) {
                var i = t.isX;
                this.horiz = e.inverted ? !i : i, this.coll = (this.isXAxis = i) ? "xAxis" : "yAxis", this.opposite = t.opposite, this.side = t.side || (this.horiz ? this.opposite ? 0 : 2 : this.opposite ? 1 : 3), this.setOptions(t);
                var n = this.options,
                    o = n.type;
                this.labelFormatter = n.labels.formatter || this.defaultLabelFormatter, this.userOptions = t, this.minPixelPadding = 0, this.chart = e, this.reversed = n.reversed, this.zoomEnabled = n.zoomEnabled !== !1, this.categories = n.categories || "category" === o, this.names = this.names || [], this.isLog = "logarithmic" === o, this.isDatetimeAxis = "datetime" === o, this.isLinked = c(n.linkedTo), this.ticks = {}, this.labelEdge = [], this.minorTicks = {}, this.plotLinesAndBands = [], this.alternateBands = {}, this.len = 0, this.minRange = this.userMinRange = n.minRange || n.maxZoom, this.range = n.range, this.offset = n.offset || 0, this.stacks = {}, this.oldStacks = {}, this.min = this.max = null, this.crosshair = ze(n.crosshair, u(e.options.tooltip.crosshairs)[i ? 0 : 1], !1);
                var s, n = this.options.events; - 1 === Je(this, e.axes) && (i && !this.isColorAxis ? e.axes.splice(e.xAxis.length, 0, this) : e.axes.push(this), e[this.coll].push(this)), this.series = this.series || [], e.inverted && i && this.reversed === T && (this.reversed = !0), this.removePlotLine = this.removePlotBand = this.removePlotBandOrLine;
                for (s in n) Ke(this, s, n[s]);
                this.isLog && (this.val2lin = r, this.lin2val = a)
            },
            setOptions: function(t) {
                this.options = e(this.defaultOptions, this.isXAxis ? {} : this.defaultYAxisOptions, [this.defaultTopAxisOptions, this.defaultRightAxisOptions, this.defaultBottomAxisOptions, this.defaultLeftAxisOptions][this.side], e(L[this.coll], t))
            },
            defaultLabelFormatter: function() {
                var e, t = this.axis,
                    i = this.value,
                    n = t.categories,
                    o = this.dateTimeLabelFormat,
                    s = L.lang.numericSymbols,
                    r = s && s.length,
                    a = t.options.labels.format,
                    t = t.isLog ? i : t.tickInterval;
                if (a) e = _(a, this);
                else if (n) e = i;
                else if (o) e = R(o, i);
                else if (r && t >= 1e3)
                    for (; r-- && e === T;) n = Math.pow(1e3, r + 1), t >= n && null !== s[r] && (e = oe.numberFormat(i / n, -1) + s[r]);
                return e === T && (e = me(i) >= 1e4 ? oe.numberFormat(i, 0) : oe.numberFormat(i, -1, T, "")), e
            },
            getSeriesExtremes: function() {
                var e = this,
                    t = e.chart;
                e.hasVisibleSeries = !1, e.dataMin = e.dataMax = e.ignoreMinPadding = e.ignoreMaxPadding = null, e.buildStacks && e.buildStacks(), Ye(e.series, function(i) {
                    if (i.visible || !t.options.chart.ignoreHiddenSeries) {
                        var n;
                        n = i.options.threshold;
                        var o;
                        e.hasVisibleSeries = !0, e.isLog && 0 >= n && (n = null), e.isXAxis ? (n = i.xData, n.length && (e.dataMin = he(ze(e.dataMin, n[0]), M(n)), e.dataMax = ue(ze(e.dataMax, n[0]), k(n)))) : (i.getExtremes(), o = i.dataMax, i = i.dataMin, c(i) && c(o) && (e.dataMin = he(ze(e.dataMin, i), i), e.dataMax = ue(ze(e.dataMax, o), o)), c(n) && (e.dataMin >= n ? (e.dataMin = n, e.ignoreMinPadding = !0) : e.dataMax < n && (e.dataMax = n, e.ignoreMaxPadding = !0)))
                    }
                })
            },
            translate: function(e, t, i, n, o, r) {
                var a = 1,
                    l = 0,
                    c = n ? this.oldTransA : this.transA,
                    n = n ? this.oldMin : this.min,
                    d = this.minPixelPadding,
                    o = (this.doPostTranslate || this.isLog && o) && this.lin2val;
                return c || (c = this.transA), i && (a *= -1, l = this.len), this.reversed && (a *= -1, l -= a * (this.sector || this.len)), t ? (e = e * a + l, e -= d, e = e / c + n, o && (e = this.lin2val(e))) : (o && (e = this.val2lin(e)), "between" === r && (r = .5), e = a * (e - n) * c + l + a * d + (s(r) ? c * r * this.pointRange : 0)), e
            },
            toPixels: function(e, t) {
                return this.translate(e, !1, !this.horiz, null, !0) + (t ? 0 : this.pos)
            },
            toValue: function(e, t) {
                return this.translate(e - (t ? 0 : this.pos), !0, !this.horiz, null, !0)
            },
            getPlotLinePath: function(e, t, i, n, o) {
                var s, r, a, l = this.chart,
                    c = this.left,
                    d = this.top,
                    u = i && l.oldChartHeight || l.chartHeight,
                    h = i && l.oldChartWidth || l.chartWidth;
                s = this.transB;
                var m = function(e, t, i) {
                        return (t > e || e > i) && (n ? e = he(ue(t, e), i) : a = !0), e
                    },
                    o = ze(o, this.translate(e, null, null, i)),
                    e = i = le(o + s);
                return s = r = le(u - o - s), isNaN(o) ? a = !0 : this.horiz ? (s = d, r = u - this.bottom, e = i = m(e, c, c + this.width)) : (e = c, i = h - this.right, s = r = m(s, d, d + this.height)), a && !n ? null : l.renderer.crispLine(["M", e, s, "L", i, r], t || 1)
            },
            getLinearTickPositions: function(e, t, i) {
                var n, o = E(ce(t / e) * e),
                    r = E(de(i / e) * e),
                    a = [];
                if (t === i && s(t)) return [t];
                for (t = o; r >= t && (a.push(t), t = E(t + e), t !== n);) n = t;
                return a
            },
            getMinorTickPositions: function() {
                var e, t = this.options,
                    i = this.tickPositions,
                    n = this.minorTickInterval,
                    o = [],
                    s = this.min;
                e = this.max;
                var r = e - s;
                if (r && r / n < this.len / 3)
                    if (this.isLog)
                        for (t = i.length, e = 1; t > e; e++) o = o.concat(this.getLogTickPositions(n, i[e - 1], i[e], !0));
                    else if (this.isDatetimeAxis && "auto" === t.minorTickInterval) o = o.concat(this.getTimeTicks(this.normalizeTimeTickInterval(n), s, e, t.startOfWeek));
                else
                    for (i = s + (i[0] - s) % n; e >= i; i += n) o.push(i);
                return this.trimTicks(o), o
            },
            adjustForMinRange: function() {
                var e, t, i, n, o, s, r = this.options,
                    a = this.min,
                    l = this.max,
                    d = this.dataMax - this.dataMin >= this.minRange;
                if (this.isXAxis && this.minRange === T && !this.isLog && (c(r.min) || c(r.max) ? this.minRange = null : (Ye(this.series, function(e) {
                        for (o = e.xData, i = s = e.xIncrement ? 1 : o.length - 1; i > 0; i--) n = o[i] - o[i - 1], (t === T || t > n) && (t = n)
                    }), this.minRange = he(5 * t, this.dataMax - this.dataMin))), l - a < this.minRange) {
                    var u = this.minRange;
                    e = (u - l + a) / 2, e = [a - e, ze(r.min, a - e)], d && (e[2] = this.dataMin), a = k(e), l = [a + u, ze(r.max, a + u)], d && (l[2] = this.dataMax), l = M(l), u > l - a && (e[0] = l - u, e[1] = ze(r.min, l - u), a = k(e))
                }
                this.min = a, this.max = l
            },
            setAxisTranslation: function(e) {
                var t, n = this,
                    o = n.max - n.min,
                    s = n.axisPointRange || 0,
                    r = 0,
                    a = 0,
                    l = n.linkedParent,
                    d = !!n.categories,
                    u = n.transA,
                    h = n.isXAxis;
                (h || d || s) && (l ? (r = l.minPointOffset, a = l.pointRangePadding) : Ye(n.series, function(e) {
                    var l = d ? 1 : h ? e.pointRange : n.axisPointRange || 0,
                        u = e.options.pointPlacement,
                        m = e.closestPointRange;
                    l > o && (l = 0), s = ue(s, l), n.single || (r = ue(r, i(u) ? 0 : l / 2), a = ue(a, "on" === u ? 0 : l)), !e.noSharedTooltip && c(m) && (t = c(t) ? he(t, m) : m)
                }), l = n.ordinalSlope && t ? n.ordinalSlope / t : 1, n.minPointOffset = r *= l, n.pointRangePadding = a *= l, n.pointRange = he(s, o), h && (n.closestPointRange = t)), e && (n.oldTransA = u), n.translationSlope = n.transA = u = n.len / (o + a || 1), n.transB = n.horiz ? n.left : n.bottom, n.minPixelPadding = u * r
            },
            setTickInterval: function(e) {
                var t = this,
                    i = t.chart,
                    n = t.options,
                    o = t.isLog,
                    a = t.isDatetimeAxis,
                    l = t.isXAxis,
                    d = t.isLinked,
                    u = n.maxPadding,
                    h = n.minPadding,
                    m = n.tickInterval,
                    p = n.tickPixelInterval,
                    f = t.categories;
                !a && !f && !d && this.getTickAmount(), d ? (t.linkedParent = i[t.coll][n.linkedTo], i = t.linkedParent.getExtremes(), t.min = ze(i.min, i.dataMin), t.max = ze(i.max, i.dataMax), n.type !== t.linkedParent.options.type && x(11, 1)) : (t.min = ze(t.userMin, n.min, t.dataMin), t.max = ze(t.userMax, n.max, t.dataMax)), o && (!e && he(t.min, ze(t.dataMin, t.min)) <= 0 && x(10, 1), t.min = E(r(t.min)), t.max = E(r(t.max))), t.range && c(t.max) && (t.userMin = t.min = ue(t.min, t.max - t.range), t.userMax = t.max, t.range = null), t.beforePadding && t.beforePadding(), t.adjustForMinRange(), f || t.axisPointRange || t.usePercentage || d || !c(t.min) || !c(t.max) || !(i = t.max - t.min) || (c(n.min) || c(t.userMin) || !h || !(t.dataMin < 0) && t.ignoreMinPadding || (t.min -= i * h), c(n.max) || c(t.userMax) || !u || !(t.dataMax > 0) && t.ignoreMaxPadding || (t.max += i * u)), s(n.floor) && (t.min = ue(t.min, n.floor)), s(n.ceiling) && (t.max = he(t.max, n.ceiling)), t.tickInterval = t.min === t.max || void 0 === t.min || void 0 === t.max ? 1 : d && !m && p === t.linkedParent.options.tickPixelInterval ? t.linkedParent.tickInterval : ze(m, this.tickAmount ? (t.max - t.min) / ue(this.tickAmount - 1, 1) : void 0, f ? 1 : (t.max - t.min) * p / ue(t.len, p)), l && !e && Ye(t.series, function(e) {
                    e.processData(t.min !== t.oldMin || t.max !== t.oldMax)
                }), t.setAxisTranslation(!0), t.beforeSetTickPositions && t.beforeSetTickPositions(), t.postProcessTickInterval && (t.tickInterval = t.postProcessTickInterval(t.tickInterval)), t.pointRange && (t.tickInterval = ue(t.pointRange, t.tickInterval)), e = ze(n.minTickInterval, t.isDatetimeAxis && t.closestPointRange), !m && t.tickInterval < e && (t.tickInterval = e), a || o || m || (t.tickInterval = y(t.tickInterval, null, b(t.tickInterval), ze(n.allowDecimals, !(t.tickInterval > .5 && t.tickInterval < 5 && t.max > 1e3 && t.max < 9999)), !!this.tickAmount)), !this.tickAmount && this.len && (t.tickInterval = t.unsquish()), this.setTickPositions()
            },
            setTickPositions: function() {
                var e, t, i = this.options,
                    n = i.tickPositions,
                    o = i.tickPositioner,
                    s = i.startOnTick,
                    r = i.endOnTick;
                this.tickmarkOffset = this.categories && "between" === i.tickmarkPlacement && 1 === this.tickInterval ? .5 : 0, this.minorTickInterval = "auto" === i.minorTickInterval && this.tickInterval ? this.tickInterval / 5 : i.minorTickInterval, this.tickPositions = e = i.tickPositions && i.tickPositions.slice(), !e && (this.tickPositions = e = this.isDatetimeAxis ? this.getTimeTicks(this.normalizeTimeTickInterval(this.tickInterval, i.units), this.min, this.max, i.startOfWeek, this.ordinalPositions, this.closestPointRange, !0) : this.isLog ? this.getLogTickPositions(this.tickInterval, this.min, this.max) : this.getLinearTickPositions(this.tickInterval, this.min, this.max), o && (o = o.apply(this, [this.min, this.max]))) && (this.tickPositions = e = o), this.isLinked || (this.trimTicks(e, s, r), this.min === this.max && c(this.min) && !this.tickAmount && (t = !0, this.min -= .5, this.max += .5), this.single = t, !n && !o && this.adjustTickAmount())
            },
            trimTicks: function(e, t, i) {
                var n = e[0],
                    o = e[e.length - 1],
                    s = this.minPointOffset || 0;
                t ? this.min = n : this.min - s > n && e.shift(), i ? this.max = o : this.max + s < o && e.pop(), 0 === e.length && c(n) && e.push((o + n) / 2)
            },
            getTickAmount: function() {
                var e, t = {},
                    i = this.options,
                    n = i.tickAmount,
                    o = i.tickPixelInterval;
                !c(i.tickInterval) && this.len < o && !this.isRadial && !this.isLog && i.startOnTick && i.endOnTick && (n = 2), !n && this.chart.options.chart.alignTicks !== !1 && i.alignTicks !== !1 && (Ye(this.chart[this.coll], function(i) {
                    var n = i.options,
                        i = i.horiz,
                        n = [i ? n.left : n.top, i ? n.width : n.height, n.pane].join(",");
                    t[n] ? e = !0 : t[n] = 1
                }), e && (n = de(this.len / o) + 1)), 4 > n && (this.finalTickAmt = n, n = 5), this.tickAmount = n
            },
            adjustTickAmount: function() {
                var e = this.tickInterval,
                    t = this.tickPositions,
                    i = this.tickAmount,
                    n = this.finalTickAmt,
                    o = t && t.length;
                if (i > o) {
                    for (; t.length < i;) t.push(E(t[t.length - 1] + e));
                    this.transA *= (o - 1) / (i - 1), this.max = t[t.length - 1]
                } else o > i && (this.tickInterval *= 2, this.setTickPositions());
                if (c(n)) {
                    for (e = i = t.length; e--;)(3 === n && e % 2 === 1 || 2 >= n && e > 0 && i - 1 > e) && t.splice(e, 1);
                    this.finalTickAmt = T
                }
            },
            setScale: function() {
                var e, t, i, n, o = this.stacks;
                if (this.oldMin = this.min, this.oldMax = this.max, this.oldAxisLength = this.len, this.setAxisSize(), n = this.len !== this.oldAxisLength, Ye(this.series, function(e) {
                        (e.isDirtyData || e.isDirty || e.xAxis.isDirty) && (i = !0)
                    }), n || i || this.isLinked || this.forceRedraw || this.userMin !== this.oldUserMin || this.userMax !== this.oldUserMax) {
                    if (!this.isXAxis)
                        for (e in o)
                            for (t in o[e]) o[e][t].total = null, o[e][t].cum = 0;
                    this.forceRedraw = !1, this.getSeriesExtremes(), this.setTickInterval(), this.oldUserMin = this.userMin, this.oldUserMax = this.userMax, this.isDirty || (this.isDirty = n || this.min !== this.oldMin || this.max !== this.oldMax)
                } else if (!this.isXAxis) {
                    this.oldStacks && (o = this.stacks = this.oldStacks);
                    for (e in o)
                        for (t in o[e]) o[e][t].cum = o[e][t].total
                }
            },
            setExtremes: function(e, t, i, n, o) {
                var s = this,
                    r = s.chart,
                    i = ze(i, !0);
                Ye(s.series, function(e) {
                    delete e.kdTree
                }), o = Ve(o, {
                    min: e,
                    max: t
                }), et(s, "setExtremes", o, function() {
                    s.userMin = e, s.userMax = t, s.eventArgs = o, s.isDirtyExtremes = !0, i && r.redraw(n)
                })
            },
            zoom: function(e, t) {
                var i = this.dataMin,
                    n = this.dataMax,
                    o = this.options;
                return this.allowZoomOutside || (c(i) && e <= he(i, ze(o.min, i)) && (e = T), c(n) && t >= ue(n, ze(o.max, n)) && (t = T)), this.displayBtn = e !== T || t !== T, this.setExtremes(e, t, !1, T, {
                    trigger: "zoom"
                }), !0
            },
            setAxisSize: function() {
                var e = this.chart,
                    t = this.options,
                    i = t.offsetLeft || 0,
                    n = this.horiz,
                    o = ze(t.width, e.plotWidth - i + (t.offsetRight || 0)),
                    s = ze(t.height, e.plotHeight),
                    r = ze(t.top, e.plotTop),
                    t = ze(t.left, e.plotLeft + i),
                    i = /%$/;
                i.test(s) && (s = parseFloat(s) / 100 * e.plotHeight), i.test(r) && (r = parseFloat(r) / 100 * e.plotHeight + e.plotTop), this.left = t, this.top = r, this.width = o, this.height = s, this.bottom = e.chartHeight - s - r, this.right = e.chartWidth - o - t, this.len = ue(n ? o : s, 0), this.pos = n ? t : r
            },
            getExtremes: function() {
                var e = this.isLog;
                return {
                    min: e ? E(a(this.min)) : this.min,
                    max: e ? E(a(this.max)) : this.max,
                    dataMin: this.dataMin,
                    dataMax: this.dataMax,
                    userMin: this.userMin,
                    userMax: this.userMax
                }
            },
            getThreshold: function(e) {
                var t = this.isLog,
                    i = t ? a(this.min) : this.min,
                    t = t ? a(this.max) : this.max;
                return i > e || null === e ? e = i : e > t && (e = t), this.translate(e, 0, 1, 0, 1)
            },
            autoLabelAlign: function(e) {
                return e = (ze(e, 0) - 90 * this.side + 720) % 360, e > 15 && 165 > e ? "right" : e > 195 && 345 > e ? "left" : "center"
            },
            unsquish: function() {
                var e, t, i, n = this.ticks,
                    o = this.options.labels,
                    s = this.horiz,
                    r = this.tickInterval,
                    a = r,
                    l = this.len / (((this.categories ? 1 : 0) + this.max - this.min) / r),
                    d = o.rotation,
                    u = this.chart.renderer.fontMetrics(o.style.fontSize, n[0] && n[0].label),
                    h = Number.MAX_VALUE,
                    m = function(e) {
                        return e /= l || 1, e = e > 1 ? de(e) : 1, e * r
                    };
                return s ? (i = c(d) ? [d] : l < ze(o.autoRotationLimit, 80) && !o.staggerLines && !o.step && o.autoRotation) && Ye(i, function(i) {
                    var n;
                    (i === d || i && i >= -90 && 90 >= i) && (t = m(me(u.h / fe(_e * i))), n = t + me(i / 360), h > n && (h = n, e = i, a = t))
                }) : a = m(u.h), this.autoRotation = i, this.labelRotation = e, a
            },
            renderUnsquish: function() {
                var t, n = this.chart,
                    o = n.renderer,
                    s = this.tickPositions,
                    r = this.ticks,
                    a = this.options.labels,
                    l = this.horiz,
                    c = n.margin,
                    d = this.slotWidth = l && !a.step && !a.rotation && (this.staggerLines || 1) * n.plotWidth / s.length || !l && (c[3] && c[3] - n.spacing[3] || .33 * n.chartWidth),
                    u = ue(1, le(d - 2 * (a.padding || 5))),
                    h = {},
                    c = o.fontMetrics(a.style.fontSize, r[0] && r[0].label),
                    m = 0;
                if (i(a.rotation) || (h.rotation = a.rotation), this.autoRotation) Ye(s, function(e) {
                    (e = r[e]) && e.labelLength > m && (m = e.labelLength)
                }), m > u && m > c.h ? h.rotation = this.labelRotation : this.labelRotation = 0;
                else if (d)
                    for (t = {
                            width: u + "px",
                            textOverflow: "clip"
                        }, d = s.length; !l && d--;) u = s[d], (u = r[u].label) && ("ellipsis" === u.styles.textOverflow && u.css({
                        textOverflow: "clip"
                    }), u.getBBox().height > this.len / s.length - (c.h - c.f) && (u.specCss = {
                        textOverflow: "ellipsis"
                    }));
                h.rotation && (t = {
                    width: (m > .5 * n.chartHeight ? .33 * n.chartHeight : n.chartHeight) + "px",
                    textOverflow: "ellipsis"
                }), this.labelAlign = h.align = a.align || this.autoLabelAlign(this.labelRotation), Ye(s, function(i) {
                    var n = (i = r[i]) && i.label;
                    n && (t && n.css(e(t, n.specCss)), delete n.specCss, n.attr(h), i.rotation = h.rotation)
                }), this.tickRotCorr = o.rotCorr(c.b, this.labelRotation || 0, 2 === this.side)
            },
            getOffset: function() {
                var e, t, i, n, o = this,
                    s = o.chart,
                    r = s.renderer,
                    a = o.options,
                    l = o.tickPositions,
                    d = o.ticks,
                    u = o.horiz,
                    h = o.side,
                    m = s.inverted ? [1, 0, 3, 2][h] : h,
                    p = 0,
                    f = 0,
                    g = a.title,
                    _ = a.labels,
                    b = 0,
                    y = s.axisOffset,
                    s = s.clipOffset,
                    v = [-1, 1, 1, -1][h];
                if (o.hasData = e = o.hasVisibleSeries || c(o.min) && c(o.max) && !!l, o.showAxis = t = e || ze(a.showEmpty, !0), o.staggerLines = o.horiz && _.staggerLines, o.axisGroup || (o.gridGroup = r.g("grid").attr({
                        zIndex: a.gridZIndex || 1
                    }).add(), o.axisGroup = r.g("axis").attr({
                        zIndex: a.zIndex || 2
                    }).add(), o.labelGroup = r.g("axis-labels").attr({
                        zIndex: _.zIndex || 7
                    }).addClass("highcharts-" + o.coll.toLowerCase() + "-labels").add()), e || o.isLinked) Ye(l, function(e) {
                    d[e] ? d[e].addLabel() : d[e] = new D(o, e)
                }), o.renderUnsquish(), Ye(l, function(e) {
                    (0 === h || 2 === h || {
                        1: "left",
                        3: "right"
                    }[h] === o.labelAlign) && (b = ue(d[e].getLabelSize(), b))
                }), o.staggerLines && (b *= o.staggerLines, o.labelOffset = b);
                else
                    for (n in d) d[n].destroy(), delete d[n];
                g && g.text && g.enabled !== !1 && (o.axisTitle || (o.axisTitle = r.text(g.text, 0, 0, g.useHTML).attr({
                    zIndex: 7,
                    rotation: g.rotation || 0,
                    align: g.textAlign || {
                        low: "left",
                        middle: "center",
                        high: "right"
                    }[g.align]
                }).addClass("highcharts-" + this.coll.toLowerCase() + "-title").css(g.style).add(o.axisGroup), o.axisTitle.isNew = !0), t && (p = o.axisTitle.getBBox()[u ? "height" : "width"], i = g.offset, f = c(i) ? 0 : ze(g.margin, u ? 5 : 10)), o.axisTitle[t ? "show" : "hide"]()), o.offset = v * ze(a.offset, y[h]), o.tickRotCorr = o.tickRotCorr || {
                    x: 0,
                    y: 0
                }, r = 2 === h ? o.tickRotCorr.y : 0, u = b + f + (b && v * (u ? ze(_.y, o.tickRotCorr.y + 8) : _.x) - r), o.axisTitleMargin = ze(i, u), y[h] = ue(y[h], o.axisTitleMargin + p + v * o.offset, u), s[m] = ue(s[m], 2 * ce(a.lineWidth / 2))
            },
            getLinePath: function(e) {
                var t = this.chart,
                    i = this.opposite,
                    n = this.offset,
                    o = this.horiz,
                    s = this.left + (i ? this.width : 0) + n,
                    n = t.chartHeight - this.bottom - (i ? this.height : 0) + n;
                return i && (e *= -1), t.renderer.crispLine(["M", o ? this.left : s, o ? n : this.top, "L", o ? t.chartWidth - this.right : s, o ? n : t.chartHeight - this.bottom], e)
            },
            getTitlePosition: function() {
                var e = this.horiz,
                    i = this.left,
                    n = this.top,
                    o = this.len,
                    s = this.options.title,
                    r = e ? i : n,
                    a = this.opposite,
                    l = this.offset,
                    c = t(s.style.fontSize || 12),
                    o = {
                        low: r + (e ? 0 : o),
                        middle: r + o / 2,
                        high: r + (e ? o : 0)
                    }[s.align],
                    i = (e ? n + this.height : i) + (e ? 1 : -1) * (a ? -1 : 1) * this.axisTitleMargin + (2 === this.side ? c : 0);
                return {
                    x: e ? o : i + (a ? this.width : 0) + l + (s.x || 0),
                    y: e ? i - (a ? this.height : 0) + l : o + (s.y || 0)
                }
            },
            render: function() {
                var e, t = this,
                    i = t.chart,
                    n = i.renderer,
                    o = t.options,
                    s = t.isLog,
                    r = t.isLinked,
                    l = t.tickPositions,
                    d = t.axisTitle,
                    u = t.ticks,
                    h = t.minorTicks,
                    m = t.alternateBands,
                    p = o.stackLabels,
                    f = o.alternateGridColor,
                    g = t.tickmarkOffset,
                    _ = o.lineWidth,
                    b = i.hasRendered && c(t.oldMin) && !isNaN(t.oldMin);
                e = t.hasData;
                var y, v, M = t.showAxis;
                t.labelEdge.length = 0, t.overlap = !1, Ye([u, h, m], function(e) {
                    for (var t in e) e[t].isActive = !1
                }), (e || r) && (t.minorTickInterval && !t.categories && Ye(t.getMinorTickPositions(), function(e) {
                    h[e] || (h[e] = new D(t, e, "minor")), b && h[e].isNew && h[e].render(null, !0), h[e].render(null, !1, 1)
                }), l.length && (Ye(l, function(e, i) {
                    (!r || e >= t.min && e <= t.max) && (u[e] || (u[e] = new D(t, e)), b && u[e].isNew && u[e].render(i, !0, .1), u[e].render(i))
                }), g && (0 === t.min || t.single)) && (u[-1] || (u[-1] = new D(t, -1, null, !0)), u[-1].render(-1)), f && Ye(l, function(e, i) {
                    i % 2 === 0 && e < t.max && (m[e] || (m[e] = new oe.PlotLineOrBand(t)), y = e + g, v = l[i + 1] !== T ? l[i + 1] + g : t.max, m[e].options = {
                        from: s ? a(y) : y,
                        to: s ? a(v) : v,
                        color: f
                    }, m[e].render(), m[e].isActive = !0)
                }), t._addedPlotLB || (Ye((o.plotLines || []).concat(o.plotBands || []), function(e) {
                    t.addPlotBandOrLine(e)
                }), t._addedPlotLB = !0)), Ye([u, h, m], function(e) {
                    var t, n, o = [],
                        s = j ? j.duration || 500 : 0,
                        r = function() {
                            for (n = o.length; n--;) e[o[n]] && !e[o[n]].isActive && (e[o[n]].destroy(), delete e[o[n]])
                        };
                    for (t in e) e[t].isActive || (e[t].render(t, !1, 0), e[t].isActive = !1, o.push(t));
                    e !== m && i.hasRendered && s ? s && setTimeout(r, s) : r()
                }), _ && (e = t.getLinePath(_), t.axisLine ? t.axisLine.animate({
                    d: e
                }) : t.axisLine = n.path(e).attr({
                    stroke: o.lineColor,
                    "stroke-width": _,
                    zIndex: 7
                }).add(t.axisGroup), t.axisLine[M ? "show" : "hide"]()), d && M && (d[d.isNew ? "attr" : "animate"](t.getTitlePosition()), d.isNew = !1), p && p.enabled && t.renderStackTotals(), t.isDirty = !1
            },
            redraw: function() {
                this.render(), Ye(this.plotLinesAndBands, function(e) {
                    e.render()
                }), Ye(this.series, function(e) {
                    e.isDirty = !0
                })
            },
            destroy: function(e) {
                var t, i = this,
                    n = i.stacks,
                    o = i.plotLinesAndBands;
                e || Ze(i);
                for (t in n) B(n[t]), n[t] = null;
                for (Ye([i.ticks, i.minorTicks, i.alternateBands], function(e) {
                        B(e)
                    }), e = o.length; e--;) o[e].destroy();
                Ye("stackTotalGroup,axisLine,axisTitle,axisGroup,cross,gridGroup,labelGroup".split(","), function(e) {
                    i[e] && (i[e] = i[e].destroy())
                }), this.cross && this.cross.destroy()
            },
            drawCrosshair: function(e, t) {
                var i, n = this.crosshair,
                    o = n.animation;
                this.crosshair && (c(t) || !ze(this.crosshair.snap, !0)) !== !1 ? (ze(n.snap, !0) ? c(t) && (i = this.isXAxis ? t.plotX : this.len - t.plotY) : i = this.horiz ? e.chartX - this.pos : this.len - e.chartY + this.pos, i = this.isRadial ? this.getPlotLinePath(this.isXAxis ? t.x : ze(t.stackY, t.y)) || null : this.getPlotLinePath(null, null, null, null, i) || null, null === i ? this.hideCrosshair() : this.cross ? this.cross.attr({
                    visibility: "visible"
                })[o ? "animate" : "attr"]({
                    d: i
                }, o) : (o = this.categories && !this.isRadial, o = {
                    "stroke-width": n.width || (o ? this.transA : 1),
                    stroke: n.color || (o ? "rgba(155,200,255,0.2)" : "#C0C0C0"),
                    zIndex: n.zIndex || 2
                }, n.dashStyle && (o.dashstyle = n.dashStyle), this.cross = this.chart.renderer.path(i).attr(o).add())) : this.hideCrosshair()
            },
            hideCrosshair: function() {
                this.cross && this.cross.hide()
            }
        }, Ve(ht.prototype, {
            getPlotBandPath: function(e, t) {
                var i = this.getPlotLinePath(t, null, null, !0),
                    n = this.getPlotLinePath(e, null, null, !0);
                return n && i && n.toString() !== i.toString() ? n.push(i[4], i[5], i[1], i[2]) : n = null, n
            },
            addPlotBand: function(e) {
                return this.addPlotBandOrLine(e, "plotBands")
            },
            addPlotLine: function(e) {
                return this.addPlotBandOrLine(e, "plotLines")
            },
            addPlotBandOrLine: function(e, t) {
                var i = new oe.PlotLineOrBand(this, e).render(),
                    n = this.userOptions;
                return i && (t && (n[t] = n[t] || [], n[t].push(e)), this.plotLinesAndBands.push(i)), i
            },
            removePlotBandOrLine: function(e) {
                for (var t = this.plotLinesAndBands, i = this.options, n = this.userOptions, o = t.length; o--;) t[o].id === e && t[o].destroy();
                Ye([i.plotLines || [], n.plotLines || [], i.plotBands || [], n.plotBands || []], function(t) {
                    for (o = t.length; o--;) t[o].id === e && l(t, t[o])
                })
            }
        }), ht.prototype.getTimeTicks = function(e, t, i, n) {
            var o, s = [],
                r = {},
                a = L.global.useUTC,
                l = new z(t - g(t)),
                d = e.unitRange,
                u = e.count;
            if (c(t)) {
                l[X](d >= V.second ? 0 : u * ce(l.getMilliseconds() / u)), d >= V.second && l[K](d >= V.minute ? 0 : u * ce(l.getSeconds() / u)), d >= V.minute && l[Z](d >= V.hour ? 0 : u * ce(l[q]() / u)), d >= V.hour && l[ee](d >= V.day ? 0 : u * ce(l[W]() / u)), d >= V.day && l[te](d >= V.month ? 1 : u * ce(l[Y]() / u)), d >= V.month && (l[ie](d >= V.year ? 0 : u * ce(l[$]() / u)), o = l[Q]()), d >= V.year && (o -= o % u, l[ne](o)), d === V.week && l[te](l[Y]() - l[J]() + ze(n, 1)), t = 1, (U || G) && (l = l.getTime(), l = new z(l + g(l))), o = l[Q]();
                for (var n = l.getTime(), h = l[$](), m = l[Y](), p = (V.day + (a ? g(l) : 6e4 * l.getTimezoneOffset())) % V.day; i > n;) s.push(n), d === V.year ? n = H(o + t * u, 0) : d === V.month ? n = H(o, h + t * u) : a || d !== V.day && d !== V.week ? n += d * u : n = H(o, h, m + t * u * (d === V.day ? 1 : 7)), t++;
                s.push(n), Ye($e(s, function(e) {
                    return d <= V.hour && e % V.day === p
                }), function(e) {
                    r[e] = "day"
                })
            }
            return s.info = Ve(e, {
                higherRanks: r,
                totalRange: d * u
            }), s
        }, ht.prototype.normalizeTimeTickInterval = function(e, t) {
            var i, n = t || [
                    ["millisecond", [1, 2, 5, 10, 20, 25, 50, 100, 200, 500]],
                    ["second", [1, 2, 5, 10, 15, 30]],
                    ["minute", [1, 2, 5, 10, 15, 30]],
                    ["hour", [1, 2, 3, 4, 6, 8, 12]],
                    ["day", [1, 2]],
                    ["week", [1, 2]],
                    ["month", [1, 2, 3, 4, 6]],
                    ["year", null]
                ],
                o = n[n.length - 1],
                s = V[o[0]],
                r = o[1];
            for (i = 0; i < n.length && (o = n[i], s = V[o[0]], r = o[1], !(n[i + 1] && e <= (s * r[r.length - 1] + V[n[i + 1][0]]) / 2)); i++);
            return s === V.year && 5 * s > e && (r = [1, 2, 5]), n = y(e / s, r, "year" === o[0] ? ue(b(e / s), 1) : 1), {
                unitRange: s,
                count: n,
                unitName: o[0]
            }
        }, ht.prototype.getLogTickPositions = function(e, t, i, n) {
            var o = this.options,
                s = this.len,
                l = [];
            if (n || (this._minorAutoInterval = null), e >= .5) e = le(e), l = this.getLinearTickPositions(e, t, i);
            else if (e >= .08)
                for (var c, d, u, h, m, s = ce(t), o = e > .3 ? [1, 2, 4] : e > .15 ? [1, 2, 4, 6, 8] : [1, 2, 3, 4, 5, 6, 7, 8, 9]; i + 1 > s && !m; s++)
                    for (d = o.length, c = 0; d > c && !m; c++) u = r(a(s) * o[c]), u > t && (!n || i >= h) && h !== T && l.push(h), h > i && (m = !0), h = u;
            else t = a(t), i = a(i), e = o[n ? "minorTickInterval" : "tickInterval"], e = ze("auto" === e ? null : e, this._minorAutoInterval, (i - t) * (o.tickPixelInterval / (n ? 5 : 1)) / ((n ? s / this.tickPositions.length : s) || 1)), e = y(e, null, b(e)), l = Xe(this.getLinearTickPositions(e, t, i), r), n || (this._minorAutoInterval = e / 5);
            return n || (this.tickInterval = e), l
        };
        var mt = oe.Tooltip = function() {
            this.init.apply(this, arguments)
        };
        mt.prototype = {
            init: function(e, i) {
                var n = i.borderWidth,
                    o = i.style,
                    s = t(o.padding);
                this.chart = e, this.options = i, this.crosshairs = [], this.now = {
                    x: 0,
                    y: 0
                }, this.isHidden = !0, this.label = e.renderer.label("", 0, 0, i.shape || "callout", null, null, i.useHTML, null, "tooltip").attr({
                    padding: s,
                    fill: i.backgroundColor,
                    "stroke-width": n,
                    r: i.borderRadius,
                    zIndex: 8
                }).css(o).css({
                    padding: 0
                }).add().attr({
                    y: -9999
                }), Ie || this.label.shadow(i.shadow), this.shared = i.shared
            },
            destroy: function() {
                this.label && (this.label = this.label.destroy()), clearTimeout(this.hideTimer), clearTimeout(this.tooltipTimeout)
            },
            move: function(e, t, i, n) {
                var o = this,
                    s = o.now,
                    r = o.options.animation !== !1 && !o.isHidden && (me(e - s.x) > 1 || me(t - s.y) > 1),
                    a = o.followPointer || o.len > 1;
                Ve(s, {
                    x: r ? (2 * s.x + e) / 3 : e,
                    y: r ? (s.y + t) / 2 : t,
                    anchorX: a ? T : r ? (2 * s.anchorX + i) / 3 : i,
                    anchorY: a ? T : r ? (s.anchorY + n) / 2 : n
                }), o.label.attr(s), r && (clearTimeout(this.tooltipTimeout), this.tooltipTimeout = setTimeout(function() {
                    o && o.move(e, t, i, n)
                }, 32))
            },
            hide: function(e) {
                var t, i = this;
                clearTimeout(this.hideTimer), this.isHidden || (t = this.chart.hoverPoints, this.hideTimer = setTimeout(function() {
                    i.label.fadeOut(), i.isHidden = !0
                }, ze(e, this.options.hideDelay, 500)), t && Ye(t, function(e) {
                    e.setState()
                }), this.chart.hoverPoints = null, this.chart.hoverSeries = null)
            },
            getAnchor: function(e, t) {
                var i, n, o, s = this.chart,
                    r = s.inverted,
                    a = s.plotTop,
                    l = s.plotLeft,
                    c = 0,
                    d = 0,
                    e = u(e);
                return i = e[0].tooltipPos, this.followPointer && t && (t.chartX === T && (t = s.pointer.normalize(t)), i = [t.chartX - s.plotLeft, t.chartY - a]), i || (Ye(e, function(e) {
                    n = e.series.yAxis, o = e.series.xAxis, c += e.plotX + (!r && o ? o.left - l : 0), d += (e.plotLow ? (e.plotLow + e.plotHigh) / 2 : e.plotY) + (!r && n ? n.top - a : 0)
                }), c /= e.length, d /= e.length, i = [r ? s.plotWidth - d : c, this.shared && !r && e.length > 1 && t ? t.chartY - a : r ? s.plotHeight - c : d]), Xe(i, le)
            },
            getPosition: function(e, t, i) {
                var n, o = this.chart,
                    s = this.distance,
                    r = {},
                    a = i.h,
                    l = ["y", o.chartHeight, t, i.plotY + o.plotTop],
                    c = ["x", o.chartWidth, e, i.plotX + o.plotLeft],
                    d = ze(i.ttBelow, o.inverted && !i.negative || !o.inverted && i.negative),
                    u = function(e, t, i, n) {
                        var o = n - s > i,
                            l = t > n + s + i,
                            c = n - s - i;
                        if (n += s, d && l) r[e] = n;
                        else if (!d && o) r[e] = c;
                        else if (o) r[e] = 0 > c - a ? c : c - a;
                        else {
                            if (!l) return !1;
                            r[e] = n + a + i > t ? n : n + a
                        }
                    },
                    h = function(e, t, i, n) {
                        return s > n || n > t - s ? !1 : void(r[e] = i / 2 > n ? 1 : n > t - i / 2 ? t - i - 2 : n - i / 2)
                    },
                    m = function(e) {
                        var t = l;
                        l = c, c = t, n = e
                    },
                    p = function() {
                        u.apply(0, l) !== !1 ? h.apply(0, c) === !1 && !n && (m(!0), p()) : n ? r.x = r.y = 0 : (m(!0), p())
                    };
                return (o.inverted || this.len > 1) && m(), p(), r
            },
            defaultFormatter: function(e) {
                var t, i = this.points || u(this);
                return t = [e.tooltipFooterHeaderFormatter(i[0])], t = t.concat(e.bodyFormatter(i)), t.push(e.tooltipFooterHeaderFormatter(i[0], !0)), t.join("")
            },
            refresh: function(e, t) {
                var i, n, o, s = this.chart,
                    r = this.label,
                    a = this.options,
                    l = {},
                    c = [];
                o = a.formatter || this.defaultFormatter;
                var d, l = s.hoverPoints,
                    h = this.shared;
                clearTimeout(this.hideTimer), this.followPointer = u(e)[0].series.tooltipOptions.followPointer, n = this.getAnchor(e, t), i = n[0], n = n[1], !h || e.series && e.series.noSharedTooltip ? l = e.getLabelConfig() : (s.hoverPoints = e, l && Ye(l, function(e) {
                    e.setState()
                }), Ye(e, function(e) {
                    e.setState("hover"), c.push(e.getLabelConfig())
                }), l = {
                    x: e[0].category,
                    y: e[0].y
                }, l.points = c, this.len = c.length, e = e[0]), o = o.call(l, this), l = e.series, this.distance = ze(l.tooltipOptions.distance, 16), o === !1 ? this.hide() : (this.isHidden && (nt(r), r.attr("opacity", 1).show()), r.attr({
                    text: o
                }), d = a.borderColor || e.color || l.color || "#606060", r.attr({
                    stroke: d
                }), this.updatePosition({
                    plotX: i,
                    plotY: n,
                    negative: e.negative,
                    ttBelow: e.ttBelow,
                    h: e.shapeArgs && e.shapeArgs.height || 0
                }), this.isHidden = !1), et(s, "tooltipRefresh", {
                    text: o,
                    x: i + s.plotLeft,
                    y: n + s.plotTop,
                    borderColor: d
                })
            },
            updatePosition: function(e) {
                var t = this.chart,
                    i = this.label,
                    i = (this.options.positioner || this.getPosition).call(this, i.width, i.height, e);
                this.move(le(i.x), le(i.y), e.plotX + t.plotLeft, e.plotY + t.plotTop)
            },
            getXDateFormat: function(e, t, i) {
                var n, o, s, r, t = t.dateTimeLabelFormats,
                    a = i && i.closestPointRange,
                    l = {
                        millisecond: 15,
                        second: 12,
                        minute: 9,
                        hour: 6,
                        day: 3
                    };
                if (a) {
                    s = R("%m-%d %H:%M:%S.%L", e.x);
                    for (o in V) {
                        if (a === V.week && +R("%w", e.x) === i.options.startOfWeek && "00:00:00.000" === s.substr(6)) {
                            o = "week";
                            break
                        }
                        if (V[o] > a) {
                            o = r;
                            break
                        }
                        if (l[o] && s.substr(l[o]) !== "01-01 00:00:00.000".substr(l[o])) break;
                        "week" !== o && (r = o)
                    }
                    o && (n = t[o])
                } else n = t.day;
                return n || t.year
            },
            tooltipFooterHeaderFormatter: function(e, t) {
                var i = t ? "footer" : "header",
                    n = e.series,
                    o = n.tooltipOptions,
                    r = o.xDateFormat,
                    a = n.xAxis,
                    l = a && "datetime" === a.options.type && s(e.key),
                    i = o[i + "Format"];
                return l && !r && (r = this.getXDateFormat(e, o, a)), l && r && (i = i.replace("{point.key}", "{point.key:" + r + "}")), _(i, {
                    point: e,
                    series: n
                })
            },
            bodyFormatter: function(e) {
                return Xe(e, function(e) {
                    var t = e.series.tooltipOptions;
                    return (t.pointFormatter || e.point.tooltipFormatter).call(e.point, t.pointFormat)
                })
            }
        };
        var pt;
        P = se.documentElement.ontouchstart !== T;
        var ft = oe.Pointer = function(e, t) {
            this.init(e, t)
        };
        if (ft.prototype = {
                init: function(e, t) {
                    var i, n = t.chart,
                        o = n.events,
                        s = Ie ? "" : n.zoomType,
                        n = e.inverted;
                    this.options = t, this.chart = e, this.zoomX = i = /x/.test(s), this.zoomY = s = /y/.test(s), this.zoomHor = i && !n || s && n, this.zoomVert = s && !n || i && n, this.hasZoom = i || s, this.runChartClick = o && !!o.click, this.pinchDown = [], this.lastValidTouch = {}, oe.Tooltip && t.tooltip.enabled && (e.tooltip = new mt(e, t.tooltip), this.followTouchMove = ze(t.tooltip.followTouchMove, !0)), this.setDOMEvents()
                },
                normalize: function(e, t) {
                    var i, n, e = e || window.event,
                        e = tt(e);
                    return e.target || (e.target = e.srcElement), n = e.touches ? e.touches.length ? e.touches.item(0) : e.changedTouches[0] : e, t || (this.chartPosition = t = Qe(this.chart.container)), n.pageX === T ? (i = ue(e.x, e.clientX - t.left), n = e.y) : (i = n.pageX - t.left, n = n.pageY - t.top), Ve(e, {
                        chartX: le(i),
                        chartY: le(n)
                    })
                },
                getCoordinates: function(e) {
                    var t = {
                        xAxis: [],
                        yAxis: []
                    };
                    return Ye(this.chart.axes, function(i) {
                        t[i.isXAxis ? "xAxis" : "yAxis"].push({
                            axis: i,
                            value: i.toValue(e[i.horiz ? "chartX" : "chartY"])
                        })
                    }), t
                },
                runPointActions: function(e) {
                    var t, i, n, o, s = this.chart,
                        r = s.series,
                        a = s.tooltip,
                        l = a ? a.shared : !1,
                        d = s.hoverPoint,
                        u = s.hoverSeries,
                        h = s.chartWidth,
                        m = s.chartWidth,
                        p = [];
                    if (!l && !u)
                        for (t = 0; t < r.length; t++)(r[t].directTouch || !r[t].options.stickyTracking) && (r = []);
                    if (!l && u && u.directTouch && d ? n = d : (Ye(r, function(t) {
                            i = t.noSharedTooltip && l, t.visible && !i && ze(t.options.enableMouseTracking, !0) && (o = t.searchPoint(e)) && p.push(o)
                        }), Ye(p, function(e) {
                            e && c(e.plotX) && c(e.plotY) && (e.dist.distX < h || (e.dist.distX === h || e.series.kdDimensions > 1) && e.dist.distR < m) && (h = e.dist.distX, m = e.dist.distR, n = e)
                        })), n && (n !== d || a && a.isHidden))
                        if (l && !n.series.noSharedTooltip) {
                            for (t = p.length; t--;)(p[t].clientX !== n.clientX || p[t].series.noSharedTooltip) && p.splice(t, 1);
                            p.length && a && a.refresh(p, e), Ye(p, function(t) {
                                t !== n && t.onMouseOver(e)
                            }), (u && u.directTouch && d || n).onMouseOver(e)
                        } else a && a.refresh(n, e), n.onMouseOver(e);
                    else r = u && u.tooltipOptions.followPointer, a && r && !a.isHidden && (r = a.getAnchor([{}], e), a.updatePosition({
                        plotX: r[0],
                        plotY: r[1]
                    }));
                    a && !this._onDocumentMouseMove && (this._onDocumentMouseMove = function(e) {
                        Te[pt] && Te[pt].pointer.onDocumentMouseMove(e)
                    }, Ke(se, "mousemove", this._onDocumentMouseMove)), Ye(s.axes, function(t) {
                        t.drawCrosshair(e, ze(n, d))
                    })
                },
                reset: function(e, t) {
                    var i = this.chart,
                        n = i.hoverSeries,
                        o = i.hoverPoint,
                        s = i.tooltip,
                        r = s && s.shared ? i.hoverPoints : o;
                    (e = e && s && r) && u(r)[0].plotX === T && (e = !1), e ? (s.refresh(r), o && (o.setState(o.state, !0), Ye(i.axes, function(t) {
                        ze(t.options.crosshair && t.options.crosshair.snap, !0) ? t.drawCrosshair(null, e) : t.hideCrosshair()
                    }))) : (o && o.onMouseOut(), n && n.onMouseOut(), s && s.hide(t), this._onDocumentMouseMove && (Ze(se, "mousemove", this._onDocumentMouseMove), this._onDocumentMouseMove = null), Ye(i.axes, function(e) {
                        e.hideCrosshair()
                    }), this.hoverX = null)
                },
                scaleGroups: function(e, t) {
                    var i, n = this.chart;
                    Ye(n.series, function(o) {
                        i = e || o.getPlotBox(), o.xAxis && o.xAxis.zoomEnabled && (o.group.attr(i), o.markerGroup && (o.markerGroup.attr(i), o.markerGroup.clip(t ? n.clipRect : null)), o.dataLabelsGroup && o.dataLabelsGroup.attr(i))
                    }), n.clipRect.attr(t || n.clipBox)
                },
                dragStart: function(e) {
                    var t = this.chart;
                    t.mouseIsDown = e.type, t.cancelClick = !1, t.mouseDownX = this.mouseDownX = e.chartX, t.mouseDownY = this.mouseDownY = e.chartY
                },
                drag: function(e) {
                    var t, i = this.chart,
                        n = i.options.chart,
                        o = e.chartX,
                        s = e.chartY,
                        r = this.zoomHor,
                        a = this.zoomVert,
                        l = i.plotLeft,
                        c = i.plotTop,
                        d = i.plotWidth,
                        u = i.plotHeight,
                        h = this.mouseDownX,
                        m = this.mouseDownY,
                        p = n.panKey && e[n.panKey + "Key"];
                    l > o ? o = l : o > l + d && (o = l + d), c > s ? s = c : s > c + u && (s = c + u), this.hasDragged = Math.sqrt(Math.pow(h - o, 2) + Math.pow(m - s, 2)), this.hasDragged > 10 && (t = i.isInsidePlot(h - l, m - c), i.hasCartesianSeries && (this.zoomX || this.zoomY) && t && !p && !this.selectionMarker && (this.selectionMarker = i.renderer.rect(l, c, r ? 1 : d, a ? 1 : u, 0).attr({
                        fill: n.selectionMarkerFill || "rgba(69,114,167,0.25)",
                        zIndex: 7
                    }).add()), this.selectionMarker && r && (o -= h, this.selectionMarker.attr({
                        width: me(o),
                        x: (o > 0 ? 0 : o) + h
                    })), this.selectionMarker && a && (o = s - m, this.selectionMarker.attr({
                        height: me(o),
                        y: (o > 0 ? 0 : o) + m
                    })), t && !this.selectionMarker && n.panning && i.pan(e, n.panning))
                },
                drop: function(e) {
                    var t = this,
                        i = this.chart,
                        n = this.hasPinched;
                    if (this.selectionMarker) {
                        var o, s = {
                                xAxis: [],
                                yAxis: [],
                                originalEvent: e.originalEvent || e
                            },
                            r = this.selectionMarker,
                            a = r.attr ? r.attr("x") : r.x,
                            l = r.attr ? r.attr("y") : r.y,
                            d = r.attr ? r.attr("width") : r.width,
                            u = r.attr ? r.attr("height") : r.height;
                        (this.hasDragged || n) && (Ye(i.axes, function(i) {
                            if (i.zoomEnabled && c(i.min) && (n || t[{
                                    xAxis: "zoomX",
                                    yAxis: "zoomY"
                                }[i.coll]])) {
                                var r = i.horiz,
                                    h = "touchend" === e.type ? i.minPixelPadding : 0,
                                    m = i.toValue((r ? a : l) + h),
                                    r = i.toValue((r ? a + d : l + u) - h);
                                s[i.coll].push({
                                    axis: i,
                                    min: he(m, r),
                                    max: ue(m, r)
                                }), o = !0
                            }
                        }), o && et(i, "selection", s, function(e) {
                            i.zoom(Ve(e, n ? {
                                animation: !1
                            } : null))
                        })), this.selectionMarker = this.selectionMarker.destroy(), n && this.scaleGroups()
                    }
                    i && (h(i.container, {
                        cursor: i._cursor
                    }), i.cancelClick = this.hasDragged > 10, i.mouseIsDown = this.hasDragged = this.hasPinched = !1, this.pinchDown = [])
                },
                onContainerMouseDown: function(e) {
                    e = this.normalize(e), e.preventDefault && e.preventDefault(), this.dragStart(e)
                },
                onDocumentMouseUp: function(e) {
                    Te[pt] && Te[pt].pointer.drop(e)
                },
                onDocumentMouseMove: function(e) {
                    var t = this.chart,
                        i = this.chartPosition,
                        e = this.normalize(e, i);
                    i && !this.inClass(e.target, "highcharts-tracker") && !t.isInsidePlot(e.chartX - t.plotLeft, e.chartY - t.plotTop) && this.reset()
                },
                onContainerMouseLeave: function() {
                    var e = Te[pt];
                    e && (e.pointer.reset(), e.pointer.chartPosition = null)
                },
                onContainerMouseMove: function(e) {
                    var t = this.chart;
                    pt = t.index, e = this.normalize(e), e.returnValue = !1, "mousedown" === t.mouseIsDown && this.drag(e), (this.inClass(e.target, "highcharts-tracker") || t.isInsidePlot(e.chartX - t.plotLeft, e.chartY - t.plotTop)) && !t.openMenu && this.runPointActions(e)
                },
                inClass: function(e, t) {
                    for (var i; e;) {
                        if (i = d(e, "class")) {
                            if (-1 !== i.indexOf(t)) return !0;
                            if (-1 !== i.indexOf("highcharts-container")) return !1
                        }
                        e = e.parentNode
                    }
                },
                onTrackerMouseOut: function(e) {
                    var t = this.chart.hoverSeries,
                        i = (e = e.relatedTarget || e.toElement) && e.point && e.point.series;
                    !t || t.options.stickyTracking || this.inClass(e, "highcharts-tooltip") || i === t || t.onMouseOut()
                },
                onContainerClick: function(e) {
                    var t = this.chart,
                        i = t.hoverPoint,
                        n = t.plotLeft,
                        o = t.plotTop,
                        e = this.normalize(e);
                    e.originalEvent = e, e.cancelBubble = !0, t.cancelClick || (i && this.inClass(e.target, "highcharts-tracker") ? (et(i.series, "click", Ve(e, {
                        point: i
                    })), t.hoverPoint && i.firePointEvent("click", e)) : (Ve(e, this.getCoordinates(e)), t.isInsidePlot(e.chartX - n, e.chartY - o) && et(t, "click", e)))
                },
                setDOMEvents: function() {
                    var e = this,
                        t = e.chart.container;
                    t.onmousedown = function(t) {
                        e.onContainerMouseDown(t)
                    }, t.onmousemove = function(t) {
                        e.onContainerMouseMove(t)
                    }, t.onclick = function(t) {
                        e.onContainerClick(t)
                    }, Ke(t, "mouseleave", e.onContainerMouseLeave), 1 === Oe && Ke(se, "mouseup", e.onDocumentMouseUp), P && (t.ontouchstart = function(t) {
                        e.onContainerTouchStart(t)
                    }, t.ontouchmove = function(t) {
                        e.onContainerTouchMove(t)
                    }, 1 === Oe && Ke(se, "touchend", e.onDocumentTouchEnd))
                },
                destroy: function() {
                    var e;
                    Ze(this.chart.container, "mouseleave", this.onContainerMouseLeave), Oe || (Ze(se, "mouseup", this.onDocumentMouseUp), Ze(se, "touchend", this.onDocumentTouchEnd)), clearInterval(this.tooltipTimeout);
                    for (e in this) this[e] = null
                }
            }, Ve(oe.Pointer.prototype, {
                pinchTranslate: function(e, t, i, n, o, s) {
                    (this.zoomHor || this.pinchHor) && this.pinchTranslateDirection(!0, e, t, i, n, o, s), (this.zoomVert || this.pinchVert) && this.pinchTranslateDirection(!1, e, t, i, n, o, s)
                },
                pinchTranslateDirection: function(e, t, i, n, o, s, r, a) {
                    var l, c, d, u = this.chart,
                        h = e ? "x" : "y",
                        m = e ? "X" : "Y",
                        p = "chart" + m,
                        f = e ? "width" : "height",
                        g = u["plot" + (e ? "Left" : "Top")],
                        _ = a || 1,
                        b = u.inverted,
                        y = u.bounds[e ? "h" : "v"],
                        v = 1 === t.length,
                        M = t[0][p],
                        k = i[0][p],
                        B = !v && t[1][p],
                        w = !v && i[1][p],
                        i = function() {
                            !v && me(M - B) > 20 && (_ = a || me(k - w) / me(M - B)), c = (g - k) / _ + M, l = u["plot" + (e ? "Width" : "Height")] / _
                        };
                    i(), t = c, t < y.min ? (t = y.min, d = !0) : t + l > y.max && (t = y.max - l, d = !0), d ? (k -= .8 * (k - r[h][0]), v || (w -= .8 * (w - r[h][1])), i()) : r[h] = [k, w], b || (s[h] = c - g, s[f] = l), s = b ? 1 / _ : _, o[f] = l, o[h] = t, n[b ? e ? "scaleY" : "scaleX" : "scale" + m] = _, n["translate" + m] = s * g + (k - s * M)
                },
                pinch: function(e) {
                    var t = this,
                        i = t.chart,
                        n = t.pinchDown,
                        o = e.touches,
                        s = o.length,
                        r = t.lastValidTouch,
                        a = t.hasZoom,
                        l = t.selectionMarker,
                        c = {},
                        d = 1 === s && (t.inClass(e.target, "highcharts-tracker") && i.runTrackerClick || t.runChartClick),
                        u = {};
                    a && !d && e.preventDefault(), Xe(o, function(e) {
                        return t.normalize(e)
                    }), "touchstart" === e.type ? (Ye(o, function(e, t) {
                        n[t] = {
                            chartX: e.chartX,
                            chartY: e.chartY
                        }
                    }), r.x = [n[0].chartX, n[1] && n[1].chartX], r.y = [n[0].chartY, n[1] && n[1].chartY], Ye(i.axes, function(e) {
                        if (e.zoomEnabled) {
                            var t = i.bounds[e.horiz ? "h" : "v"],
                                n = e.minPixelPadding,
                                o = e.toPixels(ze(e.options.min, e.dataMin)),
                                s = e.toPixels(ze(e.options.max, e.dataMax)),
                                r = he(o, s),
                                o = ue(o, s);
                            t.min = he(e.pos, r - n), t.max = ue(e.pos + e.len, o + n)
                        }
                    }), t.res = !0) : n.length && (l || (t.selectionMarker = l = Ve({
                        destroy: Ce
                    }, i.plotBox)), t.pinchTranslate(n, o, c, l, u, r), t.hasPinched = a, t.scaleGroups(c, u), !a && t.followTouchMove && 1 === s ? this.runPointActions(t.normalize(e)) : t.res && (t.res = !1, this.reset(!1, 0)))
                },
                onContainerTouchStart: function(e) {
                    var t = this.chart;
                    pt = t.index, 1 === e.touches.length ? (e = this.normalize(e), t.isInsidePlot(e.chartX - t.plotLeft, e.chartY - t.plotTop) && !t.openMenu ? (this.runPointActions(e), this.pinch(e)) : this.reset()) : 2 === e.touches.length && this.pinch(e)
                },
                onContainerTouchMove: function(e) {
                    (1 === e.touches.length || 2 === e.touches.length) && this.pinch(e);
                },
                onDocumentTouchEnd: function(e) {
                    Te[pt] && Te[pt].pointer.drop(e)
                }
            }), re.PointerEvent || re.MSPointerEvent) {
            var gt = {},
                _t = !!re.PointerEvent,
                bt = function() {
                    var e, t = [];
                    t.item = function(e) {
                        return this[e]
                    };
                    for (e in gt) gt.hasOwnProperty(e) && t.push({
                        pageX: gt[e].pageX,
                        pageY: gt[e].pageY,
                        target: gt[e].target
                    });
                    return t
                },
                yt = function(e, t, i, n) {
                    e = e.originalEvent || e, "touch" !== e.pointerType && e.pointerType !== e.MSPOINTER_TYPE_TOUCH || !Te[pt] || (n(e), n = Te[pt].pointer, n[t]({
                        type: i,
                        target: e.currentTarget,
                        preventDefault: Ce,
                        touches: bt()
                    }))
                };
            Ve(ft.prototype, {
                onContainerPointerDown: function(e) {
                    yt(e, "onContainerTouchStart", "touchstart", function(e) {
                        gt[e.pointerId] = {
                            pageX: e.pageX,
                            pageY: e.pageY,
                            target: e.currentTarget
                        }
                    })
                },
                onContainerPointerMove: function(e) {
                    yt(e, "onContainerTouchMove", "touchmove", function(e) {
                        gt[e.pointerId] = {
                            pageX: e.pageX,
                            pageY: e.pageY
                        }, gt[e.pointerId].target || (gt[e.pointerId].target = e.currentTarget)
                    })
                },
                onDocumentPointerUp: function(e) {
                    yt(e, "onDocumentTouchEnd", "touchend", function(e) {
                        delete gt[e.pointerId]
                    })
                },
                batchMSEvents: function(e) {
                    e(this.chart.container, _t ? "pointerdown" : "MSPointerDown", this.onContainerPointerDown), e(this.chart.container, _t ? "pointermove" : "MSPointerMove", this.onContainerPointerMove), e(se, _t ? "pointerup" : "MSPointerUp", this.onDocumentPointerUp)
                }
            }), He(ft.prototype, "init", function(e, t, i) {
                e.call(this, t, i), this.hasZoom && h(t.container, {
                    "-ms-touch-action": Ae,
                    "touch-action": Ae
                })
            }), He(ft.prototype, "setDOMEvents", function(e) {
                e.apply(this), (this.hasZoom || this.followTouchMove) && this.batchMSEvents(Ke)
            }), He(ft.prototype, "destroy", function(e) {
                this.batchMSEvents(Ze), e.call(this)
            })
        }
        var vt = oe.Legend = function(e, t) {
            this.init(e, t)
        };
        vt.prototype = {
            init: function(t, i) {
                var n = this,
                    o = i.itemStyle,
                    s = i.itemMarginTop || 0;
                this.options = i, i.enabled && (n.itemStyle = o, n.itemHiddenStyle = e(o, i.itemHiddenStyle), n.itemMarginTop = s, n.padding = o = ze(i.padding, 8), n.initialItemX = o, n.initialItemY = o - 5, n.maxItemWidth = 0, n.chart = t, n.itemHeight = 0, n.symbolWidth = ze(i.symbolWidth, 16), n.pages = [], n.render(), Ke(n.chart, "endResize", function() {
                    n.positionCheckboxes()
                }))
            },
            colorizeItem: function(e, t) {
                var i, n = this.options,
                    o = e.legendItem,
                    s = e.legendLine,
                    r = e.legendSymbol,
                    a = this.itemHiddenStyle.color,
                    n = t ? n.itemStyle.color : a,
                    l = t ? e.legendColor || e.color || "#CCC" : a,
                    a = e.options && e.options.marker,
                    c = {
                        fill: l
                    };
                if (o && o.css({
                        fill: n,
                        color: n
                    }), s && s.attr({
                        stroke: l
                    }), r) {
                    if (a && r.isMarker)
                        for (i in c.stroke = l, a = e.convertAttribs(a)) o = a[i], o !== T && (c[i] = o);
                    r.attr(c)
                }
            },
            positionItem: function(e) {
                var t = this.options,
                    i = t.symbolPadding,
                    t = !t.rtl,
                    n = e._legendItemPos,
                    o = n[0],
                    n = n[1],
                    s = e.checkbox;
                e.legendGroup && e.legendGroup.translate(t ? o : this.legendWidth - o - 2 * i - 4, n), s && (s.x = o, s.y = n)
            },
            destroyItem: function(e) {
                var t = e.checkbox;
                Ye(["legendItem", "legendLine", "legendSymbol", "legendGroup"], function(t) {
                    e[t] && (e[t] = e[t].destroy())
                }), t && w(e.checkbox)
            },
            clearItems: function() {
                var e = this;
                Ye(e.getAllItems(), function(t) {
                    e.destroyItem(t)
                })
            },
            destroy: function() {
                var e = this.group,
                    t = this.box;
                t && (this.box = t.destroy()), e && (this.group = e.destroy())
            },
            positionCheckboxes: function(e) {
                var t, i = this.group.alignAttr,
                    n = this.clipHeight || this.legendHeight;
                i && (t = i.translateY, Ye(this.allItems, function(o) {
                    var s, r = o.checkbox;
                    r && (s = t + r.y + (e || 0) + 3, h(r, {
                        left: i.translateX + o.checkboxOffset + r.x - 20 + "px",
                        top: s + "px",
                        display: s > t - 6 && t + n - 6 > s ? "" : Ae
                    }))
                }))
            },
            renderTitle: function() {
                var e = this.padding,
                    t = this.options.title,
                    i = 0;
                t.text && (this.title || (this.title = this.chart.renderer.label(t.text, e - 3, e - 4, null, null, null, null, null, "legend-title").attr({
                    zIndex: 1
                }).css(t.style).add(this.group)), e = this.title.getBBox(), i = e.height, this.offsetWidth = e.width, this.contentGroup.attr({
                    translateY: i
                })), this.titleHeight = i
            },
            renderItem: function(t) {
                var i = this.chart,
                    n = i.renderer,
                    o = this.options,
                    s = "horizontal" === o.layout,
                    r = this.symbolWidth,
                    a = o.symbolPadding,
                    l = this.itemStyle,
                    c = this.itemHiddenStyle,
                    d = this.padding,
                    u = s ? ze(o.itemDistance, 20) : 0,
                    h = !o.rtl,
                    m = o.width,
                    p = o.itemMarginBottom || 0,
                    f = this.itemMarginTop,
                    g = this.initialItemX,
                    b = t.legendItem,
                    y = t.series && t.series.drawLegendSymbol ? t.series : t,
                    v = y.options,
                    v = this.createCheckboxForItem && v && v.showCheckbox,
                    M = o.useHTML;
                b || (t.legendGroup = n.g("legend-item").attr({
                    zIndex: 1
                }).add(this.scrollGroup), t.legendItem = b = n.text(o.labelFormat ? _(o.labelFormat, t) : o.labelFormatter.call(t), h ? r + a : -a, this.baseline || 0, M).css(e(t.visible ? l : c)).attr({
                    align: h ? "left" : "right",
                    zIndex: 2
                }).add(t.legendGroup), this.baseline || (this.fontMetrics = n.fontMetrics(l.fontSize, b), this.baseline = this.fontMetrics.f + 3 + f, b.attr("y", this.baseline)), y.drawLegendSymbol(this, t), this.setItemEvents && this.setItemEvents(t, b, M, l, c), this.colorizeItem(t, t.visible), v && this.createCheckboxForItem(t)), n = b.getBBox(), r = t.checkboxOffset = o.itemWidth || t.legendItemWidth || r + a + n.width + u + (v ? 20 : 0), this.itemHeight = a = le(t.legendItemHeight || n.height), s && this.itemX - g + r > (m || i.chartWidth - 2 * d - g - o.x) && (this.itemX = g, this.itemY += f + this.lastLineHeight + p, this.lastLineHeight = 0), this.maxItemWidth = ue(this.maxItemWidth, r), this.lastItemY = f + this.itemY + p, this.lastLineHeight = ue(a, this.lastLineHeight), t._legendItemPos = [this.itemX, this.itemY], s ? this.itemX += r : (this.itemY += f + a + p, this.lastLineHeight = a), this.offsetWidth = m || ue((s ? this.itemX - g - u : r) + d, this.offsetWidth)
            },
            getAllItems: function() {
                var e = [];
                return Ye(this.chart.series, function(t) {
                    var i = t.options;
                    ze(i.showInLegend, c(i.linkedTo) ? !1 : T, !0) && (e = e.concat(t.legendItems || ("point" === i.legendType ? t.data : t)))
                }), e
            },
            adjustMargins: function(e, t) {
                var i = this.chart,
                    n = this.options,
                    o = n.align[0] + n.verticalAlign[0] + n.layout[0];
                this.display && !n.floating && Ye([/(lth|ct|rth)/, /(rtv|rm|rbv)/, /(rbh|cb|lbh)/, /(lbv|lm|ltv)/], function(s, r) {
                    s.test(o) && !c(e[r]) && (i[Re[r]] = ue(i[Re[r]], i.legend[(r + 1) % 2 ? "legendHeight" : "legendWidth"] + [1, -1, -1, 1][r] * n[r % 2 ? "x" : "y"] + ze(n.margin, 12) + t[r]))
                })
            },
            render: function() {
                var e, t, i, n, o = this,
                    s = o.chart,
                    r = s.renderer,
                    a = o.group,
                    l = o.box,
                    c = o.options,
                    d = o.padding,
                    u = c.borderWidth,
                    h = c.backgroundColor;
                o.itemX = o.initialItemX, o.itemY = o.initialItemY, o.offsetWidth = 0, o.lastItemY = 0, a || (o.group = a = r.g("legend").attr({
                    zIndex: 7
                }).add(), o.contentGroup = r.g().attr({
                    zIndex: 1
                }).add(a), o.scrollGroup = r.g().add(o.contentGroup)), o.renderTitle(), e = o.getAllItems(), v(e, function(e, t) {
                    return (e.options && e.options.legendIndex || 0) - (t.options && t.options.legendIndex || 0)
                }), c.reversed && e.reverse(), o.allItems = e, o.display = t = !!e.length, o.lastLineHeight = 0, Ye(e, function(e) {
                    o.renderItem(e)
                }), i = (c.width || o.offsetWidth) + d, n = o.lastItemY + o.lastLineHeight + o.titleHeight, n = o.handleOverflow(n), n += d, (u || h) && (l ? i > 0 && n > 0 && (l[l.isNew ? "attr" : "animate"](l.crisp({
                    width: i,
                    height: n
                })), l.isNew = !1) : (o.box = l = r.rect(0, 0, i, n, c.borderRadius, u || 0).attr({
                    stroke: c.borderColor,
                    "stroke-width": u || 0,
                    fill: h || Ae
                }).add(a).shadow(c.shadow), l.isNew = !0), l[t ? "show" : "hide"]()), o.legendWidth = i, o.legendHeight = n, Ye(e, function(e) {
                    o.positionItem(e)
                }), t && a.align(Ve({
                    width: i,
                    height: n
                }, c), !0, "spacingBox"), s.isResizing || this.positionCheckboxes()
            },
            handleOverflow: function(e) {
                var t, i, n = this,
                    o = this.chart,
                    s = o.renderer,
                    r = this.options,
                    a = r.y,
                    a = o.spacingBox.height + ("top" === r.verticalAlign ? -a : a) - this.padding,
                    l = r.maxHeight,
                    c = this.clipRect,
                    d = r.navigation,
                    u = ze(d.animation, !0),
                    h = d.arrowSize || 12,
                    m = this.nav,
                    p = this.pages,
                    f = this.allItems;
                return "horizontal" === r.layout && (a /= 2), l && (a = he(a, l)), p.length = 0, e > a && !r.useHTML ? (this.clipHeight = t = ue(a - 20 - this.titleHeight - this.padding, 0), this.currentPage = ze(this.currentPage, 1), this.fullHeight = e, Ye(f, function(e, n) {
                    var o = e._legendItemPos[1],
                        s = le(e.legendItem.getBBox().height),
                        r = p.length;
                    (!r || o - p[r - 1] > t && (i || o) !== p[r - 1]) && (p.push(i || o), r++), n === f.length - 1 && o + s - p[r - 1] > t && p.push(o), o !== i && (i = o)
                }), c || (c = n.clipRect = s.clipRect(0, this.padding, 9999, 0), n.contentGroup.clip(c)), c.attr({
                    height: t
                }), m || (this.nav = m = s.g().attr({
                    zIndex: 1
                }).add(this.group), this.up = s.symbol("triangle", 0, 0, h, h).on("click", function() {
                    n.scroll(-1, u)
                }).add(m), this.pager = s.text("", 15, 10).css(d.style).add(m), this.down = s.symbol("triangle-down", 0, 0, h, h).on("click", function() {
                    n.scroll(1, u)
                }).add(m)), n.scroll(0), e = a) : m && (c.attr({
                    height: o.chartHeight
                }), m.hide(), this.scrollGroup.attr({
                    translateY: 1
                }), this.clipHeight = 0), e
            },
            scroll: function(e, t) {
                var i = this.pages,
                    n = i.length,
                    o = this.currentPage + e,
                    s = this.clipHeight,
                    r = this.options.navigation,
                    a = r.activeColor,
                    r = r.inactiveColor,
                    l = this.pager,
                    c = this.padding;
                o > n && (o = n), o > 0 && (t !== T && N(t, this.chart), this.nav.attr({
                    translateX: c,
                    translateY: s + this.padding + 7 + this.titleHeight,
                    visibility: "visible"
                }), this.up.attr({
                    fill: 1 === o ? r : a
                }).css({
                    cursor: 1 === o ? "default" : "pointer"
                }), l.attr({
                    text: o + "/" + n
                }), this.down.attr({
                    x: 18 + this.pager.getBBox().width,
                    fill: o === n ? r : a
                }).css({
                    cursor: o === n ? "default" : "pointer"
                }), i = -i[o - 1] + this.initialItemY, this.scrollGroup.animate({
                    translateY: i
                }), this.currentPage = o, this.positionCheckboxes(i))
            }
        }, dt = oe.LegendSymbolMixin = {
            drawRectangle: function(e, t) {
                var i = e.options.symbolHeight || e.fontMetrics.f;
                t.legendSymbol = this.chart.renderer.rect(0, e.baseline - i + 1, e.symbolWidth, i, e.options.symbolRadius || 0).attr({
                    zIndex: 3
                }).add(t.legendGroup)
            },
            drawLineMarker: function(e) {
                var t, i = this.options,
                    n = i.marker;
                t = e.symbolWidth;
                var o, s = this.chart.renderer,
                    r = this.legendGroup,
                    e = e.baseline - le(.3 * e.fontMetrics.b);
                i.lineWidth && (o = {
                    "stroke-width": i.lineWidth
                }, i.dashStyle && (o.dashstyle = i.dashStyle), this.legendLine = s.path(["M", 0, e, "L", t, e]).attr(o).add(r)), n && n.enabled !== !1 && (i = n.radius, this.legendSymbol = t = s.symbol(this.symbol, t / 2 - i, e - i, 2 * i, 2 * i).add(r), t.isMarker = !0)
            }
        }, (/Trident\/7\.0/.test(be) || Be) && He(vt.prototype, "positionItem", function(e, t) {
            var i = this,
                n = function() {
                    t._legendItemPos && e.call(i, t)
                };
            n(), setTimeout(n)
        }), Ge = oe.Chart = function() {
            this.init.apply(this, arguments)
        }, Ge.prototype = {
            callbacks: [],
            init: function(t, i) {
                var n, o = t.series;
                t.series = null, n = e(L, t), n.series = t.series = o, this.userOptions = t, o = n.chart, this.margin = this.splashArray("margin", o), this.spacing = this.splashArray("spacing", o);
                var s = o.events;
                this.bounds = {
                    h: {},
                    v: {}
                }, this.callback = i, this.isResizing = 0, this.options = n, this.axes = [], this.series = [], this.hasCartesianSeries = o.showAxes;
                var r, a = this;
                if (a.index = Te.length, Te.push(a), Oe++, o.reflow !== !1 && Ke(a, "load", function() {
                        a.initReflow()
                    }), s)
                    for (r in s) Ke(a, r, s[r]);
                a.xAxis = [], a.yAxis = [], a.animation = Ie ? !1 : ze(o.animation, !0), a.pointCount = a.colorCounter = a.symbolCounter = 0, a.firstRender()
            },
            initSeries: function(e) {
                var t = this.options.chart;
                return (t = Fe[e.type || t.type || t.defaultSeriesType]) || x(17, !0), t = new t, t.init(this, e), t
            },
            isInsidePlot: function(e, t, i) {
                var n = i ? t : e,
                    e = i ? e : t;
                return n >= 0 && n <= this.plotWidth && e >= 0 && e <= this.plotHeight
            },
            redraw: function(e) {
                var t, i, n = this.axes,
                    o = this.series,
                    s = this.pointer,
                    r = this.legend,
                    a = this.isDirtyLegend,
                    l = this.hasCartesianSeries,
                    c = this.isDirtyBox,
                    d = o.length,
                    u = d,
                    h = this.renderer,
                    m = h.isHidden(),
                    p = [];
                for (N(e, this), m && this.cloneRenderTo(), this.layOutTitles(); u--;)
                    if (e = o[u], e.options.stacking && (t = !0, e.isDirty)) {
                        i = !0;
                        break
                    }
                if (i)
                    for (u = d; u--;) e = o[u], e.options.stacking && (e.isDirty = !0);
                Ye(o, function(e) {
                    e.isDirty && "point" === e.options.legendType && (a = !0)
                }), a && r.options.enabled && (r.render(), this.isDirtyLegend = !1), t && this.getStacks(), l && !this.isResizing && (this.maxTicks = null, Ye(n, function(e) {
                    e.setScale()
                })), this.getMargins(), l && (Ye(n, function(e) {
                    e.isDirty && (c = !0)
                }), Ye(n, function(e) {
                    e.isDirtyExtremes && (e.isDirtyExtremes = !1, p.push(function() {
                        et(e, "afterSetExtremes", Ve(e.eventArgs, e.getExtremes())), delete e.eventArgs
                    })), (c || t) && e.redraw()
                })), c && this.drawChartBox(), Ye(o, function(e) {
                    e.isDirty && e.visible && (!e.isCartesian || e.xAxis) && e.redraw()
                }), s && s.reset(!0), h.draw(), et(this, "redraw"), m && this.cloneRenderTo(!0), Ye(p, function(e) {
                    e.call()
                })
            },
            get: function(e) {
                var t, i, n = this.axes,
                    o = this.series;
                for (t = 0; t < n.length; t++)
                    if (n[t].options.id === e) return n[t];
                for (t = 0; t < o.length; t++)
                    if (o[t].options.id === e) return o[t];
                for (t = 0; t < o.length; t++)
                    for (i = o[t].points || [], n = 0; n < i.length; n++)
                        if (i[n].id === e) return i[n];
                return null
            },
            getAxes: function() {
                var e = this,
                    t = this.options,
                    i = t.xAxis = u(t.xAxis || {}),
                    t = t.yAxis = u(t.yAxis || {});
                Ye(i, function(e, t) {
                    e.index = t, e.isX = !0
                }), Ye(t, function(e, t) {
                    e.index = t
                }), i = i.concat(t), Ye(i, function(t) {
                    new ht(e, t)
                })
            },
            getSelectedPoints: function() {
                var e = [];
                return Ye(this.series, function(t) {
                    e = e.concat($e(t.points || [], function(e) {
                        return e.selected
                    }))
                }), e
            },
            getSelectedSeries: function() {
                return $e(this.series, function(e) {
                    return e.selected
                })
            },
            getStacks: function() {
                var e = this;
                Ye(e.yAxis, function(e) {
                    e.stacks && e.hasVisibleSeries && (e.oldStacks = e.stacks)
                }), Ye(e.series, function(t) {
                    !t.options.stacking || t.visible !== !0 && e.options.chart.ignoreHiddenSeries !== !1 || (t.stackKey = t.type + ze(t.options.stack, ""))
                })
            },
            setTitle: function(t, i, n) {
                var o, s, r = this,
                    a = r.options;
                s = a.title = e(a.title, t), o = a.subtitle = e(a.subtitle, i), a = o, Ye([
                    ["title", t, s],
                    ["subtitle", i, a]
                ], function(e) {
                    var t = e[0],
                        i = r[t],
                        n = e[1],
                        e = e[2];
                    i && n && (r[t] = i = i.destroy()), e && e.text && !i && (r[t] = r.renderer.text(e.text, 0, 0, e.useHTML).attr({
                        align: e.align,
                        "class": "highcharts-" + t,
                        zIndex: e.zIndex || 4
                    }).css(e.style).add())
                }), r.layOutTitles(n)
            },
            layOutTitles: function(e) {
                var t = 0,
                    i = this.title,
                    n = this.subtitle,
                    o = this.options,
                    s = o.title,
                    o = o.subtitle,
                    r = this.renderer,
                    a = this.spacingBox.width - 44;
                !i || (i.css({
                    width: (s.width || a) + "px"
                }).align(Ve({
                    y: r.fontMetrics(s.style.fontSize, i).b - 3
                }, s), !1, "spacingBox"), s.floating || s.verticalAlign) || (t = i.getBBox().height), n && (n.css({
                    width: (o.width || a) + "px"
                }).align(Ve({
                    y: t + (s.margin - 13) + r.fontMetrics(s.style.fontSize, n).b
                }, o), !1, "spacingBox"), !o.floating && !o.verticalAlign && (t = de(t + n.getBBox().height))), i = this.titleOffset !== t, this.titleOffset = t, !this.isDirtyBox && i && (this.isDirtyBox = i, this.hasRendered && ze(e, !0) && this.isDirtyBox && this.redraw())
            },
            getChartSize: function() {
                var e = this.options.chart,
                    t = e.width,
                    e = e.height,
                    i = this.renderToClone || this.renderTo;
                c(t) || (this.containerWidth = qe(i, "width")), c(e) || (this.containerHeight = qe(i, "height")), this.chartWidth = ue(0, t || this.containerWidth || 600), this.chartHeight = ue(0, ze(e, this.containerHeight > 19 ? this.containerHeight : 400))
            },
            cloneRenderTo: function(e) {
                var t = this.renderToClone,
                    i = this.container;
                e ? t && (this.renderTo.appendChild(i), w(t), delete this.renderToClone) : (i && i.parentNode === this.renderTo && this.renderTo.removeChild(i), this.renderToClone = t = this.renderTo.cloneNode(0), h(t, {
                    position: "absolute",
                    top: "-9999px",
                    display: "block"
                }), t.style.setProperty && t.style.setProperty("display", "block", "important"), se.body.appendChild(t), i && t.appendChild(i))
            },
            getContainer: function() {
                var e, n, o, s, r = this.options.chart;
                this.renderTo = e = r.renderTo, s = "highcharts-" + De++, i(e) && (this.renderTo = e = se.getElementById(e)), e || x(13, !0), n = t(d(e, "data-highcharts-chart")), !isNaN(n) && Te[n] && Te[n].hasRendered && Te[n].destroy(), d(e, "data-highcharts-chart", this.index), e.innerHTML = "", !r.skipClone && !e.offsetWidth && this.cloneRenderTo(), this.getChartSize(), n = this.chartWidth, o = this.chartHeight, this.container = e = m(Pe, {
                    className: "highcharts-container" + (r.className ? " " + r.className : ""),
                    id: s
                }, Ve({
                    position: "relative",
                    overflow: "hidden",
                    width: n + "px",
                    height: o + "px",
                    textAlign: "left",
                    lineHeight: "normal",
                    zIndex: 0,
                    "-webkit-tap-highlight-color": "rgba(0,0,0,0)"
                }, r.style), this.renderToClone || e), this._cursor = e.style.cursor, this.renderer = r.forExport ? new ct(e, n, o, r.style, !0) : new O(e, n, o, r.style), Ie && this.renderer.create(this, e, n, o), this.renderer.chartIndex = this.index
            },
            getMargins: function(e) {
                var t = this.spacing,
                    i = this.margin,
                    n = this.titleOffset;
                this.resetMargins(), n && !c(i[0]) && (this.plotTop = ue(this.plotTop, n + this.options.title.margin + t[0])), this.legend.adjustMargins(i, t), this.extraBottomMargin && (this.marginBottom += this.extraBottomMargin), this.extraTopMargin && (this.plotTop += this.extraTopMargin), e || this.getAxisMargins()
            },
            getAxisMargins: function() {
                var e = this,
                    t = e.axisOffset = [0, 0, 0, 0],
                    i = e.margin;
                e.hasCartesianSeries && Ye(e.axes, function(e) {
                    e.getOffset()
                }), Ye(Re, function(n, o) {
                    c(i[o]) || (e[n] += t[o])
                }), e.setChartSize()
            },
            reflow: function(e) {
                var t = this,
                    i = t.options.chart,
                    n = t.renderTo,
                    o = i.width || qe(n, "width"),
                    s = i.height || qe(n, "height"),
                    i = e ? e.target : re,
                    n = function() {
                        t.container && (t.setSize(o, s, !1), t.hasUserSize = null)
                    };
                t.hasUserSize || t.isPrinting || !o || !s || i !== re && i !== se || ((o !== t.containerWidth || s !== t.containerHeight) && (clearTimeout(t.reflowTimeout), e ? t.reflowTimeout = setTimeout(n, 100) : n()), t.containerWidth = o, t.containerHeight = s)
            },
            initReflow: function() {
                var e = this,
                    t = function(t) {
                        e.reflow(t)
                    };
                Ke(re, "resize", t), Ke(e, "destroy", function() {
                    Ze(re, "resize", t)
                })
            },
            setSize: function(e, t, i) {
                var n, o, s, r = this;
                r.isResizing += 1, s = function() {
                    r && et(r, "endResize", null, function() {
                        r.isResizing -= 1
                    })
                }, N(i, r), r.oldChartHeight = r.chartHeight, r.oldChartWidth = r.chartWidth, c(e) && (r.chartWidth = n = ue(0, le(e)), r.hasUserSize = !!n), c(t) && (r.chartHeight = o = ue(0, le(t))), (j ? it : h)(r.container, {
                    width: n + "px",
                    height: o + "px"
                }, j), r.setChartSize(!0), r.renderer.setSize(n, o, i), r.maxTicks = null, Ye(r.axes, function(e) {
                    e.isDirty = !0, e.setScale()
                }), Ye(r.series, function(e) {
                    e.isDirty = !0
                }), r.isDirtyLegend = !0, r.isDirtyBox = !0, r.layOutTitles(), r.getMargins(), r.redraw(i), r.oldChartHeight = null, et(r, "resize"), j === !1 ? s() : setTimeout(s, j && j.duration || 500)
            },
            setChartSize: function(e) {
                var t, i, n, o, s = this.inverted,
                    r = this.renderer,
                    a = this.chartWidth,
                    l = this.chartHeight,
                    c = this.options.chart,
                    d = this.spacing,
                    u = this.clipOffset;
                this.plotLeft = t = le(this.plotLeft), this.plotTop = i = le(this.plotTop), this.plotWidth = n = ue(0, le(a - t - this.marginRight)), this.plotHeight = o = ue(0, le(l - i - this.marginBottom)), this.plotSizeX = s ? o : n, this.plotSizeY = s ? n : o, this.plotBorderWidth = c.plotBorderWidth || 0, this.spacingBox = r.spacingBox = {
                    x: d[3],
                    y: d[0],
                    width: a - d[3] - d[1],
                    height: l - d[0] - d[2]
                }, this.plotBox = r.plotBox = {
                    x: t,
                    y: i,
                    width: n,
                    height: o
                }, a = 2 * ce(this.plotBorderWidth / 2), s = de(ue(a, u[3]) / 2), r = de(ue(a, u[0]) / 2), this.clipBox = {
                    x: s,
                    y: r,
                    width: ce(this.plotSizeX - ue(a, u[1]) / 2 - s),
                    height: ue(0, ce(this.plotSizeY - ue(a, u[2]) / 2 - r))
                }, e || Ye(this.axes, function(e) {
                    e.setAxisSize(), e.setAxisTranslation()
                })
            },
            resetMargins: function() {
                var e = this;
                Ye(Re, function(t, i) {
                    e[t] = ze(e.margin[i], e.spacing[i])
                }), e.axisOffset = [0, 0, 0, 0], e.clipOffset = [0, 0, 0, 0]
            },
            drawChartBox: function() {
                var e, t = this.options.chart,
                    i = this.renderer,
                    n = this.chartWidth,
                    o = this.chartHeight,
                    s = this.chartBackground,
                    r = this.plotBackground,
                    a = this.plotBorder,
                    l = this.plotBGImage,
                    c = t.borderWidth || 0,
                    d = t.backgroundColor,
                    u = t.plotBackgroundColor,
                    h = t.plotBackgroundImage,
                    m = t.plotBorderWidth || 0,
                    p = this.plotLeft,
                    f = this.plotTop,
                    g = this.plotWidth,
                    _ = this.plotHeight,
                    b = this.plotBox,
                    y = this.clipRect,
                    v = this.clipBox;
                e = c + (t.shadow ? 8 : 0), (c || d) && (s ? s.animate(s.crisp({
                    width: n - e,
                    height: o - e
                })) : (s = {
                    fill: d || Ae
                }, c && (s.stroke = t.borderColor, s["stroke-width"] = c), this.chartBackground = i.rect(e / 2, e / 2, n - e, o - e, t.borderRadius, c).attr(s).addClass("highcharts-background").add().shadow(t.shadow))), u && (r ? r.animate(b) : this.plotBackground = i.rect(p, f, g, _, 0).attr({
                    fill: u
                }).add().shadow(t.plotShadow)), h && (l ? l.animate(b) : this.plotBGImage = i.image(h, p, f, g, _).add()), y ? y.animate({
                    width: v.width,
                    height: v.height
                }) : this.clipRect = i.clipRect(v), m && (a ? a.animate(a.crisp({
                    x: p,
                    y: f,
                    width: g,
                    height: _,
                    strokeWidth: -m
                })) : this.plotBorder = i.rect(p, f, g, _, 0, -m).attr({
                    stroke: t.plotBorderColor,
                    "stroke-width": m,
                    fill: Ae,
                    zIndex: 1
                }).add()), this.isDirtyBox = !1
            },
            propFromSeries: function() {
                var e, t, i, n = this,
                    o = n.options.chart,
                    s = n.options.series;
                Ye(["inverted", "angular", "polar"], function(r) {
                    for (e = Fe[o.type || o.defaultSeriesType], i = n[r] || o[r] || e && e.prototype[r], t = s && s.length; !i && t--;)(e = Fe[s[t].type]) && e.prototype[r] && (i = !0);
                    n[r] = i
                })
            },
            linkSeries: function() {
                var e = this,
                    t = e.series;
                Ye(t, function(e) {
                    e.linkedSeries.length = 0
                }), Ye(t, function(t) {
                    var n = t.options.linkedTo;
                    i(n) && (n = ":previous" === n ? e.series[t.index - 1] : e.get(n)) && (n.linkedSeries.push(t), t.linkedParent = n)
                })
            },
            renderSeries: function() {
                Ye(this.series, function(e) {
                    e.translate(), e.render()
                })
            },
            renderLabels: function() {
                var e = this,
                    i = e.options.labels;
                i.items && Ye(i.items, function(n) {
                    var o = Ve(i.style, n.style),
                        s = t(o.left) + e.plotLeft,
                        r = t(o.top) + e.plotTop + 12;
                    delete o.left, delete o.top, e.renderer.text(n.html, s, r).attr({
                        zIndex: 2
                    }).css(o).add()
                })
            },
            render: function() {
                var e, t, i, n, o = this.axes,
                    s = this.renderer,
                    r = this.options;
                this.setTitle(), this.legend = new vt(this, r.legend), this.getStacks(), this.getMargins(!0), this.setChartSize(), e = this.plotWidth, t = this.plotHeight -= 13, Ye(o, function(e) {
                    e.setScale()
                }), this.getAxisMargins(), i = e / this.plotWidth > 1.1, n = t / this.plotHeight > 1.1, (i || n) && (this.maxTicks = null, Ye(o, function(e) {
                    (e.horiz && i || !e.horiz && n) && e.setTickInterval(!0)
                }), this.getMargins()), this.drawChartBox(), this.hasCartesianSeries && Ye(o, function(e) {
                    e.render()
                }), this.seriesGroup || (this.seriesGroup = s.g("series-group").attr({
                    zIndex: 3
                }).add()), this.renderSeries(), this.renderLabels(), this.showCredits(r.credits), this.hasRendered = !0
            },
            showCredits: function(e) {
                e.enabled && !this.credits && (this.credits = this.renderer.text(e.text, 0, 0).on("click", function() {
                    e.href && (location.href = e.href)
                }).attr({
                    align: e.position.align,
                    zIndex: 8
                }).css(e.style).add().align(e.position))
            },
            destroy: function() {
                var e, t = this,
                    i = t.axes,
                    n = t.series,
                    o = t.container,
                    s = o && o.parentNode;
                for (et(t, "destroy"), Te[t.index] = T, Oe--, t.renderTo.removeAttribute("data-highcharts-chart"), Ze(t), e = i.length; e--;) i[e] = i[e].destroy();
                for (e = n.length; e--;) n[e] = n[e].destroy();
                Ye("title,subtitle,chartBackground,plotBackground,plotBGImage,plotBorder,seriesGroup,clipRect,credits,pointer,scroller,rangeSelector,legend,resetZoomButton,tooltip,renderer".split(","), function(e) {
                    var i = t[e];
                    i && i.destroy && (t[e] = i.destroy())
                }), o && (o.innerHTML = "", Ze(o), s && w(o));
                for (e in t) delete t[e]
            },
            isReadyToRender: function() {
                var e = this;
                return !Ee && re == re.top && "complete" !== se.readyState || Ie && !re.canvg ? (Ie ? ut.push(function() {
                    e.firstRender()
                }, e.options.global.canvasToolsURL) : se.attachEvent("onreadystatechange", function() {
                    se.detachEvent("onreadystatechange", e.firstRender), "complete" === se.readyState && e.firstRender()
                }), !1) : !0
            },
            firstRender: function() {
                var e = this,
                    t = e.options,
                    i = e.callback;
                e.isReadyToRender() && (e.getContainer(), et(e, "init"), e.resetMargins(), e.setChartSize(), e.propFromSeries(), e.getAxes(), Ye(t.series || [], function(t) {
                    e.initSeries(t)
                }), e.linkSeries(), et(e, "beforeRender"), oe.Pointer && (e.pointer = new ft(e, t)), e.render(), e.renderer.draw(), i && i.apply(e, [e]), Ye(e.callbacks, function(t) {
                    e.index !== T && t.apply(e, [e])
                }), et(e, "load"), e.cloneRenderTo(!0))
            },
            splashArray: function(e, t) {
                var i = t[e],
                    i = n(i) ? i : [i, i, i, i];
                return [ze(t[e + "Top"], i[0]), ze(t[e + "Right"], i[1]), ze(t[e + "Bottom"], i[2]), ze(t[e + "Left"], i[3])]
            }
        };
        var Mt = oe.CenteredSeriesMixin = {
                getCenter: function() {
                    var e, i, n, o = this.options,
                        s = this.chart,
                        r = 2 * (o.slicedOffset || 0),
                        a = s.plotWidth - 2 * r,
                        s = s.plotHeight - 2 * r,
                        l = o.center,
                        l = [ze(l[0], "50%"), ze(l[1], "50%"), o.size || "100%", o.innerSize || 0],
                        c = he(a, s);
                    for (i = 0; 4 > i; ++i) n = l[i], e = /%$/.test(n), o = 2 > i || 2 === i && e, l[i] = (e ? [a, s, c, l[2]][i] * t(n) / 100 : t(n)) + (o ? r : 0);
                    return l
                }
            },
            kt = function() {};
        kt.prototype = {
            init: function(e, t, i) {
                return this.series = e, this.color = e.color, this.applyOptions(t, i), this.pointAttr = {}, e.options.colorByPoint && (t = e.options.colors || e.chart.options.colors, this.color = this.color || t[e.colorCounter++], e.colorCounter === t.length) && (e.colorCounter = 0), e.chart.pointCount++, this
            },
            applyOptions: function(e, t) {
                var i = this.series,
                    n = i.options.pointValKey || i.pointValKey,
                    e = kt.prototype.optionsToObject.call(this, e);
                return Ve(this, e), this.options = this.options ? Ve(this.options, e) : e, n && (this.y = this[n]), this.x === T && i && (this.x = t === T ? i.autoIncrement() : t), this
            },
            optionsToObject: function(e) {
                var t = {},
                    i = this.series,
                    n = i.options.keys,
                    s = n || i.pointArrayMap || ["y"],
                    r = s.length,
                    a = 0,
                    l = 0;
                if ("number" == typeof e || null === e) t[s[0]] = e;
                else if (o(e))
                    for (!n && e.length > r && (i = typeof e[0], "string" === i ? t.name = e[0] : "number" === i && (t.x = e[0]), a++); r > l;) t[s[l++]] = e[a++];
                else "object" == typeof e && (t = e, e.dataLabels && (i._hasPointLabels = !0), e.marker && (i._hasPointMarkers = !0));
                return t
            },
            destroy: function() {
                var e, t = this.series.chart,
                    i = t.hoverPoints;
                t.pointCount--, i && (this.setState(), l(i, this), !i.length) && (t.hoverPoints = null), this === t.hoverPoint && this.onMouseOut(), (this.graphic || this.dataLabel) && (Ze(this), this.destroyElements()), this.legendItem && t.legend.destroyItem(this);
                for (e in this) this[e] = null
            },
            destroyElements: function() {
                for (var e, t = "graphic,dataLabel,dataLabelUpper,group,connector,shadowGroup".split(","), i = 6; i--;) e = t[i], this[e] && (this[e] = this[e].destroy())
            },
            getLabelConfig: function() {
                return {
                    x: this.category,
                    y: this.y,
                    key: this.name || this.category,
                    series: this.series,
                    point: this,
                    percentage: this.percentage,
                    total: this.total || this.stackTotal
                }
            },
            tooltipFormatter: function(e) {
                var t = this.series,
                    i = t.tooltipOptions,
                    n = ze(i.valueDecimals, ""),
                    o = i.valuePrefix || "",
                    s = i.valueSuffix || "";
                return Ye(t.pointArrayMap || ["y"], function(t) {
                    t = "{point." + t, (o || s) && (e = e.replace(t + "}", o + t + "}" + s)), e = e.replace(t + "}", t + ":,." + n + "f}")
                }), _(e, {
                    point: this,
                    series: this.series
                })
            },
            firePointEvent: function(e, t, i) {
                var n = this,
                    o = this.series.options;
                (o.point.events[e] || n.options && n.options.events && n.options.events[e]) && this.importEvents(), "click" === e && o.allowPointSelect && (i = function(e) {
                    n.select(null, e.ctrlKey || e.metaKey || e.shiftKey)
                }), et(this, e, t, i)
            }
        };
        var Bt = oe.Series = function() {};
        Bt.prototype = {
            isCartesian: !0,
            type: "line",
            pointClass: kt,
            sorted: !0,
            requireSorting: !0,
            pointAttrToOptions: {
                stroke: "lineColor",
                "stroke-width": "lineWidth",
                fill: "fillColor",
                r: "radius"
            },
            axisTypes: ["xAxis", "yAxis"],
            colorCounter: 0,
            parallelArrays: ["x", "y"],
            init: function(e, t) {
                var i, n, o = this,
                    s = e.series,
                    r = function(e, t) {
                        return ze(e.options.index, e._i) - ze(t.options.index, t._i)
                    };
                o.chart = e, o.options = t = o.setOptions(t), o.linkedSeries = [], o.bindAxes(), Ve(o, {
                    name: t.name,
                    state: "",
                    pointAttr: {},
                    visible: t.visible !== !1,
                    selected: t.selected === !0
                }), Ie && (t.animation = !1), n = t.events;
                for (i in n) Ke(o, i, n[i]);
                (n && n.click || t.point && t.point.events && t.point.events.click || t.allowPointSelect) && (e.runTrackerClick = !0), o.getColor(), o.getSymbol(), Ye(o.parallelArrays, function(e) {
                    o[e + "Data"] = []
                }), o.setData(t.data, !1), o.isCartesian && (e.hasCartesianSeries = !0), s.push(o), o._i = s.length - 1, v(s, r), this.yAxis && v(this.yAxis.series, r), Ye(s, function(e, t) {
                    e.index = t, e.name = e.name || "Series " + (t + 1)
                })
            },
            bindAxes: function() {
                var e, t = this,
                    i = t.options,
                    n = t.chart;
                Ye(t.axisTypes || [], function(o) {
                    Ye(n[o], function(n) {
                        e = n.options, (i[o] === e.index || i[o] !== T && i[o] === e.id || i[o] === T && 0 === e.index) && (n.series.push(t), t[o] = n, n.isDirty = !0)
                    }), !t[o] && t.optionalAxis !== o && x(18, !0)
                })
            },
            updateParallelArrays: function(e, t) {
                var i = e.series,
                    n = arguments;
                Ye(i.parallelArrays, "number" == typeof t ? function(n) {
                    var o = "y" === n && i.toYData ? i.toYData(e) : e[n];
                    i[n + "Data"][t] = o
                } : function(e) {
                    Array.prototype[t].apply(i[e + "Data"], Array.prototype.slice.call(n, 2))
                })
            },
            autoIncrement: function() {
                var e, t = this.options,
                    i = this.xIncrement,
                    n = t.pointIntervalUnit,
                    i = ze(i, t.pointStart, 0);
                return this.pointInterval = e = ze(this.pointInterval, t.pointInterval, 1), ("month" === n || "year" === n) && (t = new z(i), t = "month" === n ? +t[ie](t[$]() + e) : +t[ne](t[Q]() + e), e = t - i), this.xIncrement = i + e, i
            },
            getSegments: function() {
                var e, t = -1,
                    i = [],
                    n = this.points,
                    o = n.length;
                if (o)
                    if (this.options.connectNulls) {
                        for (e = o; e--;) null === n[e].y && n.splice(e, 1);
                        n.length && (i = [n])
                    } else Ye(n, function(e, s) {
                        null === e.y ? (s > t + 1 && i.push(n.slice(t + 1, s)), t = s) : s === o - 1 && i.push(n.slice(t + 1, s + 1))
                    });
                this.segments = i
            },
            setOptions: function(t) {
                var i = this.chart,
                    n = i.options.plotOptions,
                    i = i.userOptions || {},
                    o = i.plotOptions || {},
                    s = n[this.type];
                return this.userOptions = t, n = e(s, n.series, t), this.tooltipOptions = e(L.tooltip, L.plotOptions[this.type].tooltip, i.tooltip, o.series && o.series.tooltip, o[this.type] && o[this.type].tooltip, t.tooltip), null === s.marker && delete n.marker, this.zoneAxis = n.zoneAxis, t = this.zones = (n.zones || []).slice(), !n.negativeColor && !n.negativeFillColor || n.zones || t.push({
                    value: n[this.zoneAxis + "Threshold"] || n.threshold || 0,
                    color: n.negativeColor,
                    fillColor: n.negativeFillColor
                }), t.length && c(t[t.length - 1].value) && t.push({
                    color: this.color,
                    fillColor: this.fillColor
                }), n
            },
            getCyclic: function(e, t, i) {
                var n = this.userOptions,
                    o = "_" + e + "Index",
                    s = e + "Counter";
                t || (c(n[o]) ? t = n[o] : (n[o] = t = this.chart[s] % i.length, this.chart[s] += 1), t = i[t]), this[e] = t
            },
            getColor: function() {
                this.options.colorByPoint || this.getCyclic("color", this.options.color || ot[this.type].color, this.chart.options.colors)
            },
            getSymbol: function() {
                var e = this.options.marker;
                this.getCyclic("symbol", e.symbol, this.chart.options.symbols), /^url/.test(this.symbol) && (e.radius = 0)
            },
            drawLegendSymbol: dt.drawLineMarker,
            setData: function(e, t, n, r) {
                var a, l = this,
                    c = l.points,
                    d = c && c.length || 0,
                    u = l.options,
                    h = l.chart,
                    m = null,
                    p = l.xAxis,
                    f = p && !!p.categories,
                    g = u.turboThreshold,
                    _ = this.xData,
                    b = this.yData,
                    y = (a = l.pointArrayMap) && a.length,
                    e = e || [];
                if (a = e.length, t = ze(t, !0), r !== !1 && a && d === a && !l.cropped && !l.hasGroupedData && l.visible) Ye(e, function(e, t) {
                    c[t].update(e, !1, null, !1)
                });
                else {
                    if (l.xIncrement = null, l.pointRange = f ? 1 : u.pointRange, l.colorCounter = 0, Ye(this.parallelArrays, function(e) {
                            l[e + "Data"].length = 0
                        }), g && a > g) {
                        for (n = 0; null === m && a > n;) m = e[n], n++;
                        if (s(m)) {
                            for (f = ze(u.pointStart, 0), u = ze(u.pointInterval, 1), n = 0; a > n; n++) _[n] = f, b[n] = e[n], f += u;
                            l.xIncrement = f
                        } else if (o(m))
                            if (y)
                                for (n = 0; a > n; n++) u = e[n], _[n] = u[0], b[n] = u.slice(1, y + 1);
                            else
                                for (n = 0; a > n; n++) u = e[n], _[n] = u[0], b[n] = u[1];
                        else x(12)
                    } else
                        for (n = 0; a > n; n++) e[n] !== T && (u = {
                            series: l
                        }, l.pointClass.prototype.applyOptions.apply(u, [e[n]]), l.updateParallelArrays(u, n), f && u.name) && (p.names[u.x] = u.name);
                    for (i(b[0]) && x(14, !0), l.data = [], l.options.data = e, n = d; n--;) c[n] && c[n].destroy && c[n].destroy();
                    p && (p.minRange = p.userMinRange), l.isDirty = l.isDirtyData = h.isDirtyBox = !0, n = !1
                }
                t && h.redraw(n)
            },
            processData: function(e) {
                var t, i = this.xData,
                    n = this.yData,
                    o = i.length;
                t = 0;
                var s, r, a, l = this.xAxis,
                    c = this.options;
                a = c.cropThreshold;
                var d, u, h = this.isCartesian;
                if (h && !this.isDirty && !l.isDirty && !this.yAxis.isDirty && !e) return !1;
                for (l && (e = l.getExtremes(), d = e.min, u = e.max), h && this.sorted && (!a || o > a || this.forceCrop) && (i[o - 1] < d || i[0] > u ? (i = [], n = []) : (i[0] < d || i[o - 1] > u) && (t = this.cropData(this.xData, this.yData, d, u), i = t.xData, n = t.yData, t = t.start, s = !0)), a = i.length - 1; a >= 0; a--) o = i[a] - i[a - 1], o > 0 && (r === T || r > o) ? r = o : 0 > o && this.requireSorting && x(15);
                this.cropped = s, this.cropStart = t, this.processedXData = i, this.processedYData = n, null === c.pointRange && (this.pointRange = r || 1), this.closestPointRange = r
            },
            cropData: function(e, t, i, n) {
                var o, s = e.length,
                    r = 0,
                    a = s,
                    l = ze(this.cropShoulder, 1);
                for (o = 0; s > o; o++)
                    if (e[o] >= i) {
                        r = ue(0, o - l);
                        break
                    }
                for (; s > o; o++)
                    if (e[o] > n) {
                        a = o + l;
                        break
                    }
                return {
                    xData: e.slice(r, a),
                    yData: t.slice(r, a),
                    start: r,
                    end: a
                }
            },
            generatePoints: function() {
                var e, t, i, n, o = this.options.data,
                    s = this.data,
                    r = this.processedXData,
                    a = this.processedYData,
                    l = this.pointClass,
                    c = r.length,
                    d = this.cropStart || 0,
                    h = this.hasGroupedData,
                    m = [];
                for (s || h || (s = [], s.length = o.length, s = this.data = s), n = 0; c > n; n++) t = d + n, h ? m[n] = (new l).init(this, [r[n]].concat(u(a[n]))) : (s[t] ? i = s[t] : o[t] !== T && (s[t] = i = (new l).init(this, o[t], r[n])), m[n] = i), m[n].index = t;
                if (s && (c !== (e = s.length) || h))
                    for (n = 0; e > n; n++) n === d && !h && (n += c), s[n] && (s[n].destroyElements(), s[n].plotX = T);
                this.data = s, this.points = m
            },
            getExtremes: function(e) {
                var t, i = this.yAxis,
                    n = this.processedXData,
                    o = [],
                    s = 0;
                t = this.xAxis.getExtremes();
                var r, a, l, c, d = t.min,
                    u = t.max,
                    e = e || this.stackedYData || this.processedYData;
                for (t = e.length, c = 0; t > c; c++)
                    if (a = n[c], l = e[c], r = null !== l && l !== T && (!i.isLog || l.length || l > 0), a = this.getExtremesFromAll || this.cropped || (n[c + 1] || a) >= d && (n[c - 1] || a) <= u, r && a)
                        if (r = l.length)
                            for (; r--;) null !== l[r] && (o[s++] = l[r]);
                        else o[s++] = l;
                this.dataMin = M(o), this.dataMax = k(o)
            },
            translate: function() {
                this.processedXData || this.processData(), this.generatePoints();
                for (var e, t, i, n = this.options, o = n.stacking, r = this.xAxis, a = r.categories, l = this.yAxis, d = this.points, u = d.length, h = !!this.modifyValue, m = n.pointPlacement, p = "between" === m || s(m), f = n.threshold, g = Number.MAX_VALUE, n = 0; u > n; n++) {
                    var _ = d[n],
                        b = _.x,
                        y = _.y;
                    t = _.low;
                    var v = o && l.stacks[(this.negStacks && f > y ? "-" : "") + this.stackKey];
                    l.isLog && null !== y && 0 >= y && (_.y = y = null, x(10)), _.plotX = e = r.translate(b, 0, 0, 0, 1, m, "flags" === this.type), o && this.visible && v && v[b] && (v = v[b], y = v.points[this.index + "," + n], t = y[0], y = y[1], 0 === t && (t = ze(f, l.min)), l.isLog && 0 >= t && (t = null), _.total = _.stackTotal = v.total, _.percentage = v.total && _.y / v.total * 100, _.stackY = y, v.setOffset(this.pointXOffset || 0, this.barW || 0)), _.yBottom = c(t) ? l.translate(t, 0, 1, 0, 1) : null, h && (y = this.modifyValue(y, _)), _.plotY = t = "number" == typeof y && y !== 1 / 0 ? he(ue(-1e5, l.translate(y, 0, 1, 0, 1)), 1e5) : T, _.isInside = t !== T && t >= 0 && t <= l.len && e >= 0 && e <= r.len, _.clientX = p ? r.translate(b, 0, 0, 0, 1) : e, _.negative = _.y < (f || 0), _.category = a && a[_.x] !== T ? a[_.x] : _.x, n && (g = he(g, me(e - i))), i = e
                }
                this.closestPointRangePx = g, this.getSegments()
            },
            setClip: function(e) {
                var t = this.chart,
                    i = t.renderer,
                    n = t.inverted,
                    o = this.clipBox,
                    s = o || t.clipBox,
                    r = this.sharedClipKey || ["_sharedClip", e && e.duration, e && e.easing, s.height].join(","),
                    a = t[r],
                    l = t[r + "m"];
                a || (e && (s.width = 0, t[r + "m"] = l = i.clipRect(-99, n ? -t.plotLeft : -t.plotTop, 99, n ? t.chartWidth : t.chartHeight)),
                    t[r] = a = i.clipRect(s)), e && (a.count += 1), this.options.clip !== !1 && (this.group.clip(e || o ? a : t.clipRect), this.markerGroup.clip(l), this.sharedClipKey = r), e || (a.count -= 1, a.count <= 0 && r && t[r] && (o || (t[r] = t[r].destroy()), t[r + "m"] && (t[r + "m"] = t[r + "m"].destroy())))
            },
            animate: function(e) {
                var t, i = this.chart,
                    o = this.options.animation;
                o && !n(o) && (o = ot[this.type].animation), e ? this.setClip(o) : (t = this.sharedClipKey, (e = i[t]) && e.animate({
                    width: i.plotSizeX
                }, o), i[t + "m"] && i[t + "m"].animate({
                    width: i.plotSizeX + 99
                }, o), this.animate = null)
            },
            afterAnimate: function() {
                this.setClip(), et(this, "afterAnimate")
            },
            drawPoints: function() {
                var e, t, i, n, o, s, r, a, l, c, d, u, h = this.points,
                    m = this.chart,
                    p = this.options.marker,
                    f = this.pointAttr[""],
                    g = this.markerGroup,
                    _ = ze(p.enabled, this.xAxis.isRadial, this.closestPointRangePx > 2 * p.radius);
                if (p.enabled !== !1 || this._hasPointMarkers)
                    for (n = h.length; n--;) o = h[n], t = ce(o.plotX), i = o.plotY, l = o.graphic, c = o.marker || {}, d = !!o.marker, e = _ && c.enabled === T || c.enabled, u = o.isInside, e && i !== T && !isNaN(i) && null !== o.y ? (e = o.pointAttr[o.selected ? "select" : ""] || f, s = e.r, r = ze(c.symbol, this.symbol), a = 0 === r.indexOf("url"), l ? l[u ? "show" : "hide"](!0).animate(Ve({
                        x: t - s,
                        y: i - s
                    }, l.symbolName ? {
                        width: 2 * s,
                        height: 2 * s
                    } : {})) : u && (s > 0 || a) && (o.graphic = m.renderer.symbol(r, t - s, i - s, 2 * s, 2 * s, d ? c : p).attr(e).add(g))) : l && (o.graphic = l.destroy())
            },
            convertAttribs: function(e, t, i, n) {
                var o, s, r = this.pointAttrToOptions,
                    a = {},
                    e = e || {},
                    t = t || {},
                    i = i || {},
                    n = n || {};
                for (o in r) s = r[o], a[o] = ze(e[s], t[o], i[o], n[o]);
                return a
            },
            getAttribs: function() {
                var e, t = this,
                    i = t.options,
                    n = ot[t.type].marker ? i.marker : i,
                    o = n.states,
                    s = o.hover,
                    r = t.color,
                    a = t.options.negativeColor;
                e = {
                    stroke: r,
                    fill: r
                };
                var l, d, u = t.points || [],
                    h = [],
                    m = t.pointAttrToOptions;
                d = t.hasPointSpecificOptions;
                var p = n.lineColor,
                    f = n.fillColor;
                l = i.turboThreshold;
                var g, _ = t.zones,
                    b = t.zoneAxis || "y";
                if (i.marker ? (s.radius = s.radius || n.radius + s.radiusPlus, s.lineWidth = s.lineWidth || n.lineWidth + s.lineWidthPlus) : (s.color = s.color || lt(s.color || r).brighten(s.brightness).get(), s.negativeColor = s.negativeColor || lt(s.negativeColor || a).brighten(s.brightness).get()), h[""] = t.convertAttribs(n, e), Ye(["hover", "select"], function(e) {
                        h[e] = t.convertAttribs(o[e], h[""])
                    }), t.pointAttr = h, r = u.length, !l || l > r || d)
                    for (; r--;) {
                        if (l = u[r], (n = l.options && l.options.marker || l.options) && n.enabled === !1 && (n.radius = 0), _.length) {
                            for (d = 0, e = _[d]; l[b] >= e.value;) e = _[++d];
                            l.color = l.fillColor = e.color
                        }
                        if (d = i.colorByPoint || l.color, l.options)
                            for (g in m) c(n[m[g]]) && (d = !0);
                        d ? (n = n || {}, d = [], o = n.states || {}, e = o.hover = o.hover || {}, i.marker || (e.color = e.color || !l.options.color && s[l.negative && a ? "negativeColor" : "color"] || lt(l.color).brighten(e.brightness || s.brightness).get()), e = {
                            color: l.color
                        }, f || (e.fillColor = l.color), p || (e.lineColor = l.color), n.hasOwnProperty("color") && !n.color && delete n.color, d[""] = t.convertAttribs(Ve(e, n), h[""]), d.hover = t.convertAttribs(o.hover, h.hover, d[""]), d.select = t.convertAttribs(o.select, h.select, d[""])) : d = h, l.pointAttr = d
                    }
            },
            destroy: function() {
                var e, t, i, n, o = this,
                    s = o.chart,
                    r = /AppleWebKit\/533/.test(be),
                    a = o.data || [];
                for (et(o, "destroy"), Ze(o), Ye(o.axisTypes || [], function(e) {
                        (n = o[e]) && (l(n.series, o), n.isDirty = n.forceRedraw = !0)
                    }), o.legendItem && o.chart.legend.destroyItem(o), e = a.length; e--;)(t = a[e]) && t.destroy && t.destroy();
                o.points = null, clearTimeout(o.animationTimeout);
                for (i in o) o[i] instanceof S && !o[i].survive && (e = r && "group" === i ? "hide" : "destroy", o[i][e]());
                s.hoverSeries === o && (s.hoverSeries = null), l(s.series, o);
                for (i in o) delete o[i]
            },
            getSegmentPath: function(e) {
                var t = this,
                    i = [],
                    n = t.options.step;
                return Ye(e, function(o, s) {
                    var r, a = o.plotX,
                        l = o.plotY;
                    t.getPointSpline ? i.push.apply(i, t.getPointSpline(e, o, s)) : (i.push(s ? "L" : "M"), n && s && (r = e[s - 1], "right" === n ? i.push(r.plotX, l) : "center" === n ? i.push((r.plotX + a) / 2, r.plotY, (r.plotX + a) / 2, l) : i.push(a, r.plotY)), i.push(o.plotX, o.plotY))
                }), i
            },
            getGraphPath: function() {
                var e, t = this,
                    i = [],
                    n = [];
                return Ye(t.segments, function(o) {
                    e = t.getSegmentPath(o), o.length > 1 ? i = i.concat(e) : n.push(o[0])
                }), t.singlePoints = n, t.graphPath = i
            },
            drawGraph: function() {
                var e = this,
                    t = this.options,
                    i = [
                        ["graph", t.lineColor || this.color, t.dashStyle]
                    ],
                    n = t.lineWidth,
                    o = "square" !== t.linecap,
                    s = this.getGraphPath(),
                    r = this.fillGraph && this.color || Ae;
                Ye(this.zones, function(n, o) {
                    i.push(["zoneGraph" + o, n.color || e.color, n.dashStyle || t.dashStyle])
                }), Ye(i, function(i, a) {
                    var l = i[0],
                        c = e[l];
                    c ? (nt(c), c.animate({
                        d: s
                    })) : (n || r) && s.length && (c = {
                        stroke: i[1],
                        "stroke-width": n,
                        fill: r,
                        zIndex: 1
                    }, i[2] ? c.dashstyle = i[2] : o && (c["stroke-linecap"] = c["stroke-linejoin"] = "round"), e[l] = e.chart.renderer.path(s).attr(c).add(e.group).shadow(2 > a && t.shadow))
                })
            },
            applyZones: function() {
                var e, t, i, n = this,
                    o = this.chart,
                    s = o.renderer,
                    r = this.zones,
                    a = this.clips || [],
                    l = this.graph,
                    c = this.area,
                    d = ue(o.chartWidth, o.chartHeight),
                    u = this[(this.zoneAxis || "y") + "Axis"],
                    h = u.reversed,
                    m = u.horiz,
                    p = !1;
                r.length && (l || c) && (l && l.hide(), c && c.hide(), Ye(r, function(r, f) {
                    e = ze(t, h ? m ? o.plotWidth : 0 : m ? 0 : u.toPixels(u.min)), t = le(u.toPixels(ze(r.value, u.max), !0)), e = u.isXAxis ? e > t ? t : e : t > e ? t : e, p && (e = t = u.toPixels(u.max)), u.isXAxis ? (i = {
                        x: h ? t : e,
                        y: 0,
                        width: Math.abs(e - t),
                        height: d
                    }, m || (i.x = o.plotHeight - i.x)) : (i = {
                        x: 0,
                        y: h ? e : t,
                        width: d,
                        height: Math.abs(e - t)
                    }, m && (i.y = o.plotWidth - i.y)), o.inverted && s.isVML && (i = u.isXAxis ? {
                        x: 0,
                        y: h ? e : t,
                        height: i.width,
                        width: o.chartWidth
                    } : {
                        x: i.y - o.plotLeft - o.spacingBox.x,
                        y: 0,
                        width: i.height,
                        height: o.chartHeight
                    }), a[f] ? a[f].animate(i) : (a[f] = s.clipRect(i), l && n["zoneGraph" + f].clip(a[f]), c && n["zoneArea" + f].clip(a[f])), p = r.value > u.max
                }), this.clips = a)
            },
            invertGroups: function() {
                function e() {
                    var e = {
                        width: t.yAxis.len,
                        height: t.xAxis.len
                    };
                    Ye(["group", "markerGroup"], function(i) {
                        t[i] && t[i].attr(e).invert()
                    })
                }
                var t = this,
                    i = t.chart;
                t.xAxis && (Ke(i, "resize", e), Ke(t, "destroy", function() {
                    Ze(i, "resize", e)
                }), e(), t.invertGroups = e)
            },
            plotGroup: function(e, t, i, n, o) {
                var s = this[e],
                    r = !s;
                return r && (this[e] = s = this.chart.renderer.g(t).attr({
                    visibility: i,
                    zIndex: n || .1
                }).add(o)), s[r ? "attr" : "animate"](this.getPlotBox()), s
            },
            getPlotBox: function() {
                var e = this.chart,
                    t = this.xAxis,
                    i = this.yAxis;
                return e.inverted && (t = i, i = this.xAxis), {
                    translateX: t ? t.left : e.plotLeft,
                    translateY: i ? i.top : e.plotTop,
                    scaleX: 1,
                    scaleY: 1
                }
            },
            render: function() {
                var e, t = this,
                    i = t.chart,
                    n = t.options,
                    o = (e = n.animation) && !!t.animate && i.renderer.isSVG && ze(e.duration, 500) || 0,
                    s = t.visible ? "visible" : "hidden",
                    r = n.zIndex,
                    a = t.hasRendered,
                    l = i.seriesGroup;
                e = t.plotGroup("group", "series", s, r, l), t.markerGroup = t.plotGroup("markerGroup", "markers", s, r, l), o && t.animate(!0), t.getAttribs(), e.inverted = t.isCartesian ? i.inverted : !1, t.drawGraph && (t.drawGraph(), t.applyZones()), Ye(t.points, function(e) {
                    e.redraw && e.redraw()
                }), t.drawDataLabels && t.drawDataLabels(), t.visible && t.drawPoints(), t.drawTracker && t.options.enableMouseTracking !== !1 && t.drawTracker(), i.inverted && t.invertGroups(), n.clip !== !1 && !t.sharedClipKey && !a && e.clip(i.clipRect), o && t.animate(), a || (o ? t.animationTimeout = setTimeout(function() {
                    t.afterAnimate()
                }, o) : t.afterAnimate()), t.isDirty = t.isDirtyData = !1, t.hasRendered = !0
            },
            redraw: function() {
                var e = this.chart,
                    t = this.isDirtyData,
                    i = this.isDirty,
                    n = this.group,
                    o = this.xAxis,
                    s = this.yAxis;
                n && (e.inverted && n.attr({
                    width: e.plotWidth,
                    height: e.plotHeight
                }), n.animate({
                    translateX: ze(o && o.left, e.plotLeft),
                    translateY: ze(s && s.top, e.plotTop)
                })), this.translate(), this.render(), t && et(this, "updatedData"), (i || t) && delete this.kdTree
            },
            kdDimensions: 1,
            kdTree: null,
            kdAxisArray: ["clientX", "plotY"],
            kdComparer: "distX",
            searchPoint: function(e) {
                var t = this.xAxis,
                    i = this.yAxis,
                    n = this.chart.inverted;
                return this.searchKDTree({
                    clientX: n ? t.len - e.chartY + t.pos : e.chartX - t.pos,
                    plotY: n ? i.len - e.chartX + i.pos : e.chartY - i.pos
                })
            },
            buildKDTree: function() {
                function e(t, n, o) {
                    var s, r;
                    return (r = t && t.length) ? (s = i.kdAxisArray[n % o], t.sort(function(e, t) {
                        return e[s] - t[s]
                    }), r = Math.floor(r / 2), {
                        point: t[r],
                        left: e(t.slice(0, r), n + 1, o),
                        right: e(t.slice(r + 1), n + 1, o)
                    }) : void 0
                }

                function t() {
                    var t = $e(i.points, function(e) {
                        return null !== e.y
                    });
                    i.kdTree = e(t, n, n)
                }
                var i = this,
                    n = i.kdDimensions;
                delete i.kdTree, i.options.kdSync ? t() : setTimeout(t)
            },
            searchKDTree: function(e) {
                function t(e, r, a, l) {
                    var d, u = r.point,
                        h = i.kdAxisArray[a % l],
                        m = u;
                    d = c(e[o]) && c(u[o]) ? Math.pow(e[o] - u[o], 2) : null;
                    var p = c(e[s]) && c(u[s]) ? Math.pow(e[s] - u[s], 2) : null,
                        f = (d || 0) + (p || 0);
                    return d = {
                        distX: c(d) ? Math.sqrt(d) : Number.MAX_VALUE,
                        distY: c(p) ? Math.sqrt(p) : Number.MAX_VALUE,
                        distR: c(f) ? Math.sqrt(f) : Number.MAX_VALUE
                    }, u.dist = d, h = e[h] - u[h], d = 0 > h ? "left" : "right", r[d] && (d = t(e, r[d], a + 1, l), m = d.dist[n] < m.dist[n] ? d : u, u = 0 > h ? "right" : "left", r[u] && Math.sqrt(h * h) < m.dist[n] && (e = t(e, r[u], a + 1, l), m = e.dist[n] < m.dist[n] ? e : m)), m
                }
                var i = this,
                    n = this.kdComparer,
                    o = this.kdAxisArray[0],
                    s = this.kdAxisArray[1];
                return this.kdTree || this.buildKDTree(), this.kdTree ? t(e, this.kdTree, this.kdDimensions, this.kdDimensions) : void 0
            }
        }, C.prototype = {
            destroy: function() {
                B(this, this.axis)
            },
            render: function(e) {
                var t = this.options,
                    i = t.format,
                    i = i ? _(i, this) : t.formatter.call(this);
                this.label ? this.label.attr({
                    text: i,
                    visibility: "hidden"
                }) : this.label = this.axis.chart.renderer.text(i, null, null, t.useHTML).css(t.style).attr({
                    align: this.textAlign,
                    rotation: t.rotation,
                    visibility: "hidden"
                }).add(e)
            },
            setOffset: function(e, t) {
                var i = this.axis,
                    n = i.chart,
                    o = n.inverted,
                    s = i.reversed,
                    s = this.isNegative && !s || !this.isNegative && s,
                    r = i.translate(i.usePercentage ? 100 : this.total, 0, 0, 0, 1),
                    i = i.translate(0),
                    i = me(r - i),
                    a = n.xAxis[0].translate(this.x) + e,
                    l = n.plotHeight,
                    s = {
                        x: o ? s ? r : r - i : a,
                        y: o ? l - a - t : s ? l - r - i : l - r,
                        width: o ? i : t,
                        height: o ? t : i
                    };
                (o = this.label) && (o.align(this.alignOptions, null, s), s = o.alignAttr, o[this.options.crop === !1 || n.isInsidePlot(s.x, s.y) ? "show" : "hide"](!0))
            }
        }, ht.prototype.buildStacks = function() {
            var e = this.series,
                t = ze(this.options.reversedStacks, !0),
                i = e.length;
            if (!this.isXAxis) {
                for (this.usePercentage = !1; i--;) e[t ? i : e.length - i - 1].setStackedPoints();
                if (this.usePercentage)
                    for (i = 0; i < e.length; i++) e[i].setPercentStacks()
            }
        }, ht.prototype.renderStackTotals = function() {
            var e, t, i = this.chart,
                n = i.renderer,
                o = this.stacks,
                s = this.stackTotalGroup;
            s || (this.stackTotalGroup = s = n.g("stack-labels").attr({
                visibility: "visible",
                zIndex: 6
            }).add()), s.translate(i.plotLeft, i.plotTop);
            for (e in o)
                for (t in i = o[e]) i[t].render(s)
        }, Bt.prototype.setStackedPoints = function() {
            if (this.options.stacking && (this.visible === !0 || this.chart.options.chart.ignoreHiddenSeries === !1)) {
                var e, t, i, n, o, s, r = this.processedXData,
                    a = this.processedYData,
                    l = [],
                    c = a.length,
                    d = this.options,
                    u = d.threshold,
                    h = d.stack,
                    d = d.stacking,
                    m = this.stackKey,
                    p = "-" + m,
                    f = this.negStacks,
                    g = this.yAxis,
                    _ = g.stacks,
                    b = g.oldStacks;
                for (n = 0; c > n; n++) o = r[n], s = a[n], i = this.index + "," + n, t = (e = f && u > s) ? p : m, _[t] || (_[t] = {}), _[t][o] || (b[t] && b[t][o] ? (_[t][o] = b[t][o], _[t][o].total = null) : _[t][o] = new C(g, g.options.stackLabels, e, o, h)), t = _[t][o], t.points[i] = [t.cum || 0], "percent" === d ? (e = e ? m : p, f && _[e] && _[e][o] ? (e = _[e][o], t.total = e.total = ue(e.total, t.total) + me(s) || 0) : t.total = E(t.total + (me(s) || 0))) : t.total = E(t.total + (s || 0)), t.cum = (t.cum || 0) + (s || 0), t.points[i].push(t.cum), l[n] = t.cum;
                "percent" === d && (g.usePercentage = !0), this.stackedYData = l, g.oldStacks = {}
            }
        }, Bt.prototype.setPercentStacks = function() {
            var e = this,
                t = e.stackKey,
                i = e.yAxis.stacks,
                n = e.processedXData;
            Ye([t, "-" + t], function(t) {
                for (var o, s, r, a = n.length; a--;) s = n[a], o = (r = i[t] && i[t][s]) && r.points[e.index + "," + a], (s = o) && (r = r.total ? 100 / r.total : 0, s[0] = E(s[0] * r), s[1] = E(s[1] * r), e.stackedYData[a] = s[1])
            })
        }, Ve(Ge.prototype, {
            addSeries: function(e, t, i) {
                var n, o = this;
                return e && (t = ze(t, !0), et(o, "addSeries", {
                    options: e
                }, function() {
                    n = o.initSeries(e), o.isDirtyLegend = !0, o.linkSeries(), t && o.redraw(i)
                })), n
            },
            addAxis: function(t, i, n, o) {
                var s = i ? "xAxis" : "yAxis",
                    r = this.options;
                new ht(this, e(t, {
                    index: this[s].length,
                    isX: i
                })), r[s] = u(r[s] || {}), r[s].push(t), ze(n, !0) && this.redraw(o)
            },
            showLoading: function(e) {
                var t = this,
                    i = t.options,
                    n = t.loadingDiv,
                    o = i.loading,
                    s = function() {
                        n && h(n, {
                            left: t.plotLeft + "px",
                            top: t.plotTop + "px",
                            width: t.plotWidth + "px",
                            height: t.plotHeight + "px"
                        })
                    };
                n || (t.loadingDiv = n = m(Pe, {
                    className: "highcharts-loading"
                }, Ve(o.style, {
                    zIndex: 10,
                    display: Ae
                }), t.container), t.loadingSpan = m("span", null, o.labelStyle, n), Ke(t, "redraw", s)), t.loadingSpan.innerHTML = e || i.lang.loading, t.loadingShown || (h(n, {
                    opacity: 0,
                    display: ""
                }), it(n, {
                    opacity: o.style.opacity
                }, {
                    duration: o.showDuration || 0
                }), t.loadingShown = !0), s()
            },
            hideLoading: function() {
                var e = this.options,
                    t = this.loadingDiv;
                t && it(t, {
                    opacity: 0
                }, {
                    duration: e.loading.hideDuration || 100,
                    complete: function() {
                        h(t, {
                            display: Ae
                        })
                    }
                }), this.loadingShown = !1
            }
        }), Ve(kt.prototype, {
            update: function(e, t, i, s) {
                function r() {
                    l.applyOptions(e), n(e) && !o(e) && (l.redraw = function() {
                        d && (e && e.marker && e.marker.symbol ? l.graphic = d.destroy() : d.attr(l.pointAttr[l.state || ""])), e && e.dataLabels && l.dataLabel && (l.dataLabel = l.dataLabel.destroy()), l.redraw = null
                    }), a = l.index, c.updateParallelArrays(l, a), m && l.name && (m[l.x] = l.name), h.data[a] = l.options, c.isDirty = c.isDirtyData = !0, !c.fixedBox && c.hasCartesianSeries && (u.isDirtyBox = !0), u.legend.display && "point" === h.legendType && (c.updateTotals(), u.legend.clearItems()), t && u.redraw(i)
                }
                var a, l = this,
                    c = l.series,
                    d = l.graphic,
                    u = c.chart,
                    h = c.options,
                    m = c.xAxis && c.xAxis.names,
                    t = ze(t, !0);
                s === !1 ? r() : l.firePointEvent("update", {
                    options: e
                }, r)
            },
            remove: function(e, t) {
                this.series.removePoint(Je(this, this.series.data), e, t)
            }
        }), Ve(Bt.prototype, {
            addPoint: function(e, t, i, n) {
                var o, s = this,
                    r = s.options,
                    a = s.data,
                    l = s.graph,
                    c = s.area,
                    d = s.chart,
                    u = s.xAxis && s.xAxis.names,
                    h = l && l.shift || 0,
                    m = ["graph", "area"],
                    l = r.data,
                    p = s.xData;
                if (N(n, d), i) {
                    for (n = s.zones.length; n--;) m.push("zoneGraph" + n, "zoneArea" + n);
                    Ye(m, function(e) {
                        s[e] && (s[e].shift = h + 1)
                    })
                }
                if (c && (c.isArea = !0), t = ze(t, !0), c = {
                        series: s
                    }, s.pointClass.prototype.applyOptions.apply(c, [e]), m = c.x, n = p.length, s.requireSorting && m < p[n - 1])
                    for (o = !0; n && p[n - 1] > m;) n--;
                s.updateParallelArrays(c, "splice", n, 0, 0), s.updateParallelArrays(c, n), u && c.name && (u[m] = c.name), l.splice(n, 0, e), o && (s.data.splice(n, 0, null), s.processData()), "point" === r.legendType && s.generatePoints(), i && (a[0] && a[0].remove ? a[0].remove(!1) : (a.shift(), s.updateParallelArrays(c, "shift"), l.shift())), s.isDirty = !0, s.isDirtyData = !0, t && (s.getAttribs(), d.redraw())
            },
            removePoint: function(e, t, i) {
                var n = this,
                    o = n.data,
                    s = o[e],
                    r = n.points,
                    a = n.chart,
                    l = function() {
                        o.length === r.length && r.splice(e, 1), o.splice(e, 1), n.options.data.splice(e, 1), n.updateParallelArrays(s || {
                            series: n
                        }, "splice", e, 1), s && s.destroy(), n.isDirty = !0, n.isDirtyData = !0, t && a.redraw()
                    };
                N(i, a), t = ze(t, !0), s ? s.firePointEvent("remove", null, l) : l()
            },
            remove: function(e, t) {
                var i = this,
                    n = i.chart,
                    e = ze(e, !0);
                i.isRemoving || (i.isRemoving = !0, et(i, "remove", null, function() {
                    i.destroy(), n.isDirtyLegend = n.isDirtyBox = !0, n.linkSeries(), e && n.redraw(t)
                })), i.isRemoving = !1
            },
            update: function(t, i) {
                var n, o = this,
                    s = this.chart,
                    r = this.userOptions,
                    a = this.type,
                    l = Fe[a].prototype,
                    c = ["group", "markerGroup", "dataLabelsGroup"];
                (t.type && t.type !== a || void 0 !== t.zIndex) && (c.length = 0), Ye(c, function(e) {
                    c[e] = o[e], delete o[e]
                }), t = e(r, {
                    animation: !1,
                    index: this.index,
                    pointStart: this.xData[0]
                }, {
                    data: this.options.data
                }, t), this.remove(!1);
                for (n in l) this[n] = T;
                Ve(this, Fe[t.type || a].prototype), Ye(c, function(e) {
                    o[e] = c[e]
                }), this.init(s, t), s.linkSeries(), ze(i, !0) && s.redraw(!1)
            }
        }), Ve(ht.prototype, {
            update: function(t, i) {
                var n = this.chart,
                    t = n.options[this.coll][this.options.index] = e(this.userOptions, t);
                this.destroy(!0), this._addedPlotLB = T, this.init(n, Ve(t, {
                    events: T
                })), n.isDirtyBox = !0, ze(i, !0) && n.redraw()
            },
            remove: function(e) {
                for (var t = this.chart, i = this.coll, n = this.series, o = n.length; o--;) n[o] && n[o].remove(!1);
                l(t.axes, this), l(t[i], this), t.options[i].splice(this.options.index, 1), Ye(t[i], function(e, t) {
                    e.options.index = t
                }), this.destroy(), t.isDirtyBox = !0, ze(e, !0) && t.redraw()
            },
            setTitle: function(e, t) {
                this.update({
                    title: e
                }, t)
            },
            setCategories: function(e, t) {
                this.update({
                    categories: e
                }, t)
            }
        });
        var wt = p(Bt);
        Fe.line = wt, ot.area = e(Ue, {
            threshold: 0
        });
        var xt = p(Bt, {
            type: "area",
            getSegments: function() {
                var e, t, i, n, o = this,
                    s = [],
                    r = [],
                    a = [],
                    l = this.xAxis,
                    c = this.yAxis,
                    d = c.stacks[this.stackKey],
                    u = {},
                    h = this.points,
                    m = this.options.connectNulls;
                if (this.options.stacking && !this.cropped) {
                    for (i = 0; i < h.length; i++) u[h[i].x] = h[i];
                    for (n in d) null !== d[n].total && a.push(+n);
                    a.sort(function(e, t) {
                        return e - t
                    }), Ye(a, function(n) {
                        var s, a = 0;
                        if (!m || u[n] && null !== u[n].y)
                            if (u[n]) r.push(u[n]);
                            else {
                                for (i = o.index; i <= c.series.length; i++)
                                    if (s = d[n].points[i + "," + n]) {
                                        a = s[1];
                                        break
                                    }
                                e = l.translate(n), t = c.toPixels(a, !0), r.push({
                                    y: null,
                                    plotX: e,
                                    clientX: e,
                                    plotY: t,
                                    yBottom: t,
                                    onMouseOver: Ce
                                })
                            }
                    }), r.length && s.push(r)
                } else Bt.prototype.getSegments.call(this), s = this.segments;
                this.segments = s
            },
            getSegmentPath: function(e) {
                var t, i = Bt.prototype.getSegmentPath.call(this, e),
                    n = [].concat(i),
                    o = this.options;
                t = i.length;
                var s, r = this.yAxis.getThreshold(o.threshold);
                if (3 === t && n.push("L", i[1], i[2]), o.stacking && !this.closedStacks)
                    for (t = e.length - 1; t >= 0; t--) s = ze(e[t].yBottom, r), t < e.length - 1 && o.step && n.push(e[t + 1].plotX, s), n.push(e[t].plotX, s);
                else this.closeSegment(n, e, r);
                return this.areaPath = this.areaPath.concat(n), i
            },
            closeSegment: function(e, t, i) {
                e.push("L", t[t.length - 1].plotX, i, "L", t[0].plotX, i)
            },
            drawGraph: function() {
                this.areaPath = [], Bt.prototype.drawGraph.apply(this);
                var e = this,
                    t = this.areaPath,
                    i = this.options,
                    n = [
                        ["area", this.color, i.fillColor]
                    ];
                Ye(this.zones, function(t, o) {
                    n.push(["zoneArea" + o, t.color || e.color, t.fillColor || i.fillColor])
                }), Ye(n, function(n) {
                    var o = n[0],
                        s = e[o];
                    s ? s.animate({
                        d: t
                    }) : e[o] = e.chart.renderer.path(t).attr({
                        fill: ze(n[2], lt(n[1]).setOpacity(ze(i.fillOpacity, .75)).get()),
                        zIndex: 0
                    }).add(e.group)
                })
            },
            drawLegendSymbol: dt.drawRectangle
        });
        Fe.area = xt, ot.spline = e(Ue), wt = p(Bt, {
                type: "spline",
                getPointSpline: function(e, t, i) {
                    var n, o, s, r, a = t.plotX,
                        l = t.plotY,
                        c = e[i - 1],
                        d = e[i + 1];
                    if (c && d) {
                        e = c.plotY, s = d.plotX;
                        var u, d = d.plotY;
                        n = (1.5 * a + c.plotX) / 2.5, o = (1.5 * l + e) / 2.5, s = (1.5 * a + s) / 2.5, r = (1.5 * l + d) / 2.5, u = (r - o) * (s - a) / (s - n) + l - r, o += u, r += u, o > e && o > l ? (o = ue(e, l), r = 2 * l - o) : e > o && l > o && (o = he(e, l), r = 2 * l - o), r > d && r > l ? (r = ue(d, l), o = 2 * l - r) : d > r && l > r && (r = he(d, l), o = 2 * l - r), t.rightContX = s, t.rightContY = r
                    }
                    return i ? (t = ["C", c.rightContX || c.plotX, c.rightContY || c.plotY, n || a, o || l, a, l], c.rightContX = c.rightContY = null) : t = ["M", a, l], t
                }
            }), Fe.spline = wt, ot.areaspline = e(ot.area), xt = xt.prototype, wt = p(wt, {
                type: "areaspline",
                closedStacks: !0,
                getSegmentPath: xt.getSegmentPath,
                closeSegment: xt.closeSegment,
                drawGraph: xt.drawGraph,
                drawLegendSymbol: dt.drawRectangle
            }), Fe.areaspline = wt, ot.column = e(Ue, {
                borderColor: "#FFFFFF",
                borderRadius: 0,
                groupPadding: .2,
                marker: null,
                pointPadding: .1,
                minPointLength: 0,
                cropThreshold: 50,
                pointRange: null,
                states: {
                    hover: {
                        brightness: .1,
                        shadow: !1,
                        halo: !1
                    },
                    select: {
                        color: "#C0C0C0",
                        borderColor: "#000000",
                        shadow: !1
                    }
                },
                dataLabels: {
                    align: null,
                    verticalAlign: null,
                    y: null
                },
                stickyTracking: !1,
                tooltip: {
                    distance: 6
                },
                threshold: 0
            }), wt = p(Bt, {
                type: "column",
                pointAttrToOptions: {
                    stroke: "borderColor",
                    fill: "color",
                    r: "borderRadius"
                },
                cropShoulder: 0,
                directTouch: !0,
                trackerGroups: ["group", "dataLabelsGroup"],
                negStacks: !0,
                init: function() {
                    Bt.prototype.init.apply(this, arguments);
                    var e = this,
                        t = e.chart;
                    t.hasRendered && Ye(t.series, function(t) {
                        t.type === e.type && (t.isDirty = !0)
                    })
                },
                getColumnMetrics: function() {
                    var e, t, i = this,
                        n = i.options,
                        o = i.xAxis,
                        s = i.yAxis,
                        r = o.reversed,
                        a = {},
                        l = 0;
                    n.grouping === !1 ? l = 1 : Ye(i.chart.series, function(n) {
                        var o = n.options,
                            r = n.yAxis;
                        n.type === i.type && n.visible && s.len === r.len && s.pos === r.pos && (o.stacking ? (e = n.stackKey, a[e] === T && (a[e] = l++), t = a[e]) : o.grouping !== !1 && (t = l++), n.columnIndex = t)
                    });
                    var o = he(me(o.transA) * (o.ordinalSlope || n.pointRange || o.closestPointRange || o.tickInterval || 1), o.len),
                        d = o * n.groupPadding,
                        u = (o - 2 * d) / l,
                        h = n.pointWidth,
                        n = c(h) ? (u - h) / 2 : u * n.pointPadding,
                        h = ze(h, u - 2 * n);
                    return i.columnMetrics = {
                        width: h,
                        offset: n + (d + ((r ? l - (i.columnIndex || 0) : i.columnIndex) || 0) * u - o / 2) * (r ? -1 : 1)
                    }
                },
                translate: function() {
                    var e = this,
                        t = e.chart,
                        i = e.options,
                        n = e.borderWidth = ze(i.borderWidth, e.closestPointRange * e.xAxis.transA < 2 ? 0 : 1),
                        o = e.yAxis,
                        s = e.translatedThreshold = o.getThreshold(i.threshold),
                        r = ze(i.minPointLength, 5),
                        a = e.getColumnMetrics(),
                        l = a.width,
                        c = e.barW = ue(l, 1 + 2 * n),
                        d = e.pointXOffset = a.offset,
                        u = -(n % 2 ? .5 : 0),
                        h = n % 2 ? .5 : 1;
                    t.inverted && (s -= .5, t.renderer.isVML && (h += 1)), i.pointPadding && (c = de(c)), Bt.prototype.translate.apply(e), Ye(e.points, function(i) {
                        var n, a, m = ze(i.yBottom, s),
                            p = he(ue(-999 - m, i.plotY), o.len + 999 + m),
                            f = i.plotX + d,
                            g = c,
                            _ = he(p, m);
                        n = ue(p, m) - _, me(n) < r && r && (n = r, a = !o.reversed && !i.negative || o.reversed && i.negative, _ = le(me(_ - s) > r ? m - r : s - (a ? r : 0))), i.barX = f, i.pointWidth = l, i.tooltipPos = t.inverted ? [o.len + o.pos - t.plotLeft - p, e.xAxis.len - f - g / 2] : [f + g / 2, p + o.pos - t.plotTop], g = le(f + g) + u, f = le(f) + u, g -= f, m = me(_) < .5, n = he(le(_ + n) + h, 9e4), _ = le(_) + h, n -= _, m && (_ -= 1, n += 1), i.shapeType = "rect", i.shapeArgs = {
                            x: f,
                            y: _,
                            width: g,
                            height: n
                        }
                    })
                },
                getSymbol: Ce,
                drawLegendSymbol: dt.drawRectangle,
                drawGraph: Ce,
                drawPoints: function() {
                    var t, i, n = this,
                        o = this.chart,
                        s = n.options,
                        r = o.renderer,
                        a = s.animationLimit || 250;
                    Ye(n.points, function(l) {
                        var d = l.plotY,
                            u = l.graphic;
                        d === T || isNaN(d) || null === l.y ? u && (l.graphic = u.destroy()) : (t = l.shapeArgs, d = c(n.borderWidth) ? {
                            "stroke-width": n.borderWidth
                        } : {}, i = l.pointAttr[l.selected ? "select" : ""] || n.pointAttr[""], u ? (nt(u), u.attr(d)[o.pointCount < a ? "animate" : "attr"](e(t))) : l.graphic = r[l.shapeType](t).attr(d).attr(i).add(n.group).shadow(s.shadow, null, s.stacking && !s.borderRadius))
                    })
                },
                animate: function(e) {
                    var t = this.yAxis,
                        i = this.options,
                        n = this.chart.inverted,
                        o = {};
                    Ee && (e ? (o.scaleY = .001, e = he(t.pos + t.len, ue(t.pos, t.toPixels(i.threshold))), n ? o.translateX = e - t.len : o.translateY = e, this.group.attr(o)) : (o.scaleY = 1, o[n ? "translateX" : "translateY"] = t.pos, this.group.animate(o, this.options.animation), this.animate = null))
                },
                remove: function() {
                    var e = this,
                        t = e.chart;
                    t.hasRendered && Ye(t.series, function(t) {
                        t.type === e.type && (t.isDirty = !0)
                    }), Bt.prototype.remove.apply(e, arguments)
                }
            }), Fe.column = wt, ot.bar = e(ot.column), xt = p(wt, {
                type: "bar",
                inverted: !0
            }), Fe.bar = xt, ot.scatter = e(Ue, {
                lineWidth: 0,
                marker: {
                    enabled: !0
                },
                tooltip: {
                    headerFormat: '<span style="color:{series.color}">●</span> <span style="font-size: 10px;"> {series.name}</span><br/>',
                    pointFormat: "x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"
                }
            }), xt = p(Bt, {
                type: "scatter",
                sorted: !1,
                requireSorting: !1,
                noSharedTooltip: !0,
                trackerGroups: ["group", "markerGroup", "dataLabelsGroup"],
                takeOrdinalPosition: !1,
                kdDimensions: 2,
                kdComparer: "distR",
                drawGraph: function() {
                    this.options.lineWidth && Bt.prototype.drawGraph.call(this)
                }
            }), Fe.scatter = xt, ot.pie = e(Ue, {
                borderColor: "#FFFFFF",
                borderWidth: 1,
                center: [null, null],
                clip: !1,
                colorByPoint: !0,
                dataLabels: {
                    distance: 30,
                    enabled: !0,
                    formatter: function() {
                        return this.point.name
                    },
                    x: 0
                },
                ignoreHiddenPoint: !0,
                legendType: "point",
                marker: null,
                size: null,
                showInLegend: !1,
                slicedOffset: 10,
                states: {
                    hover: {
                        brightness: .1,
                        shadow: !1
                    }
                },
                stickyTracking: !1,
                tooltip: {
                    followPointer: !0
                }
            }), Ue = {
                type: "pie",
                isCartesian: !1,
                pointClass: p(kt, {
                    init: function() {
                        kt.prototype.init.apply(this, arguments);
                        var e, t = this;
                        return Ve(t, {
                            visible: t.visible !== !1,
                            name: ze(t.name, "Slice")
                        }), e = function(e) {
                            t.slice("select" === e.type)
                        }, Ke(t, "select", e), Ke(t, "unselect", e), t
                    },
                    setVisible: function(e, t) {
                        var i = this,
                            n = i.series,
                            o = n.chart,
                            s = !n.isDirty && n.options.ignoreHiddenPoint;
                        (e !== i.visible || t) && (i.visible = i.options.visible = e = e === T ? !i.visible : e, n.options.data[Je(i, n.data)] = i.options, Ye(["graphic", "dataLabel", "connector", "shadowGroup"], function(t) {
                            i[t] && i[t][e ? "show" : "hide"](!0)
                        }), i.legendItem && (o.hasRendered && (n.updateTotals(), o.legend.clearItems(), s || o.legend.render()), o.legend.colorizeItem(i, e)), s && (n.isDirty = !0, o.redraw()))
                    },
                    slice: function(e, t, i) {
                        var n = this.series;
                        N(i, n.chart), ze(t, !0), this.sliced = this.options.sliced = e = c(e) ? e : !this.sliced, n.options.data[Je(this, n.data)] = this.options, e = e ? this.slicedTranslation : {
                            translateX: 0,
                            translateY: 0
                        }, this.graphic.animate(e), this.shadowGroup && this.shadowGroup.animate(e)
                    },
                    haloPath: function(e) {
                        var t = this.shapeArgs,
                            i = this.series.chart;
                        return this.sliced || !this.visible ? [] : this.series.chart.renderer.symbols.arc(i.plotLeft + t.x, i.plotTop + t.y, t.r + e, t.r + e, {
                            innerR: this.shapeArgs.r,
                            start: t.start,
                            end: t.end
                        })
                    }
                }),
                requireSorting: !1,
                noSharedTooltip: !0,
                trackerGroups: ["group", "dataLabelsGroup"],
                axisTypes: [],
                pointAttrToOptions: {
                    stroke: "borderColor",
                    "stroke-width": "borderWidth",
                    fill: "color"
                },
                getColor: Ce,
                animate: function(e) {
                    var t = this,
                        i = t.points,
                        n = t.startAngleRad;
                    e || (Ye(i, function(e) {
                        var i = e.graphic,
                            o = e.shapeArgs;
                        i && (i.attr({
                            r: e.startR || t.center[3] / 2,
                            start: n,
                            end: n
                        }), i.animate({
                            r: o.r,
                            start: o.start,
                            end: o.end
                        }, t.options.animation))
                    }), t.animate = null)
                },
                setData: function(e, t, i, n) {
                    Bt.prototype.setData.call(this, e, !1, i, n), this.processData(), this.generatePoints(), ze(t, !0) && this.chart.redraw(i)
                },
                updateTotals: function() {
                    var e, t, i, n, o = 0,
                        s = this.options.ignoreHiddenPoint;
                    for (t = this.points, i = t.length, e = 0; i > e; e++) n = t[e], n.y < 0 && (n.y = null), o += s && !n.visible ? 0 : n.y;
                    for (this.total = o, e = 0; i > e; e++) n = t[e], n.percentage = o > 0 && (n.visible || !s) ? n.y / o * 100 : 0, n.total = o
                },
                generatePoints: function() {
                    Bt.prototype.generatePoints.call(this), this.updateTotals()
                },
                translate: function(e) {
                    this.generatePoints();
                    var t, i, n, o, s, r = 0,
                        a = this.options,
                        l = a.slicedOffset,
                        c = l + a.borderWidth,
                        d = a.startAngle || 0,
                        u = this.startAngleRad = ge / 180 * (d - 90),
                        d = (this.endAngleRad = ge / 180 * (ze(a.endAngle, d + 360) - 90)) - u,
                        h = this.points,
                        m = a.dataLabels.distance,
                        a = a.ignoreHiddenPoint,
                        p = h.length;
                    for (e || (this.center = e = this.getCenter()), this.getX = function(t, i) {
                            return n = ae.asin(he((t - e[1]) / (e[2] / 2 + m), 1)), e[0] + (i ? -1 : 1) * pe(n) * (e[2] / 2 + m)
                        }, o = 0; p > o; o++) s = h[o], t = u + r * d, (!a || s.visible) && (r += s.percentage / 100), i = u + r * d, s.shapeType = "arc", s.shapeArgs = {
                        x: e[0],
                        y: e[1],
                        r: e[2] / 2,
                        innerR: e[3] / 2,
                        start: le(1e3 * t) / 1e3,
                        end: le(1e3 * i) / 1e3
                    }, n = (i + t) / 2, n > 1.5 * ge ? n -= 2 * ge : -ge / 2 > n && (n += 2 * ge), s.slicedTranslation = {
                        translateX: le(pe(n) * l),
                        translateY: le(fe(n) * l)
                    }, t = pe(n) * e[2] / 2, i = fe(n) * e[2] / 2, s.tooltipPos = [e[0] + .7 * t, e[1] + .7 * i], s.half = -ge / 2 > n || n > ge / 2 ? 1 : 0, s.angle = n, c = he(c, m / 2), s.labelPos = [e[0] + t + pe(n) * m, e[1] + i + fe(n) * m, e[0] + t + pe(n) * c, e[1] + i + fe(n) * c, e[0] + t, e[1] + i, 0 > m ? "center" : s.half ? "right" : "left", n]
                },
                drawGraph: null,
                drawPoints: function() {
                    var e, t, i, n, o = this,
                        s = o.chart.renderer,
                        r = o.options.shadow;
                    r && !o.shadowGroup && (o.shadowGroup = s.g("shadow").add(o.group)), Ye(o.points, function(a) {
                        var l = a.options.visible;
                        t = a.graphic, n = a.shapeArgs, i = a.shadowGroup, r && !i && (i = a.shadowGroup = s.g("shadow").add(o.shadowGroup)), e = a.sliced ? a.slicedTranslation : {
                            translateX: 0,
                            translateY: 0
                        }, i && i.attr(e), t ? t.animate(Ve(n, e)) : a.graphic = t = s[a.shapeType](n).setRadialReference(o.center).attr(a.pointAttr[a.selected ? "select" : ""]).attr({
                            "stroke-linejoin": "round"
                        }).attr(e).add(o.group).shadow(r, i), void 0 !== l && a.setVisible(l, !0)
                    })
                },
                searchPoint: Ce,
                sortByAngle: function(e, t) {
                    e.sort(function(e, i) {
                        return void 0 !== e.angle && (i.angle - e.angle) * t
                    })
                },
                drawLegendSymbol: dt.drawRectangle,
                getCenter: Mt.getCenter,
                getSymbol: Ce
            }, Ue = p(Bt, Ue), Fe.pie = Ue, Bt.prototype.drawDataLabels = function() {
                var t, i, n, o, s = this,
                    r = s.options,
                    a = r.cursor,
                    l = r.dataLabels,
                    d = s.points,
                    u = s.hasRendered || 0,
                    h = s.chart.renderer;
                (l.enabled || s._hasPointLabels) && (s.dlProcessOptions && s.dlProcessOptions(l), o = s.plotGroup("dataLabelsGroup", "data-labels", l.defer ? "hidden" : "visible", l.zIndex || 6), ze(l.defer, !0) && (o.attr({
                    opacity: +u
                }), u || Ke(s, "afterAnimate", function() {
                    s.visible && o.show(), o[r.animation ? "animate" : "attr"]({
                        opacity: 1
                    }, {
                        duration: 200
                    })
                })), i = l, Ye(d, function(d) {
                    var u, m, p, f, g = d.dataLabel,
                        b = d.connector,
                        y = !0,
                        v = {};
                    if (t = d.dlOptions || d.options && d.options.dataLabels, u = ze(t && t.enabled, i.enabled), g && !u) d.dataLabel = g.destroy();
                    else if (u) {
                        if (l = e(i, t), f = l.style, u = l.rotation, m = d.getLabelConfig(), n = l.format ? _(l.format, m) : l.formatter.call(m, l), f.color = ze(l.color, f.color, s.color, "black"), g) c(n) ? (g.attr({
                            text: n
                        }), y = !1) : (d.dataLabel = g = g.destroy(), b && (d.connector = b.destroy()));
                        else if (c(n)) {
                            g = {
                                fill: l.backgroundColor,
                                stroke: l.borderColor,
                                "stroke-width": l.borderWidth,
                                r: l.borderRadius || 0,
                                rotation: u,
                                padding: l.padding,
                                zIndex: 1
                            }, "contrast" === f.color && (v.color = l.inside || l.distance < 0 || r.stacking ? h.getContrast(d.color || s.color) : "#000000"), a && (v.cursor = a);
                            for (p in g) g[p] === T && delete g[p];
                            g = d.dataLabel = h[u ? "text" : "label"](n, 0, -999, l.shape, null, null, l.useHTML).attr(g).css(Ve(f, v)).add(o).shadow(l.shadow)
                        }
                        g && s.alignDataLabel(d, g, l, null, y)
                    }
                }))
            }, Bt.prototype.alignDataLabel = function(e, t, i, n, o) {
                var s = this.chart,
                    r = s.inverted,
                    a = ze(e.plotX, -999),
                    l = ze(e.plotY, -999),
                    c = t.getBBox(),
                    d = s.renderer.fontMetrics(i.style.fontSize).b,
                    u = this.visible && (e.series.forceDL || s.isInsidePlot(a, le(l), r) || n && s.isInsidePlot(a, r ? n.x + 1 : n.y + n.height - 1, r));
                u && (n = Ve({
                    x: r ? s.plotWidth - l : a,
                    y: le(r ? s.plotHeight - a : l),
                    width: 0,
                    height: 0
                }, n), Ve(i, {
                    width: c.width,
                    height: c.height
                }), i.rotation ? (e = s.renderer.rotCorr(d, i.rotation), t[o ? "attr" : "animate"]({
                    x: n.x + i.x + n.width / 2 + e.x,
                    y: n.y + i.y + n.height / 2
                }).attr({
                    align: i.align
                })) : (t.align(i, null, n), r = t.alignAttr, "justify" === ze(i.overflow, "justify") ? this.justifyDataLabel(t, i, r, c, n, o) : ze(i.crop, !0) && (u = s.isInsidePlot(r.x, r.y) && s.isInsidePlot(r.x + c.width, r.y + c.height)), i.shape && t.attr({
                    anchorX: e.plotX,
                    anchorY: e.plotY
                }))), u || (t.attr({
                    y: -999
                }), t.placed = !1)
            }, Bt.prototype.justifyDataLabel = function(e, t, i, n, o, s) {
                var r, a, l = this.chart,
                    c = t.align,
                    d = t.verticalAlign,
                    u = e.box ? 0 : e.padding || 0;
                r = i.x + u, 0 > r && ("right" === c ? t.align = "left" : t.x = -r, a = !0), r = i.x + n.width - u, r > l.plotWidth && ("left" === c ? t.align = "right" : t.x = l.plotWidth - r, a = !0), r = i.y + u, 0 > r && ("bottom" === d ? t.verticalAlign = "top" : t.y = -r, a = !0), r = i.y + n.height - u, r > l.plotHeight && ("top" === d ? t.verticalAlign = "bottom" : t.y = l.plotHeight - r, a = !0), a && (e.placed = !s, e.align(t, null, o))
            }, Fe.pie && (Fe.pie.prototype.drawDataLabels = function() {
                var e, t, i, n, o, s, r, a, l, c, d, u = this,
                    h = u.data,
                    m = u.chart,
                    p = u.options.dataLabels,
                    f = ze(p.connectorPadding, 10),
                    g = ze(p.connectorWidth, 1),
                    _ = m.plotWidth,
                    b = m.plotHeight,
                    y = ze(p.softConnector, !0),
                    v = p.distance,
                    M = u.center,
                    B = M[2] / 2,
                    w = M[1],
                    x = v > 0,
                    E = [
                        [],
                        []
                    ],
                    N = [0, 0, 0, 0],
                    I = function(e, t) {
                        return t.y - e.y
                    };
                if (u.visible && (p.enabled || u._hasPointLabels)) {
                    for (Bt.prototype.drawDataLabels.apply(u), Ye(h, function(e) {
                            e.dataLabel && e.visible && E[e.half].push(e)
                        }), c = 2; c--;) {
                        var S, D = [],
                            C = [],
                            T = E[c],
                            O = T.length;
                        if (O) {
                            for (u.sortByAngle(T, c - .5), d = h = 0; !h && T[d];) h = T[d] && T[d].dataLabel && (T[d].dataLabel.getBBox().height || 21), d++;
                            if (v > 0) {
                                for (o = he(w + B + v, m.plotHeight), d = ue(0, w - B - v); o >= d; d += h) D.push(d);
                                if (o = D.length, O > o) {
                                    for (e = [].concat(T), e.sort(I), d = O; d--;) e[d].rank = d;
                                    for (d = O; d--;) T[d].rank >= o && T.splice(d, 1);
                                    O = T.length
                                }
                                for (d = 0; O > d; d++) {
                                    e = T[d], s = e.labelPos, e = 9999;
                                    var P, A;
                                    for (A = 0; o > A; A++) P = me(D[A] - s[1]), e > P && (e = P, S = A);
                                    if (d > S && null !== D[d]) S = d;
                                    else
                                        for (O - d + S > o && null !== D[d] && (S = o - O + d); null === D[S];) S++;
                                    C.push({
                                        i: S,
                                        y: D[S]
                                    }), D[S] = null
                                }
                                C.sort(I)
                            }
                            for (d = 0; O > d; d++) e = T[d], s = e.labelPos, n = e.dataLabel, l = e.visible === !1 ? "hidden" : "inherit", e = s[1], v > 0 ? (o = C.pop(), S = o.i, a = o.y, (e > a && null !== D[S + 1] || a > e && null !== D[S - 1]) && (a = he(ue(0, e), m.plotHeight))) : a = e, r = p.justify ? M[0] + (c ? -1 : 1) * (B + v) : u.getX(a === w - B - v || a === w + B + v ? e : a, c), n._attr = {
                                visibility: l,
                                align: s[6]
                            }, n._pos = {
                                x: r + p.x + ({
                                    left: f,
                                    right: -f
                                }[s[6]] || 0),
                                y: a + p.y - 10
                            }, n.connX = r, n.connY = a, null === this.options.size && (o = n.width, f > r - o ? N[3] = ue(le(o - r + f), N[3]) : r + o > _ - f && (N[1] = ue(le(r + o - _ + f), N[1])), 0 > a - h / 2 ? N[0] = ue(le(-a + h / 2), N[0]) : a + h / 2 > b && (N[2] = ue(le(a + h / 2 - b), N[2])))
                        }
                    }(0 === k(N) || this.verifyDataLabelOverflow(N)) && (this.placeDataLabels(), x && g && Ye(this.points, function(e) {
                        t = e.connector, s = e.labelPos, (n = e.dataLabel) && n._pos ? (l = n._attr.visibility, r = n.connX, a = n.connY, i = y ? ["M", r + ("left" === s[6] ? 5 : -5), a, "C", r, a, 2 * s[2] - s[4], 2 * s[3] - s[5], s[2], s[3], "L", s[4], s[5]] : ["M", r + ("left" === s[6] ? 5 : -5), a, "L", s[2], s[3], "L", s[4], s[5]], t ? (t.animate({
                            d: i
                        }), t.attr("visibility", l)) : e.connector = t = u.chart.renderer.path(i).attr({
                            "stroke-width": g,
                            stroke: p.connectorColor || e.color || "#606060",
                            visibility: l
                        }).add(u.dataLabelsGroup)) : t && (e.connector = t.destroy())
                    }))
                }
            }, Fe.pie.prototype.placeDataLabels = function() {
                Ye(this.points, function(e) {
                    var t, e = e.dataLabel;
                    e && ((t = e._pos) ? (e.attr(e._attr), e[e.moved ? "animate" : "attr"](t), e.moved = !0) : e && e.attr({
                        y: -999
                    }))
                })
            }, Fe.pie.prototype.alignDataLabel = Ce, Fe.pie.prototype.verifyDataLabelOverflow = function(e) {
                var t, i = this.center,
                    n = this.options,
                    o = n.center,
                    s = n = n.minSize || 80;
                return null !== o[0] ? s = ue(i[2] - ue(e[1], e[3]), n) : (s = ue(i[2] - e[1] - e[3], n), i[0] += (e[3] - e[1]) / 2), null !== o[1] ? s = ue(he(s, i[2] - ue(e[0], e[2])), n) : (s = ue(he(s, i[2] - e[0] - e[2]), n), i[1] += (e[0] - e[2]) / 2), s < i[2] ? (i[2] = s, this.translate(i), Ye(this.points, function(e) {
                    e.dataLabel && (e.dataLabel._pos = null)
                }), this.drawDataLabels && this.drawDataLabels()) : t = !0, t
            }), Fe.column && (Fe.column.prototype.alignDataLabel = function(t, i, n, o, s) {
                var r = this.chart.inverted,
                    a = t.series,
                    l = t.dlBox || t.shapeArgs,
                    c = t.below || t.plotY > ze(this.translatedThreshold, a.yAxis.len),
                    d = ze(n.inside, !!this.options.stacking);
                l && (o = e(l), r && (o = {
                    x: a.yAxis.len - o.y - o.height,
                    y: a.xAxis.len - o.x - o.width,
                    width: o.height,
                    height: o.width
                }), !d) && (r ? (o.x += c ? 0 : o.width, o.width = 0) : (o.y += c ? o.height : 0, o.height = 0)), n.align = ze(n.align, !r || d ? "center" : c ? "right" : "left"), n.verticalAlign = ze(n.verticalAlign, r || d ? "middle" : c ? "top" : "bottom"), Bt.prototype.alignDataLabel.call(this, t, i, n, o, s)
            }),
            function(e) {
                var t = e.Chart,
                    i = e.each,
                    n = HighchartsAdapter.addEvent;
                t.prototype.callbacks.push(function(e) {
                    function t() {
                        var t = [];
                        i(e.series, function(e) {
                            var n = e.options.dataLabels;
                            (n.enabled || e._hasPointLabels) && !n.allowOverlap && e.visible && i(e.points, function(e) {
                                e.dataLabel && (e.dataLabel.labelrank = e.labelrank, t.push(e.dataLabel))
                            })
                        }), e.hideOverlappingLabels(t)
                    }
                    t(), n(e, "redraw", t)
                }), t.prototype.hideOverlappingLabels = function(e) {
                    var t, i, n, o, s = e.length;
                    for (i = 0; s > i; i++)(t = e[i]) && (t.oldOpacity = t.opacity, t.newOpacity = 1);
                    for (i = 0; s > i; i++)
                        for (n = e[i], t = i + 1; s > t; ++t) o = e[t], n && o && n.placed && o.placed && 0 !== n.newOpacity && 0 !== o.newOpacity && !(o.alignAttr.x > n.alignAttr.x + n.width || o.alignAttr.x + o.width < n.alignAttr.x || o.alignAttr.y > n.alignAttr.y + n.height || o.alignAttr.y + o.height < n.alignAttr.y) && ((n.labelrank < o.labelrank ? n : o).newOpacity = 0);
                    for (i = 0; s > i; i++)(t = e[i]) && (t.oldOpacity !== t.newOpacity && t.placed && (t.alignAttr.opacity = t.newOpacity, t[t.isOld && t.newOpacity ? "animate" : "attr"](t.alignAttr)), t.isOld = !0)
                }
            }(oe), Ue = oe.TrackerMixin = {
                drawTrackerPoint: function() {
                    var e = this,
                        t = e.chart,
                        i = t.pointer,
                        n = e.options.cursor,
                        o = n && {
                            cursor: n
                        },
                        s = function(e) {
                            for (var i, n = e.target; n && !i;) i = n.point, n = n.parentNode;
                            i !== T && i !== t.hoverPoint && i.onMouseOver(e)
                        };
                    Ye(e.points, function(e) {
                        e.graphic && (e.graphic.element.point = e), e.dataLabel && (e.dataLabel.element.point = e)
                    }), e._hasTracking || (Ye(e.trackerGroups, function(t) {
                        e[t] && (e[t].addClass("highcharts-tracker").on("mouseover", s).on("mouseout", function(e) {
                            i.onTrackerMouseOut(e)
                        }).css(o), P) && e[t].on("touchstart", s)
                    }), e._hasTracking = !0)
                },
                drawTrackerGraph: function() {
                    var e, t = this,
                        i = t.options,
                        n = i.trackByArea,
                        o = [].concat(n ? t.areaPath : t.graphPath),
                        s = o.length,
                        r = t.chart,
                        a = r.pointer,
                        l = r.renderer,
                        c = r.options.tooltip.snap,
                        d = t.tracker,
                        u = i.cursor,
                        h = u && {
                            cursor: u
                        },
                        u = t.singlePoints,
                        m = function() {
                            r.hoverSeries !== t && t.onMouseOver()
                        },
                        p = "rgba(192,192,192," + (Ee ? 1e-4 : .002) + ")";
                    if (s && !n)
                        for (e = s + 1; e--;) "M" === o[e] && o.splice(e + 1, 0, o[e + 1] - c, o[e + 2], "L"), (e && "M" === o[e] || e === s) && o.splice(e, 0, "L", o[e - 2] + c, o[e - 1]);
                    for (e = 0; e < u.length; e++) s = u[e], o.push("M", s.plotX - c, s.plotY, "L", s.plotX + c, s.plotY);
                    d ? d.attr({
                        d: o
                    }) : (t.tracker = l.path(o).attr({
                        "stroke-linejoin": "round",
                        visibility: t.visible ? "visible" : "hidden",
                        stroke: p,
                        fill: n ? p : Ae,
                        "stroke-width": i.lineWidth + (n ? 0 : 2 * c),
                        zIndex: 2
                    }).add(t.group), Ye([t.tracker, t.markerGroup], function(e) {
                        e.addClass("highcharts-tracker").on("mouseover", m).on("mouseout", function(e) {
                            a.onTrackerMouseOut(e)
                        }).css(h), P && e.on("touchstart", m)
                    }))
                }
            }, Fe.column && (wt.prototype.drawTracker = Ue.drawTrackerPoint), Fe.pie && (Fe.pie.prototype.drawTracker = Ue.drawTrackerPoint), Fe.scatter && (xt.prototype.drawTracker = Ue.drawTrackerPoint), Ve(vt.prototype, {
                setItemEvents: function(e, t, i, n, o) {
                    var s = this;
                    (i ? t : e.legendGroup).on("mouseover", function() {
                        e.setState("hover"), t.css(s.options.itemHoverStyle)
                    }).on("mouseout", function() {
                        t.css(e.visible ? n : o), e.setState()
                    }).on("click", function(t) {
                        var i = function() {
                                e.setVisible()
                            },
                            t = {
                                browserEvent: t
                            };
                        e.firePointEvent ? e.firePointEvent("legendItemClick", t, i) : et(e, "legendItemClick", t, i)
                    })
                },
                createCheckboxForItem: function(e) {
                    e.checkbox = m("input", {
                        type: "checkbox",
                        checked: e.selected,
                        defaultChecked: e.selected
                    }, this.options.itemCheckboxStyle, this.chart.container), Ke(e.checkbox, "click", function(t) {
                        et(e.series || e, "checkboxClick", {
                            checked: t.target.checked,
                            item: e
                        }, function() {
                            e.select()
                        })
                    })
                }
            }), L.legend.itemStyle.cursor = "pointer", Ve(Ge.prototype, {
                showResetZoom: function() {
                    var e = this,
                        t = L.lang,
                        i = e.options.chart.resetZoomButton,
                        n = i.theme,
                        o = n.states,
                        s = "chart" === i.relativeTo ? null : "plotBox";
                    this.resetZoomButton = e.renderer.button(t.resetZoom, null, null, function() {
                        e.zoomOut()
                    }, n, o && o.hover).attr({
                        align: i.position.align,
                        title: t.resetZoomTitle
                    }).add().align(i.position, !1, s)
                },
                zoomOut: function() {
                    var e = this;
                    et(e, "selection", {
                        resetSelection: !0
                    }, function() {
                        e.zoom()
                    })
                },
                zoom: function(e) {
                    var t, i, o = this.pointer,
                        s = !1;
                    !e || e.resetSelection ? Ye(this.axes, function(e) {
                        t = e.zoom()
                    }) : Ye(e.xAxis.concat(e.yAxis), function(e) {
                        var i = e.axis,
                            n = i.isXAxis;
                        (o[n ? "zoomX" : "zoomY"] || o[n ? "pinchX" : "pinchY"]) && (t = i.zoom(e.min, e.max), i.displayBtn && (s = !0))
                    }), i = this.resetZoomButton, s && !i ? this.showResetZoom() : !s && n(i) && (this.resetZoomButton = i.destroy()), t && this.redraw(ze(this.options.chart.animation, e && e.animation, this.pointCount < 100))
                },
                pan: function(e, t) {
                    var i, n = this,
                        o = n.hoverPoints;
                    o && Ye(o, function(e) {
                        e.setState()
                    }), Ye("xy" === t ? [1, 0] : [1], function(t) {
                        var o = e[t ? "chartX" : "chartY"],
                            s = n[t ? "xAxis" : "yAxis"][0],
                            r = n[t ? "mouseDownX" : "mouseDownY"],
                            a = (s.pointRange || 0) / 2,
                            l = s.getExtremes(),
                            c = s.toValue(r - o, !0) + a,
                            a = s.toValue(r + n[t ? "plotWidth" : "plotHeight"] - o, !0) - a,
                            r = r > o;
                        s.series.length && (r || c > he(l.dataMin, l.min)) && (!r || a < ue(l.dataMax, l.max)) && (s.setExtremes(c, a, !1, !1, {
                            trigger: "pan"
                        }), i = !0), n[t ? "mouseDownX" : "mouseDownY"] = o
                    }), i && n.redraw(!1), h(n.container, {
                        cursor: "move"
                    })
                }
            }), Ve(kt.prototype, {
                select: function(e, t) {
                    var i = this,
                        n = i.series,
                        o = n.chart,
                        e = ze(e, !i.selected);
                    i.firePointEvent(e ? "select" : "unselect", {
                        accumulate: t
                    }, function() {
                        i.selected = i.options.selected = e, n.options.data[Je(i, n.data)] = i.options, i.setState(e && "select"), t || Ye(o.getSelectedPoints(), function(e) {
                            e.selected && e !== i && (e.selected = e.options.selected = !1, n.options.data[Je(e, n.data)] = e.options, e.setState(""), e.firePointEvent("unselect"))
                        })
                    })
                },
                onMouseOver: function(e) {
                    var t = this.series,
                        i = t.chart,
                        n = i.tooltip,
                        o = i.hoverPoint;
                    i.hoverSeries !== t && t.onMouseOver(), o && o !== this && o.onMouseOut(), this.firePointEvent("mouseOver"), n && (!n.shared || t.noSharedTooltip) && n.refresh(this, e), this.setState("hover"), i.hoverPoint = this
                },
                onMouseOut: function() {
                    var e = this.series.chart,
                        t = e.hoverPoints;
                    this.firePointEvent("mouseOut"), t && -1 !== Je(this, t) || (this.setState(), e.hoverPoint = null)
                },
                importEvents: function() {
                    if (!this.hasImportedEvents) {
                        var t, i = e(this.series.options.point, this.options).events;
                        this.events = i;
                        for (t in i) Ke(this, t, i[t]);
                        this.hasImportedEvents = !0
                    }
                },
                setState: function(t, i) {
                    var n, o = this.plotX,
                        s = this.plotY,
                        r = this.series,
                        a = r.options.states,
                        l = ot[r.type].marker && r.options.marker,
                        c = l && !l.enabled,
                        d = l && l.states[t],
                        u = d && d.enabled === !1,
                        h = r.stateMarkerGraphic,
                        m = this.marker || {},
                        p = r.chart,
                        f = r.halo,
                        t = t || "";
                    n = this.pointAttr[t] || r.pointAttr[t], t === this.state && !i || this.selected && "select" !== t || a[t] && a[t].enabled === !1 || t && (u || c && d.enabled === !1) || t && m.states && m.states[t] && m.states[t].enabled === !1 || (this.graphic ? (l = l && this.graphic.symbolName && n.r, this.graphic.attr(e(n, l ? {
                        x: o - l,
                        y: s - l,
                        width: 2 * l,
                        height: 2 * l
                    } : {})), h && h.hide()) : (t && d && (l = d.radius, m = m.symbol || r.symbol, h && h.currentSymbol !== m && (h = h.destroy()), h ? h[i ? "animate" : "attr"]({
                        x: o - l,
                        y: s - l
                    }) : m && (r.stateMarkerGraphic = h = p.renderer.symbol(m, o - l, s - l, 2 * l, 2 * l).attr(n).add(r.markerGroup), h.currentSymbol = m)), h && h[t && p.isInsidePlot(o, s, p.inverted) ? "show" : "hide"]()), (o = a[t] && a[t].halo) && o.size ? (f || (r.halo = f = p.renderer.path().add(p.seriesGroup)), f.attr(Ve({
                        fill: lt(this.color || r.color).setOpacity(o.opacity).get()
                    }, o.attributes))[i ? "animate" : "attr"]({
                        d: this.haloPath(o.size)
                    })) : f && f.attr({
                        d: []
                    }), this.state = t)
                },
                haloPath: function(e) {
                    var t = this.series,
                        i = t.chart,
                        n = t.getPlotBox(),
                        o = i.inverted;
                    return i.renderer.symbols.circle(n.translateX + (o ? t.yAxis.len - this.plotY : this.plotX) - e, n.translateY + (o ? t.xAxis.len - this.plotX : this.plotY) - e, 2 * e, 2 * e)
                }
            }), Ve(Bt.prototype, {
                onMouseOver: function() {
                    var e = this.chart,
                        t = e.hoverSeries;
                    t && t !== this && t.onMouseOut(), this.options.events.mouseOver && et(this, "mouseOver"), this.setState("hover"), e.hoverSeries = this
                },
                onMouseOut: function() {
                    var e = this.options,
                        t = this.chart,
                        i = t.tooltip,
                        n = t.hoverPoint;
                    n && n.onMouseOut(), this && e.events.mouseOut && et(this, "mouseOut"), i && !e.stickyTracking && (!i.shared || this.noSharedTooltip) && i.hide(), this.setState(), t.hoverSeries = null
                },
                setState: function(e) {
                    var t = this.options,
                        i = this.graph,
                        n = t.states,
                        o = t.lineWidth,
                        t = 0,
                        e = e || "";
                    if (this.state !== e && (this.state = e, !(n[e] && n[e].enabled === !1) && (e && (o = n[e].lineWidth || o + (n[e].lineWidthPlus || 0)), i && !i.dashstyle)))
                        for (e = {
                                "stroke-width": o
                            }, i.attr(e); this["zoneGraph" + t];) this["zoneGraph" + t].attr(e), t += 1
                },
                setVisible: function(e, t) {
                    var i, n = this,
                        o = n.chart,
                        s = n.legendItem,
                        r = o.options.chart.ignoreHiddenSeries,
                        a = n.visible;
                    i = (n.visible = e = n.userOptions.visible = e === T ? !a : e) ? "show" : "hide", Ye(["group", "dataLabelsGroup", "markerGroup", "tracker"], function(e) {
                        n[e] && n[e][i]()
                    }), (o.hoverSeries === n || (o.hoverPoint && o.hoverPoint.series) === n) && n.onMouseOut(), s && o.legend.colorizeItem(n, e), n.isDirty = !0, n.options.stacking && Ye(o.series, function(e) {
                        e.options.stacking && e.visible && (e.isDirty = !0)
                    }), Ye(n.linkedSeries, function(t) {
                        t.setVisible(e, !1)
                    }), r && (o.isDirtyBox = !0), t !== !1 && o.redraw(), et(n, i)
                },
                show: function() {
                    this.setVisible(!0)
                },
                hide: function() {
                    this.setVisible(!1)
                },
                select: function(e) {
                    this.selected = e = e === T ? !this.selected : e, this.checkbox && (this.checkbox.checked = e), et(this, e ? "select" : "unselect")
                },
                drawTracker: Ue.drawTrackerGraph
            }), Ve(oe, {
                Color: lt,
                Point: kt,
                Tick: D,
                Renderer: O,
                SVGElement: S,
                SVGRenderer: ct,
                arrayMin: M,
                arrayMax: k,
                charts: Te,
                dateFormat: R,
                error: x,
                format: _,
                pathAnim: F,
                getOptions: function() {
                    return L
                },
                hasBidiBug: Ne,
                isTouchDevice: we,
                setOptions: function(t) {
                    return L = e(!0, L, t), I(), L
                },
                addEvent: Ke,
                removeEvent: Ze,
                createElement: m,
                discardElement: w,
                css: h,
                each: Ye,
                map: Xe,
                merge: e,
                splat: u,
                extendClass: p,
                pInt: t,
                svg: Ee,
                canvas: Ie,
                vml: !Ee && !Ie,
                product: "Highcharts",
                version: "4.1.5"
            })
    }(),
    function() {
        "use strict";

        function e(e) {
            var t = Highcharts.getOptions().colors;
            i(n, function(i, n) {
                e.addPattern("highcharts-default-pattern-" + n, {
                    path: i,
                    color: t[n]
                })
            })
        }
        var t = 0,
            i = (Highcharts.wrap, Highcharts.each),
            n = ["M 0 0 L 10 10 M 9 -1 L 11 1 M -1 9 L 1 11", "M 0 10 L 10 0 M -1 1 L 1 -1 M 9 11 L 11 9", "M 3 0 L 3 10 M 8 0 L 8 10", "M 0 3 L 10 3 M 0 8 L 10 8", "M 0 3 L 5 3 L 5 0 M 5 10 L 5 7 L 10 7", "M 3 3 L 8 3 L 8 8 L 3 8 Z", "M 5 5 m -4 0 a 4 4 0 1 1 8 0 a 4 4 0 1 1 -8 0", "M 10 3 L 5 3 L 5 0 M 5 10 L 5 7 L 0 7", "M 2 5 L 5 2 L 8 5 L 5 8 Z", "M 0 0 L 5 10 L 10 0"];
        Highcharts.SVGRenderer.prototype.addPattern = function(e, i) {
            var e = e || "highcharts-pattern-" + t++,
                n = this.createElement("pattern").attr({
                    id: e,
                    patternUnits: "userSpaceOnUse",
                    width: i.width || 10,
                    height: i.height || 10
                }).add(this.defs);
            if (n.id = n.element.id, i.path) {
                var o = i.path;
                this.createElement("path").attr({
                    d: o.d || o,
                    stroke: o.stroke || "#343434",
                    "stroke-width": o.strokeWidth || 2,
                    fill: o.fill || "transparent"
                }).add(n), n.color = i.color
            } else if (i.image) this.image(i.image, 0, 0, i.width, i.height).add(n);
            else if (i.color) {
                var s = i.width || 10,
                    r = i.height || 10;
                this.createElement("path").attr({
                    d: "M 0 0 L 0 " + r + " L " + s + " " + r + " L " + s + " 0 Z",
                    fill: i.color,
                    "stroke-width": 0
                }).add(n)
            }
            return n
        }, Highcharts.VMLElement && (Highcharts.VMLRenderer.prototype.addPattern = function(e, i) {
            var e = e || "highcharts-pattern-" + t++,
                n = this.patterns || {};
            n[e] = i, this.patterns = n
        }, Highcharts.wrap(Highcharts.VMLRenderer.prototype.Element.prototype, "fillSetter", function(e, t, i, n) {
            if ("string" == typeof t && "url(#" === t.substring(0, 5)) {
                var o, s = t.substring(5, t.length - 1),
                    r = this.renderer.patterns[s];
                r.image ? (n.getElementsByTagName("fill").length && n.removeChild(n.getElementsByTagName("fill")[0]), o = this.renderer.prepVML(["<", i, ' type="tile" src="', r.image, '" />']), console.log(o), n.appendChild(document.createElement(o)), 1 === n.parentNode.nodeType && (n.outerHTML = n.outerHTML)) : r.color ? e.call(this, r.color, i, n) : e.call(this, "#A0A0A0", i, n)
            } else e.call(this, t, i, n)
        })), Highcharts.wrap(Highcharts.Chart.prototype, "getContainer", function(t) {
            t.apply(this);
            var n = this,
                o = n.renderer,
                s = n.options,
                r = (s.colors, s.defs && s.defs.patterns);
            e(o), r && i(r, function(e) {
                o.addPattern(e.id || void 0, {
                    path: e.path,
                    image: e.image,
                    color: e.color,
                    width: e.width,
                    height: e.height
                })
            })
        })
    }(),
    function(e) {
        var t, i = {};
        t = function(e, t) {
            return t.replace(/<tspan([^>]*?)>/g, function(t, n, o) {
                var s = e + "-" + o;
                return n.length && (i[s] = $.trim(n).match(/(\S+)="([^"]+)"/g).reduce(function(e, t) {
                    var i = t.split("=");
                    return e[i[0]] = i[1].substr(1, i[1].length - 2), e
                }, {}), t = t.replace(n, ' style="font-family:' + s + '"')), t = "<" + t.substring(2)
            }).replace(/<\/tspan>/g, "</span>")
        }, e.wrap(e.SVGRenderer.prototype, "buildText", function(e, n) {
            var o = n.element,
                s = $.identify(o);
            n.textStr = t(s, n.textStr), e.call(this, n), Array.prototype.forEach.call(o.getElementsByTagName("tspan"), function(e) {
                var t = e.style.fontFamily;
                0 === t.indexOf(s) && $(e).removeAttr("style").attr(i[t])
            })
        })
    }(Highcharts),
    function() {
        function e(e) {
            e.value = BEM.blocks.humanize.format(e.column.dataType, e.value, e.options)
        }
        BN("formatter").formatters("common").add({
            dataType: "int"
        }, e).add({
            dataType: "millisecond"
        }, e).add({
            dataType: "double"
        }, function(t) {
            parseFloat(t.value) ? e(t) : t.value = "0"
        }).add({
            dataType: "second"
        }, e).add({
            dataType: "affinity"
        }, function(e) {
            var t = 100 * (e.value - 1);
            e.value = BEM.blocks.humanize.format("percents", t ? t.toFixed(1) : 0, e.options)
        }).add({
            dataType: "date"
        }, function(e) {
            e.value = BN("i-date").format(BN("i-date").localizedDateFormat("common-date-format"))(e.value)
        }).add({
            dataType: "percents"
        }, e).add({
            dataType: "phone-number"
        }, e).add({
            dataType: "currency"
        }, e)
    }(), BN("formatter").formatters("metric").add({
        type: "metric",
        dim: "ym:s:avgBouncePrecise"
    }, function(e) {
        e.value = BEM.blocks.humanize.format("percents", 100 * (e.originValue || e.value))
    }).add({
        type: ["metric-left", "metric-right", "metric"],
        dim: ["ym:s:affinityIndexInterests", "ym:s:goal<goal_id>affinityIndexInterests"]
    }, function(e) {
        e.value = BEM.blocks.humanize.format("percents", e.originValue, e.options)
    }), BN("formatter").formatters("dimension").add({
        dataType: "date-period",
        group: ["day", "week", "month"]
    }, function(e) {
        var t = BN("i-date"),
            i = e.raw,
            n = t.format(t.localizedDateFormat("dimension-period-format"));
        e.value = i.from === i.to ? t.format(t.localizedDateFormat("dimension-date-format"))(i.from) : n(i.from) + " " + String.fromCharCode(8212) + " " + n(i.to)
    }), BN("formatter").formatters("chart").add({
        type: "dimension"
    }, function(e) {
        var t, i;
        e.dimensions ? (i = e.dimensionsMeta.slice(0, Math.min(e.dimensions.length, e.dimensionsMeta.length)), t = i.reduce(function(e, t, i) {
            return e[t.dim] = i, e
        }, {}), e.value = BN("i-dimension-chooser").getDimensionsForCompactLabel(i, e.dimensions).map(function(n) {
            var o = i[t[n]].type,
                s = e.dimensions[t[n]].name;
            return null === s ? BEM.I18N("report-chart", "undefined-slice") : BN("formatter").run([], {
                dataType: o,
                value: s
            })
        }).join(" " + String.fromCharCode(8594) + " ")) : e.value = null === e.dimension.name ? BEM.I18N("report-chart", "undefined-slice") : BN("formatter").run([], {
            dataType: e.dimension.type,
            value: e.dimension.name
        }), e.value = BN("i-string").escapeHTML(e.value)
    }).add({
        type: "dimension",
        chart: "map"
    }, function(e) {
        e.value = e.dimensions.map(function(e) {
            return e.name
        }).join(" " + String.fromCharCode(8594) + " ")
    }).add({
        type: "chart-date"
    }, function(e) {
        var t = BN("i-date"),
            i = "";
        switch (e.group) {
            case "hour":
            case "hours":
            case "minute":
            case "minutes":
            case "hour":
            case "hours":
                i = t.format(BN("i-date").localizedDateFormat(e.localeKey + "-date-hour"))(e.date1);
                break;
            case "day":
                i = t.format(BN("i-date").localizedDateFormat(e.localeKey + "-date-day"))(e.date1);
                break;
            case "week":
                i = [t.format(BN("i-date").localizedDateFormat(e.localeKey + "-date-week"))(e.date1), String.fromCharCode(8212), t.format(BN("i-date").localizedDateFormat(e.localeKey + "-date-week"))(e.date2)].join(" ");
                break;
            case "month":
                i = t.format(BN("i-date").localizedDateFormat(e.localeKey + "-date-month"))(e.date1)
        }
        e.value = {
            block: "report-chart",
            elem: "date",
            tag: "span",
            content: i,
            attrs: {
                style: e.isHoliday ? "color:" + BN("i-colorpool").HOLIDAY_COLOR : ""
            }
        }
    }).add({
        type: "monitoring-date"
    }, function(e) {
        var t = BN("i-date"),
            i = t.format(t.localizedDateFormat("common-date-time-format"));
        e.value = [i(e.date1), String.fromCharCode(8212), i(e.date2)].join(" ")
    }).add({
        type: "metric",
        normalization: !0
    }, function(e) {
        e.value = e.value / e.totals * 100
    }).add({
        type: "metric"
    }, function(e) {
        e.value = isFinite(e.value) && !isNaN(e.value) ? e.value : 0
    }), BEM.decl("i-colorpool", {
        _colors: null,
        _colorsCache: {},
        getAllColors: function() {
            return Object.keys(this._colors).map(function(e) {
                return this._colors[e].color
            }, this)
        },
        get: function(e, t) {
            return "boolean" == typeof e && (t = e, e = void 0), e = Object.keys(this._colors).reduce(function(t, i) {
                return this._colors[i].exclusive ? t : t ? ((this._colors[t].count > this._colors[i].count || this._colors[t].count === this._colors[t].count && i === e) && (t = i), t) : i
            }.bind(this), !1), this._colors[e].count++, this._colors[e].exclusive = t, e
        },
        getColor: function(e) {
            return e = e || this.get(), this._colors[e].color
        },
        getColors: function(e) {
            return e.map(this.getColor.bind(this))
        },
        getByKeys: function(e) {
            return e.map(function(e) {
                return this._colorsCache.hasOwnProperty(e) || (this._colorsCache[e] = this.get()), this._colorsCache[e]
            }, this)
        },
        free: function(e) {
            var t = this._colors[e];
            t && (t.count = t.count > 1 ? t.count - 1 : 0, !t.count && t.exclusive && (t.exclusive = !1))
        },
        reset: function() {
            Object.keys(this._colors).forEach(function(e) {
                this._colors[e].count = 0, this._colors[e].exclusive = !1
            }, this)
        },
        _setColors: function(e) {
            return this._colors = e.reduce(function(e, t, i) {
                return e[i + 1] = {
                    count: 0,
                    exclusive: !1,
                    color: t
                }, e
            }, {}), this
        }
    }, {
        HOLIDAY_COLOR: "#bb0000",
        _colors: {
            "default": ["#97cc64", "#ffd963", "#fd5a3e", "#77b6e7", "#a955b8", "#dc9d6b", "#ea527f", "#4569bc", "#4ba062"],
            set01: ["#8bc554", "#fdcc35", "#fc4526", "#62ace6", "#9b40ab", "#d79159", "#e73a6d", "#2f55ac", "#399151"],
            set02: ["#77bb36", "#fdcc35", "#fc2500", "#469ee2", "#891e9c", "#d07e3c", "#e31754", "#0a379e", "#167e32"]
        },
        create: function(e) {
            return BEM.create({
                block: "i-colorpool"
            })._setColors(this._colors[e || "default"])
        },
        getHeatColor: function(e, t, i, n, o, s) {
            return s || (s = this.getPow(o, t, i)), this._piecewiseLinearUnitToColor(Math.pow(this._linearIntervalToUnit(e, t, i), s), n)
        },
        getPow: function(e, t, i) {
            var n, o = e.slice(0).filter(function(e) {
                    return BN("i-util").isNumeric(e)
                }, this),
                s = 1;
            return o.length >= 5 && (o.sort(function(e, t) {
                return e - t
            }), n = o.length % 2 ? o[Math.floor(o.length / 2)] : (o[o.length / 2 - 1] + o[o.length / 2]) / 2, s = Math.log(.5) / Math.log((n - t) / (i - t)), (!BN("i-util").isNumeric(s) || s > 1 || 0 >= s) && (s = 1)), s
        },
        _linearIntervalToUnit: function(e, t, i) {
            var n = (e - t) / (i - t);
            return BN("i-util").isNumeric(n) || (n = .5), n
        },
        _linearUnitToInterval: function(e, t, i) {
            return t + e * (i - t)
        },
        _piecewiseLinearUnitToColor: function(e, t) {
            var i, n, o, s, r = t.length - 1,
                a = Math.floor(e * r);
            return a === r && (a = r - 1), i = t[a], n = t[a + 1], o = e * r - a, s = [Math.round(this._linearUnitToInterval(o, i[0], n[0])), Math.round(this._linearUnitToInterval(o, i[1], n[1])), Math.round(this._linearUnitToInterval(o, i[2], n[2]))], "rgb(" + s.join(",") + ")"
        }
    }), BEM.decl({
        name: "report-chart",
        modName: "phantom",
        modVal: "yes"
    }, {
        draw: function() {
            var e = this.__base.apply(this, arguments);
            return this._isPhantom() && e.always(this.trigger.bind(this, "renderReady")), e
        },
        _isPhantom: function() {
            return Boolean(window.isPhantom)
        }
    }), BEM.decl({
        name: "report-chart-small-line",
        baseBlock: "report-chart"
    }, {
        LINE_COLOR: "#49BEDF",
        FILL_COLOR: "#ADDBEC",
        draw: function(e) {
            return this._valueType = e.valueType || "int", this._valueName = e.valueName || BEM.I18N("small-chart", "visits"), this.__base(e.data)
        },
        setDestination: function(e) {
            this._renderTo = jQuery(e).get(0)
        },
        _initChartOptions: function() {
            var e = this._getDisabledAxisOptions();
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "area",
                    height: 50,
                    spacing: [0, 0, 0, 0],
                    marginLeft: 3,
                    marginRight: 3,
                    marginBottom: 4,
                    plotBorderWidth: 0
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: !1,
                            symbol: "circle",
                            radius: 2
                        },
                        lineWidth: 1,
                        fillColor: this.FILL_COLOR,
                        states: {
                            hover: {
                                lineWidth: 1
                            }
                        }
                    }
                },
                tooltip: {
                    useHTML: !0,
                    borderWidth: 0,
                    backgroundColor: "#fff",
                    shape: "square",
                    style: {
                        padding: 0,
                        lineHeight: "normal"
                    },
                    positioner: function(e, t, i) {
                        var n = this.chart.chartWidth,
                            o = Math.max(i.plotX - e / 2, -25),
                            s = i.plotY - t - 10;
                        return o + e > n + 25 && (o = n + 25 - e), {
                            x: o,
                            y: s
                        }
                    }
                }
            }), this._chartOptions.xAxis = e, this._chartOptions.yAxis = e
        },
        _getChartDataOptions: function() {
            var e = this._dataModel;
            return {
                xAxisFormatter: function() {
                    return this.value
                },
                series: [{
                    data: e.map(function(e) {
                        return {
                            x: e.date,
                            y: e.value
                        }
                    })
                }]
            }
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            e.series[0].color = this.LINE_COLOR, jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    labels: {
                        formatter: e.xAxisFormatter
                    }
                },
                series: e.series
            })
        },
        _tooltipFormatter: function(e, t) {
            var i = this._formatDateTime({
                dateTime: t.x,
                localeKey: "tooltip",
                group: "day"
            });
            return i + "<br />" + this._valueName + ": " + BN("humanize").format(this._valueType, t.y)
        }
    }), BEM.JSON.decl("counters-type-selector", {
        _LABEL_MAX_LENGTH: 16,
        onBlock: function(e) {
            var t = e.param("labels"),
                i = e.param("labelTypeAll"),
                n = [i].concat(t).filter(function(e) {
                    return !!e.favorite
                }),
                o = e.params().selected || i.id,
                s = e.param("search") || "";
            e.content([{
                elem: "list",
                tag: "ul",
                content: n.map(function(e) {
                    return {
                        elem: "item",
                        id: e.id,
                        name: e.name,
                        search: s,
                        mods: {
                            selected: e.id === o ? "yes" : ""
                        },
                        total: e.numCounters || 0
                    }
                }, this)
            }, {
                block: "labels-manage-dropdown",
                selected: o,
                labels: t
            }])
        },
        onElem: {
            item: function(e) {
                var t = e.params(),
                    i = BN("i-string").escapeHTML(BN("i-string").hellipCut(t.name, this._LABEL_MAX_LENGTH, "..."));
                e.tag("li").mix({
                    block: "i-glue",
                    js: {
                        modelName: "m-label",
                        modelId: t.id
                    }
                }).js({
                    id: t.id,
                    name: t.name
                }).content([{
                    elem: "label",
                    tag: "span",
                    content: i
                }, {
                    elem: "total",
                    mix: [{
                        block: "i-glue",
                        elem: "model-field",
                        js: {
                            name: "numCounters",
                            type: "inline"
                        }
                    }],
                    tag: "span",
                    content: t.total
                }])
            }
        }
    }), BEM.DOM.decl("counters-type-selector", {
        onSetMod: {
            js: function() {
                this._tabs = Array.prototype.reduce.call(this.findElem("item"), function(e, t) {
                    return t = $(t), e[this.elemParams(t).id] = {
                        count: parseInt(this.findElem(t, "total").text(), 10),
                        elem: t
                    }, e
                }.bind(this), {}), this._labelsList = BEM.MODEL.getOne({
                    name: "m-labels"
                }), this._labelsList.on("fix", this._redraw, this).on("select", this._changeSelectedLabel, this)
            }
        },
        getTabCount: function(e) {
            return this._tabs[e] && this._tabs[e].count
        },
        setTabCount: function(e, t) {
            this._labelsList.get("labels").getById(e).set("numCounters", t).fix()
        },
        destruct: function() {
            return this._labelsList.un("fix", this._redraw, this).un("select", this._changeSelectedLabel, this), this.__base.apply(this, arguments)
        },
        _redraw: function() {
            var e, t = this.findElem("item", "selected", "yes");
            e = t.length ? this.elemParams(t).id : "", BN("i-content").update(this.elem("list"), this._labelsList.get("labels").reduce(function(t, i) {
                return i.get("favorite") && t.push(this._makeFavoriteItemFromLabel(i, e)), t
            }.bind(this), []))
        },
        _makeFavoriteItemFromLabel: function(e, t) {
            return {
                block: "counters-type-selector",
                elem: "item",
                id: e.get("id"),
                name: e.get("name"),
                mods: {
                    selected: e.get("id") === t ? "yes" : ""
                },
                total: e.get("numCounters")
            }
        },
        _changeSelectedLabel: function(e, t) {
            var i = this._findElemByLabelId(t.id);
            if (i) {
                if (this.hasMod(i, "selected", "yes")) return;
                this.delMod(this.findElem("item"), "selected"), this.setMod(i, "selected", "yes")
            } else this.delMod(this.findElem("item"), "selected")
        },
        _findElemByLabelId: function(e) {
            var t, i;
            return this.findElem("item").each(function(n, o) {
                return i = this.elemify(o, "item"), e === this.elemParams(i).id ? (t = i, !0) : void 0
            }.bind(this)), t
        }
    }, {
        live: function() {
            return this.liveBindTo("item", "click", function(e) {
                this._labelsList.selectLabel(this.elemParams(this.elemify(e.data.domElem, "item")).id)
            }), !1
        }
    }), BEM.JSON.decl("labels-manage-dropdown", {
        onBlock: function(e) {
            var t = e.param("selected"),
                i = e.param("labels"),
                n = i.filter(function(e) {
                    return e.id === t
                }).pop(),
                o = n && !n.favorite ? n.name : BEM.I18N("labels-manage-dropdown", "all-labels");
            e.js({
                selectedLabel: n
            }).content([{
                block: "advice",
                mods: {
                    orient: "right-outer"
                },
                type: "labels",
                index: 1
            }, {
                block: "dropdown",
                mix: [{
                    block: "labels-manage-dropdown",
                    elem: "dropdown"
                }],
                content: [{
                    block: "button",
                    mix: [{
                        block: "dropdown",
                        elem: "switcher"
                    }],
                    mods: {
                        size: "s",
                        arrow: "down",
                        theme: "clear"
                    },
                    content: {
                        block: "labels-manage-dropdown",
                        elem: "label-title-container",
                        tag: "span",
                        content: {
                            block: "labels-manage-dropdown",
                            elem: "label-title",
                            tag: "span",
                            content: BN("i-string").escapeHTML(o)
                        }
                    }
                }, {
                    elem: "popup",
                    mix: [{
                        block: "labels-manage-dropdown",
                        elem: "popup"
                    }],
                    mods: {
                        autoclosable: "yes"
                    },
                    js: {
                        directions: {
                            axis: "left",
                            to: "bottom",
                            tail: {
                                axis: "center"
                            }
                        }
                    },
                    content: {
                        block: "labels-manage",
                        labels: i
                    }
                }]
            }])
        }
    }), BEM.DOM.decl("labels-manage-dropdown", {
        onSetMod: {
            js: function() {
                var e = this.findBlockInside("labels-manage"),
                    t = this;
                this._onLabelFix = function() {
                    var e = this.getSelectedLabel();
                    t._setTitle(e.get("favorite") ? void 0 : e.get("name"))
                }, this._model = BEM.MODEL.getOne("m-labels"), this._model.on("select", this._onLabelSelect, this).on("fix", this._onLabelFix), this.dropdown = this.findBlockOn("dropdown", "dropdown"), e.on("save", function() {
                    this.dropdown.hide()
                }, this), this.dropdown.getPopup().on("hide", function() {
                    e.rollback()
                })
            }
        },
        destruct: function() {
            this._model.un("select", this._onLabelSelect, this).un("fix", this._onLabelFix), this.__base.apply(this, arguments)
        },
        _onLabelSelect: function(e, t) {
            this._setTitle(t.get("favorite") ? void 0 : t.get("name")), this.dropdown.hide()
        },
        _setTitle: function(e) {
            return e = e || BEM.I18N("labels-manage-dropdown", "all-labels"), this.elem("label-title").text(e), this
        }
    }), BEM.JSON.decl("labels-manage", {
        onBlock: function(e) {
            e.js({
                labels: e.param("labels")
            }).content([{
                elem: "controls"
            }, {
                elem: "labels-list",
                labels: e.param("labels")
            }, {
                elem: "save"
            }, {
                block: "wait",
                mods: {
                    theme: "white"
                },
                mix: {
                    block: "labels-manage",
                    elem: "wait"
                }
            }])
        },
        onElem: {
            controls: function(e) {
                e.content([{
                    block: "add-label",
                    mix: [{
                        block: "labels-manage",
                        elem: "add-label"
                    }, {
                        block: "error-message",
                        mods: {
                            type: "popup"
                        },
                        js: {
                            directions: {
                                to: "right",
                                axis: "middle"
                            }
                        }
                    }]
                }, {
                    block: "check-button",
                    mix: [{
                        block: "labels-manage",
                        elem: "quick-access-button"
                    }],
                    mods: {
                        size: "m"
                    },
                    content: BEM.I18N("labels-manage", "favorites")
                }])
            },
            "labels-list": function(e) {
                e.content({
                    block: "labels-manage-list",
                    labels: e.param("labels").filter(function(e) {
                        return "all" === e.id
                    })
                })
            },
            save: function(e) {
                e.content({
                    block: "button",
                    mix: [{
                        block: "labels-manage",
                        elem: "save-button"
                    }, {
                        block: "error-message",
                        mods: {
                            type: "popup"
                        },
                        js: {
                            directions: {
                                to: "right",
                                axis: "middle"
                            }
                        }
                    }],
                    mods: {
                        size: "m",
                        theme: "action",
                        disabled: "yes"
                    },
                    content: BEM.I18N("labels-manage", "save")
                })
            }
        }
    }), BEM.DOM.decl("labels-manage", {
        onSetMod: {
            js: function() {
                this._labels = BEM.MODEL.getOne({
                    name: "m-labels"
                }), this._labels.on("labels", "remove", this._updateHaveChanges, this).on("labels", "change", this._onLabelsChange, this).on("labels", "error", this._onLabelsError, this), this._addLabel = this.findBlockOn("add-label", "add-label"), this._saveButton = this.findBlockOn("save-button", "button"), this._quickAccessButton = this.findBlockOn("quick-access-button", "check-button"), this._labelsList = this.findBlockInside("labels-list", "labels-manage-list"), this._waitBlock = this.findBlockOn("wait", "wait"), this._addLabel.on("open", this._onAddLabelOpen, this).on("close", this._onAddLabelClose, this).on("save", this._onAddLabelSave, this).on("change", this._onAddLabelChange, this), this._quickAccessButton.on("change", this._onQuickAccessButtonChange, this), this._labelsList.on("update", this._onLabelUpdate, this).on("delete", this._onLabelDelete, this).on("restore", this._onLabelRestore, this).on("change", this._onLabelChange, this).on("label-select", this._onLabelSelect, this).on("label-add", this._onLabelAdd, this), this._saveButton.on("click", this._onSaveButtonClick, this)
            },
            mode: function(e, t) {
                this._labelsList.setMod("mode", "quick-access" === t ? "edit" : ""), "new-label" !== t && "" !== t || !this._quickAccessButton.hasMod("checked") || (this._updateVisuals(), this._quickAccessButton.delMod("checked")), "quick-access" !== t || this._quickAccessButton.hasMod("checked", "yes") || (this._updateVisuals(), this._quickAccessButton.setMod("checked", "yes"))
            },
            "have-changes": function(e, t) {
                this._saveButton.setMod("disabled", t ? "" : "yes").delMod("focused")
            }
        },
        destruct: function() {
            this._labels.un("labels", "remove", this._updateHaveChanges, this).un("labels", "change", this._onLabelsChange, this).un("labels", "error", this._onLabelsError, this), this.__base.apply(this, arguments)
        },
        rollback: function() {
            this.delMod("mode"), this._addLabel.close(), this._labels.get("labels").forEach(function(e) {
                e.isNew() ? e.destruct() : e.rollback()
            }), this._labels.trigger("rollback"), this._labelsList.render()
        },
        _updateHaveChanges: function() {
            this.setMod("have-changes", this._labels.hasChanges() ? "yes" : "")
        },
        _onLabelsChange: function(e, t) {
            "favorite" === t.innerField && this._labelsList.setMod("can-mark-favorite", this._labels.canAddFavorite() ? "yes" : "no"), this._updateHaveChanges()
        },
        _onLabelsError: function() {
            BN("error-message").showError(this._saveButton, "ERR_LABEL_REQUEST_FAILED")
        },
        _onAddLabelOpen: function() {
            this.setMod("mode", "new-label")
        },
        _onAddLabelClose: function() {
            this.delMod("mode")
        },
        _onAddLabelSave: function(e, t) {
            "" === t ? this._addLabel.close() : (this._addLabel.close(), this._labels.get("labels").add({
                id: $.identify(),
                name: t
            }))
        },
        _onAddLabelChange: function(e, t) {
            this._labels.isExistsLabelWithName(t) ? (this._addLabel.setMod("can-save", "no"), BN("error-message").showError(this._addLabel, "ERR_LABEL_DUPLICATE_NAME")) : (this._addLabel.delMod("can-save"), BN("error-message").hideError(this._addLabel))
        },
        _onQuickAccessButtonChange: function() {
            this._isUpdatingVisuals || this.setMod("mode", this._quickAccessButton.isChecked() ? "quick-access" : "")
        },
        _onLabelUpdate: function(e, t) {
            BEM.MODEL.getOne({
                name: "m-label",
                id: t.id
            }).set(t.field, t.value)
        },
        _onLabelDelete: function(e, t) {
            this._labels.remove(t.id)
        },
        _onLabelRestore: function(e, t) {
            this._labels.restore(t.id)
        },
        _onLabelChange: function(e, t) {
            var i = BEM.MODEL.getOne({
                name: "m-label",
                id: t.id
            });
            t.source.params.label.name !== t.value && this._labels.isExistsLabelWithName(t.value) ? (t.source.setMod("can-save", "no"), this._saveButton.setMod("disabled", "yes"), BN("error-message").showError(t.source, "ERR_LABEL_DUPLICATE_NAME")) : "name" === t.field && "" === t.value ? (i.fields.name.rollback(), t.source.setMod("can-save", "no"), this._saveButton.setMod("disabled", "yes"), BN("error-message").showError(t.source, "ERR_LABEL_EMPTY_NAME")) : (t.source.delMod("can-save"), this._saveButton.delMod("disabled"), BN("error-message").hideError(t.source), i.set(t.field, t.value))
        },
        _onLabelAdd: function() {
            this.elem("labels-list").animate({
                scrollTop: 0
            }, 200)
        },
        _onLabelSelect: function(e, t) {
            this.hasMod("mode", "new-label") || this.hasMod("mode", "quick-access") || t.isNew || this._labels.selectLabel(t.id)
        },
        _onSaveButtonClick: function() {
            this._waitBlock.show(), this._labels.save().then(function() {
                this.delMod("have-changes"), this.trigger("save")
            }.bind(this)).fail(function(e) {
                var t = "ERR_LABEL_REQUEST_FAILED";
                403 === e.status && (t = "access_denied"), BN("error-message").showError(this._saveButton, t)
            }.bind(this)).always(function() {
                this._waitBlock.hide()
            }.bind(this))
        },
        _updateVisuals: function() {
            return this._isUpdatingVisuals = !0, this._quickAccessButton.onFirst("change", function() {
                this._isUpdatingVisuals = !1
            }, this), this
        }
    }), BEM.JSON.decl("add-label", {
        onBlock: function(e) {
            e.js(!0).content([{
                elem: "cell",
                elemMods: {
                    type: "button"
                },
                content: {
                    block: "check-button",
                    mix: [{
                        block: "add-label",
                        elem: "add-label-button"
                    }],
                    mods: {
                        size: "m"
                    },
                    content: [{
                        block: "icon",
                        mix: [{
                            block: "add-label",
                            elem: "add-label-button-icon"
                        }, {
                            block: "check-button",
                            elem: "icon"
                        }],
                        elem: "plus"
                    }, {
                        block: "add-label",
                        elem: "add-label-button-text",
                        content: BEM.I18N("add-label", "new-label")
                    }]
                }
            }, {
                elem: "cell",
                elemMods: {
                    type: "input"
                },
                content: {
                    block: "input",
                    mix: [{
                        block: "add-label",
                        elem: "label-input"
                    }],
                    mods: {
                        size: "m"
                    },
                    content: {
                        elem: "control"
                    }
                }
            }])
        }
    }), BEM.DOM.decl("add-label", {
        onSetMod: {
            js: function() {
                this._addLabelButton = this.findBlockOn("add-label-button", "check-button"), this._labelInput = this.findBlockOn("label-input", "input"), this._addLabelButton.on("change", this._onLabelButtonChange, this), this._labelInput.on("change", function() {
                    this.trigger("change", this._labelInput.val())
                }, this), this.bindTo(this._labelInput.elem("control"), "keypress", function(e) {
                    this.hasMod("can-save", "no") || 13 !== e.which || this.save()
                })
            },
            "can-save": function(e, t) {
                this._addLabelButton.setMod("disabled", "no" === t ? "yes" : "")
            }
        },
        open: function() {
            return this.setMod("mode", "edit"), this._labelInput.clearInput().focus(), this._addLabelButton.hasMod("checked", "yes") || this._updateVisuals()._addLabelButton.setMod("checked", "yes"), this.trigger("open")
        },
        close: function() {
            return this._addLabelButton.delMod("focused"), this._addLabelButton.hasMod("checked") && this._updateVisuals()._addLabelButton.delMod("checked"), this.delMod("mode").trigger("close")
        },
        save: function() {
            return this.trigger("save", this._labelInput.val())
        },
        _onLabelButtonChange: function() {
            this._isUpdatingVisuals || (this._addLabelButton.isChecked() ? this.open() : this.save())
        },
        _updateVisuals: function() {
            return this._isUpdatingVisuals = !0, this._addLabelButton.onFirst("change", function() {
                this._isUpdatingVisuals = !1
            }, this), this
        }
    }), BEM.JSON.decl("labels-manage-list", {
        onElem: {
            list: function(e) {
                var t = BN("i-labels").sortLabelsUsersFirst(e.param("labels").slice());
                e.content(t.filter(function(e) {
                    return "all" !== e.id
                }).map(function(t) {
                    return {
                        elem: "item",
                        label: t,
                        canMarkFavorite: e.param("canMarkFavorite"),
                        showFavorite: e.param("showFavorite")
                    }
                }))
            },
            item: function(e) {
                e.mods({
                    id: e.param("label").id
                }).content({
                    block: "labels-manage-list-item",
                    mods: {
                        deleted: e.param("label").isDeleted ? "yes" : "",
                        "can-mark-favorite": e.param("canMarkFavorite") ? "yes" : "",
                        "show-favorite": e.param("showFavorite") ? "yes" : ""
                    },
                    label: e.param("label"),
                    canMarkFavorite: e.param("canMarkFavorite")
                })
            }
        }
    }), BEM.DOM.decl("labels-manage-list", {
        onSetMod: {
            js: function() {
                this._labels = BEM.MODEL.getOne({
                    name: "m-labels"
                }), this._labels.on("labels", "add", this._onLabelsAdd, this).on("labels", "remove", this._onLabelsRemove, this), BEM.blocks["labels-manage-list-item"].on(this.domElem, "delete update restore label-select", function(e, t) {
                    this.trigger(e.type, t)
                }, this), BEM.blocks["labels-manage-list-item"].on(this.domElem, "change", function(e, t) {
                    this.trigger("change", {
                        source: e.block,
                        id: t.id,
                        field: t.field,
                        value: t.value
                    })
                }, this), this.render()
            },
            mode: function(e, t) {
                this._getItemBlocks().forEach(function(e) {
                    e.setMod("show-favorite", "edit" === t ? "yes" : "")
                })
            },
            "can-mark-favorite": function(e, t) {
                this._getItemBlocks().forEach(function(e) {
                    e.setMod("can-mark-favorite", t)
                })
            }
        },
        destruct: function() {
            this._labels.un("labels", "add", this._onLabelsAdd, this).un("labels", "remove", this._onLabelsRemove, this), this.__base.apply(this, arguments)
        },
        render: function() {
            BEM.DOM.update(this.domElem, BN("i-content").html({
                block: "labels-manage-list",
                elem: "list",
                labels: this._labels.toJSON().labels,
                showFavorite: "edit" === this.getMod("mode"),
                canMarkFavorite: this._labels.canAddFavorite()
            }, !0))
        },
        _onLabelsAdd: function(e, t) {
            BN("i-content").prepend(this.findElem("list"), {
                block: "labels-manage-list",
                elem: "item",
                mods: {
                    "just-created": "yes",
                    "fading-hover": "yes"
                },
                canMarkFavorite: this._labels.canAddFavorite(),
                label: t.model.toJSON()
            }).then(function() {
                var e = this.findElem("item", "just-created", "yes");
                this.trigger("label-add", e), this.afterCurrentEvent(function() {
                    e.one("mouseover webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend", function() {
                        this.delMod(e, "fading-hover")
                    }.bind(this))
                }), this.delMod(e, "just-created")
            }.bind(this))
        },
        _onLabelsRemove: function(e, t) {
            var i = t.model,
                n = this.findElem("item", "id", t.model.get("id"));
            i.isNew() ? n.remove() : this.findBlockInside(n, "labels-manage-list-item").setMod("deleted", "yes")
        },
        _getItemBlocks: function() {
            return this.findBlocksInside("item", "labels-manage-list-item")
        }
    }), BEM.JSON.decl("labels-manage-list-item", {
        onBlock: function(e) {
            var t = e.param("label"),
                i = "checkbox" + t.id;
            e.mix({
                block: "i-glue",
                js: {
                    modelName: "m-label",
                    modelId: t.id
                }
            }).js({
                label: t
            }).content([{
                elem: "favorite",
                favorite: t.favorite,
                canMarkFavorite: e.param("canMarkFavorite"),
                favoriteControlId: i
            }, {
                elem: "title",
                name: t.name,
                count: t.numCounters || 0,
                favoriteControlId: i
            }, !t.system && {
                elem: "item-controls"
            }])
        },
        onElem: {
            "name-container": function(e) {
                e.tag("label")
            },
            title: function(e) {
                var t = BN("i-string").escapeHTML(e.param("name"));
                e.content([{
                    elem: "title-line"
                }, {
                    elem: "name-container",
                    content: {
                        elem: "name",
                        mix: [{
                            block: "i-glue",
                            elem: "model-field",
                            js: {
                                type: "inline",
                                name: "name"
                            }
                        }, {
                            block: "hint-hover",
                            js: {
                                widthLimiter: ".labels-manage-list-item__title"
                            }
                        }],
                        content: t
                    },
                    attrs: {
                        "for": e.param("favoriteControlId")
                    }
                }, {
                    elem: "count",
                    mix: [{
                        block: "i-glue",
                        elem: "model-field",
                        js: {
                            type: "inline",
                            name: "numCounters"
                        }
                    }],
                    content: e.param("count")
                }, {
                    block: "input",
                    mix: [{
                        block: "labels-manage-list-item",
                        elem: "title-edit"
                    }, {
                        block: "error-message",
                        mods: {
                            type: "popup"
                        },
                        js: {
                            directions: {
                                to: "right",
                                axis: "middle"
                            }
                        }
                    }],
                    mods: {
                        size: "m"
                    },
                    content: {
                        elem: "control",
                        content: t
                    }
                }])
            },
            favorite: function(e) {
                var t = {
                    size: "m",
                    checked: e.param("favorite") ? "yes" : ""
                };
                e.param("favorite") || e.param("canMarkFavorite") || (t.disabled = "yes"), e.content({
                    block: "checkbox",
                    mix: [{
                        block: "labels-manage-list-item",
                        elem: "favorite-checkbox"
                    }, {
                        block: "i-glue",
                        elem: "model-field",
                        js: {
                            type: "checkbox",
                            name: "favorite"
                        }
                    }],
                    mods: t,
                    checkboxAttrs: {
                        id: e.param("favoriteControlId")
                    }
                })
            },
            "item-controls": function(e) {
                e.content([{
                    elem: "normal-controls",
                    content: [{
                        block: "check-button",
                        mix: [{
                            block: "labels-manage-list-item",
                            elem: "edit-button"
                        }],
                        mods: {
                            pseudo: "yes",
                            "only-icon": "yes",
                            size: "s"
                        },
                        attrs: {
                            title: BEM.I18N("labels-manage-list-item", "edit")
                        },
                        content: {
                            block: "icon",
                            elem: "edit",
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }, {
                                block: "labels-manage-list-item",
                                elem: "edit-icon"
                            }]
                        }
                    }, {
                        block: "button",
                        mix: [{
                            block: "labels-manage-list-item",
                            elem: "remove-button"
                        }],
                        mods: {
                            pseudo: "yes",
                            "only-icon": "yes",
                            size: "s"
                        },
                        attrs: {
                            title: BEM.I18N("labels-manage-list-item", "remove")
                        },
                        content: {
                            block: "icon",
                            elem: "trash",
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }, {
                                block: "labels-manage-list-item",
                                elem: "remove-icon"
                            }]
                        }
                    }, {
                        block: "button",
                        mix: [{
                            block: "labels-manage-list-item",
                            elem: "revert-button"
                        }],
                        mods: {
                            pseudo: "yes",
                            "only-icon": "yes",
                            size: "s"
                        },
                        attrs: {
                            title: BEM.I18N("labels-manage-list-item", "revert")
                        },
                        content: {
                            block: "icon",
                            elem: "circle-arrow",
                            elemMods: {
                                color: "black"
                            },
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }, {
                                block: "labels-manage-list-item",
                                elem: "revert-icon"
                            }]
                        }
                    }]
                }, {
                    elem: "restore-control",
                    content: [{
                        elem: "shutter"
                    }, {
                        block: "button",
                        mix: [{
                            block: "labels-manage-list-item",
                            elem: "restore-button"
                        }],
                        mods: {
                            pseudo: "yes",
                            size: "s"
                        },
                        content: BEM.I18N("labels-manage-list-item", "restore")
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("labels-manage-list-item", {
        onSetMod: {
            js: function() {
                this._favoriteCheckbox = this.findBlockOn("favorite-checkbox", "checkbox"), this._editButton = this.findBlockOn("edit-button", "check-button"), this._removeButton = this.findBlockOn("remove-button", "button"), this._revertButton = this.findBlockOn("revert-button", "button"), this._restoreButton = this.findBlockOn("restore-button", "button"), this._titleEdit = this.findBlockOn("title-edit", "input"), this._nonTriggeringSelectControls = [this._favoriteCheckbox, this._editButton, this._removeButton, this._revertButton, this._restoreButton, this._titleEdit].filter(Boolean).map(function(e) {
                    return e.domElem
                }), this._favoriteCheckbox.on("change", this._onFavoriteCheckboxChange, this), this.bindTo("name-container", "click", this._onNameContainerClick), this.bindTo("click", this._onClick, this), this._editButton && (this._titleEdit.on("change", this._onTitleEditChange, this), this.bindTo(this._titleEdit.elem("control"), "keypress", this._onTitleEditKeypress), this._editButton.on("change", this._onEditButtonChange, this), this._revertButton.on("click", this._onRevertButtonClick, this), this._removeButton.on("click", this._onRemoveButtonClick, this), this._restoreButton.on("click", this._onRestoreButtonClick, this))
            },
            "can-save": function(e, t) {
                this._editButton.setMod("disabled", "no" === t ? "yes" : "")
            },
            "can-mark-favorite": function(e, t) {
                this._favoriteCheckbox.isChecked() || this._favoriteCheckbox.setMod("disabled", "no" === t ? "yes" : "")
            }
        },
        _onNameContainerClick: function(e) {
            "yes" !== this.getMod("show-favorite") && e.preventDefault()
        },
        _onTitleEditKeypress: function(e) {
            this.hasMod("can-save", "no") || 13 !== e.which || this._editButton.setMod("checked", "no")
        },
        _onFavoriteCheckboxChange: function(e) {
            var t = e.block;
            this.trigger("update", {
                id: this.params.label.id,
                field: "favorite",
                value: t.isChecked()
            })
        },
        _onClick: function(e) {
            var t = this._nonTriggeringSelectControls.some(function(t) {
                    return 0 !== t.find(e.target).length || t[0] === e.target
                }),
                i = this.hasMod("mode", "rename");
            t || i || this.trigger("label-select", this.params.label)
        },
        _onTitleEditChange: function() {
            this.trigger("change", {
                id: this.params.label.id,
                field: "name",
                value: this._titleEdit.val()
            })
        },
        _onEditButtonChange: function() {
            if (!this._isUpdatingVisuals)
                if (this._editButton.isChecked()) {
                    this.setMod("mode", "rename");
                    var e = this._titleEdit.elem("control"),
                        t = e.get(0);
                    if (t.setSelectionRange) {
                        var i = 2 * e.val().length;
                        t.setSelectionRange(i, i)
                    }
                    e.val(this.params.label.name), this._titleEdit.focus()
                } else this.delMod("mode"), this._editButton.delMod("focused"), "" !== this._titleEdit.val() && (this.params.label.name = this._titleEdit.val(), this.trigger("update", {
                    id: this.params.label.id,
                    field: "name",
                    value: this._titleEdit.val()
                }))
        },
        _onRevertButtonClick: function() {
            this._updateVisuals()._editButton.delMod("checked"), this.delMod("mode"), this._titleEdit.val(this.params.label.name)
        },
        _onRemoveButtonClick: function() {
            this.trigger("delete", {
                id: this.params.label.id
            })
        },
        _onRestoreButtonClick: function() {
            this.delMod("deleted"), this.trigger("restore", {
                id: this.params.label.id
            })
        },
        _updateVisuals: function() {
            return this._isUpdatingVisuals = !0, this._editButton.onFirst("change", function() {
                this._isUpdatingVisuals = !1
            }, this), this
        }
    }), BEM.DOM.decl("i-glue", {
        onSetMod: {
            js: function() {
                this.glue()
            }
        },
        glue: function() {
            this._initModel()._initFields()
        },
        _initModel: function(e, t) {
            var i, n = e || this.getModelParams(),
                o = t || this.params.modelData || this.params.modelParams && this.params.modelParams.data;
            return i = o ? BEM.MODEL.create(n, o) : BEM.MODEL.getOrCreate(n), this.model = i, this
        },
        _initFields: function() {
            var e = this;
            return this._fields = {}, $.each(this.findElem("model-field"), function(t, i) {
                e.initFieldBlock($(i))
            }), this
        },
        initFieldBlock: function(e) {
            e = this.elemify(e, "model-field");
            var t = this.elemParams(e) || {};
            return Array.isArray(t) || (t = [t]), t.forEach(function(t) {
                t.name || (t.name = this.getMod(e, "name")), t.type || (t.type = this.getMod(e, "type"));
                var i = t.type,
                    n = new BEM.DOM.blocks["i-glue-field" + (i ? "_type_" + i : "")](e, t, !0);
                this._fields[t.name] = n, n.init(this.model)
            }, this), this
        },
        getFieldBlock: function(e) {
            return this._fields[e]
        },
        getModelParams: function() {
            if (this.params.modelParams) return this.params.modelParams;
            var e = {
                name: this.getModelName(),
                id: this.params.modelId
            };
            return this.params.modelParentPath && (e.parentPath = this.params.modelParentPath), this.params.modelParentName && (e.parentName = this.params.modelParentName, e.parentId = this.params.modelParentId), e
        },
        getModelPath: function() {
            return MODEL.buildPath(this.getModelParams)
        },
        getModelName: function() {
            return this.params.modelName || this.__self.getName()
        },
        destruct: function(e) {
            this._fields && Object.keys(this._fields).forEach(function(t) {
                this._fields[t].destruct(e)
            }, this), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl("i-glue-field", {
        onSetMod: {
            js: function() {
                this.name = this.params.name
            }
        },
        init: function(e) {
            return this.model = e, this.model.on(this.name, "change", this.onFieldChange, this), this
        },
        set: function(e) {
            return this.model.set(this.name, e), this
        },
        get: function() {
            return this.model.get(this.name)
        },
        onFieldChange: function(e, t) {},
        destruct: function() {
            this.model.un(this.name, "change", this.onFieldChange, this), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl({
        block: "i-glue-field_type_checkbox",
        baseBlock: "i-glue-field"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this.checkbox = this.findBlockOn("checkbox")
            }
        },
        init: function() {
            this.__base.apply(this, arguments), this.checkbox.on("change", function() {
                this.model.set(this.name, this.checkbox.isChecked())
            }, this)
        },
        set: function(e) {
            this.__base(), this.checkbox.setMod("checked", e ? "yes" : "")
        },
        onFieldChange: function(e, t) {
            "yes" !== this.checkbox.getMod("focused") && this.checkbox.setMod("checked", t.value ? "yes" : "")
        }
    }), BEM.DOM.decl({
        block: "i-glue-field_type_inline",
        baseBlock: "i-glue-field"
    }, {
        onFieldChange: function(e, t) {
            this.domElem.html(this.model.get(this.name, "format"))
        }
    }), BEM.DOM.decl({
        block: "i-glue-field_type_input",
        baseBlock: "i-glue-field"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this.input = this.findBlockOn("input")
            }
        },
        init: function() {
            this.__base.apply(this, arguments), this.input.on("change", function() {
                this.model.set(this.name, this.input.val())
            }, this).on("blur", function() {
                this.input.val(this.model.get(this.name, "format"))
            }, this)
        },
        set: function(e) {
            this.__base(), this.input.val(e)
        },
        onFieldChange: function(e, t) {
            "yes" !== this.input.getMod("focused") && this.input.val(t.value)
        }
    }), BEM.DOM.decl({
        block: "i-glue-field_type_select",
        baseBlock: "i-glue-field"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this.select = this.findBlockOn("select")
            }
        },
        init: function() {
            this.__base.apply(this, arguments), this.select.on("change", function() {
                this.model.set(this.name, this.select.val())
            }, this)
        },
        set: function(e) {
            this.__base(), this.select.val(e)
        },
        onFieldChange: function(e, t) {
            "yes" !== this.select.getMod("focused") && this.select.val(t.value)
        }
    }), BEM.DOM.decl({
        block: "i-glue-field_type_mod",
        baseBlock: "i-glue-field"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this._gluedBlock = this[this.params.elem ? "findBlockOutside" : "findBlockOn"](this.domElem, this.params.block || this.__self.getName()), this._gluedElem = this.params.elem && this._gluedBlock.findElem(this.domElem, this.params.elem)
            }
        },
        init: function() {
            this.__base.apply(this, arguments), this._fieldType = this.model.getType(this.name)
        },
        onFieldChange: function(e, t) {
            var i = this.model.get(this.name);
            "boolean" == this._fieldType && (i = i ? "yes" : ""), this._gluedBlock.setMod(this._gluedElem, this.params.modName, i)
        }
    }), BEM.DOM.decl("hint-hover", {
        TIMEOUT_DEBOUNCE: 110,
        onSetMod: {
            js: function() {
                this._widthLimiter = this.params.widthLimiter || this.domElem.prop("tagName"), this.bindTo("mouseenter", this._onMouseEnterDebounced).bindTo("mouseleave", this._onMouseLeave)
            }
        },
        destruct: function() {
            return this._popup && this._popup.destruct(), this.__base.apply(this, arguments)
        },
        _onMouseEnterDebounced: function() {
            this._popup = this._popup || this.__self._getPopup(), this._timeout = setTimeout(this._onMouseEnter.bind(this), this.TIMEOUT_DEBOUNCE)
        },
        _onMouseEnter: function() {
            var e, t;
            e = this.domElem.closest(this._widthLimiter), t = this.params.useMaxWidth ? parseInt(e.css("max-width")) : e.width(), this.domElem.width() >= (t || 0) && this._popup.setContent(BN("i-string").escapeHTML(this.domElem.text())).show(this.domElem)
        },
        _onMouseLeave: function() {
            clearTimeout(this._timeout), this._popup && this._popup.hide()
        }
    }, {
        _getPopup: function() {
            var e = BN("i-content").html({
                block: "popup",
                mix: [{
                    block: "hint-hover",
                    js: !0
                }],
                js: {
                    directions: ["bottom-left", "top-left"]
                },
                mods: {
                    animate: "no"
                },
                content: [{
                    elem: "content"
                }]
            }, !0);
            return jQuery(e).bem("popup")
        }
    }), BEM.JSON.decl("counters-table", {
        onBlock: function(e) {
            e.js(!0).tag("table").content([{
                elem: "head"
            }, {
                elem: "body"
            }])
        },
        onElem: {
            head: function(e) {
                e.tag("thead").content({
                    elem: "head-row",
                    content: [{
                        elem: "head-cell",
                        type: "first"
                    }, {
                        elem: "head-cell",
                        type: "name",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "visits",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "hits",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "users",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "dynamics",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "counter-type",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "grants"
                    }, {
                        elem: "head-cell",
                        type: "controls"
                    }]
                })
            },
            "head-cell": function(e) {
                var t = e.params(),
                    i = t.colspan,
                    n = t.type;
                e.tag("th"), i && e.attrs({
                    colspan: i
                }), t.label && e.content(BEM.I18N("counters-table", "header-" + n)), e.mix({
                    block: "counters-table",
                    elem: "head-" + n
                })
            },
            body: function(e) {
                var t = e.blockParams().counterList,
                    i = [],
                    n = {};
                t && (i = t.counters || [], n = t.grants && t.grants.counter || {}), e.tag("tbody").content(i.map(function(e) {
                    return {
                        elem: "body-row",
                        counter: e,
                        grants: n[e.id]
                    }
                }))
            },
            "body-row": function(e) {
                var t = e.params().counter,
                    i = e.params().grants,
                    n = ["first", "title", "visits", "hits", "users", "chart", "counter-type", "grants", "controls"];
                e.mod("counter", t.id), e.tag("tr").content(n.map(function(e) {
                    return {
                        elem: "cell-" + e,
                        tag: "td",
                        mix: [{
                            block: "counters-table",
                            elem: "body-cell"
                        }],
                        counter: t,
                        grants: i
                    }
                }))
            },
            "cell-first": function(e) {
                var t = e.params().counter;
                e.content([{
                    block: "counter-chosen",
                    counter: t
                }, {
                    block: "counter-status",
                    counter: t
                }])
            },
            "cell-title": function(e) {
                var t = e.params().counter;
                e.content([{
                    elem: "counter-title",
                    counter: t
                }, {
                    elem: "counter-info",
                    counter: t
                }, "guest" === t.uiType && {
                    elem: "owner-info",
                    counter: t
                }, {
                    block: "infected-hint",
                    counter: t
                }])
            },
            "counter-title": function(e) {
                var t = e.params().counter,
                    i = e.params().linkMods || {};
                e.content([{
                    block: "icon",
                    mods: {
                        type: "favicon"
                    },
                    mix: {
                        block: "counters-table",
                        elem: "favicon"
                    },
                    domain: t.site
                }, {
                    block: "smart-link",
                    mods: i,
                    mix: [{
                        block: "counters-table",
                        elem: "counter-title"
                    }],
                    js: {
                        path: "/dashboard",
                        params: {
                            id: t.id
                        },
                        keepParams: ["delegation"]
                    },
                    attrs: {
                        title: BEM.I18N("counters-table", "counter-link-title")
                    },
                    content: BN("i-string").escapeHTML(BN("i-counter-single").getName(t))
                }])
            },
            "counter-info": function(e) {
                var t = e.params().counter;
                e.wrap([{
                    elem: "info",
                    content: [t.site ? [{
                        block: "link",
                        mix: {
                            block: "counters-table",
                            elem: "site"
                        },
                        mods: {
                            external: "yes"
                        },
                        target: "_blank",
                        content: BN("i-string").escapeHTML(t.site),
                        url: t.site
                    }, " "] : "", {
                        elem: "counter-id",
                        tag: "span",
                        content: t.id
                    }]
                }])
            },
            "owner-info": function(e) {
                var t = e.params().counter;
                e.wrap([{
                    elem: "info",
                    content: [BEM.I18N("counters-table", "owner"), ":&nbsp;", {
                        elem: "owner-login",
                        tag: "span",
                        content: BN("i-string").escapeHTML(t.owner_login)
                    }]
                }])
            },
            "partner-info": function(e) {
                var t = e.params().counter;
                e.wrap([{
                    elem: "info",
                    content: [{
                        tag: "span",
                        content: BEM.I18N("counters-table", "partner")
                    }, {
                        block: "link",
                        target: "_blank",
                        content: BEM.I18N("counters-table", "serial-symbol") + t.partner_id,
                        url: "http://partner.yandex.ru/registered/?cmd=campaign_stat&ID=" + t.partner_id
                    }]
                }])
            },
            "cell-counter-type": function(e) {
                e.content({
                    block: "counters-labels",
                    js: {
                        id: "labels"
                    },
                    counter: e.params().counter,
                    content: {
                        elem: "labels"
                    }
                })
            },
            "cell-visits": function(e) {
                e.content({
                    block: "counter-activity",
                    type: "visits",
                    stats: e.params().counter.stats
                })
            },
            "cell-hits": function(e) {
                e.content({
                    block: "counter-activity",
                    type: "hits",
                    stats: e.params().counter.stats
                })
            },
            "cell-users": function(e) {
                e.content({
                    block: "counter-activity",
                    type: "users",
                    stats: e.params().counter.stats
                })
            },
            "cell-chart": function(e) {
                for (var t = e.params().counter, i = t.stats && t.stats.weekStats || [], n = [], o = Date.now(); i.length < 7;) i.unshift(0);
                i.reverse().forEach(function(e, t) {
                    n.unshift({
                        date: o - 864e5 * t,
                        value: e
                    })
                }), e.content({
                    elem: "chart-wrap",
                    content: {
                        block: "small-chart",
                        js: {
                            data: n
                        }
                    }
                })
            },
            "cell-controls": function(e) {
                var t = e.params().counter,
                    i = e.params().grants,
                    n = i ? i["delete"] : !0;
                e.content([{
                    block: "counter-editor",
                    mix: [{
                        block: "counters-table",
                        elem: "counter-edit"
                    }],
                    counter: t
                }, "own" === t.uiType && n ? {
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        "only-icon": "yes",
                        size: "s"
                    },
                    attrs: {
                        title: BEM.I18N("counters-table", "button-delete")
                    },
                    mix: [{
                        block: "counter-delete",
                        js: {
                            counterId: t.id
                        }
                    }, {
                        block: "counters-table",
                        elem: "counter-delete"
                    }, {
                        block: "error-message",
                        mods: {
                            type: "popup"
                        },
                        js: {
                            directions: {
                                to: "left",
                                axis: "middle"
                            }
                        }
                    }],
                    content: {
                        block: "icon",
                        elem: "trash",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }
                } : ""])
            },
            "cell-grants": function(e) {
                var t = e.param("counter");
                e.content([{
                    block: "counter-grant-unsubscribe",
                    mix: {
                        block: "counters-table",
                        elem: "counter-unsubscribe"
                    },
                    counter: t
                }, {
                    block: "counter-grants-editor",
                    mix: {
                        block: "counters-table",
                        elem: "grants-editor"
                    },
                    counter: t
                }])
            },
            "restore-row": function(e) {
                e.tag("tr").mix({
                    block: "counters-table",
                    elem: "body-row"
                }).content({
                    elem: "cell-restore",
                    tag: "td",
                    attrs: {
                        colspan: 9
                    },
                    mix: [{
                        block: "counters-table",
                        elem: "body-cell"
                    }],
                    content: e.content()
                }, !0)
            }
        }
    }), BEM.DOM.decl("counters-table", {
        onSetMod: {
            js: function() {
                BN("counter-restore").on("restore", this._onCounterRestore, this), BN("counter-delete").on("deleted", this._onCounterDelete, this), BN("counter-grant-unsubscribe").on("unsubscribe", this._onCounterUnsubscribe, this)
            }
        },
        destruct: function() {
            return BN("counter-restore").un("restore", this._onCounterRestore, this), BN("counter-delete").un("deleted", this._onCounterDelete, this), BN("counter-grant-unsubscribe").un("unsubscribe", this._onCounterUnsubscribe, this), this.__base.apply(this, arguments)
        },
        _onCounterRestore: function(e, t) {
            var i = t.counterId,
                n = this.findElem("body-row", "counter", i),
                o = this.findElem("restore-row", "counter", i);
            this.delMod(n, "hide"), BEM.DOM.destruct(o)
        },
        _onCounterDelete: function(e, t) {
            var i = this,
                n = t.counterId,
                o = this.findElem("body-row", "counter", n);
            i.hasMod(o, "hide", "yes") || BEM.blocks["i-content"].html({
                block: "counters-table",
                elem: "restore-row",
                mods: {
                    counter: n
                },
                content: [BEM.I18N("counters-table", "counter-deleted", {
                    id: n
                }), {
                    block: "counter-restore",
                    mix: [{
                        block: "counters-table",
                        elem: "counter-restore"
                    }],
                    hint: !1,
                    counter: {
                        id: n
                    }
                }]
            }).then(function(e) {
                i.setMod(o, "hide", "yes"), BEM.DOM.before(o, e)
            }).done()
        },
        _onCounterUnsubscribe: function(e, t) {
            this.findElem("body-row", "counter", t.cid).remove()
        }
    }), BEM.DOM.decl("counter-delete", {
        _deleteCounter: function() {
            BN("i-counters-api")["delete"](this.params.counterId).then(function() {
                this.trigger("deleted", {
                    counterId: this.params.counterId
                })
            }.bind(this), function(e) {
                BN("error-message").showError(this, e)
            }.bind(this)).done()
        }
    }, {
        live: function() {
            this.liveBindTo("click", function() {
                this._deleteCounter()
            })
        }
    }), BEM.JSON.decl("counter-activity", {
        onBlock: function(e) {
            var t, i, n = e.params(),
                o = n.stats,
                s = n.type;
            return o ? (t = o.today[s], i = BN("counter-activity").getPercents(o.delta, s), void 0 === t ? void e.content({
                elem: "changes",
                tag: "span",
                content: BEM.I18N("counter-activity", "undefined")
            }) : void e.content([{
                elem: "value",
                content: BN("humanize").format("int", t)
            }, {
                elem: "changes",
                tag: "span",
                attrs: {
                    title: BEM.I18N("counter-activity", "activity-title")
                },
                mods: {
                    changes: i >= 0 ? "increase" : "decrease"
                },
                content: i ? BN("humanize").format("percents", i) : ""
            }])) : e.remove()
        }
    }), BEM.decl("counter-activity", null, {
        MIN_LIMIT: 10,
        CHECK_KEY: "users",
        getPercents: function(e, t) {
            var i = e[this.CHECK_KEY],
                n = e[t],
                o = 0;
            return i[0] > this.MIN_LIMIT && i[1] > this.MIN_LIMIT && (o = 100 * (n[1] - n[0]) / n[0], Math.abs(o) < 1 && (o = 0)), o
        }
    }), BEM.JSON.decl("counter-chosen", {
        onBlock: function(e) {
            var t = e.params().counter;
            t ? e.mix([{
                block: "error-message",
                mods: {
                    type: "popup"
                }
            }]).js({
                cid: t.id
            }).content({
                elem: "icon",
                favorite: t.favorite
            }) : e.mod("hidden", "yes").stop()
        },
        onElem: {
            icon: function(e) {
                var t = e.param("favorite");
                e.wrap([{
                    block: "icon",
                    elem: "star",
                    mods: {
                        type: t ? "filled" : "empty"
                    },
                    mix: [{
                        block: "counter-chosen",
                        elem: "star-icon"
                    }],
                    title: BEM.I18N("counter-chosen", t ? "remove-title" : "add-title")
                }])
            }
        }
    }), BEM.DOM.decl("counter-chosen", {
        _isFavorite: void 0,
        onSetMod: {
            js: function() {
                this._icon = this.findBlockOn(this.elem("star-icon"), "icon"), this._isFavorite = this._icon.hasMod(this._icon.elem("star"), "type", "filled"), this.bindTo("click", this._changeState), BEM.blocks["counter-chosen"].on("choose", this._handleStateChanging, this)
            }
        },
        destruct: function() {
            BEM.blocks["counter-chosen"].un("choose", this._handleStateChanging, this), this.__base.apply(this, arguments)
        },
        _changeState: function() {
            var e = this,
                t = BEM.MODEL.getOne({
                    name: "m-counter-labels",
                    id: this.params.cid
                }),
                i = !this._isFavorite,
                n = i ? t.add("chosen") : t.remove("chosen");
            n.then(function() {
                BN("error-message").hideError(e)
            }).fail(function(t) {
                BN("error-message").showError(e, t.valueOf())
            })
        },
        _handleStateChanging: function(e, t) {
            this.params.cid === t.id && t.favorite !== this._isFavorite && (BN("i-content").update(this.domElem, {
                block: "counter-chosen",
                elem: "icon",
                favorite: t.favorite
            }), this._isFavorite = t.favorite)
        }
    }), BEM.JSON.decl({
        name: "icon",
        modName: "type",
        modVal: "favicon"
    }, {
        onBlock: function(e) {
            e.js(!1).attr("style", 'background-image: url("//favicon.yandex.net/favicon/' + BN("i-string").escapeHTML(e.params().domain) + '/")').stop()
        }
    }),
    function() {
        var e = 55;
        BEM.DOM.decl({
            name: "icon",
            modName: "type",
            modVal: "favicon"
        }, {
            onSetMod: {
                js: function() {
                    this.__self.push(this)
                }
            },
            setBackground: function(e) {
                e && !this._isDestructing ? this.domElem.css({
                    "background-image": "url(data:image/png;base64," + e + ")"
                }) : this.destruct()
            }
        }, {
            push: function(e) {
                var t = e.params.domain;
                this._domainsToFavicons || (this._domainsToFavicons = {}), this._domainsToFavicons[t] || (this._domainsToFavicons[t] = !1), this._faviconBlocks || (this._faviconBlocks = {}), this._faviconBlocks[t] || (this._faviconBlocks[t] = []), this._faviconBlocks[t].push(e), this.updateFavicons()
            },
            updateFavicons: $.debounce(function() {
                for (var t, i = this, n = [], o = Object.keys(this._domainsToFavicons).filter(function(e) {
                        return !i._domainsToFavicons[e]
                    }); o.length;) {
                    t = o.splice(0, e);
                    var s = "//favicon.yandex.net/favicon/" + t.join("/") + "?jsonp=",
                        r = ["favicon", Date.now(), $.identify()].join("_");
                    this[r] = this._callback.bind(this, t), n.push($.ajax({
                        url: s + "BEM.blocks.icon." + r
                    }))
                }
                $.when.apply($, n).always(function() {
                    Object.keys(i._faviconBlocks).forEach(function(e) {
                        i._faviconBlocks[e].forEach(function(t) {
                            t.setBackground(i._domainsToFavicons[e])
                        })
                    }), i._faviconBlocks = {}
                })
            }, 0, !1),
            _callback: function(e, t) {
                t.forEach(function(t, i) {
                    this._domainsToFavicons[e[i]] = t
                }, this)
            }
        })
    }(), BEM.JSON.decl("counter-grants-editor", {
        onBlock: function(e) {
            var t = e.param("counter"),
                i = t.userGrants && t.userGrants.length || 0,
                n = t.id;
            ["own", "edit"].indexOf(t.permission) >= 0 && e.js({
                cid: n
            }).content({
                block: "button",
                attrs: {
                    autocomplete: "off"
                },
                mods: {
                    pseudo: "yes",
                    size: "s"
                },
                mix: [{
                    block: "counter-grants-editor",
                    elem: "button"
                }, {
                    block: "error-message",
                    mods: {
                        type: "popup"
                    },
                    js: {
                        directions: {
                            to: "left",
                            axis: "middle"
                        }
                    }
                }],
                content: [{
                    tag: "span",
                    content: BEM.I18N("counter-grants-editor", "grants")
                }, {
                    block: "counter-grants-editor",
                    elem: "button-counter",
                    tag: "span",
                    content: i
                }]
            })
        }
    }), BEM.DOM.decl("counter-grants-editor", null, {
        live: function() {
            this.liveBindTo("button", "click", function(e) {
                var t = e.data.domElem,
                    i = this.findBlockOn(t, "button"),
                    n = BN("counter-grants-popup").show(i, this.params.cid),
                    o = this.findElem("button-counter");
                i.delMod("focused").setMod("disabled", "yes"), n.onFirst("hide", function() {
                    i.delMod("disabled"), n.un("count")
                }).on("count", function(e, t) {
                    o.text(t.count)
                })
            })
        }
    }), BEM.JSON.decl("counter-grants-popup", {
        onElem: {
            load: function(e) {
                e.content({
                    block: "spin2",
                    mods: {
                        size: "xxs",
                        progress: "yes"
                    },
                    mix: [{
                        block: "counter-grants-popup",
                        elem: "spin"
                    }]
                })
            }
        }
    }), BEM.DOM.decl("counter-grants-popup", {
        onSetMod: {
            js: function() {
                this._popup = this.findBlockInside("popup"), this._popup.on("show", this.trigger.bind(this, "show")), this._popup.on("hide", this.trigger.bind(this, "hide"))
            }
        },
        show: function(e, t) {
            this._target = e, this.setMod("loading", "yes"), this._renderLoader(), this._popup.show(e), BN("counter-grants").getHtml(t).then(this._showGrants.bind(this)).fail(this._showError.bind(this)).done()
        },
        _showGrants: function(e) {
            var t = this._popup;
            this.setMod("preshow", "yes"), setTimeout(function() {
                this.delMod("loading"), t.setContent(e), this.delMod("preshow"), t.findBlockInside("counter-grants").on("count", this.trigger.bind(this))
            }.bind(this), 200)
        },
        _showError: function(e) {
            this._popup.setMod("visibility", "hidden"), BN("error-message").showError(this._target, e).done()
        },
        _renderLoader: function() {
            this._popup.setContent(BN("i-content").html({
                block: "counter-grants-popup",
                elem: "load"
            }, !0))
        }
    }, {
        _popup: null,
        show: function(e, t) {
            var i = this._getPopup();
            return i.show(e, t), i
        },
        _getPopup: function() {
            var e = this._popup;
            return e || (e = jQuery(BN("i-content").html({
                block: "popup",
                mix: [{
                    block: "counter-grants-popup"
                }],
                mods: {
                    adaptive: "yes"
                },
                js: {
                    directions: {
                        to: "left",
                        axis: "top",
                        offset: {
                            top: -10
                        }
                    },
                    tail: {
                        axis: "top"
                    }
                },
                content: [{
                    elem: "close"
                }, {
                    elem: "tail"
                }, {
                    elem: "content",
                    mix: {
                        block: "counter-grants-popup",
                        elem: "content"
                    }
                }]
            }, !0)).bem("popup"), this._popup = e = e.findBlockInside("counter-grants-popup")), e
        }
    }), BEM.JSON.decl("counter-grants", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.counter.id,
                n = t.userGrants,
                o = Boolean(t.publicGrant),
                s = Boolean(t.counter.code_options && t.counter.code_options.informer && t.counter.code_options.informer.enabled);
            0 === n.length && e.mod("empty", "yes"), e.js({
                cid: i
            }).content([{
                elem: "head"
            }, {
                block: "counter-grant-form",
                mix: [{
                    block: "counter-grants",
                    elem: "create-new"
                }],
                cid: i
            }, {
                elem: "content",
                content: {
                    elem: "list",
                    grants: n,
                    cid: i
                }
            }, {
                elem: "message-empty",
                content: BEM.I18N("counter-grants", "empty-list")
            }, {
                elem: "checkboxes",
                isPublic: o,
                isInformer: s
            }])
        },
        onElem: {
            head: function(e) {
                e.content([{
                    elem: "head-title",
                    tag: "span",
                    content: BEM.I18N("counter-grants", "counter-access")
                }, {
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        "only-icon": "yes",
                        size: "s"
                    },
                    attrs: {
                        title: BEM.I18N("counter-grants", "button-create"),
                        tabindex: -1
                    },
                    mix: [{
                        block: "counter-grants",
                        elem: "button-plus"
                    }],
                    content: {
                        block: "icon",
                        elem: "plus",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }
                }])
            },
            list: function(e) {
                var t, i = e.param("grants"),
                    n = e.param("cid");
                t = i.map(function(e) {
                    return {
                        elem: "item",
                        access: e,
                        cid: n
                    }
                }), e.tag("ol").content(t)
            },
            item: function(e) {
                var t = e.param("access"),
                    i = e.param("cid"),
                    n = [];
                n.push({
                    elem: "item-data",
                    cid: i,
                    access: t
                }, {
                    block: "counter-grant-form",
                    mix: [{
                        block: "counter-grants",
                        elem: "item-form"
                    }],
                    cid: i,
                    access: t
                }), t.currentUser || n.push({
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        "only-icon": "yes",
                        size: "s"
                    },
                    mix: [{
                        block: "counter-grants",
                        elem: "item-edit",
                        js: {
                            cid: i,
                            login: t.user_login
                        }
                    }],
                    attrs: {
                        title: BEM.I18N("counter-grants", "button-edit")
                    },
                    content: {
                        block: "icon",
                        elem: "edit",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }
                }), e.mod("cid" + i, BEM.toModVal(t.user_login)).tag("li").content(n)
            },
            "item-data": function(e) {
                var t = e.param("access"),
                    i = e.param("cid"),
                    n = [],
                    o = {
                        elem: "item-title",
                        content: t.user_login
                    };
                t.currentUser && (o.mods = {
                    "current-user": "yes"
                }), n.push(o), t.comment && n.push({
                    elem: "item-comment",
                    content: BN("i-string").escapeHTML(t.comment)
                }), n.push({
                    elem: "item-date",
                    content: BN("i-date").create(t.created_at).format("d.m.Y G:i")
                }, {
                    elem: "item-permissions",
                    content: BEM.I18N("counter-grants", "permission-" + t.perm)
                }), t.currentUser || n.push({
                    block: "counter-grant-delete",
                    mix: [{
                        block: "counter-grants",
                        elem: "item-delete"
                    }],
                    cid: i,
                    access: t
                }), e.mod("cid" + i, BEM.toModVal(t.user_login)).content(n)
            },
            checkboxes: function(e) {
                e.content([this.getCheckboxTemplate({
                    type: "public",
                    checked: e.param("isPublic"),
                    label: "public-access",
                    hint: "public-access-hint"
                }), this.getCheckboxTemplate({
                    type: "informer",
                    checked: e.param("isInformer"),
                    label: "enable-informer",
                    hint: "informer-hint"
                })])
            }
        },
        getCheckboxTemplate: function(e) {
            return {
                content: [{
                    block: "checkbox",
                    mods: {
                        size: "s",
                        checked: e.checked ? "yes" : ""
                    },
                    mix: [{
                        block: "counter-grants",
                        elem: "checkbox",
                        mods: {
                            type: e.type
                        }
                    }],
                    checkboxAttrs: {
                        autocomplete: "off"
                    },
                    content: [{
                        elem: "label",
                        content: BEM.I18N("counter-grants", e.label)
                    }, {
                        block: "spin2",
                        mix: [{
                            block: "counter-grants",
                            elem: "checkbox-spin"
                        }],
                        mods: {
                            size: "xxs",
                            progress: "yes"
                        }
                    }]
                }, {
                    block: "hint-icon",
                    text: BEM.I18N("counter-grants", e.hint),
                    mix: [{
                        block: "counter-grants",
                        elem: "checkbox-hint"
                    }]
                }]
            }
        }
    }), BEM.DOM.decl("counter-grants", {
        onSetMod: {
            js: function() {
                this._selectsContainer = this.elem("content"), BN("counter-grants").on("count", this._updateSelectsCache.bind(this)), this.bindTo(this._selectsContainer, "scroll", jQuery.throttle(this._closeOpenedSelects.bind(this), 20)), this._updateSelectsCache(), this._public = this.findBlockOn(this.findElem("checkbox", "type", "public"), "checkbox"), this._informer = this.findBlockOn(this.findElem("checkbox", "type", "informer"), "checkbox"), this._public.on("change", this._onPublicChange.bind(this)), this._informer.on("change", this._onInformerChange.bind(this))
            }
        },
        _updateSelectsCache: function() {
            this._selects = this.findBlocksInside(this._selectsContainer, "select")
        },
        _closeOpenedSelects: function() {
            this._selects.forEach(function(e) {
                e.close()
            })
        },
        _onPublicChange: function() {
            this._onCheckboxChange(this._public, BN("i-counters-api").setCounterPublicGrantEnabled(this.params.cid, this._public.isChecked()))
        },
        _onInformerChange: function() {
            this._onCheckboxChange(this._informer, BN("i-counters-api").setCounterInformerEnabled(this.params.cid, this._informer.isChecked()))
        },
        _onCheckboxChange: function(e, t) {
            e.setMod("disabled", "yes"), this.setMod(e.domElem, "saving", "yes"), t.always(function(t) {
                return e.delMod("disabled"), this.delMod(e.domElem, "saving"), t
            }.bind(this)).done()
        },
        _onPlusClick: function(e) {
            var t = this.elemify(e.target),
                i = this.findBlockInside("counter-grant-form");
            this.hasMod("creation") ? this.delMod("creation").delMod(t, "active") : (this.setMod("creation", "yes").setMod(t, "active", "yes"), i.focus())
        },
        _onEditClick: function(e) {
            var t = this.elemify(e.target),
                i = this.elemParams(t),
                n = this.findElem("item", "cid" + i.cid, BEM.toModVal(i.login));
            this.hasMod(n, "edit") ? this.delMod(n, "edit").delMod(t, "active") : this.setMod(n, "edit", "yes").setMod(t, "active", "yes")
        },
        _onGrantDelete: function(e, t) {
            var i = this.findElem("item", "cid" + t.cid, BEM.toModVal(t.login));
            BEM.DOM.destruct(i), this._triggerChange.call(this, this.params.cid)
        },
        _onGrantCreate: function(e, t) {
            BN("i-content").prepend(this.findElem("list"), {
                block: "counter-grants",
                elem: "item",
                access: t,
                cid: this.params.cid
            }).then(this._triggerChange.bind(this, this.params.cid)).done()
        },
        _onGrantChange: function(e, t) {
            var i = this.params.cid,
                n = this.findElem("item-data", "cid" + i, BEM.toModVal(t.user_login));
            BN("i-content").replace(n, {
                block: "counter-grants",
                elem: "item-data",
                access: t,
                cid: i
            }).done()
        },
        _triggerChange: function(e) {
            var t = this.findElem("item").length;
            0 === t ? this.setMod("empty", "yes") : this.delMod("empty"), this.trigger("count", {
                cid: e,
                count: t
            })
        }
    }, {
        live: function() {
            this.liveBindTo("button-plus", "click", function() {
                this._onPlusClick.apply(this, arguments)
            }), this.liveBindTo("item-edit", "click", function() {
                this._onEditClick.apply(this, arguments)
            }), this.liveInitOnBlockInsideEvent("delete", "counter-grant-delete", function() {
                this._onGrantDelete.apply(this, arguments)
            }), this.liveInitOnBlockInsideEvent("create", "counter-grant-form", function() {
                this._onGrantCreate.apply(this, arguments)
            }), this.liveInitOnBlockInsideEvent("change", "counter-grant-form", function() {
                this._onGrantChange.apply(this, arguments)
            })
        },
        getHtml: function(e) {
            var t = BN("i-counters-api");
            return Vow.all([t.getCounterUserGrants(e), t.getCounterPublicGrant(e), t.byId(e)]).spread(function(e, t, i) {
                return BN("i-content").html({
                    block: "counter-grants",
                    counter: i,
                    userGrants: e,
                    publicGrant: t
                })
            })
        },
        getUserGrantPermissions: function() {
            return ["view", "edit"]
        },
        getPublicGrantPermission: function() {
            return "public_stat"
        }
    }), BEM.JSON.decl("counter-grant-form", {
        onBlock: function(e) {
            var t = e.param("cid"),
                i = e.param("access");
            i && e.mod("mode", "edit"), e.js({
                cid: t
            }).content({
                elem: "content",
                access: i
            })
        },
        onElem: {
            content: function(e) {
                var t = e.param("access") || {
                    user_login: "",
                    perm: "",
                    comment: ""
                };
                e.content([{
                    block: "input",
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "counter-grant-form",
                        elem: "input",
                        mods: {
                            field: "login"
                        }
                    }],
                    content: [{
                        elem: "hint",
                        content: BEM.I18N("counter-grant-form", "login")
                    }, {
                        elem: "control",
                        attrs: {
                            value: t.user_login
                        }
                    }]
                }, {
                    block: "input",
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "counter-grant-form",
                        elem: "input",
                        mods: {
                            field: "comment"
                        }
                    }],
                    content: [{
                        elem: "hint",
                        content: BEM.I18N("counter-grant-form", "comment")
                    }, {
                        elem: "control",
                        attrs: {
                            value: t.comment
                        }
                    }]
                }, {
                    elem: "permissions",
                    access: t
                }, {
                    elem: "buttons"
                }, {
                    block: "label-tag",
                    mix: {
                        block: "counter-grant-form",
                        elem: "label-tag"
                    },
                    mods: {
                        removable: "yes",
                        status: "none"
                    }
                }])
            },
            buttons: function(e) {
                e.wrap([{
                    elem: "save-button",
                    "button-i18n": "button-add"
                }])
            },
            "save-button": function(e) {
                e.content([{
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        size: "s",
                        theme: "action"
                    },
                    mix: [{
                        block: "counter-grant-form",
                        elem: "button"
                    }],
                    content: BEM.I18N("counter-grant-form", e.param("button-i18n"))
                }, {
                    block: "spin2",
                    mix: [{
                        block: "counter-grant-form",
                        elem: "spinner"
                    }],
                    mods: {
                        size: "xxs",
                        progress: "yes"
                    }
                }])
            },
            permissions: function(e) {
                var t = e.param("access"),
                    i = BN("counter-grants").getUserGrantPermissions();
                e.content({
                    block: "select",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    mix: [{
                        block: "counter-grant-form",
                        elem: "select"
                    }],
                    content: [{
                        block: "button",
                        content: BEM.I18N("counter-grants", "permission-" + i[0])
                    }, {
                        elem: "control",
                        content: i.map(function(e) {
                            var i = {
                                value: e
                            };
                            return e === t.perm && (i.selected = "selected"), {
                                elem: "option",
                                attrs: i,
                                content: BEM.I18N("counter-grants", "permission-" + e)
                            }
                        })
                    }]
                })
            }
        }
    }), BEM.DOM.decl("counter-grant-form", {
        onSetMod: {
            js: function() {
                this._grantEvent = "create", this._initFields(), this._subscribeChange(), this._fields.button.on("release", this._saveGrant.bind(this)), this._tag = this.findBlockInside("label-tag"), this._validate()
            }
        },
        focus: function() {
            this._fields.login.focus()
        },
        reset: function() {
            this._inputs.forEach(function(e, t) {
                this._fields[e].val(this._initValues[t])
            }.bind(this))
        },
        _initFields: function() {
            this._fields = {
                login: this.findBlockOn(this.findElem("input", "field", "login"), "input"),
                comment: this.findBlockOn(this.findElem("input", "field", "comment"), "input"),
                permission: this.findBlockInside("select"),
                button: this.findBlockInside(this.findElem("save-button"), "button")
            }, this._inputs = ["login", "comment", "permission"], this._updateInitialValues()
        },
        _updateInitialValues: function() {
            this._initValues = this._inputs.map(function(e) {
                return this._fields[e].val().trim()
            }.bind(this))
        },
        _subscribeChange: function() {
            this._fields.login.on("change", this._validate.bind(this))
        },
        _validate: function() {
            var e = this._fields.login.val().trim();
            this._fields.login.val(e), e.length ? this._fields.button.delMod("disabled") : this._fields.button.setMod("disabled", "yes")
        },
        _saveGrant: function() {
            this._every("setMod", ["disabled", "yes"]), this.setMod("saving", "yes"), this._callApi().then(function(e) {
                this._onSuccessSave(e), this.trigger(this._grantEvent, e)
            }.bind(this)).fail(this._errorHandler.bind(this)).always(function(e) {
                return this._onAlwaysSave(), this.delMod("saving"), e
            }.bind(this)).done()
        },
        _callApi: function() {
            return BN("i-counters-api").createCounterGrant(this.params.cid, {
                user_login: this._fields.login.val(),
                perm: this._fields.permission.val(),
                comment: this._fields.comment.val()
            })
        },
        _onSuccessSave: function() {
            this.reset()
        },
        _onAlwaysSave: function() {
            this._every("delMod", ["disabled"], this._inputs)
        },
        _errorHandler: function(e) {
            var t = BN("i-error-message").getResponseText(e),
                i = this._tag;
            i.setText(t), i.setMod("status", "error"), this.focus(), this._fields.login.onFirst("change", function() {
                i.setMod("status", "none")
            })
        },
        _every: function(e, t, i) {
            var n = this._fields;
            (i || Object.keys(this._fields)).forEach(function(i) {
                n[i][e].apply(n[i], t)
            })
        }
    }), BEM.JSON.decl({
        name: "counter-grant-form",
        modName: "mode",
        modVal: "edit"
    }, {
        onElem: {
            buttons: function(e) {
                e.wrap([{
                    elem: "save-button",
                    "button-i18n": "button-save"
                }, {
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        "only-icon": "yes",
                        size: "s"
                    },
                    mix: [{
                        block: "counter-grant-form",
                        elem: "reset-button"
                    }],
                    attrs: {
                        title: BEM.I18N("counter-grant-form", "button-reset")
                    },
                    content: {
                        block: "icon",
                        elem: "circle-arrow",
                        mods: {
                            color: "black"
                        },
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }
                }]).stop()
            }
        }
    }), BEM.DOM.decl({
        name: "counter-grant-form",
        modName: "mode",
        modVal: "edit"
    }, {
        _initFields: function() {
            this.__base(), this._grantEvent = "change", this._fields.login.setMod("disabled", "yes"), this._resetButton = this.findBlockInside(this.findElem("reset-button"), "button"), this._resetButton.on("click", this.reset.bind(this))
        },
        _subscribeChange: function() {
            this._every("on", ["change", this._validate.bind(this)], ["comment", "permission"])
        },
        _validate: function() {
            var e = this._inputs.every(function(e, t) {
                return this._fields[e].val().trim() === this._initValues[t]
            }.bind(this));
            e ? this._fields.button.setMod("disabled", "yes") : this._fields.button.delMod("disabled")
        },
        _callApi: function() {
            return BN("i-counters-api").changeCounterGrant(this.params.cid, {
                user_login: this._fields.login.val(),
                perm: this._fields.permission.val(),
                comment: this._fields.comment.val()
            })
        },
        _onSuccessSave: function(e) {
            this._fields.comment.val(e.comment), this._fields.permission.val(e.perm), this._updateInitialValues()
        },
        _onAlwaysSave: function() {
            this._every("delMod", ["disabled"], ["comment", "permission"])
        }
    }), BEM.JSON.decl("label-tag", {
        onBlock: function(e) {
            e.js(!0).content([{
                elem: "text",
                content: BN("i-string").escapeHTML(e.param("value"))
            }, {
                block: "icon",
                elem: "cross",
                mods: {
                    color: "white"
                },
                mix: [{
                    block: "label-tag",
                    elem: "tag-close"
                }]
            }])
        }
    }), BEM.DOM.decl("label-tag", {
        onSetMod: {
            js: function() {
                this.elem("tag-close").on("click", function() {
                    this.setMod("status", "none")
                }.bind(this))
            }
        },
        setText: function(e) {
            BEM.DOM.update(this.elem("text"), BN("i-string").escapeHTML(e))
        },
        autoHide: function(e) {
            setTimeout(function() {
                this._isDestructing || this.setMod("status", "none")
            }.bind(this), 1e3 * e)
        }
    }), BEM.JSON.decl("counter-grant-delete", {
        onBlock: function(e) {
            var t = e.param("access"),
                i = e.param("cid");
            e.js({
                cid: i,
                login: t.user_login
            }).content({
                block: "button",
                mods: {
                    pseudo: "yes",
                    "only-icon": "yes",
                    size: "s"
                },
                attrs: {
                    title: BEM.I18N("counter-grant-delete", "button-delete"),
                    tabindex: -1
                },
                mix: [{
                    block: "counter-grant-delete",
                    elem: "item-delete"
                }],
                content: {
                    block: "icon",
                    elem: "trash",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }
            })
        }
    }), BEM.DOM.decl("counter-grant-delete", {
        onSetMod: {
            js: function() {
                this._button = this.findBlockInside("button"), this._button.on("click", this._deleteGrant.bind(this))
            }
        },
        _deleteGrant: function() {
            this._button.setMod("disabled", "yes"), BN("i-counters-api").deleteCounterGrant(this.params.cid, this.params.login).then(function() {
                this.trigger("delete", {
                    cid: this.params.cid,
                    login: this.params.login
                })
            }.bind(this)).done()
        }
    }), BEM.JSON.decl("hint-icon", {
        onBlock: function(e) {
            e.tag("span").mix([{
                block: "hint",
                js: {
                    text: e.params().text
                }
            }, {
                block: "icon",
                elem: "sign-question"
            }, {
                block: "icon"
            }])
        }
    }), BEM.JSON.decl("counter-grant-unsubscribe", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.roles,
                n = t.counter,
                o = t.isUlogined,
                s = "guest" === n.uiType;
            return s && BN("i-user").checkRoles(["manager_direct", "manager"], i) && (s = !o), s ? void e.js({
                cid: n.id,
                name: BN("i-string").escapeHTML(BN("i-counter-single").getName(n))
            }).content({
                block: "button",
                mods: {
                    size: "s",
                    pseudo: "yes"
                },
                mix: [{
                    block: "counter-grant-unsubscribe",
                    elem: "button"
                }],
                content: BEM.I18N("counter-grant-unsubscribe", "unsubscribe")
            }) : e.remove()
        }
    }), BEM.JSON.decl("counter-grant-unsubscribe", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-user").getRoles(), BN("i-user").isUlogined()]).spread(function(t, i) {
                e.params().roles = t, e.params().isUlogined = i
            }))
        }
    }), BEM.DOM.decl("counter-grant-unsubscribe", {
        onSetMod: {
            js: function() {
                this._button = this.findBlockOn(this.findElem("button"), "button"), this._button.on("click", this._onClick, this)
            }
        },
        _onClick: function() {
            var e = this.params.cid,
                t = this.params.name;
            this._button.setMod("disabled", "yes"), BN("confirm-popup").show({
                text: BEM.I18N("counter-grant-unsubscribe", "confirm-unsubscribe", {
                    counterName: t
                }),
                modal: !0,
                fixed: !0
            }).then(function() {
                return BN("i-counters-api").deleteCounterGrant(e)
            }.bind(this)).always(function(t) {
                if (t.isFulfilled()) this.trigger("unsubscribe", {
                    cid: e
                });
                else if (t.valueOf()) return t;
                this._button.delMod("disabled")
            }.bind(this)).done()
        }
    }), BEM.JSON.decl("i-confirm-popup", {
        onElem: {
            "popup-content": function(e) {
                var t = e.param("params"),
                    i = t.validate ? "validate" : "confirm";
                e.mods(t.mods || {}).content([{
                    elem: "text",
                    content: BN("i-string").escapeHTML(t.text) || t.bemJson
                }, {
                    elem: "buttons",
                    content: [{
                        block: "button",
                        mods: {
                            size: "s",
                            action: i,
                            theme: t.confirmTheme || "normal",
                            disabled: t.disabled ? "yes" : ""
                        },
                        mix: [{
                            block: "i-confirm-popup",
                            elem: "button"
                        }],
                        content: BN("i-string").escapeHTML(t.confirmText || BEM.I18N("i-confirm-popup", "confirm-button"))
                    }, {
                        block: "button",
                        mods: {
                            size: "s",
                            action: "cancel"
                        },
                        mix: [{
                            block: "i-confirm-popup",
                            elem: "button"
                        }],
                        content: BN("i-string").escapeHTML(t.cancelText || BEM.I18N("i-confirm-popup", "cancel-button"))
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("i-confirm-popup", {}, {
        show: function(e) {
            var t, i = BN("i-content").html({
                block: "i-confirm-popup",
                elem: "popup-content",
                params: e
            }, !0);
            return this._params = e, t = this._getPopup(), t.hide(), t.setContent(i).show(e.owner), this._confirmPromise = Vow.promise(), this._confirmPromise
        },
        _getPopup: function() {
            var e = BN("i-content").html(this._getPopupJson(), !0),
                t = jQuery(e).bem("popup");
            return BEM.DOM.append(jQuery("body"), e), t.on("hide", function() {
                this._confirmPromise && !this._confirmPromise.isFulfilled() && this._confirmPromise.reject()
            }.bind(this)), this._getPopup = function() {
                return t
            }, t
        },
        getPopup: function() {
            return this._getPopup()
        },
        _getPopupJson: function() {
            var e = this._getJson(),
                t = this._params;
            return t.modal && (e = this._getModalJson(), t.scrollable && (e.mods = jQuery.extend({}, e.mods, {
                wrapped: "yes",
                behaviour: "scrollable",
                "body-scroll": "no"
            }), e.content.push({
                elem: "wrapper",
                mods: {
                    behaviour: "scrollable"
                }
            })), t.fixed && (e.mods.position = "fixed", e.underMods.blocking = "all")), e
        },
        _getJson: function() {
            return {
                block: "popup",
                js: {
                    directions: ["top", "bottom", "left", "right", {
                        to: "top",
                        axis: "right",
                        offset: {
                            right: -10
                        }
                    }]
                },
                mods: {
                    adaptive: "yes"
                },
                content: [{
                    elem: "tail"
                }, {
                    elem: "content"
                }]
            }
        },
        _getModalJson: function() {
            return {
                block: "popup",
                mods: {
                    type: "modal",
                    autoclosable: "no"
                },
                underMods: {
                    type: "paranja"
                },
                content: [{
                    elem: "content"
                }]
            }
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "wrapped",
        modVal: "yes"
    }, {
        onSetMod: {
            visibility: {
                visible: function() {
                    this.__base(), this._wrap()
                },
                "": function() {
                    this.__base(), this._unwrap()
                }
            },
            wrapped: {
                "": function() {
                    this._unwrap()
                }
            }
        },
        _wrap: function() {
            this._wrapper || (this._wrapper = this.elem("wrapper").detach()), this._wrapper && this.domElem.wrap(this._wrapper)
        },
        _unwrap: function() {
            this._wrapper && this.domElem.unwrap()
        },
        destruct: function() {
            this._unwrap(), this.__base()
        }
    }), BEM.DOM.decl({
        block: "popup",
        modName: "behaviour",
        modVal: "scrollable"
    }, {
        getDefaultParams: function() {
            var e = this.__base();
            return e.top = 20, e
        }
    }), BEM.DOM.decl({
        block: "confirm-popup",
        baseBlock: "i-confirm-popup"
    }, {}, {
        _getPopupJson: function() {
            var e = this.__base.call(this);
            return e.mix = [{
                block: "confirm-popup",
                js: !0
            }, {
                block: "i-confirm-popup"
            }], e
        },
        live: function() {
            this.liveInitOnBlockInsideEvent("press", "button", function(e) {
                var t = e.block.getMod("action");
                "confirm" === t && this.__self._confirmPromise.fulfill(), this.__self._getPopup().hide()
            })
        }
    }), BEM.JSON.decl("counters-labels", {
        onElem: {
            labels: function(e) {
                var t = e.blockParam("counter");
                e.content([{
                    elem: "edit",
                    content: {
                        block: "button",
                        mods: {
                            pseudo: "yes",
                            "only-icon": "yes",
                            size: "s"
                        },
                        mix: [{
                            block: "counters-labels",
                            elem: "edit-button",
                            js: {
                                id: t.id
                            }
                        }],
                        content: {
                            block: "icon",
                            elem: "edit",
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }]
                        }
                    }
                }, {
                    block: "counter-label-list",
                    mix: [{
                        block: "counters-labels",
                        elem: "list"
                    }],
                    labels: t.labels,
                    counterId: t.id
                }])
            },
            "edit-popup": function(e) {
                e.content({
                    block: "popup",
                    js: {
                        directions: {
                            axis: "left",
                            to: "bottom",
                            tail: {
                                axis: "center"
                            },
                            offset: {
                                bottom: -5
                            }
                        }
                    },
                    content: [{
                        elem: "content",
                        mix: [{
                            block: "counters-labels",
                            elem: "edit-popup-content"
                        }],
                        content: {
                            block: "counter-labels-edit",
                            labels: e.blockParam("labels")
                        }
                    }]
                })
            }
        }
    }), BEM.DOM.decl("counters-labels", {
        onSetMod: {
            js: function() {
                var e = this.__self._popup,
                    t = this.__self._editLabelsBlock;
                e && t || (e = this.__self._popup = this.findBlockInside("popup"), t = this.__self._editLabelsBlock = this.findBlockInside("counter-labels-edit"), t.on("saved", this._onSaved, this), e.on("hide", this._onPopupHide, this)), BN("button").on(this.elem("edit-button"), "click", function(i) {
                    var n = this.elemParams(this.elemify(i.block.domElem, "edit-button"));
                    t.show(n.id), e.toggle(i.block.domElem)
                }, this)
            }
        },
        destruct: function() {
            this.__self._editLabelsBlock.un("saved", this._onSaved, this), this.__self._popup.on("hide", this._onPopupHide, this), this.__base.apply(this, arguments)
        },
        _onPopupHide: function() {
            var e = BEM.MODEL.getOne("m-labels");
            e.get("labels").forEach(function(e) {
                e.isNew() && e.destruct()
            }), e.trigger("rollback")
        },
        _onSaved: function() {
            this.__self._popup.hide()
        }
    }), BEM.JSON.decl("counter-labels-edit", {
        onBlock: function(e) {
            var t = e.param("labels");
            e.content([{
                block: "add-label",
                mix: [{
                    block: "counter-labels-edit",
                    elem: "add-label"
                }, {
                    block: "error-message",
                    mods: {
                        type: "popup"
                    },
                    js: {
                        directions: {
                            to: "right",
                            axis: "middle"
                        }
                    }
                }]
            }, {
                elem: "labels",
                labels: BN("i-labels").sortLabelsUsersFirst(t.slice())
            }, {
                elem: "save",
                content: {
                    block: "button",
                    mods: {
                        theme: "action",
                        size: "m"
                    },
                    mix: [{
                        block: "counter-labels-edit",
                        elem: "save-button"
                    }, {
                        block: "error-message",
                        mods: {
                            type: "popup"
                        },
                        js: {
                            directions: {
                                to: "right",
                                axis: "middle"
                            }
                        }
                    }],
                    content: BEM.I18N("counter-labels-edit", "save")
                }
            }, {
                block: "wait",
                mods: {
                    theme: "white"
                },
                mix: {
                    block: "counter-labels-edit",
                    elem: "wait"
                }
            }])
        },
        onElem: {
            labels: function(e) {
                var t = e.param("labels") || [];
                e.tag("ul").content(t.filter(function(e) {
                    return "deleted" !== e.id && "all" !== e.id
                }).map(function(e) {
                    return {
                        elem: "label",
                        label: e
                    }
                }))
            },
            label: function(e) {
                var t = e.param("label");
                e.mix([{
                    block: "i-glue",
                    js: {
                        modelName: "m-label",
                        modelId: t.id
                    }
                }]).tag("li").mix({
                    block: "error-message",
                    mods: {
                        type: "popup"
                    },
                    js: {
                        directions: {
                            to: "right",
                            axis: "middle"
                        }
                    }
                }).mods({
                    id: t.id
                }).content({
                    block: "checkbox",
                    mix: [{
                        block: "counter-labels-edit",
                        elem: "label-checkbox",
                        mods: {
                            id: t.id
                        }
                    }],
                    mods: {
                        size: "m",
                        disabled: t.system && "chosen" !== t.id ? "yes" : ""
                    },
                    content: {
                        elem: "label",
                        content: {
                            block: "counter-labels-edit",
                            elem: "label-name-container",
                            content: {
                                block: "counter-labels-edit",
                                elem: "label-name",
                                tag: "span",
                                mix: [{
                                    block: "i-glue",
                                    elem: "model-field",
                                    js: {
                                        name: "name",
                                        type: "inline"
                                    }
                                }, {
                                    block: "hint-hover",
                                    js: {
                                        widthLimiter: ".counter-labels-edit__label"
                                    }
                                }],
                                content: BN("i-string").escapeHTML(t.name)
                            }
                        }
                    }
                })
            }
        }
    }), BEM.DOM.decl("counter-labels-edit", {
        onSetMod: {
            js: function() {
                this._labelsModel = BEM.MODEL.getOne("m-labels"), this._labelsModel.on("labels", "add", this._onAddLabel, this), this._saveButton = this.findBlockOn("save-button", "button"), this._addLabel = this.findBlockOn("add-label", "add-label"), this._waitBlock = this.findBlockOn("wait", "wait"), this._saveButton.on("click", this.save, this), this._addLabel.on("save", this._onSaveNewLabel, this).on("change", this._onChangeNewLabelText, this), BN("checkbox").on(this.domElem, "change", this._onChangeLabelCheckbox, this)
            }
        },
        show: function(e) {
            this.delMod("editable"), this._model = BEM.MODEL.getOne({
                name: "m-counter-labels",
                id: e
            }), BN("i-content").replace(this.findElem("labels"), {
                block: "counter-labels-edit",
                elem: "labels",
                labels: BN("i-labels").sortLabelsUsersFirst(this._labelsModel.toJSON().labels.slice())
            }).then(function() {
                this._model.get("labels").forEach(function(e) {
                    var t = this._getCheckboxById(e.id);
                    this._setCheckboxState(t, !0)
                }, this), this._changes = [], this._labelsErrors = [], this._addLabel.close(), this._saveButton.setMod("disabled", "yes"), this._addedLabel = !1, this.afterCurrentEvent(function() {
                    this.setMod("editable", "yes")
                }, this)
            }.bind(this))
        },
        save: function() {
            var e = this._model,
                t = [],
                i = [this._model, this._labelsModel];
            this.delMod("editable"), this._waitBlock.show(), this._labelsModel.save().then(function() {
                return this._changes.forEach(function(n) {
                    var o = this._getCheckboxById(n).isChecked(),
                        s = BEM.MODEL.getOne({
                            name: "m-label",
                            id: n
                        });
                    i.push(s), t.push(o ? e.add(n) : e.remove(n))
                }, this), Vow.all(t).then(function() {
                    i.forEach(function(e) {
                        e.fix()
                    }), this.trigger("saved")
                }.bind(this))
            }.bind(this)).fail(function(e) {
                BN("error-message").showError(this._saveButton, e || "ERR_LABEL_REQUEST_FAILED")
            }.bind(this)).always(function() {
                this._waitBlock.hide(), this.setMod("editable", "yes")
            }.bind(this))
        },
        destruct: function() {
            return this._labelsModel.un("labels", "add", this._onAddLabel, this), this.__base.apply(this, arguments)
        },
        _onSaveNewLabel: function(e, t) {
            return "" === t ? this._addLabel.close() : (this._addLabel.close(), void("" !== t && this._labelsModel.get("labels").add({
                id: $.identify(),
                name: t
            })))
        },
        _onChangeNewLabelText: function(e, t) {
            this._labelsModel.isExistsLabelWithName(t) ? (this._addLabel.setMod("can-save", "no"), BN("error-message").showError(this._addLabel, "ERR_LABEL_DUPLICATE_NAME")) : (this._addLabel.delMod("can-save"), BN("error-message").hideError(this._addLabel))
        },
        _onAddLabel: function(e, t) {
            return this.hasMod("editable", "yes") ? void BN("i-content").prepend(this.findElem("labels"), {
                block: "counter-labels-edit",
                mods: {
                    "just-created": "yes"
                },
                elem: "label",
                label: t.model.toJSON()
            }).then(function() {
                var e = this._getCheckboxById(t.model.id),
                    i = this.findElem("label", "id", t.model.id);
                this.elem("labels").animate({
                    scrollTop: 0
                }, 200), this.delMod(i, "just-created"), e.setMod("checked", "yes"), t.model.on("replace", function(t, i) {
                    var n = this._changes.indexOf(i.oldModel.id);
                    this.setMod(e.domElem, "id", i.newModel.id), -1 !== n && this._changes.splice(n, 1, i.newModel.id)
                }, this), this._addedLabel = !0
            }.bind(this)) : !0
        },
        _onChangeLabelCheckbox: function(e) {
            if (!this.hasMod("editable", "yes")) return !0;
            var t, i, n, o, s, r = this.getMod(e.block.domElem, "id"),
                a = this._changes.indexOf(r); - 1 === a ? this._changes.push(r) : this._changes.splice(a, 1), e.block.isChecked() && -1 === a && (t = BEM.MODEL.getOne({
                name: "m-label",
                id: r
            }), (i = t.checkNumCountersLimit()) && (this._labelsErrors.push(r), n = e.block.domElem.closest(this.buildSelector("label")), o = this.findBlockOn(n, "error-message"), BN("error-message").showError(o, i), e.block.onFirst("change", function() {
                var e = this._labelsErrors.indexOf(r); - 1 !== e && (BN("error-message").hideError(o), this._labelsErrors.splice(e, 1))
            }, this))), s = 0 !== this._labelsErrors.length || 0 === this._changes.length && !this._addedLabel, this._saveButton.toggleMod("disabled", "yes", s)
        },
        _getCheckboxById: function(e) {
            return this.findBlockOn(this.findElem("label-checkbox", "id", e), "checkbox")
        },
        _setCheckboxState: function(e, t) {
            var i = e.isDisabled();
            i && e.delMod("disabled"), e.setMod("checked", t ? "yes" : ""), i && e.setMod("disabled", "yes")
        }
    }), BEM.JSON.decl("counter-label-list", {
        onBlock: function(e) {
            var t = e.param("counterId"),
                i = e.param("labels");
            e.content({
                elem: "list",
                labels: i
            }).js({
                counterId: t
            })
        },
        onElem: {
            list: function(e) {
                var t = e.param("labels");
                e.tag("ul").mix({
                    block: "hint-hover",
                    js: {
                        widthLimiter: ".counter-label-list"
                    }
                }).content(t.map(function(e, t) {
                    return [t ? ", " : "", {
                        elem: "item",
                        mix: [{
                            block: "i-glue",
                            js: {
                                modelName: "m-label",
                                modelId: e.id
                            }
                        }],
                        tag: "li",
                        content: {
                            tag: "span",
                            elem: "item-name",
                            mix: [{
                                block: "i-glue",
                                elem: "model-field",
                                js: {
                                    name: "name",
                                    type: "inline"
                                }
                            }],
                            content: BN("i-string").escapeHTML(e.name)
                        }
                    }]
                }))
            }
        }
    }), BEM.DOM.decl("counter-label-list", {
        onSetMod: {
            js: function() {
                this._model = BEM.MODEL.getOne({
                    name: "m-counter-labels",
                    id: this.params.counterId
                }), this._onModelChangeCallback = $.debounce(this._onModelChange, 0, !1, this), this._model.on("change", this._onModelChangeCallback)
            }
        },
        _onModelChange: function() {
            BEM.DOM.update(this.domElem, BN("i-content").html({
                block: "counter-label-list",
                elem: "list",
                labels: this._model.toJSON().labels
            }, !0))
        },
        destruct: function() {
            this._model.un("change", this._onModelChangeCallback), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl({
        name: "counters-table",
        modName: "type",
        modVal: "all"
    }, {
        onElem: {
            "cell-title": function(e) {
                var t = e.params().counter,
                    i = "partner" === t.uiType,
                    n = "guest" === t.uiType;
                (i || n) && (e.content([{
                    elem: "counter-title",
                    counter: t
                }, {
                    elem: "counter-info",
                    counter: t
                }, i && {
                    elem: "partner-info",
                    counter: t
                }, n && {
                    elem: "owner-info",
                    counter: t
                }, {
                    block: "infected-hint",
                    counter: t
                }]), i && e.stop())
            }
        }
    }), BEM.JSON.decl({
        name: "counters-table",
        modName: "type",
        modVal: "chosen"
    }, {
        onElem: {
            "cell-title": function(e) {
                var t = e.params().counter,
                    i = [];
                i.push({
                    elem: "counter-title",
                    counter: t
                }, {
                    elem: "counter-info",
                    counter: t
                }), "guest" === t.uiType ? i.push({
                    elem: "owner-info",
                    counter: t
                }) : "partner" === t.uiType && i.push({
                    elem: "partner-info",
                    counter: t
                }), i.push({
                    block: "infected-hint",
                    counter: t
                }), e.content(i)
            }
        }
    }), BEM.JSON.decl({
        name: "counters-table",
        modName: "type",
        modVal: "deleted"
    }, {
        onElem: {
            head: function(e) {
                e.tag("thead").content({
                    elem: "head-row",
                    content: [{
                        elem: "head-cell",
                        type: "name",
                        label: !0
                    }, {
                        elem: "head-cell",
                        type: "restore"
                    }]
                }).stop()
            },
            "body-row": function(e) {
                var t = e.params().counter;
                e.tag("tr").content(["title", "restore"].map(function(e) {
                    return {
                        elem: "cell-" + e,
                        tag: "td",
                        mix: [{
                            block: "counters-table",
                            elem: "body-cell",
                            mods: {
                                type: e
                            }
                        }],
                        counter: t
                    }
                })).stop()
            },
            "cell-title": function(e) {
                var t = e.params().counter;
                e.content([{
                    elem: "counter-title",
                    counter: t,
                    linkMods: {
                        disabled: "yes"
                    }
                }, {
                    elem: "counter-info",
                    counter: t
                }, {
                    block: "infected-hint",
                    counter: t
                }])
            },
            "cell-restore": function(e) {
                e.content({
                    block: "counter-restore",
                    counter: e.params().counter
                })
            }
        }
    }), BEM.DOM.decl({
        name: "counters-table",
        modName: "type",
        modVal: "deleted"
    }, {
        _onCounterRestore: function(e) {
            var t = e.block.domElem.parents(this.buildSelector("body-row")),
                i = this.findBlockInside(t, "smart-link");
            i.delMod("disabled")
        }
    }), BEM.JSON.decl("counter-restore", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.counter,
                n = "undefined" == typeof t.hint ? !0 : t.hint;
            e.mix([{
                block: "error-message",
                mods: {
                    type: "popup"
                }
            }]).mod("hint", n ? "yes" : "no").js({
                cid: i.id
            }).content([n && {
                block: "spin2",
                mix: {
                    block: "counter-restore",
                    elem: "restore-spinner"
                },
                mods: {
                    size: "xxs",
                    progress: "yes"
                }
            }, n && {
                block: "label-tag",
                mods: {
                    removable: "yes",
                    status: "none"
                }
            }, {
                block: "button",
                mix: [{
                    block: "counter-restore",
                    elem: "restore-button"
                }],
                mods: {
                    pseudo: "yes",
                    size: "s"
                },
                content: BEM.I18N("counter-restore", "button-label")
            }])
        }
    }), BEM.DOM.decl("counter-restore", {
        TAG_HIDE_TIMEOUT: 8,
        onSetMod: {
            js: function() {
                this._restoreButton = this.findBlockOn(this.elem("restore-button"), "button"), this._statusTag = this.findBlockInside("label-tag"), this._restoreButton.on("click", this._restoreCounter.bind(this))
            }
        },
        _restoreCounter: function() {
            var e = this;
            this.setMod("restoring", "yes"), this._restoreButton.setMod("disabled", "yes"), BN("i-counters-api").undelete(this.params.cid).then(function() {
                var t = {
                    counterId: e.params.cid
                };
                e._showTag(), e.trigger("restore", t)
            }).fail(function(t) {
                var i = BN("i-error-message").toText(t);
                e._showTag(i)
            }).always(function() {
                e._isDestructing || e.delMod("restoring")
            }).done()
        },
        _showTag: function(e) {
            this.hasMod("hint", "yes") && (this._statusTag.setText(e || BEM.I18N("counter-restore", "confirm")), this._statusTag.setMod("status", e ? "error" : "ok"), e || this._statusTag.autoHide(this.TAG_HIDE_TIMEOUT))
        }
    }), BEM.JSON.decl("add-counter", {
        onBlock: function(e) {
            var t = e.param("uid");
            return t ? void e.content({
                block: "button",
                mods: {
                    size: "s",
                    theme: "action"
                },
                mix: [{
                    block: "smart-link",
                    js: {
                        path: "/add",
                        keepParams: ["delegation"]
                    }
                }],
                url: "#",
                content: BEM.I18N("add-counter", "add-counter")
            }) : void e.remove()
        }
    }), BEM.JSON.decl("add-counter", {
        onBlock: function(e) {
            e.defer(BN("i-user").uid().then(function(t) {
                e.param("uid", t)
            }))
        }
    }), BEM.JSON.decl("label-counters-statistic", {
        onBlock: function(e) {
            var t = e.param("label"),
                i = e.param("labelCountersStat"),
                n = Date.now(),
                o = [];
            i && (i.weekStats.reverse().forEach(function(e, t) {
                o.unshift({
                    date: n - t * BN("i-date").DAY_IN_MILLISECONDS,
                    value: e
                })
            }.bind(this)), e.js({
                labelId: t.id
            }).content({
                elem: "content",
                content: [{
                    elem: "visits",
                    labelCountersStat: i
                }, {
                    elem: "dynamics-chart",
                    counterChartData: o
                }, {
                    elem: "report-link-container"
                }]
            }))
        },
        onElem: {
            visits: function(e) {
                e.content([{
                    elem: "visits-label",
                    content: BEM.I18N("label-counters-statistic", "visits-label")
                }, {
                    elem: "visits-values",
                    content: {
                        block: "counter-activity",
                        mods: {
                            type: "label-stat"
                        },
                        type: "visits",
                        stats: e.param("labelCountersStat")
                    }
                }])
            },
            "dynamics-chart": function(e) {
                e.content([{
                    elem: "chart-label",
                    content: BEM.I18N("label-counters-statistic", "chart-label")
                }, {
                    elem: "chart",
                    content: {
                        block: "small-chart",
                        js: {
                            data: e.param("counterChartData")
                        }
                    }
                }])
            },
            "report-link-container": function(e) {
                e.content({
                    elem: "report-link",
                    content: {
                        block: "button",
                        mods: {
                            size: "m"
                        },
                        mix: {
                            block: "label-counters-statistic",
                            elem: "report-link"
                        },
                        content: BEM.I18N("label-counters-statistic", "report-link")
                    }
                })
            }
        }
    }), BEM.JSON.decl("label-counters-statistic", {
        onBlock: function(e) {
            if (BN("i-labels").isUserLabel(e.param("label").id)) {
                var t = e.param("countersList").counters.map(function(e) {
                    return e.id
                });
                t.length && e.defer(BN("i-counters-api").getCountersGroupStat(t).then(function(t) {
                    e.param("labelCountersStat", t)
                }))
            }
        }
    }), BEM.DOM.decl("label-counters-statistic", {}, {
        live: function() {
            this.liveInitOnBlockInsideEvent("click", "button", function() {
                var e = "/dashboard?gid=" + this.params.labelId,
                    t = BN("i-router").getParams().ulogin;
                t && (e += "&ulogin=" + t), BN("i-router").setPath(e)
            })
        }
    }), BEM.DOM.decl({
        name: "dropdown",
        modName: "lazy",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                var e = this;
                this.__base.apply(this, arguments), this.setContent(BN("i-content").html({
                    block: "wait",
                    mods: {
                        state: "active",
                        theme: "white"
                    }
                }, !0)), BN("i-content").html(this.params.content).then(function(t) {
                    e.setContent(t), e.trigger("content-ready")
                })
            }
        }
    }),
    function(e) {
        e.console || (e.console = {
            log: function() {},
            error: function() {}
        })
    }(this), BN.addDecl("i-secure-page").baseBlock("i-page").done(), BN.addDecl("error-page").onSetMod({
        js: function() {
            this.bindTo("undelete-button", "click", this._onUndeleteClick)
        }
    }).instanceProp({
        _onUndeleteClick: function() {
            BN("i-counters-api").undelete(BN("i-counters").getCounterId()).then(function() {
                BN("i-router").reload()
            }).done()
        }
    }), BN.addDecl("error-page").onSetMod({
        js: function() {
            this.__base.apply(this, arguments), this._getUserAccounts().then(this._drawAccounts.bind(this)).then(this._afterUserAccountsDraw.bind(this)).done()
        }
    }).instanceProp({
        _getUserAccounts: function() {
            var e = Vow.promise();
            return BN("multi-auth").getAccounts(function(t) {
                e.fulfill(t)
            }, function(t) {
                e.reject(new BEM.blocks["i-errors"].HttpError(t.status))
            }), e
        },
        _drawAccounts: function(e) {
            return e.accounts && 1 !== e.accounts.length ? BN("i-content").replace(this.elem("user-accounts"), {
                block: "error-page",
                elem: "user-accounts-list",
                accounts: e.accounts
            }).then(function() {
                this.setMod(this.elem("use-another-login"), "visible", "yes")
            }.bind(this)) : void 0
        },
        _afterUserAccountsDraw: function() {
            this.elem("user").on("click", this._changeCurrentAccount.bind(this))
        },
        _changeCurrentAccount: function(e) {
            var t = this.elem("form"),
                i = this.getMod(this.elemify(e.currentTarget, "user"), "uid");
            if (i) return this.elem("form-uid").val(i), this.elem("form-yu").val(BEM.blocks["i-global"].param("yandexuid")), t.submit(), !1
        }
    }), BN.addDecl("error-page").elemTemplate({
        "user-accounts-list": function(e) {
            var t = e.param("accounts");
            e.tag("ul").content(t.reduce(function(e, t) {
                return BEM.blocks["i-global"].param("uid") === t.uid ? e : (e.push({
                    elem: "user-accounts-list-item",
                    tag: "li",
                    content: {
                        block: "user",
                        js: {
                            uid: t.uid
                        },
                        mix: [{
                            block: "error-page",
                            elem: "user",
                            mods: {
                                uid: t.uid
                            }
                        }],
                        content: [{
                            elem: "icon"
                        }, {
                            elem: "name",
                            mix: {
                                block: "error-page",
                                elem: "user-name"
                            },
                            content: t.login
                        }]
                    }
                }), e)
            }, []))
        }
    }), BEM.blocks["i-router"].define("GET", /^\/dashboard\/?/, "dashboard-page"), (BEM.DOM || BEM).decl({
        name: "dashboard-page",
        baseBlock: "i-secure-page"
    }, null, {
        init: function() {
            var e = this;
            return this.__base().then(function() {
                return e._setTitle()
            }).then(function() {
                e.out({
                    block: e._name
                })
            })
        },
        _setTitle: function() {
            var e = this;
            return BN("i-counters").getAsync().then(function(t) {
                e.setTitle(t.getName() + " — " + BEM.I18N("dashboard-page", "dashboard"))
            })
        }
    }), BEM.JSON.decl("dashboard-page", {
        onBlock: function(e) {
            e.js(!0), e.mod("loading", "yes"), e.content([{
                elem: "create-controls"
            }, {
                block: "date-selector",
                mods: {
                    "data-bind": "m-dashboard-url-params"
                },
                mix: [{
                    block: "dashboard-page",
                    elem: "date-selector"
                }]
            }, {
                elem: "items"
            }, {
                elem: "empty-dashboard"
            }])
        },
        onElem: {
            items: function(e) {
                e.content([{
                    elem: "col",
                    mods: {
                        n: 0
                    }
                }, {
                    elem: "col",
                    mods: {
                        n: 1
                    }
                }, {
                    elem: "col",
                    mods: {
                        n: 2
                    }
                }, {
                    block: "paranja-light",
                    mix: [{
                        block: "dashboard-page",
                        elem: "paranja"
                    }]
                }])
            },
            "add-widget-button": function(e) {
                var t = e.param("type");
                e.wrap([{
                    block: "button",
                    attrs: {
                        autocomplete: "off"
                    },
                    mix: [{
                        block: "dashboard-page",
                        elem: "add-widget-button",
                        mods: {
                            type: t
                        }
                    }],
                    mods: {
                        size: "s",
                        theme: "clear"
                    },
                    content: e.content()
                }])
            },
            "create-controls": function(e) {
                e.content([{
                    block: "dropdown",
                    mix: {
                        block: "dashboard-page",
                        elem: "create-dropdown"
                    },
                    content: [{
                        block: "button",
                        mix: [{
                            block: "dropdown",
                            elem: "switcher"
                        }],
                        mods: {
                            size: "s",
                            pseudo: "yes"
                        },
                        content: [{
                            block: "icon",
                            elem: "plus"
                        }, BEM.I18N("dashboard-page", "create-widget")]
                    }, {
                        elem: "popup",
                        js: {
                            directions: "bottom-left-center"
                        },
                        content: {
                            block: "dashboard-page",
                            elem: "create-dropdown-content",
                            content: [{
                                elem: "add-widget-button",
                                type: "total",
                                content: ["<b>123</b> ", BEM.I18N("dashboard-page", "button-total")]
                            }, {
                                elem: "add-widget-button",
                                type: "pie",
                                content: [{
                                    block: "icon",
                                    elem: "pie"
                                }, BEM.I18N("dashboard-page", "button-pie")]
                            }, {
                                elem: "add-widget-button",
                                type: "table",
                                content: [{
                                    block: "icon",
                                    elem: "grid"
                                }, BEM.I18N("dashboard-page", "button-table")]
                            }, {
                                elem: "add-widget-button",
                                type: "multiline",
                                content: [{
                                    block: "icon",
                                    elem: "line-chart"
                                }, BEM.I18N("dashboard-page", "button-multiline")]
                            }]
                        }
                    }]
                }, {
                    block: "dashboard-wizard",
                    mix: {
                        block: "dashboard-page",
                        elem: "wizard"
                    }
                }])
            },
            "empty-dashboard": function(e) {
                e.content([{
                    elem: "empty-dashboard-head",
                    content: BEM.I18N("dashboard-page", "dashboard-desc-head")
                }, {
                    elem: "empty-dashboard-desc",
                    content: BEM.I18N("dashboard-page", "dashboard-desc-text")
                }, {
                    block: "link",
                    mods: {
                        pseudo: "yes",
                        underline: "no"
                    },
                    content: BEM.I18N("dashboard-page", "default-dashboard-settings"),
                    mix: [{
                        block: "dashboard-page",
                        elem: "empty-dashboard-default-link"
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("dashboard-page", {
        onSetMod: {
            js: function() {
                var e = this;
                this._onItemsSort = jQuery.debounce(this._onItemsSort, 100, this), this._onWidgetResize = jQuery.debounce(this._updateColsHeight, 100, this), this._loadDashboard().then(function() {
                    e._updateEmptyStatus(), BN("widget").on("resize", e._onWidgetResize, e), e._dashboardModel.on("items", "change", e._onItemsChange, e), e._updateEmptyStatus(), BEM.DOM.win.scrollTop(0)
                }).done(), this.bindTo("add-widget-button", "click", this._onAddWidgetClick), this._wizard = this.findBlockOn("wizard", "dashboard-wizard"), this._wizard.on("select", this._onWizardSelect, this), this.bindTo("empty-dashboard-default-link", "click", this._onDefaultDashboardClick), BN("i-counters").on("switch", this._onCounterSwitch, this), BN("dashboard-item").on("newWidget", this._showNewItem, this), this._urlParamsModel = BN("m-dashboard-url-params").create(), this._urlParamsModel.fetch().done()
            }
        },
        destruct: function() {
            return this._wizard.un("select", this._onWizardSelect, this), BN("widget").un("resize", this._onWidgetResize, this), BN("i-counters").un("switch", this._onCounterSwitch, this), this._dashboardModel.un("items", "change", this._onItemsChange, this), this._dashboardModel.un("change", this._onDashboardChange, this), this.__base.apply(this, arguments)
        },
        _onWizardSelect: function(e, t) {
            this._addWidget(t.preset)
        },
        _setReadonlyMode: function() {
            this._dashboardModel.isEditable() ? this.delMod("readonly") : this.setMod("readonly", "yes")
        },
        _loadDashboard: function() {
            var e = this;
            return this._cols = this.findElem("col"), this._itemsContainer = this.findElem("items"), this._dashboardModel = BN("m-dashboard").create(), e._dashboardModel.fetch().then(function() {
                return e._setReadonlyMode(), e.delMod("loading"), Vow.all(e._dashboardModel.get("items").toArray().sort(function(e, t) {
                    var i = e.get("position").toArray(),
                        n = t.get("position").toArray();
                    return i[0] - n[0] || i[1] - n[1]
                }).map(function(t) {
                    return e._addDashboardItem(t.cid, t.get("widgetModels").get(0).get("type"), t.get("position").get(0))
                }))
            }).then(function() {
                e._cols.each(function(t, i) {
                    Sortable.create(i, {
                        group: "dashboard-items",
                        draggable: e.buildSelector("item"),
                        handle: e.buildSelector("item-drag"),
                        onSort: e._onItemsSort
                    })
                }), e._dashboardModel.on("change", e._onDashboardChange, e)
            })
        },
        _onCounterSwitch: function(e, t) {
            var i = this;
            BN("i-router").replaceParams({
                id: t.counter_id,
                gid: t.group_id
            }, !0, !0), this.setMod("loading", "yes"), this._wizard.reset(), BN("i-content").replace(this._itemsContainer, {
                block: "dashboard-page",
                elem: "items"
            }).then(function() {
                return i._loadDashboard()
            }).always(function(e) {
                return i._updateEmptyStatus(), e
            }).done()
        },
        _addDashboardItem: function(e, t, i, n) {
            var o = this;
            return i = i || 0, BEM.blocks["i-content"].html({
                block: "dashboard-item",
                modelId: e,
                mix: [{
                    block: "dashboard-page",
                    elem: "item"
                }, n ? {
                    block: "dashboard-page",
                    elem: "new-item"
                } : ""]
            }).then(function(e) {
                var t = jQuery(e);
                try {
                    BEM.DOM.append(o._cols.get(i), t), o._updateEmptyStatus(), n && o._showNewItem()
                } catch (s) {
                    t.remove(), setTimeout(function() {
                        throw s
                    })
                }
            })
        },
        SCROLL_TIME: 300,
        UNHIDE_DELAY: 200,
        _addClassBySelector: function(e, t) {
            e.addClass(t.replace(".", ""))
        },
        _showNewItem: function() {
            var e, t, i, n = this,
                o = this.buildSelector("new-item", "shown", "yes"),
                s = this.findElem("new-item").not(o);
            s.length > 0 && (e = BEM.DOM.win.height(), t = jQuery("html, body"), i = s.offset().top + s.height() - e / 2, 0 >= i ? this._addClassBySelector(s, o) : t.animate({
                scrollTop: i
            }, (i - t.scrollTop()) / e * n.SCROLL_TIME, function() {
                setTimeout(function() {
                    n._addClassBySelector(s, o)
                }, n.UNHIDE_DELAY)
            }))
        },
        _onDashboardChange: function() {
            this._dashboardModel.save().done()
        },
        _addWidget: function(e) {
            var t = BN("m-widget").create(e),
                i = this,
                n = t.fetch();
            t.get("preset") || (this.setMod("loading", "yes"), n = n.then(function() {
                return t.save()
            })), n.then(function() {
                var e = t.get("type"),
                    n = i._dashboardModel.getDashboardItemModelByType(e),
                    o = 0,
                    s = i._cols.eq(0).height();
                return i._cols.css("min-height", i._initColsMinHeight), i._cols.each(function(e, t) {
                    var i = jQuery(t).height();
                    s > i && (s = i, o = e)
                }), i._updateColsHeight(), n.set("position", [o, 0]), n.get("widgetModels").push(t), 1 === n.get("widgetModels").length() ? i._addDashboardItem(n.cid, e, n.get("position").get(0), !0) : void 0
            }).then(function() {
                i._onItemsSort(), i.delMod("loading")
            }).done()
        },
        _onAddWidgetClick: function(e) {
            var t = "default-" + this.getMod(jQuery(e.target), "type");
            this._addWidget(this._dashboardModel.getWidgetFieldsByPreset(t)), this.findBlockOn("create-dropdown", "dropdown").hide()
        },
        _onDefaultDashboardClick: function() {
            var e;
            0 === this.findElem("item").length && (this.setMod("loading", "yes"), e = this.findElem("add-widget").fadeOut(), this._dashboardModel.un("change", this._onDashboardChange, this), this._dashboardModel.remove().then(this._loadDashboard.bind(this)).then(function() {
                e.fadeIn()
            }).done())
        },
        _onItemsSort: function() {
            this._cols.each(function(e, t) {
                this.findElem($(t), "item").each(function(t, i) {
                    var n = $(i).bem("dashboard-item").params.modelId,
                        o = BN("m-dashboard-item").getOne(n);
                    o.set("position", [e, t])
                }.bind(this))
            }.bind(this)), this._updateColsHeight()
        },
        _onItemsChange: function() {
            this._updateColsHeight(), this._updateEmptyStatus()
        },
        _initColsMinHeight: null,
        _updateColsHeight: function() {
            var e;
            this._initColsMinHeight ? this._cols.css("min-height", this._initColsMinHeight) : this._initColsMinHeight = this._cols.css("min-height"), e = this._cols.map(function(e, t) {
                return $(t).height()
            }), this._cols.css("min-height", Math.max.apply(Math, e) + "px")
        },
        _updateEmptyStatus: function() {
            this.toggleMod("empty", "yes", 0 === this.findElem("item").length)
        }
    }, {
        update: function() {
            var e = BN("m-dashboard-url-params").getOne();
            return e.fetch()
        },
        destruct: function() {
            return BN("i-content").append(this.getUpdateNode(), {
                block: "paranja-light"
            }), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl("dashboard-wizard", {
        onBlock: function(e) {
            e.js(!0), e.content([{
                block: "button",
                mods: {
                    size: "s",
                    theme: "action"
                },
                content: BEM.I18N("dashboard-wizard", "dashboard-wizard"),
                mix: [{
                    block: "dashboard-wizard",
                    elem: "open-button"
                }]
            }, {
                block: "popup",
                mods: {
                    type: "modal",
                    position: "fixed",
                    "has-close": "yes"
                },
                underMods: {
                    type: "paranja"
                },
                js: {
                    directions: ["bottom-left", "bottom-center", "bottom-right"]
                },
                mix: [{
                    block: "dashboard-wizard",
                    elem: "popup"
                }],
                content: [{
                    elem: "content",
                    mix: {
                        block: "dashboard-wizard",
                        elem: "popup-content"
                    },
                    content: {
                        block: "dashboard-wizard",
                        elem: "popup-inner"
                    }
                }]
            }])
        },
        onElem: {
            "popup-inner": function(e) {
                var t = e.param("levels");
                t && e.content([{
                    elem: "level",
                    content: t[0].map(function(e) {
                        return {
                            elem: "item",
                            item: e
                        }
                    })
                }, {
                    elem: "level",
                    content: t[1].filter(function(e) {
                        return e.preset
                    }).map(function(e) {
                        return {
                            elem: "item",
                            item: e
                        }
                    }).concat(t[1].filter(function(e) {
                        return !e.preset
                    }).map(function(e) {
                        return [{
                            elem: "item",
                            type: "group",
                            item: e
                        }].concat(t[2].filter(function(t) {
                            return t.parent === e.id
                        }).map(function(t) {
                            return {
                                elem: "item",
                                item: t,
                                parent: e.parent
                            }
                        }))
                    }))
                }, {
                    elem: "level",
                    content: [{
                        elem: "details-panel-spacer"
                    }].concat(t[3].map(function(e) {
                        return {
                            elem: "item",
                            type: "radio",
                            item: e
                        }
                    }))
                }, {
                    elem: "add-panel"
                }, {
                    elem: "details-panel",
                    content: [].concat.apply([], t.slice(0, 2)).filter(function(e) {
                        return e.preset
                    }).concat(t[2]).map(function(e) {
                        return {
                            elem: "item",
                            type: "details",
                            item: e,
                            parent: e.id
                        }
                    })
                }, {
                    elem: "empty-panel",
                    content: BEM.I18N("dashboard-wizard", "select-widget")
                }])
            },
            "add-panel": function(e) {
                e.content({
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "action"
                    },
                    content: BEM.I18N("dashboard-wizard", "add-widget"),
                    mix: [{
                        block: "dashboard-wizard",
                        elem: "add-button"
                    }]
                })
            },
            sub: function(e) {
                var t = e.param("type"),
                    i = e.param("item"),
                    n = BEM.I18N("dashboard-wizard", i.keysetPrefix + "-" + t);
                n ? (e.content(n), e.mod("type", t)) : e.remove()
            },
            goal: function(e) {
                var t = e.param("item");
                t.goal ? e.content({
                    block: "goals-panel",
                    mods: {
                        "data-bind": "dashboard-wizard"
                    },
                    goal: {},
                    mix: {
                        block: "dashboard-wizard",
                        elem: "goals-panel"
                    }
                }) : e.remove()
            },
            item: function(e) {
                var t = e.param("item"),
                    i = e.param("type") || "option",
                    n = e.param("parent") || t.parent || t.id,
                    o = !BN("i-counters").isSingle(),
                    s = o && t.single;
                s && (e.mod("disabled", "yes"), e.attr("title", BEM.I18N("dashboard-wizard", "unavailable-for-groups"))), "details" === i ? e.content([{
                    elem: "sub",
                    type: "name",
                    item: t
                }, {
                    elem: "sub",
                    type: "comment",
                    item: t
                }, t.goal ? "" : {
                    elem: "sub",
                    type: "next",
                    item: t
                }, s ? "" : {
                    elem: "goal",
                    item: t
                }]) : "radio" === i ? (e.content([{
                    block: "radiobox",
                    js: {
                        id: "dashboard-wizard"
                    },
                    mix: {
                        block: "dashboard-wizard",
                        elem: "radiobox"
                    },
                    mods: {
                        size: "s",
                        disabled: s ? "yes" : ""
                    },
                    name: "dashboard-wizard",
                    content: {
                        controlAttrs: {
                            value: BEM.toModVal(t.id)
                        },
                        elem: "radio",
                        content: {
                            block: "dashboard-wizard",
                            elem: "sub",
                            type: "name",
                            item: t,
                            tag: "span"
                        }
                    }
                }, {
                    elem: "sub",
                    type: "comment",
                    item: t
                }, s ? "" : {
                    elem: "goal",
                    item: t
                }]), BEM.I18N("dashboard-wizard", t.keysetPrefix + "-comment") || t.goal || e.mod("light", "yes")) : e.content({
                    elem: "sub",
                    type: "name",
                    item: t
                }), e.mod("type", i), e.mod("id", BEM.toModVal(t.id)), e.mod("parent", BEM.toModVal(n)), t.preset && e.js({
                    preset: t.preset,
                    goal: Boolean(t.goal)
                })
            }
        }
    }), BEM.DOM.decl("dashboard-wizard", {
        onSetMod: {
            js: function() {
                this._popup = this.findBlockOn("popup", "popup"), this.bindTo("open-button", "click", this._onOpenClick), this._onOptionClick = this._onOptionClick.bind(this)
            }
        },
        destruct: function() {
            this.reset(), this.__base.apply(this, arguments)
        },
        reset: function() {
            this._popupInner && (this.domElem.off("click", this.buildSelector("item", "type", "option"), this._onOptionClick), BN("radiobox").un(this.domElem, "change", this._onRadioSelect, this), this._model.un("change", this._onModelChange, this), this._model.destruct(), this.domElem = this.domElem.not(this._popupInner), this._popupInner = null)
        },
        _updateModel: function(e) {
            var t = this.elemParams(e);
            t.preset ? (this._model.set(t), t.goal || this._model.set("goalId", NaN)) : this._model.set({
                preset: "",
                goal: !1,
                goalId: NaN
            })
        },
        _onOptionClick: function(e) {
            var t = jQuery(e.currentTarget),
                i = this.getMod(t, "id"),
                n = this.getMod(t, "parent");
            this.hasMod(t, "selected", "yes") || this.hasMod(t, "disabled", "yes") || (this._updateModel(t), this.delMod(this.findElem("item", "show", "yes"), "show"), this._showItems(i), this._showItems(n), this._updateDetailPanelSpacer(), this.delMod(this.findElem("item", "selected", "yes"), "selected"), this._selectOption(i), this._selectOption(n), this._selectFirstRadio(), n === i ? this.setMod(this._popupInner, "empty", "yes") : this.delMod(this._popupInner, "empty"))
        },
        _updateDetailPanelSpacer: function() {
            this.findElem("details-panel-spacer").height(this.findElem("details-panel").height()), this.findElem("level").eq(2).scrollTop(0)
        },
        _selectFirstRadio: function() {
            var e = this.findElem(this.findElem("item", "show", "yes").not(this.buildSelector("item", "disabled", "yes")), "radiobox").eq(0);
            e.length && e.find("input").change()
        },
        _showItemsChain: function(e) {
            this.findElem("item", "id", e).each(function(t, i) {
                var n = jQuery(i),
                    o = this.getMod(n, "parent"),
                    s = this.getMod(n, "type");
                o && o !== e && this._showItemsChain(o), this._showItems(e), this._updateDetailPanelSpacer(), "option" === s && this._selectOption(e), this._updateModel(n)
            }.bind(this))
        },
        _selectOption: function(e) {
            this.setMod(this.findElem("item", "id", e), "selected", "yes")
        },
        _showItems: function(e) {
            this.setMod(this.findElem("item", "id", e), "show", "yes"), this.setMod(this.findElem("item", "parent", e), "show", "yes")
        },
        _levels: function(e) {
            return e
        }([
            [{
                keysetPrefix: "the-quality-pages",
                id: "the-quality-pages"
            }, {
                keysetPrefix: "the-speed-of-the-site",
                id: "the-speed-of-the-site"
            }, {
                keysetPrefix: "popular-content",
                id: "popular-content"
            }, {
                keysetPrefix: "the-goals-and-conversion",
                id: "the-goals-and-conversion",
                single: !0
            }, {
                keysetPrefix: "traffic",
                id: "traffic"
            }, {
                keysetPrefix: "quality-traffic",
                id: "quality-traffic"
            }],
            [{
                keysetPrefix: "top-exit-pages",
                id: "top-exit-pages",
                preset: "top-exit-pages",
                parent: "the-quality-pages"
            }, {
                keysetPrefix: "the-best-landing-page-landing-pages",
                id: "the-best-landing-page-landing-pages",
                parent: "the-quality-pages"
            }, {
                keysetPrefix: "the-worst-landing-page-landing-pages",
                id: "the-worst-landing-page-landing-pages",
                parent: "the-quality-pages"
            }, {
                keysetPrefix: "slow-pages",
                id: "slow-pages",
                preset: "slow-pages",
                parent: "the-speed-of-the-site"
            }, {
                keysetPrefix: "slow-regions",
                id: "slow-regions",
                preset: "slow-regions",
                parent: "the-speed-of-the-site"
            }, {
                keysetPrefix: "popular-pages",
                id: "popular-pages",
                preset: "popular-pages",
                parent: "popular-content"
            }, {
                keysetPrefix: "download-file",
                id: "download-file",
                preset: "download-file",
                parent: "popular-content"
            }, {
                keysetPrefix: "external-links",
                id: "external-links",
                preset: "external-links",
                parent: "popular-content"
            }, {
                keysetPrefix: "the-number-of-goal-achievements",
                id: "the-number-of-goal-achievements",
                preset: "the-number-of-goal-achievements",
                goal: !0,
                parent: "the-goals-and-conversion",
                single: !0
            }, {
                keysetPrefix: "the-number-of-target-visits",
                id: "the-number-of-target-visits",
                preset: "the-number-of-target-visits",
                goal: !0,
                parent: "the-goals-and-conversion",
                single: !0
            }, {
                keysetPrefix: "conversion",
                id: "the-goals-and-conversion-conversion",
                preset: "the-goals-and-conversion-conversion",
                goal: !0,
                parent: "the-goals-and-conversion",
                single: !0
            }, {
                keysetPrefix: "volume-the-absolute-value-of-the",
                id: "volume-the-absolute-value-of-the",
                parent: "traffic"
            }, {
                keysetPrefix: "volume-percent",
                id: "volume-percent",
                parent: "traffic"
            }, {
                keysetPrefix: "dynamics-of-indicators",
                id: "dynamics-of-indicators",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "quality-traffic-sources",
                id: "quality-traffic-sources",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "the-quality-and-characteristics-of-visitors",
                id: "the-quality-and-characteristics-of-visitors",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "quality-advertising-campaign-and-ad-yandexdirect",
                id: "quality-advertising-campaign-and-ad-yandexdirect",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "quality-utm-tags",
                id: "quality-utm-tags",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "bestworst-sources",
                id: "bestworst-sources",
                parent: "quality-traffic"
            }, {
                keysetPrefix: "the-worst-sources",
                id: "the-worst-sources",
                parent: "quality-traffic"
            }],
            [{
                keysetPrefix: "failures",
                id: "failures",
                preset: "failures",
                parent: "the-best-landing-page-landing-pages"
            }, {
                keysetPrefix: "conversion",
                id: "conversion",
                preset: "conversion",
                goal: !0,
                parent: "the-best-landing-page-landing-pages",
                single: !0
            }, {
                keysetPrefix: "depth-of-view",
                id: "depth-of-view",
                preset: "depth-of-view",
                parent: "the-best-landing-page-landing-pages"
            }, {
                keysetPrefix: "failures",
                id: "the-worst-landing-page-landing-pages-failures",
                preset: "the-worst-landing-page-landing-pages-failures",
                parent: "the-worst-landing-page-landing-pages"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-landing-page-landing-pages-conversion",
                preset: "the-worst-landing-page-landing-pages-conversion",
                goal: !0,
                parent: "the-worst-landing-page-landing-pages",
                single: !0
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-landing-page-landing-pages-depth-of-view",
                preset: "the-worst-landing-page-landing-pages-depth-of-view",
                parent: "the-worst-landing-page-landing-pages"
            }, {
                keysetPrefix: "total",
                id: "total",
                parent: "volume-the-absolute-value-of-the"
            }, {
                keysetPrefix: "source",
                id: "source",
                parent: "volume-the-absolute-value-of-the"
            }, {
                keysetPrefix: "characteristics-of-visitors",
                id: "characteristics-of-visitors",
                parent: "volume-the-absolute-value-of-the"
            }, {
                keysetPrefix: "source",
                id: "volume-percent-source",
                parent: "volume-percent"
            }, {
                keysetPrefix: "characteristics-of-visitors",
                id: "volume-percent-characteristics-of-visitors",
                parent: "volume-percent"
            }, {
                keysetPrefix: "conversion",
                id: "dynamics-of-indicators-conversion",
                preset: "dynamics-of-indicators-conversion",
                goal: !0,
                parent: "dynamics-of-indicators",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "waivers",
                preset: "waivers",
                parent: "dynamics-of-indicators"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "time-on-the-website",
                preset: "time-on-the-website",
                parent: "dynamics-of-indicators"
            }, {
                keysetPrefix: "depth-of-view",
                id: "dynamics-of-indicators-depth-of-view",
                preset: "dynamics-of-indicators-depth-of-view",
                parent: "dynamics-of-indicators"
            }, {
                keysetPrefix: "all-sources",
                id: "quality-traffic-sources-all-sources",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "search-engine",
                id: "quality-traffic-sources-search-engine",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "search-phrases",
                id: "search-phrases",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "advertising-system",
                id: "advertising-system",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "reference-traffic",
                id: "reference-traffic",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "social-network",
                id: "quality-traffic-sources-social-network",
                parent: "quality-traffic-sources"
            }, {
                keysetPrefix: "geography-city",
                id: "the-quality-and-characteristics-of-visitors-geography-city",
                parent: "the-quality-and-characteristics-of-visitors"
            }, {
                keysetPrefix: "novelty",
                id: "novelty",
                parent: "the-quality-and-characteristics-of-visitors"
            }, {
                keysetPrefix: "age",
                id: "the-quality-and-characteristics-of-visitors-age",
                parent: "the-quality-and-characteristics-of-visitors"
            }, {
                keysetPrefix: "floor",
                id: "the-quality-and-characteristics-of-visitors-floor",
                parent: "the-quality-and-characteristics-of-visitors"
            }, {
                keysetPrefix: "the-type-of-device",
                id: "the-quality-and-characteristics-of-visitors-the-type-of-device",
                parent: "the-quality-and-characteristics-of-visitors"
            }, {
                keysetPrefix: "advertising-campaign",
                id: "advertising-campaign",
                parent: "quality-advertising-campaign-and-ad-yandexdirect"
            }, {
                keysetPrefix: "ad",
                id: "ad",
                parent: "quality-advertising-campaign-and-ad-yandexdirect"
            }, {
                keysetPrefix: "playground",
                id: "playground",
                parent: "quality-advertising-campaign-and-ad-yandexdirect"
            }, {
                keysetPrefix: "keyword",
                id: "keyword",
                parent: "quality-advertising-campaign-and-ad-yandexdirect"
            }, {
                keysetPrefix: "utm_source",
                id: "utm_source",
                parent: "quality-utm-tags"
            }, {
                keysetPrefix: "utm_medium",
                id: "utm_medium",
                parent: "quality-utm-tags"
            }, {
                keysetPrefix: "utm_term",
                id: "utm_term",
                parent: "quality-utm-tags"
            }, {
                keysetPrefix: "utm_content",
                id: "utm_content",
                parent: "quality-utm-tags"
            }, {
                keysetPrefix: "utm_campaign-parameters",
                id: "utm_campaign-parameters",
                parent: "quality-utm-tags"
            }, {
                keysetPrefix: "search-phrases",
                id: "bestworst-sources-search-phrases",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "reference-traffic",
                id: "bestworst-sources-reference-traffic",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "geography-city",
                id: "bestworst-sources-geography-city",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "direct-ads",
                id: "direct-ads",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "direct-site",
                id: "direct-site",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "direct-key-phrases",
                id: "direct-key-phrases",
                parent: "bestworst-sources"
            }, {
                keysetPrefix: "search-phrases",
                id: "the-worst-sources-search-phrases",
                parent: "the-worst-sources"
            }, {
                keysetPrefix: "reference-traffic",
                id: "the-worst-sources-reference-traffic",
                parent: "the-worst-sources"
            }, {
                keysetPrefix: "geography-city",
                id: "the-worst-sources-geography-city",
                parent: "the-worst-sources"
            }, {
                keysetPrefix: "direct-ads",
                id: "the-worst-sources-direct-ads",
                parent: "the-worst-sources"
            }, {
                keysetPrefix: "direct-site",
                id: "the-worst-sources-direct-site",
                parent: "the-worst-sources"
            }, {
                keysetPrefix: "direct-key-phrases",
                id: "the-worst-sources-direct-key-phrases",
                parent: "the-worst-sources"
            }],
            [{
                keysetPrefix: "visits",
                id: "visits",
                preset: "visits",
                parent: "total"
            }, {
                keysetPrefix: "visitors",
                id: "visitors",
                preset: "visitors",
                parent: "total"
            }, {
                keysetPrefix: "views",
                id: "views",
                preset: "views",
                parent: "total"
            }, {
                keysetPrefix: "all-sources",
                id: "all-sources",
                preset: "all-sources",
                parent: "source"
            }, {
                keysetPrefix: "search-engine",
                id: "search-engine",
                preset: "search-engine",
                parent: "source"
            }, {
                keysetPrefix: "ad-clicks",
                id: "ad-clicks",
                preset: "ad-clicks",
                parent: "source"
            }, {
                keysetPrefix: "clicks-on-links-on-websites",
                id: "clicks-on-links-on-websites",
                preset: "clicks-on-links-on-websites",
                parent: "source"
            }, {
                keysetPrefix: "social-network",
                id: "social-network",
                preset: "social-network",
                parent: "source"
            }, {
                keysetPrefix: "new-visitors",
                id: "new-visitors",
                preset: "new-visitors",
                parent: "characteristics-of-visitors"
            }, {
                keysetPrefix: "geography-city",
                id: "geography-city",
                preset: "geography-city",
                parent: "characteristics-of-visitors"
            }, {
                keysetPrefix: "age",
                id: "age",
                preset: "age",
                parent: "characteristics-of-visitors"
            }, {
                keysetPrefix: "floor",
                id: "floor",
                preset: "floor",
                parent: "characteristics-of-visitors"
            }, {
                keysetPrefix: "the-type-of-device",
                id: "the-type-of-device",
                preset: "the-type-of-device",
                parent: "characteristics-of-visitors"
            }, {
                keysetPrefix: "all-sources",
                id: "volume-percent-source-all-sources",
                preset: "volume-percent-source-all-sources",
                parent: "volume-percent-source"
            }, {
                keysetPrefix: "search-engine",
                id: "volume-percent-source-search-engine",
                preset: "volume-percent-source-search-engine",
                parent: "volume-percent-source"
            }, {
                keysetPrefix: "ad-clicks",
                id: "volume-percent-source-ad-clicks",
                preset: "volume-percent-source-ad-clicks",
                parent: "volume-percent-source"
            }, {
                keysetPrefix: "clicks-on-links-on-websites",
                id: "volume-percent-source-clicks-on-links-on-websites",
                preset: "volume-percent-source-clicks-on-links-on-websites",
                parent: "volume-percent-source"
            }, {
                keysetPrefix: "social-network",
                id: "volume-percent-source-social-network",
                preset: "volume-percent-source-social-network",
                parent: "volume-percent-source"
            }, {
                keysetPrefix: "new-visitors",
                id: "volume-percent-characteristics-of-visitors-new-visitors",
                preset: "volume-percent-characteristics-of-visitors-new-visitors",
                parent: "volume-percent-characteristics-of-visitors"
            }, {
                keysetPrefix: "geography-city",
                id: "volume-percent-characteristics-of-visitors-geography-city",
                preset: "volume-percent-characteristics-of-visitors-geography-city",
                parent: "volume-percent-characteristics-of-visitors"
            }, {
                keysetPrefix: "age",
                id: "volume-percent-characteristics-of-visitors-age",
                preset: "volume-percent-characteristics-of-visitors-age",
                parent: "volume-percent-characteristics-of-visitors"
            }, {
                keysetPrefix: "floor",
                id: "volume-percent-characteristics-of-visitors-floor",
                preset: "volume-percent-characteristics-of-visitors-floor",
                parent: "volume-percent-characteristics-of-visitors"
            }, {
                keysetPrefix: "the-type-of-device",
                id: "volume-percent-characteristics-of-visitors-the-type-of-device",
                preset: "volume-percent-characteristics-of-visitors-the-type-of-device",
                parent: "volume-percent-characteristics-of-visitors"
            }, {
                keysetPrefix: "conversion",
                id: "quality-traffic-sources-all-sources-conversion",
                preset: "quality-traffic-sources-all-sources-conversion",
                goal: !0,
                parent: "quality-traffic-sources-all-sources",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "quality-traffic-sources-all-sources-waivers",
                preset: "quality-traffic-sources-all-sources-waivers",
                parent: "quality-traffic-sources-all-sources"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "quality-traffic-sources-all-sources-time-on-the-website",
                preset: "quality-traffic-sources-all-sources-time-on-the-website",
                parent: "quality-traffic-sources-all-sources"
            }, {
                keysetPrefix: "depth-of-view",
                id: "quality-traffic-sources-all-sources-depth-of-view",
                preset: "quality-traffic-sources-all-sources-depth-of-view",
                parent: "quality-traffic-sources-all-sources"
            }, {
                keysetPrefix: "conversion",
                id: "quality-traffic-sources-search-engine-conversion",
                preset: "quality-traffic-sources-search-engine-conversion",
                goal: !0,
                parent: "quality-traffic-sources-search-engine",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "quality-traffic-sources-search-engine-waivers",
                preset: "quality-traffic-sources-search-engine-waivers",
                parent: "quality-traffic-sources-search-engine"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "quality-traffic-sources-search-engine-time-on-the-website",
                preset: "quality-traffic-sources-search-engine-time-on-the-website",
                parent: "quality-traffic-sources-search-engine"
            }, {
                keysetPrefix: "depth-of-view",
                id: "quality-traffic-sources-search-engine-depth-of-view",
                preset: "quality-traffic-sources-search-engine-depth-of-view",
                parent: "quality-traffic-sources-search-engine"
            }, {
                keysetPrefix: "conversion",
                id: "search-phrases-conversion",
                preset: "search-phrases-conversion",
                goal: !0,
                parent: "search-phrases",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "search-phrases-waivers",
                preset: "search-phrases-waivers",
                parent: "search-phrases"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "search-phrases-time-on-the-website",
                preset: "search-phrases-time-on-the-website",
                parent: "search-phrases"
            }, {
                keysetPrefix: "depth-of-view",
                id: "search-phrases-depth-of-view",
                preset: "search-phrases-depth-of-view",
                parent: "search-phrases"
            }, {
                keysetPrefix: "conversion",
                id: "advertising-system-conversion",
                preset: "advertising-system-conversion",
                goal: !0,
                parent: "advertising-system",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "advertising-system-waivers",
                preset: "advertising-system-waivers",
                parent: "advertising-system"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "advertising-system-time-on-the-website",
                preset: "advertising-system-time-on-the-website",
                parent: "advertising-system"
            }, {
                keysetPrefix: "depth-of-view",
                id: "advertising-system-depth-of-view",
                preset: "advertising-system-depth-of-view",
                parent: "advertising-system"
            }, {
                keysetPrefix: "conversion",
                id: "reference-traffic-conversion",
                preset: "reference-traffic-conversion",
                goal: !0,
                parent: "reference-traffic",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "reference-traffic-waivers",
                preset: "reference-traffic-waivers",
                parent: "reference-traffic"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "reference-traffic-time-on-the-website",
                preset: "reference-traffic-time-on-the-website",
                parent: "reference-traffic"
            }, {
                keysetPrefix: "depth-of-view",
                id: "reference-traffic-depth-of-view",
                preset: "reference-traffic-depth-of-view",
                parent: "reference-traffic"
            }, {
                keysetPrefix: "conversion",
                id: "quality-traffic-sources-social-network-conversion",
                preset: "quality-traffic-sources-social-network-conversion",
                goal: !0,
                parent: "quality-traffic-sources-social-network",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "quality-traffic-sources-social-network-waivers",
                preset: "quality-traffic-sources-social-network-waivers",
                parent: "quality-traffic-sources-social-network"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "quality-traffic-sources-social-network-time-on-the-website",
                preset: "quality-traffic-sources-social-network-time-on-the-website",
                parent: "quality-traffic-sources-social-network"
            }, {
                keysetPrefix: "depth-of-view",
                id: "quality-traffic-sources-social-network-depth-of-view",
                preset: "quality-traffic-sources-social-network-depth-of-view",
                parent: "quality-traffic-sources-social-network"
            }, {
                keysetPrefix: "conversion",
                id: "the-quality-and-characteristics-of-visitors-geography-city-conversion",
                preset: "the-quality-and-characteristics-of-visitors-geography-city-conversion",
                goal: !0,
                parent: "the-quality-and-characteristics-of-visitors-geography-city",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-quality-and-characteristics-of-visitors-geography-city-waivers",
                preset: "the-quality-and-characteristics-of-visitors-geography-city-waivers",
                parent: "the-quality-and-characteristics-of-visitors-geography-city"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-quality-and-characteristics-of-visitors-geography-city-time-on-the-website",
                preset: "the-quality-and-characteristics-of-visitors-geography-city-time-on-the-website",
                parent: "the-quality-and-characteristics-of-visitors-geography-city"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-quality-and-characteristics-of-visitors-geography-city-depth-of-view",
                preset: "the-quality-and-characteristics-of-visitors-geography-city-depth-of-view",
                parent: "the-quality-and-characteristics-of-visitors-geography-city"
            }, {
                keysetPrefix: "conversion",
                id: "novelty-conversion",
                preset: "novelty-conversion",
                goal: !0,
                parent: "novelty",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "novelty-waivers",
                preset: "novelty-waivers",
                parent: "novelty"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "novelty-time-on-the-website",
                preset: "novelty-time-on-the-website",
                parent: "novelty"
            }, {
                keysetPrefix: "depth-of-view",
                id: "novelty-depth-of-view",
                preset: "novelty-depth-of-view",
                parent: "novelty"
            }, {
                keysetPrefix: "conversion",
                id: "the-quality-and-characteristics-of-visitors-age-conversion",
                preset: "the-quality-and-characteristics-of-visitors-age-conversion",
                goal: !0,
                parent: "the-quality-and-characteristics-of-visitors-age",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-quality-and-characteristics-of-visitors-age-waivers",
                preset: "the-quality-and-characteristics-of-visitors-age-waivers",
                parent: "the-quality-and-characteristics-of-visitors-age"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-quality-and-characteristics-of-visitors-age-time-on-the-website",
                preset: "the-quality-and-characteristics-of-visitors-age-time-on-the-website",
                parent: "the-quality-and-characteristics-of-visitors-age"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-quality-and-characteristics-of-visitors-age-depth-of-view",
                preset: "the-quality-and-characteristics-of-visitors-age-depth-of-view",
                parent: "the-quality-and-characteristics-of-visitors-age"
            }, {
                keysetPrefix: "conversion",
                id: "the-quality-and-characteristics-of-visitors-floor-conversion",
                preset: "the-quality-and-characteristics-of-visitors-floor-conversion",
                goal: !0,
                parent: "the-quality-and-characteristics-of-visitors-floor",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-quality-and-characteristics-of-visitors-floor-waivers",
                preset: "the-quality-and-characteristics-of-visitors-floor-waivers",
                parent: "the-quality-and-characteristics-of-visitors-floor"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-quality-and-characteristics-of-visitors-floor-time-on-the-website",
                preset: "the-quality-and-characteristics-of-visitors-floor-time-on-the-website",
                parent: "the-quality-and-characteristics-of-visitors-floor"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-quality-and-characteristics-of-visitors-floor-depth-of-view",
                preset: "the-quality-and-characteristics-of-visitors-floor-depth-of-view",
                parent: "the-quality-and-characteristics-of-visitors-floor"
            }, {
                keysetPrefix: "conversion",
                id: "the-quality-and-characteristics-of-visitors-the-type-of-device-conversion",
                preset: "the-quality-and-characteristics-of-visitors-the-type-of-device-conversion",
                goal: !0,
                parent: "the-quality-and-characteristics-of-visitors-the-type-of-device",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-quality-and-characteristics-of-visitors-the-type-of-device-waivers",
                preset: "the-quality-and-characteristics-of-visitors-the-type-of-device-waivers",
                parent: "the-quality-and-characteristics-of-visitors-the-type-of-device"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-quality-and-characteristics-of-visitors-the-type-of-device-time-on-the-website",
                preset: "the-quality-and-characteristics-of-visitors-the-type-of-device-time-on-the-website",
                parent: "the-quality-and-characteristics-of-visitors-the-type-of-device"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-quality-and-characteristics-of-visitors-the-type-of-device-depth-of-view",
                preset: "the-quality-and-characteristics-of-visitors-the-type-of-device-depth-of-view",
                parent: "the-quality-and-characteristics-of-visitors-the-type-of-device"
            }, {
                keysetPrefix: "conversion",
                id: "advertising-campaign-conversion",
                preset: "advertising-campaign-conversion",
                goal: !0,
                parent: "advertising-campaign",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "advertising-campaign-waivers",
                preset: "advertising-campaign-waivers",
                parent: "advertising-campaign"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "advertising-campaign-time-on-the-website",
                preset: "advertising-campaign-time-on-the-website",
                parent: "advertising-campaign"
            }, {
                keysetPrefix: "depth-of-view",
                id: "advertising-campaign-depth-of-view",
                preset: "advertising-campaign-depth-of-view",
                parent: "advertising-campaign"
            }, {
                keysetPrefix: "conversion",
                id: "ad-conversion",
                preset: "ad-conversion",
                goal: !0,
                parent: "ad",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "ad-waivers",
                preset: "ad-waivers",
                parent: "ad"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "ad-time-on-the-website",
                preset: "ad-time-on-the-website",
                parent: "ad"
            }, {
                keysetPrefix: "depth-of-view",
                id: "ad-depth-of-view",
                preset: "ad-depth-of-view",
                parent: "ad"
            }, {
                keysetPrefix: "conversion",
                id: "playground-conversion",
                preset: "playground-conversion",
                goal: !0,
                parent: "playground",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "playground-waivers",
                preset: "playground-waivers",
                parent: "playground"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "playground-time-on-the-website",
                preset: "playground-time-on-the-website",
                parent: "playground"
            }, {
                keysetPrefix: "depth-of-view",
                id: "playground-depth-of-view",
                preset: "playground-depth-of-view",
                parent: "playground"
            }, {
                keysetPrefix: "conversion",
                id: "keyword-conversion",
                preset: "keyword-conversion",
                goal: !0,
                parent: "keyword",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "keyword-waivers",
                preset: "keyword-waivers",
                parent: "keyword"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "keyword-time-on-the-website",
                preset: "keyword-time-on-the-website",
                parent: "keyword"
            }, {
                keysetPrefix: "depth-of-view",
                id: "keyword-depth-of-view",
                preset: "keyword-depth-of-view",
                parent: "keyword"
            }, {
                keysetPrefix: "conversion",
                id: "utm_source-conversion",
                preset: "utm_source-conversion",
                goal: !0,
                parent: "utm_source",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "utm_source-waivers",
                preset: "utm_source-waivers",
                parent: "utm_source"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "utm_source-time-on-the-website",
                preset: "utm_source-time-on-the-website",
                parent: "utm_source"
            }, {
                keysetPrefix: "depth-of-view",
                id: "utm_source-depth-of-view",
                preset: "utm_source-depth-of-view",
                parent: "utm_source"
            }, {
                keysetPrefix: "conversion",
                id: "utm_medium-conversion",
                preset: "utm_medium-conversion",
                goal: !0,
                parent: "utm_medium",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "utm_medium-waivers",
                preset: "utm_medium-waivers",
                parent: "utm_medium"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "utm_medium-time-on-the-website",
                preset: "utm_medium-time-on-the-website",
                parent: "utm_medium"
            }, {
                keysetPrefix: "depth-of-view",
                id: "utm_medium-depth-of-view",
                preset: "utm_medium-depth-of-view",
                parent: "utm_medium"
            }, {
                keysetPrefix: "conversion",
                id: "utm_term-conversion",
                preset: "utm_term-conversion",
                goal: !0,
                parent: "utm_term",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "utm_term-waivers",
                preset: "utm_term-waivers",
                parent: "utm_term"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "utm_term-time-on-the-website",
                preset: "utm_term-time-on-the-website",
                parent: "utm_term"
            }, {
                keysetPrefix: "depth-of-view",
                id: "utm_term-depth-of-view",
                preset: "utm_term-depth-of-view",
                parent: "utm_term"
            }, {
                keysetPrefix: "conversion",
                id: "utm_content-conversion",
                preset: "utm_content-conversion",
                goal: !0,
                parent: "utm_content",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "utm_content-waivers",
                preset: "utm_content-waivers",
                parent: "utm_content"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "utm_content-time-on-the-website",
                preset: "utm_content-time-on-the-website",
                parent: "utm_content"
            }, {
                keysetPrefix: "depth-of-view",
                id: "utm_content-depth-of-view",
                preset: "utm_content-depth-of-view",
                parent: "utm_content"
            }, {
                keysetPrefix: "conversion",
                id: "utm_campaign-parameters-conversion",
                preset: "utm_campaign-parameters-conversion",
                goal: !0,
                parent: "utm_campaign-parameters",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "utm_campaign-parameters-waivers",
                preset: "utm_campaign-parameters-waivers",
                parent: "utm_campaign-parameters"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "utm_campaign-parameters-time-on-the-website",
                preset: "utm_campaign-parameters-time-on-the-website",
                parent: "utm_campaign-parameters"
            }, {
                keysetPrefix: "depth-of-view",
                id: "utm_campaign-parameters-depth-of-view",
                preset: "utm_campaign-parameters-depth-of-view",
                parent: "utm_campaign-parameters"
            }, {
                keysetPrefix: "conversion",
                id: "bestworst-sources-search-phrases-conversion",
                preset: "bestworst-sources-search-phrases-conversion",
                goal: !0,
                parent: "bestworst-sources-search-phrases",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "bestworst-sources-search-phrases-waivers",
                preset: "bestworst-sources-search-phrases-waivers",
                parent: "bestworst-sources-search-phrases"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "bestworst-sources-search-phrases-time-on-the-website",
                preset: "bestworst-sources-search-phrases-time-on-the-website",
                parent: "bestworst-sources-search-phrases"
            }, {
                keysetPrefix: "depth-of-view",
                id: "bestworst-sources-search-phrases-depth-of-view",
                preset: "bestworst-sources-search-phrases-depth-of-view",
                parent: "bestworst-sources-search-phrases"
            }, {
                keysetPrefix: "conversion",
                id: "bestworst-sources-reference-traffic-conversion",
                preset: "bestworst-sources-reference-traffic-conversion",
                goal: !0,
                parent: "bestworst-sources-reference-traffic",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "bestworst-sources-reference-traffic-waivers",
                preset: "bestworst-sources-reference-traffic-waivers",
                parent: "bestworst-sources-reference-traffic"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "bestworst-sources-reference-traffic-time-on-the-website",
                preset: "bestworst-sources-reference-traffic-time-on-the-website",
                parent: "bestworst-sources-reference-traffic"
            }, {
                keysetPrefix: "depth-of-view",
                id: "bestworst-sources-reference-traffic-depth-of-view",
                preset: "bestworst-sources-reference-traffic-depth-of-view",
                parent: "bestworst-sources-reference-traffic"
            }, {
                keysetPrefix: "conversion",
                id: "bestworst-sources-geography-city-conversion",
                preset: "bestworst-sources-geography-city-conversion",
                goal: !0,
                parent: "bestworst-sources-geography-city",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "bestworst-sources-geography-city-waivers",
                preset: "bestworst-sources-geography-city-waivers",
                parent: "bestworst-sources-geography-city"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "bestworst-sources-geography-city-time-on-the-website",
                preset: "bestworst-sources-geography-city-time-on-the-website",
                parent: "bestworst-sources-geography-city"
            }, {
                keysetPrefix: "depth-of-view",
                id: "bestworst-sources-geography-city-depth-of-view",
                preset: "bestworst-sources-geography-city-depth-of-view",
                parent: "bestworst-sources-geography-city"
            }, {
                keysetPrefix: "conversion",
                id: "direct-ads-conversion",
                preset: "direct-ads-conversion",
                goal: !0,
                parent: "direct-ads",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "direct-ads-waivers",
                preset: "direct-ads-waivers",
                parent: "direct-ads"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "direct-ads-time-on-the-website",
                preset: "direct-ads-time-on-the-website",
                parent: "direct-ads"
            }, {
                keysetPrefix: "depth-of-view",
                id: "direct-ads-depth-of-view",
                preset: "direct-ads-depth-of-view",
                parent: "direct-ads"
            }, {
                keysetPrefix: "conversion",
                id: "direct-site-conversion",
                preset: "direct-site-conversion",
                goal: !0,
                parent: "direct-site",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "direct-site-waivers",
                preset: "direct-site-waivers",
                parent: "direct-site"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "direct-site-time-on-the-website",
                preset: "direct-site-time-on-the-website",
                parent: "direct-site"
            }, {
                keysetPrefix: "depth-of-view",
                id: "direct-site-depth-of-view",
                preset: "direct-site-depth-of-view",
                parent: "direct-site"
            }, {
                keysetPrefix: "conversion",
                id: "direct-key-phrases-conversion",
                preset: "direct-key-phrases-conversion",
                goal: !0,
                parent: "direct-key-phrases",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "direct-key-phrases-waivers",
                preset: "direct-key-phrases-waivers",
                parent: "direct-key-phrases"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "direct-key-phrases-time-on-the-website",
                preset: "direct-key-phrases-time-on-the-website",
                parent: "direct-key-phrases"
            }, {
                keysetPrefix: "depth-of-view",
                id: "direct-key-phrases-depth-of-view",
                preset: "direct-key-phrases-depth-of-view",
                parent: "direct-key-phrases"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-search-phrases-conversion",
                preset: "the-worst-sources-search-phrases-conversion",
                goal: !0,
                parent: "the-worst-sources-search-phrases",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-search-phrases-waivers",
                preset: "the-worst-sources-search-phrases-waivers",
                parent: "the-worst-sources-search-phrases"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-search-phrases-time-on-the-website",
                preset: "the-worst-sources-search-phrases-time-on-the-website",
                parent: "the-worst-sources-search-phrases"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-search-phrases-depth-of-view",
                preset: "the-worst-sources-search-phrases-depth-of-view",
                parent: "the-worst-sources-search-phrases"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-reference-traffic-conversion",
                preset: "the-worst-sources-reference-traffic-conversion",
                goal: !0,
                parent: "the-worst-sources-reference-traffic",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-reference-traffic-waivers",
                preset: "the-worst-sources-reference-traffic-waivers",
                parent: "the-worst-sources-reference-traffic"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-reference-traffic-time-on-the-website",
                preset: "the-worst-sources-reference-traffic-time-on-the-website",
                parent: "the-worst-sources-reference-traffic"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-reference-traffic-depth-of-view",
                preset: "the-worst-sources-reference-traffic-depth-of-view",
                parent: "the-worst-sources-reference-traffic"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-geography-city-conversion",
                preset: "the-worst-sources-geography-city-conversion",
                goal: !0,
                parent: "the-worst-sources-geography-city",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-geography-city-waivers",
                preset: "the-worst-sources-geography-city-waivers",
                parent: "the-worst-sources-geography-city"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-geography-city-time-on-the-website",
                preset: "the-worst-sources-geography-city-time-on-the-website",
                parent: "the-worst-sources-geography-city"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-geography-city-depth-of-view",
                preset: "the-worst-sources-geography-city-depth-of-view",
                parent: "the-worst-sources-geography-city"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-direct-ads-conversion",
                preset: "the-worst-sources-direct-ads-conversion",
                goal: !0,
                parent: "the-worst-sources-direct-ads",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-direct-ads-waivers",
                preset: "the-worst-sources-direct-ads-waivers",
                parent: "the-worst-sources-direct-ads"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-direct-ads-time-on-the-website",
                preset: "the-worst-sources-direct-ads-time-on-the-website",
                parent: "the-worst-sources-direct-ads"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-direct-ads-depth-of-view",
                preset: "the-worst-sources-direct-ads-depth-of-view",
                parent: "the-worst-sources-direct-ads"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-direct-site-conversion",
                preset: "the-worst-sources-direct-site-conversion",
                goal: !0,
                parent: "the-worst-sources-direct-site",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-direct-site-waivers",
                preset: "the-worst-sources-direct-site-waivers",
                parent: "the-worst-sources-direct-site"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-direct-site-time-on-the-website",
                preset: "the-worst-sources-direct-site-time-on-the-website",
                parent: "the-worst-sources-direct-site"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-direct-site-depth-of-view",
                preset: "the-worst-sources-direct-site-depth-of-view",
                parent: "the-worst-sources-direct-site"
            }, {
                keysetPrefix: "conversion",
                id: "the-worst-sources-direct-key-phrases-conversion",
                preset: "the-worst-sources-direct-key-phrases-conversion",
                goal: !0,
                parent: "the-worst-sources-direct-key-phrases",
                single: !0
            }, {
                keysetPrefix: "waivers",
                id: "the-worst-sources-direct-key-phrases-waivers",
                preset: "the-worst-sources-direct-key-phrases-waivers",
                parent: "the-worst-sources-direct-key-phrases"
            }, {
                keysetPrefix: "time-on-the-website",
                id: "the-worst-sources-direct-key-phrases-time-on-the-website",
                preset: "the-worst-sources-direct-key-phrases-time-on-the-website",
                parent: "the-worst-sources-direct-key-phrases"
            }, {
                keysetPrefix: "depth-of-view",
                id: "the-worst-sources-direct-key-phrases-depth-of-view",
                preset: "the-worst-sources-direct-key-phrases-depth-of-view",
                parent: "the-worst-sources-direct-key-phrases"
            }]
        ]),
        _presets: function(e) {
            return e
        }({
            "top-exit-pages": {
                type: "table",
                dimension: "ym:s:endURLHash",
                metric: "ym:s:visits",
                sort: "-ym:s:visits",
                onlyTrustedRows: !0,
                table: "visits"
            },
            failures: {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            conversion: {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "depth-of-view": {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-landing-page-landing-pages-failures": {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:bounceRate",
                sort: "-ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-landing-page-landing-pages-conversion": {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-landing-page-landing-pages-depth-of-view": {
                type: "table",
                dimension: "ym:s:startURLHash",
                onlyTrustedRows: !0,
                metric: "ym:s:pageDepth",
                sort: "ym:s:pageDepth",
                table: "visits"
            },
            "slow-pages": {
                type: "table",
                metric: "ym:sp:qTime<quantile>TimingsFullLoad",
                dimension: "ym:sp:URLHash",
                sort: "ym:sp:URLHash",
                table: "site_speed"
            },
            "slow-regions": {
                type: "table",
                metric: "ym:sp:qTime<quantile>TimingsFullLoad",
                dimension: "ym:sp:browserCountry",
                sort: "-ym:sp:qTime<quantile>TimingsFullLoad",
                table: "site_speed"
            },
            "popular-pages": {
                type: "table",
                dimension: "ym:pv:URLHash",
                metric: "ym:pv:pageviews",
                sort: "-ym:pv:pageviews",
                table: "hits"
            },
            "download-file": {
                type: "table",
                dimension: "ym:dl:URLHash",
                metric: "ym:dl:downloads",
                sort: "-ym:dl:downloads",
                table: "downloads"
            },
            "external-links": {
                type: "table",
                dimension: "ym:el:externalLinkHash",
                metric: "ym:el:links",
                sort: "-ym:el:links",
                table: "external_links"
            },
            "the-number-of-goal-achievements": {
                type: "multiline",
                metric: "ym:s:goal<goal_id>reaches",
                multilineMetrics: ["ym:s:goal<goal_id>reaches"],
                sort: "-ym:s:goal<goal_id>reaches",
                table: "visits"
            },
            "the-number-of-target-visits": {
                type: "multiline",
                metric: "ym:s:goal<goal_id>visits",
                multilineMetrics: ["ym:s:goal<goal_id>visits"],
                sort: "-ym:s:goal<goal_id>visits",
                table: "visits"
            },
            "the-goals-and-conversion-conversion": {
                type: "multiline",
                metric: "ym:s:goal<goal_id>conversionRate",
                multilineMetrics: ["ym:s:goal<goal_id>conversionRate"],
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            visits: {
                type: "multiline",
                metric: "ym:s:visits",
                multilineMetrics: ["ym:s:visits"],
                table: "visits"
            },
            visitors: {
                type: "multiline",
                metric: "ym:s:users",
                multilineMetrics: ["ym:s:users"],
                table: "visits"
            },
            views: {
                metric: "ym:s:pageviews",
                multilineMetrics: ["ym:s:pageviews"],
                type: "multiline",
                table: "visits"
            },
            "all-sources": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:trafficSource",
                dimension: "ym:s:trafficSource",
                table: "visits"
            },
            "search-engine": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:searchEngine",
                dimension: "ym:s:searchEngine",
                table: "visits"
            },
            "ad-clicks": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:advEngine",
                dimension: "ym:s:advEngine",
                table: "visits"
            },
            "clicks-on-links-on-websites": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:refererPathLevel1Hash",
                dimension: "ym:s:refererPathLevel1Hash",
                table: "visits"
            },
            "social-network": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:socialNetwork",
                dimension: "ym:s:socialNetwork",
                table: "visits"
            },
            "new-visitors": {
                type: "total",
                metric: "ym:s:visits",
                sort: "ym:s:visits",
                filter: "ym:s:isNewUser=='yes'",
                table: "visits"
            },
            "geography-city": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:regionCity",
                dimension: "ym:s:regionCity",
                table: "visits"
            },
            age: {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:ageInterval",
                dimension: "ym:s:ageInterval",
                table: "visits"
            },
            floor: {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:gender",
                dimension: "ym:s:gender",
                table: "visits"
            },
            "the-type-of-device": {
                type: "table",
                metric: "ym:s:visits",
                sort: "ym:s:deviceCategory",
                dimension: "ym:s:deviceCategory",
                table: "visits"
            },
            "volume-percent-source-all-sources": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:trafficSource",
                table: "visits"
            },
            "volume-percent-source-search-engine": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:<attribution>SearchEngineRoot",
                table: "visits"
            },
            "volume-percent-source-ad-clicks": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:<attribution>AdvEngine",
                table: "visits"
            },
            "volume-percent-source-clicks-on-links-on-websites": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:refererPathLevel1Hash",
                table: "visits"
            },
            "volume-percent-source-social-network": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:socialNetwork",
                table: "visits"
            },
            "volume-percent-characteristics-of-visitors-new-visitors": {
                metric: "ym:s:visits",
                type: "total",
                filter: "ym:s:isNewUser=='yes'",
                sort: "ym:s:visits",
                table: "visits"
            },
            "volume-percent-characteristics-of-visitors-geography-city": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:regionCity",
                sort: "ym:s:visits",
                table: "visits"
            },
            "volume-percent-characteristics-of-visitors-age": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:ageInterval",
                sort: "ym:s:visits",
                table: "visits"
            },
            "volume-percent-characteristics-of-visitors-floor": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:gender",
                sort: "ym:s:visits",
                table: "visits"
            },
            "volume-percent-characteristics-of-visitors-the-type-of-device": {
                metric: "ym:s:visits",
                type: "pie",
                dimension: "ym:s:deviceCategory",
                sort: "ym:s:visits",
                table: "visits"
            },
            "dynamics-of-indicators-conversion": {
                type: "multiline",
                metric: "ym:s:goal<goal_id>conversionRate",
                multilineMetrics: ["ym:s:goal<goal_id>conversionRate"],
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            waivers: {
                type: "multiline",
                metric: "ym:s:bounceRate",
                multilineMetrics: ["ym:s:bounceRate"],
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "time-on-the-website": {
                type: "multiline",
                metric: "ym:s:avgVisitDurationSeconds",
                multilineMetrics: ["ym:s:avgVisitDurationSeconds"],
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "dynamics-of-indicators-depth-of-view": {
                type: "multiline",
                metric: "ym:s:pageDepth",
                multilineMetrics: ["ym:s:pageDepth"],
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "quality-traffic-sources-all-sources-conversion": {
                type: "table",
                dimension: "ym:s:trafficSource",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "quality-traffic-sources-all-sources-waivers": {
                type: "table",
                dimension: "ym:s:trafficSource",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "quality-traffic-sources-all-sources-time-on-the-website": {
                type: "table",
                dimension: "ym:s:trafficSource",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "quality-traffic-sources-all-sources-depth-of-view": {
                type: "table",
                dimension: "ym:s:trafficSource",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "quality-traffic-sources-search-engine-conversion": {
                type: "table",
                dimension: "ym:s:searchEngine",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "quality-traffic-sources-search-engine-waivers": {
                type: "table",
                dimension: "ym:s:searchEngine",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "quality-traffic-sources-search-engine-time-on-the-website": {
                type: "table",
                dimension: "ym:s:searchEngine",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "quality-traffic-sources-search-engine-depth-of-view": {
                type: "table",
                dimension: "ym:s:searchEngine",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "search-phrases-conversion": {
                type: "table",
                dimension: "ym:s:searchPhrase",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:visits",
                table: "visits"
            },
            "search-phrases-waivers": {
                type: "table",
                dimension: "ym:s:searchPhrase",
                metric: "ym:s:bounceRate",
                sort: "ym:s:visits",
                table: "visits"
            },
            "search-phrases-time-on-the-website": {
                type: "table",
                dimension: "ym:s:searchPhrase",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:visits",
                table: "visits"
            },
            "search-phrases-depth-of-view": {
                type: "table",
                dimension: "ym:s:searchPhrase",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "advertising-system-conversion": {
                type: "table",
                dimension: "ym:s:<attribution>AdvEngine",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "advertising-system-waivers": {
                type: "table",
                dimension: "ym:s:<attribution>AdvEngine",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "advertising-system-time-on-the-website": {
                type: "table",
                dimension: "ym:s:<attribution>AdvEngine",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "advertising-system-depth-of-view": {
                type: "table",
                dimension: "ym:s:<attribution>AdvEngine",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "reference-traffic-conversion": {
                type: "table",
                dimension: "ym:s:<attribution>ReferalSource",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "reference-traffic-waivers": {
                type: "table",
                dimension: "ym:s:<attribution>ReferalSource",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "reference-traffic-time-on-the-website": {
                type: "table",
                dimension: "ym:s:<attribution>ReferalSource",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "reference-traffic-depth-of-view": {
                type: "table",
                dimension: "ym:s:<attribution>ReferalSource",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "quality-traffic-sources-social-network-conversion": {
                type: "table",
                dimension: "ym:s:<attribution>SocialNetwork",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "quality-traffic-sources-social-network-waivers": {
                type: "table",
                dimension: "ym:s:<attribution>SocialNetwork",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                table: "visits"
            },
            "quality-traffic-sources-social-network-time-on-the-website": {
                type: "table",
                dimension: "ym:s:<attribution>SocialNetwork",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "quality-traffic-sources-social-network-depth-of-view": {
                type: "table",
                dimension: "ym:s:<attribution>SocialNetwork",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-geography-city-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:regionCity",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-geography-city-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:regionCity",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-geography-city-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:regionCity",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-geography-city-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:regionCity",
                table: "visits"
            },
            "novelty-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:isNewUser",
                table: "visits"
            },
            "novelty-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:isNewUser",
                table: "visits"
            },
            "novelty-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:isNewUser",
                table: "visits"
            },
            "novelty-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:isNewUser",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-age-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:ageInterval",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-age-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:ageInterval",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-age-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:ageInterval",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-age-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:ageInterval",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-floor-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:gender",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-floor-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:gender",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-floor-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:gender",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-floor-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:gender",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-the-type-of-device-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:deviceCategory",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-the-type-of-device-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:deviceCategory",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-the-type-of-device-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:deviceCategory",
                table: "visits"
            },
            "the-quality-and-characteristics-of-visitors-the-type-of-device-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:deviceCategory",
                table: "visits"
            },
            "advertising-campaign-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:directClickOrder",
                table: "visits"
            },
            "advertising-campaign-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:directClickOrder",
                table: "visits"
            },
            "advertising-campaign-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:directClickOrder",
                table: "visits"
            },
            "advertising-campaign-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:directClickOrder",
                table: "visits"
            },
            "ad-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:directClickBanner",
                table: "visits"
            },
            "ad-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:directClickBanner",
                table: "visits"
            },
            "ad-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:directClickBanner",
                table: "visits"
            },
            "ad-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:directClickBanner",
                table: "visits"
            },
            "playground-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:directPlatform",
                table: "visits"
            },
            "playground-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:directPlatform",
                table: "visits"
            },
            "playground-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:directPlatform",
                table: "visits"
            },
            "playground-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:directPlatform",
                table: "visits"
            },
            "keyword-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:directSearchPhrase",
                table: "visits"
            },
            "keyword-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:directSearchPhrase",
                table: "visits"
            },
            "keyword-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:directSearchPhrase",
                table: "visits"
            },
            "keyword-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:directSearchPhrase",
                table: "visits"
            },
            "utm_source-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:UTMSource",
                table: "visits"
            },
            "utm_source-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:UTMSource",
                table: "visits"
            },
            "utm_source-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:UTMSource",
                table: "visits"
            },
            "utm_source-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:UTMSource",
                table: "visits"
            },
            "utm_medium-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:UTMMedium",
                table: "visits"
            },
            "utm_medium-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:UTMMedium",
                table: "visits"
            },
            "utm_medium-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:UTMMedium",
                table: "visits"
            },
            "utm_medium-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:UTMMedium",
                table: "visits"
            },
            "utm_term-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:UTMTerm",
                table: "visits"
            },
            "utm_term-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:UTMTerm",
                table: "visits"
            },
            "utm_term-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:UTMTerm",
                table: "visits"
            },
            "utm_term-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:UTMTerm",
                table: "visits"
            },
            "utm_content-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:UTMContent",
                table: "visits"
            },
            "utm_content-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:UTMContent",
                table: "visits"
            },
            "utm_content-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:UTMContent",
                table: "visits"
            },
            "utm_content-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:UTMContent",
                table: "visits"
            },
            "utm_campaign-parameters-conversion": {
                type: "table",
                metric: "ym:s:goal<goal_id>conversionRate",
                sort: "-ym:s:goal<goal_id>conversionRate",
                dimension: "ym:s:UTMCampaign",
                table: "visits"
            },
            "utm_campaign-parameters-waivers": {
                type: "table",
                metric: "ym:s:bounceRate",
                sort: "ym:s:bounceRate",
                dimension: "ym:s:UTMCampaign",
                table: "visits"
            },
            "utm_campaign-parameters-time-on-the-website": {
                type: "table",
                metric: "ym:s:avgVisitDurationSeconds",
                sort: "-ym:s:avgVisitDurationSeconds",
                dimension: "ym:s:UTMCampaign",
                table: "visits"
            },
            "utm_campaign-parameters-depth-of-view": {
                type: "table",
                metric: "ym:s:pageDepth",
                sort: "-ym:s:pageDepth",
                dimension: "ym:s:UTMCampaign",
                table: "visits"
            },
            "bestworst-sources-search-phrases-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "bestworst-sources-search-phrases-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "bestworst-sources-search-phrases-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "bestworst-sources-search-phrases-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "bestworst-sources-reference-traffic-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "bestworst-sources-reference-traffic-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "bestworst-sources-reference-traffic-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "bestworst-sources-reference-traffic-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "bestworst-sources-geography-city-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "bestworst-sources-geography-city-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "bestworst-sources-geography-city-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "bestworst-sources-geography-city-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "direct-ads-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "direct-ads-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "direct-ads-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "direct-ads-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "direct-site-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "direct-site-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "direct-site-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "direct-site-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "direct-key-phrases-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "direct-key-phrases-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "direct-key-phrases-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "direct-key-phrases-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-search-phrases-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-search-phrases-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "-ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-search-phrases-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-search-phrases-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:searchPhrase",
                sort: "ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-reference-traffic-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-reference-traffic-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "-ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-reference-traffic-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-reference-traffic-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:refererPathLevel1Hash",
                sort: "ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-geography-city-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-geography-city-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "-ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-geography-city-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-geography-city-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:regionCity",
                sort: "ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-direct-ads-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-direct-ads-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "-ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-direct-ads-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-direct-ads-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directClickBanner",
                sort: "ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-direct-site-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-direct-site-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "-ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-direct-site-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-direct-site-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPlatform",
                sort: "ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            },
            "the-worst-sources-direct-key-phrases-conversion": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:goal<goal_id>conversionRate",
                metric: "ym:s:goal<goal_id>conversionRate",
                table: "visits"
            },
            "the-worst-sources-direct-key-phrases-waivers": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "ym:s:bounceRate",
                metric: "ym:s:bounceRate",
                table: "visits"
            },
            "the-worst-sources-direct-key-phrases-time-on-the-website": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:avgVisitDurationSeconds",
                metric: "ym:s:avgVisitDurationSeconds",
                table: "visits"
            },
            "the-worst-sources-direct-key-phrases-depth-of-view": {
                type: "table",
                onlyTrustedRows: !0,
                dimension: "ym:s:directPhraseOrCond",
                sort: "-ym:s:pageDepth",
                metric: "ym:s:pageDepth",
                table: "visits"
            }
        }),
        _popupInner: null,
        _onOpenClick: function() {
            this._popupInner ? this._popup.toggle() : this._initPopup()
        },
        _onAddClick: function() {
            var e = this._model.get("preset"),
                t = this._model.get("goalId"),
                i = jQuery.extend({}, this._presets[e]);
            t && (i.goal = t), this.trigger("select", {
                preset: i
            }), this._popup.hide()
        },
        _model: null,
        _onModelChange: function() {
            var e = this;
            this._model.validate().then(function() {
                e._addButton.setMod("disabled", "")
            }, function() {
                return e._addButton.setMod("disabled", "yes"), Vow.fulfill()
            }).done()
        },
        _onRadioSelect: function(e) {
            var t = e.block.val();
            t && this._updateModel(this.findElem("item", "id", t))
        },
        _initPopup: function() {
            var e = this;
            this._popup.show(), BN("i-content").html({
                block: "dashboard-wizard",
                elem: "popup-inner",
                levels: e._levels
            }).then(function(t) {
                e._model = BN("m-dashboard-wizard").create(), e._model.on("change", e._onModelChange, e), e._popupInner = jQuery(t), e._popup.setContent(e._popupInner), e.domElem = e.domElem.add(e._popupInner), e.domElem.on("click", e.buildSelector("item", "type", "option"), e._onOptionClick), BN("radiobox").on(e.domElem, "change", e._onRadioSelect, e), e.bindTo(e.findElem("add-button"), "click", e._onAddClick), e._addButton = e.findBlockOn("add-button", "button"), e._onModelChange(), e._showItemsChain(Object.keys(e._presets)[0])
            }).done()
        }
    }), BEM.Model.decl("m-dashboard-wizard", {
        attributes: {
            preset: {
                type: "String",
                validate: function() {
                    return Boolean(this.value)
                }
            },
            goal: {
                type: "Boolean",
                "default": !1
            },
            goalId: {
                type: "Number",
                validate: function() {
                    return this.model.get("goal") ? Boolean(this.value) : !Boolean(this.value)
                }
            }
        }
    }), BEM.JSON.decl("goals-panel", {
        onBlock: function(e) {
            var t = e.param("goal");
            e.js({
                currentGoal: t
            }), e.content([e.param("showLabel") && {
                elem: "label",
                content: BEM.I18N("goals-panel", "target")
            }, {
                block: "button",
                mix: [{
                    block: "goals-panel",
                    elem: "button"
                }],
                mods: {
                    size: "s",
                    arrow: "down",
                    "padding-left": "10"
                },
                content: [{
                    block: "wait",
                    mods: {
                        type: "16"
                    }
                }, {
                    block: "goals-panel",
                    elem: "button-text",
                    goalName: t && t.name
                }]
            }])
        },
        onElem: {
            "button-text": function(e) {
                var t, i = e.param("goalName");
                i ? t = BEM.I18N("goals-panel", "target") + ": " + BN("i-string").escapeHTML(i) : (t = BEM.I18N("goals-panel", "choose-target"), e.mods({
                    selected: "no"
                })), e.tag("span").content(t)
            }
        }
    }), BEM.JSON.decl("goals-panel", {
        onBlock: function(e) {
            var t = BN("i-goal");
            e.params().hasOwnProperty("goal") || e.defer(BN("i-report").getMetadata().then(function(i) {
                return i.goalModeAllowed() ? Vow.all([i.getGoal(), t.getGoals()]) : e.remove()
            }).spread(t.getGoalById.bind(t)).then(function(t) {
                e.param("goal", t)
            }))
        }
    }), BEM.JSON.decl("goals-panel", {
        onElem: {
            switcher: function(e) {
                e.content({
                    block: "radio-button",
                    mix: [{
                        block: "goals-panel",
                        elem: "switcher-radio"
                    }],
                    mods: {
                        size: "s"
                    },
                    name: "retargeting",
                    value: 0,
                    content: [{
                        elem: "radio",
                        controlAttrs: {
                            value: 0
                        },
                        content: BEM.I18N("goals-panel", "conversion-goals")
                    }, {
                        elem: "radio",
                        controlAttrs: {
                            value: 1
                        },
                        content: BEM.I18N("goals-panel", "retargeting-goals")
                    }]
                })
            },
            search: function(e) {
                e.content({
                    block: "search-input",
                    mix: [{
                        block: "goals-panel",
                        elem: "search-input"
                    }],
                    mods: {
                        size: "s"
                    },
                    js: {
                        debounce: 0
                    }
                })
            },
            goals: function(e) {
                var t = e.param("currentGoal"),
                    i = e.param("filterPattern"),
                    n = e.param("goals");
                return n && n.length ? void e.content([{
                    elem: "goal-item",
                    mods: {
                        hidden: t ? "" : "yes",
                        empty: "yes"
                    }
                }, n.map(function(e) {
                    return [{
                        elem: "goal-item",
                        goal: e,
                        currentGoal: t,
                        filterPattern: i
                    }, e.steps && e.steps.length && e.steps.map(function(n) {
                        return {
                            elem: "goal-item",
                            mods: {
                                step: "yes"
                            },
                            goal: n,
                            currentGoal: t,
                            filterPattern: i,
                            retargeting: e.is_retargeting
                        }
                    })]
                })]) : void e.content({
                    elem: "empty-message",
                    content: BEM.I18N("goals-panel", "no-data")
                })
            },
            "goal-item": function(e) {
                var t, i, n = e.params(),
                    o = n.goal,
                    s = n.currentGoal,
                    r = n.filterPattern,
                    a = {
                        current: s && s.id === o.id ? "yes" : "",
                        parent: o && o.steps ? "yes" : ""
                    };
                e.js(o && o.id || null), o && (t = n.hasOwnProperty("retargeting") ? n.retargeting : o.is_retargeting, a.retargeting = t ? "yes" : "no"), e.mods(a), i = {
                    block: "goals-panel",
                    elem: "goal-name",
                    goal: o,
                    filterPattern: r
                }, o && o.steps ? e.content(i) : e.content({
                    block: "link",
                    content: i
                })
            },
            "goal-name": function(e) {
                var t = e.param("goal"),
                    i = t ? t.name : BEM.I18N("goals-panel", "no-target");
                e.tag("span").content({
                    block: "filtered-text",
                    text: i,
                    pattern: e.param("filterPattern")
                })
            }
        }
    }), BEM.DOM.decl("goals-panel", {
        onSetMod: {
            js: function() {
                this._currentGoal = this.params.currentGoal, this._button = this.findBlockInside("button"), this._button.on("click", this._handleButtonClick.bind(this))
            }
        },
        setGoal: function(e) {
            var t = BN("i-goal").getGoalById(e, this._goals);
            this._currentGoal && this._currentGoal.id === e || t && t.steps || (this._update(t && t.id), BN("i-report").getMetadata().then(function(e) {
                e.setGoal(t && t.id || null)
            }).done())
        },
        hide: function() {
            this._popup && this._popup.hide()
        },
        destruct: function() {
            return this._popup && this._popup.un("show", this._refreshGoalEnable, this), this._searchInput && this._searchInput.un("search", this._filter, this), this._switcher && this._switcher.un("change", this._onRetargetingChange, this), this.__base.apply(this, arguments)
        },
        _initPopup: function() {
            var e = this._button.findBlockInside("wait"),
                t = this;
            e.show(), this._popup = this.__self.getPopup(), this._waitBlock = this.findBlockInside(this._popup.domElem, "wait"), this._searchInput = this.findBlockInside(this._popup.domElem, "search-input"), this._switcher = this.findBlockOn(this._findPopupElem("switcher-radio"), "radio-button"), this._popup.on("show", this._refreshGoalEnable, this), this._searchInput.on("search", this._filter, this), this._switcher.on("change", this._onRetargetingChange, this), BN("i-goal").getGoals().then(function(e) {
                t._goals = e, t._updateGoalsList(e), t._bindItemClickHandlers(), t._popup.show(t._button)
            }).always(function() {
                e.hide()
            }).done()
        },
        _handleButtonClick: function() {
            this._popup ? this._popup.toggle(this._button) : this._initPopup()
        },
        _updateGoalsList: function(e, t) {
            BEM.DOM.update(this._findPopupElem("goals-list"), BN("i-content").html({
                block: "goals-panel",
                elem: "goals",
                currentGoal: this._currentGoal,
                filterPattern: t,
                goals: e
            }, !0)), this._updateRetargetingStatus()
        },
        _onRetargetingChange: function() {
            this._searchInput.val(""), this._updateRetargetingStatus()
        },
        _updateRetargetingStatus: function() {
            var e = this._findPopupElem("goals");
            this.setMod(e, "retargeting", this._getRetargeting() ? "yes" : "no")
        },
        _getRetargeting: function() {
            return Number(this._switcher.val())
        },
        _filter: function(e, t) {
            var i, n = this._goals,
                o = this;
            "" !== t && (i = this._getRetargeting(), n = jQuery.extend(!0, [], n).filter(function(e) {
                return e.is_retargeting === i
            }).reduce(function(e, i) {
                return i.steps ? o._testPattern(i.name, t) ? e.push(i) : (i.steps = i.steps.filter(function(e) {
                    return o._testPattern(e.name, t) ? !0 : void 0
                }), i.steps.length && e.push(i)) : o._testPattern(i.name, t) && e.push(i), e
            }, [])), this._popup.holdSize(), this._updateGoalsList(n, t), this._refreshGoalEnable(), this._bindItemClickHandlers()
        },
        _testPattern: function(e, t) {
            return -1 !== e.toLowerCase().indexOf(t.toLowerCase())
        },
        _findPopupElem: function() {
            return this.findElem.apply(this, [this._popup.domElem].concat([].slice.call(arguments, 0)))
        },
        _bindItemClickHandlers: function() {
            this._findPopupElem("goal-item").on("click", this._onGoalClick.bind(this))
        },
        _onGoalClick: function(e) {
            var t = this.elemify(e.currentTarget, "goal-item"),
                i = this.elemParams(t),
                n = BN("i-goal").getGoalById(i, this._goals);
            this.hasMod(t, "current", "yes") || this.hasMod(t, "disabled", "yes") || this.hasMod(t, "parent", "yes") || (this._update(n && n.id), this._popup.hide(), this._triggerChanges(n))
        },
        _triggerChanges: function(e) {
            this.trigger("change", {
                goal: e
            })
        },
        _update: function(e) {
            this._currentGoal = BN("i-goal").getGoalById(e, this._goals), this._updateButtonText(this._currentGoal && this._currentGoal.name), this._popup && ("" !== this._searchInput.val() ? this._searchInput.val("") : this._setCurrentGoal(e), this._adjustNoGoalItemVisibility(this._currentGoal))
        },
        _setCurrentGoal: function(e) {
            var t;
            this._popup && (t = this._findPopupElem("goal-item"), this.setMod(t, "current", ""), [].some.call(t, function(t) {
                return t = jQuery(t), e === this.elemParams(t) ? (this.setMod(t, "current", "yes"), !0) : void 0
            }, this))
        },
        _getGoalCounts: function() {},
        _refreshGoalEnable: function() {
            var e = this,
                t = this._getGoalCounts(this._period, this._filters);
            Vow.isPromise(t) ? (this._waitBlock.show(), t.then(function(t) {
                e._refreshItemsEnable(t)
            }).always(function(t) {
                return e._waitBlock.hide(), t
            }).done()) : this._waitBlock.hide()
        },
        _refreshItemsEnable: function(e) {
            [].forEach.call(this._findPopupElem("goal-item"), function(t) {
                var i = jQuery(t),
                    n = this.elemParams(i),
                    o = e[n] || 0;
                this.hasMod(i, "empty", "yes") || this.setMod(i, "disabled", o ? "" : "yes")
            }, this)
        },
        _updateButtonText: function(e) {
            BEM.DOM.replace(this.findElem("button-text"), BN("i-content").html({
                block: "goals-panel",
                elem: "button-text",
                goalName: e
            }, !0))
        },
        _adjustNoGoalItemVisibility: function(e) {
            this.setMod(this._findPopupElem("goal-item", "empty", "yes"), "hidden", e ? "" : "yes")
        }
    }, {
        live: function() {
            return this.liveBindTo("button", "click"), !1
        },
        getPopup: function() {
            var e = jQuery(BN("i-content").html({
                block: "popup",
                js: {
                    directions: ["bottom-center", "bottom-right", "top-center", "top-right", "left"]
                },
                mods: {
                    search: "yes",
                    adaptive: "yes"
                },
                mix: [{
                    block: "goals-panel",
                    elem: "popup"
                }],
                content: [{
                    elem: "tail"
                }, {
                    elem: "content",
                    mix: [{
                        block: "goals-panel",
                        elem: "popup-content"
                    }],
                    content: [{
                        block: "goals-panel",
                        elem: "switcher"
                    }, {
                        block: "goals-panel",
                        elem: "search"
                    }, {
                        block: "wait"
                    }, {
                        block: "goals-panel",
                        elem: "goals-list"
                    }]
                }]
            }, !0)).bem("popup");
            return this.getPopup = function() {
                return e
            }, e
        }
    }), BEM.JSON.decl({
        name: "wait",
        modName: "type",
        modVal: "16"
    }, {
        onElem: {
            wait: function(e) {
                e.params().spinMods = {
                    size: "xxs"
                }
            }
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "data-bind",
        modVal: "dashboard-wizard"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this._model = BN("m-dashboard-wizard").getOne(), this._model.on("goalId", "change", this._onModelGoalChange, this), this._model.on("goal", "change", this._checkGoalAvailability, this), this._checkGoalAvailability(), this._onModelGoalChange()
            }
        },
        destruct: function() {
            this.__base.apply(this, arguments), this._model.un("goalId", "change", this._onModelGoalChange, this)
        },
        _checkGoalAvailability: function() {
            this._model.get("goal") ? this._button.delMod("disabled") : this._button.setMod("disabled", "yes")
        },
        _onModelGoalChange: function() {
            var e = this;
            this._goals || BN("i-goal").getGoals().then(function(t) {
                e._goals = t, e._onModelGoalChange()
            }).done(), this._update(this._model.get("goalId"))
        },
        _triggerChanges: function(e) {
            this._model.set("goalId", e.id)
        }
    }), BEM.JSON.decl({
        name: "goals-panel",
        modName: "mode",
        modVal: "single"
    }, {
        onBlock: function(e) {
            e.mod("data-bind", "report")
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "mode",
        modVal: "single"
    }, {
        _getGoalCounts: function() {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getMetadata()]).spread(function(e, t) {
                return BN("i-goal").getDataCountsByGoals({
                    ids: e.getApiCounterId(),
                    period: this._period,
                    filter: BN("i-filter").buildFilter(this._filter, t.getSegmentsTree())
                }, !1)
            }.bind(this))
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                initAccessor: "_filters",
                set: "_filters"
            },
            "report.period": {
                initAccessor: "_period",
                set: "_period"
            },
            "preset.goal": {
                set: "setGoal"
            }
        },
        _triggerChanges: function(e) {
            BN("i-report").getMetadata().then(function(t) {
                t.setGoal(e && e.id || null)
            }).done()
        }
    }), BEM.JSON.decl("date-selector", {
        onBlock: function(e) {
            var t = e.param("period");
            e.js({
                period: t
            }).content([{
                block: "period-selector",
                mix: [{
                    block: "date-selector",
                    elem: "period"
                }],
                periodName: BN("i-period").periodToName(t)
            }, {
                elem: "period",
                content: {
                    block: "date-range-selector",
                    period: t
                }
            }, e.param("hideGrouping") ? "" : {
                block: "period-group-selector",
                mix: [{
                    block: "date-selector",
                    elem: "period"
                }],
                mods: {
                    "data-bind": e.mod("data-bind"),
                    data: e.mod("data")
                }
            }])
        }
    }), BEM.DOM.decl("date-selector", {
        onSetMod: {
            js: function() {
                this._periodSelector = this.findBlockInside("period-selector"), this._dateRangeSelector = this.findBlockInside("date-range-selector"), this._periodSelector.on("change", this._handlePeriodChange.bind(this)), this._dateRangeSelector.on("change", this._handleRangeChange.bind(this))
            }
        },
        get: function() {
            return this.params.period
        },
        set: function(e) {
            e && !jQuery.equals(this.params.period, e) && (this.params.period = e, this._periodSelector.selectPeriod(BN("i-period").periodToName(e)), this._dateRangeSelector.setPeriod(e), this.trigger("change", e))
        },
        _handlePeriodChange: function(e, t) {
            t && this.set(BN("i-period").nameToPeriod(t))
        },
        _handleRangeChange: function(e, t) {
            BN("metrika-counter").params("period", "custom"), this.set(t)
        }
    }), BEM.JSON.decl("date-range-selector", {
        onBlock: function(e) {
            var t = e.param("period");
            e.js({
                period: t
            }).tag("span").content({
                block: "button",
                mix: {
                    block: "date-range-selector",
                    elem: "selector-button"
                },
                mods: {
                    size: "s"
                },
                content: {
                    block: "date-range-selector",
                    elem: "button-content-wrapper",
                    tag: "span",
                    content: {
                        elem: "button-content"
                    }
                }
            })
        },
        onElem: {
            "button-content": function(e) {
                e.tag("span").beforeContent({
                    block: "icon",
                    elem: "calendar",
                    mix: [{
                        block: "date-range-selector",
                        elem: "calendar-img"
                    }]
                })
            }
        }
    }), BEM.DOM.decl("date-range-selector", {
        onSetMod: {
            js: function() {
                this.period = this.params.period, this._createCalendar(), this._updateButtonContent(this.period)
            }
        },
        setPeriod: function(e) {
            this._updatePeriod(e) && this._superCalendar.setPeriod(this.__self._toCalendarPeriod(e))
        },
        _updatePeriod: function(e) {
            var t = !jQuery.equals(this.period, e) && this.__self._isCorrectPeriod(e);
            return t && (this.period = e, this._updateButtonContent(e)), t
        },
        _onSelectHandler: function(e, t) {
            var i = {
                from: BN("i-date").create(e.year, e.month + 1, e.day).getISODate(),
                to: BN("i-date").create(t.year, t.month + 1, t.day).getISODate()
            };
            this._updatePeriod(i) && this.trigger("change", i)
        },
        _updateButtonContent: function(e) {
            var t = this;
            e && (e = this.__self._toCalendarPeriod(e), e = this._superCalendar.finePeriod(e.from, e.to)), BEM.blocks["i-content"].html({
                block: "date-range-selector",
                elem: "button-content",
                content: e || BEM.I18N("date-range-selector", "choose-period")
            }).then(function(e) {
                BEM.DOM.update(t.elem("button-content-wrapper"), e)
            })
        },
        _createCalendar: function() {
            var e, t = this.findElem("selector-button");
            return t.click(function(e) {
                e.preventDefault()
            }), e = this.period ? this.period : {
                from: BN("i-date").create(),
                to: BN("i-date").create()
            }, this._superCalendar = new SuperCalendar({
                mix: "date-range-selector__calendar",
                selectorWeeks: !0,
                resize: !0,
                animation: !0,
                speedAnimation: "fast",
                fullWidth: !0,
                shadow: !1,
                minYear: this.__self.MIN_DATE.getFullYear(),
                maxYear: this.__self.MAX_DATE.getFullYear(),
                minGrayDate: this.__self.MIN_DATE.format("d.m.Y"),
                maxGrayDate: "tomorrow",
                maxDate: this.__self.MAX_DATE.format("d.m.Y"),
                center: !0,
                submitButton: "show",
                mousewheel: !0,
                period: this.__self._toCalendarPeriod(e),
                onSelect: this._onSelectHandler.bind(this),
                calledElement: t,
                positionElement: t
            }), this._superCalendar
        },
        destruct: function() {
            return this._superCalendar.remove(), this.__base.apply(this, arguments)
        }
    }, {
        MIN_DATE: BN("i-date").create("2008-01-01"),
        MAX_DATE: BN("i-date").create((new Date).getFullYear() + 1 + "-01-01"),
        _isCorrectPeriod: function(e) {
            var t = BN("i-date"),
                i = t.create(e.from),
                n = t.create(e.to);
            return i > n ? !1 : i < this.MIN_DATE || n > this.MAX_DATE ? !1 : !0
        },
        _toCalendarPeriod: function(e) {
            var t = BN("i-date").create(e.from),
                i = BN("i-date").create(e.to);
            return {
                from: {
                    day: t.getDate(),
                    month: t.getMonth(),
                    year: t.getFullYear()
                },
                to: {
                    day: i.getDate(),
                    month: i.getMonth(),
                    year: i.getFullYear()
                }
            }
        }
    }), BEM.JSON.decl("period-selector", {
        onBlock: function(e) {
            var t = e.params().periodName;
            e.js({
                period: t
            }).content([{
                block: "radio-button",
                mods: {
                    size: "s"
                },
                value: t,
                name: "period",
                content: BN("i-period").getPeriodTypes().map(function(e) {
                    return {
                        elem: "radio",
                        elemMods: e === t ? {
                            selected: "selected"
                        } : void 0,
                        controlAttrs: {
                            value: e,
                            autocomplete: "off"
                        },
                        content: BEM.I18N("period-selector", e)
                    }
                })
            }])
        }
    }), BEM.DOM.decl("period-selector", {
        onSetMod: {
            js: function() {
                this._radio = this.findBlockInside("radio-button").on("change", this._changeHandler, this)
            }
        },
        selectPeriod: function(e) {
            e ? (this.params.period = e, this._radio.val(e)) : this._radio.uncheckAll()
        },
        _changeHandler: function() {
            var e = this._radio.val();
            this.params.period !== e && (e && (BN("i-period").setDefaultPeriodName(e), BN("metrika-counter").params("period", e)), this.params.period = e, this.trigger("change", e))
        }
    }), BEM.DOM.decl({
        block: "date-selector",
        modName: "data-bind",
        modVal: "m-dashboard-url-params"
    }, {
        onSetMod: {
            js: function() {
                var e = this;
                this.__base(), this._urlParamsModel = BN("m-dashboard-url-params").getOne(), this._urlParamsModel.ready().then(function() {
                    e.set(BN("i-period").parsePeriod(e._urlParamsModel.get("period")))
                }).done(), this.on("change", this._onChange, this)
            }
        },
        _onChange: function(e, t) {
            this._urlParamsModel.set("period", t), this._urlParamsModel.save().done()
        }
    }, null), BEM.Model.decl("m-dashboard-url-params", {
        attributes: {
            period: {
                type: "String",
                parse: function(e) {
                    return "object" == typeof e ? BN("i-period").stringifyPeriod(e) : e
                },
                "default": function() {
                    return BN("i-period").stringifyPeriod(BN("i-period").getDefault())
                }
            },
            group: {
                type: "String",
                "default": function() {
                    return BN("i-router").getParams().group || BN("i-period").getDefaultGrouping()
                }
            }
        },
        getPeriod: function() {
            return BN("i-period").parsePeriod(this.get("period"))
        },
        isNew: function() {
            return !1
        },
        storage: {
            find: function() {
                return BN("i-router").getParams()
            },
            update: function(e) {
                BEM.blocks["i-router"].replaceParams(e.toJSON(), !0, !0)
            }
        }
    }), BEM.JSON.decl("period-group-selector", {
        onBlock: function(e) {
            var t = e.params(),
                i = BEM.I18N("period-group-selector", "group-by") + " ";
            e.js({
                groups: t.groups
            }).content({
                block: "select",
                js: {
                    textPrefix: i
                },
                name: "group",
                mods: {
                    size: "s",
                    theme: "normal",
                    layout: "content",
                    "combining-label": "yes",
                    disabled: t.disabled ? "yes" : void 0
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    content: t.grouping ? i + BEM.I18N("period-group-selector", "group-by-" + t.grouping) : "&nbsp;"
                }, {
                    elem: "control",
                    content: t.groups.map(function(e) {
                        return {
                            elem: "option",
                            attrs: {
                                value: e,
                                selected: e === t.grouping ? "selected" : void 0
                            },
                            content: BEM.I18N("period-group-selector", "group-by-" + e)
                        }
                    })
                }]
            })
        }
    }), BEM.DOM.decl("period-group-selector", {
        onSetMod: {
            js: function() {
                this._select = this.findBlockInside("select"), this._select.on("change", this._handleChange.bind(this)), this.value = this.get()
            }
        },
        set: function(e) {
            this.value = e, this._select.val(e)
        },
        get: function() {
            return this._select.val()
        },
        _handleChange: function() {
            var e = this.get();
            this.value !== e && (BN("metrika-counter").params("group", e), this.value = e, this.trigger("change", e))
        }
    }), BEM.DOM.decl({
        block: "select",
        modName: "layout",
        modVal: "content"
    }, {
        _calcPopupDimensions: function() {
            this.__base.apply(this, arguments), this._popupContent.css("width", this._getButton().domElem.outerWidth() - 2 * this.__self.FOCUS_OFFSET_HORIZ)
        }
    }, {
        FOCUS_OFFSET_HORIZ: 1
    }), BEM.DOM.decl({
        name: "select",
        modName: "combining-label",
        modVal: "yes"
    }, {
        _setButtonText: function(e) {
            return this.__base(this.params.textPrefix + " " + e)
        }
    }), BEM.JSON.decl({
        name: "period-group-selector",
        modName: "data-bind",
        modVal: "m-dashboard-url-params"
    }, {
        onBlock: function(e) {
            e.param("groups", BN("i-period").ADDITIONAL_GROUPS.concat(BN("i-period").DEFAULT_GROUPS))
        }
    }), BEM.DOM.decl({
        block: "period-group-selector",
        modName: "data-bind",
        modVal: "m-dashboard-url-params"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this._urlParamsModel = BN("m-dashboard-url-params").getOne(), this.set(this._urlParamsModel.get("group")), this.on("change", this._onChange, this)
            }
        },
        _onChange: function(e, t) {
            this._urlParamsModel.set("group", t), this._urlParamsModel.save().done()
        }
    }, null),
    function() {
        var e = "table goal dimension urlParams sort metric filter onlyTrustedRows".split(" "),
            t = "title defaultTitle goal metric dimension sort filter table type".split(" ");
        BEM.Model.decl("m-widget", {
            ALLOWED_TABLES: ["downloads", "external_links", "hits", "site_speed", "visits"],
            LIMIT_PIE: 5,
            LIMIT_TABLE: 10,
            attributes: {
                counterId: {
                    type: "String",
                    "default": function() {
                        return BEM.blocks["i-counters"].getCounterId()
                    }
                },
                groupId: {
                    type: "String",
                    "default": function() {
                        return BEM.blocks["i-counters"].getGroupId() || ""
                    }
                },
                type: {
                    type: "String",
                    "default": "total"
                },
                title: {
                    type: "String"
                },
                defaultTitle: {
                    type: "String",
                    calculate: function() {
                        return "multiline" === this.model.get("type") ? this.model._getDefaultTitleMultiline() : this.model.get("dimension") ? this.model._getDefaultTitleByDimension() : this.model._getDefaultTitleByMetric()
                    },
                    internal: !0
                },
                subtitle: {
                    type: "String",
                    internal: !0,
                    "default": "",
                    calculate: function() {
                        var e = this.model.get("type");
                        return "pie" === e || this.model._isMultilineDimensionMode() ? this.model._getDefaultTitleByMetric() : ""
                    }
                },
                preset: {
                    type: "String",
                    internal: !0
                },
                table: {
                    type: "String",
                    "default": "visits",
                    amend: function() {
                        this.model._setDefaultMetricByTable(), this.model._setDefaultDimension()
                    }
                },
                goal: {
                    type: "String",
                    parse: function(e) {
                        return e ? this.__base(e) : ""
                    },
                    amend: function() {
                        return this.model._setDefaultMetricByGoal()
                    }
                },
                dimension: {
                    type: "String",
                    amend: function() {
                        return this.model._setDefaultDimValues()
                    }
                },
                trustedRowsEnabled: {
                    type: "Boolean",
                    "default": !1,
                    calculate: function() {
                        var e = this;
                        return this.model.getMetricsGroups().then(function(t) {
                            var i = e.model._getAttributesMap(t.metric_groups),
                                n = i[e.model.get("metric")];
                            return n && n.support_confidence && "visits" === e.model.get("table")
                        })
                    },
                    amend: function() {
                        this.get() || this.model.set("onlyTrustedRows", !1)
                    },
                    internal: !0
                },
                onlyTrustedRows: {
                    type: "Boolean",
                    "default": !1
                },
                urlParams: {
                    type: "Model",
                    modelType: "m-dashboard-url-params",
                    internal: !0,
                    "default": function() {
                        return BN("m-dashboard-url-params").getOne()
                    },
                    amend: function() {
                        return this.model._setTotalsAvailability()
                    }
                },
                statState: {
                    type: "String",
                    internal: !0,
                    calculate: function() {
                        var t = this,
                            i = this.model.get("urlParams"),
                            n = e.reduce(function(e, i) {
                                var n = t.model.get(i);
                                return e[i] = n, e
                            }, {});
                        return n.urlParams = i ? this.model.getApiParamsFromUrl() : {}, JSON.stringify(n)
                    }
                },
                titleState: {
                    type: "String",
                    internal: !0,
                    calculate: function() {
                        var e = this;
                        return JSON.stringify(t.reduce(function(t, i) {
                            var n = e.model.get(i);
                            return t[i] = n, t
                        }, {}))
                    }
                },
                goalAvailability: {
                    type: "Boolean",
                    "default": !1,
                    calculate: function() {
                        var e, t = this.model.get("table"),
                            i = (this.model._tables || {})[t] || {};
                        return e = this.model.get("groupId") ? !1 : Boolean(i.enable_goal)
                    },
                    amend: function() {
                        this.get() || this.model.set("goal", "")
                    },
                    internal: !0
                },
                sort: {
                    type: "String",
                    "default": "",
                    calculate: function() {
                        var e = this.get(),
                            t = this.model.get("metric"),
                            i = "-" + t;
                        return e !== t && e !== i ? i : e
                    }
                },
                metric: {
                    type: "String",
                    "default": "ym:s:visits"
                },
                filter: {
                    type: "String",
                    "default": ""
                },
                multilineType: {
                    type: "String",
                    "default": "metrics-list",
                    amend: function() {
                        return Vow.all([this.model._setDefaultDimValues(), this.model._setTotalsAvailability()])
                    }
                },
                multilineMetrics: {
                    type: "Object",
                    "default": ["ym:s:visits"]
                },
                multilineDimValues: {
                    type: "Object",
                    "default": {
                        dimension: "",
                        values: []
                    },
                    amend: function() {
                        return this.model._setTotalsAvailability()
                    }
                },
                totalsAndAverages: {
                    type: "Boolean",
                    "default": !1
                },
                totalsAvailable: {
                    type: "Boolean",
                    "default": !1,
                    internal: !0
                }
            },
            fetch: function() {
                var e = this,
                    t = this.__base.bind(this);
                return this._loadTables().then(function() {
                    return Vow.all([t(), BN("i-counters").getAsync().then(function(t) {
                        e._counter = t
                    })]).then(function() {
                        e._setDefaultMetricByTable(), e._setDefaultDimension()
                    })
                })
            },
            getApiParamsFromUrl: function() {
                var e = this.get("urlParams"),
                    t = e.getPeriod(),
                    i = this.get("type"),
                    n = this.get("dimension"),
                    o = {};
                return ("multiline" === i || "total" === i || n.match("<group>")) && (o.group = e.get("group")), o.date1 = t.from, o.date2 = t.to, o
            },
            getTables: function() {
                if (this._tables) return this._tables;
                throw new Error("widget is not fetched")
            },
            getFilterObject: function() {
                return this.getSegmentsTree().then(function(e) {
                    return BN("i-filter").parseApiFilter(this.get("filter"), e)
                }.bind(this)).fail(function() {
                    return {}
                })
            },
            getSegmentsTree: function() {
                return BN("i-segment-tree").create(this.get("table"))
            },
            isEditable: function() {
                if (!this._counter) throw new Error("need .fetch() first");
                return Boolean(this._counter.getPermissions().write)
            },
            isTotalsEnabled: function() {
                var e = this.get("totalsAvailable");
                return e && this.get("totalsAndAverages")
            },
            hasNoDimValues: function() {
                return this._isMultilineDimensionMode() && !this.get("totalsAvailable")
            },
            getMultilineValues: function() {
                var e = this.get("multilineMetrics");
                return this._isMultilineDimensionMode() && (e = this.get("multilineDimValues").values), e
            },
            getMultilineIndexes: function() {
                return this.getMultilineValues().reduce(function(e, t, i) {
                    return t && e.push(i), e
                }, [])
            },
            getMultilineCount: function() {
                return this.getMultilineValues().filter(Boolean).length
            },
            getReportUrlParams: function() {
                var e = {},
                    t = this.get("type");
                return e.goal = this.get("goal"), e.metrics = this.get("metric"), e.dimensions = this.get("dimension") || "", e.sort = this.get("sort"), e.filter = this.get("filter"), e.table = this.get("table"), e.metric = this.get("metric"), e.title = this.get("title") || this.get("defaultTitle"), -1 !== ["pie", "table"].indexOf(t) ? e.chart_type = "pie" : "multiline" === t ? e = this._setMultilineUrlParams(e) : e.chart_type = "line", e
            },
            getCurrentStatData: function() {
                return this._getStatRequestParams().then(function(e) {
                    return BEM.blocks["i-stat-data-api"].get("/", {
                        params: e
                    })
                })
            },
            getPrevStatData: function() {
                return this._getStatRequestParams().then(function(e) {
                    var t = BN("i-period").prevPeriod({
                        from: e.date1,
                        to: e.date2
                    });
                    return e.date1 = t.from, e.date2 = t.to, BEM.blocks["i-stat-data-api"].get("/", {
                        params: e
                    })
                })
            },
            getDimensionValues: function() {
                var e = this;
                return this._getCommonRequestParams().then(function(t) {
                    return t.limit = 100, t.dimensions = e.get("dimension"), e._checkIncompatibleGoalMetric(t.metrics, t.goal_id) ? Vow.reject() : BEM.blocks["i-stat-data-api"].get("/", {
                        params: t
                    })
                }).then(function(e) {
                    return e.data.map(function(e) {
                        var t = e.dimensions[0];
                        return {
                            value: t.id || t.name,
                            id: t.id || t.name,
                            name: t.name
                        }
                    })
                }).always(function(e) {
                    return e.isFulfilled() ? e.valueOf() : []
                })
            },
            getDimensionValuesMap: function() {
                return this.getDimensionValues().then(function(e) {
                    return e.reduce(function(e, t) {
                        return e[t.value] = t, e
                    }, {})
                })
            },
            getStatRequestParams: function() {
                var e = this;
                return this.ready().then(function() {
                    return e._getStatRequestParams()
                })
            },
            getMetricValuesByDate: function() {
                var e = this;
                return this.getStatDataByTime().then(function(t) {
                    var i, n = t.data[0] ? t.data[0].metrics[0] : [],
                        o = e.get("urlParams"),
                        s = t.query,
                        r = o.get("group");
                    return i = BN("i-period").splitPeriodToGroups(o.getPeriod(), r, s.auto_group_type, s.auto_group_size), n.map(function(e, t) {
                        return {
                            date: i[t].from.getTime(),
                            value: e
                        }
                    })
                })
            },
            getStatDataByTime: function() {
                return this._getStatRequestParams().then(function(e) {
                    return BEM.blocks["i-stat-data-api"].get("/bytime", {
                        params: e
                    })
                })
            },
            getMetricsGroups: function() {
                var e = this;
                return this._getMetricsGroups().then(function(t) {
                    return {
                        metric_groups: e._filterMetricsGroupsByGoal(t.metric_groups)
                    }
                })
            },
            getAttributesTree: function() {
                return BEM.blocks["i-stat-metadata-api"].get("constructor_attributes_tree_table", {
                    params: {
                        table: this.get("table")
                    }
                })
            },
            setFilterObject: function(e) {
                return this.getSegmentsTree().then(function(t) {
                    var i = BN("i-filter").buildFilter(e, t);
                    this.set("filter", i)
                }.bind(this))
            },
            resetFilter: function() {
                this.set("filter", "")
            },
            getDefaultMetric: function() {
                return this.getTables()[this.get("table")][this.get("goal") ? "default_goal_metrics" : "default_metrics"][0].dim
            },
            getMetricsMap: function() {
                var e = this;
                return this.getMetricsGroups().then(function(t) {
                    return e._getAttributesMap(t.metric_groups)
                })
            },
            isDimensionless: function() {
                return this._isMultilineMetricMode()
            },
            storage: {
                find: function(e) {
                    var t = e.id;
                    return t ? BEM.blocks["i-dashboard-api"].fetch("widget", t).then(function(e) {
                        return e[0]
                    }) : {}
                },
                insert: function(e) {
                    return BEM.blocks["i-dashboard-api"].create("widget", e.toJSON()).then(function(e) {
                        return e[0]._id
                    })
                },
                update: function(e) {
                    return BEM.blocks["i-dashboard-api"].update("widget", e.id, e.toJSON())
                },
                remove: function(e) {
                    return BEM.blocks["i-dashboard-api"].remove("widget", e.id)
                }
            },
            _checkIncompatibleGoalMetric: function(e, t) {
                return -1 !== e.indexOf("goal<goal_id>") && !t
            },
            _getCommonRequestParams: function() {
                var e = this;
                return this._getCounterIds().then(function(t) {
                    var i = e.getApiParamsFromUrl(),
                        n = e.get("goal"),
                        o = e.get("filter");
                    return i.ids = t, i.metrics = e.get("metric"), n && e.get("goalAvailability") && (i.goal_id = n), "" !== o && (i.filters = o), i
                })
            },
            _getStatRequestParams: function() {
                var e = this;
                return this._getCommonRequestParams().then(function(t) {
                    var i = e.get("type"),
                        n = e.get("sort"),
                        o = e.get("dimension"),
                        s = e.get("onlyTrustedRows");
                    return s && (t.with_confidence = !0, t.exclude_insignificant = !0), ("pie" === i || "table" === i) && (t.dimensions = o, t.limit = e["LIMIT_" + i.toUpperCase()]), "table" === i && n && (t.sort = n, t.limit = 10), "multiline" === i && (t = e._setMultilineRequestParams(t)), t
                })
            },
            _isMultilineMetricMode: function() {
                return "multiline" === this.get("type") && "metrics-list" === this.get("multilineType")
            },
            _isMultilineDimensionMode: function() {
                return "multiline" === this.get("type") && "dimension-values" === this.get("multilineType")
            },
            _setMultilineRequestParams: function(e) {
                var t, i = this.getMultilineValues().filter(Boolean),
                    n = this;
                return this._isMultilineMetricMode() ? (e.metrics = i.join(","), e.dimensions = "", t = Vow.fulfill(e)) : t = this.getDimensionValuesMap().then(function(t) {
                    return e.dimensions = n.get("dimension"), e.row_ids = JSON.stringify(i.map(function(e) {
                        return t[e] ? [e] : null
                    }).filter(Boolean)), e
                }), t
            },
            _setMultilineUrlParams: function(e) {
                var t = this.getMultilineValues();
                return this._isMultilineMetricMode() && (e.metrics = t.filter(Boolean).join(","), e.dimensions = ""), e.chart_type = "line", e
            },
            _getDefaultTitleByMetric: function() {
                var e = this;
                return this.getMetricsGroups().then(function(t) {
                    var i = e._getAttributesMap(t.metric_groups),
                        n = i[e.get("metric")];
                    return n ? n.name : e.get("metric")
                })
            },
            _setDefaultDimValues: function() {
                var e = this,
                    t = this.get("dimension"),
                    i = this.get("multilineDimValues").dimension;
                return this._isMultilineDimensionMode() && t !== i ? this.getDimensionValues().then(function(e) {
                    return e.slice(0, 3).map(function(e) {
                        return e.value
                    }).concat(["", ""])
                }).then(function(i) {
                    e.set("multilineDimValues", {
                        dimension: t,
                        values: i
                    })
                }) : void 0
            },
            _getAttributesMap: function(e, t) {
                var i = this;
                return t = t || {}, e.forEach(function(e) {
                    e.dim && (t[e.dim] = e), e.chld && i._getAttributesMap(e.chld, t), e.metrics && i._getAttributesMap(e.metrics, t), e.attributes && i._getAttributesMap(e.attributes, t)
                }), t
            },
            _getDefaultTitleMultiline: function() {
                var e = this;
                return this._isMultilineMetricMode() ? this.getMetricsMap().then(function(t) {
                    return e.getMultilineValues().filter(Boolean).map(function(e, i) {
                        var n = t[e] && t[e].name || "";
                        return i > 0 && (n = n.toLowerCase()), n
                    }).join(", ")
                }) : this._getDefaultTitleByDimension()
            },
            _getDefaultTitleByDimension: function() {
                var e = this;
                return this.getAttributesTree().then(function(t) {
                    var i = e._getAttributesMap(t.attribute_groups),
                        n = i[e.get("dimension")];
                    return n ? n.name : e.get("dimension")
                })
            },
            _setDefaultMetricByTable: function() {
                var e = this.getTables()[this.get("table")].namespace;
                this.get("metric").match(e) || this._setDefaultMetric()
            },
            _setDefaultMetricByGoal: function() {
                var e = this;
                return this.getMetricsGroups().then(function(t) {
                    var i = e._getAttributesMap(t.metric_groups),
                        n = i[e.get("metric")];
                    n || e._setDefaultMetric()
                })
            },
            _setDefaultMetric: function() {
                var e = this.getTables()[this.get("table")],
                    t = e[this.get("goal") && e.enable_goal ? "default_goal_metrics" : "default_metrics"][0];
                t && (this.set("metric", t.dim), this.set("multilineMetrics", [t.dim]))
            },
            _setDefaultDimension: function() {
                var e = this.get("type"),
                    t = this.getTables()[this.get("table")].namespace; - 1 === ["pie", "table", "multiline"].indexOf(e) || this.get("dimension").match(t) || this.set("dimension", this.getTables()[this.get("table")].default_dimensions[0].dim)
            },
            _setTotalsAvailability: function() {
                var e = this;
                return this._isMultilineDimensionMode() ? this.getDimensionValues().then(function(t) {
                    e.set("totalsAvailable", t && t.length ? !0 : !1)
                }) : (this.set("totalsAvailable", !1), Vow.fulfill())
            },
            _filterMetricsGroupsByGoal: function(e) {
                var t = Boolean(this.get("goal")),
                    i = this;
                return e.reduce(function(e, n) {
                    var o = n.require_goal === t && n.metrics,
                        s = n.chld && i._filterMetricsGroupsByGoal(n.chld);
                    return (o || s && s.length) && e.push({
                        id: n.id,
                        name: n.name,
                        metrics: o,
                        chld: s
                    }), e
                }, [])
            },
            _getMetricsGroups: function() {
                return BEM.blocks["i-stat-metadata-api"].get("constructor-metrics-groups", {
                    params: {
                        table: this.get("table")
                    }
                })
            },
            _getCounterIds: function() {
                return this.get("groupId") ? BN("i-counters").getAsync().then(function(e) {
                    return e.getApiCounterId()
                }) : Vow.fulfill(this.get("counterId"))
            },
            _loadTables: function() {
                var e = this;
                return Vow.all([BEM.blocks["i-stat-metadata-api"].get("tables").then(function(t) {
                    e._tables = Object.keys(t.tables).reduce(function(i, n) {
                        var o = t.tables[n];
                        return -1 !== e.ALLOWED_TABLES.indexOf(n) && (i[n] = o), i
                    }, {})
                }).then(function() {
                    return e.calculate()
                })])
            }
        })
    }(), BEM.decl("i-dashboard-api", null, BEM.blocks["i-proxy"].initProxy("i-dashboard-api", ["fetch*", "create", "update", "remove"])), BEM.decl("i-dashboard-api", null, {
        create: function() {
            return this._cleanFetchCache(this.__base, arguments)
        },
        remove: function() {
            return this._cleanFetchCache(this.__base, arguments)
        },
        update: function() {
            return this._cleanFetchCache(this.__base, arguments)
        },
        _cleanFetchCache: function(e, t) {
            return e.apply(this, t).then(function(e) {
                return BEM.blocks["i-proxy"].cleanCache("i-dashboard-api", ["fetch"]), e
            })
        }
    }), BEM.Model.decl("m-dashboard", {
        attributes: {
            counterId: {
                type: "Number",
                "default": function() {
                    return BEM.blocks["i-counters"].getCounterId() || ""
                }
            },
            groupId: {
                type: "Number",
                "default": function() {
                    return BEM.blocks["i-counters"].getGroupId() || ""
                }
            },
            items: {
                type: "ModelsList",
                modelType: "m-dashboard-item"
            }
        },
        getWidgetFieldsByPreset: function(e) {
            var t = this._getPresets()[e];
            return t ? t.preset = e : setTimeout(function() {
                throw new Error("Unknown widget preset")
            }), t
        },
        isEditable: function() {
            if (!this._counter) throw new Error("need .fetch() first");
            return Boolean(this._counter.getPermissions().write)
        },
        save: function() {
            var e = this,
                t = JSON.stringify(this.toJSON());
            return t !== this._dataCacheStr ? this.__base().then(function() {
                e._dataCacheStr = t
            }) : this.ready()
        },
        fetch: function() {
            var e = this;
            return Vow.all([this.__base(), BN("i-counters").getAsync().then(function(t) {
                e._counter = t
            })]).then(function() {
                e._dataCacheStr = JSON.stringify(e.toJSON())
            })
        },
        getDashboardItemModelByType: function(e) {
            var t = this.get("items"),
                i = BN("m-dashboard-item").create({
                    defaultWidget: e
                });
            return t.push(i), i
        },
        storage: {
            find: function(e) {
                var t = this;
                return BEM.blocks["i-dashboard-api"].fetch("dashboard", t._getFetchId(e)).then(function(i) {
                    var n = i[0] || t._getDefaultDashboard(),
                        o = [];
                    return n._id && (e.id = n._id), n.items.forEach(function(t, i) {
                        t.widgetModels = t.widgets.map(function(t) {
                            var i, n = t.preset && e.getWidgetFieldsByPreset(t.preset);
                            return t.hasOwnProperty("_id") ? i = BN("m-widget").create(t._id) : n && (i = BN("m-widget").create(n)), i && o.push(i.fetch().always(function(e) {
                                return setTimeout(e.done.bind(e)), Vow.fulfill()
                            })), i
                        }).filter(Boolean), t.widgetModels.length || (n.items[i] = null)
                    }), n.items = n.items.filter(Boolean), Vow.allResolved(o).then(function() {
                        return n
                    })
                })
            },
            insert: function(e) {
                return BEM.blocks["i-dashboard-api"].create("dashboard", e.toJSON()).then(function(e) {
                    return e[0]._id
                })
            },
            update: function(e) {
                return BEM.blocks["i-dashboard-api"].update("dashboard", e.id, e.toJSON())
            },
            remove: function(e) {
                return BEM.blocks["i-dashboard-api"].remove("dashboard", e.id)
            },
            _getDefaultDashboard: function() {
                return {
                    items: [{
                        widgets: [{
                            preset: "users"
                        }],
                        position: [0, 0]
                    }, {
                        widgets: [{
                            preset: "traffic-source"
                        }],
                        position: [0, 1]
                    }, {
                        widgets: [{
                            preset: "device-category"
                        }],
                        position: [0, 2]
                    }, {
                        widgets: [{
                            preset: "new-users"
                        }],
                        position: [1, 0]
                    }, {
                        widgets: [{
                            preset: "bounce-rate"
                        }],
                        position: [1, 1]
                    }, {
                        widgets: [{
                            preset: "page-depth"
                        }],
                        position: [1, 2]
                    }, {
                        widgets: [{
                            preset: "avg-visit"
                        }],
                        position: [1, 3]
                    }, {
                        widgets: [{
                            preset: "age-interval"
                        }],
                        position: [1, 4]
                    }, {
                        widgets: [{
                            preset: "url"
                        }],
                        position: [2, 0]
                    }, {
                        widgets: [{
                            preset: "search-phrase"
                        }],
                        position: [2, 1]
                    }]
                }
            },
            _getFetchId: function(e) {
                var t = e.get("groupId");
                return t ? {
                    groupId: t
                } : {
                    counterId: e.get("counterId")
                }
            }
        },
        _getPresets: function() {
            var e = {
                "default-total": {
                    type: "total",
                    table: "visits",
                    metric: "ym:s:visits"
                },
                "default-table": {
                    type: "table",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:operatingSystemRoot"
                },
                "default-pie": {
                    type: "pie",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:<attribution>TrafficSource"
                },
                "default-multiline": {
                    type: "multiline",
                    table: "visits",
                    metric: "ym:s:visits",
                    multilineMetrics: ["ym:s:visits"],
                    dimension: "ym:s:<attribution>TrafficSource"
                },
                url: {
                    type: "table",
                    table: "hits",
                    defaultTitle: BEM.I18N("m-dashboard", "widget-url"),
                    metric: "ym:pv:pageviews",
                    dimension: "ym:pv:URLHash"
                },
                users: {
                    type: "multiline",
                    table: "visits",
                    metric: "ym:s:users",
                    multilineMetrics: ["ym:s:users"]
                },
                "new-users": {
                    type: "multiline",
                    table: "visits",
                    metric: "ym:s:newUsers",
                    multilineMetrics: [null, "ym:s:newUsers"]
                },
                "search-phrase": {
                    type: "table",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:searchPhrase"
                },
                "traffic-source": {
                    defaultTitle: BEM.I18N("m-dashboard", "widget-traffic-source"),
                    type: "pie",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:<attribution>TrafficSource"
                },
                "device-category": {
                    type: "pie",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:deviceCategory"
                },
                "age-interval": {
                    type: "pie",
                    table: "visits",
                    metric: "ym:s:visits",
                    dimension: "ym:s:ageInterval"
                },
                "bounce-rate": {
                    type: "total",
                    table: "visits",
                    metric: "ym:s:bounceRate",
                    dimension: ""
                },
                "page-depth": {
                    type: "total",
                    table: "visits",
                    metric: "ym:s:pageDepth"
                },
                "avg-visit": {
                    type: "total",
                    table: "visits",
                    metric: "ym:s:avgVisitDurationSeconds"
                }
            };
            return this._getPresets = function() {
                return e
            }, this._getPresets()
        }
    }), BEM.Model.decl("m-dashboard-item", {
        attributes: {
            widgetModels: {
                type: "ModelsList",
                modelType: "m-widget",
                internal: !0
            },
            widgets: {
                type: "List",
                isEqual: function(e) {
                    return jQuery.equals(e, this.value)
                },
                calculate: function() {
                    return this.model.get("widgetModels").toArray().map(function(e) {
                        var t = e.id,
                            i = e.get("type"),
                            n = e.get("preset");
                        if (t) return {
                            _id: t,
                            type: i
                        };
                        if (n) return {
                            type: i,
                            preset: n
                        };
                        throw new Error("widget should have _id or preset")
                    })
                }
            },
            position: {
                type: "List",
                "default": [0, 0]
            }
        }
    }), BEM.JSON.decl("dashboard-item", {
        onBlock: function(e) {
            var t = e.param("modelId"),
                i = BN("m-dashboard-item").getOne(t),
                n = i.get("widgetModels").get(0).get("type");
            e.mod("widget-type", n), e.js({
                modelId: t
            }), e.content([{
                elem: "drag"
            }, {
                elem: "widgets",
                content: [i.get("widgetModels").toArray().map(function(e) {
                    return {
                        elem: "widget",
                        widgetModel: e
                    }
                })]
            }])
        },
        onElem: {
            drag: function(e) {
                e.mix([{
                    block: "icon",
                    elem: "drag2"
                }, {
                    block: "dashboard-page",
                    elem: "item-drag"
                }, {
                    block: "dashboard-page",
                    elem: "edit-control"
                }])
            },
            widget: function(e) {
                var t = e.param("widgetModel");
                e.wrap([{
                    block: "widget",
                    widgetModelId: t.cid,
                    mods: {
                        type: t.get("type")
                    },
                    mix: e.params().mix
                }])
            }
        }
    }), BEM.DOM.decl("dashboard-item", {
        onSetMod: {
            js: function() {
                var e;
                this._model = BN("m-dashboard-item").getOne(this.params.modelId), this._model.on("change", this._onModelChange, this), e = this._model.get("widgetModels"), this._widgetsCount = e.length(), this._widgetPreview = this.findBlockInside("widget-preview"), this._afterDrag = this._afterDrag.bind(this), this._beforeDrag = this._beforeDrag.bind(this), this.domElem.get(0).addEventListener("dragstart", this._beforeDrag), this.domElem.get(0).addEventListener("dragend", this._afterDrag)
            }
        },
        destruct: function() {
            this._model.un("change", this._onModelChange, this), this.__base.apply(this, arguments)
        },
        _beforeDrag: function() {
            this._widgetPreview && this._widgetPreview.beforeDrag()
        },
        _afterDrag: function() {
            this._widgetPreview && this._widgetPreview.afterDrag()
        },
        _renderAddedWidget: function() {
            var e = this._model.get("widgetModels"),
                t = e.get(e.length() - 1),
                i = this;
            return BEM.blocks["i-content"].append(this.elem("widgets"), {
                block: "dashboard-item",
                elem: "widget",
                widgetModel: t,
                mix: [{
                    block: "dashboard-page",
                    elem: "new-item"
                }]
            }).then(function() {
                i.trigger("newWidget")
            })
        },
        _onModelChange: function() {
            var e = this._model.get("widgetModels").length();
            0 === e ? (this._model.destruct(), this.destruct()) : e > this._widgetsCount && this._renderAddedWidget(), this._widgetsCount = e
        }
    }), BEM.JSON.decl("widget", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            })
        },
        onElem: {
            popup: function(e) {
                var t = e.params();
                e.wrap([{
                    block: "popup",
                    mods: {
                        type: "modal",
                        autoclosable: "no",
                        wrapped: "yes",
                        behaviour: "scrollable",
                        "body-scroll": "no",
                        animate: "no",
                        padding: "no"
                    },
                    mix: [{
                        block: "widget",
                        elem: "popup"
                    }],
                    underMods: {
                        type: "paranja"
                    },
                    content: [{
                        elem: "wrapper",
                        mods: {
                            behaviour: "scrollable",
                            "overflow-y": "scroll"
                        }
                    }, {
                        elem: "close",
                        mix: [{
                            block: "widget",
                            elem: "popup-close"
                        }],
                        content: {
                            block: "icon",
                            mix: [{
                                elem: "close"
                            }, {
                                block: "widget",
                                elem: "close"
                            }]
                        }
                    }, {
                        elem: "content",
                        mix: [{
                            block: "widget",
                            elem: "popup-content"
                        }],
                        content: {
                            block: "widget",
                            elem: "popup-inner",
                            content: [{
                                block: "widget",
                                elem: "tabs-container",
                                type: t.type,
                                widgetModelId: t.widgetModelId
                            }, {
                                block: "widget",
                                elem: "preview",
                                content: {
                                    elem: "preview-inner",
                                    widgetModelId: t.widgetModelId
                                }
                            }, {
                                block: "widget",
                                elem: "controls"
                            }]
                        }
                    }]
                }])
            },
            "tabs-container": function(e) {
                var t = e.params(),
                    i = BN("widget").getTabs(t.type),
                    n = jQuery.identify();
                e.content([{
                    elem: "static-title"
                }, {
                    block: "tabs",
                    js: !0,
                    panes: n,
                    mix: [{
                        block: "widget",
                        elem: "tabs"
                    }],
                    mods: {
                        control: "menu",
                        size: "s",
                        layout: "horiz",
                        theme: "metrika"
                    },
                    content: i.map(function(e, t) {
                        return {
                            elem: "tab",
                            content: [BEM.I18N("widget", e + "-tab"), {
                                block: "tabs-menu",
                                elem: "count",
                                content: [{
                                    elem: "count-value"
                                }]
                            }],
                            elemMods: {
                                active: 0 === t ? "yes" : "",
                                type: e
                            }
                        }
                    })
                }, {
                    elem: "tabs-panes-wrap",
                    content: [{
                        block: "tabs-panes",
                        id: n,
                        js: !0,
                        mix: [{
                            block: "widget",
                            elem: "tab-pane"
                        }],
                        content: i.map(function(e, i) {
                            return {
                                elem: "pane",
                                elemMods: {
                                    active: 0 === i ? "yes" : ""
                                },
                                content: {
                                    block: "widget",
                                    mods: {
                                        type: t.type
                                    },
                                    elem: e + "-tab",
                                    widgetModelId: t.widgetModelId
                                }
                            }
                        })
                    }]
                }])
            },
            "main-tab": function(e) {
                BN("widget").mixWidgetModelId(e)
            },
            "chart-tab": function(e) {
                BN("widget").mixWidgetModelId(e)
            },
            "segmentation-tab": function(e) {
                e.content([{
                    elem: "segmentation"
                }]), BN("widget").mixWidgetModelId(e)
            },
            "preview-inner": function(e) {
                e.content([{
                    elem: "title",
                    isNewTab: !0
                }, {
                    elem: "widget-preview"
                }]), BN("widget").mixWidgetModelId(e)
            },
            controls: function(e) {
                e.wrap([{
                    elem: "buttons",
                    content: [{
                        elem: "readonly-message",
                        content: BEM.I18N("widget", "readonly-message")
                    }, {
                        elem: "save"
                    }, {
                        elem: "cancel"
                    }]
                }, {
                    elem: "remove"
                }])
            },
            goals: function(e) {
                e.content({
                    block: "goals-panel",
                    mods: {
                        "data-bind": "widget-model"
                    },
                    showLabel: !0,
                    widgetModelId: BN("widget").getWidgetModelId(e),
                    mix: {
                        block: "widget",
                        elem: "goals-panel"
                    }
                })
            },
            name: function(e) {
                e.content([{
                    block: "input",
                    mods: {
                        size: "s",
                        clear: "no"
                    },
                    mix: {
                        block: "widget",
                        elem: "title-input"
                    },
                    content: [{
                        elem: "label",
                        content: "Название"
                    }, {
                        elem: "hint"
                    }, {
                        elem: "control"
                    }]
                }])
            },
            "multiline-type": function(e) {
                var t = jQuery.identify();
                e.content([{
                    elem: "label",
                    content: BEM.I18N("widget", "show-on-chart")
                }, {
                    block: "radiobox",
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "widget",
                        elem: "multiline-type-selector"
                    }],
                    name: t,
                    content: ["metrics-list", "dimension-values"].map(function(e) {
                        return {
                            block: "widget",
                            elem: "radio",
                            content: {
                                block: "radiobox",
                                elem: "radio",
                                content: BEM.I18N("widget", e),
                                controlAttrs: {
                                    value: e
                                }
                            }
                        }
                    })
                }])
            },
            title: function(e) {
                e.content({
                    block: "widget-title",
                    mods: {
                        "new-tab": e.param("isNewTab") ? "yes" : ""
                    },
                    widgetModelId: BN("widget").getWidgetModelId(e)
                })
            },
            table: function(e) {
                e.content({
                    block: "table-selector",
                    selectMods: {
                        layout: "fixed",
                        width: "260"
                    },
                    widgetModelId: BN("widget").getWidgetModelId(e)
                })
            },
            metrics: function(e) {
                e.content({
                    block: "attributes-selector",
                    mods: {
                        type: "metrics"
                    },
                    widgetModelId: BN("widget").getWidgetModelId(e)
                })
            },
            dimensions: function(e) {
                e.content({
                    block: "attributes-selector",
                    mods: {
                        type: "dimensions"
                    },
                    widgetModelId: BN("widget").getWidgetModelId(e)
                })
            },
            segmentation: function(e) {
                e.content({
                    block: "widget-segmentation",
                    widgetModelId: BN("widget").getWidgetModelId(e)
                })
            },
            "multiline-selector": function(e) {
                e.content([{
                    elem: "label",
                    content: BEM.I18N("widget", "chart-lines")
                }, {
                    block: "widget-multiline-selector",
                    widgetModelId: BN("widget").getWidgetModelId(e)
                }, {
                    block: "widget-totals",
                    mix: [{
                        block: "widget",
                        elem: "totals"
                    }],
                    widgetModelId: BN("widget").getWidgetModelId(e)
                }])
            },
            cancel: function(e) {
                e.content({
                    block: "button",
                    mix: {
                        block: "widget",
                        elem: "cancel-button"
                    },
                    mods: {
                        size: "s",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("widget", "cancel")
                })
            },
            save: function(e) {
                e.content({
                    block: "button",
                    mix: {
                        block: "widget",
                        elem: "save-button"
                    },
                    mods: {
                        size: "s",
                        theme: "action",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("widget", "save")
                })
            },
            edit: function(e) {
                e.mix([{
                    block: "icon",
                    elem: "gear2"
                }])
            },
            remove: function(e) {
                e.content({
                    block: "button",
                    mods: {
                        pseudo: "yes",
                        "only-icon": "yes",
                        size: "m"
                    },
                    mix: {
                        block: "widget",
                        elem: "remove-button"
                    },
                    content: {
                        block: "icon",
                        elem: "trash",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }
                })
            },
            "trust-rows": function(e) {
                var t = e.params();
                e.wrap([{
                    block: "widget-trust-rows",
                    widgetModelId: t.widgetModelId,
                    mix: {
                        block: "widget",
                        elem: "trust-rows"
                    }
                }])
            }
        }
    }), (BEM.DOM || BEM).decl("widget", null, {
        getWidgetModelId: function(e) {
            return e.param("widgetModelId") || e.blockParam("widgetModelId")
        },
        mixWidgetModelId: function(e) {
            var t = e.param("widgetModelId"),
                i = e.param("content");
            t && i.forEach(function(e) {
                e.widgetModelId = t
            })
        },
        getTabs: function(e) {
            return "multiline" === e ? ["main", "chart", "segmentation"] : ["main", "segmentation"]
        }
    }), BEM.DOM.decl("widget", {
        onSetMod: {
            js: function() {
                this.widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this.bindTo("edit", "click", this._onEditClick), this._triggerResize = jQuery.debounce(this._triggerResize, 500, this), this._onTitleInputChange = jQuery.debounce(this._onTitleInputChange, 500, this), BN("widget-preview").on(this.domElem, "resize", this._triggerResize), this.widgetModel.on("titleState", "change", this._updateTitle, this), this.widgetModel.on("filter", "change", this._updateFilterCount, this)
            },
            readonly: {
                yes: function() {
                    this.setMod(this.elem("popup"), "readonly", "yes"), this.findBlockOn("save-button", "button").setMod("disabled", "yes"), this.findBlockOn("remove-button", "button").setMod("disabled", "yes")
                }
            }
        },
        destruct: function() {
            this.widgetModel.un("titleState", "change", this._updateTitle, this), this.widgetModel.un("filter", "change", this._updateFilterCount, this), BN("widget-preview").un(this.domElem, "resize", this._triggerResize), this._popup && (this._cancelButton.un("click", this._onCancelClick, this), this._saveButton.un("click", this._onSaveClick, this), this._removeButton.un("click", this._onRemoveClick, this), this._titleInput.un("change", this._onTitleInputChange, this), this._popup.un("hide", this._onPopupHide, this), this._popup.destruct()), this.__base.apply(this, arguments)
        },
        _initSettings: function() {
            this._cancelButton = this.findBlockOn("cancel-button", "button"), this._saveButton = this.findBlockOn("save-button", "button"), this._removeButton = this.findBlockOn("remove-button", "button"), this._titleInput = this.findBlockOn("title-input", "input"), this._tabsMenu = this.findBlockInside("tabs-menu"), this._previewElem = this.elem("widget-preview"), this._previewBlock = this.findBlockInside("widget-preview"), this._widgetTitleBlock = this.findBlockInside("widget-title"), this._cancelButton.on("click", this._onCancelClick, this), this.widgetModel.isEditable() ? (this._saveButton.on("click", this._onSaveClick, this), this._removeButton.on("click", this._onRemoveClick, this)) : this.setMod("readonly", "yes"), this._updateFilterCount(), this._updateStaticTitle(), this._updateTitle(), this._titleInput.on("change", this._onTitleInputChange, this)
        },
        _updateFilterCount: function() {
            var e = this;
            this._tabsMenu && this.widgetModel.getFilterObject().then(function(t) {
                e._tabsMenu.setCountTextByMod("segmentation", Object.keys(t).length || "")
            }).done()
        },
        _onEditClick: function() {
            var e = this;
            this._getPopup().then(function() {
                return e._previewBlock.unbindFromModel(), e._widgetTitleBlock.unbindFromModel(), e._userActionPromise = Vow.promise(), e._popup.show(), BN("i-content").update(e._previewElem, {
                    block: "widget-preview",
                    legendMods: e._getLegendMods(),
                    widgetModelId: e.widgetModel.cid,
                    mods: {
                        type: e.getMod("type")
                    }
                })
            }).done()
        },
        _onRemoveClick: function() {
            this._userActionPromise.fulfill("remove"), this._popup.hide(), this.destruct()
        },
        _onCancelClick: function() {
            this._userActionPromise.fulfill("revert"), this._popup.hide(), this._updateTitle(), this.delMod("edit")
        },
        _onSaveClick: function() {
            this._userActionPromise.fulfill("save"), this._popup.hide(), this.delMod("edit")
        },
        _onTitleInputChange: function() {
            var e = this._titleInput.val().trim();
            this.widgetModel.set("title", e)
        },
        _updateTitle: function() {
            var e = this.widgetModel.get("title").trim(),
                t = this.widgetModel.get("defaultTitle");
            this._titleInput && (e !== t && this._titleInput.val(e), this._titleInput.setHint(t)), this._triggerResize()
        },
        _getLegendMods: function() {
            return {
                type: "multiline"
            }
        },
        _getPopup: function() {
            var e, t, i, n = this;
            return this._popupPromise || (t = this.getMod("type"), e = this.__self.getTabs(t), i = n.widgetModel.cid, this._popupPromise = BN("i-content").append(this.domElem, {
                block: this.__self.getName(),
                elem: "popup",
                tabs: e,
                type: t,
                widgetModelId: i
            }).then(function() {
                n._popup = n.findBlockInside("popup"), n._popupElem = n.elem("popup"), n._popup.on("hide", n._onPopupHide, n), n._initSettings()
            })), this._popupPromise
        },
        _onPopupHide: function() {
            var e = this;
            this._userActionPromise.fulfill("revert"), Vow.all([this._userActionPromise, BN("i-content").update(this._previewElem, "")]).spread(function(t) {
                var i = e.widgetModel[t]();
                i && i.done && i.done(), e._previewBlock.bindToModel("save" === t), e._widgetTitleBlock.bindToModel()
            }).done()
        },
        _updateStaticTitle: function() {
            var e = BEM.I18N("widget", "static-title", {
                widgetName: BEM.I18N("dashboard-page", "button-" + this.getMod("type"))
            });
            BN("i-content").update(this.elem("static-title"), e).done()
        },
        _triggerResize: function() {
            this.trigger("resize")
        },
        _popupPromise: null,
        _userActionPromise: null
    }), BEM.JSON.decl("attributes-selector", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            }).content([{
                elem: "label"
            }, {
                block: "button",
                mix: [{
                    block: "attributes-selector",
                    elem: "button"
                }],
                mods: {
                    size: "s",
                    arrow: "down",
                    "padding-left": "10"
                },
                content: ""
            }, {
                elem: "popup-wrapper"
            }])
        },
        onElem: {
            "popup-wrapper": function(e) {
                e.content({
                    block: "popup",
                    mods: {
                        search: "yes"
                    },
                    js: {
                        directions: ["bottom-left", "bottom-center", "bottom-right"]
                    },
                    mix: [{
                        block: "attributes-selector",
                        elem: "popup"
                    }],
                    content: [{
                        elem: "tail"
                    }, {
                        elem: "content",
                        mix: {
                            block: "attributes-selector",
                            elem: "popup-content"
                        }
                    }]
                })
            },
            "button-text": function(e) {
                e.tag("span").content(e.param("name") || "")
            },
            "popup-inner": function(e) {
                var t = e.param("levels");
                e.content([{
                    elem: "search"
                }, {
                    elem: "levels",
                    mods: {
                        depth: t.length
                    },
                    content: t.map(function(e) {
                        return {
                            elem: "level",
                            level: e
                        }
                    })
                }])
            },
            level: function(e) {
                var t = e.param("level");
                e.content(t.map(function(e) {
                    var t = {
                        elem: "item",
                        content: [{
                            tag: "span",
                            elem: "item-text",
                            content: BN("i-string").escapeHTML(e.name),
                            mix: [e.isInternalAttribute && {
                                block: "nda-message"
                            }]
                        }],
                        mods: {
                            id: e.id
                        }
                    };
                    return e.parent && (t.mods.parent = e.parent), e.value ? (t.js = {
                        value: e.value
                    }, t.mix = [{
                        block: "icon",
                        elem: "tick"
                    }], t.mods.group = "no", t.mods.type = e.type) : (t.mods.group = "yes", t.content.push({
                        elem: "group-icon",
                        mix: [{
                            block: "icon",
                            mods: {
                                direction: "right"
                            }
                        }, {
                            block: "icon",
                            elem: "arrow"
                        }]
                    })), t.mods.disabled = e.disabled ? "yes" : "", t
                }))
            },
            search: function(e) {
                e.content({
                    block: "search-input",
                    mix: {
                        block: "attributes-selector",
                        elem: "search-input"
                    },
                    js: {
                        debounce: 0
                    }
                })
            }
        }
    }), BEM.DOM.decl("attributes-selector", {
        onSetMod: {
            js: function() {
                var e = this;
                this._button = this.findBlockOn(this.elem("button"), "button"), this._popup = this.elem("popup").bem("popup"), this._popup.on("show", this._onPopupShow, this), this.bindTo("button", "click", this._onClick), this._onGroupItemClick = this._onGroupItemClick.bind(this), this._onItemClick = this._onItemClick.bind(this), this.widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this.widgetModel.on(this._getFields(), "change", e._onWidgetModelChange, this), this._updateTitle()
            }
        },
        destruct: function() {
            return this._popup && this._popup.un("show", this._onPopupShow, this), this.widgetModel.un(this._getFields(), "change", this._onWidgetModelChange, this), this._unsubsribePopupInner(), this.__base.apply(this, arguments)
        },
        _setValue: function() {
            throw new Error("Not implemented")
        },
        _getFields: function() {
            throw new Error("Not implemented")
        },
        _getLabel: function() {
            throw new Error("Not implemented")
        },
        _getTreeLevels: function() {
            throw new Error("Not implemented")
        },
        _fetchCurrentValue: function() {
            throw new Error("Not implemented")
        },
        _unsubsribePopupInner: function() {
            this.findElem("level").off("click", this.buildSelector("item", "group", "yes"), this._onGroupItemClick), this.findElem("level").off("click", this.buildSelector("item", "group", "no"), this._onItemClick), this._searchInput && this._searchInput.un("search focus", this._onSearch, this)
        },
        _onWidgetModelChange: function() {
            this._updateTitle(), this._popupInner && (this._unsubsribePopupInner(), BEM.DOM.destruct(this._popupInner), this.domElem = this.domElem.not(this._popupInner), this._popupInner.remove(), this._popupInner = null)
        },
        _fetchTitle: function() {
            var e = this;
            return e._getTreeLevels().then(function(t) {
                var i = e._fetchCurrentValue(),
                    n = [].concat.apply([], t).filter(function(e) {
                        return e.value === i
                    })[0];
                return n ? n.name : ""
            })
        },
        _updateTitle: function() {
            var e = this;
            this._fetchTitle().then(function(t) {
                return e._button && e._button.setText(t), e.elem("label").length && e.elem("label").text(e._getLabel()), !0
            }, function(e) {
                setTimeout(function() {
                    throw e
                })
            }).done()
        },
        _initPopup: function() {
            var e = this;
            this._getTreeLevels().then(function(t) {
                return BEM.blocks["i-content"].html({
                    block: e.__self._name,
                    elem: "popup-inner",
                    levels: t
                })
            }).then(function(t) {
                e._popupInner = jQuery(t), e._popup.setContent(e._popupInner), e.domElem = e.domElem.add(e._popupInner), e.findElem("level").on("click", e.buildSelector("item", "group", "yes"), e._onGroupItemClick), e.findElem("level").on("click", e.buildSelector("item", "group", "no"), e._onItemClick), e._searchInput = e.findElem("search-input").bem("search-input"), e._searchInput.on("search focus", e._onSearch, e), e._popup.show(e.findElem("button"))
            }).done()
        },
        _onSearch: function(e, t) {
            var i = this;
            t.length > 0 ? (t = t.toLowerCase(), this.setMod(this._popupInner, "search", "yes"), this.findElem("item").each(function() {
                var e = jQuery(this),
                    n = i.findElem(e, "item-text"),
                    o = n.text(),
                    s = o.toLowerCase().match(t);
                s ? (n.html(BEM.blocks["i-content"].html({
                    block: "filtered-text",
                    text: o,
                    pattern: t
                }, !0)), i.setMod(e, "show", "yes")) : i.hasMod(e, "show", "yes") && (n.html(o), i.delMod(e, "show"))
            })) : (this.findElem("item", "show", "yes").each(function() {
                var e = jQuery(this),
                    t = i.findElem(e, "item-text");
                t.html(t.text())
            }), this.delMod(this._popupInner, "search"), this._selectCurrent())
        },
        _onClick: function() {
            return this._popupInner ? this._popup.toggle() : this._initPopup(), !1
        },
        _onPopupShow: function() {
            this._selectCurrent()
        },
        _selectCurrent: function() {
            var e, t, i = BEM.toModVal(this._fetchCurrentValue());
            i && (e = this.findElem("item", "id", i), t = this.getMod(e, "parent"), this.setMod(e, "selected", "yes"), t && this._selectGroup(t))
        },
        _getGroupsChain: function(e) {
            var t = this.findElem("item", "id", e),
                i = [e],
                n = this.getMod(t, "parent");
            return n && (i = i.concat(this._getGroupsChain(n))), i
        },
        _selectGroup: function(e) {
            var t = this._getGroupsChain(e);
            this.delMod(this.findElem("item"), "show"), this.delMod(this.findElem("item", "group", "yes"), "selected"), t.forEach(function(e) {
                this.setMod(this.findElem("item", "parent", e), "show", "yes"), this.setMod(this.findElem("item", "id", e), "selected", "yes")
            }.bind(this))
        },
        _onItemClick: function(e) {
            var t = jQuery(e.currentTarget),
                i = this.elemParams(t).value;
            this.hasMod(t, "disabled", "yes") || (this._setValue(i), this._updateTitle(), this.delMod(this.findElem("item", "selected", "yes"), "selected"), this.setMod(t, "selected", "yes"), this._popup.hide())
        },
        _onGroupItemClick: function(e) {
            var t = jQuery(e.currentTarget),
                i = this.getMod(jQuery(e.currentTarget), "id");
            this.hasMod(t, "disabled", "yes") || (this.delMod(this._popupInner, "search"), this._selectGroup(i))
        },
        _filterDummyLevels: function(e) {
            return e.filter(function(t, i) {
                var n = t[0];
                return 1 !== t.length || n.value ? !0 : (e[i + 1].forEach(function(e) {
                    e.parent === n.id && (e.parent = void 0)
                }), !1)
            })
        },
        _isItemDisabled: function() {},
        _addLevels: function(e, t, i, n, o) {
            var s;
            return 2 === arguments.length && (n = [], o = 0), o >= n.length && n.push([]), s = n[o], e.forEach(function(e) {
                var r = BEM.toModVal(e.dim || e.id),
                    a = {
                        id: r,
                        name: e.name,
                        type: e.type,
                        isInternalAttribute: BN("i-report-metadata").isInternalAttribute(e)
                    },
                    l = [];
                e[t] && (l = l.concat(e[t])), e.chld && (l = l.concat(e.chld)), l = l.filter(Boolean), l.length && this._addLevels(l, t, r, n, o + 1), e.dim && (a.value = e.dim), a.disabled = this._isItemDisabled(a), i && (a.parent = i), s.push(a)
            }, this), 0 === o ? n.filter(function(e) {
                return e.length
            }) : void 0
        }
    }), BEM.DOM.decl({
        name: "attributes-selector",
        modName: "type",
        modVal: "metrics"
    }, {
        _getFields: function() {
            return "metric"
        },
        _getLabel: function() {
            return BEM.I18N("attributes-selector", "metric")
        },
        _setValue: function(e) {
            this.widgetModel.set("metric", e)
        },
        _fetchCurrentValue: function() {
            return this.widgetModel.get("metric")
        },
        _addMetricLevels: function(e) {
            return this._addLevels(e, "metrics")
        },
        _getTreeLevels: function() {
            var e = this;
            return this.widgetModel.getMetricsGroups().then(function(t) {
                return e._addMetricLevels(t.metric_groups)
            }).then(function(t) {
                return e._filterDummyLevels(t)
            })
        }
    }), BEM.DOM.decl({
        name: "attributes-selector",
        modName: "type",
        modVal: "dimensions"
    }, {
        _getFields: function() {
            return "dimension"
        },
        _getLabel: function() {
            return BEM.I18N("attributes-selector", "dimension")
        },
        _setValue: function(e) {
            this.widgetModel.set("dimension", e)
        },
        _fetchCurrentValue: function() {
            return this.widgetModel.get("dimension")
        },
        _addDimensionLevels: function(e) {
            return this._addLevels(e, "attributes")
        },
        _getTreeLevels: function() {
            var e = this;
            return this.widgetModel.getAttributesTree().then(function(t) {
                return e._addDimensionLevels(t.attribute_groups)
            })
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "data-bind",
        modVal: "widget-model"
    }, {
        onSetMod: {
            js: function() {
                this.__base(), this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._widgetModel.on("goalAvailability", "change", this._checkGoalAvailability, this), this._widgetModel.on("goal", "change", this._onWidgetGoalChange, this), this._checkGoalAvailability()
            },
            hidden: function(e, t) {
                this._button.setMod("disabled", t)
            }
        },
        destruct: function() {
            this._widgetModel.un("goalAvailability", "change", this._checkGoalAvailability, this), this._widgetModel.un("goal", "change", this._onWidgetGoalChange, this), this.__base.apply(this, arguments)
        },
        _onWidgetGoalChange: function() {
            this._update(this._widgetModel.get("goal"))
        },
        _checkGoalAvailability: function() {
            var e = this._widgetModel.get("goalAvailability");
            this.setMod("hidden", e ? "" : "yes")
        },
        _update: function(e) {
            this.__base.apply(this, arguments), this._widgetModel.set("goal", e)
        }
    }), BEM.JSON.decl({
        name: "goals-panel",
        modName: "data-bind",
        modVal: "widget-model"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("m-widget").getOne(t.widgetModelId);
            t.js = t.js || {}, t.js.widgetModelId = t.widgetModelId, e.defer(BEM.blocks["i-goal"].getGoals().then(function(n) {
                var o = BEM.blocks["i-goal"].getGoalById(i.get("goal"), n);
                e.param("goal", o), t.js.currentGoal = o
            }))
        }
    }), BEM.JSON.decl("attributes-table", {
        onBlock: function(e) {
            var t = e.param("beforeTableContent") || [];
            e.js(!0).content({
                elem: "table",
                content: [{
                    elem: "thead",
                    content: [t, {
                        elem: "header-raw"
                    }]
                }, {
                    elem: "tbody"
                }]
            })
        },
        onElem: {
            sorting: function(e) {
                var t = e.param("title"),
                    i = e.param("sort");
                e.js({
                    sort: i
                }).tag("span").content([{
                    elem: "sorting-icon",
                    tag: "span",
                    mix: {
                        block: "icon",
                        elem: "triangle",
                        mods: {
                            direction: "-" === i.charAt(0) ? "down" : "up"
                        }
                    }
                }, {
                    tag: "span",
                    elem: "sorting-title",
                    content: t
                }])
            },
            "header-raw": function(e) {
                var t = e.param("attributes"),
                    i = e.param("sort");
                e.tag("tr"), t && e.content(t.map(function(e, t) {
                    var n = "";
                    return n = e.allow_sort && t ? {
                        elem: "sorting",
                        title: e.name,
                        sort: i
                    } : e.name, {
                        elem: "th",
                        content: n
                    }
                }))
            },
            tbody: function(e) {
                var t = e.param("attributes"),
                    i = e.param("statData");
                e.tag("tbody"), i && t && e.content(i.map(function(e) {
                    return {
                        elem: "tr",
                        content: [].concat(e.dimensions, e.metrics).map(function(e, i) {
                            return {
                                elem: "td",
                                content: BN("humanize-attributes").format(t[i].type, e)
                            }
                        })
                    }
                }))
            },
            table: function(e) {
                e.tag("table")
            },
            thead: function(e) {
                e.tag("thead")
            },
            tr: function(e) {
                e.tag("tr")
            },
            td: function(e) {
                e.tag("td")
            },
            th: function(e) {
                e.tag("th")
            }
        }
    }), BEM.DOM.decl("attributes-table", {
        onSetMod: {
            js: function() {
                this._onSortingClick = this._onSortingClick.bind(this), this.elem("thead").on("click", this.buildSelector("sorting"), this._onSortingClick)
            }
        },
        updateHeader: function(e, t) {
            return BEM.blocks["i-content"].replace(this.findElem("header-raw"), {
                block: this.__self._name,
                elem: "header-raw",
                attributes: e,
                sort: t
            })
        },
        updateTbody: function(e, t) {
            return BEM.blocks["i-content"].replace(this.findElem("tbody"), {
                block: this.__self._name,
                elem: "tbody",
                attributes: e,
                statData: t
            })
        },
        destruct: function() {
            this.elem("thead").off("click", this.buildSelector("sorting"), this._onSortingClick), this.__base.apply(this, arguments)
        },
        _invertSorting: function(e) {
            return "-" === e.charAt(0) ? e.slice(1) : "-" + e
        },
        _onSortingClick: function(e) {
            var t = jQuery(e.currentTarget),
                i = this._invertSorting(this.elemParams(t).sort),
                n = this;
            BEM.blocks["i-content"].replace(t, {
                block: this.__self._name,
                elem: "sorting",
                title: t.text(),
                sort: i
            }).then(function() {
                n.trigger("sort", {
                    sort: i
                })
            }).done()
        }
    }), BEM.decl({
        name: "humanize-attributes",
        baseBlock: "humanize"
    }, null, {
        formatUndefined: function(e) {
            return e.name
        },
        formatString: function(e) {
            return BN("i-content").escapeHTML(e.name)
        },
        formatInteger: function(e) {
            return this.formatInt(e.name)
        },
        formatCurrency: function(e) {
            return this.__base("object" == typeof e ? e.name : e)
        },
        formatDateTime: function(e) {
            return BN("i-date").format(BN("i-date").localizedDateFormat("common-date-time-format"))(e.name)
        },
        formatDate: function(e) {
            return e.name
        },
        formatDatePeriod: function(e) {
            return e.name
        },
        formatBoolean: function(e) {
            return e.name
        },
        formatSearchPhrase: function(e) {
            var t = e.icon_id && e.icon_type ? this._formatDimensionWithIcon(e) : null;
            return e.url ? this.formatUrl(e, {
                content: t
            }) : t || this.formatString(e)
        },
        formatSocialNetwork: function(e) {
            return this._formatDimensionWithIcon(e);
        },
        formatSourceEngine: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatUrlPart: function(e) {
            return this.formatUrl(e)
        },
        formatUrl: function(e, t) {
            var i;
            return e.url ? i = e.url : BN("i-url").isUrl(e.name) && (i = e.name), [e.favicon ? {
                block: "icon",
                tag: "span",
                mix: {
                    block: "humanize-attributes",
                    elem: "favicon"
                },
                mods: {
                    type: "favicon"
                },
                domain: e.favicon
            } : "", i ? {
                block: "link",
                mix: [{
                    block: "humanize-attributes",
                    elem: "link",
                    mods: {
                        favicon: e.favicon ? "yes" : "no"
                    }
                }, {
                    block: "hint-hover",
                    js: !0
                }],
                mods: {
                    external: "yes"
                },
                attrs: {
                    target: "_blank"
                },
                url: i,
                content: t && t.content || BN("i-content").escapeHTML(e.url ? e.name : String(e.name).replace(/^(https?:\/\/)?([^\/$]+)(.*)$/g, "$2$3"))
            } : t && t.content || BN("i-content").escapeHTML(e.name)]
        },
        formatSearchEngine: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatTrafficSource: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatMobile: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatBrowserVersion: function(e) {
            return this.formatBrowser(e)
        },
        formatBrowser: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatCountry: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatOs: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatAdvEngine: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatSearchPhraseWithUrl: function(e) {
            return this.formatSearchPhrase(e)
        },
        formatCity: function(e) {
            return e.name
        },
        formatRegion: function(e) {
            return this._formatDimensionWithIcon(e)
        },
        formatDomainWithFavicon: function(e) {
            return [e.favicon ? {
                block: "icon",
                tag: "span",
                mix: {
                    block: "humanize-attributes",
                    elem: "favicon"
                },
                mods: {
                    type: "favicon"
                },
                domain: e.favicon
            } : "", {
                block: this.getName(),
                elem: "domain",
                tag: "span",
                content: e.name
            }]
        },
        _formatDimensionWithIcon: function(e) {
            return {
                block: this.getName(),
                elem: "dimension-with-icon",
                dimensionValue: e
            }
        },
        _defaultFormatting: function(e) {
            return e && e.name ? String(e.name) : this.__base(e)
        }
    }), BEM.JSON.decl("humanize-attributes", {
        onElem: {
            "dimension-with-icon": function(e) {
                var t = e.param("dimensionValue"),
                    i = e.param("block");
                e.tag("span"), e.content([{
                    block: "icon",
                    elem: t.icon_type,
                    tag: "span",
                    mods: {
                        id: t.icon_id
                    },
                    attrs: {
                        title: BN("i-content").escapeHTML(t.name)
                    },
                    mix: [{
                        block: i,
                        elem: "dimension-icon"
                    }]
                }, {
                    block: i,
                    tag: "span",
                    elem: "dimension-name",
                    content: BN("i-content").escapeHTML(t.name)
                }])
            }
        }
    }), BEM.JSON.decl("table-selector", {
        onBlock: function(e) {
            var t = e.param("widgetModelId"),
                i = BN("m-widget").getOne(t),
                n = e.param("selectMods") || {},
                o = i.getTables();
            e.js({
                widgetModelId: t
            }).content({
                block: "select",
                mods: jQuery.extend({
                    size: "s",
                    theme: "normal"
                }, n),
                mix: {
                    block: "table-selector",
                    elem: "select"
                },
                attrs: {
                    autocomplete: "off"
                },
                content: [{
                    elem: "label",
                    content: BEM.I18N("table-selector", "table")
                }, {
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal",
                        "padding-left": "10"
                    }
                }, {
                    elem: "control",
                    content: Object.keys(o).map(function(e) {
                        return {
                            elem: "option",
                            attrs: {
                                value: e
                            },
                            content: o[e].name
                        }
                    })
                }]
            })
        }
    }), BEM.DOM.decl("table-selector", {
        onSetMod: {
            js: function() {
                this._select = this.elem("select").bem("select"), this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._select.val(this._widgetModel.get("table")), this._select.on("change", this._onSelect, this), this._widgetModel.on("table", "change", this._onModelChange, this)
            }
        },
        destruct: function() {
            return this._widgetModel.un("table", "change", this._onModelChange, this), this._select.un("change", this._onSelect, this), this.__base.apply(this, arguments)
        },
        _onSelect: function() {
            this._widgetModel.set("table", this._select.val())
        },
        _onModelChange: function() {
            this._select.val(this._widgetModel.get("table"))
        }
    }), BEM.DOM.decl("widget-trust-rows", {
        onSetMod: {
            js: function() {
                this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._checkbox = this.findBlockOn("checkbox", "checkbox"), this._checkbox.on("change", this._onCheckboxChange, this), this._widgetModel.on("trustedRowsEnabled onlyTrustedRows", "change", this._onModelChanged, this), this._updateFromModel()
            }
        },
        destruct: function() {
            this._widgetModel.un("trustedRowsEnabled onlyTrustedRows", "change", this._onModelChanged, this), this.__base.apply(this, arguments)
        },
        _onCheckboxChange: function() {
            this._widgetModel.set("onlyTrustedRows", this._checkbox.isChecked())
        },
        _updateFromModel: function() {
            this._checkbox.toggleMod("checked", "yes", this._widgetModel.get("onlyTrustedRows") && this._widgetModel.get("trustedRowsEnabled")), this._checkbox.toggleMod("disabled", "yes", !this._widgetModel.get("trustedRowsEnabled"))
        },
        _onModelChanged: function() {
            this._updateFromModel()
        }
    }), BEM.JSON.decl("widget-trust-rows", {
        onBlock: function(e) {
            var t = e.param("widgetModelId");
            e.js({
                widgetModelId: t
            }).content({
                block: "checkbox",
                mix: {
                    block: "widget-trust-rows",
                    elem: "checkbox"
                },
                mods: {
                    size: "s",
                    label: "padded"
                },
                content: {
                    elem: "label",
                    mix: {
                        block: "widget-trust-rows",
                        elem: "label"
                    },
                    content: BEM.I18N("widget-trust-rows", "exclude-insignificant")
                }
            })
        }
    }), BEM.JSON.decl({
        name: "error-message",
        modName: "verbose",
        modVal: "less"
    }, {
        onElem: {
            "message-content": function(e) {
                var t = e.param("error");
                e.content(t.text || BN("i-error-message").toText(t)).stop()
            }
        }
    }), BEM.JSON.decl("widget-segmentation", {
        onBlock: function(e) {
            var t = e.param("widgetModelId");
            e.js({
                widgetModelId: t
            }).content([{
                elem: "controls",
                widgetModelId: t
            }, {
                elem: "list",
                widgetModelId: t
            }])
        },
        onElem: {
            controls: function(e) {
                var t = e.param("widgetModelId");
                e.content([{
                    block: "segments-selector",
                    mods: {
                        type: "dashboard",
                        data: "dashboard"
                    },
                    widgetModelId: t
                }])
            },
            list: function(e) {
                var t = e.params(),
                    i = t.filter;
                e.content([{
                    block: "segments-list",
                    mods: {
                        data: "dashboard",
                        theme: "dashboard"
                    },
                    filter: i,
                    widgetModelId: t.widgetModelId
                }, {
                    elem: "empty-message",
                    content: BEM.I18N("widget-segmentation", "filter-empty")
                }])
            }
        }
    }), BEM.DOM.decl("widget-segmentation", {
        onSetMod: {
            js: function() {
                this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._urlParamsModel = this._widgetModel.get("urlParams"), this._widgetModel.on("filter", "change", this._updateFilters, this), this._urlParamsModel.on("period", "change", this._updateFilters, this), this._updateFilters()
            }
        },
        destruct: function() {
            return this._widgetModel.un("filter", "change", this._updateFilters, this), this._urlParamsModel.un("period", "change", this._updateFilters, this), this.__base.apply(this, arguments)
        },
        _updateFilters: function() {
            this._widgetModel.getFilterObject().then(function(e) {
                var t = this.findElem("list");
                BN("i-filter").isFiltersListEmpty(e) ? this.setMod(t, "empty", "yes") : this.setMod(t, "empty", "no"), this.findBlockInside(t, "segments-list").update(e)
            }.bind(this)).done()
        }
    }), BEM.JSON.decl("segments-selector", {
        onBlock: function(e) {
            var t = e.params(),
                i = e.mod("type"),
                n = e.js(),
                o = e.content() || [];
            e.js(!0).content(o.concat([{
                block: "dropdown",
                mods: {
                    lazy: "yes"
                },
                js: {
                    content: jQuery.extend(!0, {
                        block: "segments-selector",
                        elem: "popup-content",
                        mods: i ? {
                            type: i
                        } : null,
                        menuType: t.menuType,
                        dataBind: t.dataBind
                    }, n && n.content || {})
                },
                content: [{
                    block: "button",
                    mix: [{
                        block: "dropdown",
                        elem: "switcher"
                    }],
                    mods: {
                        size: "s",
                        arrow: "down",
                        pseudo: "no"
                    },
                    content: [{
                        block: "icon",
                        elem: "segmentation",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }, BEM.I18N("segments-selector", "open-filter")]
                }, {
                    elem: "popup",
                    mods: {
                        search: "yes",
                        adaptive: "yes"
                    },
                    mix: [{
                        block: "segments-selector",
                        elem: "popup"
                    }],
                    js: {
                        directions: ["bottom-left", "right-middle"]
                    }
                }]
            }]), !0)
        }
    }), BEM.JSON.decl("segments-selector", {
        onElem: {
            "popup-content": function(e) {
                var t = e.params();
                e.content([{
                    block: "segments-selector",
                    elem: "head-controls",
                    content: {
                        block: "search-input",
                        js: {
                            debounce: 0
                        }
                    }
                }, {
                    block: "segments-selector",
                    elem: "menu-items",
                    menuType: t.menuType,
                    dataBind: t.dataBind
                }])
            },
            "menu-items": function(e) {
                var t = e.params();
                e.content([{
                    block: "segments-menu-item",
                    mods: {
                        type: "recent",
                        "data-bind": t.dataBind
                    }
                }, {
                    block: "segments-menu-item",
                    mods: {
                        type: "predefined",
                        "data-bind": t.dataBind
                    }
                }, {
                    block: "segments-menu-item",
                    mods: {
                        type: "user",
                        "data-bind": t.dataBind
                    }
                }, {
                    block: "segments-menu",
                    mods: {
                        data: "report",
                        type: t.menuType,
                        "data-bind": t.dataBind
                    }
                }])
            }
        }
    }), BEM.DOM.decl("segments-selector", {
        onSetMod: {
            js: function() {
                var e;
                this._dropdown = this.findBlockInside("dropdown").on("show", this._onDropdownShow.bind(this)), e = this._dropdown.elem("popup"), this._menus = this.findBlocksInside(e, "segments-menu-item"), this._menuItems = this.findElem(e, "menu-items"), this._segmentsMenu = this.findBlockInside(e, "segments-menu"), this._segmentsMenu.on("open", this._handleSegmentsMenuOpen.bind(this)), this._searchInput = this.findBlockInside(e, "search-input"), this._menus.forEach(function(e) {
                    e.on("click", this._handleMenuClick.bind(this)), e.on("open", this._handleMenuOpen.bind(this)), e.on("menu-items-changed", this._handleMenuItemsChange.bind(this))
                }.bind(this)), this._menuItems.on("scroll", function() {
                    this._segmentsMenu.handleContainerScroll()
                }.bind(this)), this._searchInput.on("search", this._filter.bind(this)), this._sendMetrikaParams = jQuery.debounce(this._sendMetrikaParams, 1e3, this), this._onDropdownShow()
            }
        },
        _handleMenuItemsChange: function() {
            this._segmentsMenu.handleChangePosition()
        },
        _handleMenuOpen: function(e) {
            "yes" !== this.getMod("filtered") && (this._segmentsMenu.closeMenu(), this._menus.forEach(function(t) {
                t.domElem[0] !== e.block.domElem[0] && t.closeMenu()
            }), BN("metrika-counter").params("segmentation-menu-open-group", e.block.getMod("type")))
        },
        _handleMenuClick: function(e) {
            this._searchInput.val(""), this._dropdown.hide(), BN("metrika-counter").params("segmentation-menu-select", e.block.getMod("type"))
        },
        _handleSegmentsMenuOpen: function() {
            "yes" !== this.getMod("filtered") && (this._menus.forEach(function(e) {
                e.closeMenu()
            }), BN("metrika-counter").params("segmentation-menu-open-group", "custom"))
        },
        _filter: function(e, t) {
            this.setMod(this._menuItems, "filtered", "" !== t ? "yes" : "no"), this.setMod("filtered", "" !== t ? "yes" : "no"), this._menus.forEach(function(e) {
                e.filter(t)
            }.bind(this)), this._segmentsMenu.filter(t), t && this._sendMetrikaParams(t)
        },
        _onDropdownShow: function() {
            BN("metrika-counter").params("segmentation-menu", "open")
        },
        _sendMetrikaParams: function(e) {
            BN("metrika-counter").params("segmentation-menu-search", e)
        }
    }, {
        live: function() {
            return this.liveInitOnBlockInsideEvent("content-ready", "dropdown", function() {
                this._dropdown.getPopup().focusSearchInput()
            }), !0
        }
    }), BEM.JSON.decl("segments-menu-item", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.segments,
                n = t.segment || null,
                o = 0,
                s = t.pageSize || 10,
                r = e.mods(),
                a = t.label;
            r.closed = r.headless ? "" : "yes", e.mods(r, !0).param("js", jQuery.extend(!0, {}, {
                segments: i,
                pageSize: t.pageSize || 10
            }, e.js()), !0).content([r.headless ? void 0 : {
                elem: "header",
                mix: [{
                    block: "selection-disabler"
                }],
                content: {
                    elem: "label",
                    label: a
                }
            }, {
                elem: "items",
                content: {
                    elem: "items-list",
                    mods: {
                        type: r.type,
                        reference: r.reference
                    },
                    segments: i.segments.slice(0, s),
                    numberingStart: o,
                    segment: n
                }
            }, {
                elem: "more-button",
                count: i.segments.length,
                pageSize: s
            }, {
                elem: "empty-item",
                count: i.segments.length
            }])
        },
        onElem: {
            "items-list": function(e) {
                var t = e.param("segments"),
                    i = e.param("numberingStart"),
                    n = e.param("segment") || {};
                e.wrap(t.map(function(t, o) {
                    return {
                        block: "segments-menu-item",
                        elem: "item",
                        mods: {
                            type: (e.mods() || {}).type,
                            selected: n.id && String(n.id) === String(t.id) ? "yes" : ""
                        },
                        segment: t,
                        pattern: e.param("pattern"),
                        serial: o + i
                    }
                }))
            },
            item: function(e) {
                var t = e.param("segment"),
                    i = e.param("serial"),
                    n = e.mods();
                t.id && (n.id = t.id), t.applicable === !1 && (delete n.selected, n.disabled = "yes"), e.mods(n).js({
                    segment: t
                }).beforeContent([{
                    elem: "serial",
                    tag: "span",
                    content: i + 1
                }, {
                    pattern: e.param("pattern"),
                    elem: "item-name",
                    segment: t
                }])
            },
            "item-name": function(e) {
                e.tag("span").content({
                    block: "filtered-text",
                    text: e.param("segment").name,
                    pattern: e.param("pattern")
                })
            },
            header: function(e) {
                e.afterContent([{
                    block: "icon",
                    elem: "arrow",
                    mix: [{
                        block: "icon",
                        mods: {
                            rotation: "270"
                        }
                    }, {
                        block: "segments-menu-item",
                        elem: "label-icon"
                    }]
                }])
            },
            "more-button": function(e) {
                var t = e.param("pageSize"),
                    i = e.param("count");
                t >= i && e.mods({
                    hidden: "yes"
                }), e.content({
                    block: "button",
                    mods: {
                        size: "s",
                        pseudo: "yes"
                    },
                    content: BEM.I18N("segments-menu-item", "more")
                })
            },
            "empty-item": function(e) {
                e.param("count") && e.mods({
                    hidden: "yes"
                }), e.content(BEM.I18N("segments-menu-item", "empty"))
            }
        }
    }), BEM.DOM.decl("segments-menu-item", {
        onSetMod: {
            js: function() {
                this._pageSize = this.params.pageSize, this._total = this.params.segments.segments.length, this._segments = this.params.segments.segments, this._filteredSegments = this._segments, this._count = this._getCountLimit(this._filteredSegments, this._pageSize), this._header = this.elem("header"), this._moreButtonElem = this.elem("more-button"), this._moreButton = this.findBlockInside(this._moreButtonElem, "button"), this._emptyItem = this.elem("empty-item"), this._moreButton.on("click", this._onMoreClick.bind(this)), this._header.on("click", this._onHeaderClick.bind(this)), this._segment = null, this._filterPattern = ""
            }
        },
        filter: function(e) {
            return e = e.toLowerCase(), this.setMod("filtered", "" !== e ? "yes" : "no"), this.setMod("closed", "" !== e ? "no" : "yes"), this._filterPattern = e, this._filterSegments(this._filterPattern).then(function(e) {
                this._setFilteredItems(e)
            }.bind(this))
        },
        setSegments: function(e) {
            return this._segments = e, this._total = this._segments.length, this._filterSegments(this._filterPattern).then(function(e) {
                this._setFilteredItems(e)
            }.bind(this))
        },
        selectItem: function(e) {
            this.delMod(this.findElem("item", "selected", "yes"), "selected"), e && this.setMod(this.findElem("item", "id", e), "selected", "yes")
        },
        _replaceItems: function(e) {
            this._renderItems(e, !0)
        },
        _setFilteredItems: function(e) {
            this._filteredSegments = e, this._count = this._getCountLimit(this._filteredSegments, this._pageSize), this._replaceItems(this._filteredSegments.slice(0, this._count))
        },
        _renderItems: function(e, t) {
            return BN("i-content")[t ? "update" : "append"](this.elem("items"), {
                block: "segments-menu-item",
                elem: "items-list",
                pattern: this._filterPattern.toLowerCase(),
                mods: {
                    type: this.getMod("type"),
                    reference: this.getMod("reference")
                },
                segments: e,
                numberingStart: t ? 0 : this._count,
                segment: this._segment ? this._findSegmentById(this._segment) : null
            }).then(function() {
                this._adjustMoreButtonVisibility(), this._adjustEmptyItemVisibility()
            }.bind(this))
        },
        _findSegmentById: function(e) {
            var t;
            return e = String(e), this._segments.some(function(i) {
                return String(i.id) === e ? (t = i, !0) : void 0
            }), t
        },
        _filterSegments: function(e) {
            return Vow.fulfill(this._segments.filter(function(t) {
                return this._testFilter(t.name, e)
            }.bind(this)))
        },
        _testFilter: function(e, t) {
            return -1 !== e.toLowerCase().indexOf(t)
        },
        _onMoreClick: function() {
            var e = this._getCountLimit(this._filteredSegments, this._count + this._pageSize);
            this._renderItems(this._filteredSegments.slice(this._count, e)), this._count = e
        },
        _onItemClick: function(e) {
            var t = this.elemParams(e.data.domElem).segment;
            this.hasMod(e.data.domElem, "disabled", "yes") || (this._itemClickHandler(t), this.trigger("click"))
        },
        _itemClickHandler: function() {
            throw new Error("Must be implemented in modifications")
        },
        _adjustMoreButtonVisibility: function() {
            this.setMod(this._moreButtonElem, "hidden", this._count < this._total ? "" : "yes")
        },
        _adjustEmptyItemVisibility: function() {
            this.setMod(this._emptyItem, "hidden", this._count ? "yes" : "")
        },
        _onHeaderClick: function() {
            this.toggleMod("closed", "yes", "no"), this.hasMod("closed", "no") && this.trigger("open")
        },
        closeMenu: function() {
            this.setMod("closed", "yes")
        },
        _publishSegment: function(e) {
            this._segment = e.segment, this._filter = e.filter, this.trigger("filter-change", e.filter), this.trigger("segment-change", e.segment)
        },
        _getCountLimit: function(e, t) {
            return e.length > t ? t : e.length
        }
    }, {
        live: function() {
            return this.liveBindTo("item", "click", function(e) {
                this._onItemClick(e)
            }), !1
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "predefined"
    }, {
        onElem: {
            label: function(e) {
                e.content(e.param("label") || BEM.I18N("segments-menu-item", "predefined-label"))
            }
        }
    }), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "predefined"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._segment = this.getMod(this.findElem("item", "selected", "yes"), "id") || null
            }
        },
        _itemClickHandler: function(e) {
            this.selectItem(e.id), this._publishSegment({
                filter: e.segment,
                segment: {
                    id: e.id,
                    name: e.name,
                    segment: e.segment,
                    type: "predefined"
                }
            })
        },
        _setFilter: function(e) {
            var t;
            this._segment && (t = this._findSegmentById(this._segment), t && !jQuery.equals(e, t.segment) && this.selectItem())
        },
        _setSegment: function(e) {
            this.selectItem(e.id)
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "predefined"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-predefined-segments").getList().then(function(t) {
                e.param("segments", t)
            }))
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "recent"
    }, {
        MAX_RECENT_SEGMENTS_COUNT: 10,
        onBlock: function(e) {
            var t = e.param("segments"),
                i = e.param("segmentsTree"),
                n = BN("i-recent-segment-queue").init(t.segments, this.MAX_RECENT_SEGMENTS_COUNT);
            e.js({
                maxCount: this.MAX_RECENT_SEGMENTS_COUNT
            }), t.allSegments = n.toList(), t.segments = t.allSegments.filter(function(e) {
                return Boolean(i.findSegmentById(e.dimension))
            }), e.param("segments", t, !0)
        },
        onElem: {
            label: function(e) {
                e.content(e.param("label") || BEM.I18N("segments-menu-item", "recent-label"))
            },
            "item-name": function(e) {
                var t = e.param("segment");
                e.content({
                    elem: "filter-value",
                    value: t.value,
                    segmentId: t.dimension,
                    pattern: e.param("pattern")
                }).stop()
            },
            "filter-value": function(e) {
                var t = e.params();
                e.content({
                    block: "segment-label",
                    value: t.value,
                    segmentId: t.segmentId,
                    pattern: t.pattern,
                    view: "compact"
                })
            }
        }
    }), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "recent"
    }, {
        onSetMod: {
            js: function() {
                return this._queue = BN("i-recent-segment-queue").init(this.params.segments.allSegments, this.params.maxCount), this.__base.apply(this, arguments)
            }
        },
        _filterSegments: function(e) {
            return BN("i-report").getMetadata().then(function(t) {
                var i = t.getSegmentsTree();
                return this._segments.filter(function(t) {
                    var n = i.getSegmentParents(t.dimension);
                    return n.some(function(t) {
                        return this._testFilter(t.name, e)
                    }, this) || this._testFilter(t.name, e)
                }.bind(this))
            }.bind(this))
        },
        _onMoreClick: function() {},
        _isSignificantChange: function(e, t) {
            return e.length !== t.length ? !0 : e.some(function(e, i) {
                return e.dimension !== t[i].dimension || !jQuery.equals(e.value, t[i].value)
            })
        },
        _setFilter: function(e) {
            var t, i = BN("i-filter").changedFilters(e, this._filter),
                n = this;
            this._filter = e || {}, i = i.filter(function(e) {
                return this._filter[e] ? (this._queue.push(e, this._filter[e]), !0) : void 0
            }.bind(this)), t = this._queue.toList(), i.length && this._isSignificantChange(this._segments, t) && (BN("i-recent-segments").update(t), Vow.all([BN("i-recent-segments").localize(t), BN("i-report").getMetadata()]).spread(function(e, t) {
                var i = t.getSegmentsTree();
                e = e.filter(function(e) {
                    return Boolean(i.findSegmentById(e.dimension))
                }).map(function(e) {
                    return e.name = t.getSegmentsTree().segmentName(e.dimension), e
                }), n.setSegments(e).then(function() {
                    n.trigger("menu-items-changed")
                })
            }))
        },
        _itemClickHandler: function(e) {
            this._filter[e.dimension] = e.value, this.trigger("filter-change", this._filter)
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "recent"
    }, {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-recent-segments").get(), BN("i-counters").getAsync()]).spread(function(e, t) {
                return t.isGroup() && (e.segments = e.segments.filter(function(e) {
                    return "Goal" !== e.dimension
                })), Vow.all([e, BN("i-recent-segments").localize(e.segments), BN("i-report").getMetadata()])
            }).spread(function(t, i, n) {
                var o = n.getSegmentsTree();
                t.segments = i, t.segments.forEach(function(e) {
                    e.name = o.segmentName(e.dimension)
                }), e.param("segments", t), e.param("segmentsTree", o)
            }).fail(function() {
                e.param("segments", {
                    total: 0,
                    limit: 0,
                    offset: 0,
                    segments: []
                })
            }))
        }
    }), BEM.JSON.decl("segment-label", {
        onBlock: function(e) {
            var t = e.param("withCounts") || !1,
                i = e.param("view") || "normal";
            t && e.mods({
                counts: "yes"
            }, !0), "inline" === i && (e.tag("span"), e.mod("inline", "yes")), e.params().disabled = "yes" === (e.mods() || {}).disabled, e.content({
                elem: i + "-view"
            })
        },
        onElem: {
            "inline-view": function(e) {
                var t = [],
                    i = e.blockParams(),
                    n = i.tree.getSegmentParents(i.segmentId),
                    o = i.tree.findSegmentById(i.segmentId);
                return o ? (t.push({
                    elem: "category-name",
                    tag: "span",
                    content: {
                        block: "filtered-text",
                        text: n.pop().name,
                        pattern: i.pattern
                    }
                }), t.push("&nbsp;= ("), t.push({
                    block: "segment-filter",
                    mix: {
                        block: "segment-label",
                        elem: "segment-filter"
                    },
                    type: o.type,
                    value: i.value,
                    segment: o,
                    separator: " " + BEM.I18N("segment-label", "or") + " ",
                    mods: {
                        more: (e.mods() || {}).more,
                        disabled: i.disabled ? "yes" : ""
                    }
                }), t.push(")"), void e.wrap(t)) : e.remove()
            },
            "compact-view": function(e) {
                var t = [],
                    i = e.blockParams(),
                    n = i.tree.getSegmentParents(i.segmentId),
                    o = i.tree.findSegmentById(i.segmentId);
                n.forEach(function(e, n) {
                    0 !== n && t.push({
                        elem: "category-name",
                        tag: "span",
                        mix: {
                            block: "segment-label",
                            elem: "separator"
                        },
                        content: {
                            block: "filtered-text",
                            text: e.name,
                            pattern: i.pattern
                        }
                    })
                }), t.push({
                    block: "segment-filter",
                    mix: {
                        block: "segment-label",
                        elem: "segment-filter"
                    },
                    type: o.type,
                    value: i.value,
                    segment: o,
                    mods: {
                        more: (e.mods() || {}).more,
                        disabled: i.disabled ? "yes" : ""
                    }
                }), e.wrap(t)
            }
        }
    }), BEM.JSON.decl("segment-label", {
        onBlock: function(e) {
            var t = e.params();
            t.tree || e.defer(BN("i-report").getMetadata().then(function(t) {
                e.params().tree = t.getSegmentsTree()
            }))
        }
    }), BEM.JSON.decl({
        name: "segment-label",
        modName: "counts",
        modVal: "yes"
    }, {
        onElem: {
            "category-name": function(e) {
                var t = e.mods() || {},
                    i = e.content(),
                    n = e.blockParams();
                "yes" === t.main && (i = i instanceof Array ? i : [i], i.push({
                    block: "segment-size",
                    segmentId: n.segmentId,
                    filter: n.value,
                    period: n.period
                }), e.content(i, !0))
            }
        }
    }), BEM.JSON.decl("segment-size", {
        onBlock: function(e) {
            var t = e.param("count");
            t = t || 0, e.tag("span").content([e.param("sampled") && t ? "&asymp;" : "", BN("humanize").format("number", t), "&nbsp", BN("i-string").escapeHTML(e.param("countMetricName"))])
        }
    }), BEM.JSON.decl("segment-size", {
        onBlock: function(e) {
            var t, i = e.params();
            i.count || (t = {}, t[i.segmentId] = i.filter, e.defer(Vow.all([BN("i-default-data").getMetrics({
                filter: t,
                requestId: i.requestId,
                period: i.period
            }), BN("i-report").getMetadata()]).spread(function(t, i) {
                var n = e.params();
                t && t.totals && void 0 !== t.totals[0] ? (n.count = t.totals[0], n.sampled = t.sampled) : (n.count = 0, n.sampled = !1), n.countMetricName = i.getCountMetricName(!0)
            })))
        }
    }), BEM.JSON.decl("segment-filter", {
        NUMERIC_OPERATIONS: {
            "<": "less",
            ">": "more",
            "==": "eq",
            "<>": "range"
        },
        onBlock: function(e) {
            var t = e.params(),
                i = e.mods() || {};
            i.disabled = t.disabled ? "yes" : i.disabled, i.theme = t.disabled ? "" : t.theme, i.hint = "yes", e.wrap([{
                block: "segment-filter",
                elem: "value-" + t.segment.type,
                segment: t.segment,
                value: t.value,
                mix: [{
                    elem: "value"
                }, {
                    block: "segment-filter",
                    js: !0,
                    mods: i
                }].concat(e.mix())
            }])
        },
        onElem: {
            "items-list-content": function(e) {
                var t = e.params();
                e.wrap([{
                    elem: "items-list-content-preview",
                    items: t.items,
                    exclude: t.exclude,
                    conjunction: t.conjunction
                }])
            },
            "items-list-content-preview": function(e) {
                var t = e.params(),
                    i = {
                        elem: "list-separator",
                        conjunction: t.conjunction
                    },
                    n = t.items.reduce(function(e, n, o, s) {
                        var r = n;
                        return null !== n && void 0 !== n && (n = BEM.I18N("segment-filter", "undefined")), "string" == typeof r && (r = BN("i-string").escapeHTML(r)), t.exclude && e.push({
                            elem: "not"
                        }), e.push(r), o !== s.length - 1 && e.push(i), e
                    }, []).filter(Boolean);
                e.tag("span").content(n.length ? n : BEM.I18N("segment-filter", "undefined"))
            },
            not: function(e) {
                e.tag("span").content(" " + BEM.I18N("segment-filter", "not-separator") + " ")
            },
            "list-separator": function(e) {
                e.tag("span").content(" " + BEM.I18N("segment-filter", e.param("conjunction") ? "and-separator" : "or-separator") + " ")
            },
            "value-uid": function(e) {
                e.remove()
            },
            "value-bool": function(e) {
                var t = e.param("value").value,
                    i = e.param("segment");
                e.content("Yes" === t ? i.yes_label : "No" === t ? i.no_label : BEM.I18N("segment-filter", "undefined"))
            },
            "value-number": function(e) {
                var t = e.param("value"),
                    i = e.param("segment");
                return null === t.value ? e.content(BEM.I18N("segment-filter", "undefined")) : (t = BN("i-segment-filter").decorateValue(t, i.units), void e.content([BEM.I18N("segment-filter", "value-number-" + this.NUMERIC_OPERATIONS[t.op], t.value.length > 1 ? {
                    from: t.value[0],
                    to: t.value[1]
                } : {
                    value: t.value
                }), t.unit ? [", ", t.unit.label] : null]))
            },
            "value-params": function(e) {
                var t = e.param("value");
                e.content([{
                    elem: "item-param-name",
                    tag: "span",
                    content: t.paramName
                }, t.paramVal ? [{
                    elem: "item-param-op",
                    tag: "span",
                    content: " " + ("==" === t.op ? "=" : t.op) + " "
                }, {
                    elem: "item-param-val",
                    tag: "span",
                    content: t.paramVal
                }] : ""])
            },
            "value-goals": function(e) {
                var t = e.param("value"),
                    i = e.param("goals"),
                    n = t.items.map(function(e) {
                        var t = BN("i-goal").getGoalById(e.id, i);
                        return t && t.name
                    }).filter(Boolean);
                n.length > 0 ? e.content({
                    elem: "items-list-content",
                    exclude: t.exclude,
                    conjunction: t.exclude,
                    items: n
                }) : e.content({
                    elem: "value-unavailable",
                    content: BEM.I18N("segment-filter", "value-unavailable")
                })
            },
            "value-list": function(e) {
                var t = e.param("value");
                e.content({
                    elem: "items-list-content",
                    exclude: t.exclude,
                    conjunction: t.exclude,
                    items: t.items.map(function(e) {
                        return e = e.name || e.id
                    })
                })
            },
            "value-tree": function(e) {
                var t = e.param("value");
                e.content({
                    elem: "items-list-content",
                    exclude: t.exclude,
                    conjunction: t.exclude,
                    items: t.items.map(function(e) {
                        return e[e.length - 1].name
                    }).filter(Boolean)
                })
            },
            "value-path": function(e) {
                var t = e.param("value"),
                    i = e.param("segment");
                e.content({
                    elem: "items-list-content",
                    exclude: t.exclude,
                    conjunction: t.exclude,
                    items: t.items.map(function(e) {
                        return i.concat ? e.map(function(e) {
                            return e.name
                        }).filter(Boolean).join(i.concat) : e[e.length - 1].name
                    }).filter(Boolean)
                })
            },
            "value-url": function(e) {
                var t = e.param("value");
                return t.items.filter(Boolean).length ? void e.content([{
                    elem: "value-multiline",
                    tag: "span",
                    value: t
                }, {
                    elem: "item-title",
                    tag: "span",
                    content: [", ", {
                        dim: BEM.I18N("segment-filter", "value-url-full"),
                        host_dim: BEM.I18N("segment-filter", "value-url-host"),
                        path_dim: BEM.I18N("segment-filter", "value-url-path")
                    }[t.urlMode]]
                }]) : e.content(BEM.I18N("segment-filter", "undefined"))
            },
            "value-multiline": function(e) {
                var t = e.param("value"),
                    i = t.items.map(function(e) {
                        var t, i = [];
                        return (e = e && e.trim()) ? (t = e.charAt(0), "!" === t && (i.push({
                            elem: "not"
                        }), e = e.substr(1), t = e.charAt(0)), "@" === t ? i.push({
                            elem: "multiline-item",
                            tag: "span",
                            mods: {
                                search: "in-begin"
                            },
                            content: BN("i-string").escapeHTML(e)
                        }) : "~" === t ? i.push({
                            elem: "multiline-item",
                            tag: "span",
                            mods: {
                                search: "regular"
                            },
                            content: BN("i-string").escapeHTML(e)
                        }) : i = e.split(/\*/).reduce(function(e, t, i, n) {
                            return e.push(BN("i-string").escapeHTML(t)), i !== n.length - 1 && (t.length && "\\" === t[t.length - 1] ? (e[e.length - 1] = e[e.length - 1].slice(0, -1), e.push("*")) : e.push({
                                elem: "regular-any",
                                tag: "span",
                                content: "*"
                            })), e
                        }, i), i) : !1
                    }).filter(Boolean);
                e.content({
                    elem: "items-list-content",
                    conjunction: t.conjunction,
                    items: i
                })
            },
            "value-date": function(e) {
                var t = e.param("value");
                e.content({
                    block: "segment-filter",
                    elem: "date",
                    tag: "span",
                    content: BN("i-period").compactFormat(t)
                })
            }
        }
    }), BEM.JSON.decl("segment-filter", {
        onElem: {
            "value-goals": function(e) {
                e.defer(BN("i-goal").getGoals().then(function(t) {
                    e.params().goals = t
                }))
            }
        }
    }), BEM.JSON.decl({
        name: "segment-filter",
        modName: "more",
        modVal: "yes"
    }, {
        LIMIT: 10,
        onElem: {
            "items-list-content": function(e) {
                var t = e.param("items");
                e.wrap([e.param("exclude") && {
                    block: "icon",
                    elem: "exclude-segment-item",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }, {
                    elem: "items-list-content-preview",
                    items: t.slice(0, this.LIMIT)
                }, {
                    elem: "items-more",
                    items: t.slice(this.LIMIT)
                }]).stop()
            },
            "items-more": function(e) {
                var t = e.param("items");
                return 0 === t.length ? void e.remove() : void e.wrap([{
                    elem: "item-content-more",
                    tag: "span",
                    content: ", " + t.join(", ")
                }, {
                    elem: "item-more-button",
                    content: {
                        block: "button",
                        mix: [{
                            block: "segment-filter",
                            elem: "button",
                            js: {
                                segment: e.param("segmentId"),
                                action: "moreItems"
                            }
                        }],
                        mods: {
                            pseudo: "yes",
                            size: "s"
                        },
                        content: BEM.I18N("segment-filter", "items-more-all-count", {
                            count: t.length + this.LIMIT
                        })
                    }
                }])
            }
        }
    }), BEM.DOM.decl({
        name: "segment-filter",
        modName: "more",
        modVal: "yes"
    }, {
        handleMoreItems: function(e) {
            var t = e.closest(this.buildSelector("value"));
            this.setMod(this.findElem(t, "item-content-more"), "visible", "yes"), this.afterCurrentEvent(function() {
                BEM.DOM.destruct(e)
            })
        }
    }, {
        live: function() {
            return this.liveInitOnBlockInsideEvent("press", "button", function(e) {
                this.handleMoreItems(e.block.domElem)
            }), !1
        }
    }),
    function() {
        var e = function(e, t) {
            this._maxSize = t, this._indexedTable = e.reduce(function(e, t) {
                return e[t.dimension] = t, e
            }, {})
        };
        e.prototype = {
            push: function(e, t) {
                var i = Date.now();
                this._indexedTable[e] = {
                    dimension: e,
                    modTime: i,
                    value: t
                }, this._indexedTable = this._sort(Object.keys(this._indexedTable)).slice(0, this._maxSize).reduce(function(e, t) {
                    return e[t] = this._indexedTable[t], e
                }.bind(this), {})
            },
            toList: function() {
                return this._sort(Object.keys(this._indexedTable)).map(function(e) {
                    return this._indexedTable[e]
                }.bind(this))
            },
            _sort: function(e) {
                return e.sort(function(e, t) {
                    return e = this._indexedTable[e], t = this._indexedTable[t], t.modTime - e.modTime
                }.bind(this))
            }
        }, BEM.decl("i-recent-segment-queue", {}, {
            init: function(t, i) {
                return new e(t, i)
            }
        })
    }(), BEM.decl({
        block: "i-recent-segments",
        baseBlock: "i-segments-list"
    }, null, BEM.blocks["i-proxy"].initProxy("i-recent-segments", ["_get*", "update"])), BEM.decl("i-recent-segments", null, {
        localize: function(e) {
            var t = e.reduce(function(e, t) {
                return e[t.dimension] = t.value, e
            }, {});
            return BN("i-report").getMetadata().then(function(i) {
                return BN("i-filter").localizeFilter(t, i.getSegmentsTree()).then(function(t) {
                    return e.forEach(function(e) {
                        e.value = t[e.dimension]
                    }), e
                })
            })
        },
        get: function() {
            return this._get().then(function(e) {
                return e.forEach(function(e) {
                    e.segment = {}, e.segment[e.dimension] = e.value
                }), this._checkApplicability(e)
            }.bind(this)).then(function(e) {
                return {
                    total: e.length,
                    offset: 0,
                    limit: e.length,
                    segments: e
                }
            })
        },
        update: function(e) {
            var t = this.__base(e.map(function(e) {
                return e = jQuery.extend(!0, {}, e), delete e.value.disabled, e
            }));
            return t.then(function() {
                BN("i-proxy").cleanCache("i-recent-segments", "_get")
            }), t
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "user"
    }, {
        onElem: {
            label: function(e) {
                e.content(e.param("label") || BEM.I18N("segments-menu-item", "users-label"))
            },
            item: function(e) {
                e.content({
                    block: "icon",
                    elem: "close",
                    mix: [{
                        block: "segments-menu-item",
                        elem: "remove"
                    }]
                })
            }
        }
    }), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "user"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), BEM.blocks["segments-menu-item"].on("removed", this._refreshList, this), this._segment = this.getMod(this.findElem("item", "selected", "yes"), "id") || null, this._activeSegment = this._segment ? this._findSegmentById(this._segment) : {}
            }
        },
        destruct: function() {
            BEM.blocks["segments-menu-item"].un("removed", this._refreshList, this), this.__base.apply(this, arguments)
        },
        selectItem: function(e) {
            return this._segment = e, this._activeSegment = e ? this._findSegmentById(e) : null, this.__base(e)
        },
        _itemClickHandler: function(e) {
            this.selectItem(e.id), this._publishSegment({
                filter: e.segment,
                segment: {
                    id: e.id,
                    name: e.name,
                    segment: e.segment,
                    type: "user"
                }
            })
        },
        _setFilter: function(e) {
            var t = this._activeSegment;
            t && !jQuery.equals(e, t.segment) && this.selectItem()
        },
        _setSegment: function(e) {
            this.selectItem(e.id), e && this._refreshList()
        },
        _refreshList: function() {
            var e = this;
            BN("i-user-segments").getList().then(function(t) {
                return e.setSegments(t.segments)
            }).then(function() {
                e._segment && e.selectItem(e._segment)
            }).done()
        },
        _removeClickHandler: function(e) {
            var t = this,
                i = this.elemParams(jQuery(e.target).closest(this.buildSelector("item"))).segment;
            BN("confirm-popup").show({
                text: BEM.I18N("segments-menu-item", "confirm-remove"),
                modal: !0,
                fixed: !0
            }).then(function() {
                BN("i-user-segments").remove(i.id).then(function() {
                    t.trigger("removed"), String(t._segment) === String(i.id) && t._publishSegment({
                        segment: null
                    })
                }).done()
            })
        }
    }, {
        live: function() {
            return this.liveBindTo("remove", "click", function(e) {
                e.stopPropagation(), this._removeClickHandler(e)
            }), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "type",
        modVal: "user"
    }, {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-user-segments").getList(), BN("i-counters").getAsync()]).spread(function(t, i) {
                e.param("segments", t), i.isGroup() ? e.remove() : i.isEditable() || e.mods(jQuery.extend(e.mods(), {
                    remove: "no"
                }), !0)
            }).fail(function() {
                e.remove()
            }))
        }
    }),
    function() {
        BN.addDecl("i-segments-params").staticProp({
            _declTemplates: {},
            genDecl: function(e, t) {
                var i = this;
                [].concat(t).forEach(function(t) {
                    if (!i._declTemplates.hasOwnProperty(t)) throw new Error("Uncknown template name: " + t);
                    BEM.JSON.decl(e, {
                        onBlock: i._declTemplates[t]
                    })
                }, this)
            },
            _getData: function(e) {
                return BN(e.block)[e.method]()
            }
        }).done(), [{
            name: "period",
            block: "i-period",
            method: "getPeriod",
            param: "period"
        }, {
            name: "secondary-period",
            block: "i-period",
            method: "getSecondaryPeriod",
            param: "period"
        }, {
            name: "filter",
            block: "i-filter",
            method: "getFilter",
            param: "filter"
        }, {
            name: "secondary-filter",
            block: "i-filter",
            method: "getSecondaryFilter",
            param: "filter"
        }, {
            name: "segment",
            block: "i-segments",
            method: "getSegment",
            param: "segment"
        }, {
            name: "secondary-segment",
            block: "i-segments",
            method: "getSecondarySegment",
            param: "segment"
        }].forEach(function(e) {
            BN("i-segments-params")._declTemplates[e.name] = function(t) {
                var i = t.params();
                i[e.param] || t.defer(Vow.promise(BN("i-segments-params")._getData(e)).then(function(t) {
                    i[e.param] = t
                }))
            }
        })
    }(), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                initAccessor: "_filter",
                set: "_setFilter",
                event: "filter-change",
                get: "_filter"
            },
            "segments.primary.segment": {
                set: "_setSegment",
                event: "segment-change"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "primary"
    }, "segment"), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                initAccessor: "_filter",
                set: "_setFilter",
                event: "filter-change",
                get: "_filter"
            },
            "segments.secondary.segment": {
                set: "_setSegment",
                event: "segment-change"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "secondary"
    }, "secondary-segment"), BEM.JSON.decl("segments-menu", {
        onBlock: function(e) {
            var t = e.params();
            e.js(jQuery.extend(!0, e.js(), {
                filter: t.filter
            })), e.content({
                elem: "menu",
                tree: t.tree,
                filter: t.filter || {}
            })
        },
        onElem: {
            menu: function(e) {
                var t = e.params();
                e.content(e.param("tree").map(function(e) {
                    return e.chld ? {
                        elem: "group",
                        title: e.name,
                        nda: BN("i-segment-tree").isInternalSegment(e),
                        items: e.chld,
                        pattern: t.pattern,
                        filter: t.filter,
                        disabled: e.disabled
                    } : {
                        elem: "item",
                        item: e,
                        pattern: t.pattern,
                        selected: t.filter && t.filter[e.id]
                    }
                }))
            },
            group: function(e) {
                var t = e.params(),
                    i = e.mod("level") || 0,
                    n = t.items || [],
                    o = t.filter,
                    s = function r(e) {
                        return e.some(function(e) {
                            return Boolean(o[e.id]) || e.chld && r(e.chld)
                        })
                    }(n);
                e.mod("expanded", "no").mod("disabled", t.disabled && "yes").content([{
                    elem: "group-header",
                    mix: [{
                        block: "segments-menu",
                        elem: "level-" + i
                    }, {
                        block: "selection-disabler"
                    }],
                    content: [{
                        elem: "group-header-i",
                        content: {
                            elem: "element-wrapper",
                            text: t.title,
                            selected: s,
                            pattern: t.pattern,
                            nda: t.nda
                        }
                    }, {
                        block: "icon",
                        elem: "arrow",
                        mix: [{
                            block: "icon",
                            mods: {
                                direction: "right"
                            }
                        }, {
                            block: "segments-menu",
                            elem: "arrow"
                        }]
                    }]
                }, {
                    elem: "group-content",
                    content: n.map(function(t) {
                        return !t.dim && t.chld && t.chld.length ? {
                            elem: "group",
                            title: t.name,
                            items: t.chld,
                            mods: {
                                level: i + 1
                            },
                            filter: o,
                            pattern: e.param("pattern"),
                            disabled: t.disabled
                        } : [this._getItem(t, i, o, e.param("pattern"))].concat(this._getSubitems(t, i + 1, o, e.param("pattern")))
                    }, this)
                }])
            },
            item: function(e) {
                var t = e.param("item");
                e.content([{
                    elem: "element-wrapper",
                    selected: e.param("selected"),
                    text: t.name,
                    pattern: e.param("pattern"),
                    nda: BN("i-segment-tree").isInternalSegment(t)
                }]), e.mods({
                    id: BEM.toModVal(t.id),
                    current: "no",
                    disabled: t.disabled ? "yes" : "no"
                }), e.mix([{
                    block: "segments-menu",
                    elem: "level-" + (e.params().level + 1)
                }]), e.js({
                    id: t.id
                })
            },
            "element-wrapper": function(e) {
                e.mods({
                    selected: e.param("selected") ? "yes" : "no"
                }).content([{
                    tag: "span",
                    elem: "element-text",
                    content: {
                        block: "filtered-text",
                        text: e.param("text"),
                        pattern: e.param("pattern"),
                        mix: [e.param("nda") && {
                            block: "nda-message"
                        }]
                    }
                }, {
                    block: "icon",
                    elem: "moon"
                }])
            }
        },
        _getItem: function(e, t, i, n) {
            var o = {
                elem: "item",
                item: e,
                level: t,
                pattern: n
            };
            return o.selected = Boolean(i[e.id]), o
        },
        _getSubitems: function(e, t, i, n) {
            return e.chld && e.chld.length ? e.chld.map(function(e) {
                return [this._getItem(e, t, i, n)].concat(this._getSubitems(e, t + 1, i, n))
            }, this) : null
        }
    }), BEM.DOM.decl("segments-menu", {
        onSetMod: {
            js: function() {
                this._filter = this.params.filter, this._searchPattern = "", this._popupName = this.__self.getName() + "-" + this.getMod("type"), this._sendMetrikaParams = jQuery.debounce(this._sendMetrikaParams, 1e3, this)
            }
        },
        closeMenu: function() {
            this.setMod(this._currentGroup, "expanded", "no")
        },
        filter: function(e) {
            this.setMod("filtered", "yes"), this._searchPattern = e, this._redraw().done()
        },
        handleChangePosition: function() {
            BN("segment-panel-popup").repaint(this._popupName)
        },
        handleContainerScroll: function() {
            BN("segment-panel-popup").hide(this._popupName)
        },
        updateFilters: function(e) {
            var t, i, n, o = this.findElem("element-wrapper", "selected", "yes");
            this._filter = e, this.delMod(this.elemify(o, "element-wrapper"), "selected");
            for (t in e) e.hasOwnProperty(t) && (i = this.findElem(this.findElem("item", "id", BEM.toModVal(t)), "element-wrapper"), n = i.parents(this.buildSelector("group")).children(this.buildSelector("group-header")).find(this.buildSelector("element-wrapper")).add(i), n = this.elemify(n, "element-wrapper"), this.setMod(n, "selected", "yes"))
        },
        expandGroup: function(e, t) {
            var i;
            this.setMod(e, "expanded", t ? "yes" : "no"), this.getMod(e, "level") < 1 ? t ? (this._currentGroup && -1 === this._currentGroup.index(e) && this.setMod(this._currentGroup, "expanded", "no"), this._currentGroup = e) : this._currentGroup = null : t && (i = this._findGroupByChild(e), i && i.length && this.expandGroup(i, t))
        },
        _redraw: function() {
            throw new Error("should be implemented in '_data' block modification")
        },
        _updateMenu: function(e) {
            var t = this._searchPattern.toLowerCase().trim(),
                i = Boolean(t) ? e.searchByName(t) : e.getVisibleSubtree();
            return BN("i-content").replace(this.findElem("menu"), {
                block: "segments-menu",
                elem: "menu",
                pattern: t,
                tree: i,
                filter: this._filter
            }).then(function() {
                this.setMod(this.findElem("group"), "expanded", "" === t ? "no" : "yes")
            }.bind(this))
        },
        _findGroupByChild: function(e) {
            return this.elemify(e.parents(this.buildSelector("group")).first(), "group")
        },
        _onHeaderClick: function(e) {
            var t = e.data.domElem.closest(this.buildSelector("group"));
            this.expandGroup(t, !this.hasMod(t, "expanded", "yes")), this.hasMod(t, "expanded", "yes") && this.trigger("open")
        },
        _onItemClick: function(e) {
            var t, i = e.data.domElem,
                n = this.getMods();
            this.hasMod(i, "disabled", "no") && (t = jQuery.extend({
                segmentId: this.elemParams(i).id
            }, this.params), delete t.filter, BN("segment-panel-popup").show(this._popupName, i, {
                params: n.type,
                "data-bind": n["data-bind"],
                data: n.data
            }, t).then(function(e) {
                e.findBlockInside("segment-panel").on("change", this._sendMetrikaParams)
            }.bind(this)).done())
        },
        _sendMetrikaParams: function() {
            BN("metrika-counter").params("segmentation-menu-select", "custom")
        }
    }, {
        live: function() {
            return this.liveBindTo("group-header", "click", function(e) {
                this._onHeaderClick(e)
            }), this.liveBindTo("item", "click", function(e) {
                this._onItemClick(e)
            }), !1
        }
    }), BEM.DOM.decl("segment-panel-popup", {
        onSetMod: {
            js: function() {
                this._popup = this.findBlockInside("popup"), this._popup.on("hide", this._onPopupHide, this)
            },
            loading: function(e, t) {
                t && (this._timeout = setTimeout(this._renderLoader.bind(this), 220))
            }
        },
        destruct: function() {
            this._popup.un("hide", this._onPopupHide, this)
        },
        show: function(e, t) {
            var i, n;
            this.toggleMod("loading", "yes", !Boolean(t)), this._lastTarget = e, t && (this._popup.setContent(t).show(this._lastTarget), i = this._popup.findBlockInside("segment-panel"), n = i && i.findBlockInside(i.params.autofocus || "search", "input"), n && n.focus())
        },
        hide: function() {
            this._popup.hide(), BEM.DOM.destruct(!0, this.elem("content"), !0)
        },
        isShown: function() {
            return this._popup.isShown()
        },
        _onPopupHide: function() {
            this.trigger("hide")
        },
        _renderLoader: function() {
            this.hasMod("loading") && this._popup.setContent(BN("i-content").html({
                block: "segment-panel-popup",
                elem: "load",
                content: [BEM.I18N("segment-panel-popup", "loading"), {
                    block: "spin2",
                    mods: {
                        size: "xxs",
                        progress: "yes"
                    },
                    mix: [{
                        block: "segment-panel-popup",
                        elem: "spin"
                    }]
                }]
            }, !0)).show(this._lastTarget)
        }
    }, {
        _popups: {},
        _currentPopupTarget: null,
        show: function(e, t, i, n) {
            var o = this._getPopup(e);
            return this._currentPopupTarget = t, o.onFirst("hide", this._onPopupWrapperHide, this), o.show(t), BN("i-content").html(jQuery.extend({
                block: "segment-panel",
                mods: i
            }, n)).then(function(e) {
                return o.show(t, e), o
            })
        },
        toggle: function(e, t, i, n) {
            var o = this._getPopup(e);
            o.isShown() && this._currentPopupTarget === t ? this.hide(e) : this.show(e, t, i, n)
        },
        repaint: function(e) {
            var t = this._getPopup(e);
            return t.findBlockOn("popup").repaint()
        },
        hide: function(e) {
            this._getPopup(e).hide()
        },
        _onPopupWrapperHide: function() {
            this._currentPopupTarget = null
        },
        _getPopupBEMJSON: function(e) {
            return {
                block: "popup",
                mix: [{
                    block: "segment-panel-popup"
                }],
                mods: {
                    id: e,
                    adaptive: "no"
                },
                js: {
                    directions: ["right", "left"]
                },
                content: [{
                    elem: "close"
                }, {
                    elem: "tail"
                }, {
                    elem: "content"
                }]
            }
        },
        _getPopup: function(e) {
            var t = this._popups[e];
            return t || (t = jQuery(BN("i-content").html(this._getPopupBEMJSON(e), !0)).bem("popup"), this._popups[e] = t = t.findBlockInside("segment-panel-popup")), t
        }
    }), BEM.DOM.decl({
        name: "segment-panel",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                initAccessor: "_filter",
                event: "change"
            },
            "report.period": {
                initAccessor: "_period"
            }
        }
    }), BEM.DOM.decl({
        name: "segment-panel",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                initAccessor: "_filter",
                event: "change"
            },
            "segments.primary.period": {
                initAccessor: "_period"
            }
        }
    }), BEM.DOM.decl({
        name: "segment-panel",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                initAccessor: "_filter",
                event: "change"
            },
            "segments.secondary.period": {
                initAccessor: "_period"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segment-panel",
        modName: "params",
        modVal: "primary"
    }, ["period", "filter"]), BN("i-segments-params").genDecl({
        name: "segment-panel",
        modName: "params",
        modVal: "secondary"
    }, ["secondary-period", "secondary-filter"]), BEM.DOM.decl({
        block: "segment-panel",
        modName: "data",
        modVal: "report"
    }, {
        _getSuggestData: function(e, t, i, n) {
            var o, s = {
                    period: this._period,
                    filter: e,
                    dimensions: t,
                    metrics: i.count_metric
                },
                r = BN("i-promise").createChain(this);
            return o = n && "visits" !== this.params.segment.table ? BN("i-report").getMetadata().then(r(function(e) {
                return s.presetFilter = e.getPresetFilter(), s
            })) : Vow.promise(s), o.then(r(function(e) {
                return BN("i-default-data").getMetricsByDimensions(e)
            }))
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "data",
        modVal: "report"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getMetadata().then(function(t) {
                var i = e.params(),
                    n = i.segmentId,
                    o = t.getSegmentsTree().findSegmentById(n);
                e.mod("type", t.getSegmentsTree().segmentType(n)), i.segment = o, "yes" === e.mod("list") && o.table && o.table !== t.getTableId() && e.param("noCounts", !0)
            }))
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "data",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                period: t.period,
                filter: t.filter,
                widgetModelId: t.widgetModelId
            })
        },
        onElem: {
            content: function(e) {
                var t = e.params(),
                    i = e.blockParams();
                t.addCheckboxListJsParams = {
                    widgetModelId: i.widgetModelId
                }
            }
        }
    }), BEM.DOM.decl({
        block: "segment-panel",
        modName: "data",
        modVal: "dashboard"
    }, {
        onSetMod: {
            js: function() {
                this._filter = this.params.filter, this._period = this.params.period, this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this.__base.apply(this, arguments)
            }
        },
        _triggerChangesImmediately: function() {
            this.__base.apply(this, arguments), this._widgetModel.setFilterObject(this._filter).done()
        },
        _getSuggestData: function(e, t, i) {
            return Vow.all([this._widgetModel.getStatRequestParams(), this._widgetModel.getFilterObject(), this._widgetModel.getSegmentsTree()]).spread(function(n, o, s) {
                var r = {
                    ids: n.ids,
                    date1: n.date1,
                    date2: n.date2,
                    goal_id: n.goal_id,
                    metrics: i.count_metric || this._widgetModel.getDefaultMetric(),
                    dimensions: t,
                    limit: 10,
                    filters: BN("i-filter").buildFilter(jQuery.extend(o, e), s)
                };
                return BEM.blocks["i-stat-data-api"].get("/", {
                    params: r
                })
            }.bind(this)).then(function(e) {
                return {
                    items: e.data,
                    sampled: e.sampled
                }
            })
        },
        _validateFilter: function(e) {
            return Vow.all([this._widgetModel.getStatRequestParams(), this._widgetModel.getSegmentsTree()]).spread(function(t, i) {
                return BEM.blocks["i-stat-data-api"].get("/", {
                    params: {
                        ids: t.ids,
                        date1: t.date1,
                        date2: t.date2,
                        goal_id: t.goal_id,
                        metrics: this.params.segment.count_metric || this._widgetModel.getDefaultMetric(),
                        dimensions: this.params.segment.dim,
                        limit: 1,
                        filters: BN("i-filter").buildFilter(e, i)
                    }
                })
            }.bind(this))
        }
    }), BEM.JSON.decl({
        name: "segment-panel",
        modName: "data",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("m-widget").getOne(t.widgetModelId);
            e.defer(Vow.all([i.getSegmentsTree(), i.getFilterObject()]).spread(function(n, o) {
                var s = t.segmentId,
                    r = n.findSegmentById(s);
                e.mod("type", n.segmentType(s)), t.segment = r, "yes" === e.mod("list") && r.table && r.table !== t.table && (t.noCounts = !0), t.filter = o, t.period = BN("i-period").parsePeriod(i.get("urlParams").get("period"))
            }))
        }
    }), BEM.DOM.decl({
        name: "segments-menu",
        modName: "data",
        modVal: "report"
    }, {
        _redraw: function() {
            return BN("i-report").getMetadata().then(function(e) {
                return this._updateMenu(e.getSegmentsTree())
            }.bind(this))
        }
    }), BEM.JSON.decl({
        name: "segments-menu",
        modName: "data",
        modVal: "report"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getMetadata().then(function(t) {
                e.params().tree = t.getSegmentsTree().getVisibleSubtree()
            }))
        }
    }), BEM.DOM.decl({
        block: "segments-menu",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                initAccessor: !0,
                set: "updateFilters"
            }
        }
    }), BEM.DOM.decl({
        block: "segments-menu",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                initAccessor: !0,
                set: "updateFilters"
            }
        }
    }), BEM.DOM.decl({
        block: "segments-menu",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                initAccessor: !0,
                set: "updateFilters"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-menu",
        modName: "type",
        modVal: "primary"
    }, "filter"), BN("i-segments-params").genDecl({
        name: "segments-menu",
        modName: "type",
        modVal: "secondary"
    }, "secondary-filter"), BEM.JSON.decl({
        name: "segments-selector",
        modName: "type",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            e.js({
                content: {
                    widgetModelId: e.param("widgetModelId")
                }
            })
        },
        onElem: {
            "menu-items": function(e) {
                var t = e.blockParams();
                e.content({
                    block: "segments-menu",
                    mods: {
                        "data-bind": "dashboard",
                        type: "dashboard",
                        data: "dashboard"
                    },
                    widgetModelId: t.widgetModelId
                })
            }
        }
    }), BEM.JSON.decl({
        name: "segments-menu",
        modName: "data-bind",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            })
        }
    }), BEM.JSON.decl({
        name: "segments-menu",
        modName: "data-bind",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("m-widget").getOne(t.widgetModelId),
                n = i.get("table");
            e.defer(Vow.all([BN("i-segment-tree").create(n), i.getFilterObject()]).spread(function(e, i) {
                t.filter = i, t.tree = e.getVisibleSubtree()
            }))
        }
    }), BEM.DOM.decl({
        name: "segments-menu",
        modName: "data",
        modVal: "dashboard"
    }, {
        onSetMod: {
            js: function() {
                this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._widgetModel.on("filter", "change", this._updateFilters, this), this._widgetModel.on("table", "change", this._updateMenuWithReset, this), this.__base.apply(this, arguments)
            }
        },
        destruct: function() {
            return this._widgetModel.un("filter", "change", this._updateFilters, this), this._widgetModel.un("table", "change", this._updateMenuWithReset, this), this.__base.apply(this, arguments)
        },
        _updateFilters: function() {
            this._widgetModel.getFilterObject().then(this.updateFilters.bind(this)).done()
        },
        _updateMenuWithReset: function() {
            this._widgetModel.resetFilter(), this._redraw().then(function() {
                this._updateFilters()
            }.bind(this)).done()
        },
        _redraw: function() {
            return this._widgetModel.getSegmentsTree().then(this._updateMenu.bind(this))
        }
    }), BEM.JSON.decl("segments-list", {
        onBlock: function(e) {
            var t = e.params(),
                i = e.mods() || {};
            i = jQuery.extend(i, {
                empty: BN("i-filter").isFiltersListEmpty(t.filter) ? "yes" : ""
            }), e.js(jQuery.extend(e.js(), {
                filter: t.filter,
                mix: t.mix
            })).mods(i, !0).content([{
                elem: "reset-all",
                mods: {
                    visible: BN("i-filter").isFiltersListEmpty(t.filter) ? "" : "yes"
                }
            }, {
                block: "wait",
                mix: [{
                    block: "segments-list",
                    elem: "wait"
                }]
            }, {
                elem: "tables",
                filter: t.filter
            }])
        },
        onElem: {
            tables: function(e) {
                var t = e.param("filtersByTable") || {},
                    i = e.param("tree");
                e.content(Object.keys(t).map(function(e) {
                    return {
                        elem: "table",
                        tableId: e,
                        filter: t[e],
                        tree: i
                    }
                }))
            },
            table: function(e) {
                var t = e.param("tableId"),
                    i = e.param("filter"),
                    n = e.param("tree");
                e.content([{
                    elem: "table-name",
                    content: BEM.I18N("segments-list", "table-" + t)
                }, {
                    elem: "items",
                    filter: i,
                    tree: n
                }])
            },
            items: function(e) {
                var t = e.params().filter || {},
                    i = e.param("tree");
                e.content(Object.keys(t).map(function(e, n) {
                    return [0 !== n && {
                        elem: "and-separator",
                        content: BEM.I18N("segments-list", "and")
                    }, {
                        elem: "item",
                        segment: i.findSegmentById(e),
                        value: t[e]
                    }]
                }))
            },
            item: function(e) {
                var t = e.params(),
                    i = t.segment,
                    n = t.value,
                    o = i.disabled || n.disabled,
                    s = BN("segment-panel").isKnownSegment(i.type) && !o;
                e.mix([{
                    elem: "button",
                    js: jQuery.extend(t.buttonJsParams, {
                        segmentId: i.id,
                        action: "edit"
                    }),
                    mods: {
                        disabled: s ? "" : "yes"
                    }
                }]), e.mods({
                    disabled: o ? "yes" : "",
                    editable: s ? "yes" : ""
                }), e.content([{
                    elem: "segment-name",
                    content: BN("i-string").escapeHTML(i.name),
                    mix: [{
                        elem: "segment-label"
                    }]
                }, " ", {
                    block: "segment-filter",
                    value: n,
                    segment: i,
                    disabled: o,
                    theme: "color",
                    mix: [{
                        block: "segments-list",
                        elem: "segment-label"
                    }]
                }, {
                    block: "icon",
                    elem: "cross",
                    title: BEM.I18N("segments-list", "button-remove"),
                    mix: [{
                        block: "segments-list",
                        elem: "button",
                        js: {
                            segmentId: i.id,
                            action: "remove"
                        }
                    }]
                }])
            },
            "reset-all": function(e) {
                e.content({
                    block: "button",
                    mods: {
                        size: "s"
                    },
                    mix: [{
                        block: "segments-list",
                        elem: "button",
                        js: {
                            action: "reset"
                        }
                    }],
                    content: BEM.I18N("segments-list", "reset-all")
                })
            }
        }
    }), BEM.JSON.decl("segments-list", {
        onElem: {
            tables: function(e) {
                var t, i = e.params(),
                    n = i.filter;
                t = i.tree ? Vow.promise(i.tree) : BN("i-report").getMetadata().then(function(e) {
                    return e.getSegmentsTree()
                }), e.defer(t.then(function(t) {
                    return i.tree = t, BN("i-filter").localizeFilter(n, t).then(function(i) {
                        e.params().filtersByTable = Object.keys(i || {}).reduce(function(e, n) {
                            var o, s = t.findSegmentById(n);
                            return s ? (o = s.table, e[o] = e[o] || {}, e[o][n] = i[n], e) : e
                        }, {})
                    })
                }))
            }
        }
    }), BEM.DOM.decl("segments-list", {
        onSetMod: {
            js: function() {
                this._popupName = this.__self.getName(), this._redraw = jQuery.debounce(this._redraw.bind(this), 100), this.liveBindTo("button", "click", this._onButtonClick), this.liveBindTo("item", "hover", this._onItemHover)
            }
        },
        update: function(e) {
            this.params.filter = e, this._redraw()
        },
        _buttonActions: {
            edit: function(e, t) {
                this.params.popupOwnerSegmentId === e.segmentId ? (BN("adaptive-segment-panel-popup").hide(this._popupName), this.params.popupOwnerSegmentId = null) : BN("adaptive-segment-panel-popup").show(this._popupName, t, {
                    params: this.getMod("type"),
                    "data-bind": this.getMod("data-bind"),
                    data: this.getMod("data")
                }, e).then(function(t) {
                    this.params.popupOwnerSegmentId = e.segmentId, t.onFirst("hide", function() {
                        this.params.popupOwnerSegmentId = null
                    }.bind(this))
                }.bind(this)).done()
            },
            remove: function(e) {
                delete this.params.filter[e.segmentId], this._updateFilter()
            },
            reset: function() {
                this.params.filter = {}, this._updateFilter()
            }
        },
        _updateFilter: function() {
            this.trigger("change", this.params.filter), this.update(this.params.filter)
        },
        _redraw: function() {
            var e = BN("i-promise").createChain(this),
                t = BN("i-filter").isFiltersListEmpty(this.params.filter);
            t || this.delMod("empty"), this.findBlockOn("wait", "wait").show(), this._renderTablesHtml().then(e(function(e) {
                BEM.DOM.replace(this.findElem("tables"), e)
            })).always(e(function(e) {
                return this.findBlockOn("wait", "wait").hide(), t && this.setMod("empty", "yes"), this.trigger("rendered"), e
            })).done()
        },
        _renderTablesHtml: function() {
            return BN("i-content").html({
                block: this.__self.getName(),
                elem: "tables",
                mods: this.getInitialMods(),
                filter: this.params.filter
            })
        },
        _onButtonClick: function(e) {
            var t = this.elemify(e.currentTarget, "button"),
                i = this.elemParams(t);
            this.hasMod(t, "disabled") || this._buttonActions[i.action].call(this, i, t), e.stopPropagation()
        },
        _onItemHover: function(e) {
            var t = jQuery(e.currentTarget);
            t.attr("title", t.text().replace(/\s+/g, " ")), e.stopPropagation()
        }
    }), BEM.DOM.decl({
        name: "adaptive-segment-panel-popup",
        baseBlock: "segment-panel-popup"
    }, {}, {
        _getPopupBEMJSON: function() {
            var e = this.__base.apply(this, arguments);
            return e.mods.adaptive = "yes", e
        }
    }), BEM.JSON.decl({
        name: "segments-list",
        modName: "data",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            })
        },
        onElem: {
            "segment-label": function(e) {
                var t = e.params();
                e.wrap([{
                    block: "segment-label",
                    segmentId: t.segmentId,
                    value: t.value,
                    period: t.period,
                    withCounts: !1,
                    widgetModelId: e.blockParams().widgetModelId,
                    mods: {
                        disabled: t.disabled ? "yes" : "",
                        data: "dashboard"
                    }
                }])
            },
            item: function(e) {
                e.param("buttonJsParams", {
                    widgetModelId: e.blockParams().widgetModelId
                })
            }
        }
    }), BEM.DOM.decl({
        name: "segments-list",
        modName: "data",
        modVal: "dashboard"
    }, {
        onSetMod: {
            js: function() {
                this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this.__base.apply(this, arguments)
            }
        },
        _updateFilter: function() {
            this._widgetModel.setFilterObject(this.params.filter).done(), this.__base.apply(this, arguments)
        },
        _renderTablesHtml: function() {
            return BN("i-content").html({
                block: this.__self.getName(),
                elem: "tables",
                mods: this.getInitialMods(),
                filter: this.params.filter,
                widgetModelId: this.params.widgetModelId
            })
        }
    }), BEM.JSON.decl({
        name: "segments-list",
        modName: "data",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("m-widget").getOne(t.widgetModelId);
            e.defer(i.getFilterObject().then(function(e) {
                t.filter = e
            }))
        },
        onElem: {
            tables: function(e) {
                var t = e.params(),
                    i = e.blockParams(),
                    n = BN("m-widget").getOne(t.widgetModelId || i.widgetModelId);
                e.defer(n.getSegmentsTree().then(function(e) {
                    t.tree = e
                }))
            }
        }
    }), BEM.JSON.decl({
        name: "segment-label",
        modName: "data",
        modVal: "dashboard"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = BN("m-widget").getOne(t.widgetModelId);
            e.defer(i.getSegmentsTree().then(function(e) {
                t.tree = e
            }))
        }
    }),
    function() {
        BEM.DOM.decl("tabs", {
            getCount: function() {
                return this.elem("tab").length
            },
            activate: function(e) {
                return this
            },
            getActive: function() {
                return -1
            },
            disable: function(e) {
                return this
            },
            enable: function(e) {
                return this
            },
            isDisabled: function(e) {},
            _onControlChange: function(e, t) {}
        }, {
            getSupportedControls: function() {
                return ["tabs-menu", "radio-button"]
            },
            live: function() {
                this.getSupportedControls().forEach(function(e) {
                    BEM.blocks[e] && this.liveInitOnBlockInsideEvent("change", e, function(e, t) {
                        this._onControlChange(e, t)
                    })
                }, this)
            }
        })
    }(), BEM.DOM.decl({
        block: "tabs",
        modName: "control",
        modVal: "menu"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._tabsMenu = this.findBlockOn("control", "tabs-menu")
            }
        },
        activate: function(e) {
            return this._tabsMenu.setMod(this._tabsMenu.getTab(e), "active", "yes"), this
        },
        disable: function(e) {
            return this._tabsMenu.setMod(this._tabsMenu.getTab(e), "disabled", "yes"), this
        },
        enable: function(e) {
            return this._tabsMenu.delMod(this._tabsMenu.getTab(e), "disabled"), this
        },
        getActive: function() {
            return this._tabsMenu.indexOfTab(this._tabsMenu.getActive())
        },
        isDisabled: function(e) {
            return this._tabsMenu.hasMod(this._tabsMenu.getTab(e), "disabled", "yes")
        },
        _onControlChange: function(e, t) {
            t.current.attr("aria-selected", !0), t.prev.attr("aria-selected", !1), this.trigger("change", {
                currentIndex: this._tabsMenu.indexOfTab(t.current),
                prevIndex: this._tabsMenu.indexOfTab(t.prev)
            })
        }
    }),
    function() {
        var e = 37,
            t = 38,
            i = 39,
            n = 40;
        BEM.DOM.decl("tabs-menu", {
            onSetMod: {
                js: function() {
                    this._linksCache = []
                }
            },
            onElemSetMod: {
                tab: {
                    active: {
                        yes: function(e) {
                            if (this.hasMod(e, "disabled", "yes")) return !1;
                            var t = this.getActive();
                            this.delMod(t, "active").trigger("change", {
                                current: e,
                                prev: t
                            })
                        }
                    },
                    disabled: function(e, t, i) {
                        this._getLink(e).setMod("disabled", i).domElem.removeAttr("tabindex"), "yes" === i ? e.attr("aria-disabled", !0) : e.removeAttr("aria-disabled")
                    }
                }
            },
            getActive: function() {
                return this.findElem("tab", "active", "yes")
            },
            getTab: function(e) {
                return this.elem("tab").eq(e)
            },
            indexOfTab: function(e) {
                return $.inArray(e.get(0), this.elem("tab"))
            },
            _getTabByElem: function(e) {
                return e.closest(this.buildSelector("tab"))
            },
            _getLink: function(e) {
                var t = this.indexOfTab(e);
                return this._linksCache[t] || (this._linksCache[t] = this.findBlockInside(e, "link"))
            },
            _activateRelative: function(e) {
                var t = this.elem("tab").not(this.findElem("tab", "disabled", "yes")),
                    i = $.inArray(this.getActive().get(0), t) + e;
                0 > i || i > t.length || this.setMod(t.eq(i), "active", "yes")
            },
            _onTabCilck: function(e) {
                e.preventDefault(), this.setMod(this._getTabByElem($(e.target)), "active", "yes")
            },
            _onTabKeyDown: function(o) {
                o.shiftKey || o.ctrlKey || o.altKey || o.metaKey || (o.keyCode === i || o.keyCode === n ? (o.preventDefault(), this._activateRelative(1)) : (o.keyCode === e || o.keyCode === t) && (o.preventDefault(), this._activateRelative(-1)))
            }
        }, {
            live: function() {
                this.liveBindTo("tab", "leftclick tap", function(e) {
                    this._onTabCilck(e)
                }).liveBindTo("tab", "keydown", function(e) {
                    this._onTabKeyDown(e)
                })
            }
        })
    }(), BEM.DOM.decl("tabs-menu", {
        onElemSetMod: {
            tab: {
                active: {
                    yes: function(e) {
                        var t = this.getActive();
                        if (this.__base.apply(this, arguments) === !1) return !1;
                        e.attr("tabindex", 0);
                        try {
                            e.focus()
                        } catch (i) {}
                        t.removeAttr("tabindex")
                    }
                },
                hovered: {
                    yes: function(e) {
                        return this.hasMod(e, "disabled", "yes") ? !1 : void 0
                    }
                },
                disabled: function(e, t, i) {
                    return this.__base.apply(this, arguments) === !1 ? !1 : void("yes" === i && this.hasMod(e, "active", "yes") ? e.attr("tabindex", 0) : e.removeAttr("tabindex"))
                }
            }
        },
        _onnMouseOverOut: function(e) {
            this.toggleMod(this._getTabByElem($(e.target)), "hovered", "yes", "", "mouseover" === e.type)
        }
    }, {
        live: function() {
            var e = this.__base.apply(this, arguments);
            return this.liveBindTo("tab", "mouseover mouseout", function(e) {
                this._onnMouseOverOut(e)
            }), e
        }
    }), BEM.DOM.decl("tabs-menu", {
        setCountTextByMod: function(e, t, i) {
            var n;
            2 === arguments.length && (i = t, t = e, e = "type"), n = this.elem("tab", e, t), n && (this.findElem(n, "count-value").text(i || ""), this.setMod(n, "display-count", i ? "yes" : ""))
        }
    }), BEM.DOM.decl("tabs-panes", {
        onElemSetMod: {
            pane: {
                active: {
                    yes: function(e, t, i) {
                        var n = this.findPane("active", "yes");
                        n.attr("aria-expanded", !1), e.attr("aria-expanded", !0), this.delMod(n, "active")
                    }
                }
            }
        },
        _onControlChange: function(e, t) {
            this.setMod(this.findPane().eq(t.currentIndex), "active", "yes")
        },
        findPane: function(e, t) {
            return this.domElem.children(this.buildSelector("pane", e, t))
        }
    }, {
        getSupportedControls: function() {
            return ["tabs"]
        },
        live: function() {
            this.getSupportedControls().forEach(function(e) {
                BEM.blocks[e] && this.liveInitOnBlockEvent("change", e, function(e, t) {
                    this._onControlChange(e, t)
                })
            }, this)
        }
    }), BEM.JSON.decl("widget-preview", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            }).mix([{
                block: "error-message",
                mods: {
                    theme: "light",
                    view: "wide",
                    opaque: "yes",
                    verbose: "less",
                    widget: "yes"
                }
            }].concat(e.mix()), !0)
        },
        onElem: {
            paranja: function(e) {
                e.wrap([{
                    block: "paranja-light",
                    mix: [{
                        block: "widget-preview",
                        elem: "paranja"
                    }]
                }])
            },
            "total-numbers": function(e) {
                var t = e.params();
                t.hasOwnProperty("total") && e.content([{
                    elem: "total",
                    content: BN("humanize-attributes").format(t.type, t.total)
                }, {
                    elem: "changes",
                    current: t.total,
                    prev: t.prevTotal,
                    negative: t.negative
                }])
            },
            changes: function(e) {
                var t = e.params(),
                    i = (t.current - t.prev) / t.prev,
                    n = t.negative ? 0 > i : i > 0;
                e.mod("changes", i > 0 ? "up" : "down"), e.mod("diff", n ? "positive" : "negative"), e.content(BN("humanize").format("percents", 100 * Math.abs(i))), e.attr("title", BEM.I18N("widget", "compared-to-previous-period"))
            }
        }
    }), BEM.DOM.decl("widget-preview", {
        onSetMod: {
            js: function() {
                this.widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._onResize = jQuery.debounce(this.resize, 500, this), BN("main-menu").on("toggle", this._onResize), this._initBlock(), this.bindToModel(!0)
            }
        },
        destruct: function() {
            this.unbindFromModel(), BN("main-menu").un("toggle", this._onResize), this.__base.apply(this, arguments)
        },
        bindToModel: function(e) {
            var t = this;
            e && t._update(), this.widgetModel.ready().then(function() {
                t.widgetModel.on(t._getModelFields(), "change", t._update, t)
            }).done()
        },
        unbindFromModel: function() {
            this.widgetModel.un(this._getModelFields(), "change", this._update, this)
        },
        resize: function() {
            throw new Error("not implemented")
        },
        beforeDrag: function() {
            this._chartAdapter && this._chartAdapter.beforeDrag && this._chartAdapter.beforeDrag()
        },
        afterDrag: function() {
            this._chartAdapter && this._chartAdapter.afterDrag && this._chartAdapter.afterDrag()
        },
        _getModelFields: function() {
            return "statState"
        },
        _update: function() {
            var e = this,
                t = BN("i-promise").createChain(this);
            this.setMod("loading", "yes"), Vow.fulfill().then(t(this._updateFromModel.bind(this))).fail(t(function(t) {
                return BN("error-message").showError(e, t), Vow.reject(t)
            })).always(t(function() {
                e.delMod("loading"), e.trigger("resize")
            })).done(), BN("error-message").hideError(this)
        },
        _getNoDataError: function() {
            return new(BN("i-errors").MetrikaError)("PERIOD_NO_DATA")
        },
        _updateFromModel: function() {
            throw new Error("not implemented")
        },
        _initBlock: function() {
            throw new Error("not implemented")
        },
        _onResize: null
    }), BEM.JSON.decl("paranja-light", {
        onBlock: function(e) {
            e.content({
                block: "spin2",
                mods: {
                    size: "m",
                    progress: "yes"
                }
            })
        }
    }), BEM.JSON.decl("chart-legend", {
        onBlock: function(e) {
            e.js(!0)
        },
        onElem: {
            inner: function(e) {
                var t = e.param("data"),
                    i = BN("i-colorpool").create();
                e.content((t || []).map(function(e) {
                    return e.color = e.color || i.getColor(e.colorIdx), {
                        elem: "row",
                        data: e
                    }
                }))
            },
            row: function(e) {
                var t = e.param("data");
                e.content([{
                    elem: "color",
                    attrs: {
                        style: "background-color: " + t.color
                    }
                }, {
                    elem: "text",
                    mix: [{
                        block: "hint-hover",
                        js: {
                            widthLimiter: ".chart-legend__row"
                        }
                    }],
                    content: t.name
                }])
            }
        }
    }), BEM.DOM.decl("chart-legend", {
        draw: function(e) {
            return BN("i-content").update(this.domElem, {
                block: this.__self.getName(),
                elem: "inner",
                data: e
            })
        },
        setAdapter: function(e) {
            e.setLegendBlock(this)
        },
        clear: function() {
            BN("i-content").update(this.domElem, "")
        }
    }), BEM.DOM.decl({
        name: "chart-legend",
        modName: "type",
        modVal: "multiline"
    }, {
        MAX_LABEL_WIDTH: 300,
        PADDING: 10,
        _originalWidths: [],
        draw: function() {
            return this.setMod("drawing", "yes"), this._originalWidths = [], this.__base.apply(this, arguments).then(this.update.bind(this))
        },
        update: function() {
            var e, t = 0,
                i = 0,
                n = [],
                o = this.domElem.outerWidth(),
                s = this.findElem("row").toArray(),
                r = this.findElem("inner");
            for (this._originalWidths.length || s.forEach(function(e) {
                    var t = jQuery(e),
                        i = t.outerWidth(),
                        n = i > this.MAX_LABEL_WIDTH ? this.MAX_LABEL_WIDTH : i + this.PADDING;
                    this._originalWidths.push(n)
                }, this); o > t && i < this._originalWidths.length;) n[i] = this._originalWidths[i], t += this._originalWidths[i++];
            for (0 === i && (i = 1); t > o && i > 1;) {
                for (n = [], i--, e = 0; e < this._originalWidths.length; e++) this._originalWidths[e] > (n[e % i] || 0) && (n[e % i] = this._originalWidths[e]);
                t = n.reduce(function(e, t) {
                    return e + t
                })
            }
            s.forEach(function(e, t) {
                var o = jQuery(e),
                    s = t % i;
                o.outerWidth(n[s])
            }, this), r.outerWidth(t), this.delMod("drawing")
        }
    }), BEM.JSON.decl({
        name: "widget-preview",
        modName: "type",
        modVal: "pie"
    }, {
        onBlock: function(e) {
            var t = e.param("legendMods") || {};
            e.content([{
                elem: "chart"
            }, {
                block: "chart-legend",
                mods: t,
                mix: [{
                    block: "widget-preview",
                    elem: "chart-legend"
                }]
            }, {
                elem: "paranja"
            }])
        }
    }), BEM.DOM.decl({
        block: "widget-preview",
        modName: "type",
        modVal: "pie"
    }, {
        resize: function() {
            this._chartAdapter.resize()
        },
        _initBlock: function() {
            this._legendBlock = this.findBlockInside("chart-legend"), this._chartAdapter = BEM.create({
                block: "report-chart-pie",
                mods: {
                    mode: "single",
                    widget: "yes"
                }
            }), this._chartDataModel = BEM.create({
                block: "widget-pie-chart-data-model"
            }), this._chartAdapter.setDestination(this.elem("chart")), this._legendBlock && this._legendBlock.setAdapter(this._chartAdapter), this._chartAdapter.setDataModel(this._chartDataModel)
        },
        _updateFromModel: function() {
            var e = this;
            return this.widgetModel.getCurrentStatData().then(function(t) {
                return t.data.length && e._checkNonZeroMetrics(t.data) ? (e._chartDataModel.setData(t), e._chartAdapter.draw()) : Vow.reject(e._getNoDataError())
            })
        },
        _checkNonZeroMetrics: function(e) {
            return e.filter(function(e) {
                return Math.max.apply(Math, e.metrics) > 0
            }).length > 0
        }
    }),
    function() {
        var e = function() {
            throw new Error("not implemented")
        };
        BEM.decl("chart-report-data", {
            isNormalized: function() {
                return !1
            },
            getColorsIndexes: e,
            isTotalsAveragesEnabled: function() {
                return !1
            },
            getTotalsColor: e,
            getMetricMeta: function() {
                return this.getData().meta.metrics[0]
            },
            getDimensionsMeta: function() {
                return this.getData().meta.dimensions
            },
            getData: e,
            getSegmentName: function() {
                return ""
            },
            getPeriodGroups: function() {
                var e = this.getData().query || {};
                return BN("i-period").splitPeriodToGroups(this.getPeriod(), this.getGroup(), e.auto_group_type, e.auto_group_size)
            },
            getGroup: e,
            getPeriod: e
        })
    }(), BEM.decl({
        name: "widget-pie-chart-data-model",
        baseBlock: "chart-report-data"
    }, {
        getData: function() {
            return this._statDataResult
        },
        setData: function(e) {
            this._statDataResult = e
        },
        getGroup: function() {
            return "day"
        },
        getColorsIndexes: function() {
            for (var e = BN("i-colorpool").create(), t = [], i = 0; i < this._statDataResult.data.length; i++) t.push(e.get());
            return e.destruct(), t
        }
    }), BEM.decl({
        name: "report-chart-pie",
        baseBlock: "report-chart"
    }, {
        _initChartOptions: function() {
            var e = this;
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "pie",
                    plotBorderWidth: 0
                },
                plotOptions: {
                    pie: {
                        innerSize: "25%",
                        borderWidth: 0,
                        dataLabels: {
                            enabled: !0,
                            connectorWidth: 0,
                            formatter: function() {
                                return e._labelFormatter(this.point)
                            },
                            style: {
                                fontWeight: "normal",
                                fontSize: "12px"
                            }
                        },
                        states: {
                            hover: {
                                enabled: !1
                            }
                        }
                    }
                }
            })
        },
        _getChartDataOptions: function(e) {
            var t, i = this._dataModel.getData(e),
                n = this._dataModel.getColorsIndexes(),
                o = this._getColorPool(),
                s = this._getTotals(i),
                r = 0,
                a = {};
            return a.series = i.data.map(function(t, i) {
                var a = this._yAxisMetricFormatter(t.metrics[this.metricIndex]) || 0,
                    l = n[i % n.length];
                return r += a, {
                    y: a,
                    name: this._getDimName(t),
                    colorIdx: l,
                    color: o.getColor(l),
                    model: e,
                    dataLabels: {
                        enabled: a / s >= .05
                    }
                }
            }, this), s > r && (t = this._yAxisMetricFormatter(s - r), a.series.push({
                y: t,
                name: BEM.I18N("report-chart", "other-slice"),
                color: this.OTHER_COLOR,
                model: e,
                dataLabels: {
                    enabled: t / s >= .05
                }
            })), a
        },
        _getLegendData: function() {
            return this._chartOptions.series[0].data
        },
        _tooltipFormatter: function(e, t) {
            var i = this._dataModel.getMetricMeta();
            return BN("i-content").unescapeHTML(this._injectSoftBreaks(this._formatDimension(t.name))) + "<br />" + i.name + ": " + this._formatMetric(t.y) + (i.allow_normalisation ? " (" + this._formatMetric(t.percentage, {
                dataType: "percents"
            }, !0) + ")" : "")
        },
        _labelFormatter: function(e) {
            return this._formatMetric(e.percentage, {
                dataType: "percents"
            }, !0)
        }
    }), BEM.decl({
        name: "report-chart-pie",
        modName: "mode",
        modVal: "single"
    }, {
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions(),
                t = e.series.reduce(function(e, t) {
                    return e + t.y
                }, 0);
            0 === t && this._riseIncorrectDataError(), this._chartOptions.series = [{
                data: e.series
            }]
        }
    }), BEM.decl({
        name: "report-chart-pie",
        modName: "widget",
        modVal: "yes"
    }, {
        _initChartOptions: function() {
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    height: 270
                },
                plotOptions: {
                    pie: {
                        size: 220
                    }
                },
                tooltip: {
                    useHTML: !0,
                    borderWidth: 2,
                    backgroundColor: "#fff",
                    shape: "square",
                    style: {
                        padding: 0,
                        lineHeight: "normal"
                    },
                    positioner: function(e, t, i) {
                        var n = this.chart.chartWidth,
                            o = i.plotX,
                            s = i.plotY - t;
                        return o + e > n && (o = n - e + 25), {
                            x: o,
                            y: s
                        }
                    }
                }
            })
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            e.series.forEach(function(e) {
                e.dataLabels.enabled = !1
            }), this._chartOptions.series = [{
                data: e.series
            }]
        }
    }), BEM.JSON.decl({
        name: "widget-preview",
        modName: "type",
        modVal: "total"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "total-numbers"
            }, {
                elem: "total-chart"
            }, {
                elem: "paranja"
            }])
        },
        onElem: {}
    }), BEM.DOM.decl({
        block: "widget-preview",
        modName: "type",
        modVal: "total"
    }, {
        resize: function() {
            this.findBlockInside("small-chart").resize()
        },
        beforeDrag: function() {
            this.findBlockInside("small-chart").beforeDrag()
        },
        afterDrag: function() {
            this.findBlockInside("small-chart").afterDrag()
        },
        _initBlock: function() {},
        _updateFromModel: function() {
            var e = this;
            return Vow.all({
                prev: this.widgetModel.getPrevStatData(),
                dateValue: this.widgetModel.getMetricValuesByDate(),
                bytime: this.widgetModel.getStatDataByTime()
            }).then(function(t) {
                return t.bytime.data.length ? BN("i-content").replace(e.findElem("total-numbers"), {
                    block: e.__self.getName(),
                    elem: "total-numbers",
                    type: t.bytime.meta.metrics[0].type,
                    negative: t.bytime.meta.metrics[0].negative,
                    total: t.bytime.totals[0][0],
                    prevTotal: t.prev.totals[0]
                }).then(BN("i-content").replace.bind(BN("i-content"), e.findElem("total-chart"), {
                    block: e.__self.getName(),
                    elem: "total-chart",
                    content: {
                        block: "small-chart",
                        js: {
                            data: t.dateValue,
                            valueType: t.bytime.meta.metrics[0].type,
                            valueName: t.bytime.meta.metrics[0].name
                        },
                        mix: [{
                            block: e.__self.getName(),
                            elem: "small-chart"
                        }]
                    }
                })) : Vow.reject(e._getNoDataError())
            })
        }
    }), BEM.JSON.decl({
        name: "widget-preview",
        modName: "type",
        modVal: "table"
    }, {
        onBlock: function(e) {
            e.content([{
                block: "attributes-table",
                mods: {
                    layout: "fixed"
                },
                mix: {
                    block: "widget-preview",
                    elem: "attributes-table"
                },
                widgetModelId: e.param("widgetModelId")
            }, {
                elem: "paranja"
            }])
        }
    }), BEM.DOM.decl({
        block: "widget-preview",
        modName: "type",
        modVal: "table"
    }, {
        resize: function() {},
        _initBlock: function() {
            this._table = this.findBlockInside("attributes-table", "attributes-table"), this._table.on("sort", this._onTableSort, this)
        },
        _updateFromModel: function() {
            var e = this;
            return this.widgetModel.getCurrentStatData().then(function(t) {
                if (t.data.length) {
                    var i = [].concat(t.meta.dimensions, t.meta.metrics),
                        n = e.widgetModel.get("sort");
                    return e._table.updateHeader(i, n).then(function() {
                        return e._table.updateTbody(i, t.data)
                    })
                }
                return Vow.reject(e._getNoDataError())
            })
        },
        _onTableSort: function(e, t) {
            this.widgetModel.set("sort", t.sort)
        }
    }), BEM.JSON.decl({
        name: "widget-preview",
        modName: "type",
        modVal: "multiline"
    }, {
        onBlock: function(e) {
            var t = e.param("legendMods") || {};
            e.content([{
                elem: "chart"
            }, {
                block: "chart-legend",
                mods: t,
                mix: [{
                    block: "widget-preview",
                    elem: "chart-legend"
                }]
            }, {
                elem: "paranja"
            }])
        }
    }), BEM.DOM.decl({
        block: "widget-preview",
        modName: "type",
        modVal: "multiline"
    }, {
        resize: function() {
            this._chartAdapter.resize()
        },
        _getModelFields: function() {
            return "totalsAndAverages statState multilineType multilineMetrics multilineDimValues"
        },
        _initBlock: function() {
            this._legendBlock = this.findBlockInside("chart-legend"), this._chartDataModel = BEM.create({
                block: "widget-line-chart-data-model"
            }), this._updateChartAdapter(), this._groupingModel = BN("m-dashboard-grouping").getAny()
        },
        _updateChartAdapter: function() {
            this._chartAdapter && this._chartAdapter.destruct(), this._chartAdapter = BEM.create({
                block: "report-chart-line",
                mods: {
                    mode: "single",
                    widget: "yes",
                    dimensionless: this.widgetModel.isDimensionless() ? "yes" : ""
                }
            }), this._chartAdapter.setDestination(this.elem("chart")), this._legendBlock && this._legendBlock.setAdapter(this._chartAdapter), this._chartAdapter.setDataModel(this._chartDataModel)
        },
        _updateFromModel: function() {
            var e = this;
            return this.widgetModel.hasNoDimValues() ? Vow.reject(e._getNoDataError()) : this.widgetModel.getMultilineCount() || this.widgetModel.isTotalsEnabled() ? this.widgetModel.getStatDataByTime().then(function(t) {
                var i = t.query;
                return e._updateChartAdapter(), e._chartDataModel.setData(t), e._chartDataModel.setTotalsAvailability(e.widgetModel.isTotalsEnabled()), e._chartDataModel.checkForNoData() ? Vow.reject(e._getNoDataError()) : (e._chartDataModel.setColorIndexes(e.widgetModel.getMultilineIndexes().map(function(e) {
                    return ++e
                })), e._groupingModel.set("autoType", i.auto_group_type), e._groupingModel.set("autoSize", i.auto_group_size), e._chartAdapter.draw())
            }) : Vow.reject(new(BN("i-errors").MetrikaError)("ERR_ROWS_NOT_SELECTED"))
        }
    }), BEM.decl({
        name: "widget-line-chart-data-model",
        baseBlock: "chart-report-data"
    }, {
        _totalsEnabled: !1,
        getData: function() {
            return this._statDataResult
        },
        setData: function(e) {
            this._statDataResult = e
        },
        getGroup: function() {
            return this._statDataResult.query.auto_group_type || this._statDataResult.query.group
        },
        getColorsIndexes: function() {
            return this._colorIndexes
        },
        getPeriod: function() {
            var e = this._statDataResult.query;
            return {
                from: e.date1,
                to: e.date2
            }
        },
        setColorIndexes: function(e) {
            this._colorIndexes = e
        },
        isTotalsAveragesEnabled: function() {
            return this._totalsEnabled
        },
        setTotalsAvailability: function(e) {
            this._totalsEnabled = Boolean(e)
        },
        getTotalsColor: function() {
            return "#4C4C4C"
        },
        checkForNoData: function() {
            var e = this.getData(),
                t = !e || !e.data || !e.data.length;
            return this.isTotalsAveragesEnabled() ? t && (!e.totals || !e.totals.length) : t
        }
    }, {
        _colorPool: null,
        _getColorPool: function() {
            return this._colorPool || (this._colorPool = BN("i-colorpool").create("set01")), this._colorPool
        },
        getAllColors: function() {
            return this._getColorPool().getAllColors()
        }
    }), BEM.decl({
        name: "report-chart-line",
        baseBlock: "report-chart"
    }, {
        beforeDrag: function() {
            if (this._chart) {
                var e = this._chart.options;
                e.tooltip.enabled = !1, e.xAxis.length && e.xAxis.forEach(function(e) {
                    e.labels.enabled = !1
                }), e.yAxis.length && e.yAxis.forEach(function(e) {
                    e.labels.enabled = !1
                }), this._render(e)
            }
        },
        afterDrag: function() {
            if (this._chart) {
                var e = this._chart.options;
                e.tooltip.enabled = !0, e.xAxis.length && e.xAxis.forEach(function(e) {
                    e.labels.enabled = !0
                }), e.yAxis.length && e.yAxis.forEach(function(e) {
                    e.labels.enabled = !0
                }), this._render(e)
            }
        },
        _initChartOptions: function() {
            var e = this;
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "line",
                    marginBottom: 40,
                    marginTop: 20
                },
                yAxis: {
                    labels: {
                        formatter: function() {
                            return e._yAxisFormatter(this.value)
                        }
                    }
                },
                plotOptions: {
                    line: {
                        marker: {
                            enabled: !1,
                            symbol: "circle",
                            radius: 2
                        }
                    }
                }
            })
        },
        _getChartDataOptions: function(e) {
            var t = this,
                i = this._dataModel.getData(e),
                n = this._dataModel.getColorsIndexes(),
                o = this._getColorPool(),
                s = this._dataModel.getPeriodGroups(e),
                r = this._getTotals(i, !0),
                a = s.length,
                l = {};
            return l.xAxisFormatter = function() {
                var e = s[this.value];
                return e ? t._xAxisFormatter(e) : null
            }, l.series = i.data.map(function(t, i) {
                var a = n[i % n.length];
                return {
                    name: this._getDimName(t) || " ",
                    colorIdx: a,
                    color: o.getColor(a),
                    data: t.metrics[this.metricIndex].map(function(t, i) {
                        var n = this._yAxisMetricFormatter(Number(t), r[i], this._dataModel.isNormalized());
                        return {
                            x: i,
                            y: null === n || isNaN(n) ? 0 : n,
                            originalVal: t,
                            date1: s[i].from,
                            date2: s[i].to,
                            isHoliday: s[i].isHoliday,
                            model: e
                        }
                    }, this)
                }
            }, this), this._dataModel.isTotalsAveragesEnabled() && l.series.push({
                name: this._buildTotalsAveragesLabel(),
                color: this._dataModel.getTotalsColor(),
                data: r.map(function(t, i) {
                    var n = this._yAxisMetricFormatter(t, r[i], this._dataModel.isNormalized());
                    return {
                        x: i,
                        y: null === n || isNaN(n) ? 0 : n,
                        originalVal: t,
                        date1: s[i].from,
                        date2: s[i].to,
                        isHoliday: s[i].isHoliday,
                        model: e
                    }
                }, this)
            }), l.count = a, l.totals = r, l
        },
        _getColorPool: function(e) {
            return this.__base(e || "set01")
        }
    }), BEM.decl({
        name: "report-chart-line",
        modName: "mode",
        modVal: "single"
    }, {
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    labels: {
                        formatter: e.xAxisFormatter
                    }
                },
                yAxis: {
                    ceiling: this._dataModel.isNormalized() ? 100 : null
                },
                series: e.series
            })
        }
    }), BEM.decl({
        name: "report-chart-line",
        modName: "widget",
        modVal: "yes"
    }, {
        _initChartOptions: function() {
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    spacingTop: 0,
                    spacingBottom: 0,
                    spacingRight: 0,
                    height: 150,
                    marginBottom: 14,
                    marginLeft: 0,
                    marginTop: 10,
                    marginRight: 0,
                    plotBorderWidth: 0
                },
                xAxis: {
                    gridLineWidth: 0,
                    lineWidth: 0,
                    minPadding: 0,
                    maxPadding: 0,
                    labels: {
                        style: {
                            color: "#999999"
                        }
                    },
                    tickPositioner: function() {
                        var e, t;
                        if (!(this.dataMax <= 2)) return e = Math.floor(this.dataMax / 3), t = this.dataMax - e, [e, t]
                    }
                },
                yAxis: {
                    showFirstLabel: !1,
                    lineWidth: 0,
                    tickAmount: 3,
                    labels: {
                        style: {
                            font: "11px Verdana",
                            backgroundColor: "rgba(256, 256, 256, 0.5)",
                            whiteSpace: "nowrap",
                            padding: "0 2px",
                            borderRadius: "3px",
                            width: "auto"
                        },
                        align: "left",
                        x: -2,
                        y: 15
                    }
                },
                tooltip: {
                    useHTML: !0,
                    borderWidth: 2,
                    backgroundColor: "#fff",
                    shape: "square",
                    style: {
                        padding: 0,
                        lineHeight: "normal"
                    }
                }
            })
        },
        _tooltipFormatter: function(e, t) {
            var i = this._getTooltipValue(t.y, t.originalVal),
                n = t.metricName ? "" : BN("i-content").unescapeHTML(this._injectSoftBreaks(this._formatDimension(e))) + "<br />",
                o = t.metricName ? t.metricName : this._dataModel.getMetricMeta().name,
                s = this._formatTooltipDate({
                    date1: t.date1,
                    date2: t.date2,
                    isHoliday: t.isHoliday,
                    group: this._dataModel.getGroup()
                });
            return s + "<br />" + n + BN("i-content").html({
                block: "report-chart",
                elem: "row",
                content: o + ": " + i
            }, !0)
        },
        _xAxisFormatter: function(e) {
            return e.isHoliday = !1, this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "report-chart-line",
        modName: "dimensionless",
        modVal: "yes"
    }, {
        _getChartDataOptions: function(e) {
            var t = this.__base.apply(this, arguments),
                i = this._dataModel.getData(e),
                n = i.meta.metrics,
                o = this._getTotals(i, !0),
                s = this._dataModel.getColorsIndexes(),
                r = this._getColorPool(),
                a = this._dataModel.getPeriodGroups(e);
            return t.series = i.data[0].metrics.map(function(t, i) {
                var l = n[i].name,
                    c = s[i % s.length];
                return {
                    name: l,
                    colorIdx: c,
                    color: r.getColor(c),
                    data: t.map(function(t, i) {
                        var n = this._yAxisMetricFormatter(Number(t), o[i], this._dataModel.isNormalized());
                        return {
                            x: i,
                            y: null === n || isNaN(n) ? 0 : n,
                            originalVal: t,
                            date1: a[i].from,
                            date2: a[i].to,
                            isHoliday: a[i].isHoliday,
                            metricName: l,
                            model: e
                        }
                    }, this)
                }
            }, this), t
        }
    }), BEM.JSON.decl("widget-title", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            }).content([{
                elem: "inner"
            }, {
                elem: "subtitle"
            }])
        },
        onElem: {
            inner: function(e) {
                var t = e.params(),
                    i = BEM.I18N("widget-title", "default-title"),
                    n = BN("i-string").escapeHTML(t.title || i);
                e.content({
                    block: "smart-link",
                    mix: [{
                        block: "widget-title",
                        elem: "link"
                    }, {
                        block: "hint-hover",
                        js: {
                            widthLimiter: ".widget-title__inner"
                        }
                    }],
                    attrs: {
                        target: t.isNewTab ? "_blank" : "_self"
                    },
                    js: {
                        keepParams: ["delegation", "counter", "period", "group"],
                        params: t.urlParams || {},
                        path: "/stat/new"
                    },
                    content: n
                })
            },
            subtitle: function(e) {
                e.content(BN("i-string").escapeHTML(e.param("title") || ""))
            }
        }
    }), BEM.DOM.decl("widget-title", {
        onSetMod: {
            js: function() {
                this.widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this.bindToModel()
            }
        },
        destruct: function() {
            this.unbindFromModel(), this.__base.apply(this, arguments)
        },
        bindToModel: function() {
            this._update(), this.widgetModel.on("titleState subtitle", "change", this._update, this)
        },
        unbindFromModel: function() {
            this.widgetModel.un("titleState subtitle", "change", this._update, this)
        },
        _update: function() {
            var e = this.__self.getName(),
                t = this.widgetModel.get("title").trim(),
                i = this.widgetModel.get("defaultTitle");
            BN("i-content").replace(this.findElem("inner"), {
                block: e,
                elem: "inner",
                title: t || i,
                urlParams: this.widgetModel.getReportUrlParams(),
                isNewTab: this.hasMod("new-tab", "yes")
            }).done(), BN("i-content").replace(this.findElem("subtitle"), {
                block: e,
                elem: "subtitle",
                title: this.widgetModel.get("subtitle")
            }).done()
        }
    }), BEM.JSON.decl("widget-multiline-selector", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            })
        },
        onElem: {
            list: function(e) {
                var t, i = e.params(),
                    n = [];
                for (t = 0; 5 > t; t++) n.push({
                    block: "attributes-selector",
                    mods: {
                        theme: "list",
                        type: i.type
                    },
                    mix: [{
                        block: "widget-multiline-selector",
                        elem: "item"
                    }],
                    color: i.colors[t],
                    idx: t,
                    widgetModelId: i.widgetModelId
                });
                e.content(n)
            }
        }
    }), BEM.DOM.decl("widget-multiline-selector", {
        onSetMod: {
            js: function() {
                this.widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._onChange(), this.widgetModel.on("multilineType", "change", this._onChange, this)
            }
        },
        destruct: function() {
            this.widgetModel.un("multilineType", "change", this._onChange, this), this.__base.apply(this, arguments)
        },
        _onChange: function() {
            this._render()
        },
        _render: function() {
            var e = this.widgetModel.get("multilineType"),
                t = BN("i-content").html({
                    block: this.__self.getName(),
                    elem: "list",
                    type: e,
                    colors: BN("widget-line-chart-data-model").getAllColors(),
                    widgetModelId: this.widgetModel.cid
                }, !0);
            BEM.DOM.update(this.domElem, t)
        }
    }), BEM.DOM.decl({
        block: "attributes-selector",
        modName: "type",
        modVal: "metrics-list"
    }, {
        _getFields: function() {
            return "multilineMetrics"
        },
        _setValue: function(e) {
            var t = this.widgetModel.get(this._getFields());
            t[this.params.idx] = e, this.widgetModel.set(this._getFields(), t)
        },
        _getLabel: function() {
            return ""
        },
        _getTreeLevels: function() {
            var e = this;
            return this._getCurrentType().then(this.widgetModel.getMetricsGroups.bind(this.widgetModel)).then(function(t) {
                return e._addLevels(t.metric_groups, "metrics")
            }).then(function(t) {
                var i = e._filterDummyLevels(t);
                return e._setDisabledGroups(i), i
            })
        },
        _setDisabledGroups: function(e) {
            var t, i;
            for (t = e.length - 1; t >= 0; t--) i = BN("i-util").arrayUnique(e[t].map(function(e) {
                return e.parent
            }).filter(Boolean)), i.forEach(function(i) {
                var n = e[t].filter(function(e) {
                    return e.parent === i
                }).filter(Boolean).every(function(e) {
                    return e.disabled
                });
                n && e[t - 1].forEach(function(e) {
                    e.id === i && (e.disabled = !0)
                })
            })
        },
        _fetchCurrentValue: function() {
            return this.widgetModel.get(this._getFields())[this.params.idx]
        },
        _fetchAllValues: function() {
            return this.widgetModel.get(this._getFields()).filter(Boolean)
        },
        _isItemDisabled: function(e) {
            var t = this._fetchCurrentValue(),
                i = this._fetchAllValues(),
                n = e.value,
                o = !1;
            return this._currentType && e.type && (o = this._currentType !== e.type), o = o || t !== n && -1 !== i.indexOf(e.value)
        },
        _fetchTitle: function() {
            var e = this._fetchCurrentValue();
            return e ? (this.setMod("selected-value", "yes"), this.widgetModel.getMetricsMap().then(function(t) {
                return t[e].name
            })) : (this.setMod("selected-value", "no"), Vow.promise(BEM.I18N("attributes-selector", "not-selected")))
        },
        _getCurrentType: function() {
            var e = this;
            return this.widgetModel.getMetricsMap().then(function(t) {
                var i = e._fetchAllValues()[0],
                    n = i && t[i].type || "";
                return e._currentType = n, n
            })
        }
    }), BEM.DOM.decl({
        block: "attributes-selector",
        modName: "type",
        modVal: "dimension-values"
    }, {
        FIELD_NAME: "multilineDimValues",
        _getFields: function() {
            return this.FIELD_NAME + " statState"
        },
        _setValue: function(e) {
            var t = this.widgetModel.get(this.FIELD_NAME);
            t.values[this.params.idx] = e, this.widgetModel.set(this.FIELD_NAME, t)
        },
        _getLabel: function() {
            return ""
        },
        _getTreeLevels: function() {
            var e = this;
            return this.widgetModel.getDimensionValues().then(function(t) {
                var i = e._fetchCurrentValue(),
                    n = e._fetchAllValues();
                return [t.map(function(e) {
                    return e.disabled = e.value !== i && -1 !== n.indexOf(e.value), e.id = BEM.toModVal(e.id), e
                })]
            })
        },
        _fetchCurrentValue: function() {
            return this.widgetModel.get(this.FIELD_NAME).values[this.params.idx]
        },
        _fetchAllValues: function() {
            return this.widgetModel.get(this.FIELD_NAME).values.filter(Boolean)
        },
        _fetchTitle: function() {
            var e = this,
                t = this._fetchCurrentValue(),
                i = BEM.I18N("attributes-selector", "not-selected");
            return t ? (this.setMod("selected-value", "yes"), this.widgetModel.getDimensionValuesMap().then(function(n) {
                var o = n[t] && n[t].name;
                return o || e.setMod("selected-value", "no"), o || i
            })) : (this.setMod("selected-value", "no"), Vow.promise(i))
        }
    }), BEM.JSON.decl({
        name: "attributes-selector",
        modName: "theme",
        modVal: "list"
    }, {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                widgetModelId: t.widgetModelId,
                idx: t.idx
            }).content([{
                elem: "color",
                color: e.params().color
            }, {
                block: "button",
                mix: [{
                    block: "attributes-selector",
                    elem: "button"
                }],
                mods: {
                    size: "s",
                    arrow: "down",
                    theme: "pseudo",
                    "padding-left": "10"
                },
                content: ""
            }, {
                block: "button",
                mods: {
                    size: "s",
                    side: "right",
                    "only-icon": "yes",
                    focus: "no"
                },
                mix: [{
                    block: "attributes-selector",
                    elem: "clear"
                }],
                content: {
                    block: "icon",
                    mix: [{
                        elem: "close",
                        mods: {
                            type: "light"
                        }
                    }, {
                        block: "button",
                        elem: "icon"
                    }]
                }
            }, {
                elem: "popup-wrapper"
            }], !0)
        },
        onElem: {
            color: function(e) {
                e.content({
                    elem: "circle",
                    attrs: {
                        style: "background-color:" + e.param("color")
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        block: "attributes-selector",
        modName: "theme",
        modVal: "list"
    }, {
        onSetMod: {
            js: function() {
                this._closeBtn = this.findBlockOn("clear", "button"), this._closeBtn.on("click", this._onClearClick, this), this.__base.apply(this, arguments)
            }
        },
        destruct: function() {
            this._closeBtn.un("click", this._onClearClick, this), this.__base.apply(this, arguments)
        },
        _onClearClick: function() {
            this._popup.hide(), this._setValue("")
        }
    }), BEM.DOM.decl("button", {
        onSetMod: {
            focused: {
                yes: function() {
                    return this.hasMod("focus", "no") ? !1 : this.__base.apply(this, arguments)
                }
            }
        }
    }), BEM.JSON.decl("widget-totals", {
        onBlock: function(e) {
            e.js({
                widgetModelId: e.param("widgetModelId")
            }).content({
                block: "checkbox",
                mix: [{
                    block: "widget-totals",
                    elem: "checkbox"
                }],
                mods: {
                    size: "s",
                    label: "padded"
                },
                content: {
                    elem: "label",
                    content: BEM.I18N("widget-totals", "total-and-average")
                }
            })
        }
    }), BEM.DOM.decl("widget-totals", {
        onSetMod: {
            js: function() {
                this._widgetModel = BN("m-widget").getOne(this.params.widgetModelId), this._checkbox = this.findBlockOn("checkbox", "checkbox"), this._checkbox.on("change", this._onCheckboxChange, this), this._widgetModel.on("totalsAndAverages totalsAvailable", "change", this._onModelChange, this), this._onModelChange()
            }
        },
        destruct: function() {
            this._checkbox.un("change", this._onCheckboxChange, this), this._widgetModel.un("totalsAndAverages totalsAvailable", "change", this._onModelChange, this), this.__base.apply(this, arguments)
        },
        _onCheckboxChange: function(e, t) {
            this._widgetModel.set("totalsAndAverages", t.checked)
        },
        _onModelChange: function() {
            var e = this._widgetModel.get("totalsAvailable"),
                t = this._widgetModel.get("totalsAndAverages");
            this._checkbox.setMod("checked", t ? "yes" : ""), this.setMod("visible", e ? "yes" : "")
        }
    }), BEM.JSON.decl({
        name: "widget",
        modName: "type",
        modVal: "total"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "title"
            }, {
                elem: "edit"
            }, {
                block: "widget-preview",
                mods: {
                    type: "total"
                },
                mix: [{
                    block: "widget",
                    elem: "stats"
                }],
                widgetModelId: e.param("widgetModelId")
            }])
        },
        onElem: {
            "main-tab": function(e) {
                e.content([{
                    elem: "name"
                }, {
                    elem: "table"
                }, {
                    elem: "goals"
                }, {
                    elem: "metrics"
                }])
            }
        }
    }), BEM.JSON.decl({
        name: "widget",
        modName: "type",
        modVal: "pie"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "title"
            }, {
                elem: "edit"
            }, {
                block: "widget-preview",
                mods: {
                    type: "pie"
                },
                legendMods: {
                    type: "multiline"
                },
                widgetModelId: e.param("widgetModelId")
            }])
        },
        onElem: {
            "main-tab": function(e) {
                e.content([{
                    elem: "name"
                }, {
                    elem: "table"
                }, {
                    elem: "goals"
                }, {
                    elem: "metrics"
                }, {
                    elem: "dimensions"
                }])
            }
        }
    }), BEM.JSON.decl({
        name: "widget",
        modName: "type",
        modVal: "table"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "title"
            }, {
                elem: "edit"
            }, {
                block: "widget-preview",
                mods: {
                    type: "table"
                },
                mix: [{
                    block: "widget",
                    elem: "stats"
                }],
                widgetModelId: e.param("widgetModelId")
            }])
        },
        onElem: {
            "main-tab": function(e) {
                e.content([{
                    elem: "name"
                }, {
                    elem: "table"
                }, {
                    elem: "goals"
                }, {
                    elem: "metrics"
                }, {
                    elem: "dimensions"
                }, {
                    elem: "trust-rows"
                }])
            }
        }
    }), BEM.JSON.decl({
        name: "widget",
        modName: "type",
        modVal: "multiline"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "title"
            }, {
                elem: "edit"
            }, {
                block: "widget-preview",
                mods: {
                    type: "multiline"
                },
                widgetModelId: e.param("widgetModelId")
            }])
        },
        onElem: {
            "main-tab": function(e) {
                e.content([{
                    elem: "name"
                }, {
                    elem: "multiline-type"
                }, {
                    elem: "table"
                }, {
                    elem: "goals"
                }, {
                    elem: "metrics"
                }, {
                    elem: "dimensions"
                }])
            },
            "chart-tab": function(e) {
                e.content([{
                    elem: "multiline-selector"
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "widget",
        modName: "type",
        modVal: "multiline"
    }, {
        destruct: function() {
            this._multilineType && this._multilineType.un("change", this._onMultilineTypeChange, this), this.widgetModel.un("multilineType multilineMetrics multilineDimValues", "change", this._updateMultilineControls, this), this.__base.apply(this, arguments)
        },
        _initSettings: function() {
            this.__base.apply(this, arguments), this._multilineType = this.findBlockOn("multiline-type-selector", "radiobox"), this._updateMultilineControls(), this._onMultilineTypeChange(), this._multilineType.on("change", this._onMultilineTypeChange, this), this.widgetModel.on("multilineType multilineMetrics multilineDimValues", "change", this._updateMultilineControls, this)
        },
        _updateMultilineControls: function() {
            this._multilineType.val(this.widgetModel.get("multilineType"))
        },
        _onMultilineTypeChange: function() {
            var e = this._multilineType.val();
            this.widgetModel.set("multilineType", e), this.setMod(this._popupElem, "multiline", e)
        },
        _getLegendMods: function() {
            return {}
        }
    }), BEM.Model.decl("m-dashboard-grouping", {
        attributes: {
            urlParams: {
                type: "Model",
                modelType: "m-dashboard-url-params",
                "default": function() {
                    return BN("m-dashboard-url-params").getOne()
                }
            },
            autoType: {
                type: "String",
                validate: function() {
                    return Boolean(this.get()) || "auto" !== this.model.get("urlParams").get("group")
                }
            },
            autoSize: {
                type: "Number",
                validate: function() {
                    return Boolean(this.get()) || -1 === ["minutes", "hours"].indexOf(this.model.get("autoType") || this.model.get("urlParams").get("group"))
                }
            }
        }
    }), BEM.JSON.decl("timeline-axis", {
        onBlock: function(e) {
            var t = e.param("orient");
            t = -1 !== ["top", "bottom"].indexOf(t) ? t : "top", e.js({
                orient: t
            }).content({
                elem: "chart"
            })
        }
    }), BEM.DOM.decl("timeline-axis", {
        draw: function(e, t) {
            return this._chartAdapter = BEM.create({
                block: "report-chart-time-axis"
            }), this._chartAdapter.setDestination(this.findElem("chart")), BN("main-menu").on("toggle", this._onResize, this), this._chartAdapter.draw({
                periodGroups: e,
                group: t,
                orient: this.params.orient
            })
        },
        destruct: function() {
            BN("main-menu").un("toggle", this._onResize, this), this.__base.apply(this, arguments)
        },
        _onResize: function() {
            this._chartAdapter.resize()
        }
    }), BEM.DOM.decl({
        name: "report-chart-time-axis",
        baseBlock: "report-chart"
    }, {
        _initChartOptions: function() {
            var e = "top" === this._dataModel.orient ? "top" : "bottom",
                t = {
                    marginBottom: {
                        top: 10,
                        bottom: 25
                    },
                    labelsY: {
                        top: -4,
                        bottom: 22
                    }
                };
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    height: 25,
                    marginTop: 0,
                    marginRight: 1,
                    marginBottom: t.marginBottom[e],
                    marginLeft: 1,
                    plotBorderWidth: 0
                },
                plotOptions: {
                    series: {
                        color: "transparent"
                    }
                },
                tooltip: {
                    enabled: !1
                }
            }), this._chartOptions.xAxis = {
                allowDecimals: !1,
                labels: {
                    useHTML: !0,
                    y: t.labelsY[e]
                },
                minPadding: 0,
                maxPadding: 0,
                lineWidth: 0,
                tickPixelInterval: 150
            }, this._chartOptions.yAxis = {
                gridLineWidth: 0
            }
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    labels: {
                        formatter: e.xAxisFormatter
                    }
                },
                series: [{
                    data: e.series
                }]
            })
        },
        _getChartDataOptions: function() {
            for (var e = this, t = this._dataModel.periodGroups, i = this._dataModel.group, n = [], o = 0; o < t.length; o++) n.push(o);
            return {
                series: n,
                xAxisCategories: n,
                count: n.length,
                xAxisFormatter: function() {
                    var n;
                    return void 0 === this.value ? BN("i-content").html({
                        block: "report-chart-time-axis",
                        elem: "blank-tick",
                        mods: {
                            orient: e._dataModel.orient
                        }
                    }, !0) : (n = t[this.value], e._formatAxisDate({
                        group: i,
                        date1: n.from,
                        date2: n.to,
                        isHoliday: n.isHoliday
                    }))
                }
            }
        },
        _getLegendData: function() {
            return !1
        }
    }), ! function(e) {
        "use strict";
        "function" == typeof define && define.amd ? define(e) : "undefined" != typeof module && "undefined" != typeof module.exports ? module.exports = e() : "undefined" != typeof Package ? Sortable = e() : window.Sortable = e()
    }(function() {
        "use strict";

        function e(e, t) {
            this.el = e, this.options = t = t || {};
            var n = {
                group: Math.random(),
                sort: !0,
                disabled: !1,
                store: null,
                handle: null,
                scroll: !0,
                scrollSensitivity: 30,
                scrollSpeed: 10,
                draggable: /[uo]l/i.test(e.nodeName) ? "li" : ">*",
                ghostClass: "sortable-ghost",
                ignore: "a, img",
                filter: null,
                animation: 0,
                setData: function(e, t) {
                    e.setData("Text", t.textContent)
                },
                dropBubble: !1,
                dragoverBubble: !1
            };
            for (var o in n) !(o in t) && (t[o] = n[o]);
            var r = t.group;
            r && "object" == typeof r || (r = t.group = {
                name: r
            }), ["pull", "put"].forEach(function(e) {
                e in r || (r[e] = !0)
            }), R.forEach(function(n) {
                t[n] = i(this, t[n] || j), s(e, n.substr(2).toLowerCase(), t[n])
            }, this), e[D] = r.name + " " + (r.put.join ? r.put.join(" ") : "");
            for (var a in this) "_" === a.charAt(0) && (this[a] = i(this, this[a]));
            s(e, "mousedown", this._onTapStart), s(e, "touchstart", this._onTapStart), P && s(e, "selectstart", this._onTapStart), s(e, "dragover", this._onDragOver), s(e, "dragenter", this._onDragOver), z.push(this._onDragOver), t.store && this.sort(t.store.get(this))
        }

        function t(e) {
            b && b.state !== e && (l(b, "display", e ? "none" : ""), !e && b.state && y.insertBefore(b, g), b.state = e)
        }

        function i(e, t) {
            var i = V.call(arguments, 2);
            return t.bind ? t.bind.apply(t, [e].concat(i)) : function() {
                return t.apply(e, i.concat(V.call(arguments)))
            }
        }

        function n(e, t, i) {
            if (e) {
                i = i || T, t = t.split(".");
                var n = t.shift().toUpperCase(),
                    o = new RegExp("\\s(" + t.join("|") + ")\\s", "g");
                do
                    if (">*" === n && e.parentNode === i || ("" === n || e.nodeName.toUpperCase() == n) && (!t.length || ((" " + e.className + " ").match(o) || []).length == t.length)) return e;
                while (e !== i && (e = e.parentNode))
            }
            return null
        }

        function o(e) {
            e.dataTransfer.dropEffect = "move", e.preventDefault()
        }

        function s(e, t, i) {
            e.addEventListener(t, i, !1)
        }

        function r(e, t, i) {
            e.removeEventListener(t, i, !1)
        }

        function a(e, t, i) {
            if (e)
                if (e.classList) e.classList[i ? "add" : "remove"](t);
                else {
                    var n = (" " + e.className + " ").replace(/\s+/g, " ").replace(" " + t + " ", "");
                    e.className = n + (i ? " " + t : "")
                }
        }

        function l(e, t, i) {
            var n = e && e.style;
            if (n) {
                if (void 0 === i) return T.defaultView && T.defaultView.getComputedStyle ? i = T.defaultView.getComputedStyle(e, "") : e.currentStyle && (i = e.currentStyle), void 0 === t ? i : i[t];
                t in n || (t = "-webkit-" + t), n[t] = i + ("string" == typeof i ? "" : "px")
            }
        }

        function c(e, t, i) {
            if (e) {
                var n = e.getElementsByTagName(t),
                    o = 0,
                    s = n.length;
                if (i)
                    for (; s > o; o++) i(n[o], o);
                return n
            }
            return []
        }

        function d(e) {
            e.draggable = !1
        }

        function u() {
            A = !1
        }

        function h(e, t) {
            var i = e.lastElementChild,
                n = i.getBoundingClientRect();
            return t.clientY - (n.top + n.height) > 5 && i
        }

        function m(e) {
            for (var t = e.tagName + e.className + e.src + e.href + e.textContent, i = t.length, n = 0; i--;) n += t.charCodeAt(i);
            return n.toString(36)
        }

        function p(e) {
            for (var t = 0; e && (e = e.previousElementSibling) && "TEMPLATE" !== e.nodeName.toUpperCase();) t++;
            return t
        }

        function f(e, t) {
            var i, n;
            return function() {
                void 0 === i && (i = arguments, n = this, setTimeout(function() {
                    1 === i.length ? e.call(n, i[0]) : e.apply(n, i), i = void 0
                }, t))
            }
        }
        var g, _, b, y, v, M, k, B, w, x, E, N, I, S = {},
            D = "Sortable" + (new Date).getTime(),
            C = window,
            T = C.document,
            O = C.parseInt,
            P = !!T.createElement("div").dragDrop,
            A = !1,
            L = function(e, t, i, n, o, s) {
                var r = T.createEvent("Event");
                r.initEvent(t, !0, !0), r.item = i || e, r.from = n || e, r.clone = b, r.oldIndex = o, r.newIndex = s, e.dispatchEvent(r)
            },
            R = "onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),
            j = function() {},
            F = Math.abs,
            V = [].slice,
            z = [];
        return e.prototype = {
            constructor: e,
            _dragStarted: function() {
                a(g, this.options.ghostClass, !0), e.active = this, L(y, "start", g, y, w)
            },
            _onTapStart: function(e) {
                var t = e.type,
                    i = e.touches && e.touches[0],
                    o = (i || e).target,
                    r = o,
                    a = this.options,
                    l = this.el,
                    u = a.filter;
                if (!("mousedown" === t && 0 !== e.button || a.disabled)) {
                    if (a.handle && (o = n(o, a.handle, l)), o = n(o, a.draggable, l), w = p(o), "function" == typeof u) {
                        if (u.call(this, e, o, this)) return L(r, "filter", o, l, w), void e.preventDefault()
                    } else if (u && (u = u.split(",").some(function(e) {
                            return e = n(r, e.trim(), l), e ? (L(e, "filter", o, l, w), !0) : void 0
                        }))) return void e.preventDefault();
                    if (o && !g && o.parentNode === l) {
                        "selectstart" === t && o.dragDrop(), N = e, y = this.el, g = o, M = g.nextSibling, E = this.options.group, g.draggable = !0, a.ignore.split(",").forEach(function(e) {
                            c(o, e.trim(), d)
                        }), i && (N = {
                            target: o,
                            clientX: i.clientX,
                            clientY: i.clientY
                        }, this._onDragStart(N, !0), e.preventDefault()), s(T, "mouseup", this._onDrop), s(T, "touchend", this._onDrop), s(T, "touchcancel", this._onDrop), s(g, "dragend", this), s(y, "dragstart", this._onDragStart), s(T, "dragover", this);
                        try {
                            T.selection ? T.selection.empty() : window.getSelection().removeAllRanges()
                        } catch (h) {}
                    }
                }
            },
            _emulateDragOver: function() {
                if (I) {
                    l(_, "display", "none");
                    var e = T.elementFromPoint(I.clientX, I.clientY),
                        t = e,
                        i = this.options.group.name,
                        n = z.length;
                    if (t)
                        do {
                            if ((" " + t[D] + " ").indexOf(i) > -1) {
                                for (; n--;) z[n]({
                                    clientX: I.clientX,
                                    clientY: I.clientY,
                                    target: e,
                                    rootEl: t
                                });
                                break
                            }
                            e = t
                        } while (t = t.parentNode);
                    l(_, "display", "")
                }
            },
            _onTouchMove: function(e) {
                if (N) {
                    var t = e.touches[0],
                        i = t.clientX - N.clientX,
                        n = t.clientY - N.clientY,
                        o = "translate3d(" + i + "px," + n + "px,0)";
                    I = t, l(_, "webkitTransform", o), l(_, "mozTransform", o), l(_, "msTransform", o), l(_, "transform", o), this._onDrag(t), e.preventDefault()
                }
            },
            _onDragStart: function(e, t) {
                var i = e.dataTransfer,
                    n = this.options;
                if (this._offUpEvents(), "clone" == E.pull && (b = g.cloneNode(!0), l(b, "display", "none"), y.insertBefore(b, g)), t) {
                    var o, r = g.getBoundingClientRect(),
                        a = l(g);
                    _ = g.cloneNode(!0), l(_, "top", r.top - O(a.marginTop, 10)), l(_, "left", r.left - O(a.marginLeft, 10)), l(_, "width", r.width), l(_, "height", r.height), l(_, "opacity", "0.8"), l(_, "position", "fixed"), l(_, "zIndex", "100000"), y.appendChild(_), o = _.getBoundingClientRect(), l(_, "width", 2 * r.width - o.width), l(_, "height", 2 * r.height - o.height), s(T, "touchmove", this._onTouchMove), s(T, "touchend", this._onDrop), s(T, "touchcancel", this._onDrop), this._loopId = setInterval(this._emulateDragOver, 150)
                } else i && (i.effectAllowed = "move", n.setData && n.setData.call(this, i, g)), s(T, "drop", this);
                if (v = n.scroll, v === !0) {
                    v = y;
                    do
                        if (v.offsetWidth < v.scrollWidth || v.offsetHeight < v.scrollHeight) break;
                    while (v = v.parentNode)
                }
                setTimeout(this._dragStarted, 0)
            },
            _onDrag: f(function(e) {
                if (y && this.options.scroll) {
                    var t, i, n = this.options,
                        o = n.scrollSensitivity,
                        s = n.scrollSpeed,
                        r = e.clientX,
                        a = e.clientY,
                        l = window.innerWidth,
                        c = window.innerHeight,
                        d = (o >= l - r) - (o >= r),
                        u = (o >= c - a) - (o >= a);
                    d || u ? t = C : v && (t = v, i = v.getBoundingClientRect(), d = (F(i.right - r) <= o) - (F(i.left - r) <= o), u = (F(i.bottom - a) <= o) - (F(i.top - a) <= o)), (S.vx !== d || S.vy !== u || S.el !== t) && (S.el = t, S.vx = d, S.vy = u, clearInterval(S.pid), t && (S.pid = setInterval(function() {
                        t === C ? C.scrollTo(C.scrollX + d * s, C.scrollY + u * s) : (u && (t.scrollTop += u * s), d && (t.scrollLeft += d * s))
                    }, 24)))
                }
            }, 30),
            _onDragOver: function(e) {
                var i, o, s, r = this.el,
                    a = this.options,
                    c = a.group,
                    d = c.put,
                    m = E === c,
                    p = a.sort;
                if (void 0 !== e.preventDefault && (e.preventDefault(), !a.dragoverBubble && e.stopPropagation()), !A && E && (m ? p || (s = !y.contains(g)) : E.pull && d && (E.name === c.name || d.indexOf && ~d.indexOf(E.name))) && (void 0 === e.rootEl || e.rootEl === this.el)) {
                    if (i = n(e.target, a.draggable, r), o = g.getBoundingClientRect(), s) return t(!0), void(b || M ? y.insertBefore(g, b || M) : p || y.appendChild(g));
                    if (0 === r.children.length || r.children[0] === _ || r === e.target && (i = h(r, e))) {
                        if (i) {
                            if (i.animated) return;
                            v = i.getBoundingClientRect()
                        }
                        t(m), r.appendChild(g), this._animate(o, g), i && this._animate(v, i)
                    } else if (i && !i.animated && i !== g && void 0 !== i.parentNode[D]) {
                        k !== i && (k = i, B = l(i));
                        var f, v = i.getBoundingClientRect(),
                            w = v.right - v.left,
                            x = v.bottom - v.top,
                            N = /left|right|inline/.test(B.cssFloat + B.display),
                            I = i.offsetWidth > g.offsetWidth,
                            S = i.offsetHeight > g.offsetHeight,
                            C = (N ? (e.clientX - v.left) / w : (e.clientY - v.top) / x) > .5,
                            T = i.nextElementSibling;
                        A = !0, setTimeout(u, 30), t(m), f = N ? i.previousElementSibling === g && !I || C && I : T !== g && !S || C && S, f && !T ? r.appendChild(g) : i.parentNode.insertBefore(g, f ? T : i), this._animate(o, g), this._animate(v, i)
                    }
                }
            },
            _animate: function(e, t) {
                var i = this.options.animation;
                if (i) {
                    var n = t.getBoundingClientRect();
                    l(t, "transition", "none"), l(t, "transform", "translate3d(" + (e.left - n.left) + "px," + (e.top - n.top) + "px,0)"), t.offsetWidth, l(t, "transition", "all " + i + "ms"), l(t, "transform", "translate3d(0,0,0)"), clearTimeout(t.animated), t.animated = setTimeout(function() {
                        l(t, "transition", ""), t.animated = !1
                    }, i)
                }
            },
            _offUpEvents: function() {
                r(T, "mouseup", this._onDrop), r(T, "touchmove", this._onTouchMove), r(T, "touchend", this._onDrop), r(T, "touchcancel", this._onDrop)
            },
            _onDrop: function(t) {
                var i = this.el,
                    n = this.options;
                clearInterval(this._loopId), clearInterval(S.pid), r(T, "drop", this), r(T, "dragover", this), r(i, "dragstart", this._onDragStart), this._offUpEvents(),
                    t && (t.preventDefault(), !n.dropBubble && t.stopPropagation(), _ && _.parentNode.removeChild(_), g && (r(g, "dragend", this), d(g), a(g, this.options.ghostClass, !1), y !== g.parentNode ? (x = p(g), L(g.parentNode, "sort", g, y, w, x), L(y, "sort", g, y, w, x), L(g, "add", g, y, w, x), L(y, "remove", g, y, w, x)) : (b && b.parentNode.removeChild(b), g.nextSibling !== M && (x = p(g), L(y, "update", g, y, w, x), L(y, "sort", g, y, w, x))), e.active && L(y, "end", g, y, w, x)), y = g = _ = M = b = N = I = k = B = E = e.active = null, this.save())
            },
            handleEvent: function(e) {
                var t = e.type;
                "dragover" === t ? (this._onDrag(e), o(e)) : ("drop" === t || "dragend" === t) && this._onDrop(e)
            },
            toArray: function() {
                for (var e, t = [], i = this.el.children, o = 0, s = i.length; s > o; o++) e = i[o], n(e, this.options.draggable, this.el) && t.push(e.getAttribute("data-id") || m(e));
                return t
            },
            sort: function(e) {
                var t = {},
                    i = this.el;
                this.toArray().forEach(function(e, o) {
                    var s = i.children[o];
                    n(s, this.options.draggable, i) && (t[e] = s)
                }, this), e.forEach(function(e) {
                    t[e] && (i.removeChild(t[e]), i.appendChild(t[e]))
                })
            },
            save: function() {
                var e = this.options.store;
                e && e.set(this)
            },
            closest: function(e, t) {
                return n(e, t || this.options.draggable, this.el)
            },
            option: function(e, t) {
                var i = this.options;
                return void 0 === t ? i[e] : void(i[e] = t)
            },
            destroy: function() {
                var e = this.el,
                    t = this.options;
                R.forEach(function(i) {
                    r(e, i.substr(2).toLowerCase(), t[i])
                }), r(e, "mousedown", this._onTapStart), r(e, "touchstart", this._onTapStart), r(e, "selectstart", this._onTapStart), r(e, "dragover", this._onDragOver), r(e, "dragenter", this._onDragOver), Array.prototype.forEach.call(e.querySelectorAll("[draggable]"), function(e) {
                    e.removeAttribute("draggable")
                }), z.splice(z.indexOf(this._onDragOver), 1), this._onDrop(), this.el = null
            }
        }, e.utils = {
            on: s,
            off: r,
            css: l,
            find: c,
            bind: i,
            is: function(e, t) {
                return !!n(e, t, e)
            },
            throttle: f,
            closest: n,
            toggleClass: a,
            dispatchEvent: L,
            index: p
        }, e.version = "1.0.1", e.create = function(t, i) {
            return new e(t, i)
        }, e
    }), BEM.DOM.decl({
        block: "b-page",
        modName: "type",
        modVal: "dashboard"
    }, {
        onSetMod: {
            js: function() {
                this._heightWatcher = BN("i-height-watcher").getInstance(this.domElem), this._heightWatcher.on("change", this._onHeightChange, this), this.__base.call(this)
            }
        },
        destruct: function() {
            return this._heightWatcher.un("change", this._onHeightChange, this), this.__base.apply(this, arguments)
        },
        _onHeightChange: function() {
            this.trigger("heightChange")
        }
    }), BEM.DOM.decl("i-height-watcher", {
        onSetMod: {
            js: function() {
                var e = this.domElem[0].contentWindow.window;
                this.bindToDomElem(jQuery(e), "resize", $.throttle(this._onWindowIframeResize, 100, this))
            }
        },
        _onWindowIframeResize: function() {
            this.trigger("change")
        }
    }, {
        getInstance: function(e) {
            if (e.data("i-height-watcher")) return e.data("i-height-watcher");
            var t;
            return e.data("i-height-watcher", t = this._createInstance(e)), t
        },
        _createInstance: function(e) {
            var t = $(BEMHTML.apply({
                block: "i-height-watcher",
                tag: "iframe",
                js: !0
            }));
            return this.append(e, t), t.bem("i-height-watcher")
        }
    }), (BEM.DOM || BEM).decl({
        name: "i-report-page-base",
        baseBlock: "i-secure-page"
    }, {}, {
        out: function() {
            return this._buildTitle().then(this.setTitle.bind(this)).then(this.getPageTemplate.bind(this)).then(this.__base.bind(this))
        },
        _checkReportAccess: function() {
            return Vow.allResolved([BN("i-counters").getAsync(), BN("i-report").getReport()]).spread(function(e, t) {
                var i, n = BEM.blocks["i-errors"].HttpError,
                    o = t.valueOf(),
                    s = e.valueOf();
                return e.isResolved() ? (t.isRejected() && (i = t.valueOf(), (i instanceof BN("i-errors").MetrikaHttpError || i instanceof BN("i-errors").HttpError) && !(Number(i.status) >= 500) || console.log(o)), t.isRejected() || !o.isAvailable() ? (console.log("Unknown or missing report"), Vow.reject(new n(404))) : !o.isPublicAccessible() && s.isPublic() ? (console.log("No permissions for view report"), Vow.reject(new n(403))) : void 0) : e
            })
        },
        _getMode: function(e) {
            return e instanceof BN("i-report-comparable") ? e.isCompareMode() ? "compare" : "single" : ""
        },
        _buildTitle: function() {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getReport()]).spread(function(e, t) {
                return e.getName() + " — " + t.getName().toLowerCase()
            })
        }
    }), BEM.DOM.decl("i-report-page-base", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), BN("i-report").getReport().then(function(e) {
                    this._isDestructing || (this._report = e, this._report.on("change", this._onReportChange, this))
                }.bind(this)).always(this._sendMetrikaParams.bind(this)).done(), BN("i-counters").on("switch", this._onCounterSwitch, this), BN("data-lag-notification") && BN("data-lag-notification").setLag(0)
            }
        },
        destruct: function() {
            return this._report && this._report.un("change", this._onReportChange, this), BN("i-counters").un("switch", this._onCounterSwitch, this), this.__base.apply(this, arguments)
        },
        _onCounterSwitch: function(e, t) {
            BN("i-router").setParams({
                id: t.counter_id,
                gid: t.group_id
            }, !1, !0)
        },
        _onReportChange: function(e) {
            var t = e.block;
            this._isDestructing || t.buildUrlParams().then(function(e) {
                var i = BN("i-router").getParams();
                this._isDestructing || (e.ulogin = BN("i-router").getParams().ulogin, e.id = i.id, e.gid = i.gid, this.__self._buildTitle().then(this.__self.setTitle.bind(this.__self)), BN("i-router").replaceOnlyPath(t.getReportPath(), !0), BN("i-router").replaceParams(e))
            }.bind(this)).done()
        },
        _sendMetrikaParams: function() {
            var e;
            e = BN("metrika-counter"), e.params("report-open", this._report.isUser() ? "user" : this._report.isNew() ? "new" : "standart"), Vow.all({
                uid: BN("i-user").uid(),
                login: BN("i-user").getRealLogin(),
                counter: this.params.counter
            }).then(function(t) {
                e.id(t.uid), e.userParams({
                    login: t.login,
                    last_counter_id: t.counter.counter_id || void 0,
                    last_group_id: t.counter.group_id || void 0,
                    is_global: t.counter.counter_id || t.counter.group_id ? void 0 : "yes"
                })
            }).done()
        }
    }, {
        init: function() {
            return this._checkReportAccess().then(this.out.bind(this)).then(this._verticalScroll.bind(this, !0))
        },
        update: function() {
            return BN("i-counters").getAsync().then(function(e) {
                var t = BN("i-router").getParams(),
                    i = {
                        counter_id: t.id || null,
                        group_id: t.gid || null
                    },
                    n = e.needRedraw(i) ? BN("i-counters").switchTo() : Vow.fulfill(e);
                return Vow.all([n, BN("i-report").getReport()]).spread(function(e, t) {
                    var i = this.__lastInstance,
                        n = window.scrollY,
                        o = BN("i-page").getUpdateNode(),
                        s = o.length ? o[0].offsetTop : 0;
                    return !i || e.needRedraw(i.params.counter) || t.needRedraw() ? (BN("light-constructor") && BN("light-constructor").cleanupPopups(), this._checkReportAccess().then(Vow.all([this._prepareToLeave(), BN("i-report").cleanCache(), i && BEM.DOM.destruct(!0, i.domElem)])).then(this.out.bind(this)).then(function() {
                        var e = BN("i-page").getUpdateNode(),
                            t = e.length ? e[0].offsetTop : 0;
                        n >= s ? window.scroll(window.scrollX, t) : this._setInitPageScroll(!0)
                    }.bind(this))) : void 0
                }.bind(this))
            }.bind(this))
        },
        _prepareToLeave: function() {
            setTimeout(function() {
                throw new Error("_prepareToLeave not implemented")
            })
        },
        _setInitPageScroll: function(e) {
            e && this.__base()
        }
    }), BEM.JSON.decl("notification", {
        onBlock: function(e) {
            var t = e.params();
            e.wrap([{
                block: t.notificationBlock,
                mix: [{
                    block: "notification"
                }],
                mods: e.mods(),
                js: !0
            }])
        },
        onElem: {
            container: function(e) {
                var t = e.params();
                e.content([{
                    block: "notification",
                    elem: "notification-text",
                    content: t.message
                }, t.details ? {
                    block: "notification",
                    elem: "details-button",
                    content: BEM.I18N("notification", "details")
                } : void 0, {
                    block: "notification",
                    elem: "simple-popup"
                }])
            }
        }
    }), BEM.DOM.decl("notification", {
        onSetMod: {
            js: function() {
                this._notificationBlock = this.findBlockOn(this.domElem, "notification"), this._onDetailsClick = this._onDetailsClick.bind(this), this.__self._registerInstance(this), this.params.initiallyVisible && this.show()
            }
        },
        onElemSetMod: {
            "simple-popup": {
                visible: {
                    yes: function(e) {
                        this.afterCurrentEvent(function() {
                            this._notificationBlock.setMod(e, "animate", "yes")
                        })
                    },
                    "": function(e) {
                        return this._notificationBlock.hasMod(e, "animate", "yes") ? (e.one("transitionend", function() {
                            this._notificationBlock.delMod(e, "visible")
                        }.bind(this)), this._notificationBlock.delMod(e, "animate"), !1) : void 0
                    }
                }
            }
        },
        destruct: function() {
            return this.__self._unregisterInstance(this), this.__base.apply(this, arguments)
        },
        toggle: function(e) {
            this[e ? "show" : "hide"]()
        },
        show: function(e, t) {
            e = e || this._getMessage(), t = t || this._getDetails(), this._details = t, this._notificationBlock.delMod("hidden"), BN("i-content").update(this.domElem, {
                block: "notification",
                elem: "container",
                message: e,
                details: t
            }).then(this._bindHandlers.bind(this)).done()
        },
        hide: function() {
            this._unbindHandlers(), this._notificationBlock.setMod("hidden", "yes"), this._notificationBlock.delMod(this.findElem("simple-popup"), "visible")
        },
        _getMessage: function() {
            return BEM.I18N(this.__self._name, "notification")
        },
        _getDetails: function() {
            return BEM.I18N(this.__self._name, "details")
        },
        _bindHandlers: function() {
            var e = this._getDetailsButton();
            e.length && (e.on("click", this._onDetailsClick), this.bindToDoc("leftclick tap", this._onDocClick))
        },
        _unbindHandlers: function() {
            var e = this._getDetailsButton();
            e.length && (e.off("click", this._onDetailsClick), this.unbindFromDoc("leftclick tap", this._onDocClick))
        },
        _getDetailsButton: function() {
            return this._notificationBlock.findElem("details-button")
        },
        _onDetailsClick: function() {
            var e = this._notificationBlock.findElem("simple-popup");
            this.hasMod(e, "visible", "yes") ? this._notificationBlock.delMod(e, "visible") : (BN("i-content").update(e, this._details), this._notificationBlock.setMod(e, "visible", "yes"))
        },
        _onDocClick: function(e) {
            this._notificationBlock.findElem("simple-popup").find(e.target).length || this._notificationBlock.findElem("details-button").is(e.target) || this._notificationBlock.delMod(this._notificationBlock.findElem("simple-popup"), "visible")
        }
    }, {
        _instances: {},
        show: function() {
            this._notifyAll("toggle", arguments)
        },
        hide: function() {
            this._notifyAll("hide", arguments)
        },
        _notifyAll: function(e, t) {
            (this._instances[this._name] || []).forEach(function(i) {
                i[e].apply(i, t)
            })
        },
        _registerInstance: function(e) {
            this._instances[this._name] = this._instances[this._name] || [], this._instances[this._name].push(e)
        },
        _unregisterInstance: function(e) {
            this._instances[this._name] = (this._instances[this._name] || []).filter(function(t) {
                return e !== t
            })
        }
    }), BEM.DOM.decl({
        block: "sensitive-data-warning",
        baseBlock: "notification"
    }, {
        toggle: function(e) {
            var t = this.hasMod("type", "webvisor") ? "webvisor-" : "";
            e ? this.show(BEM.I18N("sensitive-data-warning", t + "warning"), BEM.I18N("sensitive-data-warning", t + "details")) : this.hide()
        }
    }), BEM.JSON.decl("missing-attribute-data-notification", {
        onElem: {
            details: function(e) {
                var t = e.params().metricsMeta || [],
                    i = e.params().dimensionsMeta || [];
                e.content(t.map(function(e) {
                    return {
                        elem: "attribute-row",
                        type: "metric",
                        meta: e
                    }
                }).concat(i.map(function(e) {
                    return {
                        elem: "attribute-row",
                        type: "dimension",
                        meta: e
                    }
                })))
            },
            "attribute-row": function(e) {
                var t = e.params();
                e.content(BEM.I18N("missing-attribute-data-notification", "attribute-warning", {
                    type: t.type,
                    name: BN("i-string").escapeHTML(t.meta.name),
                    since: BN("humanize").formatDate(t.meta.since)
                }))
            }
        }
    }), BEM.DOM.decl({
        block: "missing-attribute-data-notification",
        baseBlock: "notification"
    }, {
        toggle: function(e, t, i, n) {
            var o = this._getBadAttributes(e, i, n),
                s = this._getBadAttributes(t, i, n);
            o.length || s.length ? BN("i-content").html({
                block: this.__self._name,
                elem: "details",
                metricsMeta: o,
                dimensionsMeta: s
            }).then(function(e) {
                this.show(BEM.I18N("missing-attribute-data-notification", "warning-head"), e)
            }.bind(this)).done() : this.hide()
        },
        _getBadAttributes: function(e, t, i) {
            return e.filter(function(e) {
                var n = BN("i-date").create.bind(BN("i-date")),
                    o = e.since && n(e.since);
                return o && (n(t.from) < o || i && n(i.from) < o)
            })
        }
    }), BEM.JSON.decl("report-page", {
        onBlock: function(e) {
            e.js(!0).mix([{
                block: "report-page",
                elem: "redraw-content"
            }]).content([{
                elem: "controls"
            }, {
                elem: "chart"
            }, {
                elem: "table-toolbar"
            }, {
                elem: "table"
            }, {
                block: "data-lag-notification"
            }, {
                block: "customizations",
                mix: [{
                    block: "report-page",
                    elem: "customizations"
                }]
            }])
        },
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }])
            },
            notifications: function(e) {
                e.content([{
                    block: "notification",
                    notificationBlock: "public-counter-notification"
                }, {
                    block: "notification",
                    notificationBlock: "sensitive-data-warning"
                }, {
                    block: "notification",
                    notificationBlock: "missing-attribute-data-notification"
                }, {
                    block: "notification",
                    notificationBlock: "direct-expenses-notification"
                }, {
                    block: "notification",
                    notificationBlock: "direct-sampling-notification"
                }, {
                    block: "notification",
                    notificationBlock: "direct-clientid-notification"
                }])
            },
            header: function(e) {
                e.content([{
                    elem: "header-controls"
                }, {
                    block: "report-title",
                    mix: [{
                        block: "report-page",
                        elem: "report-headline"
                    }]
                }, {
                    block: "add-to-favorites",
                    mix: [{
                        block: "report-page",
                        elem: "bookmark"
                    }]
                }])
            },
            "header-controls": function(e) {
                e.content({
                    elem: "export"
                })
            },
            "export": function(e) {
                e.content({
                    block: "export",
                    formats: ["pdf"].concat(e.params().formats || [])
                })
            },
            chart: function(e) {
                var t, i, n = e.params().report;
                n.hasChart() ? (t = e.param("chart-mods") || {}, i = n.getChartMode(), i && (t[i] = "yes"), e.param("chart-mods", t), e.content({
                    block: "chart-report",
                    mods: t
                })) : e.remove()
            }
        }
    }), BEM.blocks["i-router"].define("GET", /^\/*(stat|monitoring|legacy|user|markedphones)\/[^\/]+(\/[^\/]+)?\/?/, "report-page"), (BEM.DOM || BEM).decl({
        name: "report-page",
        baseBlock: "i-report-page-base"
    }, {}, {
        getPageTemplate: function() {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getReport()]).spread(function(e, t) {
                return {
                    block: "report-page",
                    mods: {
                        mode: this._getMode(t),
                        type: t.getType()
                    },
                    js: {
                        reportId: t.getId(),
                        counter: e.getParams()
                    }
                }
            }.bind(this))
        }
    }), BEM.JSON.decl("report-page", {
        onElem: {
            chart: function(e) {
                e.defer(BN("i-report").getReport().then(function(t) {
                    e.params().report = t
                }))
            },
            "export": function(e) {
                e.defer(BN("i-report").getReport().then(function(t) {
                    e.params().formats = t.getApiExportFormats()
                }))
            }
        }
    }), BEM.DOM.decl("report-page", {}, {
        _prepareToLeave: function() {
            return BN("i-content").append(jQuery(".report-page__redraw-content"), {
                block: "paranja-light",
                mix: [{
                    block: "report-page",
                    elem: "paranja"
                }]
            })
        }
    }), BEM.DOM.decl("report-page", null, {
        destruct: function() {
            return BN("i-content").append(this.getUpdateNode(), {
                block: "paranja-light"
            }), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "mode",
        modVal: "single"
    }, {
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "date-selector",
                        mods: {
                            "data-bind": "report",
                            data: "report"
                        }
                    }]
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "segments-selector",
                        mods: {
                            data: "report",
                            advice: "yes"
                        },
                        dataBind: "report",
                        menuType: "primary"
                    }, {
                        block: "segment-compare-menu",
                        mix: [{
                            block: "report-page",
                            elem: "compare-menu"
                        }]
                    }, {
                        block: "segment-quantile"
                    }, {
                        block: "sampling-popup"
                    }, {
                        block: "direct-client"
                    }, {
                        block: "report-currency",
                        mods: {
                            "data-bind": "single"
                        }
                    }, {
                        block: "attribution-menu",
                        mods: {
                            advice: "yes"
                        }
                    }]
                }, {
                    block: "segment-size-totals",
                    mods: {
                        "data-bind": "report",
                        type: "primary",
                        hidden: "yes"
                    },
                    mix: [{
                        block: "report-page",
                        elem: "segment-size-totals"
                    }]
                }, {
                    block: "segments-wrapper",
                    mix: [{
                        block: "report-page",
                        elem: "segments-wrapper"
                    }]
                }], !0)
            },
            "header-controls": function(e) {
                e.content([{
                    elem: "export"
                }, {
                    block: "save-report-form"
                }])
            },
            chart: function(e) {
                var t = e.param("chart-mods") || {};
                t = jQuery.extend({}, t, {
                    mode: "single"
                }), e.param("chart-mods", t)
            },
            table: function(e) {
                e.content({
                    block: "data-table",
                    mods: {
                        "data-bind": "report",
                        "fixed-head": "yes"
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        block: "period-group-selector",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.group": {
                initAccessor: "get",
                set: "set",
                get: "get",
                event: "change"
            }
        }
    }), BEM.DOM.decl({
        block: "date-selector",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.period": {
                initAccessor: "set",
                get: "get",
                set: "set",
                event: "change"
            }
        }
    }), BEM.JSON.decl({
        name: "period-group-selector",
        modName: "data",
        modVal: "report"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                var i = t.getParamsModel().getParams().group;
                e.param("groups", BN("i-period").getGroups(t)), e.param("grouping", i), e.param("disabled", t.isGroupingDisabled())
            }))
        }
    }), BEM.JSON.decl("chart-report", {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                type: t.chartType
            }).mod("chart-type", t.chartType).mod("period-equals", "yes").mix([{
                block: "error-message",
                mods: {
                    theme: "light"
                }
            }]).content([{
                elem: "title"
            }, {
                elem: "types",
                chartType: t.chartType,
                enabledChartTypes: t.enabledChartTypes
            }, {
                elem: "common-container"
            }])
        },
        onElem: {
            "common-container": function(e) {
                e.content([{
                    elem: "no-data",
                    mix: [{
                        block: "selection-disabler"
                    }, {
                        elem: "error-message"
                    }],
                    content: {
                        elem: "error-wrapper",
                        content: BEM.I18N("chart-report", "no-data")
                    }
                }, {
                    elem: "rows-not-selected",
                    mix: [{
                        elem: "error-message"
                    }],
                    content: {
                        elem: "error-wrapper",
                        content: BEM.I18N("i-error-message", "ERR_ROWS_NOT_SELECTED")
                    }
                }, {
                    elem: "chart-toolbar"
                }, {
                    elem: "chart-wrap"
                }, {
                    block: "wait",
                    mods: {
                        theme: "white",
                        state: "active"
                    },
                    spinMods: {
                        size: "l"
                    }
                }, {
                    elem: "region-selector"
                }, {
                    elem: "map-legend"
                }])
            },
            "chart-wrap": function(e) {
                e.content([{
                    elem: "chart-inner"
                }, {
                    block: "chart-legend"
                }])
            },
            "chart-inner": function(e) {
                e.content([{
                    block: "chart"
                }])
            },
            "chart-toolbar": function(e) {
                e.remove()
            },
            types: function(e) {
                var t = BN("i-chart"),
                    i = e.param("enabledChartTypes"),
                    n = e.param("chartType") || i[0],
                    o = t.chartTypesStructure();
                e.content({
                    block: "chart-type-selector",
                    mods: {
                        "only-icon": "yes"
                    },
                    selected: n,
                    types: t.chartTypes.map(function(e) {
                        return {
                            type: e,
                            name: o[e].name,
                            disabled: -1 === i.indexOf(e)
                        }
                    })
                })
            }
        }
    }), BEM.JSON.decl("chart-report", {
        onBlock: function(e) {
            var t, i = e.params();
            i.chartType || i.enabledChartTypes || (t = [BN("i-report").getMetadata(), BN("i-report").getReport()], e.defer(Vow.all(t).spread(function(t, i) {
                var n = i.getParamsModel().getState(),
                    o = n["data-table"].metric,
                    s = n.chartType,
                    r = BN("i-chart").enabledChartTypes(t.getMetricsMeta([o])[0], t.getDimensionsMeta(), !1, i.isCompareMode && i.isCompareMode(), i instanceof BN("i-report-comparable"));
                e.param("chartType", -1 === r.indexOf(s) ? r[0] : s), e.param("enabledChartTypes", r)
            })))
        }
    }), BEM.DOM.decl("chart-report", {
        dataBindings: {
            "chartType.actual": {
                event: "change",
                set: "_onChartTypeChange"
            }
        },
        onSetMod: {
            js: function() {
                this._typeSelector = this.findBlockInside("chart-type-selector"), this._type = this.params.type, this._chartBlock = this.findBlockInside("chart"), this._legendBlock = this.findBlockInside("chart-legend"), this._wait = this.findBlockInside("wait"), this._title = this.findElem("title"), this._onModelReady = jQuery.debounce(this._onModelReady.bind(this), 100), this._initDataModel(), this._dataModel.on("ready", this._onModelReady, this).on("change", this._onModelChange, this).on("beforeload", this._onModelChange, this)
            }
        },
        destruct: function() {
            return this._dataModel.destruct(), this._chartAdapter && this._chartAdapter.destruct(), this.__base.apply(this, arguments)
        },
        _onModelChange: function() {
            this._showSpinner()
        },
        _showSpinner: function() {
            this.setMod("state", "loading")
        },
        _hideSpinner: function() {
            this.hasMod("state", "loading") && this.delMod("state")
        },
        _onModelReady: function() {
            var e, t = this._dataModel,
                i = t.getError();
            if (this._title.html(this._getTitle()), this._hideSpinner(), this._showErrorMessage(i), !i) {
                if (e = this._disableChartTypes(t), e !== this._type) return this._setType(e), void t.reload();
                if (t.checkSelectableRowsPresent() && !t.checkSomethingSelected()) return this.setMod("state", "rows-not-selected"), this._chartAdapter && this._chartAdapter.clear(), void(this._legendBlock && this._legendBlock.clear());
                if (t.checkForNodata()) return this.setMod("state", "no-data"), this._chartAdapter && this._chartAdapter.clear(), void(this._legendBlock && this._legendBlock.clear());
                this.delMod("state"), this._replaceChart(t).fail(this._showErrorMessage.bind(this)).done()
            }
        },
        _getTitle: function() {
            return this._dataModel.getMetricMeta().name
        },
        _getChartBlockName: function() {
            var e = this.__self.CHART_OPTIONS[this._type];
            return e.adapterMode = this.getMod("mode"), e
        },
        _replaceChart: function(e) {
            var t = this._getChartBlockName();
            return this._chartAdapter && this._chartAdapter.destruct(), this._chartAdapter = BEM.create({
                block: t.adapter,
                mods: {
                    mode: t.adapterMode,
                    phantom: "yes"
                }
            }), this._chartBlock.setAdapter(this._chartAdapter), this._legendBlock && this._legendBlock.setAdapter(this._chartAdapter), this._chartAdapter.draw(e)
        },
        _initDataModel: function() {
            this._dataModel = BEM.create({
                block: this._getDataModelBlock(),
                mods: this._getDataModelMods()
            }, {
                type: this._type
            })
        },
        _getDataModelMods: function() {
            return {
                "chart-type": this._type
            }
        },
        _setType: function(e) {
            e !== this._type && (this._type = e, this.setMod("chart-type", e), this._dataModel.setMod("chart-type", e), this.trigger("change", e))
        },
        _onChartTypeChange: function(e) {
            this._type !== e && (this._chartAdapter && this._chartAdapter.clear(), this._setType(e), this._dataModel.reload())
        },
        _showErrorMessage: function(e) {
            e ? BN("error-message").showError(this, e) : BN("error-message").hideError(this)
        },
        _getEnabledChartTypes: function() {
            throw new Error("must be implemented in mods/childs")
        },
        _disableChartTypes: function(e) {
            var t, i = this._getEnabledChartTypes(e);
            return this._typeSelector && this._typeSelector.setEnabled(i), -1 === i.indexOf(this._type) ? t = i[0] : this._type
        }
    }, {
        CHART_OPTIONS: {
            pie: {
                adapter: "report-chart-pie"
            },
            "line-chart": {
                adapter: "report-chart-line"
            },
            "stacked-chart": {
                adapter: "report-chart-stacked"
            },
            "bar-chart": {
                adapter: "report-chart-bar"
            },
            map: {
                adapter: "report-chart-map"
            }
        }
    }), BEM.JSON.decl("chart", {
        onBlock: function(e) {
            e.js(!0).content([{
                elem: "chart"
            }, {
                elem: "mapdiv"
            }])
        }
    }), BEM.DOM.decl("chart", {
        onSetMod: {
            js: function() {
                BN("main-menu").on("toggle", this._onResize, this)
            }
        },
        destruct: function() {
            BN("main-menu").un("toggle", this._onResize, this), this.__base.apply(this, arguments)
        },
        setAdapter: function(e, t) {
            this._chartAdapter = e, this._chartAdapter.setDestination(this.findElem(t ? "mapdiv" : "chart"))
        },
        _onResize: function() {
            this._chartAdapter.resize()
        }
    }), BEM.decl({
        name: "report-chart-pie",
        modName: "mode",
        modVal: "compare"
    }, {
        _initChartOptions: function() {
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                plotOptions: {
                    pie: {
                        size: "90%"
                    }
                }
            })
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions("primary"),
                t = this._getChartDataOptions("secondary");
            this._legendData = e.series, this._chartOptions.series = [{
                startAngle: 0,
                endAngle: 180,
                center: ["51%", "50%"],
                data: e.series
            }, {
                startAngle: 180,
                endAngle: 360,
                center: ["49%", "50%"],
                data: t.series.reverse()
            }]
        },
        _tooltipFormatter: function(e, t) {
            return this._dataModel.getSegmentName(t.model) + "<br/>" + this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "report-chart-bar",
        baseBlock: "report-chart"
    }, {
        _initChartOptions: function() {
            var e = this;
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "column"
                },
                xAxis: {
                    min: 0,
                    labels: {
                        formatter: function() {
                            return e._xAxisFormatter(this.value)
                        }
                    }
                },
                yAxis: {
                    labels: {
                        formatter: function() {
                            return e._yAxisFormatter(this.value)
                        }
                    }
                },
                plotOptions: {
                    series: {
                        groupPadding: .1,
                        pointPadding: .05,
                        states: {
                            hover: {
                                enabled: !1
                            }
                        }
                    }
                },
                tooltip: {
                    followPointer: !1
                }
            })
        },
        _tooltipFormatter: function(e, t) {
            var i = this._getTooltipValue(t.y, t.originalVal);
            return BN("i-content").unescapeHTML(this._injectSoftBreaks(t.name)) + "<br />" + this._dataModel.getMetricMeta().name + ": " + i
        },
        _xAxisFormatter: function(e) {
            var t = this._chartOptions.xAxis.categories.length,
                i = Math.max(600 - 90 * t, 100);
            return BN("i-content").html({
                block: "report-chart-bar",
                elem: "x-label",
                attrs: {
                    style: "max-width:" + i + "px"
                },
                content: e
            }, !0)
        },
        _getChartDataOptions: function(e) {
            var t, i = this._dataModel.getData(e),
                n = this._dataModel.getColorsIndexes(),
                o = this._getColorPool(),
                s = this._getTotals(i),
                r = this._dataModel.isNormalized(),
                a = {
                    xAxisCategories: []
                };
            return a.series = i.data.map(function(t, i) {
                var l = this._yAxisMetricFormatter(t.metrics[this.metricIndex]),
                    c = this._getDimName(t),
                    d = n[i % n.length];
                return a.xAxisCategories.push(c), {
                    model: e,
                    y: this._yAxisMetricFormatter(!l || isNaN(l) ? 0 : l, s, r),
                    colorIdx: d,
                    color: o.getColor(d),
                    originalVal: l,
                    name: c
                }
            }, this), this._dataModel.isTotalsAveragesEnabled() && (t = this._buildTotalsAveragesLabel(), a.xAxisCategories.push(t), a.series.push({
                model: e,
                y: this._yAxisMetricFormatter(s, s, r),
                color: this._dataModel.getTotalsColor(),
                originalVal: this._yAxisMetricFormatter(s),
                name: t
            })), a
        },
        _getLegendData: function() {
            return !1
        }
    }), BEM.decl({
        name: "report-chart-bar",
        modName: "mode",
        modVal: "compare"
    }, {
        _updateChartDataOptions: function() {
            var e, t = this._getChartDataOptions("primary"),
                i = this._getChartDataOptions("secondary");
            e = t.series.map(function(e) {
                var t = e.color;
                return e.color = "url(#pattern-" + t + ")", t
            }), jQuery.extend(!0, this._chartOptions, {
                defs: {
                    patterns: this._getPatterns(e)
                },
                xAxis: {
                    categories: t.xAxisCategories
                },
                yAxis: {
                    ceiling: this._dataModel.isNormalized() ? 100 : null
                },
                series: [{
                    data: i.series
                }, {
                    data: t.series
                }]
            })
        },
        _tooltipFormatter: function(e, t) {
            return this._dataModel.getSegmentName(t.model) + "<br/>" + this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "report-chart-bar",
        modName: "mode",
        modVal: "single"
    }, {
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions("primary");
            jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    categories: e.xAxisCategories
                },
                yAxis: {
                    ceiling: this._dataModel.isNormalized() ? 100 : null
                },
                series: [{
                    data: e.series
                }]
            })
        }
    }), BEM.decl({
        name: "report-chart-line",
        modName: "mode",
        modVal: "compare"
    }, {
        _initChartOptions: function() {
            var e;
            this.__base(), e = this._chartOptions.tooltip.positioner, jQuery.extend(!0, this._chartOptions, {
                chart: {
                    height: 400,
                    marginTop: 40
                },
                tooltip: {
                    positioner: function(t, i, n) {
                        var o = this.chart.options.chart.marginTop,
                            s = e.apply(this, arguments);
                        return s.y < o && (s.y = n.plotY + o + 10), s
                    }
                }
            })
        },
        _updateChartDataOptions: function() {
            var e, t, i = this._getChartDataOptions("primary"),
                n = this._getChartDataOptions("secondary"),
                o = i.count - n.count;
            o >= 0 ? (e = i, t = n) : (e = n, t = i, o = Math.abs(o)), jQuery.extend(!0, this._chartOptions.xAxis, {
                labels: {
                    formatter: function() {
                        var e = i.xAxisFormatter.apply(this, arguments),
                            t = BN("i-content").html({
                                block: "report-chart-line",
                                elem: "compare-date-label",
                                content: n.xAxisFormatter.apply(this, arguments)
                            }, !0);
                        return e + t
                    }
                }
            }), i.series.forEach(function(e) {
                e.dashStyle = "ShortDash"
            }), n.series.forEach(function(e) {
                e.dashStyle = "ShortDot"
            }), t.series.forEach(function(e) {
                for (var t = 0; o > t; t++) e.data.push({
                    y: null,
                    x: n.count + t
                })
            }), this._chartOptions.series = i.series.concat(n.series)
        },
        _getLegendData: function() {
            var e = this._chartOptions.series;
            return e.slice(0, e.length / 2)
        },
        _tooltipFormatter: function(e, t) {
            return this._dataModel.getSegmentName(t.model) + "<br/>" + this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "report-chart-stacked",
        baseBlock: "report-chart-line"
    }, {
        _initChartOptions: function() {
            this.__base(), this._chartOptions.xAxis = this._getXAxisOptions(), this._chartOptions.plotOptions.area = this._chartOptions.plotOptions.line, jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "area"
                },
                plotOptions: {
                    area: {
                        stacking: "normal"
                    },
                    series: {
                        lineWidth: 0,
                        states: {
                            hover: {
                                lineWidth: 0,
                                lineWidthPlus: 0
                            }
                        }
                    }
                }
            })
        },
        _getColorPool: function() {
            return this.__base("set02")
        }
    }), BEM.decl({
        name: "report-chart-stacked",
        modName: "mode",
        modVal: "single"
    }, {
        _updateChartDataOptions: function() {
            this.__base(), this._chartOptions.series = this._chartOptions.series.reverse()
        },
        _getChartDataOptions: function(e) {
            var t, i = this.__base(e),
                n = this._dataModel.getPeriodGroups(e);
            return this._dataModel.isNormalized() && (jQuery.extend(!0, this._chartOptions, {
                yAxis: {
                    max: 100
                }
            }), t = i.totals.map(function(t, o) {
                var s = t,
                    r = 100;
                return i.series.forEach(function(e) {
                    s -= e.data[o].originalVal, r -= e.data[o].y
                }), {
                    x: o,
                    y: r,
                    originalVal: s,
                    date1: n[o].from,
                    date2: n[o].to,
                    isHoliday: n[o].isHoliday,
                    model: e
                }
            }), i.series.push({
                name: BEM.I18N("report-chart", "other-slice"),
                color: this.OTHER_COLOR,
                data: t
            })), i
        },
        _getLegendData: function() {
            return this._chartOptions.series.slice(0).reverse()
        }
    }), BEM.decl({
        name: "report-chart-bytime",
        baseBlock: "report-chart"
    }, {
        DEFAULT_COLOR: "#C3B0FA",
        HOLIDAY_COLOR: "#E8B0FA",
        _initChartOptions: function() {
            var e = this;
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "column"
                },
                xAxis: {
                    tickWidth: 0
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: null
                    },
                    gridLineWidth: 1,
                    tickWidth: 0,
                    labels: {
                        useHTML: !1,
                        formatter: function() {
                            return e._yAxisFormatter(this.value)
                        }
                    },
                    lineWidth: 1
                },
                plotOptions: {
                    series: {
                        groupPadding: .1,
                        pointPadding: .05,
                        states: {
                            hover: {
                                enabled: !1
                            }
                        }
                    }
                },
                tooltip: {
                    followPointer: !1
                }
            })
        },
        _tooltipFormatter: function(e, t) {
            var i = this._getTooltipValue(t.y, t.originalVal),
                n = this._formatTooltipDate({
                    date1: t.date1,
                    date2: t.date2,
                    isHoliday: t.isHoliday,
                    group: this._dataModel.getGroup()
                });
            return n + "<br />" + this._dataModel.getMetricMeta().name + ": " + i
        },
        _getChartDataOptions: function(e) {
            var t = this,
                i = this._dataModel.getData(e),
                n = this._dataModel.getPeriodGroups(e),
                o = i.data[0] && i.data[0].metrics[this.metricIndex] || [],
                s = this._getTotals(i, !0),
                r = n.length,
                a = this._dataModel.isNormalized(),
                l = {
                    xAxisCategories: []
                };
            l.xAxisFormatter = function() {
                var e = n[this.value];
                return e ? t._xAxisFormatter(e) : ""
            }, l.series = o.map(function(t, i) {
                var o = n[i];
                return {
                    model: e,
                    y: this._yAxisMetricFormatter(t, s[i], a),
                    color: o.isHoliday ? this.HOLIDAY_COLOR : this.DEFAULT_COLOR,
                    originalVal: t,
                    date1: o.from,
                    date2: o.to,
                    isHoliday: o.isHoliday
                }
            }, this), l.count = r;
            for (var c = 0; r > c; c++) l.xAxisCategories.push(c);
            return l
        },
        _getLegendData: function() {
            return !1
        }
    }), BEM.decl({
        name: "report-chart-bytime",
        modName: "mode",
        modVal: "compare"
    }, {
        _initChartOptions: function() {
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    labels: {
                        useHTML: !0
                    }
                }
            })
        },
        _updateChartDataOptions: function() {
            var e, t, i = this._getChartDataOptions("primary"),
                n = this._getChartDataOptions("secondary"),
                o = i.count - n.count;
            o >= 0 ? (e = i, t = n) : (e = n, t = i, o = Math.abs(o)), i.series.forEach(function(e) {
                e.color = "url(#pattern-" + e.color + ")"
            });
            for (var s = 0; o > s; s++) t.series.push({
                y: null
            });
            jQuery.extend(!0, this._chartOptions, {
                defs: {
                    patterns: this._getPatterns([this.DEFAULT_COLOR, this.HOLIDAY_COLOR])
                },
                xAxis: {
                    labels: {
                        formatter: function() {
                            return n.xAxisFormatter.apply(this, arguments) + "<br/>&nbsp;&nbsp;&nbsp;" + i.xAxisFormatter.apply(this, arguments)
                        }
                    }
                },
                yAxis: {
                    ceiling: this._dataModel.isNormalized() ? 100 : null
                },
                series: [{
                    data: n.series
                }, {
                    data: i.series
                }]
            })
        },
        _tooltipFormatter: function(e, t) {
            return this._dataModel.getSegmentName(t.model) + "<br/>" + this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "report-chart-bytime",
        modName: "mode",
        modVal: "single"
    }, {
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions("primary");
            jQuery.extend(!0, this._chartOptions, {
                xAxis: {
                    labels: {
                        formatter: e.xAxisFormatter
                    }
                },
                yAxis: {
                    ceiling: this._dataModel.isNormalized() ? 100 : null
                },
                series: [{
                    data: e.series
                }]
            })
        }
    }), BEM.decl({
        name: "report-chart-minutely",
        baseBlock: "report-chart-line"
    }, {
        COLOR: "#1F77B4",
        _getLegendData: function() {
            return !1
        },
        _getChartDataOptions: function(e) {
            var t = this.__base(e);
            return t.series[0].color = this.COLOR, t
        },
        _tooltipFormatter: function(e, t) {
            var i = this._getTooltipValue(t.y, t.originalVal),
                n = this._dataModel.getSegmentName(t.model),
                o = this._formatTooltipDate({
                    date1: t.date1,
                    date2: t.date2,
                    isHoliday: t.isHoliday,
                    group: this._dataModel.getGroup()
                });
            return (n ? n + "<br />" : "") + o + "<br />" + this._dataModel.getMetricMeta().name + ": " + i
        }
    }), BEM.decl("i-color", null, {
        _digitalPattern: /^rgb\s*\(\s*((?:\d+\s*,\s*){2}\d+)\s*\)/i,
        _hexPattern: /^#?([a-f0-9]{3}|[a-f0-9]{6})$/i,
        normalize: function(e, t) {
            return e = e.trim(), this._digitalPattern.test(e) ? this._beautify(this._dec2hex(e), t) : this._hexPattern.test(e) ? (e = String(this._hexPattern.exec(e)[1]), 3 === e.length && (e = e.split("").map(function(e) {
                return e + e
            }).join("")), this._beautify(e, t)) : !1
        },
        calcGradient: function(e, t) {
            var i, n, o, s = 32;
            return e = this.normalize(e, !0), e ? (i = parseInt(e.substr(0, 2), 16) + s, n = parseInt(e.substr(2, 2), 16) + s, o = parseInt(e.substr(4, 2), 16) + s, this._beautify(this._toHex(i) + this._toHex(n) + this._toHex(o), t)) : !1
        },
        tweenColors: function(e, t, i) {
            var n, o, s = [];
            return 0 >= i ? e : i >= 1 ? t : (n = this._parseHex(e), o = this._parseHex(t), s.push(Math.round(o.r + (n.r - o.r) * (1 - i))), s.push(Math.round(o.g + (n.g - o.g) * (1 - i))), s.push(Math.round(o.b + (n.b - o.b) * (1 - i))), this._beautify(this._dec2hex("rgb(" + s.join(",") + ")")))
        },
        _parseHex: function(e) {
            return e = this.normalize(e, !0), e ? {
                r: parseInt(e.substr(0, 2), 16),
                g: parseInt(e.substr(2, 2), 16),
                b: parseInt(e.substr(4, 2), 16)
            } : e
        },
        _toHex: function(e) {
            return e = parseInt(e), ("0" + (e > 255 ? 255 : e).toString(16)).slice(-2)
        },
        _beautify: function(e, t) {
            return (t ? "" : "#") + e.toUpperCase()
        },
        _dec2hex: function(e) {
            var t = String(this._digitalPattern.exec(e)[1]).split(",");
            return t.map(function(e) {
                return this._toHex(e)
            }, this).join("")
        }
    }), BEM.decl("i-color", {}, {
        _canvasContext: null,
        gradient: function(e) {
            var t, i = [];
            return this._canvas || (this._canvasContext = document.createElement("canvas").getContext("2d")), t = this._canvasContext.createLinearGradient(0, 0, 255, 1), Object.keys(e).forEach(function(i) {
                t.addColorStop(Number(i), e[i])
            }, this), this._canvasContext.fillStyle = t, this._canvasContext.fillRect(0, 0, 256, 1), [].forEach.call(this._canvasContext.getImageData(0, 0, 256, 1).data, function(e, t) {
                t % 4 ? i[i.length - 1].push(e) : i.push([e])
            }), i.map(function(e) {
                return "rgb(" + e.slice(0, 3).join(",") + ")"
            })
        }
    }), BEM.decl({
        name: "report-chart-map",
        baseBlock: "report-chart"
    }, {
        NO_DATA_COLOR: "#f3f1ed",
        COLORS: [
            [224, 101, 76],
            [255, 235, 153],
            [109, 179, 102]
        ],
        _strokeCache: {},
        _regionsCache: {},
        draw: function(e) {
            var t, i, n = this;
            return e && this.setDataModel(e), this._chartData = this.getStructure(),
                i = this._dataModel.getData(), t = BN("ymaps").getRegionSettings(i._region.isoName), BN("ymaps").getNewMap(this._domNode, t).then(function(e) {
                    n._chart = e, BN("ymaps").recombine(i._region.isoName, i._coords.geoObjects), n._setMapProperties(), n._setRegionsProperties(i._coords.geoObjects), n._chart.geoObjects.add(i._coords.geoObjects)
                })
        },
        destruct: function() {
            this._chart && this._chart.destroy && this._chart.destroy(), this.__base.apply(this, arguments)
        },
        setDestination: function(e) {
            this._domNode = jQuery(e)[0]
        },
        getStructure: function() {
            return this._transformModelData()
        },
        clear: function() {
            this._clearRenderTarget()
        },
        _getLegendData: function() {
            return !1
        },
        _setMapProperties: function() {
            this._chart.options.set("hintPane", "hint")
        },
        _getRegionIsoName: function(e) {
            var t = e.properties.get("properties").iso3166;
            return t && t.toLowerCase() || ""
        },
        _setRegionsProperties: function(e) {
            e.each(function(e) {
                var t = this._getRegionIsoName(e),
                    i = this._chartData[t] || {},
                    n = i.color || this.NO_DATA_COLOR;
                e.options.set("fillColor", n), e.options.set("cursor", "arrow"), e.options.set("strokeColor", i.strokeColor), e.options.set("strokeWidth", "0"), e.options.set("shapeRendering", "crispEdges"), e.properties.set("hintContent", this._getHintContent(i))
            }, this), e.events.add(["mouseenter", "mouseleave"], this._onMouseAction, this)
        },
        _onMouseAction: function(e) {
            var t, i = e.get("target"),
                n = this._getRegionIsoName(i),
                o = e.get("type");
            this._chartData[n] && (t = this._getRegionClone(i), "mouseenter" === o ? this._chart.geoObjects.add(t) : this._chart.geoObjects.remove(t))
        },
        _getRegionClone: function(e) {
            var t = this._getRegionIsoName(e);
            return this._regionsCache[t] || (this._regionsCache[t] = BN("ymaps").clonePolygon(e, {}, {
                fill: !1,
                interactive: !1,
                strokeWidth: "0.75",
                strokeColor: e.options.get("strokeColor"),
                interactivityModel: "default#transparent"
            })), this._regionsCache[t]
        },
        _getHintContent: function(e) {
            var t = "";
            return e.dimName && (t = BN("i-content").html({
                block: "report-chart-map",
                elem: "tooltip",
                dimension: e.dimName,
                metric: e.metricName,
                value: e.tooltipValue
            }, !0)), t
        },
        _transformModelData: function() {
            var e = this._dataModel.getData(),
                t = {},
                i = e.min[this.metricIndex],
                n = e.max[this.metricIndex],
                o = e.data.map(function(e) {
                    return e.metrics[this.metricIndex]
                }, this),
                s = this.COLORS.slice(0);
            return this._dataModel.isNegativeMetric() && s.reverse(), e.data.forEach(function(r) {
                var a, l = r.dimensions[0].iso_name,
                    c = this._yAxisMetricFormatter(r.metrics[this.metricIndex]),
                    d = this._yAxisMetricFormatter(c, e.totals[this.metricIndex], this._dataModel.isNormalized());
                l && BN("i-util").isNumeric(c) && (a = BN("i-colorpool").getHeatColor(c, i, n, s, o), t[l.toLowerCase()] = {
                    dimName: this._getDimName(r, "map"),
                    metricName: this._dataModel.getMetricMeta().name,
                    tooltipValue: this._getTooltipValue(d, c),
                    color: a,
                    strokeColor: this._getStrokeColor(a)
                })
            }, this), t
        },
        _getStrokeColor: function(e) {
            var t;
            return this._strokeCache[e] || (t = BN("i-color").gradient({
                "0.0": e,
                "1.0": "#000"
            }), this._strokeCache[e] = t[Math.round(.25 * t.length)]), this._strokeCache[e]
        }
    }), BEM.JSON.decl("report-chart-map", {
        onElem: {
            tooltip: function(e) {
                var t = e.params();
                e.content([{
                    elem: "dimension",
                    content: t.dimension
                }, {
                    elem: "value-wrap",
                    content: [{
                        elem: "metric",
                        content: t.metric
                    }, ": ", {
                        elem: "value",
                        content: t.value
                    }]
                }])
            }
        }
    }), BEM.JSON.decl("chart-type-selector", {
        onBlock: function(e) {
            var t = e.params(),
                i = "yes" === e.mod("only-icon"),
                n = t.selected,
                o = t.types,
                s = 0;
            e.js(!0).content({
                block: "radio-button",
                mods: {
                    size: "m",
                    pseudo: "yes"
                },
                name: "chart-type-radio",
                value: n,
                content: o.map(function(e) {
                    return s += e.disabled ? 0 : 1, {
                        elem: "radio",
                        elemMods: {
                            "only-icon": i ? "yes" : "",
                            side: i ? "both" : "",
                            selected: e.type === n ? "yes" : void 0,
                            disabled: e.disabled ? "yes" : void 0
                        },
                        controlAttrs: {
                            value: e.type,
                            autocomplete: "off"
                        },
                        attrs: {
                            title: e.name
                        },
                        content: i ? {
                            block: "icon",
                            elem: e.type,
                            mix: [{
                                block: "radio-button",
                                elem: "icon"
                            }]
                        } : e.name
                    }
                })
            }), 2 > s && e.mod("visible", "no")
        }
    }), BEM.DOM.decl("chart-type-selector", {
        dataBindings: {
            "chartType.actual": {
                initAccessor: "_type",
                event: "change",
                set: "val"
            }
        },
        onSetMod: {
            js: function() {
                this._radio = this.findBlockInside("radio-button"), this._type = this._radio.val(), this._radio.on("change", this._changeHandler.bind(this))
            }
        },
        val: function(e) {
            return 0 === arguments.length ? this._type : void(this._type !== e && (this._type = e, this._radio.val(e)))
        },
        setEnabled: function(e) {
            [].forEach.call(this._radio.findElem("radio"), function(t) {
                var i;
                t = jQuery(t), i = this._radio.findElem(t, "control"), this._radio.setMod(t, "disabled", -1 === e.indexOf(i.val()) ? "yes" : "")
            }, this), this.toggleMod("visible", "no", e.length < 2)
        },
        _changeHandler: function() {
            var e = this._radio.val();
            this._type = e, this.trigger("change", this._type), BEM.dataBindVal("chartType.url", this._type)
        }
    }), BEM.decl({
        name: "chart-data-model",
        baseBlock: "chart-report-data"
    }, {
        onSetMod: {
            js: function() {
                this._options = {}, this.setType(this.params.type)
            },
            "chart-type": function(e, t) {
                this.setType(t)
            }
        },
        setType: function() {
            throw new Error("must be implemented in child/mode")
        },
        getRows: function() {
            throw new Error("must be implemented in child/mode")
        },
        getError: function() {
            throw new Error("must be implemented in child/mode")
        },
        checkSelectableRowsPresent: function() {
            throw new Error("must be implemented in child/mode")
        },
        checkForNodata: function() {
            throw new Error("must be implemented in child/mode")
        },
        checkSomethingSelected: function() {
            throw new Error("must be implemented in child/mode")
        },
        getMetricMeta: function() {
            return this.getDataModel().getMetricMeta()
        },
        isNegativeMetric: function() {
            return this.getDataModel().isNegativeMetric()
        },
        getDimensionsMeta: function() {
            return this.getDataModel().getDimensionsMeta()
        },
        isOnePeriod: function() {
            throw new Error("must be implemented in child/mode")
        },
        isTotalsAveragesEnabled: function() {
            throw new Error("must be implemented in child/mode")
        },
        getData: function() {
            return this.getDataModel().getData()
        },
        getGroup: function() {
            return this.getDataModel().getGroup()
        },
        getPeriodGroups: function() {
            return this.getDataModel().getPeriodGroups()
        },
        getSegmentName: function() {
            return this.getDataModel().getSegmentName()
        },
        getPeriod: function() {
            return this.getDataModel().getPeriod()
        },
        destruct: function() {
            this._destructModels(), this.__base.apply(this, arguments)
        },
        reload: function() {
            throw new Error("must be implemented in child/mode")
        },
        _destructModels: function() {
            this._dataModel && this._dataModel.destruct()
        },
        _getDataSourceDecl: function(e) {
            return {
                block: this.DATA_SOURCE_BLOCK,
                mods: {
                    mode: e
                }
            }
        },
        _updateDataModelMode: function(e, t) {
            return e && e.hasMod("mode", t.mods.mode) || (e && e.destruct(), e = BEM.create(t), e.on("ready", this._onReady, this).on("change", this._onChange, this).on("beforeload", this._onBeforeLoad, this)), e
        },
        _onReady: function() {
            this.trigger("ready")
        },
        _onChange: function() {
            this.trigger("change")
        },
        _onBeforeLoad: function() {
            this.trigger("beforeload")
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "bytime"
    }, {
        isTotalsAveragesEnabled: function() {
            return !1
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "pie"
    }, {
        isTotalsAveragesEnabled: function() {
            return !1
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "line-chart"
    }, {
        isTotalsAveragesEnabled: function() {
            return BEM.dataBindVal("data-table.rows.totals")
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "stacked-chart"
    }, {
        isTotalsAveragesEnabled: function() {
            return !1
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "bar-chart"
    }, {
        isTotalsAveragesEnabled: function() {
            return BEM.dataBindVal("data-table.rows.totals")
        }
    }), BEM.decl({
        name: "chart-data-model",
        modName: "chart-type",
        modVal: "map"
    }, {
        isTotalsAveragesEnabled: function() {
            return !1
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "mode",
        modVal: "single"
    }, {
        onElem: {
            "region-selector": function(e) {
                e.content({
                    block: "chart-region-selector",
                    mods: {
                        "data-bind": "report"
                    }
                })
            },
            "map-legend": function(e) {
                e.content({
                    block: "chart-map-legend"
                })
            }
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "mode",
        modVal: "single"
    }, {
        _getDataModelBlock: function() {
            return "chart-data-model-single"
        },
        _getEnabledChartTypes: function(e) {
            return BN("i-chart").enabledChartTypes(e.getMetricMeta(), e.getDimensionsMeta(), e.isOnePeriod(), !1, !0)
        },
        _onModelReady: function() {
            var e = this._dataModel;
            return this.setMod("dimensionless", e.getDimensionsMeta().length ? "" : "yes"), this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "chart-data-model-default",
        baseBlock: "chart-data-model"
    }, {
        dataBindings: {
            "data-table.colors.colors": {
                set: "_options.colors",
                initAccessor: "_options.colors"
            },
            "data-table.colors.totals": {
                set: "_options.totalsColor",
                initAccessor: "_options.totalsColor"
            },
            "data-table.percentage": {
                set: "_options.normalizedMetrics",
                initAccessor: "_options.normalizedMetrics"
            }
        },
        getColorsIndexes: function() {
            return this._options.colors
        },
        getTotalsColor: function() {
            return this._options.totalsColor
        },
        isNormalized: function() {
            var e = this.getMetricMeta().dim;
            return this._options.normalizedMetrics && -1 !== this._options.normalizedMetrics.indexOf(e)
        },
        _getDataSourceMode: function(e) {
            if (-1 !== ["pie", "bar-chart"].indexOf(e)) return "static";
            if (-1 !== ["line-chart", "stacked-chart"].indexOf(e)) return "dynamic";
            if (-1 !== ["map"].indexOf(e)) return "map";
            throw new Error("can not find out chart data-source mode")
        }
    }), BEM.decl({
        name: "chart-data-model-single",
        baseBlock: "chart-data-model-default"
    }, {
        DATA_SOURCE_BLOCK: "data-source-chart-single",
        setType: function(e) {
            var t = this._getDataSourceMode(e);
            this._dataModel = this._updateDataModelMode(this.getDataModel(), this._getDataSourceDecl(t))
        },
        getError: function() {
            return this.getDataModel().getError()
        },
        checkForNodata: function() {
            return this.getDataModel().checkForNodata() && (!this.isTotalsAveragesEnabled() || this.getDataModel().checkForNoTotals())
        },
        checkSomethingSelected: function() {
            return this.getDataModel().checkSomethingSelected() || this.isTotalsAveragesEnabled()
        },
        checkSelectableRowsPresent: function() {
            return this.getDataModel().checkSelectableRowsPresent()
        },
        getRows: function() {
            return this.getDataModel().getRows()
        },
        getDataModel: function() {
            return this._dataModel
        },
        isOnePeriod: function() {
            return this.getDataModel().isOnePeriod()
        },
        reload: function() {
            return this.getDataModel().reload()
        }
    }), BEM.decl({
        name: "data-source-chart",
        baseBlock: "data-source"
    }, {
        dataBindings: {
            counter: {
                set: "change"
            },
            quantile: {
                set: "change"
            },
            attribution: {
                set: "change"
            },
            "sampling.accuracy": {
                set: "change"
            },
            preset: {
                set: "change"
            },
            "data-table.metric": {
                set: "change"
            },
            "data-table.rows.rows": {
                set: "change"
            }
        },
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), BN("data-table").on("reload", this.reload, this), this._cleanCache()
            }
        },
        destruct: function() {
            return BEM.blocks["data-table"].un("reload", this.reload, this), this.__base.apply(this, arguments)
        },
        getSegmentName: function() {
            return ""
        },
        getDimensionsMeta: function() {
            return this._meta.getDimensionsMeta()
        },
        getMetrics: function() {
            return BEM.dataBindVal("data-table.metric")
        },
        getMetricMeta: function() {
            var e = this.getMetrics();
            return this._meta.getMetricsMeta().filter(function(t) {
                return t.dim === e
            }, this)[0]
        },
        isNegativeMetric: function() {
            return this.getMetricMeta().negative
        },
        getPeriod: function() {
            throw new Error("must be implemented in child/mod")
        },
        getGroup: function() {
            return this._getAutoGroup() || this._getGroup()
        },
        getPeriodGroups: function() {
            return BN("i-period").splitPeriodToGroups(this.getPeriod(), this._getGroup(), this._getAutoGroup(), this._getAutoGroupSize())
        },
        getMeta: function() {
            return this._meta
        },
        isOnePeriod: function() {
            return -1 !== ["auto", "minutes", "hours"].indexOf(this._getGroup()) ? !1 : 1 === this.getPeriodGroups().length
        },
        checkSomethingSelected: function() {
            var e = this._getRows();
            return this.checkSelectableRowsPresent() && e && e.length
        },
        checkSelectableRowsPresent: function() {
            var e = this._getRows();
            return e !== BN("i-data-table").NO_SELECTABLE_ROWS
        },
        checkForNodata: function() {
            var e = this.getData();
            return !e || !e.data || !e.data.length
        },
        checkForNoTotals: function() {
            var e = this.getData();
            return !e || !e.totals || void 0 === e.totals[0] || null === e.totals[0] || e.totals[0] instanceof Array && (!e.totals[0].length || e.totals[0].every(function(e) {
                return !e
            }))
        },
        getRows: function() {
            return this.checkSomethingSelected() ? this._getRows() : []
        },
        _getAutoGroupSize: function() {
            var e = this.getData();
            return e.query && e.query.auto_group_size
        },
        _getAutoGroup: function() {
            var e = this.getData();
            return e && e.query && e.query.auto_group_type
        },
        _getGroup: function() {
            throw new Error("Not implemented. Must be implemented in child/mod")
        },
        _getRows: function() {
            return BEM.dataBindVal("data-table.rows.rows")
        },
        _loadData: function(e) {
            return BN("i-report").loadData(e).then(function(e) {
                return this._cleanCache(), e = jQuery.extend(!0, {}, e)
            }.bind(this))
        },
        _getOptions: function() {
            return Vow.all([BN("i-report").getChartMetadata(), BN("i-counters").getAsync()]).spread(function(e, t) {
                return this._meta = e, {
                    ids: t.getApiCounterId(),
                    accuracy: BEM.dataBindVal("sampling.accuracy"),
                    quantile: BEM.dataBindVal("quantile"),
                    attribution: BEM.dataBindVal("attribution"),
                    goalId: BEM.dataBindVal("preset.goal"),
                    metrics: this.getMetrics(),
                    dimensions: e.getDimensions()
                }
            }.bind(this))
        },
        _extractOnlyRequiredMetric: function(e) {
            return BN("i-report").getChartMetadata().then(function(t) {
                var i = this.getMetricMeta().dim,
                    n = t.getMetrics().reduce(function(e, t, n) {
                        return i === t ? n : e
                    }, 0);
                return e.data = jQuery.extend(!0, [], e.data.map(function(e) {
                    return e.metrics = [e.metrics[n]], e
                })), e.totals = [(e.totals || [])[n] || 0], e
            }.bind(this))
        },
        _cleanCache: function() {
            this._cachedYMax = null, this._cachedTotalsMax = null, this._data = null
        }
    }), BEM.decl({
        name: "data-source-chart-single",
        baseBlock: "data-source-chart"
    }, {
        dataBindings: {
            "report.period": {
                set: "change"
            },
            "report.filter": {
                set: "change"
            },
            "data-table.metricFilters": {
                set: "change"
            },
            "report.group": {
                set: "change"
            }
        },
        getPeriod: function() {
            return BEM.dataBindVal("report.period")
        },
        getMinMax: function() {
            var e = this._data && this._data.min && this._data.max;
            return e && {
                min: this._data.min,
                max: this._data.max
            }
        },
        _getGroup: function() {
            return BEM.dataBindVal("report.group")
        },
        _getOptions: function() {
            return Vow.all([this.__base.call(this), BN("i-report").getChartMetadata()]).spread(function(e, t) {
                var i = BN("i-filter");
                return e.period = this.getPeriod(), e.filter = i.conjunctionJoinFilters(i.buildFilter(this._getFilters(), t.getSegmentsTree()), i.buildDimensionFilter(BEM.dataBindVal("data-table.dimensionFilter"), t)), e
            }.bind(this))
        },
        _getFilters: function() {
            return jQuery.extend(BEM.dataBindVal("report.filter"), BEM.dataBindVal("data-table.metricFilters"))
        }
    }), BEM.decl({
        name: "data-source-chart-single",
        modName: "mode",
        modVal: "static"
    }, {
        _loadData: function() {
            return this._loadDataStatic.apply(this, arguments).then(this._extractOnlyRequiredMetric.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart",
        modName: "mode",
        modVal: "static"
    }, {
        _loadDataStatic: function() {
            var e = BN("data-table-data-model").get();
            return this._cleanCache(), e.getError() ? Vow.reject(e.getError()) : Vow.promise(jQuery.extend(!0, {}, {
                totals: e.getTotals(),
                data: e.getRowsByIds(this.getRows()),
                query: e.getQuery()
            }))
        }
    }), BEM.decl("data-table-data-model", {
        onSetMod: {
            js: function() {
                this._root = {
                    children: {}
                }, this.getError() || this.appendRows(null, this.params.data.data)
            }
        },
        appendRows: function(e, t) {
            t.forEach(function(t) {
                this._getNode(this._getApiRowId(t, e)).data = t
            }, this)
        },
        setError: function(e) {
            this.params.error = e
        },
        markSensitive: function() {
            this.params.data.contains_sensitive_data = !0
        },
        isSensitive: function() {
            return this.params.data.contains_sensitive_data
        },
        getError: function() {
            return this.params.error
        },
        getTotals: function() {
            return this.params.data.totals
        },
        getQuery: function() {
            return this.params.data.query
        },
        getMax: function() {
            return this.params.data.max
        },
        getRowsByIds: function(e) {
            return e.map(function(e) {
                return this._getNode(e).data
            }, this)
        },
        isEmpty: function() {
            var e = this.params.data.data;
            return !e || !e.length
        },
        _getNode: function(e, t) {
            return (e || []).reduce(function(e, t) {
                return e.children[t] = e.children[t] || {
                    children: {}
                }
            }, t || this._root)
        },
        _getApiRowId: function(e, t) {
            var i = e.dimensions || [e.dimension];
            return (t || []).concat(i.map(function(e) {
                return void 0 === e.id ? e.name : e.id
            }))
        }
    }, {
        get: function() {
            return this._instance
        },
        create: function(e, t) {
            return this._instance && this._instance.destruct(), this._instance = BEM.create({
                block: "data-table-data-model"
            }, {
                data: e,
                error: t
            }), this._instance
        }
    }), BEM.decl({
        name: "data-source-chart-single",
        modName: "mode",
        modVal: "dynamic"
    }, {
        _getOptions: function() {
            return this.__base.call(this).then(function(e) {
                return e.mode = "dynamics", e.group = this._getGroup(), e["row-ids"] = this.getRows(), e
            }.bind(this))
        },
        _getFilters: function() {
            return BEM.dataBindVal("report.filter")
        }
    }), BEM.decl({
        name: "data-source-chart-single",
        modName: "mode",
        modVal: "bytime"
    }, {
        _getOptions: function() {
            return this.__base.call(this).then(function(e) {
                return delete e.dimensions, e.mode = "dynamics", e.group = this._getGroup(), e
            }.bind(this))
        },
        _getFilters: function() {
            return BEM.dataBindVal("report.filter")
        }
    }), BEM.decl({
        name: "data-source-chart",
        modName: "mode",
        modVal: "bytime"
    }, {
        _reload: function(e, t) {
            return t = jQuery.extend(!0, {}, t), t.sort = void 0, jQuery.equals(t, this._lastOpts) ? (this._triggerReady(), !1) : (this._lastOpts = t, this.__base.apply(this, arguments))
        },
        checkSomethingSelected: function() {
            return !0
        }
    }), BEM.decl({
        name: "data-source-chart-single",
        modName: "mode",
        modVal: "map"
    }, {
        dataBindings: {
            "report.region": {
                set: "change"
            },
            "data-table.rows.rows": {
                set: ""
            }
        },
        _reloadOnDataBindings: !1,
        _reload: function() {
            this._reloadOnDataBindings = !0, BN("data-table").un("reload", this.reload, this), this.__base.apply(this, arguments)
        },
        _change: function() {
            this.__base.apply(this, arguments), this._reloadOnDataBindings && this.reload()
        },
        checkSomethingSelected: function() {
            return !0
        },
        _getRegion: function() {
            return BEM.dataBindVal("report.region")
        },
        _getOptions: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                var t = this.getMeta().getGeoDimensions(),
                    i = this._getRegion();
                return e.mode = "list", e.limit = 1e4, e.dimensions = [i.id ? t.area : t.country], i.id && (e.filter = BN("i-filter").conjunctionJoinFilters(e.filter, BN("i-filter").concatFilter(t.country, "==", i.id))), e
            }.bind(this))
        },
        _loadData: function() {
            var e = this._getRegion();
            return Vow.all([this.__base.apply(this, arguments), BN("ymaps").loadRegions(e.isoName)]).spread(function(t, i) {
                return t._coords = i, t._region = e, t
            })
        }
    }), BEM.decl({
        name: "chart-data-model-single",
        modName: "type",
        modVal: "bytime"
    }, {
        _getDataSourceMode: function() {
            return "bytime"
        }
    }), BEM.JSON.decl("chart-region-selector", {
        onBlock: function(e) {
            var t = e.param("region");
            e.js({
                region: t
            }).content({
                block: "radio-button",
                mods: {
                    size: "s",
                    pseudo: "yes"
                },
                name: "chart-regions-radio",
                value: t.isoName,
                content: BN("ymaps").getKnownRegions().map(function(e) {
                    return {
                        elem: "radio",
                        elemMods: {
                            selected: e === t.isoName ? "yes" : void 0
                        },
                        controlAttrs: {
                            value: e,
                            autocomplete: "off"
                        },
                        content: BEM.I18N("chart-region-selector", "type-" + e)
                    }
                })
            })
        }
    }), BEM.JSON.decl("chart-region-selector", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                var i = t.getParamsModel().getState();
                e.param("region", i.region)
            }))
        }
    }), BEM.DOM.decl("chart-region-selector", {
        onSetMod: {
            js: function() {
                this._radio = this.findBlockInside("radio-button"), this._radio.on("change", this._publishChanges, this)
            }
        },
        destruct: function() {
            this._radio.un("change", this._publishChanges, this)
        },
        get: function() {
            return BN("ymaps").getRegion(this._radio.val())
        },
        _publishChanges: function() {
            this.trigger("change", this.get())
        }
    }), BEM.DOM.decl({
        block: "chart-region-selector",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.region": {
                get: "get",
                event: "change"
            }
        }
    }), BEM.JSON.decl("chart-map-legend", {
        onBlock: function(e) {
            var t = [1, .75, .5, .25, 0],
                i = t.slice(1, t.length - 1),
                n = 2,
                o = [{
                    elem: "gradient"
                }, i.map(function(e) {
                    var t = 100 * e;
                    return {
                        elem: "delimiter",
                        attrs: {
                            style: "bottom: " + t + "%"
                        }
                    }
                }), {
                    elem: "label-container",
                    content: t.map(function(e) {
                        var t = 100 * e;
                        return {
                            elem: "label",
                            mods: {
                                idx: t
                            },
                            attrs: {
                                style: "bottom: " + t + "%"
                            }
                        }
                    })
                }];
            e.js({
                points: t,
                averagePoint: t[n]
            }).content(o)
        }
    }), BEM.DOM.decl("chart-map-legend", {
        onSetMod: {
            js: function() {
                BN("data-source-chart-single").on("ready", this._update, this).on("change beforeload", this._onChange, this)
            }
        },
        destruct: function() {
            BN("data-source-chart-single").un("ready", this._update, this).un("change beforeload", this._onChange, this), this.__base.apply(this, arguments)
        },
        _onChange: function() {
            this._setVisibility(!1)
        },
        _update: function(e, t) {
            var i, n, o, s, r = t.getMinMax(),
                a = t.getMetricMeta().type;
            r && (i = r.min[0], n = r.max[0], s = 1 / BN("i-colorpool").getPow(t.getData().data.map(function(e) {
                return e.metrics[0]
            }), i, n), o = r.max[0] - i, this._setReverseMod(t.isNegativeMetric()), this.params.points.forEach(function(e, t, r) {
                var l = Math.pow(e, s),
                    c = Math.pow(r[t + 1], s),
                    d = Math.round(o * l) + i,
                    u = Math.round(o * c) + i,
                    h = BN("humanize").format(a, d);
                i === n && e !== this.params.averagePoint && (h = ""), d === u && (h = ""), this.elem("label", "idx", String(100 * e)).html(h)
            }, this), this._setVisibility(!0))
        },
        _setVisibility: function(e) {
            this.setMod("visible", e ? "yes" : "")
        },
        _setReverseMod: function(e) {
            this.setMod("reverse", e ? "yes" : "")
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "bytime",
        modVal: "yes"
    }, {
        onElem: {
            types: function(e) {
                e.remove()
            }
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "bytime",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.param("chartType", "bar-chart"), e.param("enabledChartTypes", BN("i-chart").chartTypes)
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "bytime",
        modVal: "yes"
    }, {
        _getChartBlockName: function() {
            return {
                adapter: "report-chart-bytime",
                adapterMode: this.getMod("mode")
            }
        },
        _getDataModelMods: function() {
            return {
                "chart-type": "bytime",
                type: "bytime"
            }
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "minutely",
        modVal: "yes"
    }, {
        onElem: {
            types: function(e) {
                e.remove()
            }
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "minutely",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.param("chartType", "line-chart"), e.param("enabledChartTypes", BN("i-chart").chartTypes)
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "minutely",
        modVal: "yes"
    }, {
        _getChartBlockName: function() {
            return {
                adapter: "report-chart-minutely",
                adapterMode: this.getMod("mode")
            }
        },
        _getDataModelMods: function() {
            return {
                "chart-type": "bytime",
                type: "bytime"
            }
        }
    }), BEM.DOM.decl({
        name: "chart-report",
        modName: "chart-type",
        modVal: "map"
    }, {
        _replaceChart: function(e) {
            var t = this._getChartBlockName();
            return this._chartAdapter && this._chartAdapter.destruct(), this._chartAdapter = BEM.create({
                block: t.adapter,
                mods: {
                    mode: t.adapterMode,
                    phantom: "yes"
                }
            }), this._chartBlock.setAdapter(this._chartAdapter, !0), this._chartAdapter.draw(e)
        }
    }), BEM.JSON.decl("segments-wrapper", {
        onBlock: function(e) {
            e.content([{
                block: "save-segment-form",
                mods: {
                    "data-bind": "report"
                },
                defaultTitle: BEM.I18N("segments-wrapper", "new-filter-title")
            }, {
                elem: "toolbar",
                content: {
                    block: "segments-list",
                    mix: {
                        block: "segments-wrapper",
                        elem: "segments-list"
                    },
                    mods: {
                        "data-bind": "report",
                        type: "primary",
                        data: "report"
                    }
                }
            }])
        }
    }), BEM.JSON.decl("save-segment-form", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.filter,
                n = t.segment,
                o = n && n.name || t.defaultTitle,
                s = n ? "saved" : "new",
                r = t.isEditable;
            e.mod("editable", r ? "yes" : "no"), n && BN("i-filter").changedFilters(n.segment, i).length && (n = null), e.mix({
                block: "error-message",
                mods: {
                    type: "popup"
                }
            }).js({
                segment: n,
                defaultTitle: t.defaultTitle
            }).mods({
                state: s,
                "read-only": n && "predefined" === n.type ? "yes" : "",
                empty: BN("i-filter").isFiltersListEmpty(i) ? "yes" : "no"
            }), e.content({
                elem: "block-template",
                title: o,
                state: s,
                isEditable: r
            })
        },
        onElem: {
            "block-template": function(e) {
                var t = e.params(),
                    i = t.isEditable ? "" : "yes";
                e.wrap([{
                    elem: "rename-button",
                    mods: {
                        disabled: i
                    }
                }, {
                    block: "input",
                    mods: {
                        size: "s",
                        disabled: i
                    },
                    content: [{
                        elem: "hint",
                        content: BEM.I18N("save-segment-form", "input-hint")
                    }, {
                        elem: "control",
                        attrs: {
                            value: t.title
                        }
                    }]
                }, {
                    elem: "line-hint"
                }, {
                    elem: "title",
                    tag: "span",
                    mix: {
                        block: "hint-hover",
                        js: {
                            useMaxWidth: !0
                        }
                    },
                    content: BN("i-string").escapeHTML(t.title)
                }, {
                    elem: "commit-button",
                    mods: {
                        disabled: i
                    }
                }, {
                    block: "spin2",
                    mix: {
                        block: "save-segment-form",
                        elem: "save-spinner"
                    },
                    mods: {
                        size: "xxs",
                        progress: "yes"
                    }
                }, {
                    block: "label-tag",
                    mods: {
                        removable: "yes",
                        status: "none"
                    }
                }, {
                    elem: "save-as-button",
                    mods: {
                        disabled: i
                    },
                    state: t.state
                }])
            },
            "save-as-button": function(e) {
                e.wrap([{
                    block: "button",
                    mods: {
                        size: "s",
                        focus: "no",
                        disabled: e.mod("disabled")
                    },
                    content: BEM.I18N("save-segment-form", "new" === e.param("state") ? "save" : "save-as"),
                    mix: [{
                        block: "save-segment-form",
                        elem: "save-as-button"
                    }]
                }])
            },
            "commit-button": function(e) {
                e.wrap([{
                    block: "button",
                    mods: {
                        size: "s",
                        focus: "no",
                        disabled: e.mod("disabled")
                    },
                    content: BEM.I18N("save-segment-form", "save"),
                    mix: [{
                        block: "save-segment-form",
                        elem: "commit-button"
                    }]
                }])
            },
            "rename-button": function(e) {
                e.wrap([{
                    block: "button",
                    mods: {
                        size: "s",
                        "only-icon": "yes",
                        pseudo: "yes",
                        disabled: e.mod("disabled")
                    },
                    attrs: {
                        title: BEM.I18N("save-segment-form", "rename")
                    },
                    content: {
                        block: "icon",
                        elem: "rename"
                    },
                    mix: [{
                        block: "save-segment-form",
                        elem: "rename-button"
                    }]
                }])
            }
        }
    }), BEM.JSON.decl("save-segment-form", {
        onBlock: function(e) {
            e.defer(BN("i-counters").getAsync().then(function(t) {
                e.param("isEditable", t.isSingle() && t.isEditable())
            }))
        }
    }), BEM.DOM.decl("save-segment-form", {
        EMPTY_SEGMENT: {
            id: null,
            name: null,
            segment: null,
            type: null
        },
        onSetMod: {
            js: function() {
                this._title = this.elem("title"), this._segment = this.params.segment || {}
            }
        },
        _setTitle: function(e) {
            var t = e || this.params.defaultTitle;
            BEM.DOM.update(this._title, BN("i-string").escapeHTML(t))
        },
        _update: function(e) {
            var t = this,
                i = Vow.fulfill();
            e.segment && e.segment.id !== this._segment.id && (i = this._setSegmentById(e.segment.id)), jQuery.equals(e.filter, this._filter) || (this._setFilter(e.filter), BN("i-filter").isFiltersListEmpty(e.filter) && this._clearSegment(), this._updateState()), i.always(function() {
                t.trigger("change")
            }).done()
        },
        _setSegmentById: function(e) {
            var t = this;
            return e ? BN("i-segments").getSegmentById(e).always(function(e) {
                var i = e.valueOf();
                e.isFulfilled() ? (t._setSegment(i), t._setFilter(i.segment)) : t._clearSegment(), t._updateState()
            }) : (this._clearSegment(), Vow.fulfill())
        },
        _setSegment: function(e) {
            this._segment = e, this._setTitle(e.name)
        },
        _setFilter: function(e) {
            this._filter = e, this.setMod("empty", BN("i-filter").isFiltersListEmpty(this._filter) ? "yes" : "no")
        },
        _clearSegment: function() {
            this._setSegment(this.EMPTY_SEGMENT)
        },
        _getSegment: function() {
            return this._segment
        }
    }), BEM.DOM.decl({
        name: "save-segment-form",
        modName: "editable",
        modVal: "yes"
    }, {
        TAG_HIDE_TIMEOUT: 8,
        onSetMod: {
            js: function() {
                this.__base.call(this), this._renameButton = this.findBlockOn(this.elem("rename-button"), "button"), this._saveAsButton = this.findBlockOn(this.elem("save-as-button"), "button"), this._commitButton = this.findBlockOn(this.elem("commit-button"), "button"), this._statusTag = this.findBlockInside("label-tag"), this._input = this.findBlockInside("input"), this._renameButton.on("click", this._onSaveRenameClick.bind(this, !1)), this._saveAsButton.on("click", this._onSaveRenameClick.bind(this, !0)), this._commitButton.on("click", this._onCommitClick.bind(this)), this._input.on("change", function() {
                    var e = this._input.val().trim();
                    this._commitButton.setMod("disabled", e ? "" : "yes")
                }.bind(this)), this._input.elem("control").on("keyup", function(e) {
                    13 === e.keyCode && this._onCommitClick()
                }.bind(this)), this.bindToDoc("click", function(e) {
                    this._isDestructing || this._isBlockControlsClick(e) || (this._clone = !1, this._backFromEditing())
                }.bind(this))
            },
            state: function(e, t) {
                switch (t) {
                    case "new":
                        BEM.DOM.update(this._saveAsButton.elem("text"), BEM.I18N("save-segment-form", "save"));
                        break;
                    case "editing":
                        BEM.DOM.update(this._commitButton.elem("text"), BEM.I18N("save-segment-form", this._clone ? "confirm" : "rename")), this._input.setMod("focused", "yes");
                        break;
                    case "saved":
                        BEM.DOM.update(this._saveAsButton.elem("text"), BEM.I18N("save-segment-form", "save-as"));
                        break;
                    case "changed":
                        BEM.DOM.update(this._commitButton.elem("text"), BEM.I18N("save-segment-form", "save"))
                }
            }
        },
        _isBlockControlsClick: function(e) {
            var t = jQuery(e.target);
            return this._saveAsButton.containsDomElem(t) || this._renameButton.containsDomElem(t) || this._commitButton.containsDomElem(t) || this._input.containsDomElem(t)
        },
        _backFromEditing: function() {
            this.hasMod("state", "editing") && (this._setTitle(this._segment.name), this._updateState())
        },
        _updateState: function() {
            var e = this._segment,
                t = "new";
            e.id && e.name && (this._isChanged = !jQuery.equals(e.segment, this._filter), t = this._isChanged ? "changed" : "saved"), this.setMod("state", t), this.setMod("read-only", "predefined" === e.type ? "yes" : "no")
        },
        _onSaveRenameClick: function(e) {
            this._clone = e, this._clone && "new" !== this.getMod("state") && this._input.val(BEM.I18N("save-segment-form", "copy-label") + " " + this._input.val()), this.setMod("state", "editing")
        },
        _onCommitClick: function() {
            var e = this._input.val().trim();
            if (e && this._filter && !this.hasMod("empty", "yes")) {
                if (!this._clone && !this._isChanged && e === this._segment.name) return void this._backFromEditing();
                this._save(e), this._clone = !1
            }
        },
        _save: function(e) {
            var t, i = {
                    name: e,
                    segment: this._filter
                },
                n = this._segment;
            this.setMod("saving", "yes"), -1 !== [null, void 0].indexOf(n.id) || "predefined" === n.type || this._clone ? t = BN("i-user-segments").add(i) : (t = BN("i-user-segments").update(n.id, i), i.id = n.id), t.then(function(e) {
                return e.error ? Vow.reject(e.error) : (e.id && (i.id = e.id), this._setSegment(i), this._updateState(), this.trigger("change"), i)
            }.bind(this)).always(function(e) {
                var t = e.isRejected() ? BN("i-error-message").getResponseText(e.valueOf()) : "";
                this.delMod("saving"), this._showTag(t)
            }.bind(this))
        },
        _showTag: function(e) {
            this._statusTag.setText(e || BEM.I18N("save-segment-form", "confirm")), this._statusTag.setMod("status", e ? "error" : "ok"), e || this._statusTag.autoHide(this.TAG_HIDE_TIMEOUT)
        },
        _setTitle: function(e) {
            this.__base.apply(this, arguments), this._input.val(e || this.params.defaultTitle)
        }
    }), BN("i-segments-params").genDecl({
        name: "save-segment-form",
        modName: "data-bind",
        modVal: "report"
    }, ["segment", "filter"]), BEM.DOM.decl({
        block: "save-segment-form",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                initAccessor: "_filter"
            },
            "report.segment": {
                initAccessor: "_getSegment",
                event: "change",
                get: "_getSegment"
            },
            report: {
                set: "_update"
            }
        }
    }), BEM.DOM.decl({
        name: "segments-list",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                event: "change",
                set: "update"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-list",
        modName: "type",
        modVal: "primary"
    }, ["filter"]), BEM.JSON.decl("data-table", {
        onBlock: function(e) {
            var t, i = e.params(),
                n = i.meta,
                o = e.mods() || {},
                s = n.getReport();
            i.options.percentagesMetrics = i.options.percentagesMetrics || [], i.options.metric = i.options.metric || n.getMetrics()[0], t = i.options.metric, e.js(i.options).mix([{
                block: "render-ready",
                js: {
                    block: "data-table"
                }
            }, {
                block: "error-message",
                mods: {
                    theme: "light"
                }
            }]), n.getMetrics().forEach(function(t) {
                var n = BEM.toModVal(t); - 1 !== i.options.percentagesMetrics.indexOf(t) && (o["metric" + n] = "relative", e.mods(o))
            }), o.mode = i.options.mode, o["totals-checkable"] = "yes", s.areTableRowsSelectable() && (o.selectable = "yes"), s.hasFilter() && (o.filtrable = "yes"), e.mods(o, !0).content([{
                elem: "style",
                metrics: n.getMetricsMeta()
            }, {
                elem: "table",
                tag: "table",
                content: [{
                    elem: "thead",
                    sort: i.options.sort,
                    selectedMetric: t,
                    percentagesMetrics: i.options.percentagesMetrics || [],
                    metricFilters: i.options.metricFilters,
                    dimensionMode: i.options.mode,
                    dimensionFilter: i.options.dimensionFilter,
                    meta: n,
                    selectable: "yes" === o.selectable,
                    filtrable: "yes" === o.filtrable
                }, {
                    elem: "tbody",
                    tag: "tbody"
                }]
            }, {
                elem: "data-lag"
            }])
        },
        onElem: {
            style: function(e) {
                e.wrap([{
                    tag: "style",
                    attrs: {
                        type: "text/css"
                    },
                    content: e.param("metrics").map(function(e) {
                        var t = BEM.toModVal(e.dim);
                        return [".data-table__metric" + t + "_type_relative {display: none;}", ".data-table_metric" + t + "_relative .data-table__metric" + t + "_type_absolute {display: none;}", ".data-table_metric" + t + "_relative .data-table__metric" + t + "_type_relative {display: inline;}"].join("\n")
                    }, this).join("\n")
                }])
            },
            rows: function(e) {
                var t = e.params(),
                    i = t.data,
                    n = t.offset,
                    o = t.parentId,
                    s = t.parentRows,
                    r = t.dimensionMode,
                    a = t.formatters,
                    l = t.fullTotals,
                    c = t.fullMax,
                    d = t.group,
                    u = [],
                    h = e.blockMods(),
                    m = t.disableable !== !1 ? !0 : !1;
                a = a || BN("i-data-table").getDataFormatters(["dimension", "metric", "table", "table-dimension", "table-metric"], i, {
                    mode: r,
                    group: d
                }), u = u.concat(i.data.map(function(e) {
                    var i;
                    return i = "tree" === r ? s.concat([e.dimension.id || e.dimension.name]) : e.dimensions.map(function(e) {
                        return e.id || e.name
                    }), {
                        block: "data-table",
                        blockMods: h,
                        elem: "row",
                        mods: {
                            parent: o,
                            disabled: m && t.disabled ? "yes" : "",
                            disableable: m ? "yes" : ""
                        },
                        formatters: a,
                        mode: r,
                        data: e,
                        level: s.length,
                        parents: i,
                        totals: l,
                        max: c
                    }
                })), n + i.data.length < i.total_rows && u.push({
                    block: "data-table",
                    blockMods: h,
                    elem: "more-row",
                    mods: {
                        subtree: s.length ? "yes" : "no",
                        level: s.length,
                        parent: o
                    },
                    rendered: n + i.data.length,
                    total: i.total_rows,
                    parentId: o,
                    parentRows: s
                }), e.wrap([u])
            },
            row: function(e) {
                var t, i = e.param("data"),
                    n = e.param("mode"),
                    o = e.param("parents"),
                    s = e.param("level"),
                    r = e.param("formatters"),
                    a = [],
                    l = e.mods() || {};
                BN("i-data-table").getDataColumns(i, {
                    level: s,
                    rowId: o,
                    max: e.param("max"),
                    totals: e.param("totals"),
                    disabled: l.disabled
                }).forEach(function(e, t) {
                    a.push(BN("formatter").runFormatters(r[t], e))
                }.bind(this)), t = {
                    data: i
                }, "tree" === n && (t.id = jQuery.identify(), t.parents = o, e.mod("expanded", "no"), i.expand || e.mod("expandable", "no")), e.tag("tr").mod("hash", BEM.toModVal(i.hash)).js(t).content(a)
            },
            cell: function(e) {
                e.tag("td")
            },
            "totals-row": function(e) {
                var t = e.param("data"),
                    i = e.param("checked");
                e.tag("tr").content(BN("i-data-table").getTotalColumns(t, i).map(function(t) {
                    return BN("formatter").run(e.param("namespaces") || ["metric", "table", "table-total-common", "table-total"], t)
                }))
            },
            "more-row": function(e) {
                e.tag("tr").content({
                    elem: "more-cell",
                    tag: "td",
                    attrs: {
                        colspan: 100
                    },
                    content: [{
                        block: "button",
                        mix: [{
                            block: "data-table",
                            elem: "more-button"
                        }],
                        mods: {
                            size: "yes" === e.mod("subtree") ? "xs" : "l",
                            pseudo: "yes"
                        },
                        content: BEM.I18N("data-table", "show-more"),
                        js: {
                            offset: e.param("rendered"),
                            parentId: e.param("parentId"),
                            parentRows: e.param("parentRows")
                        }
                    }, {
                        elem: "show-more-status",
                        content: BEM.I18N("data-table", "already-shown", {
                            rendered: e.param("rendered"),
                            total: e.param("total")
                        })
                    }]
                })
            },
            "loading-row": function(e) {
                e.tag("tr").content({
                    elem: "loading-cell",
                    tag: "td",
                    attrs: {
                        colspan: 100
                    },
                    content: [{
                        block: "spin2",
                        mix: {
                            block: "data-table",
                            elem: "loading-spin"
                        },
                        mods: {
                            size: "xxs",
                            progress: "yes"
                        }
                    }, BEM.I18N("data-table", "loading")]
                })
            },
            "empty-row": function(e) {
                e.tag("tr").content({
                    elem: "empty-cell",
                    tag: "td",
                    attrs: {
                        colspan: 100
                    },
                    content: BEM.I18N("data-table", "no-data")
                })
            },
            "percent-line": function(e) {
                e.content({
                    elem: "percent-line-i",
                    attrs: {
                        style: "width: " + Math.round(100 * Math.min(e.param("value"), 1)) + "%;"
                    }
                })
            },
            "affinity-line": function(e) {
                var t = e.param("value");
                e.content([{
                    elem: "affinity-negative-substrate"
                }, {
                    elem: "affinity-positive-substrate"
                }, {
                    elem: "affinity-indicator",
                    attrs: {
                        style: "width: " + Math.round(50 * Math.min(t, 1)) + "%;"
                    }
                }])
            },
            "dimension-wrapper": function(e) {
                var t = e.params().cell;
                e.content([t.expander, t.content, t.additional])
            },
            "append-additional": function(e) {
                var t = e.params(),
                    i = BN("i-data-table").getAdditionalFields(t.fields);
                i.length ? e.tag("span").content(i.map(function(e) {
                    return ["&nbsp;", {
                        block: "dimension-field",
                        mods: {
                            type: BEM.toModVal(e)
                        },
                        field: t.fields[e],
                        value: t.data[e]
                    }]
                })) : e.remove()
            },
            "dimension-item": function(e) {
                var t, i = e.params(),
                    n = i.formatters,
                    o = i.fields,
                    s = i.data,
                    r = [];
                s.icon_id && o.icon_id && r.push({
                    block: "icon",
                    elem: s.icon_type,
                    mods: {
                        id: s.icon_id
                    },
                    attrs: {
                        title: BN("i-content").escapeHTML(s.name)
                    },
                    mix: [{
                        block: "data-table",
                        elem: "dimension-icon"
                    }]
                }), s.favicon && r.push({
                    block: "icon",
                    mods: {
                        type: "favicon"
                    },
                    mix: [{
                        block: "data-table",
                        elem: "dimension-icon"
                    }],
                    domain: s.favicon
                }), t = BN("i-string").escapeBemJson(s.name), t = t ? BN("formatter").runFormatters(n.name, {
                    raw: s,
                    value: t,
                    id: s.id,
                    originValue: t
                }) : BEM.I18N("data-table", "undefined"), r.push(t), e.tag("span").content(r)
            },
            expander: function(e) {
                e.content({
                    block: "spin2",
                    mix: {
                        block: "data-table",
                        elem: "expander-spin"
                    },
                    mods: {
                        size: "xxs"
                    }
                })
            }
        }
    }), BEM.JSON.decl("data-table", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-report").getReportOptions(), BN("i-report").getMetadata()]).spread(function(t, i) {
                var n = e.params(),
                    o = BN("i-router").getParams(),
                    s = BN("i-data-table"),
                    r = s.parseSelectedRows(o.selected_rows);
                n.options = t, n.options.rowsLimit = s.parseRowsLimit(o.rows_limit), n.options.selectedRows = r.rows, n.options.totalsChecked = r.totals, n.meta = i, n.options.period = void 0, n.options.comparePeriod = void 0
            }))
        }
    }), BEM.DOM.decl("data-table", {
        dataBindings: {
            "data-table.metric": {
                initAccessor: "params.metric",
                set: "_setMetric"
            },
            "data-table.percentage": {
                set: "_setPercentagesMetrics"
            },
            "data-table.sort": {
                set: "_setSortDirection"
            },
            "data-table.metricFilters": {
                set: "_setMetricFilters"
            },
            "data-table.dimensionFilter": {
                initAccessor: "params.dimensionFilter"
            },
            "data-table.rowsLimit": {
                initAccessor: "params.rowsLimit"
            },
            "data-table.dimensionMode": {
                set: "_setDimensionMode"
            },
            "data-table.totalsChecked": {
                initAccessor: "_options.totalsChecked"
            },
            quantile: {
                set: "_updateQuantile"
            },
            preset: {
                set: "_onPresetChange"
            },
            "sampling.accuracy": {
                set: "_setSamplingAccuracy",
                event: "sampling-accuracy-changed"
            },
            attribution: {
                set: "_updateAttribution"
            },
            confidence: {
                set: "_updateConfidence"
            },
            "data-table.rows.rows": {},
            "data-table.rows.totals": {},
            "data-table.colors.colors": {},
            "data-table.colors.totals": {},
            "data-table.selectedRows": {},
            "chartType.actual": {
                set: "_handleChartTypeChange",
                initAccessor: "_handleChartTypeChange"
            }
        },
        MAX_ROWS_LIMIT: 500,
        MAX_CHECKED_ROWS: 30,
        TOTALS_COLOR: "#4c4c4c",
        GATEWAY_TIMEOUT_MESSAGE: "ERR_GATEWAY_TIMEOUT",
        onSetMod: {
            js: function() {
                var e = this;
                this._options = this.params, this._options.quantile = this.dataBindVal("quantile"), this._colorPool = BN("i-colorpool").create(), this._colorTable = {}, this._leftCheckedRows = this.MAX_CHECKED_ROWS, this._changeModeBlock = this.findBlockInside("thead-change-mode-buttons", "radio-button"), this._changeModeBlock && this._changeModeBlock.on("change", this._onChangeDimensionsMode, this), this._searchInput = this.findBlockInside(this.elem("dim-filter"), "search-input"), this._searchInput && this._searchInput.on("search", this._onDimensionSearch.bind(this)), this._triggerChanges = jQuery.debounce(this._triggerChanges, 50, this), BEM.blocks["check-button"].liveCtxBind(this.elem("head-button", "action", "percent"), "change", this._onHeadPercentClick, this), this.bindTo(this.elem("header", "sortable", "yes"), "click", this._onHeaderSortClick), BN("i-report").getReport().then(function(e) {
                    var t = e.getParamsModel().getState();
                    this._options.period = this._options.period || t.period, this._options.comparePeriod = this._options.comparePeriod || t.comparePeriod
                }.bind(this)).then(this.reload.bind(this)).then(function() {
                    e._graphButton = e.findBlockOn(e.elem("head-button", "action", "graph"), "radio-button"), e._graphButton && e._graphButton.on("change", e._onHeadGraphClick, e)
                }).done()
            }
        },
        onElemSetMod: {
            row: {
                expanded: function(e, t, i) {
                    var n, o, s = {
                        yes: "show",
                        no: "hide"
                    }[i];
                    s && (n = this.elemParams(e).id, o = this.findElem("row", "parent", n), "no" === i && this.setMod(o, "expanded", "no"), o[s](), this.findElem("more-row", "parent", n)[s]())
                },
                "inlying-checked": function(e, t, i) {
                    this.findBlockInside(e, "checkbox").setMod("fake-checked", i)
                },
                disabled: function(e, t, i) {
                    var n = this.findBlockInside(e, "checkbox");
                    n && n.setMod(t, i)
                }
            }
        },
        destruct: function() {
            BN("data-lag-notification").setLag(0), BN("sensitive-data-warning").hide(), BN("missing-attribute-data-notification").hide(), BN("direct-expenses-notification").hide(), BN("direct-sampling-notification").hide(), BN("direct-clientid-notification").hide(), this.__base.apply(this, arguments)
        },
        reload: function(e) {
            this.setMod("state", "loading");
            var t = this,
                i = t.elem("tbody"),
                n = this.findElem("totals-row"),
                o = this._createLoadingRow();
            return e && (this._options = jQuery.extend(this._options, e)), this._colorPool.reset(), this._load({
                limit: Math.min(this._options.rowsLimit, this.MAX_ROWS_LIMIT)
            }, function(e) {
                if (BEM.DOM.destruct(n), e) {
                    BEM.DOM.update(i, e.rows), t._checkRows(t._options.selectedRows, !0);
                    var s = this.findElem("totals-row");
                    s.length ? BEM.DOM.replace(s, e.total) : BEM.DOM.append(this.findElem("thead"), e.total), t._options.totalsChecked = t._options.totalsChecked && t._options.dimensions.length > 0, t._toggleTotalsCheckbox(t._options.totalsChecked)
                } else BEM.DOM.update(i, t._getEmptyHtml());
                t._destroyLoadingRow(o), t.setMod("state", "ready"), t.trigger("renderReady")
            }).always(BN("i-promise").intercept(this, this._triggerChanges))
        },
        _getEmptyHtml: function(e) {
            return BN("i-content").html(jQuery.extend(!0, {
                block: "data-table",
                mods: this.getInitialMods(),
                elem: "empty-row"
            }, e), !0)
        },
        _checkRows: function(e, t) {
            var i = this;
            this._leftCheckedRows = this.MAX_CHECKED_ROWS, e = e || [], 0 !== e.length && (e = e.filter(function(e) {
                var t, n = i.findElem("row", "hash", BEM.toModVal(e));
                return n.length ? (t = i.findBlockInside(n, "checkbox")) ? (t.setMod("checked", "yes"), i.setMod(n, "disableable", "no"), !0) : void 0 : !1
            })), this._options.selectedRows = e, t && 0 === e.length && Array.prototype.filter.call(this.findElem("row"), function(e) {
                return !i.getMod(jQuery(e), "parent")
            }).slice(0, this._meta.getDefaultSelectedRowsLimit()).forEach(function(e) {
                var t;
                e = jQuery(e), t = i.findBlockInside(e, "checkbox"), t && (t.setMod("checked", "yes"), i.setMod(e, "disableable", "no"))
            }), this._toggleTotalsCheckbox(this._options.totalsChecked)
        },
        _mergeOptionsWithPreset: function(e, t) {
            return e = jQuery.extend(!0, {}, e), e.metrics = t.getMetrics().slice(0), jQuery.equals(t.getDimensions(), e.dimensions) || (e.dimensionFilter = null), e.dimensions = t.getDimensions().slice(0), e.mode = e.dimensions.length <= 1 ? "list" : e.mode, e.metricFilters = t.validateMetricFilter(e.metricFilters), e.goalId = t.getGoal(), e.sort = t.validateSortDirection(e.sort), e.percentagesMetrics = t.validateMetricsList(e.percentagesMetrics || []), e.metric = e.metric && t.validateMetricsList([e.metric]) || e.metrics, e.metric = e.metric[0], e
        },
        _onPresetChange: function() {
            BN("i-report").getMetadata().then(function(e) {
                var t = this._mergeOptionsWithPreset(this._options, e);
                if (this.trigger("change-structure"), this._meta = e, jQuery.equals(e.getMetrics(), this._options.metrics) && jQuery.equals(e.getDimensions(), this._options.dimensions)) this.reload(t);
                else {
                    if (this._isDestructing) return;
                    BEM.dataBindVal("data-table.dimensionFilter", t.dimensionFilter), BN("i-content").replace(this.domElem, {
                        block: "data-table",
                        mods: this.getInitialMods(),
                        disableScrollWrap: !0,
                        dimensionFilter: t.dimensionFilter
                    }), this.destruct(!0)
                }
                BEM.dataBindVal("data-table", {
                    metric: t.metric,
                    sort: t.sort,
                    percentage: t.percentagesMetrics,
                    metricFilters: t.metricFilters,
                    dimensionMode: t.mode,
                    dimensionFilter: t.dimensionFilter,
                    rowsLimit: t.rowsLimit
                })
            }.bind(this))
        },
        _setSamplingAccuracy: function(e) {
            this.reload({
                accuracy: e
            })
        },
        _updateQuantile: function(e) {
            this.reload({
                quantile: e
            })
        },
        _updateAttribution: function(e) {
            this.reload({
                attribution: e
            })
        },
        _updateConfidence: function(e) {
            this.reload({
                confidence: e
            })
        },
        _checkForSensitiveData: function(e) {
            e && e.contains_sensitive_data && this._dataModel.markSensitive()
        },
        _load: function(e, t) {
            var i = this,
                n = BN("i-promise").createChain(this);
            return this._extendLoadOptions(jQuery.extend({
                calcHash: !0,
                offset: 0,
                limit: BN("i-data-table").DEFAULT_ROWS_LIMIT,
                parents: []
            }, e), this._options).then(n(function(e) {
                return Vow.all([e, BN("i-report").loadData(e)])
            })).spread(n(function(e, t) {
                var n;
                if (e.parentId || (i._options.rowsLimit = e.offset + e.limit, BEM.dataBindVal("data-table.rowsLimit", i._options.rowsLimit)), e.parents && e.parents.length || e.offset ? i._dataModel.appendRows(e.parents && e.parents.length ? e.parents : null, t.data) : i._dataModel = BN("data-table-data-model").create(t), BN("data-lag-notification").setLag(t.data_lag || 0), i._handleMissingAttributeDataMessage(t.meta.metrics, t.meta.dimensions, e), i._checkForSensitiveData(t), t && (BN("sensitive-data-warning").show(this._dataModel.isSensitive()), BN("m-accuracy").getInstance().set({
                        minShare: t.max_sample_share,
                        share: t.sample_share
                    }), n = t.meta.metrics.some(function(e) {
                        return Boolean(e.contains_direct_expenses)
                    }), BN("direct-expenses-notification").show(n), BN("direct-sampling-notification").show(n && t.sample_share < 1)), t.data && t.data.length) {
                    var o = i.getInitialMods();
                    return Vow.all({
                        rows: BN("i-content").html({
                            block: "data-table",
                            mods: i.getInitialMods(),
                            elem: "rows",
                            dimensionMode: i._options.mode,
                            data: t,
                            offset: e.offset,
                            parentId: e.parentId,
                            parentRows: e.parents,
                            fullTotals: i._dataModel.getTotals(),
                            fullMax: i._dataModel.getMax(),
                            group: i._options.group,
                            disabled: Boolean(e.disabled),
                            disableable: void 0 === e.disableable ? !0 : Boolean(e.disableable)
                        }),
                        total: BN("i-content").html({
                            block: "data-table",
                            mods: o,
                            elem: "totals-row",
                            blockMods: o,
                            data: t
                        })
                    })
                }
            })).then(n(t)).always(n(function(e) {
                var t, n = e.isRejected() && e.valueOf();
                return BN("direct-clientid-notification").show(n && "ERR_REPORT_REQUIRE_DIRECT_CLIENT_ID" === n.code), n ? (t = 504 === n.status ? new BEM.blocks["i-error-message"].MetrikaError(this.GATEWAY_TIMEOUT_MESSAGE) : n, BN("error-message").showError(i, t), BN("data-table-data-model").create({}, t), BN("m-accuracy").getInstance().setFullDistributionParams()) : BN("error-message").hideError(i), e
            }))
        },
        _getDimensionFilter: function(e) {
            return e.dimensionFilter && "list" === e.mode ? e.dimensionFilter : null
        },
        _buildFilter: function(e, t, i) {
            var n = BN("i-filter"),
                o = i.getSegmentsTree();
            return n.conjunctionJoinFilters(n.buildFilter(e, o), n.buildFilter(t || {}, o))
        },
        _extendLoadOptions: function(e, t) {
            return BN("i-report").getMetadata().then(function(i) {
                var n = BN("i-filter"),
                    o = t.sort,
                    s = e.parents;
                return this._meta = i, o && s.length && -1 !== this._options.dimensions.indexOf(o.metrics) && (o.metrics = this._options.dimensions[s.length]), t = jQuery.extend(!0, {}, t), e.mode = t.mode, e.filter = this._buildFilter(t.filter, t.metricFilters, i), e.filter = n.conjunctionJoinFilters(e.filter, n.buildDimensionFilter(this._getDimensionFilter(t), i)), e.period = t.period, e.group = t.group, e.sort = o && ("cba" === o.direction ? "-" : "") + o.metrics, e.goalId = t.goalId, e.ids = t.ids, e.metrics = t.metrics, e.dimensions = t.dimensions, e.quantile = t.quantile, e.accuracy = t.accuracy, e.attribution = t.attribution, e.confidence = t.confidence, e
            }.bind(this))
        },
        _setMetricFilters: function(e) {
            this.reload({
                metricFilters: e
            })
        },
        _createLoadingRow: function(e) {
            var t = jQuery(BEM.blocks["i-content"].html({
                block: "data-table",
                mods: this.getInitialMods(),
                elem: "loading-row"
            }, !0));
            return BEM.DOM.init(t), this._createLoadingRow = function(e) {
                return e && e.size() ? e.after(t) : this.elem("tbody").append(t), t
            }, this._createLoadingRow(e)
        },
        _destroyLoadingRow: function(e) {
            jQuery(e).remove()
        },
        _onExpanderClick: function(e) {
            var t, i, n = e.data,
                o = n.domElem.closest(this.buildSelector("row")),
                s = this.getMod(o, "expanded"),
                r = this;
            "no" === s ? "yes" !== this.getMod(o, "loaded") ? (t = this.elemParams(o), i = this.findBlockInside(n.domElem, "spin2"), i.setMod("progress", "yes"), this.setMod(o, "loaded", "yes"), this.setMod(o, "expanded", "loading"), this._load({
                limit: BN("i-data-table").DEFAULT_ROWS_LIMIT,
                parentId: t.id,
                parents: t.parents,
                disabled: this.hasMod(o, "disabled", "yes"),
                disableable: !this.hasMod(o, "checked", "yes")
            }, function(e) {
                e && e.rows ? BEM.DOM.after(o, e.rows) : BEM.DOM.after(o, r._getEmptyHtml({
                    mix: [{
                        block: "data-table",
                        elem: "row",
                        mods: {
                            parent: t.id
                        }
                    }]
                })), r.setMod(o, "expanded", "yes"), i.delMod("progress")
            })) : this.setMod(o, "expanded", "yes") : this.setMod(o, "expanded", "no")
        },
        _onMoreClick: function(e) {
            var t = this.findBlockOn(jQuery(e.data.domElem), "button"),
                i = t.domElem.closest(this.buildSelector("more-row")),
                n = this._createLoadingRow(i),
                o = this._getParentRow(i);
            this._load({
                offset: t.params.offset,
                limit: BN("i-data-table").DEFAULT_ROWS_LIMIT,
                parentId: t.params.parentId,
                parents: t.params.parentRows,
                disabled: o && this.hasMod(o, "disabled", "yes") || this._leftCheckedRows <= 0,
                disableable: !o || !this.hasMod(o, "checked", "yes")
            }, function(e) {
                BEM.DOM.destruct(i), BEM.DOM.replace(n, e.rows)
            })
        },
        _getHeaderCellsBy: function(e) {
            var t = e.closest(this.buildSelector("cell"));
            return this.findElem("cell", "index", this.getMod(t, "index"))
        },
        _setDimensionMode: function(e) {
            this._changeModeBlock && this._changeModeBlock.val(e)
        },
        _onChangeDimensionsMode: function() {
            this._options.mode = this._changeModeBlock ? this._changeModeBlock.val() : "list", this.setMod("mode", this._options.mode), BEM.dataBindVal("data-table.dimensionMode", this._options.mode), this.reload({
                selectedRows: []
            })
        },
        _getModifiedMetrikaKeyTable: function() {
            return this._options.metrics.reduce(function(e, t) {
                return e[BEM.toModVal(t)] = t, e
            }, {})
        },
        _getPercentagesMetrics: function() {
            var e = this.findBlocksInside(this.elem("head-button", "action", "percent"), "check-button"),
                t = this._getModifiedMetrikaKeyTable();
            return e.reduce(function(e, i) {
                return i.isChecked() && e.push(String(t[i.val()])), e
            }, []).sort()
        },
        _setPercentagesMetrics: function(e) {
            var t = this.findBlocksInside(this.elem("head-button", "action", "percent"), "check-button"),
                i = this._getModifiedMetrikaKeyTable(),
                n = this._options.metric,
                o = -1 !== this._options.percentagesMetrics.indexOf(n);
            this._options.percentagesMetrics = e, t.forEach(function(t) {
                var n = i[t.val()],
                    o = -1 !== e.indexOf(n);
                t.isChecked() !== o && t.setMod("checked", o ? "yes" : ""), this.setMod("metric" + t.val(), o ? "relative" : "")
            }, this), o !== (-1 !== e.indexOf(n)) && this._triggerChanges()
        },
        _onHeadPercentClick: function() {
            var e = this._getPercentagesMetrics();
            this._setPercentagesMetrics(e), BEM.dataBindVal("data-table.percentage", e)
        },
        _getSelectedMetric: function() {
            return this._graphButton.val()
        },
        _onHeadGraphClick: function() {
            var e = this._getSelectedMetric();
            this._options.metric !== e && (this._setMetric(e), this._triggerChanges())
        },
        _setMetric: function(e) {
            this._options.metrics.indexOf(e) > -1 && (BEM.dataBindVal("data-table.metric", e), this._options.metric = e, this._graphButton && this._graphButton.val(e))
        },
        _getSortDirection: function(e) {
            var t;
            return e = e || this.findElem("header", "sorting", "yes"), e.size() && (t = {
                metrics: this.elemParams(e).sortBy
            }, "cba" === this.getMod(e, "sort-mode") ? t.direction = "cba" : t.direction = "abc"), t
        },
        _setSortDirection: function(e) {
            var t = this.findElem("header", "sortable", "yes"),
                i = this.findElem("header", "sorting", "yes"),
                n = e && [].reduce.call(t, function(t, i) {
                    var n = this.elemParams(jQuery(i));
                    return n && n.sortBy === e.metrics ? jQuery(i) : t
                }.bind(this), void 0);
            this._unsetSortOnElem(i), n && this._setSortOnElem(n, e.direction), this.reload({
                selectedRows: [],
                sort: e,
                totalsChecked: this._options.totalsChecked
            })
        },
        _unsetSortOnElem: function(e) {
            var t, i;
            e && e.length && (t = this.findBlockInside(e, "icon"), i = t.elem("triangle"), this.delMod(e, "sorting"), this.delMod(e, "sort-mode"), t.setMod(i, "direction", ""), this.delMod(this._getHeaderCellsBy(e), "sorting"))
        },
        _setSortOnElem: function(e, t) {
            var i = this.findBlockInside(e, "icon"),
                n = i.elem("triangle");
            this.setMod(e, "sorting", "yes"), this.setMod(e, "sort-mode", t), i.setMod(n, "direction", "abc" === t ? "up" : "down"), this.setMod(this._getHeaderCellsBy(e), "sorting", "yes")
        },
        _onHeaderSortClick: function(e) {
            var t, i = e.data.domElem,
                n = this.elemParams(jQuery(i)),
                o = this.findBlockInside(i, "icon"),
                s = o.elem("triangle");
            n = n && n.sortBy, "yes" === this.getMod(i, "sorting") ? (this.toggleMod(i, "sort-mode", "abc", "cba"), o.toggleMod(s, "direction", "up", "down")) : (this._unsetSortOnElem(this.findElem("header", "sorting", "yes")), this._setSortOnElem(i, "cba")), n && this._setMetric(n), t = this._getSortDirection(i), BEM.dataBindVal("data-table.sort", t), this.reload({
                selectedRows: [],
                sort: t,
                totalsChecked: this._options.totalsChecked
            })
        },
        _updateSelectedRowsList: function(e) {
            var t, i, n = "yes" === this.getMod(e, "checked");
            "" === this.getMod(e, "parent") && (t = this.elemParams(e).data.hash, i = this._options.selectedRows.indexOf(t), n && -1 === i ? this._options.selectedRows.push(t) : n || -1 === i || this._options.selectedRows.splice(i, 1), BEM.dataBindVal("data-table.selectedRows", this._options.selectedRows))
        },
        _updateColorMarkerColor: function(e, t) {
            var i, n, o, s = this.findElem(e, "color-marker"),
                r = this.findBlockInside(e, "checkbox"),
                a = this._getCheckboxIds(r),
                l = [];
            t ? (n = this._getRowAssignedColor(e.prev(this.buildSelector("row"))), o = this._getRowAssignedColor(e.next(this.buildSelector("row"))), i = this._colorPool.get(this._colorTable[a]), n && i === n && (i = this._colorPool.get(), l.push(i)), o && i === o && (i = this._colorPool.get(), l.push(i)), this._colorTable[a] = i, l.forEach(function(e) {
                this._colorPool.free(e)
            }, this)) : (this._colorPool.free(this._colorTable[a]), delete this._colorTable[a]), s.css("background-color", t ? this._colorPool.getColor(this._colorTable[a]) : "")
        },
        _getRowAssignedColor: function(e) {
            var t;
            return e.length ? (t = this._getCheckboxIds(this.findBlockInside(e, "checkbox")), this._colorTable[t] || null) : null
        },
        _checkRow: function(e) {
            var t = this.findBlockInside(e, "checkbox");
            this._updateColorMarkerColor(e, !0), this.setMod(e, "checked", "yes"), this.setMod(e, "disableable", "no"), t.setMod("checked", "yes"), this.setMod(e, "inlying-checked", ""), this._updateSelectedRowsList(e)
        },
        _uncheckRow: function(e) {
            var t = this.findBlockInside(e, "checkbox");
            this._updateColorMarkerColor(e, !1), this.setMod(e, "checked", ""), this.setMod(e, "disableable", "yes"), t.setMod("checked", ""), this._updateSelectedRowsList(e)
        },
        _uncheckChildRows: function(e) {
            this._getChildRows(e).forEach(function(e) {
                this._uncheckRow(e), this.hasMod(e, "inlying-checked") && this._uncheckChildRows(e), this.delMod(e, "inlying-checked")
            }, this)
        },
        _markParentsAsContainingChecked: function(e) {
            this._getParentRows(e).forEach(function(e) {
                this._uncheckRow(e), this.setMod(e, "inlying-checked", "yes"), this.setMod(e, "disableable", "no")
            }, this)
        },
        _refreshParentChecking: function(e) {
            var t, i;
            t = this._getParentRow(e), t && (i = this._getChildRows(t).some(function(e) {
                var t = this.findBlockInside(e, "checkbox");
                return t.isChecked() || this.hasMod(e, "inlying-checked")
            }, this), i ? this.setMod(e, "disableable", "no") : (this._uncheckRow(t), this.delMod(t, "inlying-checked", "yes"), this.setMod(e, "disableable", "yes"), this._refreshParentChecking(t)))
        },
        _refreshDisableableStatus: function(e) {
            var t = this.hasMod(e, "checked", "yes");
            this._getChildRows(e).forEach(function(e) {
                this.hasMod(e, "checked", "yes") || this.setMod(e, "disableable", t ? "no" : "yes")
            }, this)
        },
        _toggleRowCheking: function(e) {
            var t = e.domElem.closest(this.buildSelector("row"));
            e.isChecked() ? (this._leftCheckedRows--, this._checkRow(t), this._uncheckChildRows(t), this._markParentsAsContainingChecked(t)) : (this._leftCheckedRows++, this._uncheckRow(t), this._refreshParentChecking(t)), this._refreshDisableableStatus(t), this._leftCheckedRows <= 0 ? this.setMod(this.findElem("row", "disableable", "yes"), "disabled", "yes") : this.setMod(this.findElem("row", "disableable", "yes"), "disabled", ""), this._triggerChanges()
        },
        _toggleTotalsCheckbox: function(e) {
            var t, i = this.findBlockInside("totals-checkbox", "checkbox");
            i && (t = this.findElem(i.domElem, "color-marker"), void 0 === e ? this._options.totalsChecked = !Boolean(this._options.totalsChecked) : this._options.totalsChecked = e, i.setMod("checked", this._options.totalsChecked ? "yes" : ""), t.css("background-color", this._options.totalsChecked ? this.TOTALS_COLOR : ""), this._triggerChanges())
        },
        _getCheckboxIds: function(e) {
            return JSON.parse(e.val()).map(function(e) {
                return "-" + e + "-"
            }).join("")
        },
        _getCheckedRows: function() {
            var e = this._getCheckedRowsCheckboxes();
            return null === e ? null : e.map(function(e) {
                var t = this._getCheckboxIds(e),
                    i = e.domElem.closest(this.buildSelector("row")),
                    n = i.size() && this.elemParams(i).data;
                return {
                    id: JSON.parse(e.val()),
                    color: this._colorTable[t],
                    data: n
                }
            }, this)
        },
        _buildColors: function(e) {
            return (e || []).map(function(e) {
                return e.color
            })
        },
        _buildRows: function(e) {
            return e ? e && e.map(function(e) {
                return e.id
            }) : BN("i-data-table").NO_SELECTABLE_ROWS
        },
        _triggerChanges: function() {
            var e = Boolean(this._options.totalsChecked),
                t = this._getCheckedRows();
            BEM.dataBindVal("data-table.rows.totals", e), BEM.dataBindVal("data-table.totalsChecked", e), BEM.dataBindVal("data-table.rows.rows", this._buildRows(t)), BEM.dataBindVal("data-table.colors.colors", this._buildColors(t)), BEM.dataBindVal("data-table.colors.totals", this.TOTALS_COLOR), BEM.dataBindVal("data-table.dimensionFilter", this._getDimensionFilter(this._options)), this.trigger("reload", this._options)
        },
        _getCheckedRowsCheckboxes: function() {
            var e = this.findBlocksInside("row-checkbox", "checkbox");
            return e.length ? e.filter(function(e) {
                return e.isChecked()
            }) : null
        },
        _getParentRows: function(e) {
            for (var t = this._getParentRow(e), i = []; void 0 !== t;) i.push(t), t = this._getParentRow(t);
            return i
        },
        _getParentRow: function(e) {
            var t, i = this.getMod(e, "parent");
            return i && this.findElem("row").toArray().some(function(e) {
                return i === this.elemParams(jQuery(e)).id ? (t = jQuery(e), !0) : !1
            }, this), t
        },
        _getChildRows: function(e) {
            var t = this.elemParams(e).id;
            return this.findElem("row", "parent", t).toArray().map(function(e) {
                return jQuery(e)
            })
        },
        _onDimensionSearch: function(e, t) {
            t = t.trim(), t = t || null, this.reload({
                dimensionFilter: t
            })
        },
        _handleChartTypeChange: function(e) {
            BN("i-report").getMetadata().then(function(t) {
                this._isDestructing || this.setMod("totals-checkable", -1 === ["line-chart", "bar-chart"].indexOf(e) || "bar-chart" === e && "traffic" === t.getPresetName() ? "" : "yes")
            }.bind(this)).done()
        },
        _handleMissingAttributeDataMessage: function(e, t, i) {
            BN("missing-attribute-data-notification").show(e, t, i.period)
        }
    }, {
        live: function() {
            return this.liveInitOnBlockInsideEvent("change", "checkbox", function(e) {
                this.findElem(e.block.domElem, "row-checkbox").length && "a" !== e.target.domElem[0].tagName.toLowerCase() && this._toggleRowCheking(e.block)
            }), this.liveBindTo("totals-checkbox", "change", function() {
                this._toggleTotalsCheckbox()
            }), this.liveBindTo("more-button", "click", function() {
                this._onMoreClick.apply(this, arguments)
            }), this.liveBindTo("expander", "click", function() {
                this._onExpanderClick.apply(this, arguments)
            }), !1
        }
    }), BEM.JSON.decl({
        name: "data-table",
        modName: "selectable",
        modVal: "yes"
    }, {
        onElem: {
            "check-rows": function(e) {
                e.mod("visible", "no").content({
                    block: "checkbox",
                    mods: {
                        size: "s",
                        checked: "yes"
                    }
                })
            },
            "dimension-total": function(e) {
                e.content([{
                    block: "checkbox",
                    mods: {
                        size: "s",
                        propagate: "link",
                        checked: e.params().checked ? "yes" : ""
                    },
                    mix: [{
                        block: "data-table",
                        elem: "totals-checkbox"
                    }],
                    content: [{
                        block: "data-table",
                        elem: "color-marker"
                    }, {
                        elem: "label",
                        content: e.content()
                    }]
                }, {
                    elem: "totals-text",
                    content: e.content()
                }], !0)
            },
            "dimension-wrapper": function(e) {
                var t = e.params().cell;
                e.content([{
                    elem: "color-marker"
                }, t.expander, {
                    block: "checkbox",
                    mods: {
                        size: "s",
                        propagate: "link",
                        disabled: t.disabled ? "yes" : ""
                    },
                    mix: [{
                        block: "data-table",
                        elem: "row-checkbox"
                    }],
                    checkboxAttrs: {
                        value: JSON.stringify(t.rowId)
                    },
                    content: {
                        elem: "label",
                        mix: [{
                            block: "hint-hover",
                            js: {
                                widthLimiter: "td"
                            }
                        }],
                        content: t.content
                    }
                }, t.additional], !0).stop()
            }
        }
    }), BEM.DOM.decl({
        name: "checkbox",
        modName: "propagate",
        modVal: "link"
    }, {
        _onClick: function(e) {
            "a" !== e.target.tagName.toLowerCase() && this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl("dimension-field", {
        onBlock: function(e) {
            e.tag("span")
        }
    }), BEM.JSON.decl({
        name: "dimension-field",
        modName: "type",
        modVal: "owner"
    }, {
        onBlock: function(e) {
            var t = e.params().value;
            return 1 === parseInt(t, 10) ? e.remove() : void e.content(BEM.I18N("dimension-field", "external"))
        }
    }), BEM.JSON.decl({
        name: "dimension-field",
        modName: "type",
        modVal: "direct-id"
    }, {
        onBlock: function(e) {
            var t = e.params().value;
            return t ? void e.content(["(", BN("i-string").escapeBemJson(t), ")"]) : e.remove()
        }
    }), BEM.JSON.decl("metric-filter", {
        onBlock: function(e) {
            var t = e.param("value"),
                i = e.param("metric");
            e.js({
                value: t,
                metric: i
            }).content([{
                block: "dropdown",
                content: [{
                    block: "button",
                    mix: [{
                        block: "dropdown",
                        elem: "switcher"
                    }, {
                        block: "metric-filter",
                        elem: "dropdown-button"
                    }],
                    mods: {
                        size: "xs",
                        "only-icon": "yes",
                        pseudo: "yes"
                    },
                    attrs: {
                        title: BEM.I18N("metric-filter", "button-show-filter")
                    },
                    content: {
                        block: "icon",
                        elem: "filter"
                    }
                }, {
                    elem: "popup",
                    mods: {
                        padding: "no"
                    },
                    js: {
                        directions: "bottom"
                    },
                    content: {
                        block: "metric-filter",
                        elem: "form",
                        value: t,
                        metricType: i && i.type
                    }
                }]
            }])
        },
        onElem: {
            mode: function(e) {
                var t = e.param("value"),
                    i = {
                        ">": BEM.I18N("metric-filter", "more"),
                        "<": BEM.I18N("metric-filter", "less")
                    },
                    n = t && i[t.op] || i[Object.keys(i)[0]];
                e.tag("span").content({
                    block: "select",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    content: [{
                        block: "button",
                        mods: {
                            size: "s"
                        },
                        content: n
                    }, {
                        elem: "control",
                        content: Object.keys(i).map(function(e) {
                            return {
                                elem: "option",
                                content: i[e],
                                attrs: {
                                    value: e,
                                    selected: t && e === t.op ? "selected" : ""
                                }
                            }
                        })
                    }]
                })
            },
            form: function(e) {
                var t = e.param("value"),
                    i = e.param("metricType"),
                    n = "second" === i;
                e.tag("form").content([{
                    elem: "content",
                    content: [{
                        elem: "mode",
                        value: t
                    }, {
                        elem: "input",
                        tag: "span",
                        content: n ? {
                            block: "input-time",
                            value: t && t.value
                        } : {
                            block: "input",
                            mods: {
                                size: "s",
                                clear: "no"
                            },
                            content: [{
                                elem: "control",
                                attrs: {
                                    value: t && t.value,
                                    autocomplete: "off"
                                }
                            }]
                        }
                    }, {
                        elem: "error",
                        mods: {
                            hidden: "yes"
                        },
                        content: BEM.I18N("metric-filter", "incorrect-value")
                    }]
                }, {
                    elem: "footer",
                    content: {
                        block: "button",
                        type: "submit",
                        mods: {
                            size: "s"
                        },
                        content: BEM.I18N("metric-filter", "apply")
                    }
                }])
            }
        }
    }), BEM.DOM.decl("metric-filter", {
        dataBindings: {
            "data-table.metricFilters": {
                set: "_changeMetricFilters"
            }
        },
        onSetMod: {
            js: function() {
                this._value = this.params.value, this._inputBlock = this.findBlockInside("input-time") || this.findBlockInside("input"), this._selectBlock = this.findBlockInside("select"), this._errorElem = this.elem("error"), this.elem("form").on("submit", this._onApply.bind(this))
            }
        },
        _setVal: function(e) {
            this.setMod(this._errorElem, "hidden", "yes"), this._inputBlock.val(e ? e.value : ""), this._selectBlock.val(e ? e.op : ""), this._value = e
        },
        _changeMetricFilters: function(e) {
            var t = Object.keys(e || {});
            t.length || this._clearHandler(), t.forEach(function(t) {
                t === this.params.metric.dim && e[t] !== this._value && this._setVal(e[t])
            }, this)
        },
        _clearHandler: function() {
            this._inputBlock.val(""), this._value = void 0, this.setMod(this._errorElem, "hidden", "yes")
        },
        _setDataBindingValue: function(e) {
            var t = this.params.metric.dim,
                i = BEM.dataBindVal("data-table.metricFilters") || {};
            i[t] = e, BEM.dataBindVal("data-table.metricFilters", i)
        },
        _onApply: function(e) {
            var t = this._parseValidateValue();
            e.preventDefault(), t !== !1 ? (this.findBlockInside("dropdown").hide(), this.setMod(this._errorElem, "hidden", "yes"), this._value = t, this._setDataBindingValue(this._value)) : this.setMod(this._errorElem, "hidden", "")
        },
        _parseValidateValue: function() {
            var e = this.params.metric,
                t = String(this._inputBlock.val()).trim(),
                i = {
                    op: this._selectBlock.val(),
                    type: "number"
                };
            return "double" === e.type || "percents" === e.type ? i.value = parseFloat(t.replace(",", ".")) : i.value = parseInt(t, 10), isNaN(i.value) ? !1 : i
        }
    }), BEM.JSON.decl("input-time", {
        onBlock: function(e) {
            var t = e.param("value"),
                i = BN("i-date").secondsToTimeObj(t);
            e.js({
                value: t
            }).content([{
                elem: "input-box",
                content: [{
                    block: "input",
                    mods: {
                        size: "s",
                        clear: "no",
                        theme: "none",
                        "time-type": "hour"
                    },
                    content: [{
                        elem: "control",
                        attrs: {
                            value: i.hour,
                            maxlength: 2,
                            max: 23
                        }
                    }, {
                        elem: "sep",
                        tag: "span",
                        content: ":"
                    }]
                }, {
                    block: "input",
                    mods: {
                        size: "s",
                        clear: "no",
                        theme: "none",
                        "time-type": "minute"
                    },
                    content: [{
                        elem: "control",
                        attrs: {
                            value: i.minute,
                            maxlength: 2,
                            max: 59
                        }
                    }, {
                        elem: "sep",
                        tag: "span",
                        content: ":"
                    }]
                }, {
                    block: "input",
                    mods: {
                        size: "s",
                        clear: "no",
                        theme: "none",
                        "time-type": "second"
                    },
                    content: {
                        elem: "control",
                        attrs: {
                            value: i.second,
                            maxlength: 2,
                            max: 59
                        }
                    }
                }]
            }, {
                elem: "sample",
                content: BEM.I18N("input-time", "sample")
            }])
        }
    }), BEM.DOM.decl("input-time", {
        SUPPORTED_KEYS: [8, 9, 13, 16, 17, 35, 36, 37, 39, 45, 46, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 67, 86, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105],
        TIME_PARTS: {
            hour: 3600,
            minute: 60,
            second: 1
        },
        onSetMod: {
            js: function() {
                this.domElem.find("input").on("keydown", this._filterKeys.bind(this)).on("blur", this._validateInput.bind(this)), this._setValue(this.params.value)
            }
        },
        val: function(e) {
            return void 0 === e ? this._getValue() : void this._setValue(e)
        },
        _setValue: function(e) {
            var t = this,
                i = BN("i-date").secondsToTimeObj(e);
            Object.keys(i).forEach(function(e) {
                t.findBlockInside({
                    block: "input",
                    modName: "time-type",
                    modVal: e
                }).val(i[e])
            })
        },
        _getValue: function() {
            var e = this;
            return Object.keys(this.TIME_PARTS).reduce(function(t, i) {
                var n = Number(e.findBlockInside({
                    block: "input",
                    modName: "time-type",
                    modVal: i
                }).val());
                return isNaN(n) && (n = 0), t + n * e.TIME_PARTS[i]
            }, 0)
        },
        _filterKeys: function(e) {
            return -1 !== this.SUPPORTED_KEYS.indexOf(e.keyCode)
        },
        _validateInput: function(e) {
            var t = this;
            setTimeout(function() {
                t._validateTime(jQuery(e.currentTarget))
            }, 50)
        },
        _validateTime: function(e) {
            var t = e.val(),
                i = e.attr("max") || 59;
            isNaN(Number(t)) || "" === t ? e.val("00") : Number(t) > Number(i) && e.val(i)
        }
    }), BEM.JSON.decl("metric-filter-label", {
        onBlock: function(e) {
            var t = e.param("value"),
                i = e.param("metric");
            (void 0 === t || "" === t.value) && e.mods({
                hidden: "yes"
            }), e.js({
                metric: i
            }).content([{
                elem: "label-text",
                value: t,
                metricType: i && i.type
            }, {
                block: "icon",
                elem: "cross",
                mix: [{
                    block: "metric-filter-label",
                    elem: "clear"
                }]
            }])
        },
        onElem: {
            "label-text": function(e) {
                var t, i = e.param("value"),
                    n = e.param("metricType"),
                    o = "";
                i && (n && "second" === n ? (t = BN("i-date").secondsToTimeObj(i.value), o = i.op + t.hour + ":" + t.minute + ":" + t.second) : o = i.op + String(i.value)), e.tag("span").content(BN("i-string").escapeHTML(o))
            }
        }
    }), BEM.DOM.decl("metric-filter-label", {
        dataBindings: {
            "data-table.metricFilters": {
                set: "_changeMetricFiltersLabel"
            }
        },
        onSetMod: {
            js: function() {
                this._value = this.params.value, this._metricType = this.params.metric && this.params.metric.type, this.elem("clear").on("click", this._clearHandler.bind(this))
            }
        },
        setVal: function(e) {
            var t = BN("i-content").html({
                block: "metric-filter-label",
                elem: "label-text",
                value: e,
                metricType: this._metricType
            }, !0);
            BEM.DOM.replace(this.findElem("label-text"), t), this.setMod("hidden", void 0 === e || "" === e.value ? "yes" : ""), this._value = e
        },
        _changeMetricFiltersLabel: function(e) {
            var t = Object.keys(e || {}).some(function(t) {
                return t === this.params.metric.dim && e[t] !== this._value ? (this.setVal(e[t]), !0) : void 0
            }, this);
            t || this.setVal(void 0)
        },
        _clearHandler: function() {
            this.setVal(void 0), this._setDataBindingValue(this._value)
        },
        _setDataBindingValue: function(e) {
            var t = this.params.metric.dim,
                i = BEM.dataBindVal("data-table.metricFilters") || {};
            void 0 === e && 1 === Object.keys(i).length && i[t] ? i = null : i[t] = e, BEM.dataBindVal("data-table.metricFilters", i)
        }
    }), BEM.DOM.decl("render-ready", {
        onSetMod: {
            js: function() {
                var e = this.findBlockOn(this.params.block),
                    t = BN("render-ready").promises,
                    i = Vow.promise();
                e.on("renderReady", function() {
                    i.fulfill()
                }), t.push(i)
            }
        }
    }, {
        promises: []
    }), $(function() {
        Vow.all(BN("render-ready").promises).then(function() {
            $(document).trigger("renderReady")
        })
    }), BEM.JSON.decl("data-table", {
        onElem: {
            thead: function(e) {
                var t = e.params(),
                    i = t.sort,
                    n = t.meta,
                    o = n.getDimensions().length,
                    s = n.getReport() instanceof BN("i-report-legacy"),
                    r = n.constructorAllowed(),
                    a = o > 1,
                    l = BN("i-data-table").getHeaderColumns({
                        dimensions: n.getDimensionsMeta(),
                        metrics: n.getMetricsMeta()
                    }, {
                        metricFilters: t.metricFilters || {},
                        percentagesMetrics: t.percentagesMetrics,
                        selectedMetric: t.selectedMetric,
                        sort: i,
                        dimensionMode: t.dimensionMode,
                        dimensionFilter: t.dimensionFilter,
                        selectable: t.selectable,
                        filtrable: t.filtrable,
                        hasChart: n.getReport().hasChart()
                    });
                e.mods({
                    multidimension: a ? "yes" : ""
                }).tag("thead").content([{
                    elem: "thead-row",
                    content: [{
                        elem: "cell",
                        mods: {
                            "head-constructor": "yes",
                            type: "dimensions"
                        },
                        content: r || a ? [{
                            elem: "dimensions-cell-inner",
                            content: [{
                                elem: "dimensions-cell-inner-left",
                                content: [a ? {
                                    elem: "thead-change-mode-buttons",
                                    dimensionMode: t.dimensionMode
                                } : "", r ? {
                                    block: "light-constructor",
                                    mods: {
                                        advice: "yes"
                                    },
                                    type: "dimensions"
                                } : ""]
                            }, r ? {
                                elem: "dimensions-cell-inner-right",
                                content: {
                                    block: "report-trust-rows",
                                    mix: {
                                        block: "data-table",
                                        elem: "report-trust-rows"
                                    }
                                }
                            } : ""]
                        }] : ""
                    }, {
                        elem: "cell",
                        attrs: {
                            colspan: 1e3
                        },
                        mods: {
                            "head-constructor": "yes",
                            type: "metrics"
                        },
                        content: [r ? {
                            block: "light-constructor",
                            type: "metrics"
                        } : "", n.goalModeAllowed() ? {
                            block: "goals-panel",
                            mods: {
                                mode: s ? "legacy" : "compare" === e.blockMods().type ? "compare" : "single"
                            }
                        } : ""]
                    }]
                }, {
                    elem: "thead-row",
                    content: l.header.map(function(e) {
                        return BN("formatter").run(["table-head"], e)
                    })
                }, {
                    elem: "thead-row",
                    content: l.controls.map(function(e) {
                        return BN("formatter").run(["table-head"], e)
                    })
                }])
            },
            "thead-row": function(e) {
                e.tag("tr")
            },
            "thead-header-cell": function(e) {
                var t = e.params(),
                    i = t.cell;
                e.wrap([{
                    elem: "thead-cell",
                    mods: e.mods(),
                    cell: i,
                    titleCell: !0,
                    content: [t.beforeContent, i.hint ? {
                        block: "hint-icon",
                        text: i.hint
                    } : null, {
                        elem: "header",
                        mods: {
                            sortable: i.sortable ? "yes" : "no",
                            sorting: i.sortable && i.sortBy && i.sort && i.sort.metrics === i.sortBy ? "yes" : "",
                            "sort-mode": i.sortable && i.sortBy && i.sort && i.sort.metrics === i.sortBy ? i.sort.direction : ""
                        },
                        js: {
                            sortBy: i.sortBy
                        },
                        content: [e.content(), i.sortable ? {
                            block: "icon",
                            elem: "triangle",
                            mods: {
                                direction: i.sortBy && i.sort && i.sort.metrics === i.sortBy ? "abc" === i.sort.direction ? "up" : "down" : ""
                            }
                        } : null]
                    }]
                }])
            },
            "thead-cell": function(e) {
                var t = e.param("cell");
                e.wrap([{
                    elem: "cell",
                    attrs: e.attrs(),
                    mods: jQuery.extend({
                        head: "yes",
                        type: t.type,
                        index: t.index,
                        sorting: t.sortable && t.sortBy && t.sort && t.sort.metrics === t.sortBy ? "yes" : ""
                    }, e.mods()),
                    content: {
                        elem: "controls",
                        mods: e.param("titleCell") && t.sortable && t.sortBy ? {
                            sortable: "yes"
                        } : void 0,
                        content: t.content || e.content()
                    }
                }])
            },
            "thead-change-mode-buttons": function(e) {
                e.content([{
                    block: "radio-button",
                    mods: {
                        size: "s"
                    },
                    name: "data-table__mode",
                    value: e.param("dimensionMode") || "tree",
                    content: [{
                        elem: "radio",
                        elemMods: {
                            "only-icon": "yes"
                        },
                        controlAttrs: {
                            value: "list",
                            autocomplete: "off"
                        },
                        attrs: {
                            title: BEM.I18N("data-table", "button-list-mode")
                        },
                        content: {
                            block: "icon",
                            mix: {
                                block: "radio-button",
                                elem: "icon",
                                mods: {
                                    "data-table": "list-mode"
                                }
                            }
                        }
                    }, {
                        elem: "radio",
                        elemMods: {
                            "only-icon": "yes"
                        },
                        controlAttrs: {
                            value: "tree",
                            autocomplete: "off"
                        },
                        attrs: {
                            title: BEM.I18N("data-table", "button-tree-mode")
                        },
                        content: {
                            block: "icon",
                            mix: {
                                block: "radio-button",
                                elem: "icon",
                                mods: {
                                    "data-table": "tree-mode"
                                }
                            }
                        }
                    }]
                }])
            },
            "thead-control-percent": function(e) {
                var t = e.param("metric"),
                    i = e.param("checked");
                e.wrap([{
                    block: "check-button",
                    mods: {
                        size: "xs",
                        "only-icon": "yes",
                        pseudo: "yes",
                        checked: i
                    },
                    controlAttrs: {
                        value: BEM.toModVal(t.dim)
                    },
                    mix: {
                        block: "data-table",
                        elem: "head-button",
                        mods: {
                            action: "percent"
                        }
                    },
                    attrs: {
                        title: BEM.I18N("data-table", "button-percent-switch")
                    },
                    content: {
                        block: "icon",
                        elem: "percents",
                        mix: [{
                            block: "check-button",
                            elem: "icon"
                        }]
                    }
                }])
            },
            "dim-filter": function(e) {
                e.content({
                    block: "search-input",
                    search: e.param("value"),
                    mods: {
                        size: "s"
                    }
                })
            },
            "graph-button": function(e) {
                var t = e.param("cell");
                e.wrap([{
                    block: "radio-button",
                    js: {
                        id: "graph-button"
                    },
                    mods: {
                        size: "xs",
                        pseudo: "yes",
                        theme: "pseudo"
                    },
                    mix: {
                        block: "data-table",
                        elem: "head-button",
                        mods: {
                            action: "graph"
                        }
                    },
                    name: "graph-button",
                    content: {
                        elem: "radio",
                        elemMods: {
                            "only-icon": "yes",
                            checked: t.selected ? "yes" : "",
                            side: "both"
                        },
                        controlAttrs: {
                            value: t.metric.dim,
                            title: BEM.I18N("data-table", "button-show-on-graph")
                        },
                        content: {
                            block: "icon",
                            mix: [{
                                block: "radio-button",
                                elem: "icon"
                            }, {
                                block: "data-table",
                                elem: "graph-icon"
                            }]
                        }
                    }
                }])
            },
            "thead-control-filter": function(e) {
                var t = e.param("metric");
                e.wrap([{
                    block: "metric-filter",
                    mix: [{
                        block: "data-table",
                        elem: "metric-filter"
                    }, {
                        block: "data-table",
                        elem: "head-button"
                    }],
                    metric: t,
                    value: e.params().metricFilters[t.dim]
                }])
            },
            "thead-control-filter-label": function(e) {
                var t = e.param("metric");
                e.wrap([{
                    block: "metric-filter-label",
                    mix: [{
                        block: "data-table",
                        elem: "metric-filter-label"
                    }],
                    metric: t,
                    value: e.params().metricFilters[t.dim]
                }])
            }
        }
    }), BN("formatter").formatters("table-head").add({
        rowType: "header",
        type: "dimension",
        selectable: !0
    }, function(e) {
        e.value = {
            cell: e,
            elem: "thead-header-cell",
            content: e.value,
            beforeContent: {
                elem: "check-rows"
            }
        }
    }).add({
        rowType: "header",
        type: "dimension",
        selectable: !1
    }, function(e) {
        e.value = {
            cell: e,
            elem: "thead-header-cell",
            content: e.value
        }
    }).add({
        rowType: "header",
        type: "metric",
        currency: !0
    }, function(e) {
        e.value = [e.value, ",&nbsp;", {
            block: "attribute-title",
            mods: {
                param: "currency"
            }
        }]
    }).add({
        rowType: "header",
        type: "metric"
    }, function(e) {
        e.value = {
            cell: e,
            elem: "thead-header-cell",
            content: e.value,
            mods: {
                graph: e.selected && "yes" || "no"
            }
        }
    }).add({
        rowType: "controls",
        type: "dimension",
        allowDimFilter: !0
    }, function(e) {
        e.content = {
            elem: "dim-filter",
            value: e.dimensionFilter
        }
    }).add({
        rowType: "controls",
        type: "dimension"
    }, function(e) {
        e.content = {
            elem: "dimension-control",
            content: e.content
        }
    }).add({
        rowType: "controls",
        type: "metric",
        allowFilters: !0
    }, function(e) {
        e.content = [].concat(e.content, {
            elem: "thead-control-filter",
            metric: e.metric,
            metricFilters: e.metricFilters
        })
    }).add({
        rowType: "controls",
        type: "metric",
        hasChart: !0,
        allowNormalization: !0
    }, function(e) {
        e.content = [].concat(e.content, {
            elem: "thead-control-percent",
            metric: e.metric,
            checked: e.normalized ? "" : "yes"
        })
    }).add({
        rowType: "controls",
        type: "metric",
        hasChart: !0
    }, function(e) {
        e.content = [].concat(e.content, {
            elem: "graph-button",
            cell: e
        })
    }).add({
        rowType: "controls",
        type: "metric",
        allowFilters: !0
    }, function(e) {
        e.content = [].concat(e.content, {
            elem: "thead-control-filter-label",
            metric: e.metric,
            metricFilters: e.metricFilters
        })
    }).add({
        rowType: "controls"
    }, function(e) {
        e.value = {
            elem: "thead-cell",
            mods: {
                "controls-tr": "yes"
            },
            cell: e
        }
    }), BEM.DOM.decl("data-table", {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._toggleCheckRows = this.findBlockInside(this.elem("check-rows"), "checkbox"), this._toggleCheckRows && this._toggleCheckRows.on("change", this._onCheckRowsChange, this)
            }
        },
        _load: function() {
            return this.__base.apply(this, arguments).always(BN("i-promise").intercept(this, this._updateToggleCheckMod))
        },
        _onCheckRowsChange: function() {
            var e;
            this._checkboxChanging || (e = this._isAnyCheckboxChecked(), this.findBlocksInside("row-checkbox", "checkbox", "checked", "yes").forEach(function(e) {
                e.delMod("checked")
            }), this._options.totalsChecked = e ? !1 : this._options.totalsChecked, this._checkRows([], !e))
        },
        _updateToggleCheckRowsState: function() {
            var e;
            this._toggleCheckRows && (e = this._isAnyCheckboxChecked(), this._checkboxChanging = !0, this._toggleCheckRows.toggleMod("checked", "yes", e).domElem.attr("title", BEM.I18N("data-table", e ? "unselect-all-rows" : "select-default-x-rows", {
                num: this._meta.getDefaultSelectedRowsLimit()
            })), this.afterCurrentEvent(function() {
                delete this._checkboxChanging
            }))
        },
        _updateToggleCheckMod: function() {
            this._toggleCheckRows && this.toggleMod(this.elem("check-rows"), "visible", "no", this._dataModel.isEmpty())
        },
        _isAnyCheckboxChecked: function() {
            return this.findElem("row", "checked", "yes").length > 0 || this._options.totalsChecked
        },
        _toggleRowCheking: function() {
            this.__base.apply(this, arguments), this.afterCurrentEvent(this._updateToggleCheckRowsState)
        },
        _toggleTotalsCheckbox: function() {
            this.__base.apply(this, arguments), this.afterCurrentEvent(this._updateToggleCheckRowsState)
        }
    }), BEM.JSON.decl({
        name: "goals-panel",
        modName: "mode",
        modVal: "compare"
    }, {
        onBlock: function(e) {
            e.mod("data-bind", "compare")
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "mode",
        modVal: "compare"
    }, {
        _getGoalCounts: function() {
            return Vow.all([BN("i-counters").getAsync(), BN("i-report").getMetadata()]).spread(function(e, t) {
                return BN("i-goal").getDataCountsByGoals({
                    ids: e.getApiCounterId(),
                    periodLeft: this._primaryPeriod,
                    periodRight: this._secondaryPeriod,
                    filterLeft: BN("i-filter").buildFilter(this._primaryFilters, t.getSegmentsTree()),
                    filterRight: BN("i-filter").buildFilter(this._secondaryFilters, t.getSegmentsTree())
                }, !0)
            }.bind(this))
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "data-bind",
        modVal: "compare"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                initAccessor: "_primaryFilters",
                set: "_primaryFilters"
            },
            "segments.primary.period": {
                initAccessor: "_primaryPeriod",
                set: "_primaryPeriod"
            },
            "segments.secondary.filter": {
                initAccessor: "_secondaryFilters",
                set: "_secondaryFilters"
            },
            "segments.secondary.period": {
                initAccessor: "_secondaryPeriod",
                set: "_secondaryPeriod"
            },
            "preset.goal": {
                initAccessor: "",
                set: "setGoal"
            }
        },
        _triggerChanges: function(e) {
            BN("i-report").getMetadata().then(function(t) {
                t.setGoal(e && e.id || null)
            }).done()
        }
    }), BEM.JSON.decl({
        name: "goals-panel",
        modName: "mode",
        modVal: "legacy"
    }, {
        onBlock: function(e) {
            e.mod("data-bind", "report")
        }
    }), BEM.DOM.decl({
        block: "goals-panel",
        modName: "mode",
        modVal: "legacy"
    }, {
        _refreshGoalEnable: function() {
            this._waitBlock.hide()
        }
    }), BEM.JSON.decl("light-constructor", {
        onBlock: function(e) {
            var t = e.param("type"),
                i = e.param("label") || BEM.I18N("light-constructor", t),
                n = e.content() || [];
            e.js({
                content: {
                    block: "constructor-menu",
                    headline: i,
                    mods: {
                        type: t
                    }
                },
                type: t
            }).mod("type", t).content(n.concat([{
                block: "button",
                mods: {
                    size: "s"
                },
                content: i,
                mix: [{
                    block: "light-constructor",
                    elem: "button"
                }]
            }]), !0)
        }
    }), BEM.JSON.decl("light-constructor", {
        onBlock: function(e) {
            e.defer(BN("i-report").getMetadata().then(function(t) {
                return t.constructorAllowed() ? void 0 : e.remove()
            }))
        }
    }), BEM.JSON.decl("light-constructor", {
        onElem: {
            load: function(e) {
                e.content({
                    block: "spin2",
                    mods: {
                        size: "m",
                        progress: "yes"
                    },
                    mix: [{
                        block: "counter-grants-popup",
                        elem: "spin"
                    }]
                })
            }
        }
    }), BEM.DOM.decl("light-constructor", {
        onSetMod: {
            js: function() {
                this._button = this.elem("button").bem("button"), this._button.on("click", this._onClick, this)
            }
        },
        hide: function() {
            this._popup && this._popup.isShown() && this._popup.hide()
        },
        _onClick: function() {
            BN("i-report").getReport().then(function(e) {
                var t = this.__self.getPopup(this.params.type, e.getId()),
                    i = this.findElem(t.domElem, "content").is(":empty"),
                    n = i ? BN("i-content").html(this.params.content) : Vow.fulfill();
                return this._popup = t, i && (this.setMod("loading", "yes"), this._renderLoader()), t.toggle(), n.then(this._renderContent.bind(this))
            }.bind(this)).done()
        },
        _renderContent: function(e) {
            this.setMod("preshow", "yes"), setTimeout(function() {
                this.delMod("loading"), e && (this._popup.setContent(e), this._initContent()), this.delMod("preshow")
            }.bind(this), 200)
        },
        _initContent: function() {
            var e = this.findBlockInside(this._popup.domElem, "constructor-menu");
            this._popup.focusSearchInput(), this._popup.on("hide", e.resetIncompatibility, e)
        },
        _renderLoader: function() {
            this._popup.setContent(BN("i-content").html({
                block: "light-constructor",
                elem: "load"
            }, !0))
        }
    }, {
        _popups: {},
        getPopup: function(e, t) {
            var i = this._popups[e];
            return t ? (i && i.reportId === t || (i && i.block && i.block.destruct(), i = {
                reportId: t
            }, i.block = jQuery(BN("i-content").html({
                block: "popup",
                mods: {
                    type: "modal",
                    position: "fixed",
                    search: "yes",
                    "has-close": "yes"
                },
                underMods: {
                    type: "paranja"
                },
                js: {
                    directions: ["bottom-left", "bottom-center", "bottom-right"]
                },
                mix: [{
                    block: "light-constructor",
                    elem: "popup"
                }],
                content: [{
                    elem: "close"
                }, {
                    elem: "content",
                    mix: [{
                        block: "light-constructor",
                        elem: "content"
                    }]
                }]
            }, !0)).bem("popup"), i.block.on("hide", this._onPopupHide, this), BN("constructor-menu").on(i.block.domElem, "change", i.block.hide, i.block), this._popups[e] = i), i.block) : i && i.block
        },
        cleanupPopups: function() {
            Object.keys(this._popups).forEach(function(e) {
                var t = this._popups[e];
                t && t.block && (BN("constructor-menu").un(t.block.domElem, "change", t.block.hide, t.block), t.block.destruct())
            }, this), this._popups = {}
        },
        _onPopupHide: function(e) {
            var t = e.block.findBlockInside("constructor-menu");
            t && t.reset()
        }
    }), BEM.JSON.decl("constructor-menu", {
        onBlock: function(e) {
            var t = e.params().headline;
            e.js(jQuery.extend(e.js(), {
                minCount: e.param("minCount"),
                maxCount: e.param("maxCount")
            })).content([t ? {
                elem: "headline",
                content: t
            } : "", {
                elem: "middle",
                content: [{
                    elem: "left-column",
                    content: [{
                        block: "search-input",
                        js: {
                            debounce: 0
                        }
                    }, {
                        elem: "menu",
                        items: e.blockParam("items")
                    }]
                }, {
                    elem: "right-column"
                }]
            }, {
                elem: "bottom",
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "action"
                    },
                    mix: [{
                        block: "constructor-menu",
                        elem: "apply"
                    }],
                    content: BEM.I18N("constructor-menu", "apply")
                }, {
                    elem: "hint"
                }]
            }, {
                elem: "incompatible-message",
                content: [{
                    elem: "incompatible-text",
                    mods: {
                        type: "metrics"
                    },
                    content: BEM.I18N("constructor-menu", "incompatible-metrics")
                }, {
                    elem: "incompatible-text",
                    mods: {
                        type: "dimensions"
                    },
                    content: BEM.I18N("constructor-menu", "incompatible-dimensions")
                }, {
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "action"
                    },
                    mix: [{
                        block: "constructor-menu",
                        elem: "incompatible-button"
                    }],
                    content: BEM.I18N("constructor-menu", "reset")
                }]
            }])
        },
        onElem: {
            "right-column": function(e) {
                e.wrap([{
                    block: "drag-sorter",
                    mods: e.param("dragSorterMods"),
                    mix: [{
                        block: "constructor-menu",
                        elem: "right-column"
                    }],
                    items: e.param("items")
                }])
            },
            menu: function(e) {
                var t = e.params();
                e.content({
                    elem: "rows",
                    highlight: t.highlight,
                    items: e.param("items")
                })
            },
            rows: function(e) {
                var t = e.params(),
                    i = t.level || 0;
                e.mix({
                    block: "constructor-menu",
                    elem: "level-" + i
                }), e.content(t.items.map(function(e) {
                    return {
                        elem: "row",
                        item: e,
                        level: i,
                        highlight: t.highlight
                    }
                }))
            },
            row: function(e) {
                var t = e.param("item"),
                    i = e.param("level") || 0,
                    n = e.param("highlight"),
                    o = e.mods() || {};
                o.checked = t.checked ? "yes" : t.fakeChecked ? "fake" : "", o.disabled = t.disabled ? "yes" : "", o.expanded = t.expanded ? "yes" : "", e.js({
                    id: t.id
                }).mods(o, !0).content([{
                    elem: "row-header",
                    item: t,
                    disabled: o.disabled,
                    highlight: n
                }, t.chld && {
                    elem: "rows",
                    level: i + 1,
                    items: t.chld,
                    highlight: n
                }])
            },
            label: function(e) {
                var t = e.param("item");
                e.tag("span").content({
                    block: "filtered-text",
                    text: t.name,
                    pattern: e.param("highlight"),
                    mix: [BN("i-report-metadata").isInternalAttribute(t) && {
                        block: "nda-message"
                    }]
                })
            },
            "row-checkbox": function(e) {
                var t = e.params(),
                    i = t.item,
                    n = t.disabled;
                return i.chld ? void e.remove() : void e.wrap([{
                    block: "checkbox",
                    mods: {
                        size: "m",
                        disabled: n ? "yes" : "",
                        checked: i.checked ? "yes" : "",
                        "fake-checked": i.fakeChecked ? "yes" : ""
                    },
                    mix: [{
                        block: "constructor-menu",
                        elem: "checkbox"
                    }],
                    content: i.chld ? "" : {
                        block: "constructor-menu",
                        elem: "label",
                        item: i,
                        highlight: t.highlight,
                        mix: [{
                            block: "checkbox",
                            elem: "label"
                        }]
                    }
                }])
            },
            "row-header": function(e) {
                var t = [],
                    i = e.params(),
                    n = i.item;
                t.push({
                    elem: "row-checkbox",
                    item: n,
                    disabled: i.disabled,
                    highlight: i.highlight
                }), n.chld ? t.push({
                    block: "constructor-menu",
                    elem: "label",
                    highlight: i.highlight,
                    item: n
                }, {
                    block: "icon",
                    elem: "arrow",
                    mix: [{
                        block: "constructor-menu",
                        elem: "open-arrow"
                    }]
                }, {
                    block: "icon",
                    elem: "moon"
                }) : n.description && t.push({
                    block: "hint-icon",
                    text: n.description
                }), e.beforeContent(t)
            }
        }
    }), BEM.DOM.decl("constructor-menu", {
        onSetMod: {
            js: function() {
                this.findBlockInside("search-input").on("search", this._searchHandler.bind(this)), this.findBlockInside("apply", "button").on("click", this.save, this), this.findBlockInside("incompatible-button", "button").on("click", this.resetIncompatibility, this), this._dragSorter = this.findBlockInside("drag-sorter"), this._dragSorter.on("change", this._sorterChangeHandler.bind(this)), BN("i-report").getMetadata().then(function(e) {
                    this._items = this._getItemsFromMeta(e), this._itemsState = JSON.stringify(this._items)
                }.bind(this)).done()
            }
        },
        onElemSetMod: {
            row: {
                checked: function(e, t, i) {
                    var n = e.children(this.buildSelector("row-header")),
                        o = this.findBlockInside(n, "checkbox");
                    o && ("yes" === i ? (o.setMod("checked", "yes"), o.delMod("fake-checked")) : "fake" === i ? (o.setMod("fake-checked", "yes"), o.delMod("checked")) : (o.delMod("fake-checked"), o.delMod("checked")))
                },
                disabled: function(e, t, i) {
                    var n = e.children(this.buildSelector("row-header")),
                        o = this.findBlockInside(n, "checkbox");
                    o && o.setMod(t, i)
                }
            }
        },
        save: function() {
            BN("i-report").getMetadata().then(function(e) {
                return this._setItemsToMeta(this._items, e) ? (this.trigger("change", this._items), void(this._itemsState !== JSON.stringify(this._items) && this.destruct())) : this._showIncompatibleMessage()
            }.bind(this)).done()
        },
        reset: function() {
            this._setFromMeta()
        },
        resetIncompatibility: function() {
            var e = this._resetIncompatiblePromise;
            e && !e.isResolved() && e.fulfill()
        },
        _showIncompatibleMessage: function() {
            this._resetIncompatiblePromise = Vow.promise(), this.setMod("incompatible", "yes"), this._resetIncompatiblePromise.then(function() {
                this.delMod("incompatible"), this.reset()
            }.bind(this)).done()
        },
        _sorterChangeHandler: function(e, t) {
            BN("i-report").getMetadata().then(function(e) {
                t = t.map(function(e) {
                    return e.id
                }), t.length !== this._items.length && this._setToCheckboxes(t, e), this._items = t
            }.bind(this)).done()
        },
        _setFromMeta: function() {
            BN("i-report").getMetadata().then(function(e) {
                var t = this._getItemsFromMeta(e);
                jQuery.equals(this._items, t) || (this._items = t, this._setToCheckboxes(this._items, e), this._setToSorter(this._items, e))
            }.bind(this)).done()
        },
        _checkboxChangeHandler: function(e, t) {
            this._items = t.sortItems(e, this._getItemsFromMeta(t)), this._setToSorter(this._items, t)
        },
        _setToCheckboxes: function(e, t) {
            var i = this._markTree(this._getTree(t), e);
            this._smartTreeRedraw(this.findElem("menu").children(this.buildSelector("rows")), i)
        },
        _searchHandler: function(e, t) {
            this._filter = t.trim(), BN("i-report").getMetadata().then(function(e) {
                var t = this._getTree(e);
                BN("i-content").replace(this.findElem("menu"), {
                    block: "constructor-menu",
                    mods: {
                        type: this.getMod("type")
                    },
                    elem: "menu",
                    items: this._markTree(t, this._getItemsFromMeta(e)),
                    highlight: this._filter
                }).then(function() {
                    this.trigger("repaint")
                }.bind(this)).done()
            }.bind(this)).done()
        },
        _markTree: function(e, t) {
            return this.__self.markChecked(e, t, this._getMinCount(), this._getMaxCount())
        },
        _applyFilter: function(e, t) {
            return e = e.toLowerCase(), t = jQuery.extend(!0, [], t), t.filter(function(t) {
                var i, n = -1 !== t.name.toLowerCase().indexOf(e);
                return t.chld && (i = this._applyFilter(e, t.chld), n || (t.chld = i), t.expanded = !0), t.chld && t.chld.length || n
            }, this)
        },
        _getMinCount: function() {
            return this.params.minCount
        },
        _getMaxCount: function() {
            return this.params.maxCount
        },
        _notEnoughError: function() {
            throw new Error("should be implemented in mods/childs")
        },
        _tooManyError: function() {
            throw new Error("should be implemented in mods/childs")
        },
        _errorMessage: function(e) {
            alert(e)
        },
        _findItemInTree: function(e, t) {
            var i = !1;
            return e.some(function(e) {
                return e.id === t ? (i = e, !0) : e.chld ? (i = this._findItemInTree(e.chld, t), Boolean(i)) : !1
            }, this), i
        },
        _tryApply: function(e, t, i) {
            return e.reduce(function(e, n) {
                return n.dim && n.disabled && i !== (-1 !== t.indexOf(n.dim)) && e++, n.chld && (e += this._tryApply(n.chld, t, i)), e
            }.bind(this), 0)
        },
        _getNewValueOnSubTree: function(e, t, i) {
            var n = "yes" !== t;
            return e.chld && ("fake" === t && this._tryApply(e.chld, i, n) && (n = !n), i = e.chld.reduce(function(e, t) {
                return this._getNewValueOnSubTree(t, n ? "" : "yes", e)
            }.bind(this), i)), !e.dim || e.disabled ? i : n ? -1 !== i.indexOf(e.id) ? i : this._getMaxCount() <= i.length ? i : (i.push(e.id), i) : -1 === i.indexOf(e.id) ? i : this._getMinCount() >= i.length ? i : i.filter(function(t) {
                return t !== e.id
            })
        },
        _getNewValueOnTree: function(e, t, i, n) {
            var o = this._findItemInTree(e, t);
            return this._getNewValueOnSubTree(o, i, n)
        },
        _getIdListFromTree: function(e, t) {
            return e.reduce(function(e, t) {
                return e.push(t.id), t.chld ? this._getIdListFromTree(t.chld, e) : e
            }.bind(this), t || [])
        },
        _handleDisabledClick: function(e, t) {
            BN("i-report").getMetadata().then(function(e) {
                var i = this._getItemsFromMeta(e),
                    n = this._getMinCount(),
                    o = this._getMaxCount();
                "yes" !== t && i.length >= o ? this._tooManyError(o) : "yes" === t && i.length <= n && this._notEnoughError(n)
            }.bind(this)).done()
        },
        _onCheckClick: function(e) {
            var t = this.getMod(e, "checked"),
                i = this.elemParams(e);
            return this.hasMod(e, "disabled", "yes") ? this._handleDisabledClick(e, t) : void BN("i-report").getMetadata().then(function(e) {
                var n = this._getTree(e),
                    o = this._getIdListFromTree(n),
                    s = this._items,
                    r = this._getNewValueOnTree(n, i.id, t, s),
                    a = BN("i-util");
                this._setToCheckboxes(r, e), r = a.arrayUnique(a.arrayDiff(s, o).concat(r)), this._checkboxChangeHandler(r, e)
            }.bind(this)).done()
        },
        _expandToggle: function(e) {
            this.toggleMod(e, "expanded", "yes", "")
        },
        _smartTreeRedraw: function(e, t, i) {
            var n = e.children(this.buildSelector("row")),
                o = [].reduce.call(n, function(e, t) {
                    return t = this.elemify(jQuery(t)), e[this.elemParams(t).id] = t, e
                }.bind(this), {}),
                s = BN("i-util").arrayDiff(Object.keys(o), t.map(function(e) {
                    return e.id
                }));
            i = i || 0, s.forEach(function(e) {
                BEM.DOM.destruct(o[e]), delete o[e]
            }), t.forEach(function(t) {
                var n, s = o[t.id];
                return s ? (Boolean(t.disabled) !== this.hasMod(s, "disabled", "yes") && this.setMod(s, "disabled", t.disabled ? "yes" : ""), this.getMod(s, "checked") !== (t.checked ? "yes" : t.fakeChecked ? "fake" : "") && this.setMod(s, "checked", t.checked ? "yes" : t.fakeChecked ? "fake" : ""), n = s.children(this.buildSelector("rows")), void(!n.length && t.chld ? BN("i-content").append(e, {
                    block: "constructor-menu",
                    mods: {
                        type: this.getMod("type")
                    },
                    elem: "rows",
                    items: t.chld,
                    level: i + 1
                }) : !n.length || t.chld && t.chld.length ? n.length && t.chld && t.chld.length && this._smartTreeRedraw(n, t.chld, i + 1) : BEM.DOM.destruct(n))) : void BN("i-content").append(e, {
                    block: "constructor-menu",
                    elem: "row",
                    mods: {
                        type: this.getMod("type")
                    },
                    item: t,
                    level: i
                })
            }.bind(this))
        }
    }, {
        live: function() {
            return this.liveBindTo("row-header", "click", function(e) {
                var t = jQuery(e.target),
                    i = t.closest(this.buildSelector("row"));
                this.findBlockOn(t, "hint-icon") || (this.findElem(i, "rows").length ? this._expandToggle(i) : this._onCheckClick(i))
            }), this.liveBindTo("checkbox", "click", function(e) {
                var t = jQuery(e.target).closest(this.buildSelector("row"));
                e.stopPropagation(), this._onCheckClick(t)
            }), !1
        },
        markChecked: function(e, t, i, n) {
            var o = jQuery.extend(!0, [], e);
            return this._markChecked(o, t, i, n), o
        },
        _markChecked: function(e, t, i, n) {
            return t && t.length ? e.reduce(function(e, o) {
                var s;
                return o.checked = -1 !== t.indexOf(o.id), o.checked && t.length <= i && (o.disabled = !0), !o.checked && t.length >= n && (o.disabled = !0), o.chld && (s = this._markChecked(o.chld, t, i, n), o.checked = s.checked === o.chld.length && s.checked > 0, o.disabled = o.disabled || s.disabled === o.chld.length, o.fakeChecked = !o.checked && (s.checked > 0 || s.fake > 0)), {
                    checked: e.checked + (o.checked ? 1 : 0),
                    fake: e.fake + (o.fakeChecked ? 1 : 0),
                    disabled: e.disabled + (o.disabled ? 1 : 0)
                }
            }.bind(this), {
                checked: 0,
                fake: 0,
                disabled: 0
            }) : {
                checked: 0,
                fake: 0
            }
        }
    }), BEM.JSON.decl("drag-sorter", {
        onBlock: function(e) {
            var t = e.param("items");
            e.js({
                items: t
            }), e.content({
                elem: "items",
                items: t
            })
        },
        onElem: {
            items: function(e) {
                var t = e.param("items");
                e.content([t.map(function(e, t) {
                    return {
                        elem: "item",
                        item: e,
                        index: t,
                        mods: {
                            drag: "no"
                        }
                    }
                }), {
                    elem: "insert-marker",
                    mods: {
                        hidden: "yes"
                    }
                }])
            },
            item: function(e) {
                var t = e.param("item");
                t.fixed && e.mod("fixed", "yes"), e.js({
                    index: e.param("index")
                }).beforeContent([t.fixed ? "" : {
                    block: "icon",
                    elem: "drag"
                }, {
                    elem: "label",
                    tag: "span",
                    content: BN("i-string").escapeHTML(t.name)
                }])
            }
        }
    }), BEM.DOM.decl("drag-sorter", {
        _itemsIdsMap: null,
        _itemsIdsOrder: null,
        onSetMod: {
            js: function() {
                this._setItems(this.params.items), this._initDrag()
            }
        },
        setItems: function(e) {
            this._items = e, this._setItems(e), this._redraw(), this._itemsIdsOrder = this._calcItemsOrder(), this._initDrag()
        },
        getItems: function() {
            return [].map.call(this.findElem("item"), function(e) {
                return this._itemsIdsMap[this.elemParams(jQuery(e)).index]
            }, this)
        },
        _calcItemsOrder: function() {
            var e = [];
            return [].forEach.call(this.findElem("item"), function(t) {
                t = this.elemify(t, "item"), this.hasMod(t, "fixed", "yes") || e.push(this.elemParams(t).index)
            }, this), e
        },
        _initDrag: function() {
            this._insertMarker = this.findElem("insert-marker"), this.findElem("item").drag("start", this._startDrag.bind(this)).drag("drag", this._drag.bind(this)).drag("end", this._stopDrag.bind(this))
        },
        _startDrag: function(e, t) {
            var i = jQuery(t.target);
            return this.hasMod(i, "fixed", "yes") ? (e.preventDefault(), !1) : (this.setMod(i, "drag", "yes"), i.offset({
                top: t.originalY,
                left: t.originalX
            }), this._insertMarker.insertBefore(i), void this.delMod(this._insertMarker, "hidden"))
        },
        _drag: function(e, t) {
            var i, n, o = t.startX + t.deltaX,
                s = t.startY + t.deltaY,
                r = jQuery(t.target);
            r.offset({
                top: t.offsetY,
                left: t.offsetX
            }), i = [].filter.call(this.findElem("item", "drag", "no"), function(e) {
                return e = jQuery(e), s > e.offset().top && s < e.offset().top + e.outerHeight()
            }), 0 !== i.length && (i.some(function(e) {
                return e = jQuery(e), e.offset().left + e.width() / 2 > o ? (n = e, !0) : void 0
            }), n ? this._insertMarker.insertBefore(n) : this._insertMarker.insertAfter(i[i.length - 1]))
        },
        _stopDrag: function(e, t) {
            var i, n = jQuery(t.target),
                o = n.prev(),
                s = o.length ? null : n.next();
            this.setMod(n, "drag", "no"), this.setMod(this._insertMarker, "hidden", "yes"), n.insertAfter(this._insertMarker), i = this._calcItemsOrder(), jQuery.equals(i, this._itemsIdsOrder) ? o.length ? n.insertAfter(o) : n.insertBefore(s) : (BEM.DOM.prepend(this.findElem("items"), this.findElem("item", "fixed", "yes")), this._itemsIdsOrder = i, this._triggerChanges())
        },
        _setItems: function(e) {
            this._itemsIdsMap = e.reduce(function(e, t, i) {
                return e[i] = t, e
            }, {})
        },
        _redraw: function() {
            BEM.DOM.replace(this.findElem("items"), BN("i-content").html({
                block: "drag-sorter",
                mods: this.getInitialMods(),
                elem: "items",
                items: this._items
            }, !0))
        },
        _triggerChanges: function() {
            this.trigger("change", this.getItems())
        }
    }, {
        live: function() {
            return this.liveBindTo("control", "click", function(e) {
                var t = this.elemify(e.data.domElem, "control"),
                    i = this[this.elemParams(t).action];
                i instanceof Function && i.call(this, t), e.stopPropagation()
            }), !1
        }
    }),
    function(e) {
        e.fn.drag = function(t, i, n) {
            var o = "string" == typeof t ? t : "",
                s = e.isFunction(t) ? t : e.isFunction(i) ? i : null;
            return 0 !== o.indexOf("drag") && (o = "drag" + o), n = (t == s ? i : n) || {}, s ? this.bind(o, n, s) : this.trigger(o)
        };
        var t = e.event,
            i = t.special,
            n = i.drag = {
                defaults: {
                    which: 1,
                    distance: 0,
                    not: ":input",
                    handle: null,
                    relative: !1,
                    drop: !0,
                    click: !1
                },
                datakey: "dragdata",
                noBubble: !0,
                add: function(t) {
                    var i = e.data(this, n.datakey),
                        o = t.data || {};
                    i.related += 1, e.each(n.defaults, function(e, t) {
                        void 0 !== o[e] && (i[e] = o[e])
                    })
                },
                remove: function() {
                    e.data(this, n.datakey).related -= 1
                },
                setup: function() {
                    if (!e.data(this, n.datakey)) {
                        var i = e.extend({
                            related: 0
                        }, n.defaults);
                        e.data(this, n.datakey, i), t.add(this, "touchstart mousedown", n.init, i), this.attachEvent && this.attachEvent("ondragstart", n.dontstart)
                    }
                },
                teardown: function() {
                    var i = e.data(this, n.datakey) || {};
                    i.related || (e.removeData(this, n.datakey), t.remove(this, "touchstart mousedown", n.init), n.textselect(!0), this.detachEvent && this.detachEvent("ondragstart", n.dontstart))
                },
                init: function(o) {
                    if (!n.touched) {
                        var s, r = o.data;
                        if (!(0 != o.which && r.which > 0 && o.which != r.which) && !e(o.target).is(r.not) && (!r.handle || e(o.target).closest(r.handle, o.currentTarget).length) && (n.touched = "touchstart" == o.type ? this : null, r.propagates = 1, r.mousedown = this, r.interactions = [n.interaction(this, r)], r.target = o.target, r.pageX = o.pageX, r.pageY = o.pageY, r.dragging = null, s = n.hijack(o, "draginit", r), r.propagates)) return s = n.flatten(s), s && s.length && (r.interactions = [], e.each(s, function() {
                            r.interactions.push(n.interaction(this, r))
                        })), r.propagates = r.interactions.length, r.drop !== !1 && i.drop && i.drop.handler(o, r), n.textselect(!1), n.touched ? t.add(n.touched, "touchmove touchend", n.handler, r) : t.add(document, "mousemove mouseup", n.handler, r), !n.touched || r.live ? !1 : void 0
                    }
                },
                interaction: function(t, i) {
                    var o = e(t)[i.relative ? "position" : "offset"]() || {
                        top: 0,
                        left: 0
                    };
                    return {
                        drag: t,
                        callback: new n.callback,
                        droppable: [],
                        offset: o
                    }
                },
                handler: function(o) {
                    var s = o.data;
                    switch (o.type) {
                        case !s.dragging && "touchmove":
                            o.preventDefault();
                        case !s.dragging && "mousemove":
                            if (Math.pow(o.pageX - s.pageX, 2) + Math.pow(o.pageY - s.pageY, 2) < Math.pow(s.distance, 2)) break;
                            o.target = s.target, n.hijack(o, "dragstart", s), s.propagates && (s.dragging = !0);
                        case "touchmove":
                            o.preventDefault();
                        case "mousemove":
                            if (s.dragging) {
                                if (n.hijack(o, "drag", s), s.propagates) {
                                    s.drop !== !1 && i.drop && i.drop.handler(o, s);
                                    break
                                }
                                o.type = "mouseup"
                            }
                        case "touchend":
                        case "mouseup":
                        default:
                            n.touched ? t.remove(n.touched, "touchmove touchend", n.handler) : t.remove(document, "mousemove mouseup", n.handler), s.dragging && (s.drop !== !1 && i.drop && i.drop.handler(o, s), n.hijack(o, "dragend", s)), n.textselect(!0), s.click === !1 && s.dragging && e.data(s.mousedown, "suppress.click", (new Date).getTime() + 5), s.dragging = n.touched = !1
                    }
                },
                hijack: function(i, o, s, r, a) {
                    if (s) {
                        var l, c, d, u = {
                                event: i.originalEvent,
                                type: i.type
                            },
                            h = o.indexOf("drop") ? "drag" : "drop",
                            m = r || 0,
                            p = isNaN(r) ? s.interactions.length : r;
                        i.type = o, i.originalEvent = null, s.results = [];
                        do
                            if (c = s.interactions[m]) {
                                if ("dragend" !== o && c.cancelled) continue;
                                d = n.properties(i, s, c), c.results = [], e(a || c[h] || s.droppable).each(function(r, a) {
                                    return d.target = a, i.isPropagationStopped = function() {
                                        return !1
                                    }, l = a ? t.dispatch.call(a, i, d) : null, l === !1 ? ("drag" == h && (c.cancelled = !0, s.propagates -= 1), "drop" == o && (c[h][r] = null)) : "dropinit" == o && c.droppable.push(n.element(l) || a), "dragstart" == o && (c.proxy = e(n.element(l) || c.drag)[0]), c.results.push(l), delete i.result, "dropinit" !== o ? l : void 0
                                }), s.results[m] = n.flatten(c.results), "dropinit" == o && (c.droppable = n.flatten(c.droppable)), "dragstart" != o || c.cancelled || d.update()
                            }
                        while (++m < p);
                        return i.type = u.type, i.originalEvent = u.event, n.flatten(s.results)
                    }
                },
                properties: function(e, t, i) {
                    var o = i.callback;
                    return o.drag = i.drag, o.proxy = i.proxy || i.drag, o.startX = t.pageX, o.startY = t.pageY, o.deltaX = e.pageX - t.pageX, o.deltaY = e.pageY - t.pageY, o.originalX = i.offset.left, o.originalY = i.offset.top, o.offsetX = o.originalX + o.deltaX, o.offsetY = o.originalY + o.deltaY, o.drop = n.flatten((i.drop || []).slice()), o.available = n.flatten((i.droppable || []).slice()), o
                },
                element: function(e) {
                    return e && (e.jquery || 1 == e.nodeType) ? e : void 0
                },
                flatten: function(t) {
                    return e.map(t, function(t) {
                        return t && t.jquery ? e.makeArray(t) : t && t.length ? n.flatten(t) : t
                    })
                },
                textselect: function(t) {
                    e(document)[t ? "unbind" : "bind"]("selectstart", n.dontstart).css("MozUserSelect", t ? "" : "none"), document.unselectable = t ? "off" : "on"
                },
                dontstart: function() {
                    return !1
                },
                callback: function() {}
            };
        n.callback.prototype = {
            update: function() {
                i.drop && this.available.length && e.each(this.available, function(e) {
                    i.drop.locate(this, e)
                })
            }
        };
        var o = t.dispatch;
        t.dispatch = function(t) {
            return e.data(this, "suppress." + t.type) - (new Date).getTime() > 0 ? void e.removeData(this, "suppress." + t.type) : o.apply(this, arguments)
        };
        var s = t.fixHooks.touchstart = t.fixHooks.touchmove = t.fixHooks.touchend = t.fixHooks.touchcancel = {
            props: "clientX clientY pageX pageY screenX screenY".split(" "),
            filter: function(t, i) {
                if (i) {
                    var n = i.touches && i.touches[0] || i.changedTouches && i.changedTouches[0] || null;
                    n && e.each(s.props, function(e, i) {
                        t[i] = n[i]
                    })
                }
                return t
            }
        };
        i.draginit = i.dragstart = i.dragend = n
    }(jQuery), BEM.JSON.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "metrics"
    }, {
        onElem: {
            "right-column": function(e) {
                e.param("dragSorterMods", {
                    removable: "yes"
                })
            },
            hint: function(e) {
                e.content(BEM.I18N("constructor-menu", "metrics-hint"))
            }
        }
    }), BEM.DOM.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "metrics"
    }, {
        dataBindings: {
            preset: {
                set: "_setFromMeta"
            }
        },
        _setItemsToMeta: function(e, t) {
            return t.areMetricsCompatible(e) ? (t.setMetrics(e), !0) : !1
        },
        _setToSorter: function(e, t) {
            var i = t.getMetricsMeta(e),
                n = t.getFixedMetrics();
            this._dragSorter.setItems(i.map(function(t) {
                return {
                    id: t.dim,
                    name: t.name || t.dim,
                    fixed: -1 !== n.indexOf(t.dim) || 1 === e.length
                }
            }))
        },
        _getTree: function(e) {
            var t = e.getAllowedMetricsTree();
            return this._filter && (t = this._applyFilter(this._filter, t)), t
        },
        _getItemsFromMeta: function(e) {
            return e.getMetrics()
        },
        _notEnoughError: function(e) {
            this._errorMessage(BEM.I18N("constructor-menu", "not-enough-metrics", {
                min: e
            }))
        },
        _tooManyError: function(e) {
            this._errorMessage(BEM.I18N("constructor-menu", "too-many-metrics", {
                max: e
            }))
        }
    }), BEM.JSON.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "metrics"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getMetadata().then(function(t) {
                var i = t.getAllowedMetricsTree(),
                    n = t.getMetrics(),
                    o = 1,
                    s = t.getMaxMetricsCount();
                i = BN("constructor-menu").markChecked(i, n, o, s), e.param("items", i), e.param("minCount", o), e.param("maxCount", s)
            }))
        },
        onElem: {
            "right-column": function(e) {
                e.defer(BN("i-report").getMetadata().then(function(t) {
                    var i = t.getMetricsMeta(),
                        n = t.getFixedMetrics();
                    e.param("items", i.map(function(e) {
                        return {
                            id: e.dim,
                            name: e.name || e.dim,
                            fixed: -1 !== n.indexOf(e.dim) || 1 === i.length
                        }
                    }))
                }))
            }
        }
    }), BEM.JSON.decl({
        name: "drag-sorter",
        modName: "removable",
        modVal: "yes"
    }, {
        onElem: {
            item: function(e) {
                var t = e.param("item");
                t.fixed || e.beforeContent({
                    elem: "control",
                    js: {
                        action: "removeHandler"
                    },
                    content: {
                        block: "icon",
                        elem: "close",
                        mods: {
                            type: "light"
                        },
                        attrs: {
                            title: BEM.I18N("drag-sorter", "button-delete")
                        }
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        name: "drag-sorter",
        modName: "removable",
        modVal: "yes"
    }, {
        removeHandler: function(e) {
            var t = e.closest(this.buildSelector("item")),
                i = this.elemParams(t).index;
            BEM.DOM.destruct(t), delete this._itemsIdsMap[i], this._triggerChanges()
        }
    }), BN.addDecl("constructor-menu").staticProp({
        markGroups: function(e) {
            return e.map(function(e) {
                return e.chld && (e.disabled = !0, this.markGroups(e.chld)), e
            }, this)
        }
    }), BEM.JSON.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "dimensions"
    }, {
        onElem: {
            "right-column": function(e) {
                e.param("dragSorterMods", {
                    removable: "yes"
                })
            },
            hint: function(e) {
                e.content(BEM.I18N("constructor-menu", "dimensions-hint-1"))
            }
        }
    }), BEM.DOM.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "dimensions"
    }, {
        dataBindings: {
            preset: {
                set: "_setFromMeta"
            }
        },
        _setItemsToMeta: function(e, t) {
            return t.areDimensionsCompatible(e) ? (t.setDimensions(e), !0) : !1
        },
        _setToSorter: function(e, t) {
            var i = t.getVisibleDimensionsMeta(e);
            this._dragSorter.setItems(i.map(function(e) {
                return {
                    id: e.dim,
                    name: e.name || e.dim
                }
            }.bind(this)))
        },
        _checkboxChangeHandler: function(e, t) {
            this._items = e, this._setToSorter(e, t)
        },
        _handleDisabledClick: function(e) {
            return this.findElem(e, "rows").length ? void 0 : this.__base.apply(this, arguments)
        },
        _markTree: function() {
            var e = this.__base.apply(this, arguments);
            return this.__self.markGroups(e)
        },
        _getTree: function(e) {
            var t = e.getAllowedVisibleDimensionsTree();
            return this._filter && (t = this._applyFilter(this._filter, t)), t
        },
        _getItemsFromMeta: function(e) {
            return e.getVisibleDimensions()
        },
        _notEnoughError: function(e) {
            this._errorMessage(BEM.I18N("constructor-menu", "not-enough-dimensions", {
                min: e
            }))
        },
        _tooManyError: function(e) {
            this._errorMessage(BEM.I18N("constructor-menu", "too-many-dimensions", {
                max: e
            }))
        }
    }), BEM.JSON.decl({
        name: "constructor-menu",
        modName: "type",
        modVal: "dimensions"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getMetadata().then(function(t) {
                var i = t.getAllowedVisibleDimensionsTree(),
                    n = t.getVisibleDimensions(),
                    o = 0,
                    s = t.getMaxDimensionsCount();
                i = BN("constructor-menu").markChecked(i, n, o, s), i = BN("constructor-menu").markGroups(i), e.param("items", i), e.param("minCount", o), e.param("maxCount", s)
            }))
        },
        onElem: {
            "right-column": function(e) {
                e.defer(BN("i-report").getMetadata().then(function(t) {
                    var i = t.getVisibleDimensionsMeta();
                    e.param("items", i.map(function(e) {
                        return {
                            id: e.dim,
                            name: e.name || e.dim
                        }
                    }))
                }))
            }
        }
    }), BEM.JSON.decl({
        name: "light-constructor",
        modName: "advice",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.content([{
                block: "advice",
                mods: {
                    orient: "bottom"
                },
                type: "custom-reports",
                index: 4
            }])
        }
    }), BEM.JSON.decl("report-trust-rows", {
        onBlock: function(e) {
            e.mod("disabled", "yes"), e.js(!0), e.attr("title", BEM.I18N("report-trust-rows", "exclude-insignificant")), e.content([{
                block: "button",
                mods: {
                    pseudo: "yes",
                    "only-icon": "yes",
                    size: "s",
                    disabled: "yes",
                    theme: "clear"
                },
                mix: [{
                    block: "report-trust-rows",
                    elem: "settings-button"
                }],
                content: {
                    block: "icon",
                    elem: "settings",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }
            }, {
                elem: "checkbox-holder"
            }, {
                block: "popup",
                js: {
                    directions: ["top-left", "top-center", "top-right"]
                },
                mix: [{
                    block: "report-trust-rows",
                    elem: "popup"
                }],
                content: [{
                    elem: "tail"
                }, {
                    elem: "content",
                    mix: {
                        block: "report-trust-rows",
                        elem: "popup-content"
                    }
                }]
            }])
        },
        onElem: {
            "checkbox-holder": function(e) {
                e.tag("label").content([{
                    block: "checkbox",
                    mix: {
                        block: "report-trust-rows",
                        elem: "checkbox"
                    },
                    mods: {
                        size: "s",
                        disabled: "yes"
                    }
                }, BEM.I18N("report-trust-rows", "exclude-insignificant")])
            }
        }
    }),
    function() {
        var e = .05,
            t = .95;
        BEM.DOM.decl("report-trust-rows", {
            dataBindings: {
                confidence: {
                    event: "change"
                },
                "data-table.sort": {
                    initAccessor: "_changeSort",
                    set: "_changeSort"
                }
            },
            onSetMod: {
                js: function() {
                    this._checkbox = this.findBlockOn("checkbox", "checkbox"), this._checkbox.on("change", this._onCheckboxChange, this), this._settingsButton = this.findBlockOn("settings-button", "button"), this._popup = this.findBlockOn("popup", "popup"), this._popup.on("hide", this._onPopupHide, this), this._settingsButton.on("click", this._onSettingsClick, this)
                },
                disabled: {
                    "": function() {
                        this._checkbox.delMod("disabled"), this._settingsButton.delMod("disabled")
                    },
                    yes: function() {
                        this._checkbox.delMod("checked"), this._checkbox.setMod("disabled", "yes"), this._settingsButton.setMod("disabled", "yes")
                    }
                }
            },
            _confidenceOptions: {
                maxDeviation: e,
                confidenceLevel: t
            },
            _onSettingsClick: function() {
                var e = this;
                this._popupInner ? this._popup.toggle() : BN("i-content").html({
                    block: this.__self.getName(),
                    elem: "popup-inner"
                }).then(function(t) {
                    e._popupInner = jQuery(t), e._popup.setContent(e._popupInner), e.domElem = e.domElem.add(e._popupInner), e._maxDeviationInput = e.findBlockOn("max-deviation", "adjustable-input"), e._confidenceLevelInput = e.findBlockOn("confidence-level", "adjustable-input"), e._cancelButton = e.findBlockOn("cancel-button", "button"), e._applyButton = e.findBlockOn("apply-button", "button"), e._cancelButton.on("click", e._onCancelClick, e), e._applyButton.on("click", e._onApplyClick, e), e._popup.show(e._settingsButton)
                })
            },
            _onApplyClick: function() {
                this._confidenceOptions.maxDeviation = (this._maxDeviationInput.val() / 100).toFixed(2), this._confidenceOptions.confidenceLevel = (this._confidenceLevelInput.val() / 100).toFixed(2), this._popup.hide(), this._checkbox.setMod("checked", "yes"), this._triggerChange()
            },
            _onPopupHide: function() {
                this._maxDeviationInput.val(100 * this._confidenceOptions.maxDeviation), this._confidenceLevelInput.val(100 * this._confidenceOptions.confidenceLevel)
            },
            _onCancelClick: function() {
                this._popup.hide()
            },
            _triggerChange: function() {
                this._checkbox.isChecked() ? this.trigger("change", this._confidenceOptions) : this.trigger("change", null)
            },
            _onCheckboxChange: function() {
                this._triggerChange()
            },
            _changeSort: function(e) {
                e && e.metrics && BN("i-report").getMetadata().then(function(t) {
                    var i = t.getMetricMeta(e.metrics);
                    this.toggleMod("disabled", "", "yes", Boolean(i && i.support_confidence))
                }.bind(this)).done()
            }
        }), BEM.JSON.decl("report-trust-rows", {
            onElem: {
                "option-control": function(e) {
                    var t = e.params();
                    e.content([{
                        elem: "option-control-title",
                        content: t.title
                    }, {
                        elem: "option-control-about",
                        content: t.about
                    }, {
                        block: "adjustable-input",
                        value: t.value,
                        mix: {
                            block: "report-trust-rows",
                            elem: t.mixElem
                        },
                        min: 1,
                        max: 99,
                        formatter: {
                            patterns: [{
                                "^0": "1%"
                            }, {
                                "^[1-9][0-9]": "{{99}}%"
                            }, {
                                "^[1-9]": "{{9}}%"
                            }, {
                                "*": "1%"
                            }],
                            persistent: !0
                        }
                    }])
                },
                "popup-inner": function(i) {
                    i.content([{
                        elem: "option-control",
                        title: BEM.I18N("report-trust-rows", "max-deviation-title"),
                        about: BEM.I18N("report-trust-rows", "max-deviation-about"),
                        mixElem: "max-deviation",
                        value: 100 * e
                    }, {
                        elem: "option-control",
                        title: BEM.I18N("report-trust-rows", "confidence-level-title"),
                        about: BEM.I18N("report-trust-rows", "confidence-level-about"),
                        mixElem: "confidence-level",
                        value: 100 * t
                    }, {
                        elem: "controls",
                        content: [{
                            block: "button",
                            mix: {
                                block: "report-trust-rows",
                                elem: "apply-button"
                            },
                            mods: {
                                size: "s",
                                theme: "action",
                                pseudo: "yes"
                            },
                            content: BEM.I18N("report-trust-rows", "apply")
                        }, {
                            block: "button",
                            mix: {
                                block: "report-trust-rows",
                                elem: "cancel-button"
                            },
                            mods: {
                                size: "s",
                                pseudo: "yes"
                            },
                            content: BEM.I18N("report-trust-rows", "cancel")
                        }]
                    }])
                }
            }
        })
    }(), BEM.JSON.decl("adjustable-input", {
        onBlock: function(e) {
            var t = e.param("max") || 1 / 0,
                i = e.param("min") || 0,
                n = e.param("value") || i,
                o = e.param("formatter");
            e.js({
                max: t,
                min: i,
                formatter: o
            }), e.content([{
                block: "button",
                mix: [{
                    block: "adjustable-input",
                    elem: "button"
                }],
                mods: {
                    size: "s",
                    side: "left",
                    "only-icon": "yes"
                },
                content: {
                    block: "icon",
                    elem: "minus",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }
            }, {
                block: "input",
                mix: {
                    block: "adjustable-input",
                    elem: "input"
                },
                value: n,
                mods: {
                    size: "s",
                    type: "normal",
                    clear: "no"
                },
                content: {
                    elem: "control",
                    mix: {
                        block: "adjustable-input",
                        elem: "input-control"
                    }
                }
            }, {
                block: "button",
                mix: [{
                    block: "adjustable-input",
                    elem: "button"
                }],
                mods: {
                    size: "s",
                    side: "right",
                    "only-icon": "yes"
                },
                content: {
                    block: "icon",
                    elem: "plus",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }
            }])
        }
    }), BEM.DOM.decl("adjustable-input", {
        onSetMod: {
            js: function() {
                BN("button").on(this.elem("button"), "press", this._onButtonPress, this), BN("button").on(this.elem("button"), "release", this._onButtonRelease, this), this._input = this.findBlockOn("input", "input"), this.params.formatter && this._input.elem("control").formatter(this.params.formatter), this._input.on("change", this._onInputChange, this)
            }
        },
        val: function(e) {
            var t = parseInt(this._input.val());
            return 0 === arguments.length ? t : void this._input.val(this._input.val().replace(t, e))
        },
        destruct: function() {
            BN("button").un(this.elem("button"), "press", this._onButtonPress, this), BN("button").un(this.elem("button"), "release", this._onButtonRelease, this), this.__base.apply(this, arguments)
        },
        _onInputChange: function() {
            this.trigger("change", {
                val: this.val()
            })
        },
        _onButtonRelease: function() {
            this._repeatTimeout && clearTimeout(this._repeatTimeout)
        },
        _REPEAT_DELAY: 200,
        _onButtonPress: function(e) {
            this._onButtonClick(e), this._repeatTimeout = setTimeout(function() {
                this._onButtonPress(e)
            }.bind(this), this._REPEAT_DELAY)
        },
        _onButtonClick: function(e) {
            var t, i, n;
            switch (e.block.getMod("side")) {
                case "right":
                    t = 1;
                    break;
                case "left":
                    t = -1;
                    break;
                default:
                    throw new Error("Unknow button side")
            }
            i = this.val(), n = i + t, n <= this.params.max && n >= this.params.min && this.val(n)
        }
    }),
    function() {
        ! function(e, t) {
            "function" == typeof define && define.amd ? define(["jQuery"], t) : t("object" == typeof exports ? require("jQuery") : e.jQuery)
        }(this, function(e) {
            var t = function() {
                    var e = {},
                        t = 4,
                        i = new RegExp("{{([^}]+)}}", "g"),
                        n = function(e) {
                            for (var t, n = []; t = i.exec(e);) n.push(t);
                            return n
                        };
                    return e.parse = function(e) {
                        var i = {
                                inpts: {},
                                chars: {}
                            },
                            o = n(e),
                            s = e.length,
                            r = 0,
                            a = 0,
                            l = 0,
                            c = function(e) {
                                for (var n = e.length, o = 0; n > o; o++) i.inpts[a] = e.charAt(o), a++;
                                r++, l += e.length + t - 1
                            };
                        for (l; s > l; l++) r < o.length && l === o[r].index ? c(o[r][1]) : i.chars[l - r * t] = e.charAt(l);
                        return i.mLength = l - r * t, i
                    }, e
                }(),
                i = function() {
                    var e = {};
                    "undefined" != typeof navigator ? navigator.userAgent : null;
                    return e.extend = function(e) {
                        for (var t = 1; t < arguments.length; t++)
                            for (var i in arguments[t]) e[i] = arguments[t][i];
                        return e
                    }, e.addChars = function(e, t, i) {
                        return e.substr(0, i) + t + e.substr(i, e.length)
                    }, e.removeChars = function(e, t, i) {
                        return e.substr(0, t) + e.substr(i, e.length)
                    }, e.isBetween = function(e, t) {
                        return t.sort(function(e, t) {
                            return e - t
                        }), e > t[0] && e < t[1]
                    }, e.addListener = function(e, t, i) {
                        return "undefined" != typeof e.addEventListener ? e.addEventListener(t, i, !1) : e.attachEvent("on" + t, i)
                    }, e.preventDefault = function(e) {
                        return e.preventDefault ? e.preventDefault() : e.returnValue = !1
                    }, e.getClip = function(e) {
                        return e.clipboardData ? e.clipboardData.getData("Text") : window.clipboardData ? window.clipboardData.getData("Text") : void 0
                    }, e.getMatchingKey = function(e, t, i) {
                        for (var n in i) {
                            var o = i[n];
                            if (e === o.which && t === o.keyCode) return n
                        }
                    }, e.isDelKeyDown = function(t, i) {
                        var n = {
                            backspace: {
                                which: 8,
                                keyCode: 8
                            },
                            "delete": {
                                which: 46,
                                keyCode: 46
                            }
                        };
                        return e.getMatchingKey(t, i, n)
                    }, e.isDelKeyPress = function(t, i) {
                        var n = {
                            backspace: {
                                which: 8,
                                keyCode: 8,
                                shiftKey: !1
                            },
                            "delete": {
                                which: 0,
                                keyCode: 46
                            }
                        };
                        return e.getMatchingKey(t, i, n)
                    }, e.isSpecialKeyPress = function(t, i) {
                        var n = {
                            tab: {
                                which: 0,
                                keyCode: 9
                            },
                            enter: {
                                which: 13,
                                keyCode: 13
                            },
                            end: {
                                which: 0,
                                keyCode: 35
                            },
                            home: {
                                which: 0,
                                keyCode: 36
                            },
                            leftarrow: {
                                which: 0,
                                keyCode: 37
                            },
                            uparrow: {
                                which: 0,
                                keyCode: 38
                            },
                            rightarrow: {
                                which: 0,
                                keyCode: 39
                            },
                            downarrow: {
                                which: 0,
                                keyCode: 40
                            },
                            F5: {
                                which: 116,
                                keyCode: 116
                            }
                        };
                        return e.getMatchingKey(t, i, n)
                    }, e.isModifier = function(e) {
                        return e.ctrlKey || e.altKey || e.metaKey
                    }, e.forEach = function(e, t, i) {
                        if (e.hasOwnProperty("length"))
                            for (var n = 0, o = e.length; o > n && t.call(i, e[n], n, e) !== !1; n++);
                        else
                            for (var s in e)
                                if (e.hasOwnProperty(s) && t.call(i, e[s], s, e) === !1) break
                    }, e
                }(),
                n = function(e, t) {
                    function i(i) {
                        var o = [],
                            s = [];
                        t.forEach(i, function(i) {
                            t.forEach(i, function(t, i) {
                                var r = e.parse(t),
                                    a = n(i);
                                return o.push(a), s.push(r), !1
                            })
                        });
                        var r = function(e) {
                            var i;
                            return t.forEach(o, function(t, n) {
                                return t.test(e) ? (i = n, !1) : void 0
                            }), void 0 === i ? null : s[i]
                        };
                        return {
                            getPattern: r,
                            patterns: s,
                            matchers: o
                        }
                    }
                    var n = function(e) {
                        return "*" === e ? /.*/ : new RegExp(e)
                    };
                    return i
                }(t, i),
                o = function() {
                    var e = {};
                    return e.get = function(e) {
                        if ("number" == typeof e.selectionStart) return {
                            begin: e.selectionStart,
                            end: e.selectionEnd
                        };
                        var t = document.selection.createRange();
                        if (t && t.parentElement() === e) {
                            var i = e.createTextRange(),
                                n = e.createTextRange(),
                                o = e.value.length;
                            return i.moveToBookmark(t.getBookmark()), n.collapse(!1), i.compareEndPoints("StartToEnd", n) > -1 ? {
                                begin: o,
                                end: o
                            } : {
                                begin: -i.moveStart("character", -o),
                                end: -i.moveEnd("character", -o)
                            }
                        }
                        return {
                            begin: 0,
                            end: 0
                        }
                    }, e.set = function(e, t) {
                        if ("object" != typeof t && (t = {
                                begin: t,
                                end: t
                            }), e.setSelectionRange) e.focus(), e.setSelectionRange(t.begin, t.end);
                        else if (e.createTextRange) {
                            var i = e.createTextRange();
                            i.collapse(!0), i.moveEnd("character", t.end), i.moveStart("character", t.begin), i.select()
                        }
                    }, e
                }(),
                s = function(e, t, i) {
                    function n(t, n) {
                        var s = this;
                        if (s.el = t, !s.el) throw new TypeError("Must provide an existing element");
                        if (s.opts = i.extend({}, o, n), "undefined" != typeof s.opts.pattern && (s.opts.patterns = s._specFromSinglePattern(s.opts.pattern), delete s.opts.pattern), "undefined" == typeof s.opts.patterns) throw new TypeError("Must provide a pattern or array of patterns");
                        s.patternMatcher = e(s.opts.patterns), s._updatePattern(), s.hldrs = {}, s.focus = 0, i.addListener(s.el, "keydown", function(e) {
                            s._keyDown(e)
                        }), i.addListener(s.el, "keypress", function(e) {
                            s._keyPress(e)
                        }), i.addListener(s.el, "paste", function(e) {
                            s._paste(e)
                        }), s.opts.persistent && (s._processKey("", !1), s.el.blur(), i.addListener(s.el, "focus", function(e) {
                            s._focus(e)
                        }), i.addListener(s.el, "click", function(e) {
                            s._focus(e)
                        }), i.addListener(s.el, "touchstart", function(e) {
                            s._focus(e)
                        }))
                    }
                    var o = {
                            persistent: !1,
                            repeat: !1,
                            placeholder: " "
                        },
                        s = {
                            9: /[0-9]/,
                            a: /[A-Za-z]/,
                            "*": /[A-Za-z0-9]/
                        };
                    return n.addInptType = function(e, t) {
                        s[e] = t
                    }, n.prototype.resetPattern = function(i) {
                        this.opts.patterns = i ? this._specFromSinglePattern(i) : this.opts.patterns, this.sel = t.get(this.el), this.val = this.el.value, this.delta = 0, this._removeChars(), this.patternMatcher = e(this.opts.patterns);
                        var n = this.patternMatcher.getPattern(this.val);
                        this.mLength = n.mLength, this.chars = n.chars, this.inpts = n.inpts, this._processKey("", !1, !0)
                    }, n.prototype._updatePattern = function() {
                        var e = this.patternMatcher.getPattern(this.val);
                        e && (this.mLength = e.mLength, this.chars = e.chars, this.inpts = e.inpts)
                    }, n.prototype._keyDown = function(e) {
                        var t = e.which || e.keyCode;
                        return t && i.isDelKeyDown(e.which, e.keyCode) ? (this._processKey(null, t), i.preventDefault(e)) : void 0
                    }, n.prototype._keyPress = function(e) {
                        var t, n;
                        return t = e.which || e.keyCode, n = i.isSpecialKeyPress(e.which, e.keyCode), i.isDelKeyPress(e.which, e.keyCode) || n || i.isModifier(e) ? void 0 : (this._processKey(String.fromCharCode(t), !1), i.preventDefault(e))
                    }, n.prototype._paste = function(e) {
                        return this._processKey(i.getClip(e), !1), i.preventDefault(e)
                    }, n.prototype._focus = function() {
                        var e = this;
                        setTimeout(function() {
                            var i = t.get(e.el),
                                n = i.end > e.focus,
                                o = 0 === i.end;
                            (n || o) && t.set(e.el, e.focus)
                        }, 0)
                    }, n.prototype._processKey = function(e, n, o) {
                        if (this.sel = t.get(this.el), this.val = this.el.value, this.delta = 0, this.sel.begin !== this.sel.end) this.delta = -1 * Math.abs(this.sel.begin - this.sel.end), this.val = i.removeChars(this.val, this.sel.begin, this.sel.end);
                        else if (n && 46 === n) this._delete();
                        else if (n && this.sel.begin - 1 >= 0) this.val = i.removeChars(this.val, this.sel.end - 1, this.sel.end), this.delta -= 1;
                        else if (n) return !0;
                        n || (this.val = i.addChars(this.val, e, this.sel.begin), this.delta += e.length), this._formatValue(o)
                    }, n.prototype._delete = function() {
                        for (; this.chars[this.sel.begin];) this._nextPos();
                        this.sel.begin < this.val.length && (this._nextPos(), this.val = i.removeChars(this.val, this.sel.end - 1, this.sel.end), this.delta = -1)
                    }, n.prototype._nextPos = function() {
                        this.sel.end++, this.sel.begin++
                    }, n.prototype._formatValue = function(e) {
                        this.newPos = this.sel.end + this.delta, this._removeChars(), this._updatePattern(), this._validateInpts(), this._addChars(), this.el.value = this.val.substr(0, this.mLength), ("undefined" == typeof e || e === !1) && t.set(this.el, this.newPos)
                    }, n.prototype._removeChars = function() {
                        this.sel.end > this.focus && (this.delta += this.sel.end - this.focus);
                        for (var e = 0, t = 0; t <= this.mLength; t++) {
                            var n, o = this.chars[t],
                                s = this.hldrs[t],
                                r = t + e;
                            r = t >= this.sel.begin ? r + this.delta : r, n = this.val.charAt(r), (o && o === n || s && s === n) && (this.val = i.removeChars(this.val, r, r + 1), e--)
                        }
                        this.hldrs = {}, this.focus = this.val.length
                    }, n.prototype._validateInpts = function() {
                        for (var e = 0; e < this.val.length; e++) {
                            var t = this.inpts[e],
                                n = !s[t],
                                o = !n && !s[t].test(this.val.charAt(e)),
                                r = this.inpts[e];
                            (n || o) && r && (this.val = i.removeChars(this.val, e, e + 1), this.focusStart--, this.newPos--, this.delta--, e--)
                        }
                    }, n.prototype._addChars = function() {
                        if (this.opts.persistent) {
                            for (var e = 0; e <= this.mLength; e++) this.val.charAt(e) || (this.val = i.addChars(this.val, this.opts.placeholder, e), this.hldrs[e] = this.opts.placeholder), this._addChar(e);
                            for (; this.chars[this.focus];) this.focus++
                        } else
                            for (var t = 0; t <= this.val.length; t++) {
                                if (this.delta <= 0 && t === this.focus) return !0;
                                this._addChar(t)
                            }
                    }, n.prototype._addChar = function(e) {
                        var t = this.chars[e];
                        return t ? (i.isBetween(e, [this.sel.begin - 1, this.newPos + 1]) && (this.newPos++, this.delta++), e <= this.focus && this.focus++, this.hldrs[e] && (delete this.hldrs[e], this.hldrs[e + 1] = this.opts.placeholder), void(this.val = i.addChars(this.val, t, e))) : !0
                    }, n.prototype._specFromSinglePattern = function(e) {
                        return [{
                            "*": e
                        }]
                    }, n
                }(n, o, i),
                r = "formatter";
            $.fn[r] = function(e) {
                return "object" == typeof e && this.each(function() {
                    $.data(this, "plugin_" + r) || $.data(this, "plugin_" + r, new s(this, e))
                }), this.resetPattern = function(e) {
                    return this.each(function() {
                        var t = $.data(this, "plugin_" + r);
                        t && t.resetPattern(e)
                    }), this
                }, this
            }, $.fn[r].addInptType = function(e, t) {
                s.addInptType(e, t)
            }
        })
    }(), BEM.JSON.decl("attribute-title", {
        onBlock: function(e) {
            e.js(!0).tag("span")
        }
    }), BEM.DOM.decl("attribute-title", {
        _update: function(e) {
            BN("i-content").update(this.domElem, BN("i-content").escapeHTML(e || "")).done()
        }
    }), BEM.DOM.decl({
        name: "attribute-title",
        modName: "param",
        modVal: "currency"
    }, {
        dataBindings: {
            "preset.currency": {
                initAccessor: "_update",
                set: "_update"
            }
        }
    }), BEM.JSON.decl("data-table", {
        onBlock: function(e) {
            e.params().disableScrollWrap || e.wrap({
                block: "table-scroll"
            })
        }
    }), BEM.DOM.decl("data-table", {
        _load: function() {
            return this.__base.apply(this, arguments).always(function(e) {
                return this.trigger("resize"), e
            }.bind(this))
        }
    }), BEM.JSON.decl("table-scroll", {
        onBlock: function(e) {
            var t = e.content();
            e.js({
                wrappedBlock: t.block
            }), e.content({
                elem: "wrap",
                content: e.content()
            }, !0)
        },
        onElem: {
            scroll: function(e) {
                e.content({
                    elem: "scroll-inner"
                })
            }
        }
    }), BEM.DOM.decl("table-scroll", {
        onSetMod: {
            js: function() {
                BEM.DOM.append(this.domElem, BN("i-content").html({
                    block: this.__self.getName(),
                    elem: "scroll"
                }, !0)), this._scroll = this.elem("scroll"), this._scrollHeight = this._scroll.height(), this.bindTo("scroll", "scroll", jQuery.throttle(this._onScroll.bind(this, "scroll", "wrap"), 10)), this.bindTo("wrap", "scroll", jQuery.throttle(this._onScroll.bind(this, "wrap", "scroll"), 10)), this.bindToWin("scroll", jQuery.throttle(this._onWinScroll, 10, this)), this.bindToWin("resize", jQuery.throttle(this._onWinResize, 10, this)), this._checkForScroll()
            }
        },
        destruct: function() {
            return this._wrappedBlock && this._wrappedBlock.un("resize", this._checkForScroll, this), this.__base.apply(this, arguments)
        },
        _subscribeToContentChange: function() {
            this._wrappedBlock = this.findBlockInside(this.params.wrappedBlock), this._wrappedBlock && this._wrappedBlock.on("resize", this._checkForScroll, this)
        },
        _checkForScroll: function() {
            this._isDestructing || (this.elem("scroll-inner").width(this.elem("wrap")[0].scrollWidth), this._checkWidthForScroll(), this._checkPositionForScroll())
        },
        _checkWidthForScroll: function() {
            this.toggleMod(this._scroll, "width", "yes", this.elem("wrap").width() < this.elem("wrap")[0].scrollWidth)
        },
        _checkPositionForScroll: function() {
            var e = jQuery(window),
                t = e.scrollTop() + e.height(),
                i = this.domElem.offset().top;
            t > i + this.__self.TABLE_TOP_OFFSET && t < i + this.domElem.height() ? (this.setMod(this._scroll, "position", "yes"), this._onScroll("wrap", "scroll")) : this.delMod(this._scroll, "position"), this._scroll.css("top", t - this._scrollHeight - this.domElem.offset().top)
        },
        _onScroll: function(e, t) {
            this._lastDest === e ? this._lastDest = "" : (this._lastDest = t, this.elem(t).scrollLeft(this.elem(e).scrollLeft()))
        },
        _onWinScroll: function() {
            this._checkPositionForScroll()
        },
        _onWinResize: function() {
            this._checkWidthForScroll(), this._checkPositionForScroll()
        }
    }, {
        TABLE_TOP_OFFSET: 100,
        live: function() {
            ["data-table", "table"].forEach(function(e) {
                this.liveInitOnBlockInsideInit(e, function() {
                    this._subscribeToContentChange()
                })
            }, this)
        }
    }), BN("formatter").formatters("table").add({
        dataType: ["date", "date-period"]
    }, function(e) {
        e.value = {
            elem: "date",
            tag: "span",
            content: BN("i-string").escapeBemJson(e.value),
            mods: {
                holiday: "day" === e.column.group && BN("i-holidays").isHoliday(e.originValue) ? "yes" : "no"
            }
        }
    }).add({
        dataType: ["url", "url-part"]
    }, function(e) {
        var t;
        e.raw.url ? t = e.raw.url : BN("i-url").isUrl(e.raw.name) && (t = e.raw.name), e.value = t ? {
            block: "link",
            mods: {
                external: "yes"
            },
            attrs: {
                target: "_blank"
            },
            url: t,
            content: e.value
        } : e.value
    }).add({
        dataType: "traffic-source",
        type: "dimension",
        "dimension-item": !0
    }, function(e) {
        var t = BN("i-report").trafficSourceToReport(e.id);
        void 0 !== t && (e.value = {
            block: "smart-link",
            js: {
                path: "/stat/" + t,
                keepParams: ["report", "delegation", "data-table"]
            },
            content: e.value
        })
    }).add({
        dataType: "direct-order",
        type: "dimension",
        "dimension-item": !0
    }, function(e) {
        1 !== parseInt(e.raw.owner, 10) && (e.value = "")
    }).add({
        dataType: "search-phrase",
        type: "dimension",
        "dimension-item": !0
    }, function(e) {
        e.raw.url && (e.value = {
            block: "link",
            mods: {
                external: "yes"
            },
            url: e.raw.url,
            target: "_blank",
            content: e.value
        })
    }).add({
        dataType: "double"
    }, function(e) {
        var t;
        "0" !== e.value && (t = parseFloat(e.originValue), e.value = BEM.blocks.humanize.format("double", t))
    }), BN("formatter").formatters("table-dimension").add({
        rowType: "content",
        type: "dimension",
        mode: "tree"
    }, function(e) {
        e.expander = {
            elem: "expander"
        }, e.content = {
            block: "data-table",
            elem: "dimension-item",
            formatters: e.column.formatters[e.level],
            fields: e.column.dimensions[e.level].fields,
            data: e.dimension,
            cell: e
        }, e.additional = {
            elem: "append-additional",
            fields: e.content.fields,
            data: e.dimension,
            formatters: e.content.formatters
        }
    }).add({
        rowType: "content",
        type: "dimension",
        mode: "list"
    }, function(e) {
        var t = BN("i-dimension-chooser").getDimensionsForCompactLabel(e.column.dimensions, e.dimensions),
            i = e.column.dimensions.reduce(function(e, t, i) {
                return e[t.dim] = i, e
            }, {}),
            n = [];
        t.forEach(function(t, o) {
            var s = i[t],
                r = e.dimensions[s],
                a = e.column.dimensions[s].fields,
                l = e.column.formatters[s];
            if (o > 0) {
                if (null === r.name) return;
                delete r.icon_id, delete r.favicon, n.push(" &#8594; ")
            }
            n.push({
                block: "data-table",
                elem: "dimension-item",
                formatters: l,
                fields: a,
                data: r,
                cell: e
            }, {
                block: "data-table",
                elem: "append-additional",
                fields: a,
                data: r,
                formatters: l
            })
        }), !n.length || 1 === n.length && null === n[0] ? e.text = {
            tag: "span",
            content: BEM.I18N("data-table", "undefined")
        } : e.content = n
    }).add({
        rowType: "content",
        type: "dimension",
        dimensionless: !0
    }, function(e) {
        e.content = BEM.I18N("data-table", "sum-average")
    }).add({
        rowType: "content",
        type: "dimension"
    }, function(e) {
        e.value = {
            elem: "cell",
            mods: {
                body: "yes",
                type: "dimension",
                "tree-level": e.level
            },
            content: {
                elem: "dimension-wrapper",
                cell: e
            }
        }
    }), BN("formatter").formatters("table-metric").add({
        rowType: "content",
        type: "metric",
        allowNormalization: !0
    }, function(e) {
        e.normalisation = {
            block: "percent",
            mix: {
                block: "data-table",
                elem: "metric" + BEM.toModVal(e.column.dim),
                mods: {
                    type: "relative"
                }
            },
            content: BEM.blocks.humanize.format("percents", 100 * (e.total ? e.originValue / e.total : 0))
        }
    }).add({
        rowType: "content",
        type: "metric",
        dim: ["ym:s:affinityIndexInterests", "ym:s:goal<goal_id>affinityIndexInterests"]
    }, function(e) {
        var t = e.originValue / 100,
            i = e.originValue < 100;
        t = t >= 1 ? 1 - 1 / t : 1 - t, e.affinityLine = {
            block: "data-table",
            elem: "affinity-line",
            value: t,
            mods: {
                negative: i ? "yes" : "no"
            }
        }, e.value = {
            elem: "affinity-val",
            mods: {
                negative: i ? "yes" : "no"
            },
            content: e.value
        }
    }).add({
        rowType: "content",
        type: "metric"
    }, function(e) {
        var t = !1;
        e.affinityLine || (e.max && e.max > .01 && (t = e.max), t !== !1 && (e.percentLine = {
            elem: "percent-line",
            value: e.originValue / t
        })), e.value = {
            elem: "cell",
            mods: {
                body: "yes",
                type: "metric"
            },
            content: [{
                elem: "col-val",
                mix: {
                    block: "data-table",
                    elem: "metric" + BEM.toModVal(e.column.dim),
                    mods: {
                        type: "absolute"
                    }
                },
                mods: {
                    type: e.column.dataType
                },
                content: null === e.originValue || isNaN(e.originValue) ? "&ndash;" : e.value
            }, e.normalisation, e.percentLine, e.affinityLine]
        }
    }), BN("formatter").formatters("table-total-common").add({
        rowType: "total",
        dataType: "total-title"
    }, function(e) {
        e.value = {
            elem: "dimension-total",
            checked: e.checked,
            content: BEM.I18N("data-table", "sum-average")
        }, e.type = "dimension"
    }).add({
        rowType: "total",
        dim: ["ym:s:affinityIndexInterests", "ym:s:goal<goal_id>affinityIndexInterests"]
    }, function(e) {
        e.value = "&mdash;"
    }), BN("formatter").formatters("table-total").add({
        rowType: "total"
    }, function(e) {
        e.value = {
            elem: "cell",
            mods: {
                body: "yes",
                type: e.type ? e.type : "metric"
            },
            content: {
                elem: "cell-i",
                content: e.value
            }
        }
    }), BEM.DOM.decl({
        block: "direct-expenses-notification",
        baseBlock: "notification"
    }), BEM.DOM.decl({
        block: "direct-sampling-notification",
        baseBlock: "notification"
    }), BEM.DOM.decl({
        block: "direct-clientid-notification",
        baseBlock: "notification"
    }), BEM.DOM.decl({
        block: "data-table",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            report: {
                set: "_update"
            }
        },
        _update: function(e) {
            var t = Vow.fulfill();
            e.period && (this._options.period && !BN("i-date").isSamePeriodDays(e.period, this._options.period) && (t = BN("m-accuracy").getDefaultSampling().then(function(e) {
                this._options.accuracy = e, this.trigger("sampling-accuracy-changed", this._options.accuracy)
            }.bind(this))), t.then(function() {
                return this.reload(jQuery.extend({}, e, {
                    rowsLimit: BN("i-data-table").DEFAULT_ROWS_LIMIT
                }))
            }.bind(this)).done())
        }
    }), BEM.DOM.decl({
        block: "data-table",
        modName: "fixed-head",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                var e = 300;
                this.__base.apply(this, arguments), BN("i-content").prepend(this.domElem, {
                    block: "data-table",
                    mods: this.getInitialMods(),
                    elem: "fixed-head"
                }).done(), this._fitFixedHead = $.throttle(this._fitFixedHead, 100, this), this._onDocumentScroll = $.throttle(this._onDocumentScroll, 100, this), this._onParentScroll = $.throttle(this._onParentScroll, 100, this), this.bindToWin("scroll", this._onDocumentScroll.bind(this)), this.on("change-structure", function() {
                    this.setMod("need-reload-head", "yes")
                }, this), this._debouncedFitFixedHead = jQuery.debounce(this._fitFixedHead, e, this), BN("main-menu").on("toggle", this._debouncedFitFixedHead, this)
            },
            state: {
                loading: function() {
                    this.getMod("show-head") && this.getMod("need-reload-head") && this.delMod("show-head")
                },
                ready: function() {
                    this.getMod("need-reload-head") && (this.delMod("need-reload-head"), this._onDocumentScroll())
                }
            },
            "show-head": {
                yes: function() {
                    var e = this.findElem("thead"),
                        t = this.findBlockInside(e, "goals-panel"),
                        i = this.findBlocksInside(e, "advice");
                    i.forEach(function(e) {
                        e._hide()
                    }), t && t.hide(), e.detach().prependTo(this.elem("table")), this._fitFixedHead(), this.bindTo(this.domElem.parent(), "scroll", this._onParentScroll), this.bindToWin("resize", this._fitFixedHead.bind(this)), this._onParentScroll()
                },
                "": function() {
                    var e = this.findElem(this.findElem("fixed-head-table"), "thead").detach();
                    this.getMod("need-reload-head") || this.findElem("thead").replaceWith(e), this.unbindFrom(this.domElem.parent(), "scroll", this._onParentScroll), this.unbindFromWin("resize", this._fitFixedHead.bind(this))
                }
            }
        },
        destruct: function() {
            BN("main-menu").un("toggle", this._debouncedFitFixedHead, this), this.__base.apply(this, arguments)
        },
        _onDocumentScroll: function() {
            var e = this.domElem.offset().top,
                t = e < $(window).scrollTop();
            this.toggleMod("show-head", "yes", t), this._onParentScroll()
        },
        _onParentScroll: function() {
            this.findElem("fixed-head-table").css("left", -(this.domElem.parent().scrollLeft() + $(document).scrollLeft()) + "px")
        },
        _fitFixedHead: function() {
            var e = this.domElem.offset().left + this.domElem.parent().scrollLeft(),
                t = this.findElem("table").not(this.buildSelector("fixed-head-table")),
                i = this.elem("fixed-head-table"),
                n = t.outerWidth();
            this.findElem("fixed-head").css("left", e), i.css("width", n), this.findElem(t, "cell").each(function(e, t) {
                var n = $(t),
                    o = "." + t.className.split(/\s+/).join(" .");
                i.find(o).css("width", n.width())
            })
        }
    }), BEM.JSON.decl("data-table", {
        onElem: {
            "fixed-head": function(e) {
                e.content({
                    elem: "fixed-head-table",
                    mix: {
                        block: "data-table",
                        elem: "table"
                    },
                    tag: "table"
                })
            }
        }
    }), BEM.JSON.decl("segment-size-totals", {
        onBlock: function(e) {
            var t = e.params();
            BN("i-filter").isFiltersListEmpty(t.filter) && e.mod("filter-empty", "yes"), e.js(!0).content({
                elem: "text"
            }).afterContent({
                block: "spin2",
                mix: [{
                    block: "segment-size-totals",
                    elem: "spin"
                }],
                mods: {
                    size: "xxs"
                }
            })
        }
    }), BEM.JSON.decl("segment-size-totals", {
        onBlock: function(e) {
            e.js(!0).content({
                elem: "text",
                period: e.param("period"),
                filter: e.param("filter")
            })
        },
        onElem: {
            text: function(e) {
                var t, i = e.params(),
                    n = i.sampled ? "&asymp;" : "",
                    o = n + BN("humanize").format("number", i.countTotal);
                t = null !== i.countFilter ? BEM.I18N("segment-size-totals", "selected", {
                    count: n + BN("humanize").format("percents", 100 * i.countFilter / i.countTotal),
                    total: o,
                    metricName: i.countMetricName
                }) : BEM.I18N("segment-size-totals", "total", {
                    total: n + BN("humanize").format("number", i.countTotal),
                    metricName: i.countMetricName
                }), e.content(t)
            }
        }
    }), BEM.DOM.decl("segment-size-totals", {
        dataBindings: {
            "sampling.accuracy": {
                set: "_setSamplingAccuracy"
            },
            "preset.dimensions": {
                set: "_setDimensions"
            },
            attribution: {
                set: "_update"
            }
        },
        onSetMod: {
            loading: function(e, t) {
                this.findBlockOn("spin", "spin2").setMod("progress", t)
            }
        },
        _setSamplingAccuracy: function(e) {
            this._samplingAccuracy = e, this._update()
        },
        _setDimensions: function(e) {
            var t = e[0];
            this._firstDimension !== t && (this._firstDimension = t, this._update())
        },
        _update: function() {
            var e, t = this._getOpts();
            t.period && (this.toggleMod("filter-empty", "yes", BN("i-filter").isFiltersListEmpty(t.filter)), this.setMod("loading", "yes"), e = BN("i-promise").createChain(this), BN("i-content").html({
                block: "segment-size-totals",
                elem: "text",
                mods: this.getInitialMods(),
                filter: t.filter,
                period: t.period,
                accuracy: this._samplingAccuracy
            }).then(e(function(e) {
                BEM.DOM.replace(this.findElem("text"), e)
            })).always(e(function(e) {
                return this.delMod("loading"), e
            })).done())
        }
    }), BEM.JSON.decl("segment-size-totals", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.params().accuracy = t.getParamsModel().getState().accuracy
            }))
        },
        onElem: {
            text: function(e) {
                var t = e.params(),
                    i = t.accuracy || e.blockParams().accuracy;
                e.defer(Vow.all([BN("i-default-data").getMetrics({
                    period: t.period,
                    requestId: t.requestId,
                    accuracy: i
                }), BN("i-filter").isFiltersListEmpty(t.filter) ? null : BN("i-default-data").getMetrics({
                    filter: t.filter,
                    period: t.period,
                    accuracy: i,
                    requestId: t.requestId
                }), BN("i-report").getMetadata()]).spread(function(e, i, n) {
                    e && e.totals && void 0 !== e.totals[0] ? (t.countTotal = e.totals[0], t.sampled = e.sampled) : (t.countTotal = 0, t.sampled = !1), i && i.totals && void 0 !== i.totals[0] ? (t.countFilter = i.totals[0], t.sampled = t.sampled || i.sampled) : t.countFilter = null, t.countMetricName = n.getCountMetricName(!0)
                }))
            }
        }
    }), BEM.DOM.decl({
        name: "segment-size-totals",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.period": {
                initAccessor: !0,
                set: "_update"
            },
            "report.filter": {
                initAccessor: !0,
                set: "_update"
            },
            "preset.goal": {
                set: "_update"
            }
        },
        _getOpts: function() {
            return this.dataBindVal("report")
        }
    }), BN("i-segments-params").genDecl({
        name: "segment-size-totals",
        modName: "type",
        modVal: "primary"
    }, ["period", "filter"]), BEM.JSON.decl("segment-compare-menu", {
        onBlock: function(e) {
            var t = e.content() || [];
            e.js(!0).content(t.concat([{
                block: "advice",
                type: "compare",
                index: 3
            }, {
                block: "dropdown",
                mods: {
                    lazy: "yes"
                },
                js: {
                    content: {
                        block: "segment-compare-menu",
                        elem: "popup-content"
                    }
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        arrow: "down",
                        pseudo: "no"
                    },
                    mix: [{
                        block: "dropdown",
                        elem: "switcher"
                    }],
                    content: [{
                        block: "icon",
                        elem: "scales",
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }, BEM.I18N("segment-compare-menu", "compare")]
                }, {
                    elem: "popup",
                    js: {
                        directions: "bottom-right-center"
                    },
                    mix: [{
                        block: "segment-compare-menu",
                        elem: "popup"
                    }]
                }]
            }]))
        }
    }), BEM.JSON.decl("segment-compare-menu", {
        onElem: {
            "popup-content": function(e) {
                var t = e.param("report"),
                    i = t.getComparePath();
                e.tag("ul").content([{
                    elem: "menu-item",
                    tag: "li",
                    mods: {
                        header: "yes"
                    },
                    content: BEM.I18N("segment-compare-menu", "compare-with")
                }, {
                    elem: "menu-item",
                    tag: "li",
                    mix: {
                        block: "segment-compare-menu",
                        elem: "link"
                    },
                    content: this._getLinkJson({
                        type: "compare-previous",
                        path: i,
                        text: BEM.I18N("segment-compare-menu", "previous-period")
                    })
                }, {
                    elem: "menu-item",
                    tag: "li",
                    mix: {
                        block: "segment-compare-menu",
                        elem: "link"
                    },
                    content: this._getLinkJson({
                        type: "compare-custom",
                        path: i,
                        text: BEM.I18N("segment-compare-menu", "custom-segment")
                    })
                }, {
                    elem: "menu-item",
                    mix: {
                        block: "segment-compare-menu",
                        elem: "segments-menu"
                    },
                    tag: "li",
                    content: {
                        block: "segments-menu-item",
                        mods: {
                            type: "predefined",
                            reference: "compare"
                        },
                        label: BEM.I18N("segment-compare-menu", "predefined-label")
                    }
                }, {
                    elem: "menu-item",
                    mix: {
                        block: "segment-compare-menu",
                        elem: "segments-menu"
                    },
                    tag: "li",
                    content: {
                        block: "segments-menu-item",
                        mods: {
                            type: "user",
                            reference: "compare",
                            remove: "no",
                            "data-bind": "report"
                        },
                        label: BEM.I18N("segment-compare-menu", "user-label")
                    }
                }])
            }
        },
        _getLinkJson: function(e) {
            return {
                block: "smart-link",
                mods: {
                    type: e.type
                },
                js: {
                    keepParams: ["delegation", "report", "data-table-compare-segments", "data-table-report-specific", "dimension_mode", "quantile", "chart", "data-table-dimension-filter", "inpage"],
                    path: e.path
                },
                content: {
                    block: "segment-compare-menu",
                    elem: "link-content",
                    content: e.text
                }
            }
        }
    }), BEM.DOM.decl("segment-compare-menu", {}, {
        live: function() {
            this.liveInitOnBlockInsideEvent("content-ready", "dropdown")
        }
    }), BEM.JSON.decl("segment-compare-menu", {
        onElem: {
            "popup-content": function(e) {
                e.defer(BN("i-report").getReport().then(function(t) {
                    e.params().report = t
                }))
            }
        }
    }), BEM.DOM.decl({
        block: "smart-link",
        modName: "type",
        modVal: "compare-previous"
    }, {
        _getNewParams: function() {
            var e = this.__base.apply(this, arguments),
                t = BN("i-period").prevPeriod(BN("i-period").getPeriod());
            return void 0 !== e.filter && (e.secondary_filter = e.filter), e.secondary_period = BN("i-period").stringifyPeriod(t), e.compareWith = "previous", e
        }
    }), BEM.DOM.decl({
        block: "smart-link",
        modName: "type",
        modVal: "compare-custom"
    }, {
        _getNewParams: function() {
            var e = this.__base.apply(this, arguments);
            return e.period && (e.secondary_period = e.period), e.compareWith = "custom", e
        }
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "reference",
        modVal: "compare"
    }, {
        onElem: {
            item: function(e) {
                var t = e.params(),
                    i = e.param("segment");
                (void 0 === i.applicable || i.applicable) && e.wrap({
                    block: "smart-link",
                    mods: {
                        type: "compare-custom"
                    },
                    js: {
                        keepParams: ["delegation", "report", "data-table-compare-segments", "data-table-report-specific", "comparison", "dimension_mode", "quantile", "chart", "data-table-dimension-filter", "inpage", "attribution"],
                        params: {
                            secondary_filter: BN("i-filter").stringifyFilter(i.segment, t.meta),
                            secondary_filter_id: i.id
                        },
                        path: t.report.getComparePath()
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "reference",
        modVal: "compare"
    }, {
        _publishSegment: function() {},
        _onItemClick: function() {}
    }), BEM.JSON.decl({
        name: "segments-menu-item",
        modName: "reference",
        modVal: "compare"
    }, {
        onElem: {
            item: function(e) {
                e.defer(Vow.all([BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(t, i) {
                    e.params().meta = t, e.params().report = i
                }))
            }
        }
    }), BEM.DOM.decl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.filter": {
                initAccessor: "_filter",
                set: "_setFilter",
                event: "filter-change",
                get: "_filter"
            },
            "report.segment": {
                set: "_setSegment",
                event: "segment-change"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-menu-item",
        modName: "data-bind",
        modVal: "report"
    }, "segment"), BEM.JSON.decl({
        name: "segments-selector",
        modName: "advice",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.content([{
                block: "advice",
                type: "segmentation",
                index: 2
            }])
        }
    }), BEM.JSON.decl("segment-quantile", {
        onBlock: function(e) {
            var t = BN("i-quantile").getList(),
                i = e.param("quantile");
            e.js(!0).content({
                block: "select",
                js: {
                    textPrefix: BEM.I18N("segment-quantile", "quantile")
                },
                name: "quantile",
                mods: {
                    size: "s",
                    theme: "normal",
                    layout: "content",
                    "combining-label": "yes"
                },
                attrs: {
                    autocomplete: "off"
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal"
                    }
                }, {
                    elem: "control",
                    attrs: {
                        autocomplete: "off"
                    },
                    content: t.map(function(e) {
                        return {
                            elem: "option",
                            attrs: {
                                value: e,
                                selected: e === i ? "selected" : void 0
                            },
                            content: BEM.blocks.humanize.format("percents", e)
                        }
                    })
                }]
            })
        }
    }), BEM.JSON.decl("segment-quantile", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-report").getReport(), BN("i-report").getMetadata()]).spread(function(t, i) {
                var n = t.getParamsModel().getState();
                return BN("i-quantile").hasAnyMetricQuantileParam(i.getMetricsMeta()) ? void e.param("quantile", n.quantile) : e.remove()
            }))
        }
    }), BEM.DOM.decl("segment-quantile", {
        dataBindings: {
            quantile: {
                initAccessor: "get",
                set: "set",
                event: "change"
            }
        },
        onSetMod: {
            js: function() {
                this._select = this.findBlockInside("select")
            }
        },
        set: function(e) {
            this._select.val(e)
        },
        get: function() {
            return this._select.val()
        }
    }, {
        live: function() {
            this.liveInitOnBlockInsideEvent("change", "select", function(e) {
                this.trigger("change", e.block.val())
            })
        }
    }), BEM.JSON.decl("report-currency", {
        onBlock: function(e) {
            e.js(!0), e.mod("disable", "yes"), e.content({
                block: "select",
                mix: [{
                    block: "report-currency",
                    elem: "select"
                }],
                js: {
                    textPrefix: BEM.I18N("report-currency", "currency")
                },
                name: "currency",
                mods: {
                    size: "s",
                    theme: "normal",
                    "combining-label": "yes",
                    "selected-text": "value",
                    disabled: "yes"
                },
                attrs: {
                    autocomplete: "off"
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal"
                    }
                }, {
                    elem: "control",
                    attrs: {
                        autocomplete: "off"
                    },
                    content: []
                }]
            })
        }
    }), BEM.DOM.decl("report-currency", {
        dataBindings: {
            preset: "setAvailability",
            "preset.currency": {
                event: "change",
                initAccessor: "set",
                set: "set"
            }
        },
        onSetMod: {
            js: function() {
                this._select = this.findBlockOn("select", "select"), this._select.on("change", this._onChange, this), this.setPeriod(BEM.dataBindVal("report.period")), this.setAvailability(BEM.dataBindVal("preset"))
            }
        },
        get: function() {
            return this._select.val()
        },
        set: function(e) {
            this._value = e, this._select.val(e)
        },
        setAvailability: function() {
            var e = this;
            BN("i-report").getMetadata().then(function(t) {
                if (!e._isDestructing) {
                    var i = t.hasCurrencyAttr();
                    e.toggleMod("disable", "yes", !i), e.updateList()
                }
            }).done()
        },
        setPeriod: function(e) {
            this._period = e, this.updateList()
        },
        updateList: function() {
            var e = this;
            !this.getMod("disable") && this._period && BN("i-default-data").getCurrencyList(this._period).then(function(t) {
                var i = Boolean(t.length);
                e._isDestructing || (e.setMod(e.elem("select"), "inited", "yes"), e.toggleMod("empty", "yes", !i), e._select.toggleMod("disabled", "yes", !i), i && e._select.setOptions(t.map(function(t) {
                    return {
                        item: "option",
                        value: t.id,
                        content: t.id + ", " + t.name,
                        selected: t.id === e._value
                    }
                })))
            }).done()
        },
        _onChange: function() {
            this.trigger("change", this._value = this.get())
        }
    }), BEM.DOM.decl({
        name: "select",
        modName: "selected-text",
        modVal: "value"
    }, {
        _getSelectedText: function() {
            return this.elem("control").find(":selected").attr("value")
        }
    }), BEM.DOM.decl({
        name: "report-currency",
        modName: "data-bind",
        modVal: "single"
    }, {
        dataBindings: {
            "report.period": {
                set: "setPeriod"
            }
        }
    }), BEM.JSON.decl("direct-client", {
        onBlock: function(e) {
            e.js(!0), e.mod("disable", "yes"), e.content({
                block: "select",
                mix: [{
                    block: "direct-client",
                    elem: "select"
                }],
                js: {
                    textPrefix: BEM.I18N("direct-client", "direct")
                },
                name: "group",
                mods: {
                    size: "s",
                    theme: "normal",
                    "combining-label": "yes"
                },
                attrs: {
                    autocomplete: "off"
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal"
                    }
                }, {
                    elem: "control",
                    attrs: {
                        autocomplete: "off"
                    },
                    content: []
                }]
            })
        }
    }), BEM.DOM.decl("direct-client", {
        dataBindings: {
            "report.period": {
                set: "setPeriod"
            },
            preset: {
                set: "setAvailability"
            },
            "preset.direct_client_ids": {
                event: "change",
                set: "set",
                get: "get"
            }
        },
        onSetMod: {
            js: function() {
                this._select = this.findBlockOn("select", "select"), this._select.on("change", this._onChange, this), this.setPeriod(BEM.dataBindVal("report.period")), this.setAvailability(BEM.dataBindVal("preset"))
            }
        },
        get: function() {
            return this._select.val()
        },
        set: function(e) {
            this._select.val(e)
        },
        updateList: function() {
            var e = this;
            !this.getMod("disable") && this._period && BN("i-management-api").getDirectClients(this._period).then(function(t) {
                this._isDestructing || (e.setMod(e.elem("select"), "inited", "yes"), e._select.setOptions(t.map(function(t) {
                    return {
                        item: "option",
                        value: String(t.id),
                        content: t.name,
                        selected: String(t.id) === e.get()
                    }
                })))
            }).done()
        },
        setPeriod: function(e) {
            e && (this._period = e), this.updateList()
        },
        setAvailability: function(e) {
            this.toggleMod("disable", "yes", !(e && e.direct_client_ids)), this.updateList()
        },
        _onChange: function() {
            this.trigger("change")
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "mode",
        modVal: "compare"
    }, {
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "period-selector",
                        mods: {
                            "data-bind": "yes",
                            "url-bind": "compare"
                        }
                    }, {
                        block: "period-group-selector",
                        mods: {
                            "data-bind": "compare",
                            data: "report"
                        }
                    }]
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "cancel-compare",
                        mix: [{
                            block: "report-page",
                            elem: "back-button"
                        }]
                    }, {
                        block: "swop-segments",
                        mods: {
                            advice: "yes"
                        },
                        mix: [{
                            block: "report-page",
                            elem: "swop-button"
                        }]
                    }, {
                        block: "segment-quantile"
                    }, {
                        block: "sampling-popup"
                    }, {
                        block: "direct-client"
                    }, {
                        block: "report-currency",
                        mods: {
                            "data-bind": "compare"
                        }
                    }, {
                        block: "attribution-menu",
                        mods: {
                            advice: "yes"
                        }
                    }]
                }, {
                    block: "segments-compare-wrapper",
                    mix: [{
                        block: "report-page",
                        elem: "segments-wrapper"
                    }]
                }], !0)
            },
            "header-controls": function(e) {
                e.content([{
                    elem: "export"
                }, {
                    block: "save-report-form"
                }])
            },
            chart: function(e) {
                var t = e.param("chart-mods") || {};
                t = jQuery.extend({}, t, {
                    mode: "compare"
                }), e.param("chart-mods", t)
            },
            table: function(e) {
                e.content({
                    block: "data-table",
                    mods: {
                        "data-bind": "compare",
                        type: "compare",
                        "fixed-head": "yes"
                    },
                    compare: !0
                })
            }
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "mode",
        modVal: "compare"
    }, {
        onElem: {
            "back-button": function(e) {
                e.defer(BN("i-report").getReport().then(function(t) {
                    e.params().path = t.getSinglePath()
                }))
            }
        }
    }), BEM.DOM.decl({
        block: "period-group-selector",
        modName: "data-bind",
        modVal: "compare"
    }, {
        dataBindings: {
            "segments.group": {
                initAccessor: "get",
                set: "set",
                get: "get",
                event: "change"
            }
        }
    }), BEM.DOM.decl({
        name: "period-selector",
        modName: "data-bind",
        modVal: "yes"
    }, {
        dataBindings: {
            "segments.primary.period": {
                set: "_periodChange"
            },
            "segments.secondary.period": {
                set: "_periodChange"
            },
            compareWith: {}
        },
        _changeHandler: function() {
            var e, t, i = this._radio.val(),
                n = this.dataBindVal("compareWith");
            i && (e = BN("i-period").nameToPeriod(i)) && (t = this.dataBindVal("segments"), t.primary.period = e, t.secondary.period = "custom" === n ? e : BN("i-period").prevPeriod(e), BEM.dataBindVal("segments.primary.period", t.primary.period), BEM.dataBindVal("segments.secondary.period", t.secondary.period))
        },
        _periodChange: function() {
            var e, t = this.dataBindVal("segments.primary.period"),
                i = this.dataBindVal("segments.secondary.period"),
                n = this.dataBindVal("compareWith");
            t && i && (e = BN("i-period").getPeriodDuration(t, i), e ? (n = "sequential" === e.mode ? "previous" : "custom", e = e.periodName, BEM.dataBindVal("compareWith", n), this._radio.val(e)) : (this._radio.uncheckAll(), BEM.dataBindVal("compareWith", null)))
        }
    }), BEM.JSON.decl({
        name: "period-selector",
        modName: "url-bind",
        modVal: "compare"
    }, {
        onBlock: function(e) {
            var t = BN("i-period").getPeriodDuration();
            t = t ? t.periodName : null, e.param("periodName", t)
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "mode",
        modVal: "compare"
    }, {
        onElem: {
            "chart-inner": function(e) {
                e.content([{
                    block: "segment-name",
                    mods: {
                        "data-bind": "secondary"
                    },
                    mix: [{
                        block: "chart-report",
                        elem: "segment-name",
                        mods: {
                            position: "top"
                        }
                    }]
                }, {
                    block: "chart"
                }, {
                    block: "segment-name",
                    mods: {
                        "data-bind": "primary"
                    },
                    mix: [{
                        block: "chart-report",
                        elem: "segment-name",
                        mods: {
                            position: "bottom"
                        }
                    }]
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "mode",
        modVal: "compare"
    }, {
        _getDataModelBlock: function() {
            return "chart-data-model-compare"
        },
        _getEnabledChartTypes: function(e) {
            return BN("i-chart").enabledChartTypes(e.getMetricMeta(), e.getDimensionsMeta(), e.isOnePeriod(), !0, !0)
        },
        _onModelReady: function() {
            var e = this._dataModel,
                t = jQuery.equals(e.getPeriod("primary"), e.getPeriod("secondary"));
            return this.setMod("period-equals", t ? "yes" : "no"), this.setMod("dimensionless", e.getDimensionsMeta().length ? "" : "yes"), this.__base.apply(this, arguments)
        }
    }), BEM.JSON.decl("segment-name", {
        onBlock: function(e) {
            e.js(!0)
        }
    }), BEM.DOM.decl("segment-name", {
        _update: function(e, t) {
            BN("i-content").update(this.domElem, BN("i-content").escapeHTML(e.segment.name || t))
        }
    }), BEM.DOM.decl({
        block: "segment-name",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary": {
                set: "_update"
            }
        },
        _update: function(e) {
            this.__base.call(this, e, BEM.I18N("segment-head", "segment-primary"))
        }
    }), BEM.DOM.decl({
        block: "segment-name",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary": {
                set: "_update"
            }
        },
        _update: function(e) {
            this.__base.call(this, e, BEM.I18N("segment-head", "segment-secondary"))
        }
    }), BEM.decl({
        name: "chart-data-model-compare",
        baseBlock: "chart-data-model-default"
    }, {
        DATA_SOURCE_BLOCK: "data-source-chart-compare",
        setType: function(e) {
            var t = this._getDataSourceMode(e);
            this._primaryDataModel = this._updateDataModelMode(this.getPrimaryDataModel(), this._getDataSourceDecl(t, "primary")), this._secondaryDataModel = this._updateDataModelMode(this.getSecondaryDataModel(), this._getDataSourceDecl(t, "secondary"))
        },
        getError: function() {
            return this.getPrimaryDataModel().getError() || this.getSecondaryDataModel().getError()
        },
        checkForNodata: function() {
            return this.getPrimaryDataModel().checkForNodata() && this.getSecondaryDataModel().checkForNodata() && (!this.isTotalsAveragesEnabled() || this.getPrimaryDataModel().checkForNoTotals() && this.getSecondaryDataModel().checkForNoTotals())
        },
        checkSomethingSelected: function() {
            return this.getPrimaryDataModel().checkSomethingSelected() || this.getSecondaryDataModel().checkSomethingSelected() || this.isTotalsAveragesEnabled()
        },
        checkSelectableRowsPresent: function() {
            return this.getPrimaryDataModel().checkSelectableRowsPresent()
        },
        getRows: function() {
            return this.getPrimaryDataModel().getRows()
        },
        getPrimaryDataModel: function() {
            return this._primaryDataModel
        },
        getSecondaryDataModel: function() {
            return this._secondaryDataModel
        },
        isOnePeriod: function() {
            return this.getPrimaryDataModel().isOnePeriod() && this.getSecondaryDataModel().isOnePeriod()
        },
        getGroup: function() {
            return this.getPrimaryDataModel().getGroup()
        },
        getMetricMeta: function() {
            return this.getPrimaryDataModel().getMetricMeta()
        },
        getDimensionsMeta: function() {
            return this.getPrimaryDataModel().getDimensionsMeta()
        },
        getData: function(e) {
            return this._getDataModelById(e).getData()
        },
        getPeriodGroups: function(e) {
            return this._getDataModelById(e).getPeriodGroups()
        },
        getSegmentName: function(e) {
            return this._getDataModelById(e).getSegmentName()
        },
        getPeriod: function(e) {
            return this._getDataModelById(e).getPeriod()
        },
        _getDataModelById: function(e) {
            return "secondary" === e ? this.getSecondaryDataModel() : this.getPrimaryDataModel()
        },
        _destructModels: function() {
            this._primaryDataModel && this._primaryDataModel.destruct(), this._secondaryDataModel && this._secondaryDataModel.destruct()
        },
        reload: function() {
            return Vow.all([this.getPrimaryDataModel().reload(), this.getSecondaryDataModel().reload()])
        },
        _isBuzy: function() {
            return this.getPrimaryDataModel().isBuzy() || this.getSecondaryDataModel().isBuzy()
        },
        _getDataSourceDecl: function(e, t) {
            var i = this.__base(e);
            return i.mods.type = t, i
        },
        _onReady: function() {
            this._isBuzy() || this.__base.apply(this, arguments)
        }
    }), BEM.decl({
        name: "data-source-chart-compare",
        baseBlock: "data-source-chart"
    }, {
        dataBindings: {
            "segments.group": {
                set: "change"
            }
        },
        _getGroup: function() {
            return BEM.dataBindVal("segments.group")
        }
    }), BEM.decl({
        name: "data-source-chart-compare",
        modName: "mode",
        modVal: "static"
    }, {
        _loadData: function() {
            return this._loadDataStatic.apply(this, arguments).then(this._extractPrimaryOrSecondary.bind(this)).then(this._extractOnlyRequiredMetric.bind(this))
        },
        _extractPrimaryOrSecondary: function(e) {
            var t = this._getMetricKey();
            return e = jQuery.extend(!0, {}, e), e.data = e.data.map(function(e) {
                return e.metrics = e.metrics[t], e
            }), e.totals = e.totals[t], e
        }
    }), BEM.decl({
        name: "data-source-chart-compare",
        modName: "mode",
        modVal: "dynamic"
    }, {
        _getOptions: function() {
            return Vow.all([this.__base.call(this), BN("i-report").getChartMetadata()]).spread(function(e, t) {
                var i = BN("i-filter");
                return e.filter = i.conjunctionJoinFilters(i.buildFilter(this._getFilter(), t.getSegmentsTree()), i.buildDimensionFilter(BEM.dataBindVal("data-table.dimensionFilter"), t)), e.group = this._getGroup(), e.period = this.getPeriod(), e["row-ids"] = this.getRows(), e.mode = "dynamics", e
            }.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart-compare",
        modName: "mode",
        modVal: "bytime"
    }, {
        _getOptions: function() {
            return Vow.all([this.__base.call(this), BN("i-report").getChartMetadata()]).spread(function(e, t) {
                var i = BN("i-filter");
                return delete e.dimensions, e.mode = "dynamics", e.group = this._getGroup(), e.period = this.getPeriod(), e.filter = i.conjunctionJoinFilters(i.buildFilter(this._getFilter(), t.getSegmentsTree())), e
            }.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart-compare",
        modName: "type",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                set: "change"
            },
            "segments.primary.period": {
                set: "change"
            }
        },
        getSegmentName: function() {
            return BN("i-content").escapeHTML(BEM.dataBindVal("segments.primary.segment").name || BEM.I18N("segment-head", "segment-primary"))
        },
        getPeriod: function() {
            return BEM.dataBindVal("segments.primary.period")
        },
        _getFilter: function() {
            return BEM.dataBindVal("segments.primary.filter")
        },
        _getMetricKey: function() {
            return "b"
        }
    }), BEM.JSON.decl("segment-head", {
        onBlock: function(e) {
            var t = e.params(),
                i = e.mod("type");
            e.js({
                period: t.period
            }).content([{
                block: "save-segment-form",
                mods: {
                    "data-bind": i,
                    hinted: "yes"
                },
                defaultTitle: BEM.I18N("segment-head", "segment-" + i)
            }, {
                elem: "row",
                content: [{
                    block: "segment-size-totals",
                    mods: {
                        "data-bind": i,
                        type: i
                    }
                }, {
                    block: "date-range-selector",
                    period: t.period
                }]
            }, {
                elem: "row",
                content: [{
                    block: "segments-selector",
                    mods: {
                        data: "report",
                        advice: e.mod("advice")
                    },
                    dataBind: i,
                    menuType: i
                }]
            }])
        }
    }), BEM.DOM.decl("segment-head", {
        onSetMod: {
            js: function() {
                this._dateSelector = this.findBlockInside("date-range-selector").on("change", this._dateChangeHandler.bind(this))
            }
        },
        _updatePeriod: function(e) {
            this._dateSelector.setPeriod(e)
        },
        _dateChangeHandler: function(e, t) {
            this.params.period = t, this.trigger("change", t)
        }
    }), BN("i-segments-params").genDecl({
        name: "save-segment-form",
        modName: "data-bind",
        modVal: "primary"
    }, ["segment", "filter"]), BEM.DOM.decl({
        block: "save-segment-form",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                initAccessor: "_filter"
            },
            "segments.primary.segment": {
                initAccessor: "_getSegment",
                event: "change",
                get: "_getSegment"
            },
            "segments.primary": {
                set: "_update"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "save-segment-form",
        modName: "data-bind",
        modVal: "secondary"
    }, ["secondary-segment", "secondary-filter"]), BEM.DOM.decl({
        block: "save-segment-form",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                initAccessor: "_filter"
            },
            "segments.secondary.segment": {
                initAccessor: "_getSegment",
                event: "change",
                get: "_getSegment"
            },
            "segments.secondary": {
                set: "_update"
            }
        }
    }), BEM.DOM.decl({
        block: "save-segment-form",
        modName: "hinted",
        modVal: "yes"
    }, {
        dataBindings: {
            "chartType.actual": {
                event: "change",
                set: "_onChartTypeChange"
            }
        },
        _onChartTypeChange: function(e) {
            this.toggleMod(this.elem("line-hint"), "visible", "yes", "line-chart" === e)
        }
    }), BEM.DOM.decl({
        name: "segment-size-totals",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.period": {
                initAccessor: !0,
                set: "_update"
            },
            "segments.primary.filter": {
                initAccessor: !0,
                set: "_update"
            },
            "preset.goal": {
                set: "_update"
            }
        },
        _getOpts: function() {
            return this.dataBindVal("segments.primary")
        }
    }), BEM.DOM.decl({
        name: "segment-size-totals",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.period": {
                initAccessor: !0,
                set: "_update"
            },
            "segments.secondary.filter": {
                initAccessor: !0,
                set: "_update"
            },
            "preset.goal": {
                set: "_update"
            }
        },
        _getOpts: function() {
            return this.dataBindVal("segments.secondary")
        }
    }), BN("i-segments-params").genDecl({
        name: "segment-size-totals",
        modName: "type",
        modVal: "secondary"
    }, ["secondary-period", "secondary-filter"]), BEM.decl({
        name: "data-source-chart-compare",
        modName: "type",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                set: "change"
            },
            "segments.secondary.period": {
                set: "change"
            }
        },
        getSegmentName: function() {
            return BN("i-content").escapeHTML(BEM.dataBindVal("segments.secondary.segment").name || BEM.I18N("segment-head", "segment-secondary"))
        },
        getPeriod: function() {
            return BEM.dataBindVal("segments.secondary.period")
        },
        _getFilter: function() {
            return BEM.dataBindVal("segments.secondary.filter")
        },
        _getMetricKey: function() {
            return "a"
        }
    }), BEM.decl({
        name: "chart-data-model-compare",
        modName: "type",
        modVal: "bytime"
    }, {
        _getDataSourceMode: function() {
            return "bytime"
        }
    }), BEM.DOM.decl({
        block: "data-table",
        modName: "data-bind",
        modVal: "compare"
    }, {
        dataBindings: {
            "segments.primary.period": {
                set: "_update"
            },
            "segments.secondary.period": {
                set: "_update"
            },
            "segments.primary.filter": {
                set: "_update"
            },
            "segments.secondary.filter": {
                set: "_update"
            },
            "segments.group": {
                set: "_update"
            }
        },
        _update: function() {
            var e = BEM.dataBindVal("segments"),
                t = Vow.fulfill();
            e.primary.period && e.secondary.period && (!this._options.period || !this._options.comparePeriod || BN("i-date").isSamePeriodDays(e.primary.period, this._options.period) && BN("i-date").isSamePeriodDays(e.secondary.period, this._options.comparePeriod) || (t = BN("m-accuracy").getDefaultSampling().then(function(e) {
                this._options.accuracy = e, this.trigger("sampling-accuracy-changed", this._options.accuracy)
            }.bind(this))), t.then(function() {
                return this.reload({
                    filter: e.primary.filter,
                    period: e.primary.period,
                    compareFilter: e.secondary.filter,
                    comparePeriod: e.secondary.period,
                    group: e.group,
                    rowsLimit: BN("i-data-table").DEFAULT_ROWS_LIMIT
                })
            }.bind(this)).done())
        }
    }), BEM.JSON.decl({
        name: "data-table",
        modName: "type",
        modVal: "compare"
    }, {
        onElem: {
            "thead-cell": function(e) {
                var t = e.param("cell");
                "metric" === t.type && e.attrs({
                    colspan: 3
                })
            },
            "thead-control-filter": function(e) {
                e.remove()
            },
            rows: function(e) {
                var t = BN("i-data-table").getDataFormatters(["dimension", "metric", "table", "table-dimension", "table-metric", "table-compare-metric"], e.param("data"), {
                    mode: e.param("dimensionMode"),
                    group: e.param("group"),
                    compare: !0
                });
                e.param("formatters", t)
            },
            "totals-row": function(e) {
                e.param("namespaces", ["table", "metric", "table-total-common", "table-compare-total"])
            }
        }
    }), BEM.DOM.decl({
        name: "data-table",
        modName: "type",
        modVal: "compare"
    }, {
        _extendLoadOptions: function(e, t) {
            return Vow.all([this.__base(e, t), BN("i-report").getMetadata()]).spread(function(e, i) {
                return delete e.filter, e.filter = BN("i-filter").buildDimensionFilter(this._getDimensionFilter(t), i), e.filterRight = this._buildFilter(t.filter, null, i), e.filterLeft = this._buildFilter(t.compareFilter, null, i), e.periodRight = this._options.period, e.periodLeft = this._options.comparePeriod, e.mode = {
                    list: "compareList",
                    tree: "compareTree"
                }[e.mode], e
            }.bind(this))
        },
        _handleMissingAttributeDataMessage: function(e, t, i) {
            BN("missing-attribute-data-notification").show(e, t, i.period, i.comparePeriod)
        }
    }),
    function() {
        function e(e, t) {
            var i = t ? 0 >= e : e >= 0;
            return 1 === e ? "" : i ? "positive" : "negative"
        }
        BN("formatter").formatters("table-compare-metric").add({
            rowType: "content",
            type: ["metric-left", "metric-right"],
            allowNormalization: !0
        }, function(e) {
            e.normalization = {
                block: "percent",
                mix: {
                    block: "data-table",
                    elem: "metric" + BEM.toModVal(e.column.dim),
                    mods: {
                        type: "relative"
                    }
                },
                content: BEM.blocks.humanize.format("percents", 100 * (e.total ? e.originValue / e.total : 0))
            }
        }).add({
            rowType: "content",
            type: ["metric-left", "metric-right"],
            dim: ["ym:s:affinityIndexInterests", "ym:s:goal<goal_id>affinityIndexInterests"]
        }, function(e) {
            var t = e.originValue / 100,
                i = e.originValue < 100;
            t = t >= 1 ? 1 - 1 / t : 1 - t, e.affinityLine = {
                block: "data-table",
                elem: "affinity-line",
                value: t,
                mods: {
                    negative: i ? "yes" : "no"
                }
            }, e.value = {
                elem: "affinity-val",
                mods: {
                    negative: i ? "yes" : "no"
                },
                content: e.value
            }
        }).add({
            rowType: "content",
            type: "metric-center",
            allowNormalization: !0
        }, function(t) {
            t.normalization = {
                block: "percent",
                mix: {
                    block: "data-table",
                    elem: "metric" + BEM.toModVal(t.column.dim),
                    mods: {
                        type: "relative"
                    }
                },
                mods: {
                    diff: e(t.relativeValue, t.column.negative)
                },
                content: BEM.I18N("data-table", "comparative-factor", {
                    value: t.relativeValue
                })
            }
        }).add({
            rowType: "content",
            type: ["metric-left", "metric-right"]
        }, function(e) {
            e.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "metric"
                },
                content: [{
                    elem: "col-val",
                    mix: {
                        block: "data-table",
                        elem: "metric" + BEM.toModVal(e.column.dim),
                        mods: {
                            type: "absolute"
                        }
                    },
                    mods: {
                        type: e.column.dataType
                    },
                    content: e.value
                }, e.normalization, e.affinityLine]
            }
        }).add({
            rowType: "content",
            type: "metric-center"
        }, function(t) {
            t.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "metric"
                },
                content: [{
                    elem: "col-val",
                    mix: {
                        block: "data-table",
                        elem: "metric" + BEM.toModVal(t.column.dim),
                        mods: {
                            type: "absolute"
                        }
                    },
                    mods: {
                        type: t.column.dataType,
                        diff: e(t.originValue, t.column.negative)
                    },
                    content: BEM.I18N("data-table", "comparative-factor", {
                        value: t.value
                    })
                }, t.normalization]
            }
        }), BN("formatter").formatters("table-compare-total").add({
            rowType: "total",
            dataType: "total-title"
        }, function(e) {
            e.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "dimension"
                },
                content: {
                    elem: "cell-i",
                    content: e.value
                }
            }
        }).add({
            rowType: "total",
            type: ["metric-left", "metric-right"]
        }, function(e) {
            e.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "metric"
                },
                content: {
                    elem: "cell-i",
                    content: e.value
                }
            }
        }).add({
            rowType: "total",
            type: "metric-center"
        }, function(t) {
            t.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "metric",
                    diff: e(t.originValue, t.column.negative)
                },
                content: {
                    elem: "cell-i",
                    content: BEM.I18N("data-table", "comparative-factor", {
                        value: t.value
                    })
                }
            }
        }).add({
            rowType: "total",
            type: "metric-center",
            dim: ["ym:s:affinityIndexInterests", "ym:s:goal<goal_id>affinityIndexInterests"]
        }, function(e) {
            e.value = {
                elem: "cell",
                mods: {
                    body: "yes",
                    type: "metric"
                },
                content: {
                    elem: "cell-i",
                    content: "&mdash;"
                }
            }
        })
    }(), BEM.DOM.decl({
        name: "report-currency",
        modName: "data-bind",
        modVal: "compare"
    }, {
        dataBindings: {
            "segments.primary.period": {
                set: "debouncedSetPeriod"
            },
            "segments.secondary.period": {
                set: "debouncedSetPeriod"
            }
        },
        onSetMod: {
            js: function() {
                this.debouncedSetPeriod = jQuery.debounce(this.setPeriod.bind(this), 200), this.__base.apply(this, arguments)
            }
        },
        setPeriod: function() {
            var e = BEM.dataBindVal("segments.primary.period"),
                t = BEM.dataBindVal("segments.secondary.period");
            e && this.__base(BN("i-period").combinePeriods(e, t))
        }
    }), BEM.JSON.decl("segments-compare-wrapper", {
        onBlock: function(e) {
            e.content({
                elem: "segments",
                content: [{
                    elem: "heads-row",
                    content: [{
                        block: "segment-head",
                        mods: {
                            "data-bind": "secondary",
                            type: "secondary",
                            advice: "yes"
                        },
                        mix: [{
                            block: "segments-compare-wrapper",
                            elem: "head"
                        }]
                    }, {
                        block: "segment-head",
                        mods: {
                            "data-bind": "primary",
                            type: "primary"
                        },
                        mix: [{
                            block: "segments-compare-wrapper",
                            elem: "head"
                        }]
                    }]
                }, {
                    elem: "list-row",
                    content: [{
                        block: "segments-list",
                        mods: {
                            "data-bind": "secondary",
                            type: "secondary",
                            view: "compare",
                            data: "report"
                        },
                        mix: [{
                            block: "segments-compare-wrapper",
                            elem: "list"
                        }]
                    }, {
                        block: "segments-list",
                        mods: {
                            "data-bind": "primary",
                            type: "primary",
                            view: "compare",
                            data: "report"
                        },
                        mix: [{
                            block: "segments-compare-wrapper",
                            elem: "list"
                        }]
                    }]
                }]
            })
        }
    }), BN("i-segments-params").genDecl({
        name: "segment-head",
        modName: "data-bind",
        modVal: "secondary"
    }, "secondary-period"), BEM.DOM.decl({
        block: "segment-head",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.period": {
                initAccessor: "params.period",
                event: "change",
                get: "params.period",
                set: "_updatePeriod"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segment-head",
        modName: "data-bind",
        modVal: "primary"
    }, "period"), BEM.DOM.decl({
        block: "segment-head",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.period": {
                initAccessor: "params.period",
                event: "change",
                get: "params.period",
                set: "_updatePeriod"
            }
        }
    }), BEM.DOM.decl({
        name: "segments-list",
        modName: "data-bind",
        modVal: "secondary"
    }, {
        dataBindings: {
            "segments.secondary.filter": {
                event: "change",
                get: "params.filter",
                set: "update"
            }
        }
    }), BEM.DOM.decl({
        name: "segments-list",
        modName: "data-bind",
        modVal: "primary"
    }, {
        dataBindings: {
            "segments.primary.filter": {
                event: "change",
                get: "params.filter",
                set: "update"
            }
        }
    }), BN("i-segments-params").genDecl({
        name: "segments-list",
        modName: "type",
        modVal: "secondary"
    }, ["secondary-filter"]), BEM.JSON.decl("swop-segments", {
        onBlock: function(e) {
            var t = e.content() || [];
            e.js(!0).content(t.concat([{
                block: "button",
                mods: {
                    size: "s",
                    type: "swop-segments"
                },
                content: [{
                    block: "icon",
                    elem: "swop",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }, BEM.I18N("swop-segments", "swop")]
            }]), !0)
        }
    }), BEM.DOM.decl("swop-segments", {}, {
        live: function() {
            this.liveInitOnBlockInsideEvent("press", "button", function() {
                var e = BEM.dataBindVal("segments.primary");
                BEM.dataBindVal("segments.primary", BEM.dataBindVal("segments.secondary")), BEM.dataBindVal("segments.secondary", e)
            })
        }
    }), BEM.JSON.decl({
        name: "swop-segments",
        modName: "advice",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.content([{
                block: "advice",
                type: "compare",
                index: 3
            }])
        }
    }), BEM.JSON.decl("cancel-compare", {
        onBlock: function(e) {
            e.content({
                block: "smart-link",
                js: {
                    keepParams: ["delegation", "report", "data-table", "data-table-report-specific", "dimension_mode", "quantile", "chart", "data-table-dimension-filter", "inpage"],
                    path: e.param("report").getSinglePath()
                },
                content: {
                    block: "button",
                    mods: {
                        size: "s"
                    },
                    content: [{
                        block: "icon",
                        elem: "circle-arrow",
                        mods: {
                            color: "black"
                        },
                        mix: [{
                            block: "button",
                            elem: "icon"
                        }]
                    }, BEM.I18N("cancel-compare", "cancel")]
                }
            })
        }
    }), BEM.JSON.decl("cancel-compare", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.param("report", t)
            }))
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "monitoring"
    }, {
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: {
                        block: "date-selector",
                        mods: {
                            "data-bind": "report"
                        },
                        hideGrouping: !0
                    }
                }], !0).stop()
            },
            notifications: function(e) {
                e.content({
                    block: "notification",
                    notificationBlock: "public-counter-notification"
                })
            },
            "header-controls": function(e) {
                e.content({
                    elem: "export"
                })
            },
            chart: function(e) {
                e.content({
                    block: "chart-report",
                    mods: {
                        type: "monitoring"
                    }
                })
            },
            "table-toolbar": function(e) {
                e.content([{
                    block: "counter-mirrors-selector",
                    mods: {
                        "data-bind": "report"
                    }
                }, {
                    block: "monitoring-report-informer"
                }])
            },
            table: function(e) {
                e.content({
                    block: "table",
                    mods: {
                        report: "monitoring",
                        "fixed-head": "yes"
                    },
                    mix: [{
                        block: "report-page",
                        elem: "table-content"
                    }]
                })
            }
        }
    }), BEM.JSON.decl("counter-mirrors-selector", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.mirrors,
                n = t.mirror;
            return !i || i.length < 2 ? e.remove() : void e.js(!0).content([BEM.I18N("counter-mirrors-selector", "show-data-for"), "&nbsp;", {
                block: "select",
                js: {
                    popupParams: {
                        directions: "bottom-right"
                    }
                },
                name: "mirror",
                mods: {
                    size: "s",
                    theme: "normal"
                },
                attrs: {
                    autocomplete: "off"
                },
                content: [{
                    block: "button",
                    content: "",
                    mods: {
                        size: "s",
                        theme: "normal"
                    }
                }, {
                    elem: "control",
                    attrs: {
                        autocomplete: "off"
                    },
                    content: [{
                        elem: "option",
                        attrs: {
                            value: "",
                            selected: null === n ? "selected" : void 0
                        },
                        content: BEM.I18N("counter-mirrors-selector", "all")
                    }, i.map(function(e, t) {
                        return {
                            elem: "option",
                            attrs: {
                                value: t,
                                selected: t === n ? "selected" : void 0
                            },
                            content: BN("i-string").escapeHTML(e)
                        }
                    })]
                }]
            }])
        }
    }), BEM.JSON.decl("counter-mirrors-selector", {
        onBlock: function(e) {
            e.defer(BN("i-counters").getAsync().then(function(t) {
                var i = Number(BN("i-router").getParams().mirror);
                t.isSingle() && (e.params().mirrors = t.getMirrors(), e.params().mirror = isNaN(i) ? null : i)
            }))
        }
    }), BEM.DOM.decl("counter-mirrors-selector", {
        get: function() {
            var e = this.findBlockInside("select").val();
            return "" === e ? null : e
        }
    }, {
        live: function() {
            return this.liveInitOnBlockInsideEvent("change", "select", function(e) {
                this.trigger("change", e.block.val())
            }), !1
        }
    }), BEM.DOM.decl({
        name: "counter-mirrors-selector",
        modName: "data-bind",
        modVal: "report"
    }, {
        dataBindings: {
            "report.mirror": {
                initAccessor: "get",
                event: "change",
                get: "get"
            }
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "type",
        modVal: "monitoring"
    }, {
        onElem: {
            types: function(e) {
                var t = e.param("enabledChartTypes"),
                    i = e.param("chartType"),
                    n = BN("i-chart").monitoringTypesStructure();
                e.content({
                    block: "chart-type-selector",
                    selected: i,
                    types: BN("i-chart").monitoringChartTypes.map(function(e) {
                        return {
                            type: e,
                            name: n[e].name,
                            disabled: -1 === t.indexOf(e)
                        }
                    })
                }).stop()
            },
            "chart-wrap": function(e) {
                e.content([{
                    elem: "chart-inner"
                }]).stop()
            },
            "chart-toolbar": function(e) {
                e.content({
                    block: "monitoring-chart-informer"
                }).stop()
            }
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "type",
        modVal: "monitoring"
    }, {
        onBlock: function(e) {
            var t = BN("i-chart").monitoringChartTypes;
            e.defer(BN("i-report").getReport().then(function(i) {
                var n = i.getParamsModel().getState().chartType;
                e.param("chartType", -1 === t.indexOf(n) ? t[0] : n), e.param("enabledChartTypes", t)
            }))
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "type",
        modVal: "monitoring"
    }, {
        onSetMod: {
            js: function() {
                this._informer = this.findBlockInside("monitoring-chart-informer"), this.__base.call(this)
            }
        },
        _onModelReady: function() {
            return this._informer.update(this._dataModel.getDataModel().getUptimeAndFailures()), this.__base.call(this)
        },
        _getTitle: function() {
            return ""
        },
        _getDataModelBlock: function() {
            return "chart-data-model-monitoring"
        },
        _getChartBlockName: function() {
            return {
                errors: {
                    adapter: "report-chart-errors"
                },
                timeline: {
                    adapter: "report-chart-timeline"
                }
            }[this._type]
        },
        _getEnabledChartTypes: function() {
            return BN("i-chart").monitoringChartTypes
        }
    }), BEM.decl({
        name: "data-source-chart-monitoring",
        baseBlock: "data-source"
    }, {
        dataBindings: {
            "report.period": {
                set: "change"
            },
            "report.mirror": {
                set: "change"
            }
        },
        DEFAULT_LIMIT: 1e4,
        checkForNodata: function() {
            throw new Error("must be implemented in child/mod")
        },
        getUptimeAndFailures: function() {
            throw new Error("must be implemented in child/mod")
        },
        getPeriod: function() {
            return BEM.dataBindVal("report.period")
        },
        _getOptions: function() {
            return BN("i-report").getReport().then(function(e) {
                var t = e.getParamsModel().getState();
                return {
                    mirror_id: null === t.mirror ? void 0 : t.mirror,
                    offset: 0,
                    per_page: this.DEFAULT_LIMIT,
                    period: t.period
                }
            }.bind(this))
        },
        _loadData: function(e) {
            return BN("i-monitoring-api").getList(e).then(function(e) {
                return e = jQuery.extend(!0, {}, e)
            }.bind(this))
        }
    }), BEM.decl("i-monitoring-api", null, BEM.blocks["i-proxy"].initProxy("i-monitoring-api", ["_getList*"])), BEM.decl("i-monitoring-api", null, {
        getList: function(e) {
            return BN("i-counters").getAsync().then(function(t) {
                return t.isGroup() ? Vow.reject(new BEM.blocks["i-error-message"].MetrikaError("ERR_UNAVAILABLE_FOR_COUNTERS_GROUP")) : this._getList(jQuery.extend({
                    id: t.getId()
                }, e))
            }.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart-monitoring",
        modName: "mode",
        modVal: "errors"
    }, {
        checkForNodata: function() {
            var e = this.getData();
            return !(e && e.data || []).filter(function(e) {
                return "dead" === e.status
            }).length
        },
        getUptimeAndFailures: function() {
            return {
                noData: !0
            }
        }
    }), BEM.decl({
        name: "data-source-chart-monitoring",
        modName: "mode",
        modVal: "timeline"
    }, {
        checkForNodata: function() {
            var e = this.getData();
            return !e || !e.data || !e.data.length
        },
        getUptimeAndFailures: function() {
            var e = this.getData(),
                t = 100 * e.uptime,
                i = 0;
            return this.getError() || this.checkForNodata() ? {
                noData: !0
            } : (e.data.filter(function(e) {
                return "dead" === e.status
            }).forEach(function(e) {
                i += e.length
            }), {
                uptime: t,
                failure: 100 - t,
                failureLength: i
            })
        }
    }), BEM.decl({
        name: "chart-data-model-monitoring",
        baseBlock: "chart-data-model"
    }, {
        DATA_SOURCE_BLOCK: "data-source-chart-monitoring",
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), this._dataModel.reload()
            }
        },
        setType: function(e) {
            this._dataModel = this._updateDataModelMode(this.getDataModel(), this._getDataSourceDecl(e))
        },
        getDataModel: function() {
            return this._dataModel
        },
        checkForNodata: function() {
            return this.getDataModel().checkForNodata()
        },
        getError: function() {
            return this.getDataModel().getError()
        },
        checkSomethingSelected: function() {
            return !0
        },
        checkSelectableRowsPresent: function() {
            return !0
        },
        reload: function() {
            return this.getDataModel().reload()
        },
        _onChange: function() {
            this.__base.call(this), this.reload()
        }
    }), BEM.JSON.decl("monitoring-chart-informer", {
        onBlock: function(e) {
            e.js(!0)
        },
        onElem: {
            info: function(e) {
                var t = e.params().data;
                t.noData ? e.remove() : e.mix([{
                    block: "clearfix"
                }]).content([{
                    elem: "uptime",
                    uptime: t.uptime
                }, {
                    elem: "failures",
                    failure: t.failure,
                    failureLength: t.failureLength
                }])
            },
            uptime: function(e) {
                e.content([BEM.I18N("monitoring-chart-informer", "uptime"), ": ", BN("formatter").run([], {
                    value: e.param("uptime"),
                    dataType: "percents"
                })])
            },
            failures: function(e) {
                e.content([BEM.I18N("monitoring-chart-informer", "failures"), ": ", BN("formatter").run([], {
                    value: e.param("failure"),
                    dataType: "percents"
                }), " / ", BEM.I18N("monitoring-chart-informer", "all"), ": ", BN("i-date").formatLength(e.param("failureLength"))])
            }
        }
    }), BEM.DOM.decl("monitoring-chart-informer", {
        update: function(e) {
            BN("i-content").update(this.domElem, {
                block: this.__self.getName(),
                elem: "info",
                data: e
            })
        }
    }), BN.addDecl("i-date").staticProp({
        formatLength: function(e) {
            return BEM.I18N("i-date", "length", this._createLengthObject(e))
        },
        _createLengthObject: function(e) {
            var t = {
                weeks: 0,
                days: 0,
                hours: 0,
                minutes: 0,
                seconds: e
            };
            return t.minutes = Math.floor(t.seconds / 60), t.seconds = t.seconds % 60, t.hours = Math.floor(t.minutes / 60), t.minutes = t.minutes % 60, t.days = Math.floor(t.hours / 24), t.hours = t.hours % 24, t.weeks = Math.floor(t.days / 7), t.days = t.days % 7, t
        }
    }).done(), BEM.decl({
        name: "report-chart-errors",
        baseBlock: "report-chart-pie"
    }, {
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            this._chartOptions.series = [{
                data: e.series
            }]
        },
        _getChartDataOptions: function() {
            var e, t = this._dataModel.getData(),
                i = BN("i-colorpool").create();
            return e = t.data.reduce(function(e, t) {
                var n, o = t.message;
                return "dead" === t.status && (n = e[o] = e[o] || {
                    name: o,
                    y: 0,
                    color: i.getColor()
                }, n.y += t.length), e
            }, {}), {
                series: Object.keys(e).map(function(t) {
                    return e[t]
                })
            }
        },
        _tooltipFormatter: function(e, t) {
            return t.name + ", " + BN("humanize").formatPercents(t.percentage)
        },
        _labelFormatter: function(e) {
            return e.name
        },
        _getLegendData: function() {
            return !1
        }
    }), BEM.decl({
        name: "report-chart-timeline",
        baseBlock: "report-chart"
    }, {
        ALIVE_COLOR: "#91D750",
        DEAD_COLOR: "#E9290F",
        UNAVAILABLE_COLOR: "#DDDDDD",
        OPTIMAL_TICKS_COUNT: 10,
        DATE_GROUP_VERGE: 864e3,
        _initChartOptions: function() {
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "bar",
                    spacing: [1, 0, 0, 0],
                    marginLeft: 140,
                    marginRight: 70
                },
                plotOptions: {
                    bar: {
                        borderWidth: 0,
                        groupPadding: .1
                    },
                    series: {
                        stacking: "normal",
                        pointWidth: 50,
                        minPointLength: 1
                    }
                },
                xAxis: {
                    lineWidth: 0,
                    tickWidth: 0,
                    tickLength: 0
                },
                yAxis: {
                    min: 0,
                    lineWidth: 1,
                    gridLineWidth: 0,
                    tickWidth: 1,
                    tickLength: 5,
                    tickPixelInterval: 150
                },
                tooltip: {
                    followPointer: !0
                }
            })
        },
        _getLegendData: function() {
            return !1
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            jQuery.extend(!0, this._chartOptions, {
                chart: {
                    height: 60 * e.xAxisCategories.length + 100
                },
                xAxis: {
                    categories: e.xAxisCategories
                },
                yAxis: {
                    max: e.maxTime,
                    tickInterval: e.tickInterval,
                    labels: {
                        formatter: e.yAxisFormatter
                    },
                    endOnTick: !1,
                    maxPadding: 0
                },
                series: e.series
            })
        },
        _getChartDataOptions: function() {
            var e, t, i, n, o, s, r = this,
                a = this._dataModel.getData(),
                l = this._dataModel.getPeriod(),
                c = this._toChartVal(l.from),
                d = this._toChartVal(l.to),
                u = d - c;
            0 === u && (u = 86400), e = a.data.reduce(function(e, t) {
                var i = t.domain;
                return e[i] = e[i] || [], e[i].push({
                    y: t.length,
                    date1: t.from,
                    date2: t.to,
                    color: "dead" === t.status ? this.DEAD_COLOR : this.ALIVE_COLOR,
                    domain: t.domain,
                    message: t.message
                }), e
            }.bind(this), {}), t = Object.keys(e), t.forEach(function(t) {
                var i, n, o, s, r, a = e[t];
                0 !== a.length && (i = a[a.length - 1], n = a[0], o = this._toChartVal(i.date1), s = this._toChartVal(n.date2), r = {
                    color: this.UNAVAILABLE_COLOR,
                    domain: i.domain,
                    message: BEM.I18N("report-chart-timeline", "no-data")
                }, o > c && a.push(jQuery.extend({
                    y: o - c,
                    date1: l.from,
                    date2: i.date1
                }, r)), d > s && a.unshift(jQuery.extend({
                    y: d - s,
                    date1: n.to,
                    date2: l.date2
                }, r)))
            }, this), i = t.reduce(function(t, i) {
                return e[i].length > t ? e[i].length : t
            }, 0), s = Math.ceil(u / this.OPTIMAL_TICKS_COUNT), n = {
                maxTime: s * this.OPTIMAL_TICKS_COUNT,
                tickInterval: s,
                xAxisCategories: t,
                yAxisFormatter: function() {
                    return r._formatDateTime({
                        dateTime: 3600 * Math.round((c + this.value) / 3600),
                        localeKey: "axis",
                        group: u <= r.DATE_GROUP_VERGE ? "hours" : "day"
                    })
                },
                series: []
            }, o = function(t) {
                return e[t][h] || 0
            };
            for (var h = 0; i > h; h++) n.series.push({
                data: t.map(o)
            });
            return n
        },
        _toChartVal: function(e) {
            return BN("i-date").create(e).getTime() / 1e3
        },
        _tooltipFormatter: function(e, t) {
            var i = BN("formatter").run("chart", jQuery.extend({
                type: "monitoring-date"
            }, t));
            return t.message + "<br />" + i + "<br />" + BEM.I18N("report-chart-timeline", "interval") + ": " + BN("i-date").compactPeriod(1e3 * t.y)
        },
        _tooltipPositioner: function(e, t, i) {
            var n = this.chart.options.chart.marginLeft,
                o = i.plotX - e / 2 + n;
            return o = Math.max(o, n), o = Math.min(o, this.chart.chartWidth - e - this.chart.options.chart.marginRight), {
                x: o,
                y: 0
            }
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "monitoring"
    }, {
        onBlock: function(e) {
            var t = e.params(),
                i = t.report;
            t.columns = [{
                name: "domain",
                sortable: !0,
                header: BEM.I18N("table", "header-monitoring-domain")
            }, {
                name: "from",
                header: BEM.I18N("table", "header-monitoring-from"),
                sortable: !0,
                format: {
                    name: "date",
                    format: "Y-m-d H:i:s"
                }
            }, {
                name: "to",
                sortable: !0,
                header: BEM.I18N("table", "header-monitoring-to"),
                format: {
                    name: "date",
                    format: "Y-m-d H:i:s"
                }
            }, {
                name: "length",
                sortable: !0,
                header: BEM.I18N("table", "header-monitoring-length"),
                format: "monitoring-duration"
            }, {
                name: "message",
                sortable: !0,
                header: BEM.I18N("table", "header-monitoring-message"),
                format: "status-message",
                source: "status-message"
            }], t.source = "table-data-source-monitoring", t.sort = i.sort
        },
        onElem: {
            th: function(e) {
                e.mod("name", e.params().column.name)
            },
            td: function(e) {
                var t = e.params(),
                    i = t.model.getColumns()[e.pos() - 1];
                e.mod("name", i.name)
            }
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "monitoring"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                var i = t.getParamsModel().getState();
                e.params().firstLoadLimit = i.offset + i.limit, e.params().report = t.getParamsModel().getParams()
            }))
        }
    }), BEM.decl({
        name: "table-data-source-monitoring",
        baseBlock: "table-data-source"
    }, {
        limitKey: "per_page",
        totalKey: "rows",
        limit: 1e4,
        dataBindings: {
            "report.period": {
                initAccessor: "_update",
                set: "_update"
            },
            "report.mirror": {
                initAccessor: "_update",
                set: "_update"
            },
            "report.sort": {
                get: "getSerializedSort",
                event: "sort.change"
            },
            "report.limit": {
                initAccessor: "getLimit",
                event: "limit.change"
            },
            "report.offset": {
                initAccessor: "getOffset",
                event: "offset.change"
            }
        },
        getData: function() {
            return this.__base().data
        },
        getFrequency: function() {
            return this._data && this._data.frequency
        },
        _update: function() {
            this.setOffset(0).fetch()
        },
        _getOptions: function() {
            return Vow.all([this.__base.apply(this, arguments), BN("i-report").getReport()]).spread(function(e, t) {
                var i = t.getParamsModel().getState();
                return e.mirror_id = null === i.mirror ? void 0 : i.mirror, e.period = i.period, e
            })
        },
        _loadData: function(e) {
            return BN("i-monitoring-api").getList(e).then(function(e) {
                return this._setDataLag(e.data_lag || 0), e
            }.bind(this))
        }
    }), BN.addDecl("table__formatter").staticProp({
        "format.monitoring-duration": function(e) {
            return BN("i-date").formatLength(e)
        },
        "format.status-message": function(e) {
            return {
                elem: "monitoring-message",
                mods: {
                    status: e.status
                },
                content: BN("i-string").escapeHTML(e.message)
            }
        }
    }).done(), BN.addDecl("table__reader").staticProp({
        "reader.status-message": function(e) {
            return {
                status: e.status,
                message: e.message
            }
        }
    }).done(), BEM.JSON.decl("table", {
        onElem: {
            sorter: function(e) {
                var t = e.params(),
                    i = t.sort,
                    n = i ? BN("table").getSortMode(i.mode) : "";
                e.tag("span").mod("sort", n).content({
                    block: "icon",
                    elem: "triangle",
                    mods: {
                        direction: BN("table").getSortIconMode(n)
                    }
                })
            }
        }
    }), BN.addDecl("table").staticProp({
        getSortMode: function(e) {
            return e && ["asc", "desc"].indexOf(e) >= 0 ? e : "asc"
        },
        getSortIconMode: function(e) {
            return "asc" === e ? "up" : "desc" === e ? "down" : "both"
        }
    }).done(), BEM.DOM.decl("table", {
        onElemSetMod: {
            sorter: function(e, t, i, n) {
                var o, s;
                n || this.delMod(this.findElem("sorter"), "sort"), o = this.findBlockInside(e, "icon"), o.setMod(o.elem("triangle"), "direction", BN("table").getSortIconMode(i)), i && this.getModel().then(BN("i-promise").createChain(this)(function(t) {
                    s = t.getColumns()[this.getMod(e.parents(this.buildSelector("th")), "n")], this.setSort({
                        field: s.getName(),
                        mode: i
                    })
                }.bind(this))).done()
            }
        }
    }, {
        live: function() {
            return this.liveBindTo("th-inner_sortable_yes", "click", function(e) {
                var t = this.findElem(jQuery(e.data.domElem).parent("th"), "sorter");
                this.setMod(t, "sort", this.hasMod(t, "sort", "desc") ? "asc" : "desc")
            }), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl({
        block: "table",
        modName: "fixed-head",
        modVal: "yes"
    }, {
        onSetMod: {
            state: {
                ready: function() {
                    var e = 300;
                    return this.__base.apply(this, arguments), this.findElem("fixed-head").length ? void(this.getMod("show-head") || BEM.DOM.update(this.findElem(this.elem("fixed-head-table"), "head"), "")) : (this._fitFixedHead = $.throttle(this._fitFixedHead, 100, this), this._onDocumentScroll = $.throttle(this._onDocumentScroll, 100, this), this._onParentScroll = $.throttle(this._onParentScroll, 100, this), this._debouncedFitFixedHead = jQuery.debounce(this._fitFixedHead, e, this), void BN("i-content").prepend(this.domElem, {
                        block: "table",
                        mods: this.getInitialMods(),
                        elem: "fixed-head"
                    }).then(function() {
                        "enabled" === this.getMod("scroll-top") && this.findBlockOn("scroll-top", "button").on("click", this._scrollTop, this);
                        var e = this.findElem(this.elem("fixed-head"), "table"),
                            t = this.getMods(this.findElem("table").not(e));
                        Object.keys(t).forEach(function(i) {
                            this.setMod(e, i, t[i])
                        }.bind(this)), this.bindToWin("scroll", this._onDocumentScroll.bind(this)), this.on("resize", this._freezeColumnWidth, this), this._onDocumentScroll(), BN("main-menu").on("toggle", this._debouncedFitFixedHead, this)
                    }.bind(this)).done())
                }
            },
            "show-head": {
                yes: function() {
                    this._freezeColumnWidth(), this.elem("fixed-head-table").html(""), this.findElem("head").detach().prependTo(this.elem("table")), this._fitFixedHead(), this.bindTo(this.domElem.parent(), "scroll", this._onParentScroll), this.bindToWin("resize", this._fitFixedHead.bind(this)), this._onParentScroll()
                },
                "": function() {
                    var e = this.findElem(this.elem("fixed-head-table"), "head").detach();
                    this.findElem("head").replaceWith(e), this.unbindFrom(this.domElem.parent(), "scroll", this._onParentScroll), this.unbindFromWin("resize", this._fitFixedHead.bind(this))
                }
            }
        },
        destruct: function() {
            BN("main-menu").un("toggle", this._debouncedFitFixedHead, this), this.__base.apply(this, arguments)
        },
        _onDocumentScroll: function() {
            var e = this.domElem.offset().top,
                t = e < $(window).scrollTop();
            this.toggleMod("show-head", "yes", t), this._onParentScroll()
        },
        _onParentScroll: function() {
            var e = -(this.domElem.parent().scrollLeft() + $(document).scrollLeft());
            this.elem("fixed-head-table").css("left", e + "px"), this.elem("scroll-top").css("right", -e + "px")
        },
        _scrollTop: function() {
            $("html, body").animate({
                scrollTop: this.domElem.offset().top
            }, 200)
        },
        _freezeColumnWidth: function() {
            var e = {},
                t = this.findElem("table").not(this.buildSelector("fixed-head-table")).outerWidth();
            this.elem("fixed-head-table").css("width", t), this.findElem("th").each(function(t, i) {
                var n = $(i),
                    o = this.getMod(n, "n");
                e[o] || (e[o] = n.width()), n.css("width", e[o])
            }.bind(this))
        },
        _fitFixedHead: function() {
            var e = this.domElem.offset().left + this.domElem.parent().scrollLeft(),
                t = this.findElem("table").not(this.buildSelector("fixed-head-table")).outerWidth();
            this.elem("fixed-head").css("left", e), this.elem("fixed-head-table").css("width", t)
        }
    }), BEM.JSON.decl("table", {
        onElem: {
            "fixed-head": function(e) {
                var t = e.blockParams().mods;
                e.content(["enabled" === t["scroll-top"] && {
                    block: "button",
                    mix: {
                        block: "table",
                        elem: "scroll-top"
                    },
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    content: {
                        block: "table",
                        elem: "scroll-top-icon",
                        tag: "span",
                        content: "&#9650;"
                    }
                }, {
                    elem: "fixed-head-table",
                    mix: {
                        block: "table",
                        elem: "table"
                    },
                    tag: "table"
                }])
            }
        }
    }), BEM.JSON.decl("monitoring-report-informer", {
        onBlock: function(e) {
            e.js(!0)
        },
        onElem: {
            frequency: function(e) {
                var t = e.params().frequency;
                t ? e.content([BEM.I18N("monitoring-report-informer", "update-frequency"), " ", BN("i-date").formatLength(t)]) : e.remove()
            }
        }
    }), BEM.DOM.decl("monitoring-report-informer", {
        onSetMod: {
            js: function() {
                BN("table-data-source-monitoring").on("ready", this._update, this)
            }
        },
        destruct: function() {
            return BN("table-data-source-monitoring").un("ready", this._update, this), this.__base.apply(this, arguments)
        },
        _update: function(e, t) {
            BN("i-content").update(this.domElem, {
                block: this.__self.getName(),
                elem: "frequency",
                frequency: t.getFrequency()
            })
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "legacy"
    }, {
        onElem: {
            "table-toolbar": function(e) {
                e.remove()
            },
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "date-selector",
                        mods: {
                            "data-bind": "report",
                            data: "report"
                        }
                    }]
                }], !0)
            },
            chart: function(e) {
                var t = e.param("chart-mods") || {};
                t = jQuery.extend({}, t, {
                    type: "legacy"
                }), e.param("chart-mods", t)
            },
            table: function(e) {
                e.content({
                    block: "data-table",
                    mods: {
                        "data-bind": "report",
                        "fixed-head": "yes"
                    }
                })
            }
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "type",
        modVal: "legacy"
    }, {
        _getDataModelBlock: function() {
            return "chart-data-model-legacy"
        },
        _getChartBlockName: function() {
            var e = this.__base.apply(this, arguments);
            return e.adapterMode = "single", e
        },
        _getEnabledChartTypes: function(e) {
            return BN("i-chart").enabledChartTypes(e.getMetricMeta(), e.getDimensionsMeta(), e.isOnePeriod(), !1, !1)
        }
    }), BEM.decl({
        name: "chart-data-model-legacy",
        baseBlock: "chart-data-model-single"
    }, {
        DATA_SOURCE_BLOCK: "data-source-chart-legacy"
    }), BEM.decl({
        block: "data-source-chart-legacy",
        baseBlock: "data-source-chart-single"
    }, {
        _getOptions: function() {
            return this.__base.apply(this, arguments).then(function(e) {
                return e.preset = this._meta.getPresetName(), e
            }.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart-legacy",
        modName: "mode",
        modVal: "dynamic"
    }, {
        _loadData: function() {
            return this.__base.apply(this, arguments).then(this._extractOnlyRequiredMetric.bind(this))
        }
    }), BEM.decl({
        name: "data-source-chart-legacy",
        modName: "mode",
        modVal: "bytime"
    }, {
        _loadData: function() {
            return this.__base.apply(this, arguments).then(this._extractOnlyRequiredMetric.bind(this))
        }
    }), BEM.JSON.decl({
        name: "chart-report",
        modName: "robots",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "informer"
            }, {
                elem: "common-container"
            }])
        }
    }), BEM.DOM.decl({
        block: "chart-report",
        modName: "robots",
        modVal: "yes"
    }, {
        _getChartBlockName: function() {
            return {
                adapter: "report-chart-bytime",
                adapterMode: "single"
            }
        },
        _getDataModelBlock: function() {
            return "chart-data-model-robots"
        },
        _getDataModelMods: function() {
            return {
                "chart-type": "bytime",
                type: "bytime"
            }
        },
        _onModelChange: function() {
            return BN("i-content").update(this.elem("informer"), {
                block: "spin2",
                mods: {
                    size: "xxs",
                    progress: "yes"
                }
            }), this.__base.apply(this, arguments)
        },
        _onModelReady: function() {
            var e = BN("i-promise").createChain(this);
            this.__base.apply(this, arguments), BN("i-content").html({
                block: "informer-robots"
            }).then(e(function(e) {
                BEM.DOM.update(this.elem("informer"), e)
            }))
        }
    }), BEM.decl({
        name: "chart-data-model-robots",
        baseBlock: "chart-data-model-legacy"
    }, {
        DATA_SOURCE_BLOCK: "data-source-chart-robots"
    }), BEM.decl({
        name: "data-source-chart-robots",
        baseBlock: "data-source-chart-single"
    }, {
        js: function() {
            this.__base.apply(this, arguments), BN("data-table").un("reload", this.reload, this)
        },
        _getOptions: function() {
            var e = this.__self.ROBOTS_ID;
            return Vow.all([this.__base.apply(this, arguments), BN("i-report").getReport()]).spread(function(t, i) {
                return t["row-ids"] = [
                    [e]
                ], t.preset = i.getChartPreset(), t
            })
        }
    }, {
        ROBOTS_ID: 1,
        getRobotsTotals: function() {
            var e = this.ROBOTS_ID;
            return Vow.all([BN("i-report").getReport(), BN("i-counters").getAsync()]).spread(function(e, t) {
                return BN("i-legacy-data").loadData({
                    ids: t.getApiCounterId(),
                    period: BN("i-period").getPeriod(),
                    mode: "list",
                    preset: e.getChartPreset()
                })
            }).then(function(t) {
                var i = 0;
                return t.data.some(function(t) {
                    return parseInt(t.dimensions[0].id, 10) === e ? (i = t.metrics[0], !0) : void 0
                }), {
                    robots: i,
                    total: t.totals[0]
                }
            })
        }
    }), BEM.JSON.decl("informer-robots", {
        onBlock: function(e) {
            var t = e.params().totals;
            t && t.robots ? e.content([BEM.I18N("informer-robots", "robots-percent", t), " ", BEM.I18N("informer-robots", "robots-count", {
                textCount: BN("humanize").format("int", t.robots),
                intCount: t.robots
            })]) : e.remove()
        }
    }), BEM.JSON.decl("informer-robots", {
        onBlock: function(e) {
            e.defer(BN("data-source-chart-robots").getRobotsTotals().then(function(t) {
                e.params().totals = t
            }))
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "webvisor"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "controls"
            }, {
                elem: "table"
            }, {
                block: "data-lag-notification"
            }])
        },
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "date-selector",
                        mods: {
                            "data-bind": "report"
                        },
                        hideGrouping: !0
                    }]
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "segments-selector",
                        mods: {
                            data: "report"
                        },
                        dataBind: "report",
                        menuType: "primary"
                    }]
                }, {
                    block: "segments-wrapper"
                }, {
                    elem: "table-controls"
                }], !0).stop()
            },
            notifications: function(e) {
                e.content([{
                    block: "notification",
                    notificationBlock: "public-counter-notification"
                }, {
                    block: "notification",
                    notificationBlock: "sensitive-data-warning",
                    mods: {
                        type: "webvisor"
                    }
                }, {
                    block: "notification",
                    notificationBlock: "missing-attribute-data-notification"
                }])
            },
            "table-controls": function(e) {
                e.content([{
                    block: "webvisor-boolean-filter",
                    label: BEM.I18N("report-page", "webvisor-chosen-filter"),
                    segmentId: "ym:s:webVisorSelected",
                    pressedValue: "Yes"
                }, {
                    block: "webvisor-boolean-filter",
                    label: BEM.I18N("report-page", "webvisor-viewed-filter"),
                    segmentId: "ym:s:webVisorViewed",
                    pressedValue: "No"
                }, {
                    block: "webvisor-mark-viewed-button"
                }])
            },
            "header-controls": function(e) {
                e.content({
                    elem: "export"
                })
            },
            table: function(e) {
                e.content({
                    block: "table-scroll",
                    content: {
                        block: "table",
                        mods: {
                            report: "webvisor",
                            "fixed-head": "yes"
                        },
                        mix: [{
                            block: "report-page",
                            elem: "table-content"
                        }]
                    }
                })
            }
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "webvisor"
    }, {
        onBlock: function(e) {
            var t = e.params();
            t.source = "table-data-source-webvisor", t.model = "table__model_report_webvisor"
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "webvisor"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                var i = t.getParamsModel().getState();
                e.params().firstLoadLimit = i.offset + i.limit, e.params().sort = i.sort
            }))
        }
    }), BEM.DOM.decl({
        block: "table",
        modName: "report",
        modVal: "webvisor"
    }, {
        onSetMod: {
            js: function() {
                this.__base.apply(this, arguments), BN("i-report").getMetadata().then(function(e) {
                    this._meta = e.on("change", this._onMetadataChange, this)
                }.bind(this)), BN("toggle-expand").on(this.domElem, "change", this._onToggleExpand, this), this._hitsTable = {}, BN("play-hit-button").liveCtxBind(this.domElem, "play", this._onPlayClick, this), this.__self._webvisorTableInstances.push(this)
            },
            state: {
                ready: function() {
                    this.__base.apply(this, arguments), this._subscribeDrag()
                }
            }
        },
        onElemSetMod: {
            "body-row": {
                expanded: {
                    "": function(e) {
                        var t = this._hitsTable[this.elemParams(e).visitId];
                        t && this.setMod(t, "hidden", "yes")
                    },
                    yes: function(e) {
                        this.getModel().then(BN("i-promise").createChain(this)(function(t) {
                            var i = this.elemParams(e),
                                n = this._hitsTable[i.visitId];
                            n ? this.delMod(n, "hidden") : (n = this._hitsTable[i.visitId] = jQuery(BN("i-content").html({
                                block: "table",
                                mods: {
                                    report: "webvisor"
                                },
                                elem: "hit-info",
                                model: t,
                                visitId: i.visitId,
                                userIdHash: i.userIdHash
                            }, !0)), BEM.DOM.after(e, n))
                        }.bind(this))).done()
                    }
                }
            }
        },
        destruct: function() {
            return this._meta && this._meta.un("change", this._onMetadataChange, this), BN("sensitive-data-warning").hide(), BN("missing-attribute-data-notification").hide(), this._unsubscribeDrag(), this.__self._webvisorTableInstances = this.__self._webvisorTableInstances.filter(function(e) {
                return e !== this
            }, this), this.__base.apply(this, arguments)
        },
        _onPlayClick: function(e) {
            var t = this.elemify(e.block.domElem.parents(this.buildSelector("body-row")), "body-row");
            this.setMod(t, "viewed", "yes")
        },
        _subscribeDrag: function() {
            var e, t = this;
            this._unsubscribeDrag(), this._draggers = this.findElem("th"), e = this._draggers.last(), this._updateLastColumnWidth(e), this.bindToWin("resize", this._updateLastColumnWidth.bind(this, e)), jQuery(this._draggers).drag("start", function(e, i) {
                i.th = jQuery(this), i.columnNumber = t.getMod(jQuery(this), "n"), i.width = i.th.width()
            }).drag(function(e, i) {
                var n = Math.max(15, i.width + i.deltaX),
                    o = t.getMod(i.th, "n");
                t.findElem("th", "n", o).css("width", n), t._columnResize(i.columnNumber, n)
            }, {
                handle: this.buildSelector("dragger")
            }).drag("end", this._updateLastColumnWidth.bind(this, e))
        },
        _unsubscribeDrag: function() {
            this._draggers && (this._draggers.unbind("start"), this._draggers.unbind("drag"), this._draggers = null, this.unbindFromWin("resize"))
        },
        _columnResize: function(e, t) {
            this.trigger("resize"), this.getModel().then(BN("i-promise").createChain(this)(function(i) {
                i.columnResize(e, t)
            }.bind(this))).done()
        },
        _updateLastColumnWidth: function(e) {
            var t = this.domElem.width(),
                i = this.domElem.parent().width(),
                n = e.width();
            t - n > i ? e.width(120) : e.width(Math.max(120, i - t + n))
        },
        _onDataReady: function() {
            var e = this.getSource().getPeriod();
            this.__base.apply(this, arguments), BN("sensitive-data-warning").show(this.getSource().hasSensitiveData()), BN("i-report").getMetadata().then(function(t) {
                var i = t.getDimensionsMeta().filter(function(e) {
                    return t.isTableColumnDimension(e.dim)
                });
                BN("missing-attribute-data-notification").show(t.getMetricsMeta(), i, e)
            }).done(), 0 === this.getSource().getOffset() && (this._hitsTable = {})
        },
        _onMetadataChange: function() {
            var e;
            this._meta && ($("html, body").scrollTop(this.domElem.offset().top), this.getModel().then(BN("i-promise").createChain(this)(function(t) {
                e = this._meta.validateSortDirection(this.getSort()), this.setSort(e), this.getSource().setOffset(0), t.update(this._meta)
            }.bind(this))).done())
        },
        _onToggleExpand: function(e, t) {
            this.toggleMod(e.block.domElem.parents(this.buildSelector("body-row")), "expanded", "yes", t)
        },
        _markAllRowsViewed: function() {
            this.setMod(this.findElem("body-row"), "viewed", "yes")
        }
    }, {
        _webvisorTableInstances: [],
        markAllRowsViewed: function() {
            this._webvisorTableInstances.forEach(function(e) {
                e._markAllRowsViewed()
            })
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "webvisor"
    }, {
        onElem: {
            "body-row": function(e) {
                var t = e.params(),
                    i = t.source,
                    n = t.data;
                i.isViewed(n) && e.mod("viewed", "yes"), e.js({
                    visitId: i.getVisitId(n),
                    userIdHash: i.getUserIdHash(n)
                })
            },
            td: function(e) {
                var t = e.params(),
                    i = t.model.getColumns()[e.pos() - 1].getMod("type");
                i && e.mod("type", BEM.toModVal(i))
            },
            th: function(e) {
                var t = e.params(),
                    i = t.column,
                    n = i.params.segmentId,
                    o = [],
                    s = e.mods() || {};
                o.push({
                    elem: "th-inner",
                    column: i,
                    mods: {
                        sortable: i.isSortable() ? "yes" : void 0
                    }
                }), i.isSortable() && (o.push({
                    elem: "sorter",
                    column: i,
                    sort: t.sort
                }), s.sortable = "yes"), n && (o.push({
                    block: "webvisor-filter-button",
                    segmentId: n
                }), s.filterable = "yes"), i.params.draggable && (i.params.width && e.attrs({
                    style: "width: " + i.params.width + "px;"
                }), o.push({
                    elem: "dragger"
                }), s.draggable = "yes"), e.mods(s), e.content(o)
            },
            "th-inner": function(e) {
                var t = e.params().column;
                e.content(t.getHeader()), e.stop()
            },
            actions: function(e) {
                var t = e.params().data,
                    i = BN("i-date").create(t.dateTime).format("Y-m-d");
                e.content([{
                    block: "webvisor-row-filter-popup",
                    rowData: t.dimensions
                }, {
                    block: "visit-info",
                    visitId: t.visitId,
                    date: i
                }])
            },
            "hit-info": function(e) {
                var t = e.params();
                e.tag("tr").mod("state", "loading").content({
                    tag: "td",
                    attrs: {
                        colspan: t.model.getColumns().length
                    },
                    content: {
                        block: "hit-list",
                        mods: {
                            lazy: "yes"
                        },
                        visitId: t.visitId,
                        userIdHash: t.userIdHash
                    }
                })
            }
        }
    }), BEM.decl({
        name: "table-data-source-webvisor",
        baseBlock: "table-data-source"
    }, {
        totalKey: "total_rows",
        limit: 50,
        containsSensitiveData: !1,
        dataBindings: {
            "report.period": {
                set: "_update"
            },
            "report.limit": {
                initAccessor: "getLimit",
                event: "limit.change"
            },
            "report.offset": {
                initAccessor: "getOffset",
                event: "offset.change"
            },
            "report.sort": {
                get: "getSort",
                event: "sort.change"
            },
            "report.filter": {
                initAccessor: "setFilter",
                set: "_updateFilter"
            }
        },
        getData: function() {
            return this.__base().data
        },
        setFilter: function(e) {
            this.params.filter = e
        },
        getVisitId: function(e) {
            return e.dimensions[this._meta.getVisitIdIdx()].name
        },
        getUserIdHash: function(e) {
            return e.dimensions[this._meta.getUserIdHashIdx()].name
        },
        isViewed: function(e) {
            return "yes" === e.dimensions[this._meta.getViewedIdx()].name
        },
        hasSensitiveData: function() {
            return Boolean(this.containsSensitiveData)
        },
        setOffset: function(e) {
            return 0 === e && (this.containsSensitiveData = !1, this._setDataLag(0)), this.__base.apply(this, arguments)
        },
        getPeriod: function() {
            return BEM.dataBindVal("report.period")
        },
        _updateFilter: function(e) {
            this.setFilter(e), this._update()
        },
        _update: function() {
            this.setOffset(0).fetch()
        },
        _getOptions: function() {
            return Vow.all([this.__base(), BN("i-report").getMetadata()]).spread(function(e, t) {
                var i, n = this.getPeriod();
                return e.date1 = n.from, e.date2 = n.to, e.dimensions = t.getDimensions().join(","), e.id = BN("i-counters").getCounterId(), i = BN("i-webvisor-filter").buildFilter(this.params.filter, t.getSegmentsTree()), i && (e.filters = i), e.offset += 1, this._meta = t, e
            }.bind(this))
        },
        _loadData: function(e) {
            return BN("i-webvisor-data-api").getList(e).then(function(e) {
                return this.containsSensitiveData = this.containsSensitiveData || Boolean(e.contains_sensitive_data), this._setDataLag(Math.max(this.getDataLag(), e.data_lag || 0)), e
            }.bind(this))
        }
    }), BN.addDecl("i-webvisor-filter").baseBlock("i-filter").staticProp({
        serializeList: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        serializeMultiline: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        serializeBool: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        serializeUid: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        serializeNumber: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        serializeDate: function(e, t) {
            return this.__base(e, this._toWebvisorSegment(t))
        },
        _toWebvisorSegment: function(e) {
            return {
                dim: e.wv_dim || e.dim
            }
        }
    }).done(), BN.addDecl("table__formatter").staticProp({
        "format.report-dimension": function(e) {
            return BN("i-string").escapeHTML(e.name)
        },
        "format.report-dimension-typed": function(e, t, i) {
            return BN("humanize").format(i.type, e.name)
        },
        "format.report-metric": function(e) {
            return BN("i-string").escapeHTML(e)
        },
        "format.report-metric-typed": function(e, t, i) {
            return BN("humanize").format(i.type, e)
        },
        "format.report-icon": function(e) {
            return {
                block: "icon",
                elem: e.icon_type,
                mods: {
                    id: e.icon_id
                },
                attrs: e.name && {
                    title: e.name
                }
            }
        },
        "format.report-duration": function(e) {
            return BN("table__formatter").lookup("duration")(e.name)
        },
        "format.report-favicon": function(e) {
            return e.favicon ? {
                block: "icon",
                mods: {
                    type: "favicon"
                },
                domain: e.favicon
            } : ""
        }
    }).done(), BN.addDecl("table__formatter").staticProp({
        "format.webvisor-actions": function(e, t) {
            return {
                block: "table",
                mods: {
                    report: "webvisor"
                },
                elem: "actions",
                source: t.source,
                data: e
            }
        },
        "format.webvisor-play-button": function(e) {
            return {
                block: "play-hit-button",
                visitId: e.visitId.name,
                userIdHash: e.userIdHash.name,
                dateTime: e.dateTime.name,
                activity: e.activity.name
            }
        },
        "format.webvisor-expand": function() {
            return {
                block: "toggle-expand",
                mods: {
                    theme: "light"
                }
            }
        },
        "format.webvisor-date-time": function(e) {
            var t, i = BN("i-date"),
                n = i.create(),
                o = i.create(e.name);
            return t = o.getISODate() === n.getISODate() ? o.format("H:i") : o.getFullYear() === n.getFullYear() ? o.format("d.m H:i") : o.format("d.m.Y"), t ? {
                elem: "title-wrapper",
                tag: "span",
                attrs: e.name && {
                    title: BN("humanize-attributes").formatDateTime(e)
                },
                content: t
            } : ""
        },
        "format.webvisor-activity": function(e) {
            return {
                block: "visit-activity",
                activity: e.name
            }
        },
        "format.webvisor-region": function(e) {
            var t;
            return e.id ? (t = e.id.filter(function(e) {
                return Boolean(e.name)
            }).map(function(e) {
                return BN("i-string").escapeHTML(e.name)
            }), t.length ? BN("humanize-attributes").formatRegion({
                icon_type: "country",
                icon_id: e.id[0].id,
                name: t.join(" > ")
            }) : BEM.I18N("table", "undefined")) : BEM.I18N("table", "undefined")
        },
        "format.webvisor-resolution": function(e) {
            return e && e.id ? e.id.map(function(e) {
                return e && e.name ? BN("i-string").escapeHTML(e.name) : BEM.I18N("table", "undefined")
            }).join("x") : BEM.I18N("table", "undefined")
        },
        "format.webvisor-goals": function(e) {
            var t = e && e.id || [];
            return [{
                block: "webvisor-reached-goals",
                mods: {
                    type: "full"
                },
                reachedGoals: t
            }, {
                block: "webvisor-reached-goals",
                mods: {
                    type: "partial"
                },
                reachedGoals: t
            }]
        },
        "format.webvisor-array": function(e) {
            var t = BN("i-string");
            return {
                elem: "webvisor-array",
                content: e.name ? e.name.map(t.escapeHTML.bind(t)).join(", ") : "",
                attrs: {
                    title: e.name ? e.name.map(t.escapeAttr.bind(t)).join(", ") : ""
                }
            }
        },
        "format.webvisor-visit-favorite": function(e) {
            return {
                block: "visit-favorite",
                visitId: e.visitId.name,
                favorite: "yes" === e.selected.name,
                comment: e.comment.name
            }
        },
        "format.webvisor-default": function(e, t, i) {
            var n = e && e.name ? BN("humanize-attributes").format(i.type, e) : null;
            return n ? {
                elem: "title-wrapper",
                tag: "span",
                attrs: e && e.name && {
                    title: e.name
                },
                content: n
            } : ""
        }
    }).done(), BEM.JSON.decl("visit-activity", {
        onBlock: function(e) {
            var t = Number(e.param("activity")),
                i = [],
                n = 1;
            t > 0 && (n = Math.min(12, Math.floor(Math.log(t + 64) / Math.log(2.3)) - 4), n = Math.ceil(n / 2.4));
            for (var o = 0; n > o; o++) i.push({
                elem: "dot"
            });
            e.mod("level", n).content(i)
        }
    }), BEM.DOM.decl("popup-shower", {
        onSetMod: {
            js: function() {
                this._popup = this.__self.getPopup(), this._contentPromise = null
            }
        },
        _show: function(e) {
            this._contentPromise || (this._contentPromise = this._getPopupContentPromise(e)), this._contentPromise.isResolved() ? this._contentPromise.isFulfilled() ? (this._setPopupContent(), this._showPopup(e)) : this._onFailLoadPopupContent(this._contentPromise.valueOf()) : (this.__self.showLoader && (this.__self.setPopupLoading(this._contentPromise), this._showPopup(e)), this._contentPromise.then(this._onSuccessLoadPopupContent.bind(this, e), this._onFailLoadPopupContent.bind(this)).done())
        },
        _showPopup: function(e) {
            this._beforeShow(e), this._popup.show(e)
        },
        _onSuccessLoadPopupContent: function(e) {
            this.__self.showLoader || this._showPopup(e), this._setPopupContent()
        },
        _onFailLoadPopupContent: function(e) {
            this._popup.hide(), BN("error-message").showError(this, e)
        },
        _setPopupContent: function() {
            this._popup.setContent(this._contentPromise.valueOf()), this._afterSetContent()
        },
        _afterSetContent: function() {},
        _beforeShow: function(e) {
            this.__self.currentOwner = e, this._popup.onFirst("hide", function() {
                this.__self.currentOwner = null
            }, this)
        },
        _hide: function() {
            this._beforeHide(), this._popup.hide()
        },
        _beforeHide: function() {},
        _getPopupContentPromise: function() {
            throw new Error("method " + this.__self.getName() + "#_getPopupContentPromise should be implemented");
        },
        _getPopupOwnerFromEvent: function(e) {
            return this.__self.ownerElemName ? e.data.domElem : this.domElem
        },
        _onOwnerClick: function(e) {
            var t = this._getPopupOwnerFromEvent(e);
            this._popup.isShown() && this.__self.currentOwner && this.__self.currentOwner.get(0) === t.get(0) ? this._hide() : this._show(t)
        }
    }, {
        currentOwner: null,
        ownerElemName: null,
        showLoader: !1,
        _getPopupOptions: function() {
            return {
                popupMods: {
                    adaptive: "yes"
                },
                directions: []
            }
        },
        getPopup: function() {
            return this._popup || (this._popup = this._createPopup()), this._popup
        },
        setPopupLoading: function(e) {
            this._popup.setMod("has-close", "no"), this._popup.setContent(BN("i-content").html(this._getLoaderBEMJSON(), !0)), e.always(function() {
                this._popup.delMod("has-close")
            }.bind(this))
        },
        live: function() {
            var e = ["click", function(e) {
                this._onOwnerClick(e)
            }];
            this.ownerElemName && e.unshift(this.ownerElemName), this.liveBindTo.apply(this, e)
        },
        _createPopup: function() {
            var e = BN("i-content").html(this._getPopupBEMJSON(), !0),
                t = $(e).bem("popup");
            return BEM.DOM.append($("body"), t.domElem), t
        },
        _getPopupBEMJSON: function() {
            var e = this._getPopupOptions();
            return {
                block: "popup",
                mods: e.popupMods,
                js: {
                    directions: e.directions
                },
                mix: {
                    block: this.getName(),
                    elem: "popup"
                },
                content: [{
                    elem: "close"
                }, {
                    elem: "tail"
                }, {
                    elem: "content"
                }]
            }
        },
        _getLoaderBEMJSON: function() {
            return {
                block: "spin2",
                mods: {
                    size: "xxs",
                    progress: "yes"
                }
            }
        }
    }), BEM.DOM.decl({
        block: "webvisor-reached-goals",
        baseBlock: "popup-shower"
    }, {
        _getPopupContentPromise: function(e) {
            var t = this.elemParams(e);
            return BN("i-content").html({
                block: "webvisor-goals-popup",
                type: t.type,
                goals: t.goals
            })
        }
    }, {
        _getPopupOptions: function() {
            return $.extend(this.__base(), {
                directions: ["left", "bottom", "top"]
            })
        },
        buildReachedGoalsTable: function(e, t) {
            var i = e.reduce(function(e, t) {
                return e[t.id] = t, e
            }, {});
            return jQuery.extend(!0, [], t).reduce(function(e, t) {
                return t.steps ? (t.partial = t.steps.some(function(e) {
                    return e.reached = Boolean(i[e.id])
                }), t.reached = t.steps.every(function(e) {
                    return e.reached = Boolean(i[e.id])
                })) : i[t.id] && (t.reached = !0), t.reached ? e.full.push(t) : t.partial && e.partial.push(t), e
            }, {
                full: [],
                partial: []
            })
        }
    }), BEM.JSON.decl("webvisor-reached-goals", {
        onBlock: function(e) {
            var t = e.params(),
                i = e.mod("type"),
                n = BN("webvisor-reached-goals").buildReachedGoalsTable(t.reachedGoals || [], t.counterGoals || []),
                o = n[i] || [];
            o.length ? e.js({
                type: i,
                goals: o
            }).content(o.length) : e.remove()
        }
    }), BEM.JSON.decl("webvisor-reached-goals", {
        onBlock: function(e) {
            e.defer(BN("i-counters").getAsync().then(function(t) {
                t.isSingle() ? e.params().counterGoals = t.getGoals() : e.remove()
            }))
        }
    }), BEM.DOM.decl("webvisor-goals-popup", {
        onSetMod: {
            js: function() {
                this.bindTo("open-button", "click", this._toggleOpen)
            }
        },
        _toggleOpen: function(e) {
            var t = e.data.domElem.parents(this.buildSelector("goal"));
            this.toggleMod(t, "open", "yes", "")
        }
    }), BEM.JSON.decl("webvisor-goals-popup", {
        onBlock: function(e) {
            var t = e.param("goals");
            t = t.sort(function(e, t) {
                return (t.steps ? 1 : 0) - (e.steps ? 1 : 0)
            }), e.js(!0).content([{
                elem: "label",
                type: e.param("type")
            }, {
                elem: "goals",
                goals: t
            }])
        },
        onElem: {
            label: function(e) {
                e.content(BEM.I18N("webvisor-goals-popup", "full" === e.param("type") ? "full-label" : "partial-label"))
            },
            goals: function(e) {
                e.content(e.param("goals").map(function(e) {
                    return {
                        elem: "goal",
                        goal: e
                    }
                }))
            },
            "open-button": function(e) {
                e.content({
                    block: "check-button",
                    mods: {
                        "only-icon": "yes",
                        size: "s",
                        pseudo: "yes"
                    },
                    content: [{
                        elem: "icon",
                        mix: [{
                            block: "icon"
                        }, {
                            block: "icon",
                            elem: "plus"
                        }, {
                            block: "webvisor-goals-popup",
                            elem: "closed-icon"
                        }]
                    }, {
                        elem: "icon",
                        mix: [{
                            block: "icon"
                        }, {
                            block: "icon",
                            elem: "minus"
                        }, {
                            block: "webvisor-goals-popup",
                            elem: "open-icon"
                        }]
                    }]
                })
            },
            goal: function(e) {
                var t = e.param("goal");
                return t.steps && t.steps.length ? void e.content([{
                    elem: "goal-head-wrapper",
                    content: {
                        elem: "goal-head",
                        tag: "span",
                        content: [{
                            elem: "open-button"
                        }, BN("i-string").escapeHTML(t.name)]
                    }
                }, {
                    elem: "subgoals",
                    content: t.steps.map(function(e) {
                        return {
                            elem: "goal",
                            goal: e,
                            mods: {
                                reached: e.reached ? "yes" : "no"
                            }
                        }
                    })
                }]) : void e.content({
                    elem: "goal-head-wrapper",
                    content: BN("i-string").escapeHTML(t.name)
                })
            }
        }
    }), BEM.DOM.decl("play-hit-button", {
        _openPlayer: function() {
            var e = this.params.url + "?" + jQuery.param({
                id: BN("i-counters").getCounterId(),
                date: BN("i-date").create(this.params.dateTime).format("Y-m-d"),
                visit_id: this.params.visitId,
                watch_id: this.params.hitId,
                user_id_hash: this.params.userIdHash,
                dn: this.params.dayNumber,
                tld: BN("i-router").getTld()
            });
            window.open(e, "_blank", "resizable"), this.trigger("play", this.params.visitId)
        }
    }, {
        live: function() {
            this.liveBindTo("click", function() {
                this._openPlayer()
            })
        }
    }), BEM.JSON.decl("play-hit-button", {
        onBlock: function(e) {
            var t = e.params(),
                i = 0 === Number(t.activity) ? "yes" : "";
            e.js(i ? !1 : {
                url: t.url,
                visitId: t.visitId,
                userIdHash: t.userIdHash,
                hitId: t.hitId,
                dateTime: t.dateTime,
                dayNumber: t.dayNumber
            }).mod("disabled", i).content({
                block: "button",
                mods: {
                    "only-icon": "yes",
                    size: "s",
                    disabled: i
                },
                content: {
                    block: "icon",
                    elem: "play",
                    mix: [{
                        block: "button",
                        elem: "icon"
                    }]
                }
            })
        }
    }), BEM.JSON.decl("play-hit-button", {
        onBlock: function(e) {
            e.defer(BN("i-report").createReport("visor-player", !1).then(function(t) {
                e.param("url", t.getReportHost() + t.getReportPath())
            }))
        }
    }), BN.addDecl("table__reader").staticProp({
        "reader.report-dimension": function(e, t, i) {
            return e.dimensions[i.key]
        },
        "reader.report-metric": function(e, t, i) {
            return e.metrics[i.key]
        }
    }).done(), BN.addDecl("table__reader").staticProp({
        "reader.webvisor-play-button": function(e, t, i) {
            return {
                visitId: e.dimensions[i.visitIDKey],
                userIdHash: e.dimensions[i.userIdHashKey],
                activity: e.dimensions[i.activityKey],
                dateTime: e.dimensions[i.dateTimeKey],
                duration: e.dimensions[i.durationKey]
            }
        },
        "reader.webvisor-actions": function(e, t, i) {
            return {
                visitId: e.dimensions[i.visitIdIdx].name,
                selected: e.dimensions[i.selectedIdx].name,
                comment: e.dimensions[i.commentIdx].name,
                dateTime: e.dimensions[i.dateTimeIdx].name,
                dimensions: e.dimensions
            }
        },
        "reader.webvisor-visit-favorite": function(e, t, i) {
            return {
                visitId: e.dimensions[i.visitIDKey],
                selected: e.dimensions[i.selectedKey],
                comment: e.dimensions[i.commentKey]
            }
        }
    }).done(), BEM.JSON.decl("webvisor-filter-button", {
        onBlock: function(e) {
            e.js({
                segmentId: e.param("segmentId")
            }).mix([{
                block: "icon",
                elem: "funnel"
            }, {
                block: "icon"
            }])
        }
    }), BEM.DOM.decl("webvisor-filter-button", {
        onSetMod: {
            js: function() {
                this.bindTo("click", this._onFilterClick)
            }
        },
        _onFilterClick: function(e) {
            e.stopPropagation(), BN("adaptive-segment-panel-popup").toggle("webvisor-filter-popup", this.domElem, {
                params: "primary",
                "data-bind": "report",
                data: "report"
            }, {
                segmentId: this.params.segmentId
            })
        }
    }), BEM.JSON.decl("webvisor-row-filter-popup", {
        onBlock: function(e) {
            var t = e.param("rowData");
            e.js({
                rowData: t
            }).mix([{
                block: "icon",
                elem: "funnel"
            }, {
                block: "icon"
            }])
        }
    }), BEM.DOM.decl({
        block: "webvisor-row-filter-popup",
        baseBlock: "popup-shower"
    }, {
        _getPopupContentPromise: function() {
            return BN("i-content").html({
                block: "webvisor-row-filter-popup",
                elem: "popup-content",
                rowData: this.params.rowData
            })
        },
        _afterSetContent: function() {
            var e;
            e = this.findBlockInside(this._popup.domElem, "webvisor-row-filter"), e.on("change", this._hide, this)
        }
    }, {
        _getPopupOptions: function() {
            return $.extend(this.__base(), {
                directions: ["left", "bottom"]
            })
        }
    }), BEM.JSON.decl("webvisor-row-filter-popup", {
        onElem: {
            "popup-content": function(e) {
                e.content({
                    block: "webvisor-row-filter",
                    rowData: e.param("rowData")
                })
            }
        }
    }), BEM.DOM.decl("webvisor-row-filter", {
        onSetMod: {
            js: function() {
                this.bindTo("item", "click", this._onItemClick)
            }
        },
        _onItemClick: function(e) {
            var t = this.elemify(e.data.domElem, "item"),
                i = this.elemParams(t).row;
            this.hasMod(t, "selected", "yes") ? (this.delMod(t, "selected"), this._setFilter(i.segmentId)) : (this.setMod(t, "selected", "yes"), this._setFilter(i.segmentId, i.filter)), this.trigger("change")
        },
        _setFilter: function(e, t) {
            var i = BEM.dataBindVal("report.filter");
            void 0 === t ? delete i[e] : i[e] = t, BEM.dataBindVal("report.filter", i)
        }
    }, {
        KNOWN_SEGMENT_TYPES: ["number", "url", "multiline", "list", "tree", "path", "uid"],
        buildFilter: function(e, t) {
            var i = this._filterBuilders[t.type];
            if (!i) throw new Error("Incorrect segment type");
            return i.apply(this, arguments)
        },
        areFilterEquals: function(e, t, i) {
            return t && i && ["list", "tree", "path"].indexOf(e.type) > -1 && t.items && i.items ? t.exclude === i.exclude && t.items.length === i.items.length && jQuery.equals(this._removeNameFieldFromFilter(i.items), this._removeNameFieldFromFilter(t.items)) : jQuery.equals(t, i)
        },
        _removeNameFieldFromFilter: function(e) {
            return e.map(function(e) {
                return Array.isArray(e) ? e.map(function(e) {
                    return {
                        id: e.id
                    }
                }) : {
                    id: e.id
                }
            })
        },
        _filterBuilders: {
            number: function(e, t, i) {
                return {
                    op: "==",
                    value: null === i.name ? null : parseInt(i.name)
                }
            },
            url: function(e, t, i) {
                var n = BN("i-util").arrayFind(["dim", "host_dim", "url_dim"], function(i) {
                    return t[i] === e.dim
                }) || "host_dim";
                return {
                    exclude: !1,
                    urlMode: n,
                    items: [i.name]
                }
            },
            list: function(e, t, i) {
                return {
                    exclude: !1,
                    items: [{
                        id: i.id,
                        name: i.name
                    }]
                }
            },
            tree: function(e, t, i) {
                var n = t.dims.indexOf(e.dim),
                    o = [];
                return o[n] = {
                    id: i.id,
                    name: i.name
                }, {
                    exclude: !1,
                    items: [o]
                }
            },
            path: function(e, t, i) {
                var n;
                return "OperatingSystemRoot" === t.id && (i = {
                    id: [{
                        id: i.root
                    }, {
                        id: i.id || i.name,
                        name: i.name
                    }]
                }), n = i.id instanceof Array ? i.id.map(function(e) {
                    return {
                        id: e.id || e.name,
                        name: e.name
                    }
                }) : [{
                    id: i.id || i.name,
                    name: i.name
                }], {
                    exclude: !1,
                    items: [n]
                }
            },
            multiline: function(e, t, i) {
                return {
                    exclude: !1,
                    items: [i.name]
                }
            },
            uid: function(e, t, i) {
                return {
                    value: String(i.name)
                }
            }
        }
    }), BEM.JSON.decl("webvisor-row-filter", {
        onBlock: function(e) {
            var t, i = e.params(),
                n = i.rowData,
                o = i.meta,
                s = i.filter,
                r = o.getDimensionsMeta(),
                a = o.getSegmentsTree(),
                l = BN("webvisor-row-filter");
            t = n.map(function(e, t) {
                var i, n, o;
                if (r[t].segment && (n = a.findByDim(r[t].segment), -1 !== l.KNOWN_SEGMENT_TYPES.indexOf(n.type))) return i = l.buildFilter(r[t], n, e), o = l.areFilterEquals(n, i, s[n.id]), {
                    segmentId: n.id,
                    filter: i,
                    selected: o,
                    value: e,
                    name: r[t].name
                }
            }).filter(Boolean), e.js(!0), e.content([{
                elem: "label",
                content: BEM.I18N("webvisor-row-filter", "label")
            }, {
                elem: "table",
                rows: t
            }])
        },
        onElem: {
            table: function(e) {
                e.tag("ul").content(e.param("rows").map(function(e) {
                    return {
                        elem: "item",
                        row: e
                    }
                }))
            },
            item: function(e) {
                var t = e.param("row");
                e.tag("li").js({
                    row: t
                }).mods({
                    selected: t.selected ? "yes" : ""
                }).content([{
                    elem: "selected-icon"
                }, {
                    block: "segment-label",
                    segmentId: t.segmentId,
                    value: t.filter,
                    tree: e.blockParams().meta.getSegmentsTree(),
                    view: "compact"
                }])
            },
            "selected-icon": function(e) {
                e.tag("span").content({
                    block: "icon",
                    elem: "tick"
                })
            }
        }
    }), BEM.JSON.decl("webvisor-row-filter", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(t, i) {
                e.params().meta = t, e.params().filter = i.getParamsModel().getState().filter
            }))
        }
    }), BN("formatter").formatters("webvisor").add({}, function(e) {
        var t = e.data || {
            name: ""
        };
        e.id = t.id, e.originalValue = t.name, e.value = BN("i-string").escapeBemJson(t.name)
    }).add({
        type: "url"
    }, function(e) {
        e.value = {
            block: "link",
            attrs: {
                target: "_blank"
            },
            url: e.originalValue,
            content: e.value.replace(/^https?:\/\//, "")
        }
    }).add({
        type: "date-time"
    }, function(e) {
        e.value = BN("i-date").format(BN("i-date").localizedDateFormat("common-date-time-format"))(e.value)
    }).add({
        type: "duration"
    }, function(e) {
        e.value = BN("humanize").format("second", e.value)
    }).add({
        type: "visit-activity"
    }, function(e) {
        e.value = {
            block: "visit-activity",
            activity: e.value
        }
    }).add({
        type: "webvisor-goals"
    }, function(e) {
        e.value = (e.id || []).map(function(e) {
            return {
                content: BN("i-content").escapeHTML(e.name) + " (" + e.count + ")"
            }
        })
    }).add({
        type: "webvisor-region"
    }, function(e) {
        var t = e.id.filter(function(e) {
            return Boolean(e.name)
        }).map(function(e) {
            return BN("i-content").escapeHTML(e.name)
        });
        e.value = t.join(" &#8594; ")
    }).add({
        type: "webvisor-resolution"
    }, function(e) {
        e.value = e.id.map(function(e) {
            return BN("i-content").escapeHTML(e.name)
        }).join("x")
    }).add({
        dim: "ym:s:labelsAggregated"
    }, function(e) {
        e.value = e.value.map(function(e) {
            return {
                content: BN("i-content").escapeHTML(e)
            }
        })
    }).add({
        dim: "ym:s:daysSincePreviousVisit"
    }, function(e) {
        var t = Number(e.value);
        e.value = BN("i-date").formatLength(24 * t * 3600)
    }), BEM.JSON.decl("visit-info", {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                visitId: t.visitId,
                date: t.date
            }).mix({
                block: "error-message",
                mods: {
                    type: "popup"
                }
            }).content([{
                block: "icon",
                elem: "info",
                mix: [{
                    block: "visit-info",
                    elem: "open-icon"
                }]
            }])
        }
    }), BEM.JSON.decl("visit-info", {
        onElem: {
            "popup-content": function(e) {
                e.content([{
                    elem: "header",
                    content: BEM.I18N("visit-info", "header")
                }, {
                    elem: "data",
                    data: e.param("data")
                }])
            },
            data: function(e) {
                var t = e.param("data"),
                    i = t.visits,
                    n = t.dimensions.custom_displayed;
                e.tag("table").content({
                    tag: "tbody",
                    content: i.meta.dimensions.map(function(e, t) {
                        return {
                            elem: "row",
                            meta: e,
                            data: i.data[0].dimensions[t],
                            customDisplayed: n
                        }
                    })
                })
            },
            row: function(e) {
                var t = e.params(),
                    i = t.data || {},
                    n = t.meta,
                    o = t.customDisplayed,
                    s = [];
                (-1 !== o.indexOf(n.dim) || Array.isArray(i.id) && 0 === i.id.length || void 0 !== i.id && !Boolean(i.id) || Array.isArray(i.name) && 0 === i.name.length || void 0 !== i.name && !Boolean(i.name)) && e.remove(), i.icon_id && n.fields.icon_id && s.push({
                    block: "icon",
                    elem: i.icon_type,
                    mods: {
                        id: i.icon_id
                    },
                    attrs: {
                        title: i.name
                    },
                    mix: [{
                        block: "visit-info",
                        elem: "icon"
                    }]
                }, "&nbsp;"), s.push({
                    elem: "name-wrapper",
                    content: BN("formatter").run(["webvisor"], {
                        type: n.type,
                        dim: n.dim,
                        data: i
                    })
                }), e.tag("tr").content([{
                    elem: "headcell",
                    tag: "td",
                    content: BN("i-string").escapeHTML(n.name || n.fields.name.name)
                }, {
                    elem: "datacell",
                    tag: "td",
                    content: {
                        elem: "datacell-wrapper",
                        content: s
                    }
                }])
            }
        }
    }), BEM.DOM.decl({
        block: "visit-info",
        baseBlock: "popup-shower"
    }, {
        _getPopupContentPromise: function() {
            var e = this.params;
            return BN("i-webvisor-data").getVisitInfo(e.visitId, e.date).then(function(e) {
                var t = e.visits;
                return t && t.data && t.data.length ? BN("i-content").html({
                    block: "visit-info",
                    elem: "popup-content",
                    data: e
                }, !0) : Vow.reject(new(BN("i-errors").MetrikaError)("default"))
            }.bind(this))
        }
    }, {
        showLoader: !0,
        ownerElemName: "open-icon",
        _getPopupOptions: function() {
            return $.extend(this.__base(), {
                directions: [{
                    to: "left",
                    axis: "middle",
                    tail: {
                        axis: "middle"
                    }
                }, {
                    to: "top",
                    axis: "right",
                    offset: {
                        right: -10
                    }
                }]
            })
        }
    }), BEM.JSON.decl("hit-list", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.hits,
                n = "no" === e.mod("linkable");
            return i.length ? void e.js(!0).content(i.map(function(i, o) {
                return {
                    elem: "item",
                    mods: {
                        disabled: 0 === parseInt(i.VisitDurationShort.name, 10) ? "yes" : "",
                        selected: o === t.selected ? "yes" : "",
                        idx: o
                    },
                    js: {
                        hit: i,
                        idx: o
                    },
                    content: {
                        block: "hit-details",
                        mods: {
                            linkable: n ? "no" : ""
                        },
                        hit: i,
                        idx: o,
                        visitId: t.visitId,
                        userIdHash: t.userIdHash,
                        referer: e.mod("selectable") ? !1 : !0
                    }
                }
            })) : e.content({
                elem: "empty"
            })
        },
        onElem: {
            item: function(e) {
                e.beforeContent({
                    elem: "idx",
                    content: e.pos()
                })
            },
            empty: function(e) {
                e.content(BEM.I18N("hit-list", "empty"))
            }
        }
    }), BEM.JSON.decl("hit-list", {
        onBlock: function(e) {
            var t = e.params();
            t.hits || e.defer(BN("i-webvisor-data").getHitList(t.visitId, t.userIdHash).then(function(t) {
                e.param("hits", t)
            }))
        }
    }), BEM.JSON.decl("hit-details", {
        onBlock: function(e) {
            var t = e.params();
            e.content([{
                block: "play-hit-button",
                mix: [{
                    block: "hit-details",
                    elem: "button"
                }],
                visitId: t.visitId,
                userIdHash: t.userIdHash,
                hitId: t.hit.WatchID.name,
                dateTime: t.hit.DateTime.name,
                activity: t.hit.WebVisorActivity.name,
                dayNumber: t.hit.DayNumber.name
            }, {
                elem: "middle"
            }, {
                elem: "duration"
            }, {
                elem: "activity"
            }]), t.referer && e.mod("referer", "yes").afterContent({
                elem: "referer"
            })
        },
        onElem: {
            middle: function(e) {
                e.content([{
                    elem: "title"
                }, {
                    elem: "link"
                }])
            },
            title: function(e) {
                e.content(BN("i-string").escapeHTML(e.blockParams().hit.Title.name))
            },
            link: function(e) {
                var t = e.blockParams().hit.WWWURL.name;
                e.content({
                    block: "link",
                    attrs: {
                        target: "_blank"
                    },
                    url: t,
                    content: this._formatLinkContent(t)
                })
            },
            duration: function(e) {
                var t = e.blockParams();
                e.content(BN("humanize").format("second", t.hit.VisitDurationShort.name))
            },
            activity: function(e) {
                var t = e.blockParams();
                e.content({
                    block: "hit-activity-map",
                    visitParams: {
                        visit_id: t.visitId,
                        watch_id: t.hit.WatchID.name,
                        dn: t.hit.DayNumber.name,
                        date: t.hit.DateTime.name
                    }
                })
            },
            referer: function(e) {
                var t, i = e.blockParams().hit.Referer.name;
                i && (t = this._formatLinkContent(i), e.content({
                    block: "link",
                    attrs: {
                        target: "_blank",
                        title: t
                    },
                    url: i,
                    content: t
                }))
            }
        },
        _formatLinkContent: function(e) {
            return BN("i-string").escapeHTML(e.replace(/^https?:\/\//, ""))
        }
    }), BEM.JSON.decl("hit-activity-map", {
        onBlock: function(e) {
            e.js({
                visitParams: e.param("visitParams")
            })
        }
    }), BEM.DOM.decl("hit-activity-map", {
        onSetMod: {
            js: function() {
                var e = this.params.visitParams;
                e.date = BN("i-date").create(e.date).format("Y-m-d"), e.id = BN("i-counters").getCounterId(), this.domElem.css("background-image", ["url(" + BN("i-proxy").getHost(), "/inpage/hit-activity?", BN("i-url").queryParam(e) + ")"].join(""))
            }
        }
    }), BEM.JSON.decl({
        name: "hit-list",
        modName: "lazy",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.js({
                visitId: e.params().visitId,
                userIdHash: e.params().userIdHash
            }).content({
                block: "spin2",
                mods: {
                    size: "m",
                    progress: "yes"
                }
            }).stop()
        }
    }), BEM.DOM.decl({
        block: "hit-list",
        modName: "lazy",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                var e = this.getInitialMods();
                delete e.lazy, BN("i-content").replace(this.domElem, {
                    block: this.__self._name,
                    mods: e,
                    visitId: this.params.visitId,
                    userIdHash: this.params.userIdHash
                })
            }
        }
    }), BEM.JSON.decl("visit-favorite", {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                visitId: t.visitId,
                favorite: t.favorite,
                comment: t.comment
            }).mix({
                block: "error-message",
                mods: {
                    type: "popup"
                }
            }).content([{
                elem: "icon",
                favorite: t.favorite,
                comment: t.comment
            }])
        },
        onElem: {
            icon: function(e) {
                var t = e.params(),
                    i = t.comment,
                    n = BEM.I18N("visit-favorite", "add"),
                    o = t.favorite ? "yes" : "no";
                t.favorite && (n = BEM.I18N("visit-favorite", "already") + (i ? ": " + BN("i-string").escapeHTML(i) : "")), e.wrap([{
                    block: "icon",
                    elem: "flag",
                    mods: {
                        selected: o
                    },
                    attrs: {
                        title: n
                    },
                    mix: [{
                        block: "visit-favorite",
                        elem: "flag-icon",
                        mods: {
                            selected: o
                        }
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("visit-favorite", {
        _loading: null,
        _isShown: !1,
        _changeState: function(e) {
            var t;
            return this.params.favorite ? this._makeRequest() : (t = $(e.target), void(this.__self._isPopupShown && this.__self.lastOwner && this.__self.lastOwner.get(0) === t.get(0) ? BN("validate-popup").getPopup().hide() : (this.__self._isPopupShown = !0, this.__self._getPopup(t, this.params.comment).then(function(e) {
                return this.params.comment = e, this._makeRequest()
            }.bind(this)), this.__self.lastOwner = t, BN("validate-popup").getPopup().onFirst("hide", function() {
                this.__self._isPopupShown = !1, this.__self.lastOwner = null
            }, this))))
        },
        _makeRequest: function() {
            return this._loading = !0, this._getOptions().then(BN("i-webvisor-data").choose.bind(BN("i-webvisor-data"))).then(function() {
                this.params.favorite = !this.params.favorite, BN("i-content").update(this.domElem, {
                    block: this.__self.getName(),
                    elem: "icon",
                    favorite: this.params.favorite,
                    comment: this.params.comment
                })
            }.bind(this)).fail(function(e) {
                BN("error-message").showError(this, e)
            }.bind(this)).always(function() {
                this._loading = !1
            }.bind(this)).done()
        },
        _getOptions: function() {
            return Vow.fulfill({
                id: BN("i-counters").getCounterId(),
                visit_id: this.params.visitId,
                marked: !this.params.favorite,
                comment: this.params.favorite ? void 0 : this.params.comment || ""
            })
        }
    }, {
        _getPopup: function(e, t) {
            return BN("validate-popup").show({
                bemJson: {
                    block: "input",
                    mods: {
                        size: "s",
                        focused: "yes"
                    },
                    value: t,
                    content: {
                        elem: "control"
                    }
                },
                owner: e,
                confirmText: BEM.I18N("visit-favorite", "add"),
                confirmTheme: "action",
                validate: {
                    block: "input",
                    method: "val"
                }
            })
        },
        live: function() {
            this.liveBindTo("click", function(e) {
                this._loading || this._changeState(e)
            })
        }
    }), BEM.DOM.decl({
        block: "validate-popup",
        baseBlock: "i-confirm-popup"
    }, {}, {
        _getPopupJson: function() {
            var e = this.__base.call(this);
            return e.mix = [{
                block: "validate-popup",
                js: !0
            }], e
        },
        _validate: function(e) {
            var t = e.findBlockInside(this._params.validate.block)[this._params.validate.method]();
            Vow.isPromise(t) || (t = Vow.fulfill(t)), t.then(function(e) {
                this._confirmPromise.fulfill(e), this._getPopup().hide()
            }.bind(this))
        },
        live: function() {
            this.liveInitOnBlockInsideEvent("click", "button", function(e) {
                var t = e.block.getMod("action");
                switch (t) {
                    case "validate":
                        this.__self._validate(this);
                        break;
                    case "cancel":
                        this.__self._getPopup().hide()
                }
            })
        }
    }), BEM.decl({
        block: "table__model_report_webvisor",
        baseBlock: "table__model"
    }, {
        onSetMod: {
            js: function() {
                var e = this.__self._buildColumns(this.params.meta, this.params.widths);
                this._createColumns(e)
            }
        },
        columnResize: function(e, t) {
            var i, n = this.getColumns();
            n[e].params.width = t, i = n.filter(function(e) {
                return Boolean(e.params.width)
            }).map(function(e) {
                return {
                    name: e.getName(),
                    width: e.params.width
                }
            }), this._saveWidthTable(i)
        },
        update: function(e, t) {
            var i;
            this.params.widths = t || this.params.widths, i = this.__self._buildColumns(e, this.params.widths), this._createColumns(i), this.trigger("change")
        },
        _saveWidthTable: function(e) {
            this._saveWidthTable = jQuery.debounce(function(e) {
                this.params.widths = e, BN("i-webvisor-settings-api").saveColumnWidthes(e)
            }.bind(this), 500), this._saveWidthTable(e)
        }
    }, {
        _dimensionTypeToFormatter: {
            "date-time": "webvisor-date-time",
            duration: "report-duration",
            "visit-activity": "webvisor-activity",
            "webvisor-resolution": "webvisor-resolution",
            "webvisor-region": "webvisor-region",
            "webvisor-goals": "webvisor-goals",
            "webvisor-array": "webvisor-array"
        },
        _defaultDimensionFormatter: "webvisor-default",
        get: function() {
            return Vow.all([BN("i-report").getMetadata(), BN("i-webvisor-settings-api").getColumnWidthes()]).spread(function(e, t) {
                return BEM.create({
                    block: this._name
                }, {
                    meta: e,
                    widths: t
                })
            }.bind(this))
        },
        _buildColumns: function(e, t) {
            var i = [];
            return i[0] = {
                header: {
                    block: "light-constructor",
                    type: "dimensions",
                    label: BEM.I18N("table", "columns")
                },
                compose: [{
                    source: "row",
                    format: "webvisor-expand"
                }]
            }, i[0].compose.push({
                source: {
                    name: "webvisor-play-button",
                    visitIDKey: e.getVisitIdIdx(),
                    userIdHashKey: e.getUserIdHashIdx(),
                    activityKey: e.getActivityIdx(),
                    dateTimeKey: e.getDateTimeIdx(),
                    durationKey: e.getDurationIdx()
                },
                format: "webvisor-play-button"
            }, {
                source: {
                    name: "webvisor-visit-favorite",
                    visitIDKey: e.getVisitIdIdx(),
                    selectedKey: e.getSelectedIdx(),
                    commentKey: e.getCommentIdx()
                },
                format: "webvisor-visit-favorite"
            }), e.getDimensionsMeta().forEach(function(t, n) {
                e.isColumnDimension(t) && (e.isFirstColumnDimension(t) ? i[0].compose.push({
                    source: {
                        name: "report-dimension",
                        key: n
                    },
                    format: this.formatterLookup(t, !0)
                }) : i.push({
                    name: t.dim,
                    header: {
                        tag: "span",
                        content: t.short_name,
                        attrs: {
                            title: t.name
                        }
                    },
                    type: t.type,
                    sortable: Boolean(t.allow_sort),
                    segmentId: t.segment,
                    draggable: !0,
                    source: {
                        name: "report-dimension",
                        key: n
                    },
                    format: this.formatterLookup(t)
                }))
            }, this), i.push({
                name: e.dimNameSelected,
                source: {
                    name: "webvisor-actions",
                    visitIdIdx: e.getVisitIdIdx(),
                    selectedIdx: e.getSelectedIdx(),
                    commentIdx: e.getCommentIdx(),
                    dateTimeIdx: e.getDateTimeIdx()
                },
                format: "webvisor-actions"
            }), t = (t || []).reduce(function(e, t) {
                return e[t.name] = t.width, e
            }, {}), i.map(function(e) {
                return e.width = e.name && t[e.name] || void 0, e
            })
        },
        formatterLookup: function(e, t) {
            var i = [];
            return t ? (e.fields.icon_id && i.push("report-icon"), e.fields.favicon && i.push("report-favicon")) : i.push(this._dimensionTypeToFormatter[e.type] || {
                name: this._defaultDimensionFormatter,
                type: e.type
            }), 1 === i.length ? i[0] : {
                type: "join",
                format: i
            }
        }
    }), BEM.JSON.decl("webvisor-boolean-filter", {
        onBlock: function(e) {
            var t = e.params(),
                i = t.segmentId,
                n = (t.filter || {})[i],
                o = t.label;
            e.js({
                segmentId: i,
                pressedValue: t.pressedValue
            }).content({
                block: "check-button",
                mods: {
                    size: "s",
                    checked: n && n.value === t.pressedValue ? "yes" : ""
                },
                content: BN("i-string").escapeHTML(o)
            })
        }
    }), BEM.JSON.decl("webvisor-boolean-filter", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.params().filter = t.getParamsModel().getParams().filter
            }))
        }
    }), BEM.DOM.decl("webvisor-boolean-filter", {
        dataBindings: {
            "report.filter": "_onFilterChange"
        },
        onSetMod: {
            js: function() {
                this._checkButton = this.findBlockInside("check-button").on("change", this._onClick, this)
            }
        },
        destruct: function() {
            this._checkButton.un("change", this._onClick, this), this.__base.apply(this, arguments)
        },
        _onClick: function(e, t) {
            var i = BEM.dataBindVal("report.filter") || {},
                n = this.params.segmentId;
            t.checked ? i[n] = {
                value: this.params.pressedValue
            } : i[n] && i[n].value === this.params.pressedValue && delete i[n], BEM.dataBindVal("report.filter", i)
        },
        _onFilterChange: function(e) {
            e = e[this.params.segmentId] && e[this.params.segmentId].value, e === this.params.pressedValue ? this._checkButton.setMod("checked", "yes") : this._checkButton.delMod("checked")
        }
    }), BEM.JSON.decl("webvisor-mark-viewed-button", {
        onBlock: function(e) {
            e.js(!0).content({
                block: "button",
                content: BEM.I18N("webvisor-mark-viewed-button", "mark-visits-button-label"),
                mods: {
                    size: "s"
                }
            })
        }
    }), BEM.DOM.decl("webvisor-mark-viewed-button", {
        onSetMod: {
            js: function() {
                this._button = this.findBlockInside("button").on("click", this._onButtonClick, this)
            }
        },
        destruct: function() {
            return this._button.un("click", this._onButtonClick, this), this.__base.apply(this, arguments)
        },
        _onButtonClick: function() {
            BN("confirm-popup").show({
                owner: this.domElem,
                text: BEM.I18N("webvisor-mark-viewed-button", "confirm-message")
            }).then(function() {
                return BN("i-counters").getAsync().then(function(e) {
                    return BN("i-webvisor-data").markAllVisitsVisited(e.getApiCounterId())
                }).then(function() {
                    BN("table").markAllRowsViewed()
                }).done()
            })
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "conversion"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "controls"
            }, {
                elem: "report"
            }, {
                block: "data-lag-notification"
            }, {
                block: "customizations",
                mix: [{
                    block: "report-page",
                    elem: "customizations"
                }]
            }])
        },
        onElem: {
            "header-controls": function(e) {
                e.remove()
            },
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "date-selector",
                        mods: {
                            "data-bind": "report",
                            data: "report"
                        }
                    }]
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "segments-selector",
                        mods: {
                            data: "report"
                        },
                        dataBind: "report",
                        menuType: "primary"
                    }, {
                        block: "sampling-popup"
                    }]
                }, {
                    block: "segments-wrapper"
                }], !0).stop()
            },
            report: function(e) {
                e.content({
                    block: "conversion-report"
                })
            }
        }
    }), BEM.JSON.decl("sampling-popup", {
        onBlock: function(e) {
            e.js(!0), e.content({
                block: "dropdown",
                content: [{
                    block: "button",
                    mix: [{
                        block: "dropdown",
                        elem: "switcher"
                    }, {
                        block: "sampling-popup",
                        elem: "switcher"
                    }],
                    mods: {
                        size: "s",
                        arrow: "down",
                        disabled: "yes"
                    },
                    content: [BEM.I18N("sampling-popup", "button-caption")]
                }, {
                    elem: "popup",
                    js: {
                        directions: {
                            axis: "right",
                            to: "bottom",
                            tail: {
                                axis: "center"
                            }
                        }
                    },
                    content: {
                        block: "sampling-popup",
                        elem: "popup-content"
                    }
                }]
            })
        },
        onElem: {
            "popup-content": function(e) {
                e.content([{
                    elem: "scale",
                    content: [{
                        elem: "min-label",
                        content: BEM.I18N("sampling-popup", "min-label")
                    }, {
                        elem: "max-label",
                        content: BEM.I18N("sampling-popup", "max-label")
                    }]
                }, {
                    elem: "slider-wrapper"
                }])
            },
            slider: function(e) {
                var t = e.params(),
                    i = t.scale;
                e.content([{
                    block: "slider",
                    mods: {
                        theme: "normal",
                        size: "m",
                        orientation: "horiz",
                        interactive: "no",
                        input: "hidden",
                        type: "discrete"
                    },
                    js: {
                        scale: i,
                        runnerWidth: "35"
                    },
                    content: {
                        elem: "info",
                        elemMods: {
                            preset: "inline"
                        },
                        content: [{
                            block: "input",
                            mods: {
                                size: "m"
                            },
                            content: {
                                elem: "control"
                            },
                            value: t.value
                        }]
                    }
                }])
            },
            info: function(e) {
                e.tag("span"), e.content(BEM.I18N("sampling-popup", "info", {
                    percent: e.param("percent")
                }))
            }
        }
    }), BEM.DOM.decl("sampling-popup", {
        onSetMod: {
            js: function() {
                this._popupContent = this.findBlockInside("popup").elem("content"), this._button = this.findBlockOn("switcher", "button"), this._model = BN("m-accuracy").getInstance(), BN("slider").on(this._popupContent, "dragend", this._handleSliderChange, this), this._model.on("change", this._updateAvailability, this), this._model.on("change", this._updateInfoLabel, this), this._model.on("minShare", "change", this._updateSliderContent, this), this._model.on("share", "change", this._updateSliderValue, this), this._model.calculate().then(function() {
                    this._updateAvailability(), this._updateInfoLabel(), this._updateSliderContent()
                }.bind(this)).done()
            }
        },
        destruct: function() {
            return this._model.un("change", this._updateAvailability, this), this._model.un("change", this._updateInfoLabel, this), this._model.un("minShare", "change", this._updateSliderContent, this), this._model.un("share", "change", this._updateSliderValue, this), BN("slider").un(this._popupContent, "change", this._handleSliderChange, this), this.__base.apply(this, arguments)
        },
        _updateAvailability: function() {
            this._button.toggleMod("disabled", "yes", !this._model.get("enabled"))
        },
        _updateSliderValue: function() {
            var e = this._getSlider();
            e && e.val(this._model.getShareIndex())
        },
        _updateSliderContent: function() {
            var e = this._model.getShareSteps(),
                t = this._model.getShareIndex();
            this._model.get("enabled") && BN("i-content").update(this.findElem(this._popupContent, "slider-wrapper"), {
                block: "sampling-popup",
                elem: "slider",
                scale: e,
                value: t
            }, !0)
        },
        _updateInfoLabel: function() {
            var e = this._model.get("share");
            isNaN(e) || BN("i-content").update(this._button.elem("text"), {
                block: "sampling-popup",
                elem: "info",
                percent: this._model.getSharePercents(e)
            }, !0)
        },
        _handleSliderChange: function() {
            var e = this._getSlider(),
                t = this._model.get("share"),
                i = this._model.getShareByIndex(e.val());
            i !== t && (this.dataBindVal("sampling.accuracy", i), BN("metrika-counter").params("sampling", i))
        },
        _getSlider: function() {
            return this.findBlockInside(this._popupContent, "slider")
        }
    }),
    function(e, t, i) {
        function n(e, t, i, n) {
            if (!(Math.abs(i - a[e]) < r)) {
                var o, s = i > a[e] ? 1 : 0,
                    c = 0,
                    d = a.length;
                if (a[e] = i, 1 !== d)
                    do c !== e && (o = a[c], s ? c > e ? (i > o && (a[c] = i), t >= n[c] && (l[c] = n[c])) : a[c] = t < l[c] ? i : this._calcPercentByValue(l[c]) : e > c ? (o > i && (a[c] = i), t <= n[c] && (l[c] = n[c])) : a[c] = t > l[c] ? i : this._calcPercentByValue(l[c])); while (++c < d)
            }
        }

        function o(e) {
            return {
                37: 1,
                38: 2,
                39: 2,
                40: 1
            }[e]
        }
        var s = e.browser.opera ? "keypress" : "keydown",
            r = .25,
            a = [],
            l = [];
        t.DOM.decl("slider", {
            onSetMod: {
                js: function() {
                    this._setScale(), this._setVals(), this.on("change", this._onChange, this)
                },
                disabled: function(e, t) {
                    this.setMod(this.elem("runner"), e, t)
                }
            },
            onElemSetMod: {
                runner: {
                    disabled: function(e, t, i) {
                        var n = "yes" === i;
                        n && this.delMod(e, "focused"), e.attr({
                            tabindex: n ? -1 : 0,
                            "aria-disabled": n
                        }), this._getInputs()[this._getRunnerIdx(e)].toggleMod(t, "yes", "", n)
                    },
                    focused: {
                        yes: function(e, t, i) {
                            return this.isRunnerDisabled(e) || this.isDisabled() ? !1 : (this.delMod(this.elem("runner"), t), this.bindToDoc(s, function(e) {
                                var t = o(e.which);
                                t && (e.preventDefault(), this._isSliding || (this.delMod("animation")._isSliding = !0), t > 1 ? this.next() : this.prev())
                            }).bindToDoc("keyup", function(e) {
                                this._isSliding && (this.setMod("animation", "yes")._isSliding = !1)
                            }), this._interval = this._getIntervalByValue(this._vals[this._getRunnerIdx(e)]), void e.focus())
                        },
                        "": function(e, t, i, n) {
                            this.unbindFromDoc(s + " keyup"), e.eq(this._activeRunner) && (this._activeRunner = null)
                        }
                    }
                }
            },
            _setScale: function() {
                var e = this._scale = this.params.scale;
                e[0].percent = 0, e.length > 1 && (e[e.length - 1].percent = 100)
            },
            _setVals: function() {
                var e = this;
                this._vals = this._getInputs().map(function(t) {
                    var i = parseFloat(t.val());
                    return isNaN(i) ? e.min() : i
                })
            },
            _getInputs: function() {
                return this._inputs || (this._inputs = this.findBlocksInside("input"))
            },
            _getInputIdx: function(t) {
                return e.inArray(t, this._getInputs())
            },
            _getRunnerIdx: function(e) {
                return this.hasMod(e, "pos") ? this.getMod(e, "pos") - 1 : 0
            },
            _getActiveRunner: function() {
                return this._activeRunner || (this._activeRunner = this.elem("runner", "focused", "yes"))
            },
            _onMouseDown: function(e) {
                e.preventDefault(), "mousedown" === e.type && 1 !== e.which || this.isDisabled() || this.isRunnerDisabled(e.data.domElem) || (this._getOffsetPointerCoord(e), l = this._vals.slice(0), a = this._calcPercentsByValue(l), this.delMod("animation").bindToDoc("mousemove touchmove", this._onMouseMove).bindToDoc("mouseup touchend", this._onMouseUp).setMod(e.data.domElem, "focused", "yes"))
            },
            _onMouseMove: function(e) {
                var t = this._getRunnerIdx(this._getActiveRunner()),
                    i = this._calcValueByEvent(e);
                n.call(this, t, i, this._calcPercentByValue(this.toAllowedRange(t, i)), this._vals), this._render(a), this._val(t, i) && this.trigger("change", {
                    source: "drag"
                })
            },
            _onMouseUp: function(e) {
                this.unbindFromDoc("mousemove touchmove mouseup touchend"), l = [], a = [], this.setMod("animation", "yes")._render(), this.trigger("dragend")
            },
            _onTrackClick: function(e) {
                if (!this.isDisabled()) {
                    var t = this._calcValueByEvent(e),
                        i = this._getClosestRunnerByValue(t);
                    i && this.vals(this._getRunnerIdx(i), t, {
                        source: "click"
                    })
                }
            },
            _onChange: function(e, t) {
                var i = this._getInputs();
                return this._vals.forEach(function(e, t) {
                    i[t].val(e)
                }), this
            },
            _onInputChange: function(e) {
                var t = this.elem("input").index(e.data.domElem),
                    i = this._vals[t],
                    n = this._getInputs()[t];
                this.vals(t, n.val(), {
                    source: "input"
                }), i === this._vals[t] && n.val(this._vals[t])
            },
            _val: function(e, t) {
                if (t = parseFloat(t), isNaN(t)) return !0;
                this._interval = this._getIntervalByValue(t);
                var i = this._scale[this._interval].step,
                    n = t % i;
                n && (t = t - n + (i - n > parseFloat((i / 2).toFixed()) ? 0 : i)), t = this.toAllowedRange(e, parseFloat(t.toFixed(2)));
                var o, s, r = 0,
                    a = this._vals,
                    c = a.length,
                    d = a[e];
                if (a[e] === t ? !1 : (a[e] = t, !0)) {
                    if (1 === c) return !0;
                    o = d > t ? 0 : 1;
                    do r !== e && (s = a[r], o ? r > e ? t > s && (a[r] = t) : t <= l[r] && (a[r] = t) : e > r ? s > t && (a[r] = t) : t >= l[r] && (a[r] = t)); while (++r < c);
                    return !0
                }
                return !1
            },
            toAllowedRange: function(e, t) {
                var i = this._scale,
                    n = i[0].value,
                    o = i[i.length - 1].value;
                return t > o && (t = o), n > t && (t = n), t
            },
            val: function(e, t) {
                return this.vals(0, e, t)
            },
            vals: function(t, i, n) {
                var o = typeof t;
                if ("undefined" == typeof i) {
                    if ("object" !== o) return "number" === o ? this._vals[t] : this._vals;
                    i = t
                }
                if (this.isDisabled()) return this;
                var s = this,
                    r = !1;
                if (e.isArray(i)) {
                    if (i.length < this._vals.length) return s;
                    this._vals.forEach(function(e, t) {
                        s._val(t, i[t]) && !r && (r = !0)
                    })
                } else r = s._val(t, i);
                return r && (this._render(), this.trigger("change", n)), this
            },
            min: function(e) {
                var t = this.params;
                return "undefined" == typeof e ? t.min ? t.min : this._scale[0].value : this.range(e, this.max())
            },
            max: function(e) {
                var t = this.params;
                return "undefined" == typeof e ? t.max ? t.max : this._scale[this._scale.length - 1].value : this.range(this.min(), e)
            },
            range: function(e, t) {
                return "undefined" == typeof e ? [this.min(), this.max()] : (t > e || (t = this._scale[this._scale.length - 1].value), this.params.min = e, this.params.max = t, this._updateRange(), this._render(), this)
            },
            prev: function() {
                var e = this._getRunnerIdx(this._getActiveRunner());
                if ("undefined" != typeof e && this._vals[e]) {
                    var t = this._vals[e] - this._scale[this._interval].step,
                        i = this._getIntervalByValue(t);
                    return i < this._interval && (t = this._vals[e] - this._scale[i].step), this.vals(e, t, {
                        source: "keyboard"
                    })
                }
            },
            next: function() {
                var e = this._getRunnerIdx(this._getActiveRunner());
                if (!("undefined" == typeof e || this._vals[e] >= this._scale[this._scale.length - 1].value)) {
                    var t = this._vals[e] + this._scale[this._interval].step,
                        i = this._getIntervalByValue(t);
                    return i > this._interval && (t = this._scale[i].value), this.vals(e, t, {
                        source: "keyboard"
                    })
                }
            },
            isRunnerDisabled: function(e) {
                return "number" == typeof e && (e = this.elem("runner").eq(e)), this.hasMod(e, "disabled", "yes")
            },
            isDisabled: function() {
                return this.hasMod("disabled", "yes")
            },
            getInterval: function() {
                return this._interval
            },
            getDefaultParams: function() {
                return {
                    scale: [{
                        percent: 0,
                        value: 0,
                        step: 1,
                        label: ""
                    }, {
                        percent: 100,
                        value: 100,
                        step: 1,
                        label: ""
                    }]
                }
            }
        }, {
            live: function() {
                return this.liveBindTo("click", "leftclick", function(e) {
                    this._onTrackClick(e)
                }).liveBindTo("runner", "focusin", function(t) {
                    this.setMod(e(t.target), "focused", "yes")
                }).liveBindTo("focusout", function(e) {
                    this.delMod(this.elem("runner"), "focused")
                }).liveBindTo("runner", "mousedown touchstart", function(e) {
                    this._onMouseDown(e)
                }).liveBindTo("input", "focusout", function(e) {
                    this._onInputChange(e)
                }).liveBindTo("input", "keypress", function(e) {
                    13 === e.which && this._onInputChange(e)
                }), !1
            }
        })
    }(jQuery, BEM), BEM.DOM.decl("slider", {
        _onRunnerHover: function(e) {
            this.isDisabled() || this.toggleMod(e.data.domElem, "hovered", "yes", "", "mouseenter" === e.type)
        }
    }),
    function() {
        var e = [];
        BEM.DOM.decl("slider", {
            _onTrackClick: function() {
                this.__base.apply(this, arguments), this.trigger("dragend")
            },
            _val: function(t, i) {
                if (i = parseFloat(i), isNaN(i)) return !0;
                this._interval = this._getIntervalByValue(i);
                var n = this._scale[this._interval].step,
                    o = i % n;
                o && (i = i - o + (n - o > n / 2 ? 0 : n)), i = this.toAllowedRange(t, parseFloat(i.toFixed(2)));
                var s, r, a = 0,
                    l = this._vals,
                    c = l.length,
                    d = l[t];
                if (l[t] === i ? !1 : (l[t] = i, !0)) {
                    if (1 === c) return !0;
                    s = d > i ? 0 : 1;
                    do a !== t && (r = l[a], s ? a > t ? i > r && (l[a] = i) : i <= e[a] && (l[a] = i) : t > a ? r > i && (l[a] = i) : i >= e[a] && (l[a] = i)); while (++a < c);
                    return !0
                }
                return !1
            }
        })
    }(),
    function(e) {
        var t = .2;
        e.DOM.decl("slider", {
            onSetMod: {
                js: function() {
                    this.__base(), this._build(), this.hasMod("disabled", "yes") && this.setMod(this.elem("runner"), "disabled", "yes"), "undefined" != typeof this.elem("body")[0].onselectstart && (this.elem("body")[0].onselectstart = function() {
                        return !1
                    }), this.afterCurrentEvent(function() {
                        this.domElem && this.setMod("animation", "yes")
                    })
                }
            },
            _getRunnerText: function(e) {
                return "string" == typeof e ? e : this._vals[e]
            },
            _updateOne: function(e, t) {
                var i = this._scale,
                    n = this.elem("runner").eq(e);
                i = this._vals[e] === i[0].value ? -1 : this._vals[e] === i[i.length - 1].value ? 1 : 0, n.css(this.__POS_UNIT, t + "%"), this.toggleMod(n, "state", "start", "", 0 > i).toggleMod(n, "state", "end", "", i > 0);
                var o = this._vals[e];
                this.findElem(n, "text").html(this._getRunnerText(e, o)), n.attr("aria-valuenow", o)
            },
            _updateRanges: function(e) {
                function i(e, t, i) {
                    var n = {};
                    n[o] = "undefined" == typeof t ? "auto" : t + "%", n[s] = (i > 0 ? i : 0) + "%", e.css(n)
                }
                var n, o = this.__POS_UNIT,
                    s = this.__DIM_UNIT,
                    r = e.length,
                    a = (100 - e[r - 1] - t).toFixed(1),
                    l = this.elem("range");
                do i(l.eq(r--), n, a), n = parseFloat((e[r - 1] || 0).toFixed(1)), a = parseFloat((e[r] - n + t).toFixed(1)); while (r);
                i(l.eq(0), 0, e[0])
            },
            _updateRange: function() {
                var e = this._calcPercentByValue(this.min()),
                    t = this.max(),
                    i = {},
                    n = this.elem("allowed-range");
                i[this.__POS_UNIT] = e + "%", i[this.__DIM_UNIT] = (t ? this._calcPercentByValue(t) : 100) - e + "%", n.css(i), this.toggleMod(n, "visibility", "visible", "", this._isAllowedRangeVisible())
            },
            _render: function(e) {
                var t = this;
                return e || (e = this._calcPercentsByValue(this._vals)), e.forEach(function(e, i) {
                    t._updateOne(i, e)
                }), this._updateRanges(e), e
            },
            _buildScale: function(e) {
                for (var t = this.__POS_UNIT, i = this._scale.map(function(i) {
                        return {
                            block: e,
                            elem: "mark",
                            mods: {},
                            attrs: {
                                style: t + ":" + i.percent + "%"
                            },
                            content: i.label || ""
                        }
                    }), n = 0, o = i.length; o > n && !i[n].content.length;) n++;
                return o > n ? (i[0].mods.position = "first", i[this._scale.length - 1].mods.position = "last", {
                    block: e,
                    elem: "scale",
                    content: i
                }) : void 0
            },
            _buildRunner: function(e, t, i) {
                var n = {
                        pos: t
                    },
                    o = this._scale;
                return t -= 1, o = this._vals[t] === o[0].value ? -1 : this._vals[t] === o[o.length - 1].value ? 1 : 0, 0 === o || (n.state = o > 0 ? "end" : "start"), {
                    block: e,
                    elem: "runner",
                    mods: n,
                    attrs: {
                        tabindex: 0,
                        style: this.__POS_UNIT + ":" + i + "%;"
                    },
                    idx: t,
                    value: this._getRunnerText(t)
                }
            },
            _buildAllowedRange: function(e) {
                var t = this._calcPercentByValue(this.min()),
                    i = this.max();
                return {
                    block: e,
                    elem: "allowed-range",
                    mods: {
                        visibility: this._isAllowedRangeVisible() ? "visible" : ""
                    },
                    attrs: {
                        style: this.__POS_UNIT + ":" + t + "%;" + this.__DIM_UNIT + ":" + ((i ? this._calcPercentByValue(i) : 100) - t) + "%;"
                    }
                }
            },
            _build: function() {
                var e, i, n = this,
                    o = this.__self.getName(),
                    s = this.__POS_UNIT,
                    r = this.__DIM_UNIT,
                    a = this._buildScale(o),
                    l = this._vals.map(function(e) {
                        return n._calcPercentByValue(e)
                    }),
                    c = l.length - 1,
                    d = [{
                        block: o,
                        elem: "range",
                        mods: {
                            pos: 1,
                            position: "first"
                        },
                        attrs: {
                            style: s + ":0%;" + r + ":" + l[0] + "%"
                        }
                    }],
                    u = [],
                    h = !1,
                    m = this._getInputs(),
                    p = this.elem("title").attr("id") || "",
                    f = this.min(),
                    g = this.max();
                l.forEach(function(a, _) {
                    u.push(n._buildRunner(o, _ + 1, a)), e = $.identify(), i = $.identify(), m[_].elem("control").attr({
                        id: e,
                        "aria-labelledby": p,
                        "aria-controls": i
                    }), $.extend(u[_], {
                        id: i,
                        inputId: e,
                        labelledby: p,
                        min: f,
                        max: g
                    }), d.push({
                        block: o,
                        elem: "range",
                        mods: {
                            pos: _ + 2
                        },
                        attrs: {
                            style: s + ":" + (c > _ ? a + "%;" : "auto;") + r + ":" + ((c > _ ? l[_ + 1] + t : 100) - a).toFixed(1) + "%"
                        }
                    }), h || _ && a === l[_ - 1] && (h = !0)
                }), d[d.length - 1].mods.position = "last", u.length > 1 ? (u[0].mods.position = "first", u[u.length - 1].mods.position = "last") : (u[0].mods.pos = null, delete u[0].mods.pos), d.push(this._buildAllowedRange(o)), h && this.setMod("collapsed", "yes"), this.domElem.append(BEMHTML.apply(a)), this.elem("body").append(BEMHTML.apply(d.concat(u))), this._updateDimmensions(this._calcDimmensions())
            },
            _calcDimmensions: function() {
                var e, t = this.params.runnerWidth,
                    i = this._scale;
                return t || (i = i[i.length - 1], e = this._buildRunner(this.__self.getName(), 0, 100), e.value = this._getRunnerText(i.value + ""), e = $(BEMHTML.apply(e)).appendTo(this.elem("body")).css("width", "auto"), t = e.outerWidth(), e.remove()), {
                    width: t,
                    "margin-left": 0 - t / 2
                }
            },
            _updateDimmensions: function(e) {
                this.elem("runner").css(e)
            },
            _isAllowedRangeVisible: function() {
                return this.min() > this._scale[0].value || this.max() < this._scale[this._scale.length - 1].value
            }
        })
    }(BEM), BEM.DOM.decl("slider", {
        _build: function() {
            this.__base(), this.bindTo("runner", "mouseenter mouseleave", this._onRunnerHover)
        }
    }),
    function(e, t) {
        function i(e, t, i) {
            return (t.percent - e.percent) * (i - e.value) / (t.value - e.value) + e.percent
        }

        function n(e, t, i) {
            return (t.value - e.value) * (i - e.percent) / (t.percent - e.percent) + e.value
        }
        e.DOM.decl("slider", {
            getOrientation: function() {
                return "Y" === this.__ORIGIN ? "vert" : "hor"
            },
            _getDirrectionFromCoord: function(e) {
                return this._dirrection = e > (this._dirrectionCoord || 0) ? 1 : -1, this._dirrectionCoord = e, this._dirrection
            },
            _calcPercentByValue: function(e) {
                var t = this._scale,
                    n = t.length > 2 ? this._getIntervalByValue(e) : 0;
                return parseFloat(i(t[n], t[n + 1], e).toFixed(1))
            },
            _calcPercentsByValue: function(e) {
                var t = this;
                return e.map(function(e) {
                    return t._calcPercentByValue(e)
                })
            },
            _calcPercentByCoord: function(e) {
                return parseFloat((100 * e / this.elem("body")[this.__DIM_UNIT]()).toFixed(1))
            },
            _calcValueByPercent: function(e) {
                var t = this._scale,
                    i = t.length > 2 ? this._getIntervalByPercent(e) : 0;
                return n(t[i], t[i + 1], e)
            },
            _calcValueByEvent: function(e) {
                return this._calcValueByPercent(this._calcPercentByEvent(e))
            },
            _getIntervalByValue: function(e) {
                var t = this._scale,
                    i = t.length,
                    n = 1;
                if (e <= t[0].value) return 0;
                if (e >= t[i - 1].value) return i - 2;
                for (n = 1; i > n; n++)
                    if (e < t[n].value) return n - 1;
                return i - 2
            },
            _getIntervalByPercent: function(e) {
                if (0 >= e) return 0;
                if (e >= 100) return this._scale.length - 2;
                var t, i = this._scale,
                    n = i.length;
                for (t = 0; n > t; t++)
                    if (e >= i[t].percent && e < (i[t + 1] ? i[t + 1].percent : 100)) return t;
                return n - 2
            },
            _getClosestRunnerByValue: function(e) {
                var t, i = this._scale,
                    n = i[i.length - 1].value - i[0].value;
                return this._vals.forEach(function(i, o) {
                    var s, r = i - e,
                        a = Math.abs(r);
                    if (n >= a) {
                        if (t && a === n && r > 0) return;
                        n = a, s = this.elem("runner").eq(o), this.isRunnerDisabled(s) || (t = s)
                    }
                }, this), t
            }
        })
    }(BEM), BEM.DOM.decl({
        block: "slider",
        modName: "orientation",
        modVal: "horiz"
    }, {
        onSetMod: {
            js: function() {
                this.__POS_UNIT = "left", this.__DIM_UNIT = "width", this.__ORIGIN = "X", this.__base.apply(this, arguments)
            }
        },
        _getCoordFromEvent: function(e) {
            return "number" == typeof e.clientX ? e.clientX : e.originalEvent.touches[0].clientX
        },
        _getOffsetPointerCoord: function(e) {
            var t = e.data.domElem;
            return this._offsetPointer = this._dirrectionCoord = (this._getCoordFromEvent(e) - t.offset().left + parseInt(t.css("margin-left"), 10)).toFixed(2), this._offsetPointer
        },
        _calcPercentByEvent: function(e) {
            var t = this,
                i = t._getCoordFromEvent(e);
            return t._getDirrectionFromCoord(i), t._calcPercentByCoord(i - t.elem("body").offset().left - (t._offsetPointer || 0))
        }
    }),
    function(e, t, i) {
        e.DOM.decl({
            block: "slider",
            modName: "interactive",
            modVal: "no"
        }, {
            _getRunnerText: function() {
                return "&nbsp;"
            },
            getDefaultParams: function() {
                return t.extend(this.__base(), {
                    runnerWidth: 42
                })
            }
        })
    }(BEM, jQuery), BEM.DOM.decl({
        name: "slider",
        modName: "type",
        modVal: "discrete"
    }, {
        _onMouseMove: function(e) {
            var t, i, n, o = this._calcValueByEvent(e);
            o = parseFloat(o), t = o, i = this._getIntervalByValue(o), n = this._scale[i].step, o = this._getDiscreteValue(o, n), Math.abs(t - o) < n / 4 && (this.__base(e), this._render())
        },
        _onTrackClick: function(e) {
            var t, i, n, o = this._calcValueByEvent(e),
                s = this._getClosestRunnerByValue(o),
                r = this._vals[this._getRunnerIdx(s)];
            this.isDisabled() || (t = this._getIntervalByValue(o), n = this._scale[t].step, i = this._getDiscreteValue(o, n), r === i && (i += r > o ? -n : n), s && (this.vals(this._getRunnerIdx(s), i, {
                source: "click"
            }), this.trigger("dragend")))
        },
        _getDiscreteValue: function(e, t) {
            var i = e % t;
            return e - i + (t - i > t / 2 ? 0 : t)
        }
    }),
    function() {
        var e = function(t, i, n) {
            n = n || !1, t.forEach(function(t) {
                i(t, n), t.type === BN("i-goal").TYPE.STEP && e(t.steps, i, !0)
            })
        };
        BEM.JSON.decl("conversion-report", {
            onBlock: function(e) {
                e.js(!0).mix({
                    block: "error-message",
                    mods: {
                        type: "above"
                    }
                }).content([{
                    elem: "header"
                }, {
                    elem: "goals-table-fixed-head"
                }, {
                    elem: "goals-table"
                }, {
                    block: "wait",
                    mods: {
                        theme: "dark"
                    },
                    mix: {
                        block: "conversion-report",
                        elem: "wait"
                    }
                }])
            },
            onElem: {
                "goals-table": function(e) {
                    e.tag("table"), e.content([{
                        elem: "goals-table-scale",
                        mods: {
                            orient: "top"
                        }
                    }, {
                        elem: "goals-table-body"
                    }, {
                        elem: "goals-table-scale",
                        mods: {
                            orient: "bottom"
                        }
                    }])
                },
                "goals-table-fixed-head": function(e) {
                    e.tag("table"), e.content([{
                        elem: "goals-table-scale",
                        mods: {
                            fixed: "yes"
                        },
                        colspan: 1
                    }])
                },
                "goals-table-scale": function(e) {
                    var t = (e.mods() || {}).orient || "top";
                    e.tag("top" === t ? "thead" : "tfoot"), e.content({
                        elem: "scale-row",
                        tag: "tr",
                        content: [{
                            elem: "scale-item",
                            tag: "th",
                            mods: {
                                empty: "yes"
                            },
                            attrs: {
                                colspan: e.param("colspan") || 2
                            }
                        }, {
                            elem: "scale-item",
                            tag: "th",
                            content: {
                                block: "timeline-axis",
                                orient: t,
                                mix: [{
                                    block: "conversion-report",
                                    elem: "timeline-axis"
                                }]
                            }
                        }]
                    })
                },
                "goals-table-body": function(t) {
                    var i, n = t.param("goals") || [],
                        o = [],
                        s = 1;
                    e(n, function(e, t) {
                        var n = e.stat && e.byTimeStat && e.stat.reaches && e.stat.visits;
                        e.type === BN("i-goal").TYPE.STEP ? (i = 0, o.push({
                            elem: "step-goal",
                            goal: e,
                            index: s
                        })) : (o.push({
                            elem: "goal",
                            index: t ? !1 : s,
                            innerIndex: t ? i : !1,
                            goal: e,
                            hasData: n,
                            elemMods: {
                                inner: t ? "yes" : "",
                                "no-data": n ? "" : "yes"
                            }
                        }), i++), t || (s += 1)
                    }, !1), t.tag("tbody").content(o)
                },
                "goal-index": function(e) {
                    var t = e.param("index");
                    e.tag("td"), t && e.content([e.param("index"), "."])
                },
                "step-goal": function(e) {
                    var t = e.param("goal");
                    e.mod("id", t.id), e.tag("tr"), e.js({
                        stepsJson: {
                            block: "conversion-report",
                            elem: "steps-popup-content",
                            title: t.name,
                            steps: t.steps.map(function(e) {
                                var t = e.stat || {};
                                return {
                                    name: e.name,
                                    visits: t.visits,
                                    conversion: t.conversion,
                                    conditions: e.conditions
                                }
                            })
                        }
                    }), e.content([{
                        elem: "goal-index",
                        index: e.param("index")
                    }, {
                        elem: "goal-info",
                        tag: "td",
                        content: {
                            elem: "goal-title",
                            title: BEM.I18N("conversion-report", "step-goal", {
                                goal: BN("i-string").escapeHTML(t.name)
                            }),
                            goal: t
                        }
                    }, {
                        elem: "goal-no-chart",
                        tag: "td"
                    }])
                },
                "goal-edit-icon": function(e) {
                    var t = e.param("id");
                    e.content({
                        block: "link",
                        url: "#",
                        mix: [{
                            block: "smart-link",
                            js: {
                                path: "/" + BN("i-counters").getCounterId(),
                                params: {
                                    tab: "goals",
                                    goal_id: t
                                },
                                keepParams: ["report", "delegation"]
                            }
                        }],
                        content: {
                            block: "icon",
                            mix: [{
                                block: "conversion-report",
                                elem: "goal-edit-icon-element"
                            }],
                            elem: "edit"
                        }
                    })
                },
                goal: function(e) {
                    var t = e.params(),
                        i = t.goal,
                        n = t.hasData;
                    e.tag("tr"), e.content([{
                        elem: "goal-index",
                        index: t.index
                    }, {
                        elem: "goal-info",
                        tag: "td",
                        content: [{
                            elem: "goal-title",
                            title: BN("i-string").escapeHTML(i.name),
                            type: i.type,
                            goal: i,
                            id: i.id,
                            innerIndex: t.innerIndex
                        }, n && {
                            elem: "goal-metrics",
                            goal: i
                        }]
                    }, {
                        elem: "goal-chart",
                        goal: i,
                        hasData: n
                    }])
                },
                "goal-metrics": function(e) {
                    var t = e.param("goal");
                    e.tag("table").content([{
                        elem: "goal-metric-row",
                        elemMods: {
                            type: "conversion"
                        },
                        name: BEM.I18N("conversion-report", "conversion"),
                        value: BN("humanize").format("percents", 100 * t.stat.conversion)
                    }, {
                        elem: "goal-metric-row",
                        elemMods: {
                            type: "reaches"
                        },
                        name: BEM.I18N("conversion-report", "goal-reaches"),
                        value: BN("humanize").format("int", t.stat.reaches)
                    }, {
                        elem: "goal-metric-row",
                        elemMods: {
                            type: "visits"
                        },
                        name: BEM.I18N("conversion-report", "visits"),
                        value: BN("humanize").format("int", t.stat.visits)
                    }])
                },
                "goal-metric-row": function(e) {
                    var t = e.params();
                    e.tag("tr").content([{
                        elem: "goal-metric-row-left",
                        content: t.name
                    }, {
                        elem: "goal-metric-row-right",
                        content: {
                            elem: "value-wrapper",
                            content: t.value
                        }
                    }])
                },
                "goal-metric-row-left": function(e) {
                    e.tag("td")
                },
                "goal-metric-row-right": function(e) {
                    e.tag("td")
                },
                "goal-title": function(e) {
                    var t = e.params(),
                        i = t.goal,
                        n = t.title;
                    e.content([t.id ? {
                        block: "smart-link",
                        mix: [{
                            block: "conversion-report",
                            elem: "goal-title-text"
                        }],
                        js: {
                            path: "/stat/traffic",
                            params: {
                                goal: t.id
                            },
                            keepParams: ["report", "delegation"]
                        },
                        content: n
                    } : {
                        elem: "goal-title-text",
                        content: n
                    }, t.type ? {
                        block: "icon",
                        mix: [{
                            block: "conversion-report",
                            elem: "goal-icon"
                        }],
                        elem: "goal-" + t.type,
                        attrs: {
                            title: BEM.I18N("conversion-report", "goal-" + t.type)
                        }
                    } : null, i.steps || i.parentId ? {
                        block: "conversion-report",
                        elem: "steps-icon",
                        js: {
                            id: i.parentId || i.id,
                            step: t.innerIndex >= 0 ? t.innerIndex : i.steps.length - 1
                        },
                        mix: [{
                            block: "icon",
                            elem: "funnel"
                        }]
                    } : null, {
                        block: "conversion-report",
                        elem: "goal-edit-icon",
                        id: i.parentId || i.id
                    }])
                },
                "goal-chart": function(e) {
                    var t = e.param("goal"),
                        i = e.param("hasData");
                    e.tag("td"), i ? e.content({
                        block: "conversion-chart",
                        data: t.byTimeStat,
                        periodGroups: e.blockParam("periodGroups"),
                        group: e.blockParam("group"),
                        mix: [{
                            block: "conversion-report",
                            elem: "chart"
                        }]
                    }) : e.content({
                        elem: "goal-chart-no-data-label",
                        content: BEM.I18N("conversion-report", "no-data")
                    })
                },
                "steps-popup-content": function(e) {
                    var t = e.params(),
                        i = t.steps,
                        n = Math.round(i[0].visits / i[0].conversion) || 0;
                    e.content([{
                        elem: "steps-title",
                        content: BN("i-string").escapeHTML(t.title)
                    }, {
                        elem: "steps-info-wrapper",
                        content: [{
                            elem: "steps-input-stat",
                            total: n,
                            conversion: i[0].conversion
                        }, i.map(function(e, t) {
                            var n = i[t + 1];
                            return {
                                elem: "step-tier",
                                name: e.name,
                                step: t + 1,
                                visits: e.visits,
                                nextVisits: n && n.visits,
                                conditions: e.conditions
                            }
                        })]
                    }])
                },
                "steps-input-stat": function(e) {
                    var t = e.params(),
                        i = t.total;
                    e.content([BEM.I18N("conversion-report", "total-visits") + ":", i ? {
                        elem: "steps-input-stat-numbers",
                        content: [BN("humanize").format("int", i), {
                            elem: "rarr"
                        }, BN("humanize").format("percents", 100 * t.conversion)]
                    } : {
                        elem: "steps-input-no-data",
                        content: BEM.I18N("conversion-report", "no-data")
                    }])
                },
                "step-tier": function(e) {
                    var t = e.params(),
                        i = t.step,
                        n = t.visits || 0,
                        o = t.nextVisits || 0,
                        s = n > 0 ? o / n : 0,
                        r = BEM.I18N("conversion-report", "step-num", {
                            step: i
                        });
                    e.content([{
                        elem: "step",
                        mods: {
                            last: e.isLast() ? "yes" : "no"
                        },
                        content: [{
                            elem: "step-mark",
                            content: r
                        }, {
                            elem: "step-stat",
                            content: [{
                                elem: "step-stat-name",
                                content: [BN("i-string").escapeHTML(t.name), " (", r, ")"]
                            }, {
                                elem: "step-stat-conditions",
                                conditions: t.conditions
                            }, {
                                elem: "step-stat-reaches",
                                content: BN("humanize").format("int", n)
                            }]
                        }, e.isLast() ? null : {
                            elem: "step-gone",
                            content: [{
                                elem: "step-gone-title",
                                content: BEM.I18N("conversion-report", "step-gone", {
                                    step: i - 1
                                })
                            }, {
                                elem: "step-gone-stat",
                                content: [BN("humanize").format("int", n - o), " (" + BN("humanize").format("percents", 100 * (1 - s)) + ")"]
                            }, {
                                elem: "rarr"
                            }]
                        }]
                    }, e.isLast() ? null : {
                        elem: "step-transition",
                        content: [{
                            elem: "transition-funnel",
                            attrs: {
                                style: "transform: translateX(-50%) scaleX(" + Math.max(2 * s, .05) + ")"
                            },
                            mix: [{
                                block: "icon",
                                elem: "funnel2"
                            }]
                        }, {
                            elem: "step-transition-label",
                            content: BEM.I18N("conversion-report", "step-passed", {
                                step: i + 1
                            }) + ":"
                        }, {
                            elem: "step-transition-stat",
                            content: BN("humanize").format("percents", 100 * s)
                        }]
                    }])
                },
                "step-stat-conditions": function(e) {
                    e.content(e.param("conditions").map(function(e) {
                        return [BEM.I18N("i-counter-goals", "condition-type-" + e.type), " &laquo;", BN("i-string").escapeHTML(e.url), "&raquo;"].join("")
                    }).join("; "))
                }
            }
        })
    }(), BEM.DOM.decl("conversion-report", {
        source: {
            name: "data-source-conversion"
        },
        onSetMod: {
            js: function() {
                this._waitBlock = this.findBlockOn("wait", "wait"), this._source = BEM.create(this.source.name, {}), this._render = $.debounce(this._render, 0, this), this._scales = this.findBlocksInside("timeline-axis"), this._source.on("change", function() {
                    this._waitBlock.show()
                }, this).on("ready", function() {
                    var e = this._source.getError();
                    this._waitBlock.hide(), e ? (BN("sensitive-data-warning").hide(), this._showError(e)) : (BN("sensitive-data-warning").show(this._source.hasSensitiveData()), this._render(this._source))
                }, this), this._source.fetch(), this._topScaleRow = this.elem("goals-table-scale", "orient", "top"), this._bottomScaleRow = this.elem("goals-table-scale", "orient", "bottom"), this._fixedHeadTable = this.elem("goals-table-fixed-head"), this.onWindowResize = jQuery.debounce(this._onWindowResize, 500, this), this.bindToWin("resize", this.onWindowResize).bindToWin("scroll", jQuery.throttle(this._onDocumentScroll, 100, this)), this._throttledUpdateFixedHeadDimensions = jQuery.throttle(this._updateFixedHeadDimensions, 1e3, this)
            }
        },
        destruct: function() {
            BN("sensitive-data-warning").hide(), BN("data-lag-notification").setLag(0), this._source.destruct(), this.__base.apply(this, arguments)
        },
        _onWindowResize: function() {
            this._updateFixedHeadDimensions()
        },
        _showError: function(e) {
            BN("error-message").showError(this, e)
        },
        _render: function(e) {
            var t, i, n, o = e.getData(),
                s = o && o.length;
            s ? (t = e.getPeriodGroups(), i = e.getGroup(), BN("i-content").replace(this.findElem("goals-table-body"), {
                block: "conversion-report",
                elem: "goals-table-body",
                goals: o,
                periodGroups: t,
                group: i
            }).then(function() {
                this._updateFixedHeadDimensions(), this._scales.forEach(function(e) {
                    e.draw(t, i).done()
                }), this.bindTo(this.findElem("steps-icon"), "click", this._showSteps)
            }.bind(this)).done(), BN("data-lag-notification").setLag(e.getDataLag())) : (n = new(BN("i-error-message").MetrikaError), n.text = BEM.I18N("conversion-report", "no-goal-message"), this._showError(n)), this.setMod(this._topScaleRow, "hidden", s ? "" : "yes"), this.setMod(this._bottomScaleRow, "hidden", !o || o.length < 4 ? "yes" : "")
        },
        _updateFixedHeadDimensions: function() {
            var e = this._topScaleRow,
                t = this.findElem(e, "scale-item", "empty", "yes"),
                i = this.findElem(this._fixedHeadTable, "scale-item", "empty", "yes");
            i.width(t.width()), this._fixedHeadTable.css({
                left: t.offset().left - $(window).scrollLeft(),
                width: e.width()
            })
        },
        _onDocumentScroll: function() {
            var e = this.elem("goals-table").offset().top < $(window).scrollTop();
            e && this._throttledUpdateFixedHeadDimensions(), this.toggleMod(this._fixedHeadTable, "visible", "yes", e)
        },
        _showSteps: function(e) {
            var t = this.elemParams(jQuery(e.target)),
                i = this.findElem("step-goal", "id", t.id),
                n = this._getStepsPopup(),
                o = jQuery(BN("i-content").html(this.elemParams(i).stepsJson, !0)),
                s = this.findElem(o, "step").get(t.step);
            this.setMod(jQuery(s), "selected", "yes"), n.setContent(o).show()
        },
        _getStepsPopup: function() {
            return this._popup || (this._popup = jQuery(BN("i-content").html({
                block: "popup",
                mods: {
                    autoclosable: "yes",
                    adaptive: "no",
                    animate: "yes",
                    type: "modal",
                    position: "fixed"
                },
                underMods: {
                    type: "paranja"
                },
                content: [{
                    elem: "close",
                    mix: [{
                        block: "conversion-report",
                        elem: "popup-close"
                    }]
                }, {
                    elem: "content",
                    mix: [{
                        block: "conversion-report",
                        elem: "popup-content"
                    }]
                }]
            }, !0)).bem("popup")), this._popup
        }
    }), BEM.decl({
        block: "data-source-conversion",
        baseBlock: "data-source"
    }, {
        dataBindings: {
            "sampling.accuracy": {
                set: "fetch",
                event: "sampling-accuracy-changed"
            },
            "report.period": {
                set: "fetch"
            },
            "report.group": {
                set: "fetch"
            },
            "report.filter": {
                set: "fetch"
            }
        },
        limit: 1e4,
        containsSensitiveData: !1,
        fetch: function() {
            return this.change(), this.reload(), this
        },
        hasSensitiveData: function() {
            return Boolean(this.containsSensitiveData)
        },
        getData: function() {
            return this._data
        },
        getPeriodGroups: function() {
            var e = this._getQuery();
            return BN("i-period").splitPeriodToGroups(this.getPeriod(), this.getRealGroup(), e.auto_group_type, e.auto_group_size)
        },
        getPeriod: function() {
            return BEM.dataBindVal("report.period")
        },
        getGroup: function() {
            return this.getAutoGroup() || this.getRealGroup()
        },
        getRealGroup: function() {
            return BEM.dataBindVal("report.group")
        },
        getAutoGroup: function() {
            var e = this._getQuery();
            return e && e.auto_group_type
        },
        getAccuracy: function() {
            return BEM.dataBindVal("sampling.accuracy")
        },
        _getGoalInfo: function(e, t, i, n) {
            return {
                id: e.id,
                parentId: n,
                name: e.name,
                type: e.type,
                stat: t,
                byTimeStat: i,
                conditions: e.conditions
            }
        },
        _getConversion: function(e, t) {
            return Array.isArray(e) && Array.isArray(t) ? e.map(function(e, i) {
                var n = e / t[i];
                return n || 0
            }) : e / t
        },
        _getMetricsMap: function(e) {
            return e && e.data && e.data.reduce(function(t, i) {
                return t[i.dimensions[0].id] = {
                    reaches: i.metrics[0],
                    visits: i.metrics[1],
                    conversion: this._getConversion(i.metrics[1], e.totals[1])
                }, t
            }.bind(this), {}) || {}
        },
        _loadDataForChart: function(e) {
            var t, i = [],
                n = 30;
            for (t = 0; t < Math.ceil(e["row-ids"].length / n); t++) i.push(jQuery.extend({}, e, {
                "row-ids": e["row-ids"].slice(t * n, (t + 1) * n)
            }));
            return Vow.all(i.map(function(e) {
                return BN("i-report").loadData(e)
            })).then(function(e) {
                return e.slice(1).reduce(function(e, t) {
                    return t.data = t.data.concat(e.data), t.data_lag = Math.max(t.data_lag || 0, e.data_lag || 0), t.contains_sensitive_data = t.contains_sensitive_data || e.contains_sensitive_data, t
                }, e[0])
            })
        },
        _loadData: function(e) {
            var t = this;
            return BN("i-counters").getAsync().then(function(i) {
                return i.getGoals().length ? Vow.all([i, BN("i-report").loadData(e.aggregated), t._loadDataForChart(e.byTime)]) : null
            }).spread(function(e, i, n) {
                var o, s, r;
                return e ? (o = e.getGoals(), s = this._getMetricsMap(i), r = this._getMetricsMap(n), this._setDataLag(Math.max(i.data_lag || 0, n && n.data_lag || 0)), this._setQuery(n && n.query || {}), i.hasOwnProperty("sampleable") && i.hasOwnProperty("sample_share") && BN("m-accuracy").getInstance().set({
                    share: i.sample_share,
                    minShare: i.max_sample_share
                }), this.containsSensitiveData = Boolean(i.contains_sensitive_data) || Boolean(n && n.contains_sensitive_data), o.map(function(e) {
                    var i = t._getGoalInfo(e, s[e.id], r[e.id]);
                    return e.type === BN("i-goal").TYPE.STEP && (i.steps = Object.keys(e.steps).map(function(i) {
                        var n = e.steps[i];
                        return t._getGoalInfo(n, s[n.id], r[n.id], e.id)
                    }).sort(function(e, t) {
                        return t.stat && t.stat.conversion - e.stat && e.stat.conversion
                    })), i
                })) : (this._setDataLag(0), this._setQuery({}), this.containsSensitiveData = !1, [])
            }.bind(this))
        },
        _getRowIds: function() {
            return BN("i-counters").getAsync().then(function(e) {
                return e.getGoals().reduce(function(e, t) {
                    return t.type === BN("i-goal").TYPE.STEP ? t.steps.forEach(function(t) {
                        e.push([t.id])
                    }) : e.push([t.id]), e
                }, [])
            })
        },
        _getOptions: function() {
            return Vow.all([this._getAggregatedOptions(), this._getByTimeOptions()]).spread(function(e, t) {
                return {
                    aggregated: e,
                    byTime: t
                }
            })
        },
        _getAggregatedOptions: function() {
            return Vow.all([BN("i-report").getMetadata(), BN("i-counters").getAsync()]).spread(function(e, t) {
                return {
                    mode: "list",
                    accuracy: this.getAccuracy(),
                    period: this.getPeriod(),
                    group: this.getRealGroup(),
                    dimensions: e.getDimensions(),
                    metrics: e.getMetrics(),
                    limit: this.limit,
                    ids: t.getId(),
                    filter: BN("i-filter").buildFilter(BEM.dataBindVal("report.filter") || {}, e.getSegmentsTree())
                }
            }.bind(this))
        },
        _getByTimeOptions: function() {
            return Vow.all([this._getAggregatedOptions(), this._getRowIds()]).spread(function(e, t) {
                return e.mode = "dynamics", e["row-ids"] = t, e
            })
        },
        _setQuery: function(e) {
            this._query = e
        },
        _getQuery: function() {
            return this._query
        }
    }), BEM.JSON.decl("conversion-chart", {
        onBlock: function(e) {
            var t = e.params();
            e.js({
                data: t.data,
                periodGroups: t.periodGroups,
                group: t.group
            }).content({
                elem: "chart"
            })
        }
    }), BEM.DOM.decl("conversion-chart", {
        onSetMod: {
            js: function() {
                this._chartAdapter = BEM.create({
                    block: "report-chart-conversion"
                }), this._chartAdapter.setDestination(this.findElem("chart")), this._chartAdapter.draw(this.params).done(), BN("main-menu").on("toggle", this._onResize, this)
            }
        },
        destruct: function() {
            BN("main-menu").un("toggle", this._onResize, this), this.__base.apply(this, arguments)
        },
        _onResize: function() {
            this._chartAdapter.resize()
        }
    }), BEM.decl({
        name: "report-chart-conversion",
        baseBlock: "report-chart"
    }, {
        CONVERSION_COLOR: "#E51B19",
        REACHES_COLOR: "#2370A8",
        draw: function(e) {
            return this._group = e.group, this._periodGroups = e.periodGroups, this.__base(e.data)
        },
        _initChartOptions: function() {
            var e = this;
            this.__base(), jQuery.extend(!0, this._chartOptions, {
                chart: {
                    type: "line",
                    height: 120,
                    spacing: [20, 20, 20, 20],
                    marginLeft: 100,
                    marginRight: 70
                },
                xAxis: this._getDisabledAxisOptions(),
                yAxis: [jQuery.extend(!0, {}, this._getYAxisOptions(), {
                    labels: {
                        formatter: function() {
                            return e._yAxis0Formatter(this.value)
                        }
                    }
                }), jQuery.extend(!0, {}, this._getYAxisOptions(), {
                    labels: {
                        formatter: function() {
                            return e._yAxis1Formatter(this.value)
                        }
                    },
                    opposite: !0
                })],
                plotOptions: {
                    line: {
                        marker: {
                            enabled: !1,
                            symbol: "circle"
                        }
                    }
                }
            })
        },
        _getChartDataOptions: function() {
            var e = this._dataModel.reaches,
                t = [
                    [],
                    []
                ],
                i = [];
            return this._dataModel.conversion.forEach(function(n, o) {
                var s = this._periodGroups[o],
                    r = e[o];
                t[0].push({
                    y: parseFloat(n),
                    date1: s.from._date,
                    date2: s.to._date,
                    group: this._group,
                    isHoliday: s.isHoliday,
                    conversion: !0
                }), t[1].push({
                    y: r,
                    date1: s.from._date,
                    date2: s.to._date,
                    group: this._group,
                    isHoliday: s.isHoliday
                }), i.push(o)
            }, this), {
                series: t,
                xAxisCategories: i,
                count: i.length
            }
        },
        _updateChartDataOptions: function() {
            var e = this._getChartDataOptions();
            jQuery.extend(!0, this._chartOptions, {
                series: [{
                    color: this.CONVERSION_COLOR,
                    data: e.series[0]
                }, {
                    color: this.REACHES_COLOR,
                    data: e.series[1],
                    yAxis: 1
                }]
            })
        },
        _yAxis0Formatter: function(e) {
            return BN("i-content").html({
                block: "report-chart",
                elem: "date",
                content: BN("humanize").formatPercents(100 * e)
            }, !0)
        },
        _yAxis1Formatter: function(e) {
            return BN("humanize").formatInt(e)
        },
        _tooltipFormatter: function(e, t) {
            var i = t.conversion ? BEM.I18N("conversion-chart", "conversion") : BEM.I18N("conversion-chart", "goal-reaches"),
                n = t.conversion ? this._yAxis0Formatter(t.y) : this._yAxis1Formatter(t.y),
                o = this._formatTooltipDate(t);
            return o + "<br />" + i + ": " + n
        }
    }), BEM.decl("i-counter-goals", null, {
        _columns: ["num", "icon", "name", "description", "goal-id", "edit", "delete"],
        _conditionColumns: ["num", "condition", "url", "delete"],
        _conditionTypes: ["contain", "exact", "start", "regexp"],
        getColumns: function() {
            return this._columns.map(function(e) {
                return {
                    value: e,
                    text: BEM.I18N("i-counter-goals", "column-" + e)
                }
            })
        },
        getConditionColumns: function() {
            return this._conditionColumns.map(function(e) {
                return {
                    value: e,
                    text: BEM.I18N("i-counter-goals", "condition-column-" + e)
                }
            })
        },
        getConditionTypes: function() {
            return this._conditionTypes.map(function(e) {
                return {
                    value: e,
                    text: BEM.I18N("i-counter-goals", "condition-type-" + e)
                }
            })
        },
        getExtendedConditionTypes: function() {
            return this.getConditionTypes().concat({
                value: "action",
                text: BEM.I18N("i-counter-goals", "condition-type-action")
            })
        },
        getActionName: function(e) {
            return "action" === e.type && e.conditions && e.conditions.length ? e.conditions[0].url : ""
        },
        getDefaultGoal: function() {
            return {
                type: "url"
            }
        },
        getDefaultCondition: function() {
            return {
                type: "contain",
                url: ""
            }
        },
        getDefaultStep: function() {
            return {
                type: "url",
                name: "",
                conditions: [this.getDefaultCondition()]
            }
        },
        getGoalsTypesCounts: function(e) {
            var t = e.reduce(function(e, t) {
                return t.is_retargeting ? ++e : e
            }, 0);
            return [e.length - t, t]
        }
    }), BEM.JSON.decl("customizations", {
        onBlock: function(e) {
            var t = e.param("customizedParams");
            return t && t.length ? (e.js(!0), void e.content({
                elem: "floating-wrap",
                content: [{
                    elem: "customized-params",
                    customizedParams: e.param("customizedParams")
                }, {
                    elem: "controls"
                }]
            })) : void e.remove()
        },
        onElem: {
            "customized-params": function(e) {
                var t = e.param("customizedParams") || [],
                    i = t.map(function(e) {
                        var t = BEM.I18N("customizations", "customization-" + e);
                        return {
                            elem: "customized-parameter",
                            js: {
                                id: e
                            },
                            mix: [{
                                block: "button",
                                mod: {
                                    size: "xs"
                                }
                            }],
                            content: [{
                                elem: "param-name",
                                tag: "span",
                                content: t
                            }, {
                                block: "icon",
                                elem: "cross",
                                attrs: {
                                    title: BEM.I18N("customizations", "reset-one-customization", {
                                        customization: t
                                    })
                                }
                            }]
                        }
                    });
                i.unshift({
                    elem: "notification",
                    content: BEM.I18N("customizations", "copied-from-prev-report"),
                    tag: "span"
                }), e.content(i)
            },
            controls: function(e) {
                e.content([{
                    block: "button",
                    content: BEM.I18N("customizations", "leave-customizations"),
                    mods: {
                        size: "s",
                        pseudo: "yes"
                    },
                    mix: [{
                        block: "customizations",
                        elem: "leave-button"
                    }, {
                        block: "customizations",
                        elem: "close"
                    }]
                }, {
                    block: "button",
                    content: BEM.I18N("customizations", "reset-customizations"),
                    mods: {
                        size: "s",
                        pseudo: "yes"
                    },
                    mix: [{
                        block: "customizations",
                        elem: "reset-button"
                    }]
                }])
            }
        }
    }), BEM.JSON.decl("customizations", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.params().customizedParams = t.getParamsModel().getCustomizations().getCustomizations()
            }))
        }
    }), BEM.DOM.decl("customizations", {
        _TOGGLE_ANIMATION_TIMEOUT: 200,
        onSetMod: {
            js: function() {
                var e = BN("i-promise").createChain(this);
                this.bindTo("close", "click", this._onLeaveClick.bind(this)), this.findBlockOn("reset-button", "button").on("click", this._onResetClick, this), this.bindTo("customized-parameter", "click", this._onParamClick), BN("i-report").getReport().then(e(function(e) {
                    this._customizations = e.getParamsModel().getCustomizations(), this._customizations.on("change", this._onCustomizationsChange, this)
                }.bind(this))).done(), this._removeToggleMod = jQuery.debounce(function() {
                    this.delMod(this.elem("floating-wrap"), "toggle-mode")
                }.bind(this), this._TOGGLE_ANIMATION_TIMEOUT), this.bindToWin("scroll resize", jQuery.throttle(this._updateBottomPosition, 20, this), this), BN("b-page").on("heightChange", this._updateBottomPosition, this), BN("main-menu").on("toggle", this._updateViewState, this), this._setInitialDimensions()
            }
        },
        destruct: function() {
            this._customizations && this._customizations.un("change", this._onCustomizationsChange, this), this.findBlockOn("reset-button", "button").un("click", this._onResetClick, this), BN("b-page").un("heightChange", this._updateBottomPosition, this), BN("main-menu").un("toggle", this._updateViewState, this), this.trigger("destruct"), this.__base.apply(this, arguments)
        },
        _onCustomizationsChange: function() {
            var e = this._customizations.getCustomizations();
            if (!this._isDestructing) return e.length ? void BN("i-content").replace(this.findElem("customized-params"), {
                block: this.__self._name,
                elem: "customized-params",
                customizedParams: e
            }).done() : this.destruct()
        },
        _onLeaveClick: function() {
            this._customizations.leaveCustomizations()
        },
        _onResetClick: function() {
            this._customizations.resetCustomizations()
        },
        _onParamClick: function(e) {
            var t = this.elemParams(e.data.domElem).id;
            this._customizations.resetCustomizations(t), this._customizations.getCustomizations().length || this.destruct()
        },
        _updateBottomPosition: function() {
            var e, t = BEM.DOM.win,
                i = t.height(),
                n = t.scrollTop(),
                o = BEM.DOM.doc.height() - BN("footer").getFooterHeight();
            e = Math.max(i + n - o, 0), this.elem("floating-wrap").css({
                bottom: e
            })
        },
        _updateViewState: function(e, t) {
            var i = this.elem("floating-wrap");
            i.css("padding-left", ""), this.setMod(i, "toggle-mode", "yes"), this.setMod(i, "view", "basic" === t ? t : "expanded"), this._removeToggleMod()
        },
        _setInitialDimensions: function() {
            var e = this.elem("floating-wrap"),
                t = this.domElem.outerWidth(),
                i = e.outerWidth();
            e.css("padding-left", i - t)
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "calltracking-log"
    }, {
        onBlock: function(e) {
            e.content([{
                elem: "controls"
            }, {
                elem: "table"
            }, {
                block: "data-lag-notification"
            }]);
        },
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: {
                        block: "date-selector",
                        mods: {
                            "data-bind": "report",
                            data: "report"
                        },
                        hideGrouping: !0
                    }
                }], !0).stop()
            },
            "header-controls": function(e) {
                e.content({
                    elem: "export"
                })
            },
            table: function(e) {
                e.content({
                    block: "table-scroll",
                    content: {
                        block: "table",
                        mix: [{
                            block: "report-page",
                            elem: "table-content"
                        }],
                        mods: {
                            report: "calltracking-log"
                        }
                    }
                })
            }
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "calltracking-log"
    }, {
        onBlock: function(e) {
            var t = e.params().meta;
            e.params().columns = Array.prototype.concat({
                name: "idx",
                format: "row-number"
            }, t.getDimensionsMeta().map(this._createColumn.bind(this, "dimension")), t.getMetricsMeta().map(this._createColumn.bind(this, "metric"))), e.params().source = "table-data-source-calltracking-log"
        },
        _createColumn: function(e, t, i) {
            return {
                name: t.dim,
                header: [t.description ? {
                    block: "hint-icon",
                    text: t.description
                } : null, t.name],
                sortable: t.allow_sort,
                source: {
                    name: "report-" + e,
                    key: i
                },
                format: {
                    name: "report-" + e + (t.type ? "-typed" : ""),
                    type: t.type
                }
            }
        }
    }), BEM.JSON.decl({
        name: "table",
        modName: "report",
        modVal: "calltracking-log"
    }, {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(t, i) {
                var n = i.getParamsModel().getState();
                e.params().meta = t, e.params().sort = n.sort, e.params().firstLoadLimit = n.offset + n.limit
            }))
        }
    }), BEM.decl({
        name: "table-data-source-calltracking-log",
        baseBlock: "table-data-source"
    }, {
        totalKey: "total_rows",
        limit: 50,
        dataBindings: {
            "report.period": {
                initAccessor: "_update",
                set: "_update"
            },
            "report.sort": {
                event: "sort.change"
            },
            "report.offset": {
                event: "offset.change"
            },
            "report.limit": {
                event: "limit.change"
            }
        },
        getData: function() {
            return this.__base().data
        },
        _update: function() {
            this.setOffset(0).fetch()
        },
        _getOptions: function() {
            return Vow.all([this.__base(), BN("i-report").getMetadata()]).spread(function(e, t) {
                var i = BEM.dataBindVal("report.period");
                return e.date1 = i.from, e.date2 = i.to, e.id = BN("i-counters").getCounterId(), e.preset = t.getPresetName(), e.offset += 1, e
            }.bind(this))
        },
        _loadData: function(e) {
            return BN("i-calltracking-data-api").getList(e).then(function(e) {
                return this._setDataLag(e.data_lag || 0), e
            }.bind(this))
        }
    }), BEM.JSON.decl({
        name: "report-page",
        modName: "type",
        modVal: "orders"
    }, {
        onElem: {
            controls: function(e) {
                e.content([{
                    elem: "header"
                }, {
                    elem: "notifications"
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "date-selector",
                        mods: {
                            "data-bind": "report",
                            data: "report"
                        },
                        hideGrouping: !0
                    }]
                }, {
                    elem: "toolbar",
                    content: [{
                        block: "segments-selector",
                        mods: {
                            data: "report"
                        },
                        dataBind: "report",
                        menuType: "primary"
                    }]
                }, {
                    block: "segments-wrapper"
                }], !0).stop()
            },
            table: function(e) {
                e.content({
                    block: "data-table",
                    mods: {
                        "data-bind": "report",
                        "fixed-head": "yes",
                        report: "orders"
                    }
                })
            },
            chart: function(e) {
                e.remove()
            }
        }
    }), BEM.DOM.decl({
        name: "data-table",
        modName: "report",
        modVal: "orders"
    }, {
        GATEWAY_TIMEOUT_MESSAGE: "ERR_GATEWAY_TIMEOUT_SHORT",
        onSetMod: {
            state: {
                "*": function() {
                    BEM.DOM.destruct(this.findElem("wait"))
                },
                loading: function() {
                    BN("i-content").append(this.domElem, {
                        block: "wait",
                        mods: {
                            theme: "opaque",
                            state: "active",
                            adaptive: "yes"
                        },
                        mix: {
                            block: "data-table",
                            elem: "wait"
                        }
                    }).then(function() {
                        this.findElem("wait").bem("wait").show()
                    }.bind(this)).done()
                }
            }
        }
    }), BEM.DOM.decl({
        name: "wait",
        modName: "adaptive",
        modVal: "yes"
    }, {
        onSetMod: {
            js: function() {
                return this.hasMod("state", "active") && this._adaptIndicator(), this.__base()
            },
            state: {
                active: function() {
                    this._adaptIndicator()
                }
            }
        },
        _adaptIndicator: function() {
            var e, t, i, n = this.domElem.get(0).getBoundingClientRect(),
                o = n.left < 0 ? n.width + n.left : Math.min(window.innerWidth - n.left, n.width),
                s = n.top < 0 ? n.height + n.top : Math.min(window.innerHeight - n.top, n.height),
                r = o > 0 && s > 0,
                a = this.elem("indicator"),
                l = a.attr("style");
            return r && (e = a.get(0).getBoundingClientRect(), t = o / 2 - e.width / 2, i = s / 2 - e.height / 2, t >= 0 && i >= 0) ? void a.css({
                left: t,
                top: i
            }) : void a.attr("style", l)
        }
    }), BEM.JSON.decl("export", {
        FORMATS: ["pdf", "xlsx", "csv"],
        onBlock: function(e) {
            var t = e.params().formats;
            t = t ? t.filter(function(e) {
                return this.FORMATS.indexOf(e) >= 0
            }, this) : this.FORMATS, e.js(!0).content({
                block: "dropdown-menu",
                mods: {
                    size: "s"
                },
                mix: [{
                    block: "export",
                    elem: "dropdown-content"
                }],
                content: [{
                    elem: "switcher",
                    content: {
                        block: "button",
                        mods: {
                            size: "s",
                            "only-icon": "yes"
                        },
                        content: {
                            block: "icon",
                            elem: "export",
                            mix: [{
                                block: "button",
                                elem: "icon"
                            }]
                        }
                    }
                }, {
                    elem: "popup",
                    mods: {
                        size: "s"
                    },
                    js: {
                        directions: {
                            to: "bottom",
                            axis: "right",
                            offset: {
                                top: -5
                            }
                        }
                    },
                    menuMods: {
                        type: "hovered"
                    },
                    mix: [{
                        block: "export",
                        elem: "popup"
                    }],
                    content: t.map(function(e) {
                        return {
                            elem: "item",
                            content: {
                                block: "smart-link",
                                mods: {
                                    type: "export"
                                },
                                js: {
                                    params: {
                                        format: e
                                    }
                                },
                                content: {
                                    block: "export",
                                    elem: "link-label",
                                    tag: "span",
                                    content: e
                                }
                            }
                        }
                    })
                }]
            })
        }
    }), BEM.JSON.decl({
        name: "smart-link",
        modName: "type",
        modVal: "export"
    }, {
        onBlock: function(e) {
            var t = e.js() || {};
            t.keepParams = ["delegation", "report", "data-table", "comparison", "chart", "data-table-report-specific", "dimension_mode", "quantile", "data-table-dimension-filter", "monitoring-report", "currency", "widgetToReportParams"], t.path = e.params().reportPath, e.js(t).param("linkAttrs", {
                target: "_blank"
            })
        }
    }), BEM.JSON.decl({
        name: "smart-link",
        modName: "type",
        modVal: "export"
    }, {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.params().reportPath = t.getReportPath() || ""
            }))
        }
    }), BEM.DOM.decl({
        name: "smart-link",
        modName: "type",
        modVal: "export"
    }, {
        _getNewParams: function() {
            var e = this.__base.apply(this, arguments),
                t = BEM.dataBindVal("sampling.accuracy");
            return t && (e.accuracy = t), e.period = BN("i-period").stringifyPeriod(BN("i-period").getPeriod()), e.secondary_period = BN("i-period").stringifyPeriod(BN("i-period").getSecondaryPeriod()), e
        }
    }), BEM.JSON.decl("save-report-form", {
        onBlock: function(e) {
            var t = e.param("report");
            e.js(!0), e.content([{
                block: "multibutton",
                items: [{
                    key: "save",
                    label: BEM.I18N("save-report-form", "save-changes"),
                    "default": !0,
                    disabled: !t.isNew() && !t.isChanged()
                }, {
                    key: "saveAs",
                    label: BEM.I18N("save-report-form", "save-as"),
                    disabled: t.isNew()
                }, {
                    key: "remove",
                    label: BEM.I18N("save-report-form", "remove"),
                    disabled: !1,
                    hidden: !t.isUser()
                }, {
                    key: "reset",
                    label: BEM.I18N("save-report-form", "reset"),
                    disabled: !t.isCustomized(),
                    hidden: t.isUser() || t.isNew()
                }, {
                    key: "rename",
                    label: BEM.I18N("save-report-form", "rename"),
                    disabled: !t.isUser(),
                    hidden: !t.isUser()
                }]
            }, {
                block: "report-title-popup"
            }, {
                block: "tooltip",
                js: {
                    to: "top"
                },
                mods: {
                    size: "s"
                }
            }, {
                block: "spin2",
                mods: {
                    size: "xs",
                    progress: "yes"
                }
            }])
        }
    }), BEM.JSON.decl("save-report-form", {
        onBlock: function(e) {
            var t = Vow.all([BN("i-report").getReport(), BN("i-user").uid().fail(function() {
                return null
            })]).spread(function(t, i) {
                i ? e.param("report", t) : e.remove()
            });
            e.defer(t)
        }
    }), BEM.DOM.decl("save-report-form", {
        onSetMod: {
            js: function() {
                BN("i-report").getReport().then(function(e) {
                    this._report = e, this._report.on("change", this._reportChangeHandler, this)
                }.bind(this)), this._multiButton = this.findBlockInside("multibutton"), this._titlePopup = this.findBlockInside("report-title-popup"), this._tooltip = this.findBlockInside("tooltip"), this._multiButton.on("click", this._multibuttonClickHandler.bind(this))
            },
            loading: {
                yes: function() {
                    this._multiButton.disable()
                },
                "": function() {
                    this._multiButton.enable()
                }
            }
        },
        destruct: function() {
            return this._report && this._report.un("change", this._reportChangeHandler, this), this._tooltip.destruct(), this.__base.apply(this, arguments)
        },
        _reportChangeHandler: function() {
            this._isDestructing || (this._hideMessage(), this._report.isNew() ? (this._multiButton.enableItem("save"), this._multiButton.disableItem("saveAs")) : this._report.isChanged() ? (this._multiButton.enableItem("save"), this._multiButton.enableItem("saveAs")) : (this._multiButton.disableItem("save"), this._multiButton.enableItem("saveAs")), this._report.isUser() ? (this._multiButton.showItem("remove"), this._multiButton.hideItem("reset"), this._multiButton.showItem("rename")) : (this._multiButton.hideItem("remove"), this._multiButton.hideItem("rename"), this._report.isNew() ? this._multiButton.hideItem("reset") : (this._multiButton.showItem("reset"), this._report.isCustomized() ? this._multiButton.enableItem("reset") : this._multiButton.disableItem("reset"))))
        },
        _multibuttonClickHandler: function(e, t) {
            BN("i-report").getReport().then(function(e) {
                var i;
                return "reset" === t ? e.resetToDefaults().always(this._defaultSaveHandler.bind(this)) : "remove" === t ? Vow.all([BN("i-counters").getAsync(), e.remove()]).spread(function(e) {
                    var t = BN("i-router").getParams().ulogin;
                    BN("i-router").replacePath("/dashboard?" + (e.isSingle() ? "id" : "gid") + "=" + e.getId() + (t ? "&ulogin=" + t : ""))
                }).done() : "saveAs" === t || e.isNew() || "rename" === t ? (i = "rename" === t ? "rename" : "saveAs", this._titlePopup.show(this._multiButton, e.getName(), i).then(function(e) {
                    return "cancelled" !== e.status ? this._titlePopupSaveHandler(i, e.value) : void 0
                }.bind(this))) : (this.setMod("loading", "yes"), e.saveChanges().always(this._defaultSaveHandler.bind(this)))
            }.bind(this)).done()
        },
        _titlePopupSaveHandler: function(e) {
            if (this.setMod("loading", "yes"), -1 === ["saveAs", "rename"].indexOf(e)) throw new Error("Bad argument");
            BN("i-report").getReport().then(function(t) {
                var i = this._titlePopup.val().trim();
                return t[e](i)
            }.bind(this)).always(this._defaultSaveHandler.bind(this)).done()
        },
        _defaultSaveHandler: function(e) {
            return e.then(function() {
                this._showOkMessage(this._multiButton)
            }.bind(this)).fail(function(e) {
                this._showFailMesage(this._multiButton, e), setTimeout(function() {
                    throw e
                }, 0)
            }.bind(this)).always(function() {
                this.setMod("loading", "")
            }.bind(this))
        },
        _hideMessage: function() {
            this._tooltip.setMod("shown", "")
        },
        _showOkMessage: function(e) {
            this._tooltip.setContent(BEM.I18N("save-report-form", "done")).setOwner(e).setMod("theme", "success").setMod("shown", "yes")
        },
        _showFailMesage: function(e, t) {
            this._tooltip.setContent(BN("i-error-message").toText(t)).setOwner(e).setMod("theme", "error").setMod("shown", "yes")
        }
    }), BEM.JSON.decl("report-title-popup", {
        onBlock: function(e) {
            e.js(!0), e.content({
                elem: "title-popup",
                title: e.param("title")
            })
        },
        onElem: {
            "title-popup": function(e) {
                e.content({
                    block: "popup",
                    js: {
                        directions: "bottom-right-right"
                    },
                    content: [{
                        elem: "tail"
                    }, {
                        elem: "content",
                        content: {
                            block: "report-title-popup",
                            elem: "popup-content",
                            title: e.param("title")
                        }
                    }]
                })
            },
            "popup-content": function(e) {
                var t = e.param("title") || "";
                e.content([{
                    elem: "hint",
                    mods: {
                        type: "save-as"
                    },
                    content: BEM.I18N("report-title-popup", "save-as-hint")
                }, {
                    elem: "hint",
                    mods: {
                        type: "rename"
                    },
                    content: BEM.I18N("report-title-popup", "rename-hint")
                }, {
                    block: "input",
                    mods: {
                        type: "textarea",
                        size: "s"
                    },
                    value: t,
                    content: {
                        elem: "control"
                    }
                }, {
                    block: "button",
                    mods: {
                        size: "s"
                    },
                    content: [{
                        block: "report-title-popup",
                        elem: "button-label",
                        mods: {
                            type: "save-as"
                        },
                        content: BEM.I18N("report-title-popup", "save")
                    }, {
                        block: "report-title-popup",
                        elem: "button-label",
                        mods: {
                            type: "rename"
                        },
                        content: BEM.I18N("report-title-popup", "rename")
                    }]
                }])
            }
        }
    }), BEM.DOM.decl("report-title-popup", {
        onSetMod: {
            js: function() {
                this._input = this.findBlockInside("input"), this._saveButton = this.findBlockInside("button"), this._popup = this.findBlockInside("popup"), this._onInputChange = jQuery.debounce(this._onInputChange.bind(this), 200), this._input.on("change", this._onInputChange, this), this._saveButton.on("click", this._onSaveClick, this), this._popup.on("hide", this._onPopupHide, this), this._popupContent = this.elem("popup-content")
            }
        },
        destruct: function() {
            return this._popup.un("hide", this._onPopupHide, this), this._saveButton.un("click", this._onSaveClick, this), this._input.un("change", this._onInputChange, this), this.__base.apply(this, arguments)
        },
        val: function() {
            return this._input.val()
        },
        show: function(e, t, i) {
            return this._shownPromise && this._shownPromise.reject({
                status: "cancelled"
            }), this.setMod(this._popupContent, "mode", "rename" === i ? "rename" : "save-as"), this._shownPromise = Vow.promise(), void 0 !== t && (t = t.trim(), this._input.val(t), this._adjustButtonState(t)), this._popup.show(e), this._shownPromise
        },
        _onPopupHide: function() {
            this._shownPromise && !this._shownPromise.isResolved() && (this._shownPromise.fulfill({
                status: "cancelled"
            }), this._shownPromise = null)
        },
        _onInputChange: function() {
            var e = this._input.val().trim();
            this._adjustButtonState(e)
        },
        _adjustButtonState: function(e) {
            this._saveButton.setMod("disabled", e ? "" : "yes")
        },
        _onSaveClick: function() {
            this._saveButton.hasMod("disabled", "yes") || (this._shownPromise.fulfill(this.val()), this._popup.hide())
        }
    }), BEM.JSON.decl("multibutton", {
        onBlock: function(e) {
            var t, i = e.param("items"),
                n = BN("i-util").arrayFind(i, function(e) {
                    return e["default"]
                }) || i[0];
            i = i.filter(function(e) {
                return e.key !== n.key
            }), t = i.every(function(e) {
                return Boolean(e.disabled)
            }), e.js(!0), e.content({
                block: "dropdown-menu",
                content: [{
                    block: "button",
                    content: n.label,
                    attrs: {
                        autocomplete: "off"
                    },
                    mods: {
                        theme: "action",
                        size: "s",
                        side: "left",
                        disabled: n.disabled ? "yes" : ""
                    },
                    mix: [{
                        block: "multibutton",
                        elem: "item",
                        js: {
                            key: n.key
                        },
                        mods: {
                            "default": "yes"
                        }
                    }]
                }, {
                    block: "button",
                    mix: [{
                        block: "dropdown-menu",
                        elem: "switcher"
                    }],
                    attrs: {
                        autocomplete: "off"
                    },
                    mods: {
                        size: "s",
                        theme: n.disabled ? "normal" : "action",
                        "only-icon": "yes",
                        side: "right",
                        arrow: "down",
                        disabled: t ? "yes" : ""
                    }
                }, {
                    elem: "popup",
                    js: {
                        directions: {
                            to: "bottom",
                            axis: "right",
                            offset: {
                                top: -5
                            }
                        }
                    },
                    mix: [{
                        block: "multibutton",
                        elem: "popup"
                    }],
                    menuMods: {
                        type: "hovered"
                    },
                    content: i.map(function(e) {
                        return {
                            elem: "item",
                            mix: [{
                                block: "multibutton",
                                elem: "item",
                                mods: {
                                    hidden: e.hidden ? "yes" : ""
                                },
                                js: {
                                    key: e.key
                                }
                            }],
                            content: e.label
                        }
                    })
                }]
            })
        }
    }), BEM.DOM.decl("multibutton", {
        onSetMod: {
            js: function() {
                this._dropdown = this.findBlockInside("dropdown-menu"), this._dropdownButton = this._dropdown.findBlockInside("switcher", "button"), this._defaultItem = this.findElem("item", "default", "yes"), this._defaultItemButton = this.findBlockOn(this._defaultItem, "button"), this._itemsIndex = [].reduce.call(this.elem("item"), function(e, t) {
                    var i;
                    return t = this.elemify(jQuery(t), "item"), t.on("click", this._onItemClick.bind(this)), i = this.elemParams(t), e[i.key] = {
                        item: t,
                        "default": this.hasMod(t, "default", "yes")
                    }, e
                }.bind(this), {})
            },
            disabled: function(e, t) {
                this._dropdownButton.setMod(e, t), "yes" === t ? (this._defaultItemButton.setMod(e, t), this._dropdownButton.setMod("disabled", "yes")) : (this._dropdownButton.delMod("disabled"), this._defaultItemButton.setMod(e, this.hasMod(this._defaultItem, "disabled", "yes") ? "yes" : ""))
            }
        },
        disable: function() {
            this.setMod("disabled", "yes")
        },
        enable: function() {
            this.setMod("disabled", "")
        },
        hideItem: function(e) {
            var t = this._itemsIndex[e];
            this.setMod(t.item, "hidden", "yes")
        },
        showItem: function(e) {
            var t = this._itemsIndex[e];
            this.delMod(t.item, "hidden")
        },
        enableItem: function(e) {
            var t = this._itemsIndex[e];
            this.setMod(t.item, "disabled", ""), t["default"] && (this._defaultItemButton.setMod("disabled", ""), this._dropdownButton.setMod("theme", "action")), this._hasNonDefaultEnabledItems() && this._dropdownButton.delMod("disabled")
        },
        disableItem: function(e) {
            var t = this._itemsIndex[e];
            this.setMod(t.item, "disabled", "yes"), t["default"] && (this._defaultItemButton.setMod("disabled", "yes"), this._dropdownButton.setMod("theme", "normal")), this._hasNonDefaultEnabledItems() || this._dropdownButton.setMod("disabled", "yes")
        },
        _hasNonDefaultEnabledItems: function() {
            return Object.keys(this._itemsIndex).some(function(e) {
                var t = this._itemsIndex[e];
                return !t["default"] && !this.hasMod(t.item, "disabled") && !this.hasMod(t.item, "hidden", "yes")
            }, this)
        },
        _onItemClick: function(e) {
            var t = this.elemify(e.currentTarget, "item"),
                i = this.elemParams(t);
            this.hasMod("disabled", "yes") || this.hasMod(t, "disabled", "yes") || (this._dropdown.hide(), this.trigger("click", i.key))
        }
    }),
    function(e) {
        var t = e.browser,
            i = t.opera && t.version < 12.1 ? "keypress" : "keydown";
        BEM.DOM.decl("tooltip", {
            onSetMod: {
                js: {
                    inited: function() {
                        this._popup = null, this._owner = null
                    }
                },
                shown: {
                    yes: function() {
                        if (!this._owner) throw new Error("Owner is unset");
                        this._getPopup().show(this._owner).unbindFromDoc(i)
                    },
                    "": function() {
                        this._getPopup().hide()
                    }
                }
            },
            getOwner: function() {
                return this._owner
            },
            setOwner: function(e) {
                return this._owner = e, this
            },
            setContent: function(e) {
                return this._getPopup().setContent(e), this
            },
            redraw: function() {
                return this.hasMod("shown", "yes") && this._getPopup().repaint(), this
            },
            destruct: function() {
                this.delMod("shown"), this.__base.apply(this, arguments)
            },
            _getPopup: function() {
                return this._popup || (this._popup = this.findBlockOn("popup").on("show", this._onPopupShow, this).on("hide", this._onPopupHide, this)), this._popup
            },
            _onPopupShow: function() {
                this.trigger("show")
            },
            _onPopupHide: function() {
                this.delMod("shown").trigger("hide")
            },
            _onClick: function() {
                this.trigger("click").delMod("shown")
            }
        }, {
            live: function() {
                this.liveBindTo("click", function() {
                    this._onClick()
                })
            }
        })
    }(jQuery), BEM.DOM.decl("tooltip", {
        onSetMod: {
            hovered: {
                yes: function() {
                    this.bindTo("mouseleave", this._onMouseLeave)
                },
                "": function() {
                    this.unbindFrom("mouseleave")
                }
            }
        },
        _onMouseOver: function() {
            this.setMod("hovered", "yes")
        },
        _onMouseLeave: function() {
            this.delMod("hovered")
        }
    }, {
        live: function() {
            return this.liveBindTo("mouseover", function() {
                this._onMouseOver()
            }), this.__base.apply(this, arguments)
        }
    }), BEM.DOM.decl("tooltip", {
        onSetMod: {
            js: function() {
                this.__base(), this._popupBlock = this.findBlockOn(this.domElem, "popup")
            },
            theme: function(e, t) {
                this._popupBlock.setMod(e, t)
            }
        },
        destruct: function() {
            return this._popupBlock.hide(), this.__base()
        },
        setContent: function(e) {
            return this._popupBlock.setContent(e), this
        }
    }), BEM.JSON.decl("attribution-menu", {
        onBlock: function(e) {
            var t = e.param("attribution"),
                i = e.content() || [],
                n = BEM.I18N("attribution-menu", "attribution") + " ";
            e.js(!0), e.content(i.concat([{
                block: "select",
                js: {
                    textPrefix: n
                },
                mods: {
                    size: "s",
                    theme: "normal",
                    "combining-label": "yes"
                },
                content: [{
                    block: "button",
                    mods: {
                        size: "s",
                        theme: "normal"
                    },
                    content: t ? n + BEM.I18N("attribution-menu", t) : "&nbsp;"
                }, {
                    elem: "control",
                    content: e.param("attributions").map(function(e) {
                        return {
                            elem: "option",
                            attrs: {
                                value: e,
                                selected: e === t ? "selected" : void 0
                            },
                            content: BEM.I18N("attribution-menu", e)
                        }
                    })
                }]
            }, {
                block: "hint-icon",
                text: BEM.I18N("attribution-menu", "hint")
            }]), !0)
        }
    }), BEM.JSON.decl("attribution-menu", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-report").getMetadata(), BN("i-report").getReport()]).spread(function(t, i) {
                var n = i.getParamsModel().getState();
                e.param("attribution", n.attribution), e.param("attributions", BN("i-attribution").ATTRIBUTION_VALUES), e.mods({
                    disabled: BN("i-attribution").checkAttributionDimensionsPresent(t.getDimensionsMeta()) ? "" : "yes"
                })
            }))
        }
    }), BEM.DOM.decl("attribution-menu", {
        dataBindings: {
            attribution: {
                get: "_getVal",
                event: "change",
                set: "_setVal"
            },
            "preset.dimensions": {
                set: "_changeDimensions"
            }
        },
        onSetMod: {
            js: function() {
                this._select = this.findBlockInside("select").on("change", this.trigger.bind(this, "change"))
            }
        },
        _getVal: function() {
            return this._select.val()
        },
        _setVal: function(e) {
            this._select.val(e)
        },
        _changeDimensions: function() {
            BN("i-report").getMetadata().then(function(e) {
                var t = BN("i-attribution").checkAttributionDimensionsPresent(e.getDimensionsMeta()) ? "" : "yes";
                this.setMod("disabled", t)
            }.bind(this))
        }
    }), BEM.JSON.decl({
        name: "attribution-menu",
        modName: "advice",
        modVal: "yes"
    }, {
        onBlock: function(e) {
            e.content([{
                block: "advice",
                type: "attribution",
                index: 5
            }])
        }
    }), BEM.JSON.decl("add-to-favorites", {
        onBlock: function(e) {
            var t = e.params();
            e.js(!0).attrs({
                title: BEM.I18N("add-to-favorites", "active" === t.state ? "remove" : "add")
            }).mod("state", t.state).content([{
                elem: "icon",
                mods: {
                    state: "general"
                },
                mix: [{
                    block: "icon",
                    elem: "bookmark"
                }]
            }, {
                elem: "icon",
                mods: {
                    state: "active"
                },
                mix: [{
                    block: "icon",
                    elem: "bookmark",
                    mods: {
                        state: "active2"
                    }
                }]
            }, {
                elem: "icon",
                mods: {
                    state: "active-hover"
                },
                mix: [{
                    block: "icon",
                    elem: "bookmark",
                    mods: {
                        state: "active"
                    }
                }]
            }])
        }
    }), BEM.JSON.decl("add-to-favorites", {
        onBlock: function(e) {
            var t = e.params();
            e.defer(Vow.all([BN("i-user").uid(), BN("i-report").getReport(), BN("i-favorite-reports-api").get()]).spread(function(e, i, n) {
                var o = i.getId(),
                    s = n.reports || [];
                i.isNew() ? t.state = "disabled" : t.state = -1 === s.indexOf(o) ? "general" : "active"
            }).fail(function() {
                e.remove()
            }))
        }
    }), BEM.DOM.decl("add-to-favorites", {
        onSetMod: {
            js: function() {
                BN("i-report").getReport().then(BN("i-promise").intercept(this, function(e) {
                    this._report = e.on("change", this._handleReportChange, this), this._originalReportId = this._report.getId(), this.bindTo("click", this._onClick)
                })).done()
            },
            state: function(e, t, i) {
                var n = "active" === t ? "add" : "remove",
                    o = this.getMod("loading"),
                    s = "fail" === o;
                return o ? (s && this.delMod("loading"), s) : (this.setMod("loading", "yes"), void BN("i-favorite-reports-api")[n](this._originalReportId).always(function(e) {
                    var t;
                    return e.isRejected() ? (this.setMod("loading", "fail").setMod("state", i), e) : (this.delMod("loading"), t = "active" === this.getMod("state") ? "remove" : "add", void this.domElem.attr("title", BEM.I18N("add-to-favorites", t)))
                }.bind(this)).done())
            }
        },
        destruct: function() {
            return this._report && this._report.un("change", this._handleReportChange, this), this.__base.apply(this, arguments)
        },
        _handleReportChange: function() {
            this._report.getId() !== this._originalReportId && (this._originalReportId = this._report.getId(), this.setMod("state", "general"))
        },
        _onClick: function() {
            this.toggleMod("state", "general", "active")
        }
    }), BEM.decl("i-favorite-reports-api", null, BEM.blocks["i-proxy"].initProxy("i-favorite-reports-api", ["get*", "add", "remove"])), BEM.decl("i-favorite-reports-api", null, {
        add: function() {
            return this._cleanCache(this.__base, arguments)
        },
        remove: function() {
            return this._cleanCache(this.__base, arguments)
        },
        _cleanCache: function(e, t) {
            return e.apply(this, t).then(function(e) {
                return BN("i-proxy").cleanCache("i-favorite-reports-api", "get"), e
            })
        }
    }), BEM.JSON.decl("report-title", {
        onBlock: function(e) {
            var t = e.params().name;
            e.js(!0).content(BN("i-string").escapeHTML(t)).attrs({
                title: t
            })
        }
    }), BEM.JSON.decl("report-title", {
        onBlock: function(e) {
            e.defer(BN("i-report").getReport().then(function(t) {
                e.params().name = t.getName()
            }))
        }
    }), BEM.DOM.decl("report-title", {
        onSetMod: {
            js: function() {
                BN("i-report").getReport().then(BN("i-promise").intercept(this, function(e) {
                    this._report = e, this._name = e.getName(), this._report.on("change", this._onReportChange, this)
                })).done()
            }
        },
        destruct: function() {
            return this._report && this._report.un("change", this._onReportChange, this), this.__base.apply(this, arguments)
        },
        _onReportChange: function() {
            var e = this._report.getName();
            e !== this._name && (this._name = e, BN("i-content").update(this.domElem, BN("i-string").escapeHTML(this._name), !0), this.domElem.attr("title", this._name))
        }
    }), BEM.JSON.decl("public-counter-notification", {
        onBlock: function(e) {
            e.defer(Vow.all([BN("i-counters").getAsync(), BN("i-report").getReport()]).spread(function(t, i) {
                e.param("js", {
                    initiallyVisible: t.isPublicAccessible() && i.isPublicAccessible()
                }, !0)
            }))
        }
    }), BEM.DOM.decl({
        block: "public-counter-notification",
        baseBlock: "notification"
    }), BEM.DOM.decl({
        block: "b-page",
        modName: "type",
        modVal: "report"
    }, {
        onSetMod: {
            js: function() {
                this._heightWatcher = BN("i-height-watcher").getInstance(this.domElem), this._heightWatcher.on("change", this._onHeightChange, this), this.__base.call(this)
            }
        },
        destruct: function() {
            return this._heightWatcher.un("change", this._onHeightChange, this), this.__base.apply(this, arguments)
        },
        _onHeightChange: function() {
            this.trigger("heightChange")
        }
    }), BEM.decl("metrika-counter", null, {
        params: function(e) {
            var t;
            t = "object" == typeof e ? e : this._arrayToObj(Array.prototype.slice.apply(arguments)), this._arrayToObj([BN("i-counters").isSingle() ? "counter" : "group", BN("i-counters").getCounterId() || BN("i-counters").getGroupId(), BN("i-url").parseUrl(location).pathname], t), this.__base.call(this, t)
        },
        _arrayToObj: function(e, t) {
            var i, n, o;
            for (t = t || {}, i = t, n = 0, o = e.length - 1; o > n; n++) i = i[e[n]] = n + 1 === o ? e[o] : {};
            return t
        }
    }),
    function(e, t, i) {
        function n() {
            p && f && console.log.apply(console, arguments)
        }

        function o(e) {
            return "string" == typeof e && (e = {
                block: e
            }), e.block + (e.elem ? d + e.elem : "") + (e.modName ? c + e.modName + c + e.modVal : "")
        }

        function s(e) {
            var t = {};
            return e.split(d).forEach(function(e, i) {
                var n = [i ? "elem" : "block", "mod", "val"];
                e.split(c).forEach(function(e, i) {
                    t[n[i]] = e
                })
            }), t
        }

        function r(e) {
            return e ? m.push(e) : !1
        }

        function a() {
            return m.length && m.pop()
        }

        function l() {
            this._lang = "", this._prj = "lego", this._keyset = "", this._key = ""
        }
        if ("function" == typeof t.I18N && t.I18N._proto) return t.I18N;
        "undefined" == typeof i18n && (i18n = {}), BEM = t;
        var c = "_",
            d = "__",
            u = "ru",
            h = {},
            m = [],
            p = !1,
            f = "undefined" != typeof console && "function" == typeof console.log;
        l.prototype = {
            lang: function(e) {
                return this._lang = e, this
            },
            project: function(e) {
                return this._prj = e, this
            },
            keyset: function(e, t) {
                return t && r(this._keyset), this._keyset = o(e), this
            },
            key: function(e) {
                return this._key = e, this
            },
            decl: function(e) {
                var t = s(this._keyset),
                    i = "i-tanker" === t.block ? "tanker" : this._prj,
                    n = t.elem || this._keyset,
                    o = this._key;
                i = i18n[i] || (i18n[i] = {}), n = i[n] || (i[n] = {}), n[o] = "function" == typeof e ? e : function(t) {
                    return e
                };
                var r = h[this._lang] || (h[this._lang] = {}),
                    a = r[this._keyset] || (r[this._keyset] = {});
                a[o] = e
            },
            val: function(e, t) {
                var i = h[this._lang] && h[this._lang][this._keyset],
                    o = "keyset: " + this._keyset + " key: " + this._key + " (lang: " + this._lang + ")";
                if (!i) return n("[I18N_NO_KEYSET] %s", o), "";
                i = i[this._key];
                var s = typeof i;
                return "undefined" === s ? (n("[I18N_NO_VALUE] %s", o), "") : "string" === s ? i : (t || (t = this), i.call(t, e))
            },
            _cache: function() {
                return h
            }
        }, t.I18N = function(e) {
            var t = function(e, i, n) {
                return t.keyset(e).key(i, n)
            };
            return t._proto = e, t.project = function(e) {
                return this._proto.project(e), this
            }, t.keyset = function(e) {
                return this._proto.keyset(e, !0), this
            }, t.key = function(e, i) {
                var n, o, s = this._proto;
                return s.lang(this._lang).key(e), n = s.val.call(s, i, t), o = a(), o && s.keyset(o, !1), n
            }, t.decl = function(e, t, i) {
                var n, o = this._proto;
                i || (i = {}), i.lang && o.lang(i.lang), o.keyset(e);
                for (n in t) t.hasOwnProperty(n) && o.key(n).decl(t[n]);
                return this
            }, t.lang = function(e) {
                return "undefined" != typeof e && (this._lang = e), this._lang
            }, t.debug = function(e) {
                p = !!e
            }, t.lang(u), t
        }(new l)
    }(this, "undefined" == typeof BEM ? {} : BEM), BEM.I18N.decl("accounts", {
        account: "Учётная запись"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("add-counter", {
        "add-counter": "Добавить счётчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("add-label", {
        "new-label": "Новая метка"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("add-to-favorites", {
        add: "Добавить в Избранное",
        remove: "Убрать из Избранного"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("advice", {
        "dont-show": "Больше не показывать",
        "header-attribution": "Модели атрибуции",
        "header-compare": "Сравнение сегментов",
        "header-custom-reports": "Настройка отчётов",
        "header-dashboard": "Настраиваемая сводка",
        "header-labels": "Метки счётчиков",
        "header-segmentation": "Сегментация",
        "text-attribution": function(e) {
            return "<p>Новички и постоянные посетители ведут себя на сайте по-разному. Метрика 2.0 позволяет фильтровать данные по тем и другим.</p><p>Например, чтобы посмотреть, как новички перемещаются по сайту и не сильно ли отстают от тех, кто уже заходил. Метрика покажет также, как люди пришли на сайт в последний раз и откуда зашли на него впервые.</p><p>Узнав, как посетители попадают на сайт, вы сможете правильно выбрать целевую аудиторию в следующей кампании.</p>"
        },
        "text-compare": function(e) {
            return "<p>Метрика позволяет увидеть изменения в поведении одного сегмента или определить разницу между несколькими — сравнивая их.</p><p>Это пригодится, например, чтобы понять, почему на сайт стали меньше заходить жители маленьких городов.</p><p>Или узнать, посетители какого возраста лучше среагировали на рекламу.</p><p>Посмотреть примеры сравнения сегментов вы можете в «<a href='/secret' target='_blank'>Секретном отчёте</a>»</p>"
        },
        "text-custom-reports": function(e) {
            return "<p>В каждый отчёт вы можете включать несколько метрик и ставить их в нужном порядке.</p><p>Например, разделить посетителей одновременно по источнику трафика и по средней периодичности возврата на ваш сайт. Или вывести на график время, проводимое ими на сайте.</p><p>Вы можете создавать и сохранять свои шаблоны отчётов или настраивать готовые.</p>"
        },
        "text-dashboard": function(e) {
            return "<p>В новой Метрике есть сводка, на которую вы можете вывести самые важные показатели.</p><p>Например, фразы, по которым в последнее время люди попадали на ваш сайт из поиска, текущую посещаемость, среднее время, проводимое на сайте.</p><p>Сводка позволяет с первого взгляда понять, что происходит на сайте и на что стоит посмотреть внимательнее.</p>"
        },
        "text-labels": function(e) {
            return "<p>Если вы следите сразу за несколькими сайтами, их можно объединить в одну группу — поставив на счётчики одинаковую метку. Это позволяет смотреть общую статистику для всей группы.</p><p>Например, можно объединить все региональные сайты и собрать по ним один общий отчёт.</p>"
        },
        "text-segmentation": function(e) {
            return "<p>Сегментация позволяет работать с разными частями аудитории. Для выделения сегментов на сервисе есть более 50 атрибутов.</p><p>Например, вы можете посмотреть сколько москвичек, использующих Safari, попали на ваш сайт из соцсетей и провели на нём больше двух минут.</p><p>Эта функция позволяет точнее определять, насколько эффективно сработала реклама для конкретной аудитории, и выявлять возникшие у посетителей проблемы.</p><p>Посмотреть примеры сегментации вы можете в «<a href='/secret' target='_blank'>Секретном отчёте</a>»</p>"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("attributes-selector", {
        dimension: "Группировка",
        metric: "Метрика",
        "not-selected": "Не выбрано"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("attribution-menu", {
        First: "Первый переход",
        Last: "Последний переход",
        LastSign: "Последний значимый переход",
        attribution: "Атрибуция:",
        hint: "Используемая модель атрибуции. Атрибуция влияет на то, какой переход на сайт (первый, последний и т.п.), используется для вычисления источника трафика и сопутствующих этому источнику атрибутов (например, рекламная кампания или домен сайта, с которого произошел переход)."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("auth", {
        auth: "Авторизация",
        "fill-input": "Заполните это поле",
        login: "Логин",
        logon: "Войти",
        more: "Ещё",
        password: "Пароль",
        permanent: "Запомнить меня",
        register: "Регистрация",
        remember: "Вспомнить пароль",
        "social-log-in": "Войти при помощи социальной сети",
        temporary: "Чужой компьютер",
        "wrong-characters": "Недопустимый ввод",
        "wrong-keyboard-layout": "Смените раскладку",
        "wrong-password": "Пароль не может совпадать с логином"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("b-page", {
        "header-add-counter": "Новый счётчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("browser-warning", {
        firefox: "Mozilla Firefox",
        "not-supported-message": "Новая Яндекс.Метрика не поддерживается вашим браузером",
        opera: "Opera",
        "update-browser-message": "Установите один из предложенных браузеров или обновите текущий. А потом попробуйте сначала. ",
        "yandex-browser": "Яндекс.Браузер"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("cancel-compare", {
        cancel: "Отменить сравнение"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("chart-region-selector", {
        "type-001": "Весь мир",
        "type-by": "Беларусь",
        "type-ru": "Россия",
        "type-tr": "Турция",
        "type-ua": "Украина"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("chart-report", {
        "no-data": function(e) {
            return "<h6>Нет данных</h6><p>Нет данных, соответствующих заданным условиям.</p>"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("confirm-popup", {
        "cancel-button": "Отмена",
        "confirm-button": "Подтвердить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("constructor-menu", {
        apply: "Применить",
        "dimensions-hint-1": "Перетаскивание группировок изменяет их порядок в отчёте.",
        "incompatible-dimensions": "Выбраны несовместимые группировки",
        "incompatible-metrics": "Выбраны несовместимые метрики",
        "metrics-hint": "Можно выбрать до 10 метрик. Перетаскивание метрик изменяет их порядок в отчете.",
        "not-enough-dimensions": function(e) {
            return "Вы не можете выбрать меньше " + e.min + " группировки"
        },
        "not-enough-metrics": function(e) {
            return "Вы не можете выбрать меньше " + e.min + " метрики"
        },
        reset: "Сбросить",
        "too-many-dimensions": function(e) {
            return "Вы не можете выбрать больше " + e.max + " группировок"
        },
        "too-many-metrics": function(e) {
            return "Вы не можете выбрать больше " + e.max + " метрик"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("conversion-chart", {
        conversion: "Конверсия",
        "goal-reaches": "Достижения цели"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("conversion-report", {
        conversion: "Конверсия",
        "goal-action": "Тип цели: JavaScript событие",
        "goal-number": "Тип цели: Количество просмотров",
        "goal-reaches": "Достижения цели",
        "goal-url": "Тип цели: Посещение страниц",
        "no-data": "Нет данных по цели.",
        "no-goal-message": "Для корректной работы отчета необходимо определить как минимум одну цель для счетчика",
        "step-goal": function(e) {
            return "Составная цель «" + e.goal + "»"
        },
        "step-gone": function(e) {
            return function(e) {
                return ["Ушли с первого шага", "Ушли со второго шага", "Ушли с третьего шага", "Ушли с четвертого шага"][e.step]
            }.call(this, e)
        },
        "step-num": function(e) {
            return "Шаг " + e.step
        },
        "step-passed": function(e) {
            return "Перешли на шаг " + e.step
        },
        "total-visits": "Всего визитов",
        visits: "Целевые визиты"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("copyright", {
        link: function(e) {
            return "ООО «" + e.content + "»"
        },
        yandex: "Яндекс"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-activity", {
        "activity-title": "По сравнению с предыдущими 24 часами.",
        undefined: "Не определено"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-chosen", {
        "add-title": "Добавить в избранные",
        "remove-title": "Удалить из избранных"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-editor", {
        "button-edit": "Редактировать"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-grant-delete", {
        "button-delete": "Удалить доступ"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-grant-form", {
        "button-add": "Добавить",
        "button-reset": "Сброс изменений",
        "button-save": "Сохранить",
        comment: "Комментарий",
        login: "Логин"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-grant-unsubscribe", {
        "confirm-unsubscribe": function(e) {
            return "Отписаться от счётчика " + e.counterName + "?"
        },
        unsubscribe: "Отписаться"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-grants", {
        "button-create": "Добавить доступ к счетчику",
        "counter-access": "Доступ к счётчику",
        "empty-list": "Гостевой доступ для данного счётчика не предоставлен ни для одного пользователя.",
        "enable-informer": "Показывать данные информера",
        "informer-hint": "Выключение этой настройки приведёт к запрету на показ данных на информере. Никто не сможет увидеть цифры статистики на картинке информера.",
        "permission-edit": "Полный доступ",
        "permission-public_stat": "Публичный доступ",
        "permission-view": "Только просмотр",
        "public-access": "Публичный доступ к статистике",
        "public-access-hint": "Внимание! При включении этой настройки все пользователи смогут просматривать вашу статистику."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-grants-editor", {
        grants: "Доступы"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-labels-edit", {
        save: "Сохранить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-mirrors-selector", {
        all: "всем сайтам",
        "show-data-for": "Показывать данные по"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-restore", {
        "button-label": "Восстановить",
        confirm: "Готово",
        deleted: "Удален"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-selector", {
        "search-hint": "Искать счётчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-selector-table", {
        "more-button": "Еще",
        "no-data": "Не найдено ни одного счётчика",
        visits: "Визиты:"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-status", {
        CS_CUSTOM_ERR_CONNECT: "Не удалось подключиться к серверу, попробуйте еще раз.",
        CS_ERR_CONNECT: "Не удалось проверить (ошибка соединения).",
        CS_ERR_DUPLICATED: "Установлен более одного раза",
        CS_ERR_EMPTY_DOMAIN_NAME: "Обновление статуса счётчика недоступно.",
        CS_ERR_HTML_CODE: "Установлен некорректно.",
        CS_ERR_INFECTED: "Сайт заражен.",
        CS_ERR_OTHER_HTML_CODE: "Уже установлен другой",
        CS_ERR_TIMEOUT: "Не удалось проверить (превышено время ожидания)",
        CS_ERR_UNKNOWN: "Неизвестная ошибка.",
        CS_NA: "Не применим к данному счетчику.",
        CS_NEW_COUNTER: "Недавно создан.",
        CS_NOT_EVERYWHERE: "Установлен не на всех страницах.",
        CS_NOT_FOUND: "Не найден",
        CS_NOT_FOUND_HOME: "Не установлен на главной странице.",
        CS_NOT_FOUND_HOME_LOAD_DATA: "Не установлен на главной странице, но данные поступают.",
        CS_OBSOLETE: "Установлена устаревшая версия кода счетчика.",
        CS_OK: "Корректно установлен",
        CS_OK_NO_DATA: "Установлен, но данные не поступают.",
        CS_WAIT_FOR_CHECKING: "Идет проверка",
        CS_WAIT_FOR_CHECKING_LOAD_DATA: "Ожидает проверки наличия, данные поступают."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counter-toolbar", {
        "select-counter": "Выберите счётчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counters", {
        "function-in-development": "Данная функциональность находится в разработке.",
        "label-type-all": "Мои счётчики",
        "no-data": "Не найдено ни одного счётчика",
        "search-hint": "Искать счётчик",
        "show-more": "Показать ещё"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("counters-table", {
        "button-delete": "Удалить",
        "counter-deleted": function(e) {
            return "Счетчик №" + e.id + " был удален "
        },
        "counter-link-title": "Отчёты по счётчику",
        "counter-type-guest": "Гостевые",
        "counter-type-own": "Общие",
        "counter-type-partner": "РСЯ",
        "edit-counter": "Редактировать",
        "function-in-development": "Данная функциональность находится в разработке.",
        "header-counter-type": "Метки",
        "header-dynamics": "Визиты за неделю",
        "header-hits": "Просмотры",
        "header-name": "Название и ID счётчика",
        "header-users": "Посетители",
        "header-visits": "Визиты",
        owner: "Владелец",
        partner: "Площадка:",
        "serial-symbol": "№",
        unsubscribe: "Отписаться"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("customizations", {
        "copied-from-prev-report": "Перенесено из предыдущего отчета:",
        "customization-accuracy": "точность",
        "customization-attribution": "атрибуция",
        "customization-filter": "сегментация",
        "customization-goal": "цель",
        "leave-customizations": "Оставить",
        "reset-customizations": "Сбросить",
        "reset-one-customization": function(e) {
            return "Сбросить " + e.customization
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("dashboard-page", {
        "button-create": "Создать",
        "button-multiline": "Линии",
        "button-pie": "Круговая диаграмма",
        "button-table": "Таблица",
        "button-total": "Показатель",
        "create-widget": "Создать виджет",
        dashboard: "сводка",
        "dashboard-desc-head": "Все самое важное под рукой",
        "dashboard-desc-text": function(e) {
            return "Сводка помогает выделить самое важное и организовать<br/> в удобной форме. Добавьте несколько виджетов, чтобы начать работу."
        },
        "default-dashboard-settings": "Стандартные настройки сводки"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("dashboard-wizard", {
        "ad-clicks-name": "Переходы по рекламе",
        "ad-name": "Объявление",
        "ad-next": "Выберите показатель качества:",
        "add-widget": "Добавить виджет",
        "advertising-campaign-name": "Рекламная кампания",
        "advertising-campaign-next": "Выберите показатель качества:",
        "advertising-system-name": "Рекламные системы",
        "advertising-system-next": "Выберите показатель качества:",
        "age-name": "Возраст",
        "age-next": "Выберите показатель качества:",
        "all-sources-name": "Все источники",
        "all-sources-next": "Выберите показатель качества:",
        "bestworst-sources-comment": "Виджет покажет источники, поставляющие наиболее качественный трафик.",
        "bestworst-sources-name": "Наилучшие источники",
        "bestworst-sources-next": "Выберите группу источников, для которой будете замерять качество",
        "characteristics-of-visitors-comment": "Виджет покажет сравнительное количество визитов в разрезе характеристик посетителей сайта.",
        "characteristics-of-visitors-name": "По характеристикам посетителей",
        "characteristics-of-visitors-next": "Выберите характеристику, для которой будете измерять объем трафика:",
        "clicks-on-links-on-websites-name": "Переходы по ссылкам на сайтах",
        "common-name": "Часто встречающиеся",
        "conversion-comment": "Самый точный способ оценки качества. Требует наличия настроенных целей.",
        "conversion-name": "Конверсия",
        "conversion-next": "Выберите цель",
        "conversion-of-visitors-comment": "Виджет покажет процент посетителей, которые хотя бы раз достигали цели.",
        "conversion-of-visitors-name": "Конверсия по посетителям",
        "conversion-of-visitors-next": "Выберите цель",
        "dashboard-wizard": "Библиотека виджетов",
        "depth-of-view-comment": "Чем больше глубина просмотра, тем интенсивнее посетитель взаимодействует с сайтом. Лучше использовать этот параметр на сайтах, работа с которыми подразумевает просмотр множества страниц - каталогами, электронными магазинами.",
        "depth-of-view-name": "Глубина просмотра",
        "direct-ads-name": "Директ, объявления",
        "direct-ads-next": "Выберите показатель качества:",
        "direct-key-phrases-name": "Директ, ключевые фразы",
        "direct-key-phrases-next": "Выберите показатель качества:",
        "direct-site-name": "Директ, площадки",
        "direct-site-next": "Выберите показатель качества:",
        "download-file-comment": "Виджет покажет, какие файлы чаще всего загружаются с сайта.",
        "download-file-name": "Загрузки файлов",
        "dynamics-of-indicators-comment": "Отслеживайте изменения качества трафика в целом по сайту.",
        "dynamics-of-indicators-name": "Динамика показателей",
        "dynamics-of-indicators-next": "Выберите показатель качества:",
        "external-links-comment": "Виджет покажет, по каким ссылкам, ведущим на внешние сайты, чаще всего кликают посетители.",
        "external-links-name": "Внешние переходы",
        "failures-comment": "Виджет покажет, какой процент посетителей ушел с посадочной страницы, не заинтересовавшись сайтом. Чем больше процент отказов, тем хуже работает посадочная страница",
        "failures-name": "Отказы",
        "floor-name": "Пол",
        "floor-next": "Выберите показатель качества:",
        "for-achieving-the-visitor-comment": "Виджет покажет среднее количество достижений цели на посетителя.",
        "for-achieving-the-visitor-name": "Количество достижений цели на посетителя",
        "for-achieving-the-visitor-next": "Выберите цель",
        "geography-city-name": "География (города)",
        "geography-city-next": "Выберите показатель качества:",
        "keyword-name": "Ключевое слово",
        "keyword-next": "Выберите показатель качества:",
        "new-visitors-name": "Новые посетители",
        "novelty-name": "Новизна",
        "novelty-next": "Выберите показатель качества:",
        "playground-name": "Площадка",
        "playground-next": "Выберите показатель качества:",
        "popular-content-comment": "Мониторьте популярность страниц, файлов и ссылок на вашем сайте.",
        "popular-content-name": "Популярное содержимое",
        "popular-content-next": "Выберите, что будем выводить:",
        "popular-pages-comment": "Виджет покажет самые посещаемые страницы сайта.",
        "popular-pages-name": "Популярные страницы",
        "quality-advertising-campaign-and-ad-yandexdirect-comment": "Оценивайте качество трафика для рекламных кампаний и объявлений Яндекс.Директа.",
        "quality-advertising-campaign-and-ad-yandexdirect-name": "Качество, по рекламным кампаниям и объявлениям Яндекс.Директа",
        "quality-advertising-campaign-and-ad-yandexdirect-next": "Выберите атрибут, по которому будете замерять качество",
        "quality-traffic-comment": "Оценивайте качество трафика, приходящего на ваш сайт.",
        "quality-traffic-name": "Качество трафика",
        "quality-traffic-sources-comment": "Сравнивайте качество трафика, приходящего из разных источников.",
        "quality-traffic-sources-name": "Качество по источникам трафика",
        "quality-traffic-sources-next": "Выберите группу источников, для которой будете замерять качество:",
        "quality-utm-tags-name": "Качество, по utm-меткам",
        "quality-utm-tags-next": "Выберите метку, по которой будете замерять качество",
        "reference-traffic-name": "Ссылочный трафик",
        "reference-traffic-next": "Выберите показатель качества:",
        "robotest-comment": "Чем выше этот показатель, тем больше визиты похожи по своим признакам на искусственно сгенерированный трафик.",
        "robotest-name": "Процент роботов,%",
        "search-engine-name": "Поисковые системы",
        "search-engine-next": "Выберите показатель качества:",
        "search-phrases-comment": "Виджет покажет, для каких поисковых фраз замеряем качество.",
        "search-phrases-name": "Поисковые фразы",
        "search-phrases-next": "Выберите показатель качества:",
        "select-widget": "Выберите виджет ",
        "slow-pages-comment": "Виджет покажет страницы, загрузки которых посетители ожидают дольше всего.",
        "slow-pages-name": "Медленные страницы",
        "slow-regions-comment": "Виджет покажет регионы, посетители из которых испытывают наибольшие затруднения при работе с сайтом.",
        "slow-regions-name": "Медленные регионы",
        "social-network-name": "Социальные сети",
        "social-network-next": "Выберите показатель качества:",
        "source-comment": "Виджет покажет сравнительное количество визитов из разных источников.",
        "source-name": "По источникам",
        "source-next": "Выберите группу источников, для которой будете измерять объем трафика:",
        "the-best-landing-page-landing-pages-comment": "Виджет покажет самые эффективно работающие страницы, на которые приземляются посетители вашего сайта",
        "the-best-landing-page-landing-pages-name": "Лучшие посадочные страницы",
        "the-best-landing-page-landing-pages-next": "Выберите метрику для оценки эффектвности посадочных страниц:",
        "the-goals-and-conversion-comment": "Выведите в сводке основные KPI вашего сайта.",
        "the-goals-and-conversion-name": "Достижение целей и конверсия",
        "the-goals-and-conversion-next": "Выберите целевую метрику",
        "the-most-effective-name": "Самые эффективные",
        "the-most-effective-next": "Выберите показатель качества:",
        "the-most-inefficient-name": "Самые неэффективные",
        "the-most-inefficient-next": "Выберите показатель качества:",
        "the-number-of-goal-achievements-comment": "Если цель (например, просмотр страницы) может быть достигнута несколько раз в ходе одного посещения, лучше использовать метрику Количество целевых визитов.",
        "the-number-of-goal-achievements-name": "Количество достижений цели",
        "the-number-of-goal-achievements-next": "Выберите цель",
        "the-number-of-target-visits-comment": "Виджет покажет количество визитов, в которых хотя бы раз была достигнута цель.",
        "the-number-of-target-visits-name": "Количество целевых визитов",
        "the-number-of-target-visits-next": "Выберите цель",
        "the-quality-and-characteristics-of-visitors-comment": "Оценивайте зависимость качества трафика от характеристик посетителей.",
        "the-quality-and-characteristics-of-visitors-name": "Качество, по характеристикам посетителей.",
        "the-quality-and-characteristics-of-visitors-next": "Выберите характеристику посетителей, по которой будете замерять качество",
        "the-quality-pages-comment": "Виджет покажет, насколько хорошо привлекают и удерживают посетителей страницы вашего сайта.",
        "the-quality-pages-name": "Качество страниц",
        "the-speed-of-the-site-comment": "Проверьте, не возникают ли у посетителей вашего сайта проблемы из за его медленной работы.",
        "the-speed-of-the-site-name": "Скорость работы сайта",
        "the-speed-of-the-site-next": "Выберите, что будем выводить:",
        "the-type-of-device-name": "Тип используемого устройства",
        "the-type-of-device-next": "Выберите показатель качества:",
        "the-worst-landing-page-landing-pages-comment": " Виджет покажет самые неэффективно работающие страницы, на которые приземляются посетители вашего сайта",
        "the-worst-landing-page-landing-pages-name": "Худшие посадочные страницы",
        "the-worst-landing-page-landing-pages-next": "Выберите метрику для оценки эффективности посадочных страниц:",
        "the-worst-sources-comment": "Выявляйте источники, поставляющие наименее качественный трафик.",
        "the-worst-sources-name": "Наихудшие источники",
        "the-worst-sources-next": "Выберите группу источников, для которой будете замерять качество",
        "time-on-the-website-comment": "Чем больше посетитель проводит времени на сайте, тем выше его заинтересованность.",
        "time-on-the-website-name": "Время на сайте",
        "top-exit-pages-comment": "Виджет покажет страницы, с которых посетители чаще всего покидают ваш сайт. Большое количество выходов со страницы может быть сигналом о том, что ее содержимое неинтересно посетителям или они не понимают, что дальше делать.",
        "top-exit-pages-name": "Топ страниц выхода",
        "total-comment": "Виджет покажет объем трафика в целом по сайту.",
        "total-name": "Общий объём",
        "total-next": "Выберите показатель, по которому будете измерять объем трафика:",
        "traffic-comment": "Отслеживайте объёмы входящего на ваш сайт трафика в разрезе источников и характеристик посетителей.",
        "traffic-name": "Объём трафика",
        "unavailable-for-groups": "Недоступно для отчёта по группе счётчиков",
        "utm_campaign-parameters-name": "utm_campaign",
        "utm_campaign-parameters-next": "Выберите показатель качества:",
        "utm_content-name": "utm_content",
        "utm_content-next": "Выберите показатель качества:",
        "utm_medium-name": "utm_medium",
        "utm_medium-next": "Выберите показатель качества:",
        "utm_source-name": "utm_source",
        "utm_source-next": "Выберите показатель качества:",
        "utm_term-name": "utm_term",
        "utm_term-next": "Выберите показатель качества:",
        "views-name": "Просмотры",
        "visitors-name": "Посетители",
        "visits-name": "Визиты",
        "volume-percent-name": "Проценты",
        "volume-the-absolute-value-of-the-name": "Абсолютные значения",
        "waivers-comment": "Чем меньше процент отказов, тем выше заинтересованность входящих на сайт посетителей, и качественнее трафик.",
        "waivers-name": "Отказы,%"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("data-lag-notification", {
        "lag-message": "Отставание данных в отчёте от актуальных на"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("data-table", {
        "already-shown": function(e) {
            return "Показано " + e.rendered + " из " + e.total + " строк"
        },
        "button-list-mode": "Линейный список",
        "button-percent-switch": "Абсолютные значения / Проценты",
        "button-show-on-graph": "Отобразить на графике",
        "button-tree-mode": "Древовидный список",
        "comparative-factor": function(e) {
            return function(e) {
                var t = e.value;
                switch (t) {
                    case 1:
                        return "=";
                    case -(1 / 0):
                        return "-∞";
                    case 1 / 0:
                        return "+∞";
                    default:
                        var i = Math.abs(t),
                            n = i % 1 * 100 >= 1 ? 2 : 0,
                            o = i.toFixed(n);
                        return "1" === o ? "≈" : (t > 0 ? "+" : "-") + o + "x"
                }
            }.call(this, e)
        },
        loading: "Загрузка данных…",
        "no-data": function(e) {
            return "<h6>Нет данных</h6><p>Нет данных, соответствующих заданным условиям.</p>"
        },
        "select-default-x-rows": function(e) {
            return "Отобразить на диаграмме первые " + e.num + " строк"
        },
        "show-more": "Показать еще",
        "sum-average": "Итого и средние",
        undefined: "Не определено",
        "unselect-all-rows": "Убрать все строки с диаграммы"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("date-range-selector", {
        "choose-period": "Выберите период"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("date-selector", {
        "period-month": "Месяц",
        "period-today": "Сегодня",
        "period-week": "Неделя",
        "period-year": "Год",
        "period-yesterday": "Вчера"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("dimension-field", {
        external: "Чужие кампании"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("direct-client", {
        direct: "Директ:"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("direct-clientid-notification", {
        notification: function(e) {
            return "В отчёте показана статистика по тем кампаниям, к которым у вас есть доступ в Яндекс.Директе. <a href='https://yandex.ru/support/metrika/sources/direct-clicks.xml' target='metrika_direct_clicks'>Подробнее</a>"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("direct-expenses-notification", {
        notification: function(e) {
            return "Данные о расходах на рекламу могут отличаться от данных в Яндекс.Директе. <a href='https://yandex.ru/support/metrika/sources/direct-clicks.xml' target='metrika_direct_clicks'>Подробнее</a>"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("direct-sampling-notification", {
        notification: "Отчет построен не по 100% данных, точность данных по расходам на рекламу понижена."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("drag-sorter", {
        "button-delete": "Удалить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("error-message", {
        "loading-error": "В ходе загрузки произошла ошибка. Попробуйте позже или обновите страницу.",
        "query-error": "Не удалось обработать запрос. Попробуйте позже или обновите страницу."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("error-page", {
        "access-denied": "Доступ запрещён",
        "add-account": "Добавить пользователя",
        "counter-deleted": function(e) {
            return "Счетчик №" + e.id + " был удален " + e.date
        },
        "counter-deleted-title": "Cчётчик был удалён",
        "enter-different-username": "Войти под другим логином",
        "go-to-counters": "Перейти к списку счётчиков",
        "logged-in-as": "вы вошли как",
        "no-access": "К сожалению, у вас нет прав доступа к этому объекту",
        "page-not-found": "Страница не найдена",
        "undelete-counter": "Восстановить счетчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("footer", {
        about: "О компании",
        "about-url": "//company.yandex.ru",
        advert: "Реклама",
        "advert-url": "//advertising.yandex.ru/kupislova.xml?advertising",
        agreement: "Пользовательское соглашение",
        apps: "Мобильные приложения",
        "apps-url": "//mobile.yandex.ru",
        beta: "β-версия",
        "copyright-notice": "",
        design: "Дизайн",
        "design-artlebedev": "Студия Артемия Лебедева",
        "design-artlebedev-url": "http://www.artlebedev.ru",
        mobile: "Мобильная версия",
        "privacy-policy": "",
        "services-button-value": "Перейти",
        stat: "Статистика",
        "terms-of-service": "",
        termsofuse: "Лицензия на поиск",
        "termsofuse-url": "//legal.yandex.ru/termsofuse/",
        vacancies: "Вакансии",
        "yandex-is-local": "Яндекс локален",
        "yandex-is-not-local": "Как сделать Яндекс локальным",
        feedback: "Обратная связь",
        help: "Помощь"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("formatter", {
        "dimension-page-view-bucket": function(e) {
            return function(e) {
                return e.cnt + " стр." + (15 == e.cnt ? " и более" : "")
            }.call(this, e)
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("goals-panel", {
        "choose-target": "Выберите цель",
        "conversion-goals": "Конверсионные",
        "no-data": "Список целей пуст",
        "no-target": "Без указания цели",
        "retargeting-goals": "Ретаргетинговые",
        target: "Цель"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("head-administration-menu", {
        "access-control": "Управление доступом",
        "application-transfer": "Перенос приложений",
        "calls-bonuses": "ЦЗ - Начисление бонусов",
        "calls-group-title": "Целевой звонок",
        "calls-monitor": "Мониторинг расхода номеров",
        "calls-search": "Поиск номеров",
        "click-house-handle": "Ручка к ClickHouse",
        "counter-transfer": "Перенос счётчика",
        counters: "Счётчики",
        "global-stats": "Глобальная статистика",
        "levels-latency": "Задержки по слоям",
        monitoring: "Мониторинг сайтов",
        "search-counters": "Поиск счётчиков",
        "track-history": "История изменений номера"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("head-menu", {
        "add-counter": "Добавить счётчик",
        "admin-menu-title": "Администрирование",
        blog: "Блог",
        calls: "Целевой звонок",
        click_map: "Карта кликов",
        club: "Клуб",
        counters: "Счётчики",
        delegates: "Представители",
        form_analysis: "Аналитика форм",
        link_map: "Карта ссылок",
        scroll_map: "Карта скроллинга"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("header-wrapper", {
        demo: "Демо-версия",
        "logo-text": " Метрика",
        "old-ui": "Старый интерфейс"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("header2", {
        "action-filter-title": "Настройки поиска",
        "action-settings-title": "Настройки",
        "action-tableau-title": "Табло сервисов"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("header2__logo", {
        "logo-alt": "Яндекс",
        "logo-img-png-url": "//yastatic.net/islands-page/_/UYmX3xSn-Z1WO7vNqgzY2H8bBIc.png",
        "logo-img-svg": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MiIgaGVpZ2h0PSIzNCIgdmlld0JveD0iMCAwIDE2NDAgNjgwIj48cGF0aCBkPSJNNTU2IDIwMGgtNDdjLTQgMC02IDMtNiA1djE0NWgtODd2LTE0NWMwLTQtMi01LTUtNWgtNDdjLTQgMC02IDItNiA1djM2OGMwIDQgMiA2IDUgNmg0OGMzIDAgNS0yIDUtNnYtMTc2aDg3djE3NmMwIDQgMiA2IDYgNmg0N2M0IDAgNS0zIDUtNnYtMzY4YzAtMy0yLTUtNS01em0xMDY2IDMyOWMtMS0yLTItMy00LTMtNCAwLTI0IDgtNTQgOC01OCAwLTg2LTU1LTg2LTE0MyAwLTc3IDIzLTE1NCA2My0xNTQgMTEgMCAyMyAzIDQ0IDIyIDIgMiA0IDMgNiAzczUtMiA3LTVsMjAtMzNjMi0yIDItNSAyLTcgMC0zLTMtNS04LTgtMzEtMTYtNTItMTktNzAtMTktNzEgMC0xMjYgODUtMTI2IDIxNyAwIDExNCA1MyAxODAgMTI5IDE4MCAzMiAwIDY2LTE1IDgwLTI1IDMtMiA0LTUgMy04bC02LTI2em0tMzIzLTE1OGw5MS0xNjZjMi0yIDEtNS0yLTVoLTQ1Yy0xMyAwLTE3IDUtMjIgMTRsLTY4IDE0MmMtNCA4LTggMTQtMTEgMTZ2LTE2N2MwLTMtMi01LTUtNWgtNDljLTIgMC01IDItNSA1djM2OWMwIDIgMiA1IDUgNWg0OWMzIDAgNS0yIDUtNXYtMTkwYzIgMiA0IDQgNSA3bDg2IDE3N2M1IDkgMTEgMTEgMjEgMTFoNDhjMyAwIDQtMyAyLTVsLTEwNi0yMDN6bS00MzQgMTYxaC05Yy0xMSAwLTE0LTUtMTQtMTR2LTMxM2MwLTQtMi01LTUtNWgtMTUxYy00IDAtNiAyLTYgNXYyN2MwIDkyLTUgMjEwLTU0IDI5OWgtMTdjLTUgMC02IDItNiA2djExMWMwIDQgMyA1IDUgNWgzNmM4IDAgMTEtNiAxMS0xMXYtNjNoMTYydjY5YzAgMyAyIDUgNSA1aDM5YzUgMCA5LTQgOS0xMXYtMTA1YzAtNC0yLTYtNi02em0tODIgMGgtMTEwYzM5LTY2IDU0LTE0MCA1OS0yMzEgMi0yMCAyLTQwIDItNTNoNDh2Mjg0em0yMzYtMzQxYy04MiAwLTExOCAxMDMtMTE4IDIxNSAwIDExNCA1MiAxODMgMTI3IDE4MyAzNyAwIDcwLTE0IDg2LTI1IDMtMiA0LTQgMy03bC02LTI2Yy0xLTMtMi01LTYtNS0zIDAtMjUgOC01NiA4LTU4IDAtODYtNTEtODYtMTE3di0xOHMzMCA0IDQ3IDRoMTExdi0zMmMwLTExNy00Mi0xODAtMTAyLTE4MHptLTggMTY0Yy0xNyAwLTQ1IDMtNDUgM3MwLTExIDItMjNjNy02NCAyMy05NyA0OS05NyAyNCAwIDM5IDMzIDQzIDkyIDEgMTIgMSAyNiAxIDI2aC01MHoiLz48cGF0aCBmaWxsPSIjZjAwIiBkPSJNMjcxIDExaC04NmMtODUgMC0xNTcgNjQtMTU3IDE4OSAwIDc1IDM1IDEzMCA5NyAxNThsLTExNiAyMDljLTQgNyAwIDEyIDYgMTJoNTRjNSAwIDgtMiA5LTVsMTA1LTIwNWgzOHYyMDVjMCAyIDIgNSA1IDVoNDdjNSAwIDYtMiA2LTZ2LTU1NGMwLTUtMy04LTgtOHptLTUwIDMwOWgtMzJjLTUwIDAtOTgtMzYtOTgtMTI3IDAtOTUgNDUtMTMzIDkyLTEzM2gzOXYyNjB6Ii8+PC9zdmc+"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("hit-list", {
        empty: "Нет доступных просмотров"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("humanize", {
        "digit-delimiter": ",",
        giga: "млрд",
        kilo: "K",
        mega: "млн",
        percents: function(e) {
            return e.value + e.space + "%"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-chart", {
        errors: "Типы ошибок",
        line: "Линии",
        map: "Карта",
        multibar: "Колонки",
        pie: "Круговая",
        stack: "Области",
        timeline: "Аптайм"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-confirm-popup", {
        "cancel-button": "Отмена",
        "confirm-button": "Подтвердить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-counter-code", {
        alt: "Яндекс.Метрика",
        "title-all": "данные за сегодня (просмотры, визиты и уникальные посетители)",
        "title-pageviews": "данные за сегодня (просмотры)",
        "title-uniques": "данные за сегодня (уникальные посетители)",
        "title-visits": "данные за сегодня (визиты)"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-counter-global", {
        "counter-name": "Все счетчики"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-counter-goals", {
        "column-description": "Описание",
        "column-goal-id": "ID цели",
        "column-name": "Название цели",
        "condition-column-condition": "Условие",
        "condition-column-num": "№",
        "condition-column-url": "URL",
        "condition-type-action": "событие: идентификатор цели",
        "condition-type-contain": "url: содержит",
        "condition-type-exact": "url: совпадает",
        "condition-type-regexp": "url: регулярное выражение",
        "condition-type-start": "url: начинается с"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-date", {
        "axis-date-auto": "d.m H:i",
        "axis-date-day": "d.m.y",
        "axis-date-hour": "d.m H:i",
        "axis-date-month": "M y",
        "axis-date-week": "d.m",
        "common-date-format": "d.m.Y",
        "common-date-time-format": "d.m.y H:i:s",
        day: "д.",
        "dimension-date-format": "d.m.Y D",
        "dimension-period-format": "d.m.Y",
        hour: "ч.",
        "human-date": "d M Y",
        length: function(e) {
            return this.keyset("i-tanker__dynamic").key("toggle", {
                condition: e.weeks,
                "true": " " + e.weeks + " " + this.keyset("i-tanker__dynamic").key("plural", {
                    count: e.weeks,
                    one: "неделя",
                    some: "недели",
                    many: "недель"
                }) + " ",
                "false": ""
            }) + "" + this.keyset("i-tanker__dynamic").key("toggle", {
                condition: e.days,
                "true": " " + e.days + " " + this.keyset("i-tanker__dynamic").key("plural", {
                    count: e.days,
                    one: "день",
                    some: "дня",
                    many: "дней"
                }) + " ",
                "false": ""
            }) + this.keyset("i-tanker__dynamic").key("toggle", {
                condition: e.weeks,
                "true": "",
                "false": " " + this.keyset("i-tanker__dynamic").key("toggle", {
                    condition: e.hours,
                    "true": " " + e.hours + " " + this.keyset("i-tanker__dynamic").key("plural", {
                        count: e.hours,
                        one: "час",
                        some: "часа",
                        many: "часов"
                    }) + " ",
                    "false": ""
                }) + " " + this.keyset("i-tanker__dynamic").key("toggle", {
                    condition: e.days,
                    "true": "",
                    "false": " " + this.keyset("i-tanker__dynamic").key("toggle", {
                        condition: e.minutes,
                        "true": " " + e.minutes + " " + this.keyset("i-tanker__dynamic").key("plural", {
                            count: e.minutes,
                            one: "минута",
                            some: "минуты",
                            many: "минут"
                        }) + " ",
                        "false": " " + this.keyset("i-tanker__dynamic").key("toggle", {
                            condition: e.hours,
                            "true": "",
                            "false": " " + e.seconds + " " + this.keyset("i-tanker__dynamic").key("plural", {
                                count: e.seconds,
                                one: "секунда",
                                some: "секунды",
                                many: "секунд"
                            }) + " "
                        }) + " "
                    }) + " "
                }) + " "
            })
        },
        millisecond: "мс.",
        minute: "мин.",
        month: "м.",
        second: "сек.",
        "tooltip-date-auto": "d.m.Y H:i, l",
        "tooltip-date-day": "d.m.Y, l",
        "tooltip-date-hour": "d.m.Y H:i, l",
        "tooltip-date-month": "F Y",
        "tooltip-date-week": "d.m.Y",
        year: "г."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-error-message", {
        ERR_AGREEMENT_NOT_ACCEPTED: "Необходимо принять условия пользовательского соглашения.",
        ERR_COUNTERS_QUANTITY_BY_LABELS: "Не удалось получить количество счетчиков для меток.",
        ERR_COUNTER_CHOOSE_CHANGE: "Не удалось обновить статус счётчика в Избранном.",
        ERR_COUNTER_GOAL_DEPTH: "Необходимо целое число больше единицы.",
        ERR_COUNTER_GRANT_CHANGE: "Не удалось изменить доступ к счетчику.",
        ERR_COUNTER_GRANT_CREATE: "Не удалось добавить доступ к счетчику.",
        ERR_COUNTER_GRANT_DELETE: "Не удалось удалить доступ к счетчику.",
        ERR_COUNTER_LABELS_LIMIT_EXCEEDED: "Превышен лимит счётчиков для одной метки",
        ERR_COUNTER_UNDELETE: "Не удалось восстановить счетчик.",
        ERR_DELEGATE_ALREADY_EXIST: "Представитель с таким логином уже существует или ожидает подтверждение запроса",
        ERR_DUPLICATE_GRANT: "Такой пользователь уже существует.",
        ERR_EMPTY_FIELD: "Поле не может быть пустым.",
        ERR_GATEWAY_TIMEOUT: "Слишком много данных для отображения. Попробуйте уменьшить временной интервал и/или уровень семплирования.",
        ERR_GATEWAY_TIMEOUT_SHORT: "Слишком много данных для отображения. Попробуйте уменьшить временной интервал.",
        ERR_GOAL_STEP: "Ошибка: не указано имя или условия шага составной цели.",
        ERR_HTTP_400: function(e) {
            return "Ошибка. Пожалуйста, обратитесь <a href='//yandex.ru/support/metrika/troubleshooting.xml'>в службу поддержки</a>."
        },
        ERR_HTTP_403: function(e) {
            return "<h6>Нет доступа</h6><p>Недостаточно прав для просмотра статистики.</p>"
        },
        ERR_INCORRECT_CHART_DATA: "Нет данных для отображения на графике.",
        ERR_INCORRECT_GOAL_CONDITION: "Шаг цели может содержать условия только одного типа (url или событие).",
        ERR_INCORRECT_VALUE: "Введенное значение некорректно.",
        ERR_LABEL_CREATE: "Не удалось создать метку.",
        ERR_LABEL_DELETE: "Не удалось удалить метку.",
        ERR_LABEL_DUPLICATE_NAME: "Метка с таким именем существует.",
        ERR_LABEL_EMPTY_NAME: "Имя метки не может быть пустым.",
        ERR_LABEL_MARK_FAVORITE: "Не удалось добавить метку в список быстрого доступа.",
        ERR_LABEL_REQUEST_FAILED: "Что-то пошло не так.",
        ERR_LABEL_UNMARK_FAVORITE: "Не удалось убрать метку из списка быстрого доступа.",
        ERR_LABEL_UNSET_FAVORITE: "Не удалось удалить метку из списока быстрого доступа.",
        ERR_LABEL_UPDATE: "Не удалось изменить метку.",
        ERR_MIRROR_DUPLICATE: "Ошибка: Дополнительные домены должны быть разными.",
        ERR_MIRROR_SITE_SAME: "Дополнительный домен не может совпадать с доменом сайта!",
        ERR_REPORT_REQUIRE_DIRECT_CLIENT_ID: function(e) {
            return "<h6>Нет данных</h6><p>Нет данных, соответствующих заданным условиям.</p>"
        },
        ERR_REPORT_REQUIRE_GOAL: "Для корректной работы отчёта необходимо выбрать цель. ",
        ERR_ROWS_NOT_SELECTED: "Не выбраны данные для отображения на графике",
        ERR_SITE_EMPTY: "Поле не может быть пустым.",
        ERR_TIMEOUT: "Время ожидания ответа от сервера истекло. ",
        ERR_UNAVAILABLE_FOR_COUNTERS_GROUP: "Недоступно для отчёта по группе счетчиков.",
        ERR_USER_NOT_FOUND: "Такой пользователь не существует.",
        ERR_VISOR_EMPTY_URLS: 'В поле "Список страниц для сохранения" должна быть указана хотя бы одна страница.',
        PERIOD_NO_DATA: "Нет данных за указанный период.",
        SEGMENT_EXISTS: "Ошибка: Сегмент с таким названием уже существует.",
        access_denied: "Ошибка: Доступ запрещен.",
        backend_error: "Ошибка сервера.",
        "default": "Ошибка. Пожалуйста, перезагрузите страницу и повторите операцию.",
        invalid_parameter: "Ошибка: Неверно задан параметр.",
        missing_parameter: "Ошибка: Не указан необходимый параметр.",
        quota: "Ошибка: Превышен лимит количества запросов к API."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-labels", {
        "label-type-chosen": "Избранные",
        "label-type-deleted": "Удаленные",
        "label-type-guest": "Гостевые",
        "label-type-partner": "РСЯ"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-page", {
        "html-title": "Яндекс.Метрика"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-predefined-segments", {
        "advert-traffic": "Рекламный трафик",
        "conversion-visits": "Визиты с конверсиями",
        "desktop-traffic": "Трафик с desktop устройств",
        "mobile-traffic": "Трафик с мобильных устройств",
        "new-visitors": "Новые посетители",
        "not-conversion-visits": "Визиты без конверсий",
        "not-reject": "Не отказы",
        "old-visitors": "Вернувшиеся посетители",
        "reference-traffic": "Ссылочный трафик",
        reject: "Отказы",
        "search-traffic": "Поисковый трафик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-report", {
        "menu-behaviour": "Поведение",
        "menu-content": "Содержание",
        "menu-deepness": "Активность",
        "menu-demography": "Демография",
        "menu-direct": "Директ",
        "menu-ecommerce": "Электронная коммерция",
        "menu-interest": "Интересы",
        "menu-islands": "Острова",
        "menu-legacy": "Отчёты предыдущей версии",
        "menu-legacy/content": "Содержание",
        "menu-legacy/sources": "Источники",
        "menu-legacy/tech_specs": "Технологии",
        "menu-legacy/traffic": "Посещаемость",
        "menu-legacy/visitors": "Посетители",
        "menu-loyalty": "Лояльность",
        "menu-maps": "Карты",
        "menu-markedphones": "Целевой звонок",
        "menu-monitoring": "Мониторинг",
        "menu-report_wizard": "Конструктор",
        "menu-sources": "Источники",
        "menu-tech_specs": "Технологии",
        "menu-traffic": "Посещаемость",
        "menu-user": "Мои отчёты",
        "menu-visitors": "Посетители",
        "menu-webvisor": "Вебвизор",
        "report-basket": "Товары в корзине",
        "report-basket_products": "Заказанные товары",
        "report-bmap": "B-карта видимой части страницы",
        "report-bpage_load_time": "Время загрузки страниц",
        "report-browsers": "Браузеры",
        "report-click_analysis": "Карта путей по сайту",
        "report-click_from_islands": "Переходы с островов",
        "report-click_map": "Карта кликов",
        "report-constructor/list": "Список отчётов",
        "report-conversion_rate": "Конверсии",
        "report-cookies": "Наличие Cookies",
        "report-coupon": "Промокоды",
        "report-deepness_depth": "Вовлечение, глубина просмотра",
        "report-deepness_time": "Вовлечение, время на сайте",
        "report-demography_age": "Возраст",
        "report-demography_structure": "Пол",
        "report-direct_regions": "Директ - регионы",
        "report-direct_sites": "Директ - площадки",
        "report-direct_summary": "Директ - сводка",
        "report-downloads": "Загрузки файлов",
        "report-entrance": "Страницы входа",
        "report-exit": "Страницы выхода",
        "report-favorites": "Избранное",
        "report-filter_contents": "Содержимое фильтров",
        "report-filters_interactions": "Взаимодействие с фильтрами",
        "report-flash": "Версии Flash",
        "report-form_analysis": "Аналитика форм",
        "report-geo": "География",
        "report-hourly": "Посещаемость по времени суток",
        "report-interest": "Долгосрочные интересы",
        "report-java": "Наличие Java",
        "report-javascript": "Наличие JavaScript",
        "report-legacy/adv_engines": "Рекламные системы",
        "report-legacy/browsers": "Браузеры",
        "report-legacy/cookies": "Наличие Cookies",
        "report-legacy/demography": "Демография",
        "report-legacy/depth": "Вовлечение, глубина просмотра",
        "report-legacy/direct_platform_types": "Директ - типы площадок",
        "report-legacy/direct_platforms": "Директ - площадки",
        "report-legacy/direct_regions": "Директ - регионы",
        "report-legacy/direct_summary": "Директ - cводка",
        "report-legacy/display": "Разрешение дисплея",
        "report-legacy/downloads": "Загрузки файлов",
        "report-legacy/duration": "Вовлечение, время на сайте",
        "report-legacy/ecommerce": "Параметры интернет-магазинов",
        "report-legacy/entrance": "Страницы входа",
        "report-legacy/exit": "Страницы выхода",
        "report-legacy/external_links": "Внешние ссылки",
        "report-legacy/flash": "Версии Flash",
        "report-legacy/hour": "Посещаемость по времени суток",
        "report-legacy/interest": "Коммерческие интересы",
        "report-legacy/java": "Наличие Java",
        "report-legacy/js": "Наличие JavaScript",
        "report-legacy/load": "Нагрузка на сайт",
        "report-legacy/mobile": "Мобильные устройства",
        "report-legacy/mobility": "Мобильность",
        "report-legacy/os": "Операционные системы",
        "report-legacy/popular": "Популярное",
        "report-legacy/regions": "География",
        "report-legacy/robots": "Роботы",
        "report-legacy/search_engines": "Поисковые системы",
        "report-legacy/search_phrases": "Поисковые фразы",
        "report-legacy/share": "Кнопка «Поделиться»",
        "report-legacy/silverlight": "Версии Silverlight",
        "report-legacy/sites": "Сайты",
        "report-legacy/social_networks": "Социальные сети",
        "report-legacy/sources": "Источники, сводка",
        "report-legacy/tags": "Метки",
        "report-legacy/title": "Заголовки страниц",
        "report-legacy/traffic": "Посещаемость",
        "report-legacy/url_param": "По параметрам URL",
        "report-legacy/visit_param": "Параметры визитов",
        "report-link_map": "Карта ссылок",
        "report-links": "Внешние переходы",
        "report-loyalty_newness": "Время с первого визита",
        "report-loyalty_period": "Периодичность визитов",
        "report-loyalty_recency": "Время с предпоследнего визита",
        "report-loyalty_visits": "Общее число визитов",
        "report-markedphones/dn": "По call-центру",
        "report-markedphones/log": "Целевой звонок, детально",
        "report-markedphones/sources": "По источникам трафика",
        "report-markedphones/un": "По целевым номерам",
        "report-marketing": "Рекламные системы",
        "report-monitoring_results": "Результаты проверки",
        "report-new": "Новый отчет",
        "report-new_report": "Новый отчеты",
        "report-orders_products": "Содержимое заказов",
        "report-os": "Операционные системы ",
        "report-phrases": "Поисковые фразы",
        "report-popular": "Популярное",
        "report-purchase": "Заказы",
        "report-recent_reports": "Последние отчёты",
        "report-resolution": "Разрешение дисплея",
        "report-scroll_map": "Карта скроллинга",
        "report-search_engines": "Поисковые системы",
        "report-search_queries": "Поисковые фразы",
        "report-share_services": "Кнопка «Поделиться»",
        "report-silverlight": "Версии Silverlight",
        "report-sites": "Сайты",
        "report-social_networks": "Социальные сети",
        "report-sources": "Источники, сводка",
        "report-sources_direct_clicks": "Директ - расходы",
        "report-store_params": "Параметры интернет-магазинов",
        "report-tags_from": "Метки From",
        "report-tags_openstat": "Метки Openstat",
        "report-tags_utm": "Метки UTM",
        "report-tech_devices": "Устройства",
        "report-titles": "Заголовки страниц",
        "report-top_brands": "Популярные категории и бренды",
        "report-top_products": "Популярные товары",
        "report-traffic": "Посещаемость",
        "report-traffic_by_minute": "Трафик по минутам",
        "report-url_param": "По параметрам URL",
        "report-user_vars": "Параметры визитов",
        "report-visor": "Вебвизор",
        "report-visor-player": "Плеер"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-services", {
        404: "404",
        adresa: "Адреса",
        advertising: "Реклама",
        afisha: "Афиша",
        all: "Все сервисы",
        api: "API",
        appsearch: "Приложения",
        auto: "Авто",
        avia: "Авиабилеты",
        aziada: "Азиада",
        ba: "Баян",
        backapv: "Партнер Я.Карт",
        balance: "Баланс",
        bar: "Бар",
        "bar-ie": "Бар для ИЕ",
        "bar-ie9": "Бар для ИЕ9",
        bayan: "Баннеры Яндекса",
        blogs: "Блоги",
        books: "Книги",
        browser: "Браузер",
        calendar: "Календарь",
        captcha: "ой...",
        catalogwdgt: "Каталог виджетов",
        chrome: "Хром с поиском Яндекса",
        city: "Города",
        cityday: "День города",
        collection: "Коллекция",
        company: "Компания",
        contest: "Contest",
        desktop: "Персональный поиск",
        direct: "Директ",
        "direct.market": "Маркет",
        disk: "Диск",
        ege: "ЕГЭ",
        expert: "Эксперт",
        feedback: "Обратная связь",
        feedback2: "Обратная связь",
        ff: "ФФ с поиском Яндекса",
        fotki: "Фотки",
        fresh: "Свежее",
        games: "Игрушки",
        geocontext: "Геоконтекст",
        goroda: "Города",
        help: "Помощь",
        i: "Мои сервисы",
        ie: "ИЕ с поиском Яндекса",
        images: "Картинки",
        "images-com": "Картинки",
        interests: "Интересы",
        internet: "Интернет",
        kassa: "Касса",
        keyboard: "Клавиатура",
        kraski: "Краски",
        kuda: "Куда все идут",
        large: "Яндекс для слабовидящих",
        legal: "Правовые документы",
        lenta: "Лента",
        libra: "Библиотека",
        literacy: "Неделя борьбы за грамотность",
        local: "Локальная сеть",
        lost: "Незабудки",
        love: "День взаимного тяготения — 13 августа",
        mail: "Почта",
        maps: "Карты",
        "maps-wiki": "Народная карта",
        market: "Маркет",
        "market.advertising": "Маркет",
        metrika: "Метрика",
        metro: "Метро",
        mobile: "Мобильный",
        moikrug: "Мой Круг",
        money: "Деньги",
        museums: "Дни исторического и культурного наследия",
        music: "Музыка",
        "music-partner": "Музыка: статистика",
        nahodki: "Мои находки",
        nano: "Нано",
        newhire: "Наниматор",
        news: "Новости",
        notifications: "Нотификационная панель",
        oauth: "Авторизация",
        online: "Онлайн",
        openid: "OpenID",
        opera: "Opera Software",
        opinion: "Цитаты",
        partners: "Рекламная сеть",
        partnersearch: "Поиск для партнеров",
        passport: "Паспорт",
        pdd: "Почта для домена",
        peoplesearch: "Люди",
        perevod: "Перевод",
        probki: "Пробки",
        pulse: "блоги: пульс",
        punto: "Punto switcher",
        pvo: "Ответы",
        rabota: "Работа",
        ramazan: "",
        rasp: "Расписания",
        realty: "Недвижимость",
        referats: "Рефераты",
        rk: "Есть вопросы?",
        root: "Яндекс.Олимпиада для Unix администраторов",
        school: "Школа",
        search: "Поиск",
        server: "Сервер",
        shtrafi: "Штрафы",
        site: "Поиск для сайта",
        slovari: "Словари",
        so: "Самооборона",
        social: "Социализм",
        soft: "Программы",
        sport: "Спорт",
        sprav: "Справочник",
        start: "Стартовая страница",
        stat: "Статистика",
        subs: "Подписки",
        taxi: "Такси",
        terms: "Разговорник",
        tests: "Тесты и опросы",
        tickets: "Билеты",
        time: "Яндекс.Время",
        toster: "Тосты",
        translate: "Перевод",
        tune: "Настройки",
        tv: "Телепрограмма",
        uslugi: "Услуги",
        video: "Видео",
        "video-com": "Видео",
        vno: "ВНО",
        wdgt: "Виджеты",
        weather: "Погода",
        webmaster: "Вебмастер",
        widgets: "Виджеты",
        wordstat: "Статистика",
        wow: "Я.ру",
        www: "Поиск",
        xmlsearch: "XML",
        yaca: "Каталог",
        yamb: "Медийные баннеры",
        zakladki: "Закладки"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-tanker__days", {
        acc1: "в понедельник",
        acc2: "во вторник",
        acc3: "в среду",
        acc4: "в четверг",
        acc5: "в пятницу",
        acc6: "в субботу",
        acc7: "в воскресенье",
        n1: "понедельник",
        n2: "вторник",
        n3: "среда",
        n4: "четверг",
        n5: "пятница",
        n6: "суббота",
        n7: "воскресенье",
        name: function(e) {
            return function(e) {
                return i18n.tanker.days[(e["short"] ? "short" : "n") + e.day]()
            }.call(this, e)
        },
        short1: "пн",
        short2: "вт",
        short3: "ср",
        short4: "чт",
        short5: "пт",
        short6: "сб",
        short7: "вс",
        today: "сегодня",
        tomorrow: "завтра",
        yesterday: "вчера"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-tanker__dynamic", {
        gender: function(e) {
            return function(e) {
                return e[e.gender]
            }.call(this, e)
        },
        plural: function(e) {
            return function(e) {
                var t = isNaN(parseInt(e.count)) ? 0 : e.count,
                    i = t % 10,
                    n = t % 100;
                return 1 == i && 11 != n ? e.one : i > 1 && 5 > i && (10 > n || n > 20) ? e.some : e.many
            }.call(this, e)
        },
        plural_adv: function(e) {
            return function(e) {
                var t = isNaN(parseInt(e.count)) ? 0 : e.count;
                return 0 === t ? e.none : this.keyset("i-tanker__dynamic").key("plural", {
                    count: e.count,
                    one: e.one,
                    some: e.some,
                    many: e.many
                })
            }.call(this, e)
        },
        toggle: function(e) {
            return function(e) {
                return Boolean(e.condition) ? e["true"] : e["false"]
            }.call(this, e)
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("i-tanker__months", {
        g1: "Января",
        g10: "Октября",
        g11: "Ноября",
        g12: "Декабря",
        g2: "Февраля",
        g3: "Марта",
        g4: "Апреля",
        g5: "Мая",
        g6: "Июня",
        g7: "Июля",
        g8: "Августа",
        g9: "Сентября",
        n1: "Январь",
        n10: "Октябрь",
        n11: "Ноябрь",
        n12: "Декабрь",
        n2: "Февраль",
        n3: "Март",
        n4: "Апрель",
        n5: "Май",
        n6: "Июнь",
        n7: "Июль",
        n8: "Август",
        n9: "Сентябрь",
        name: function(e) {
            return function(e) {
                var t = i18n.tanker.months[(e["case"] || "n") + e.month]();
                return Boolean(e.lowercase) ? t.toLowerCase() : t
            }.call(this, e)
        },
        short1: "янв",
        short10: "окт",
        short11: "ноя",
        short12: "дек",
        short2: "фев",
        short3: "мар",
        short4: "апр",
        short5: "май",
        short6: "июн",
        short7: "июл",
        short8: "авг",
        short9: "сен"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("infected-hint", {
        "help-reference": " Что делать?",
        "infected-hint": "Возможно, веб-сайт заражён."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("informer-robots", {
        "robots-count": function(e) {
            return "(" + e.textCount + " " + this.keyset("i-tanker__dynamic").key("plural", {
                count: e.intCount,
                one: "событие",
                some: "события",
                many: "событий"
            }) + ")"
        },
        "robots-percent": function(e) {
            return "Роботы: " + function(e) {
                var t = parseInt(e.robots, 10),
                    i = parseInt(e.total, 10);
                return Math.round(100 * t / i) + "%"
            }.call(this, e)
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("input-time", {
        sample: "чч:мм:сс"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("label-counters-statistic", {
        "chart-label": "Динамика",
        "report-link": "Сводный отчет",
        "visits-label": "Визиты"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("labels-manage", {
        favorites: "Быстрый доступ",
        save: "Сохранить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("labels-manage-dropdown", {
        "all-labels": "Все метки"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("labels-manage-list-item", {
        edit: "Переименовать метку",
        remove: "Удалить метку",
        restore: "Восстановить",
        revert: "Отменить изменения"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("lang-switcher", {
        all: "Ещё",
        en: "En",
        ru: "Ru",
        tr: "Tr",
        uk: "Ua"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("light-constructor", {
        dimensions: "Группировки",
        metrics: "Метрики"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("logo", {
        yandex: "Яндекс"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("m-dashboard", {
        "widget-traffic-source": "Структура переходов",
        "widget-url": "Популярное содержимое"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("main-menu", {
        "popular-reports": "Популярные отчеты",
        "root-item-dashboard": "Сводка",
        "root-item-maps": "Карты",
        "root-item-reports": "Отчеты",
        "root-item-segments": "Сегменты",
        "root-item-settings": "Настройка",
        "root-item-webvisor": "Вебвизор",
        toggle: "Свернуть",
        "unavailable-in-group-mode": "Недоступен для группы счетчиков"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("main-menu-finder", {
        "all-reports": "Стандартные отчёты",
        favorites: "Избранные",
        "favorites-desc": "Используйте закладку, чтобы выбрать самые нужные отчеты.",
        "legacy-reports": "Отчёты предыдущей версии",
        "my-reports": "Мои отчёты",
        "my-reports-desc": "Чтобы добавить собственный отчет, выберите «Сохранить как» в меню отчета или создайте новый.",
        "new-button": "Новый отчёт",
        "popular-reports": "Часто используемые"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("metric-filter", {
        apply: "Применить",
        "button-show-filter": "Фильтровать",
        equals: "Равно",
        "incorrect-value": "Некорректное значение",
        less: "Меньше",
        more: "Больше"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("missing-attribute-data-notification", {
        "attribute-warning": function(e) {
            return function(e) {
                return ("metric" === e.type ? "Метрика" : "Группировка") + '   "' + e.name + '" начала действовать с ' + e.since
            }.call(this, e)
        },
        less: "Скрыть",
        more: "Подробнее",
        "warning-head": "Отчет может содержать неполные данные."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("monitoring-chart-informer", {
        all: "Всего",
        failures: "Сбои",
        uptime: "Аптайм"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("monitoring-report-informer", {
        "update-frequency": "Средняя частота проверки:"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("mooa-api-request", {
        title: "Запросы"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("mooa-api-request-request", {
        "open-new-tab": "Открыть в новой вкладке",
        parameters: "Параметры запроса"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("mooa-mongo-request", {
        title: "Mongo запросы"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("mooa-panel", {
        go: "Перейти",
        "send-bug": "Сообщить об ошибке"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("mooa-popular-counters", {
        appmetrika: "Яндекс.Метрика для приложений",
        democrat: "democrat-spb (Публичный доступ)",
        direct: "Яндекс.Директ",
        fotki: "Яндекс.Фотки",
        genvik: "genvik.ru (Звонки 2.0)",
        lenta: "Лента.Ру",
        mail: "daria.mail.yandex.ru (Дарья)",
        market: "Яндекс.Маркет",
        metrika: "Яндекс.Метрика",
        metrika2: "Яндекс.Метрика 2.0",
        "notik.ru": "notik.ru (Ecommerce)",
        pogoda: "Яндекс.Погода",
        sendflowers: "sendflowers.ru (отчёты Директа)",
        shatura: 'shatura.com (Вебвизор, доход, заказ и кнопка "Поделиться")',
        title: "Популярные счётчики",
        watch: "Код счётчика",
        wikimart: "wikimart.ru (Острова)",
        yandex: "Главная страница Яндекса",
        "yandex-search": "Я.Поиск (Большой)",
        "yandex-tr": "Турецкий Яндекс"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("notice", {
        notifications: "Уведомлений"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("notification", {
        details: "Подробнее"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("pdf-row-limit-notification", {
        "notification-message": "В pdf-документе отображается ограниченное количество строк отчёта. Для экспорта большего числа строк используйте форматы csv и xlsx."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("period-group-selector", {
        "group-by": "Детализация:",
        "group-by-auto": "авто",
        "group-by-day": "по дням",
        "group-by-dekaminute": "по 10 минут",
        "group-by-hour": "по часам",
        "group-by-hours": "по часам",
        "group-by-minute": "по минутам",
        "group-by-minutes": "по минутам",
        "group-by-month": "по месяцам",
        "group-by-week": "по неделям"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("period-selector", {
        month: "Месяц",
        quarter: "Квартал",
        today: "Сегодня",
        week: "Неделя",
        year: "Год",
        yesterday: "Вчера"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("public-counter-notification", {
        notification: "Вы просматриваете отчёты, для которых владелец предоставил публичный доступ."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-chart", {
        averages: "Средние",
        million: "млн.",
        "other-slice": "Остальные",
        totals: "Всего",
        "undefined-slice": "Не определено"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-chart-timeline", {
        interval: "Интервал",
        "no-data": "Нет данных"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-currency", {
        currency: "Валюта:"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-page", {
        "cancel-compare": "Отменить сравнение",
        "new-filter-title": "Новый сегмент",
        "swop-segments": "Поменять условия местами",
        "webvisor-chosen-filter": "Показать избранные посещения",
        "webvisor-viewed-filter": "Показать непросмотренные визиты"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-title-popup", {
        rename: "Переименовать",
        "rename-hint": "Введите новое имя для отчёта",
        save: "Сохранить",
        "save-as-hint": "Введите имя сохраняемого отчёта"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("report-trust-rows", {
        apply: "Применить",
        cancel: "Отменить",
        "confidence-level-about": "Вероятность, с которой разница между «истинным» значением метрики и значением метрики в отчёте не превысит допустимое отклонение.",
        "confidence-level-title": "Вероятность выхода за границы диапазона",
        "exclude-insignificant": "Скрывать статистически недостоверные данные",
        "max-deviation-about": "Величина, на которую значение отображаемой метрики в отчёте может отличаться от  «истинного» значения метрики, рассчитанного на бесконечно большой выборке.",
        "max-deviation-title": "Допустимое отклонение"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("sampling-popup", {
        "button-caption": "Построение отчета",
        info: function(e) {
            return "Точность: " + e.percent
        },
        "max-label": "Точнее",
        "min-label": "Быстрее"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("save-report-form", {
        done: "Готово",
        remove: "Удалить",
        rename: "Переименовать",
        reset: "Сбросить параметры",
        "save-as": "Сохранить как",
        "save-changes": "Сохранить"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("save-segment-form", {
        confirm: "Готово",
        "confirm-replace": "Сегмент с таким именем уже существует. Вы хотите его перезаписать?",
        "copy-label": "Копия",
        "error-segment-exists": "Ошибка: Сегмент с таким названием уже существует",
        "input-hint": "Введите имя ",
        rename: "Переименовать",
        save: "Сохранить",
        "save-as": "Сохранить как"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("search-input", {
        "search-hint": "Искать счётчик"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-compare-menu", {
        compare: "Сравнить сегменты",
        "compare-with": "Сравнить текущий сегмент с:",
        "custom-segment": "Сегментом, заданным вручную",
        "predefined-label": "Готовым сегментом",
        "previous-period": "Предыдущим периодом",
        "user-label": "Сохранённым сегментом"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-filter", {
        "and-separator": "и",
        "items-more-all-count": function(e) {
            return "Всего " + e.count
        },
        "not-separator": "не",
        "or-separator": "или",
        undefined: "Не определено",
        "value-number-eq": function(e) {
            return "Равно " + e.value
        },
        "value-number-less": function(e) {
            return "Меньше " + e.value
        },
        "value-number-more": function(e) {
            return "Больше " + e.value
        },
        "value-number-range": function(e) {
            return "От " + e.from + " до " + e.to
        },
        "value-unavailable": "Недоступно для счетчика",
        "value-url-full": "Полный URL",
        "value-url-host": "Хост",
        "value-url-path": "Путь"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-head", {
        "change-period": "Выбрать другой период",
        "customer-segment": "Пользовательский сегмент",
        "new-segment-title": "Название сегмента",
        "period-label": "Период:",
        save: "Сохранить",
        "segment-primary": "Сегмент Б",
        "segment-secondary": "Сегмент А"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-label", {
        or: "или"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-panel", {
        "dim-value-double": "Число",
        "dim-value-equally": "Равно",
        "dim-value-less": "Меньше",
        "dim-value-more": "Больше",
        "dim-value-string": "Строка",
        "inverse-selected-items-exclude": " Исключить",
        "inverse-selected-items-exclude-multiline": "все условия",
        "inverse-selected-items-include": "Включить",
        "inverse-selected-items-include-multiline": "любое из условий",
        "inverse-selected-items-label": "Выбранные элементы",
        "inverse-selected-items-label-multiline": "Выполняются",
        "level1-level2": "Уровень1.Уровень2",
        "more-button-label-long": "Показать ещё",
        "more-button-label-short": "Ещё",
        "multiline-desc": "По умолчанию используется строгое соответствие. Чтобы получить нестрогое соответствие, разметьте строки специальными символами:",
        "multiline-desc-item-1": function(e) {
            return "<span style='color: #a7c074;'>*</span> соответствует любому количеству любых символов;"
        },
        "multiline-desc-item-2": function(e) {
            return "<span style='color: #378eca;'>@</span> в начале — проверяется вхождение строки;"
        },
        "multiline-desc-item-3": function(e) {
            return "<span style='color: #a253bd;'>~</span> в начале — режим регулярного выражения;"
        },
        "multiline-desc-item-4": function(e) {
            return "<span style='color: #a253bd;'>!</span> в начале — отрицание условия."
        },
        "no-matter": "Не важно",
        "operation-equal": "Равно",
        "operation-from-to": "От — до",
        "operation-less": "Меньше",
        "operation-more": "Больше",
        "param-name": "Имя параметра",
        "param-value": "Значение параметра",
        undefined: "Не определено",
        "url-modes-full": "Полный URL",
        "url-modes-hint": function(e) {
            return "<p>URL-адрес может быть задан в одном из следующих форматов:</p><ul><li>Полный урл - полный урл-адрес страницы, например, http://site.ru/page.html</li><li>Хост - домен сайта первого и второго уровней, например, site.ru</li><li>Путь - относительный адрес страницы сайта, например, /page.html</li><li>Для каждого из типов задания адреса применим режим регулярного выражения.</li></ul>"
        },
        "url-modes-host": "Хост",
        "url-modes-path": "Путь"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-panel-popup", {
        loading: "Загрузка …"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-quantile", {
        quantile: "Квантиль:"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segment-size-totals", {
        selected: function(e) {
            return "Отобрано " + e.count + " из " + e.total + " " + e.metricName
        },
        total: function(e) {
            return "Всего " + e.total + " " + e.metricName
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segments-list", {
        and: "и",
        "button-edit": "Редактировать",
        "button-remove": "Удалить",
        "items-more-all-count": function(e) {
            return "Всего " + e.count
        },
        "reset-all": "Удалить все условия",
        "table-advertising": "По рекламным кампаниям",
        "table-downloads": "По загрузкам",
        "table-external_links": "По внешним переходам",
        "table-hits": "По просмотрам",
        "table-hits_all": "По событиям",
        "table-islands": "По событиям островов",
        "table-share_services": 'По событиям "Поделиться"',
        "table-site_speed": "По скорости загрузки сайта",
        "table-visits": "По визитам",
        undefined: "Не определено",
        "value-number-eq": function(e) {
            return "Равно " + e.value
        },
        "value-number-less": function(e) {
            return "Меньше " + e.value
        },
        "value-number-more": function(e) {
            return "Больше " + e.value
        },
        "value-number-range": function(e) {
            return "От " + e.from + " до " + e.to
        },
        "value-url-full": "Полный URL",
        "value-url-host": "Хост",
        "value-url-path": "Путь"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segments-menu-item", {
        "confirm-remove": "Сохраненный сегмент будет удалён. Продолжить?",
        empty: "Нет сегментов",
        more: "Ещё",
        "predefined-label": "Готовые сегменты",
        "recent-label": "Недавно использованные условия",
        "users-label": "Сохранённые сегменты"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segments-selector", {
        "open-filter": "Сегментировать",
        "recent-segments": "Недавно использованные условия",
        "table-selector-label": "Сегментировать по"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("segments-wrapper", {
        "new-filter-title": "Новый сегмент"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("sensitive-data-warning", {
        details: "Для поддержки алгоритмов контроля безопасности сервисов Яндекса и обеспечения конфиденциальности социально-демографических данных в отчётах отключена детализация до уровня отдельных визитов и посетителей. Показываются только строки с информацией не менее чем по 10 посетителям",
        less: "Скрыть",
        more: "Подробнее",
        warning: "Из отчёта могли быть удалены некоторые данные",
        "webvisor-details": "Текущий набор условий сегментации включает в себя условия, работающие с социально-демографическими характеристиками посетителей. В целях сохранения конфиденциальности, отображение отчетов с детализацией до уровня отдельных визитов и посетителей, сегментированных по социально-демографическим характеристикам, отключено.",
        "webvisor-warning": "Отображение данных с текущим набором условий сегментации невозможно."
    }, {
        lang: "ru"
    }), BEM.I18N.decl("small-chart", {
        "no-data": "Нет данных для отображения на графике.",
        visits: "Визитов"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("super-calendar", {
        "choose-week": "Выбрать неделю №",
        close: "Закрыть",
        collapse: "Свернуть",
        expand: "Развернуть",
        move: "Переместите, чтобы выбрать нужный период",
        "selection-error": "Ошибка выбора",
        "submit-ok": "OK",
        "submit-select": "Выбрать",
        "submit-show": "Показать",
        title: "Выбор периода",
        today: "Сегодня"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("swop-segments", {
        swop: "Поменять условия местами"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("table", {
        accept: "Подтвердить",
        "button-edit": "Редактировать",
        "button-remove": "Удалить",
        cancel: "Отмена",
        columns: "Столбцы",
        comment: "Комментарий",
        decline: "Отклонить",
        "decline-confirm-message": "Вы действительно хотите отклонить заявку?",
        "detalization-bonus": "бонус",
        "header-delegates-comment": "Комментарий",
        "header-delegates-created-date": "Дата разрешения",
        "header-delegates-login": "Представитель",
        "header-detalization-balance": "Остаток",
        "header-detalization-credited": "Зачислено",
        "header-detalization-date": "Дата",
        "header-detalization-deducted": "Списано",
        "header-detalization-numbers": "Номера",
        "header-monitoring-domain": "Домен",
        "header-monitoring-from": "Начало",
        "header-monitoring-length": "Интервал",
        "header-monitoring-message": "Код ответа",
        "header-monitoring-to": "Конец",
        "header-webvisor-favorites": "Избранное",
        login: "Логин",
        "new-delegates": "Новый представитель",
        "no-data": "Нет данных.",
        "remove-confirm-message": "Вы действительно хотите удалить представителя?",
        "role-feature": "Роль/Фича",
        save: "Сохранить",
        "show-more": function(e) {
            return function(e) {
                var t = e.total - e.offset;
                return "Показать еще " + Math.min(e.limit, t) + (t > e.limit ? " из " + t : "")
            }.call(this, e)
        },
        "status-active": "Активен",
        "status-deleted": "Удален",
        "type-partner": "РСЯ",
        "type-simple": "Метрика",
        undefined: "Не определено",
        waiting: "Ожидает подтверждения"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("table-selector", {
        table: "Статистика"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("user", {
        enter: "Войти",
        exit: "Выйти",
        letter: function(e) {
            return this.keyset("i-tanker__dynamic").key("plural_adv", {
                count: e.count,
                one: "новое письмо",
                some: "новых письма",
                many: "новых писем",
                none: "Нет новых писем"
            })
        },
        letter_compose: "Написать письмо",
        passport: "Паспорт",
        tune: "Настройка",
        upload_files: "Мой диск",
        edit_accounts: "Редактировать список",
        add_account: "Добавить пользователя"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("visit-favorite", {
        add: "Добавить в избранное",
        already: "В избранном"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("visit-info", {
        header: "Информация о визите"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("webvisor-goals-popup", {
        "full-label": "Достигнутые цели",
        "partial-label": "Достигнутые частично цели"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("webvisor-mark-viewed-button", {
        "confirm-message": "Вы действительно хотите пометить все посещения просмотренными?",
        "mark-visits-button-label": "Пометить все посещения просмотренными"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("webvisor-row-filter", {
        label: "Фильтровать",
        undefined: "Не определено"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("widget", {
        cancel: "Отменить",
        "chart-lines": "Линии графика",
        "chart-tab": "График",
        "compared-to-previous-period": "По сравнению с предыдущим периодом",
        "dimension-values": "Значения группировки",
        "main-tab": "Основное",
        "metrics-list": "Метрики",
        "readonly-message": "Виджет доступен только для просмотра.",
        save: "Сохранить",
        "segmentation-tab": "Сегментация",
        "show-on-chart": "Показать на графике",
        "static-title": function(e) {
            return "Виджет «" + e.widgetName + "»"
        }
    }, {
        lang: "ru"
    }), BEM.I18N.decl("widget-segmentation", {
        "filter-empty": "Условия не выбраны"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("widget-title", {
        "default-title": "Без названия"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("widget-totals", {
        "total-and-average": "Итого и средние"
    }, {
        lang: "ru"
    }), BEM.I18N.decl("widget-trust-rows", {
        "exclude-insignificant": "Скрывать статистически недостоверные данные"
    }, {
        lang: "ru"
    }), BEM.I18N.lang("ru");
